Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, DEN_RaidingParty_AdventurerLeader_0f2f631a-f47b-eee0-6025-2b814050d453);
DB_Dialogs(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, DEN_RaidingParty_Adventurer2_8b5b6c19-b64c-9aa9-504d-da47901340b5);
DB_Dialogs(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, DEN_RaidingParty_Adventurer1_0c9c15fb-cf0a-fb3b-f196-d23a30afc269);
DB_DoNotFaceDialog(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e);
DB_Crime_DoNotStopDialog(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e);
DB_DoNotFaceDialog(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e);
DB_DoNotFaceDialog(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e);
DB_OneShotPartyTrigger(S_DEN_EntranceAreaMain_ee125fea-bd62-4f5c-8fde-04f02a7b6a74);
DB_AddCharactersInTriggerToDialog(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f, 1, 1, 1);
DB_IgnoreMutingStatussesDialog(DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e);
DB_IgnoreMutingStatussesDialog(DEN_RaidingParty_OpenGate_0310abff-a694-177e-1aa0-a431556a3f3c);
PROC_TriggerRegisterForPlayers(S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_001_6a03d0ff-a930-4347-bba2-9f3fd6bc317a);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_002_7fbfb1b0-184b-4889-935b-f916a7ad1177);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_003_f1a7c5a6-27e7-4164-a31d-d18b4064df85);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_004_c3fb3a30-a1a7-4d8a-8b3c-b101657a0a3d);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_Melee_004_51e9e140-04c2-4598-83c0-787dac74ce61);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_Ranger_003_442fddf8-875a-4099-8725-12042f9e3ebd);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d);
DB_DEN_RaidingParty_GoblinRaidParticipants(S_DEN_GoblinRaider_Bugbear_01_cde6e700-9c2a-4dec-9081-689881198639);
PROC_DEN_RaidingParty_SetupPleaExtras();
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Ranger_01_7fbfb1b0-184b-4889-935b-f916a7ad1177, S_DEN_GoblinRaiderPos_001_d9627561-c4a2-46d7-8f3c-7fda4c9ad7b5, S_DEN_GoblinRaiderAppearPos_001_ae477b7b-c50e-4242-b13a-ec5f3ae82b23);
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Ranger_02_c3fb3a30-a1a7-4d8a-8b3c-b101657a0a3d, S_DEN_GoblinRaiderPos_002_80e20d51-344b-4395-92d8-6cd693ac7a8a, S_DEN_GoblinRaiderAppearPos_008_194c17fd-d000-4499-a498-6ee33c9ace37);
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Melee_01_6a03d0ff-a930-4347-bba2-9f3fd6bc317a, S_DEN_GoblinRaiderPos_003_6040ee51-ac44-4f57-9770-c099c2d3307a, S_DEN_GoblinRaiderAppearPos_003_a699070b-4675-4d20-8a93-30d372d76fe7);
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Melee_02_f1a7c5a6-27e7-4164-a31d-d18b4064df85, S_DEN_GoblinRaiderPos_004_a0274b7b-e30c-4b1c-b447-17e081e514c4, S_DEN_GoblinRaiderAppearPos_007_3ced2bc5-7e5a-4ad2-857b-fef2df42475e);
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Ranger_003_442fddf8-875a-4099-8725-12042f9e3ebd, S_DEN_GoblinRaiderPos_006_ccf45eac-23c7-4934-9a72-fb089d78b973, S_DEN_GoblinRaiderAppearPos_009_8d7c5687-9400-4be9-8211-141b1ab62ee0);
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Worg_01_51e9e140-04c2-4598-83c0-787dac74ce61, S_DEN_GoblinRaiderPos_007_e1f2d63a-1f6a-4f10-8271-2a3553736590, S_DEN_GoblinRaiderAppearPos_002_78887aa6-5e29-4be5-b425-2fef63aec97a);
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d, S_DEN_GoblinRaiderPos_008_6925a317-d4dc-46a5-a617-638a0e02837a, S_DEN_GoblinRaiderAppearPos_004_19f9e9f8-1698-427b-bc60-3dde19d3f84e);
DB_DEN_RaidingParty_RaidingGoblins(S_DEN_GoblinRaider_Bugbear_01_cde6e700-9c2a-4dec-9081-689881198639, S_DEN_GoblinRaiderPos_009_d9fbcc1c-dc46-43ab-9682-5c4a4336b8d0, S_DEN_GoblinRaiderAppearPos_010_0e3a934d-211c-4ccd-b8f4-3e7d680a9708);
DB_GLO_DefeatCounter(S_DEN_GoblinRaider_Ranger_01_7fbfb1b0-184b-4889-935b-f916a7ad1177, "DEN_RaidingParty_Goblins");
DB_DEN_RaidingParty_WyllGoblins(S_DEN_GoblinRaider_Melee_003_0d9a9811-27b3-48ae-84a6-8a85c65a092e);
DB_DEN_RaidingParty_WyllGoblins(S_DEN_GoblinRaider_Ranger_004_dfcc8342-4357-4b3f-9fb4-0d3eb2542830);
PROC_DeclareCounter("DEN_RaidingParty_Goblins");
PROC_TriggerRegisterForPlayers(S_DEN_ConfrontationArea_59d80e7d-78b5-41b2-8b8a-6aa0abcc5982);
DB_DEN_RaidingParty_Leaders(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_DEN_RaidingParty_Leaders(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_PermaDefeatedEvent(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, DEN_AdventurerLeader_State_PermsaDefeated_ed091ac6-d46e-88e6-0568-844d6cc5a559);
DB_DEN_RaidingParty_Adventurers(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_DEN_RaidingParty_Adventurers(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d);
DB_DEN_RaidingParty_Adventurers(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d);
DB_DEN_RaidingParty_AdventurersLeaveDialogs(DEN_RaidingParty_AdventurerAfterKO_ed1090f6-6c29-0823-196b-d2e798ccf2ca);
DB_DEN_RaidingParty_AdventurersLeaveDialogs(DEN_RaidingParty_Confrontation_9f62049b-025f-c424-debf-c4a133a02da9);
DB_DEN_RaidingParty_WakeUpADs(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, DEN_RaidingParty_AD_TieflingWakesUp_bc1edede-e286-8c68-fc3a-e5a3468d168d);
DB_DEN_RaidingParty_WakeUpADs(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, DEN_RaidingParty_AD_AdventurerWakesUp_33b04f26-cb83-7cc1-abde-9ed9f562797c);
DB_DEN_RaidingParty_ConfrontationCharacters(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_DEN_RaidingParty_ConfrontationCharacters(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_DEN_RaidingParty_ConfrontationCharacters(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d);
DB_DEN_RaidingParty_ConfrontationCharacters(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d);
DB_DialogBlockAttackButton(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e);
PROC_TriggerRegisterForPlayers(S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a);
ClearTag(S_DEN_Gatekeeper_847717b3-82eb-45a7-b875-78665c12ce9a, GUARD_0b52f35e-fb1f-4865-bcd2-5d21ef7343cd);
TriggerRegisterForCharacter(S_DEN_KanonPushbackPos_bb550eee-2a36-4a47-902b-193dcfb6f5fa, S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f);
DB_DEN_RaidingParty_PleaAtGateActors(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
DB_DEN_RaidingParty_PleaAtGateActors(S_DEN_GoblinRaider_Worg_01_51e9e140-04c2-4598-83c0-787dac74ce61);
SetForceUpdate(S_DEN_Gate_567055bf-ffeb-4236-8a61-e53877397fde, 1);
SetCanTrade(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 0);
SetCanTrade(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0);

KBSECTION
IF
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "AI_NO_LOOK_AT_BATTLE", -1, 1, _Var1);

IF
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
AND
_Var1 != S_DEN_GoblinRaider_Ranger_01_7fbfb1b0-184b-4889-935b-f916a7ad1177
THEN
DB_GLO_DefeatCounter(_Var1, "DEN_RaidingParty_Goblins");

IF
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
THEN
DB_Sound_ScriptedCombatMusic(_Var1, "DEN_PleaAtTheGates");

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_RaidingParty_WyllGoblins(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_CorpseLooting_BlockMakeOwned((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DB_DEN_RaidingParty_GoblinRaidParticipants(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SceneManager(_Var1, "DEN_RaidingParty_PleaAtGate");
SetImmortal(_Var1, 1);
PROC_SetInvulnerable(_Var1, 1);
DB_DEN_RaidingParty_SceneCharacters(_Var1);

PROC
PROC_DEN_RaidingParty_SetupPleaExtras()
THEN
DB_SceneManager(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, "DEN_RaidingParty_PleaAtGate");
SetImmortal(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, 1);
PROC_SetInvulnerable(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, 1);
DB_DEN_RaidingParty_SceneCharacters(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f);

PROC
PROC_DEN_RaidingParty_SetupPleaExtras()
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
THEN
DB_SceneManager(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "DEN_RaidingParty_PleaAtGate");
SetImmortal(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 1);
PROC_SetInvulnerable(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 1);
DB_DEN_RaidingParty_SceneCharacters(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);

PROC
PROC_DEN_Wyll_CleanTraining()
THEN
NOT DB_SceneManager(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "DEN_RaidingParty_PleaAtGate");
SetImmortal(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 0);
PROC_SetInvulnerable(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 0);
NOT DB_DEN_RaidingParty_SceneCharacters(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, (CHARACTER)_Var2, "DEN_RaidingParty_PleaAtGate", _, (GUIDSTRING)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_RaidingParty_StartPleaAtGate(_Var2);

PROC
PROC_DEN_RaidingParty_StartPleaAtGate((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, _Var1, S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, 0, 0, 0, 0, _Var1, _Var1, _Var1, _Var1)
THEN
TimerCancel("DEN_RaidingParty_CommotionPlaySoundTimer");
PlaySound(S_DEN_Gate_567055bf-ffeb-4236-8a61-e53877397fde, "SE_Crowd_Commotion_Stop");
PROC_TriggerUnregisterForPlayers(S_DEN_EntranceAreaMain_ee125fea-bd62-4f5c-8fde-04f02a7b6a74);
PROC_TriggerUnregisterForPlayers(S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a);

PROC
PROC_DEN_RaidingParty_StartPleaAtGate((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
CharacterGetOwner(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, _Var2, S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, 0, 0, 0, 0, _Var1, _Var1, _Var1, _Var1)
THEN
TimerCancel("DEN_RaidingParty_CommotionPlaySoundTimer");
PlaySound(S_DEN_Gate_567055bf-ffeb-4236-8a61-e53877397fde, "SE_Crowd_Commotion_Stop");
PROC_TriggerUnregisterForPlayers(S_DEN_EntranceAreaMain_ee125fea-bd62-4f5c-8fde-04f02a7b6a74);
PROC_TriggerUnregisterForPlayers(S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a);

PROC
PROC_DEN_RaidingParty_ForcePleaAtGate()
AND
DB_InRegion(_Var1, S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_RaidingParty_FallbackPlea", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_RaidingParty_StartPleaAtGate(_Var1);

IF
FlagSet(Debug_AddWyll_c84c0e41-3ee5-4ff9-8163-65966c6a5b6a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GlobalSetFlagAndCache(Wyll_Recruitment_Event_RecruitedOnce_6855bdf2-de0a-af66-dc74-0fbf3aaf03d9);
NOT DB_SceneManager(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "DEN_RaidingParty_PleaAtGate");
PROC_DEN_RemoveFromDenNPCs(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);
SetImmortal(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 0);
PROC_SetInvulnerable(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 0);
NOT DB_DEN_RaidingParty_SceneCharacters(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);

IF
DialogStarted(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_SceneOver("DEN_RaidingParty_PleaAtGate");

IF
DialogEnded(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_AddCharactersInTriggerToDialog_Clear(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f);

PROC
PROC_SceneOver("DEN_RaidingParty_PleaAtGate", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_RaidingParty_SceneCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetImmortal(_Var1, 0);
PROC_SetInvulnerable(_Var1, 0);

IF
DialogStarted(DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetCanTrade(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 0);
SetCanTrade(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0);

IF
DialogEnded(DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetCanTrade(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 1);
SetCanTrade(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 1);

IF
DialogStarted(DEN_RaidingParty_Confrontation_9f62049b-025f-c424-debf-c4a133a02da9, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetCanTrade(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 0);
SetCanTrade(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0);

IF
DialogEnded(DEN_RaidingParty_Confrontation_9f62049b-025f-c424-debf-c4a133a02da9, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetCanTrade(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 1);
SetCanTrade(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 1);

IF
DialogStarted(DEN_RaidingParty_OpenGate_0310abff-a694-177e-1aa0-a431556a3f3c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetCanTrade(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 0);

IF
DialogEnded(DEN_RaidingParty_OpenGate_0310abff-a694-177e-1aa0-a431556a3f3c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetCanTrade(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 1);

IF
DialogEnded(DEN_RaidingParty_OpenGate_0310abff-a694-177e-1aa0-a431556a3f3c, _, _, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND
DB_InRegion(_Var2, S_DEN_RaidersArriveIncludeSphere_dbfb7504-275f-4ae8-9699-a6aa2772219e, _, _, _)
AND
QRY_OnlyOnce("DEN_RaidingParty_PostRaidVB", _, _, _, _)
THEN
StartVoiceBark(DEN_RaidingParty_VB_RaidersDefeated_3f1d6894-ed89-60b6-57ef-379ca0eeb9a7, _Var2);

IF
FlagSet(DEN_RaidingParty_Event_OpenDenGate_1018a5ed-3543-a4c2-9dd7-138517d55e5e, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND NOT
DB_DialogPlayers(_, _Var3, _, _, _)
AND
DB_InRegion(_Var3, S_DEN_RaidersArriveIncludeSphere_dbfb7504-275f-4ae8-9699-a6aa2772219e, _, _, _)
AND
QRY_OnlyOnce("DEN_RaidingParty_PostRaidVB", _, _, _, _)
THEN
StartVoiceBark(DEN_RaidingParty_VB_RaidersDefeated_3f1d6894-ed89-60b6-57ef-379ca0eeb9a7, _Var3);

IF
DB_DEN_RaidingParty_ConfrontationCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350, _Var1);
PROC_SelfHealing_Disable(_Var1);

IF
DB_InRegion(_Var1, S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350, _Var1, _Var1, _Var1)
AND
DB_DEN_RaidingParty_ConfrontationCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _Var1, _Var1, _Var1, _Var1)
THEN
SetCombatGroupID(_Var1, "DEN_RaidingParty_Confrontation");

IF
DB_DEN_RaidingParty_ConfrontationCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_InRegion(_Var1, S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350, _Var1, _Var1, _Var1)
AND
GetCombatGroupID(_Var1, "DEN_RaidingParty_Confrontation", _Var1, _Var1, _Var1)
THEN
SetCombatGroupID(_Var1, "");

IF
FlagSet(DEN_RaidingParty_Event_AdventurerLeaderToConfrontation_d7fb4647-686e-d4ea-f636-52a4c60aa0ab, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetHasDialog(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0);

IF
FlagSet(DEN_RaidingParty_Event_AdventurersToConfrontation_0b553dd3-afc8-4ab7-9046-8dd452bfc455, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetHasDialog(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, 0);
SetHasDialog(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, 0);

PROC
PROC_StateSet_Defeated(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_Event_KnockOutAdventurer_802fa2ca-c3dd-ae55-dc06-2adfadaf9ac0, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _, _, _, _)
THEN
SetFlag(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_RaidingParty_ConfrontationCompleted();

PROC
PROC_StateSet_Defeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_Event_KnockOutTiefling_8d41adfe-8595-7ba0-fc0c-95ebb61f2fbf, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _, _, _, _)
THEN
SetFlag(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_RaidingParty_ConfrontationCompleted();

PROC
PROC_DEN_RaidingParty_ConfrontationCompleted()
AND
QRY_OnlyOnce("DEN_ConfrontationCleanup", _, _, _, _)
THEN
ClearFlag(DEN_RaidingParty_Event_StartConfrontation_60fb6fc5-f579-4db7-4f7d-f27fce1140aa, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_TriggerUnregisterForPlayers(S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350);
PROC_GlobalSetFlagAndCache(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd);
PROC_DEN_RaidingParty_RestoreConfrontationCharacters();

IF
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_RaidingParty_ActivatePostConfrontationBanters", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_RegisterWorldGossipTrigger(S_PartyBanterTrigger_FOR_DenBridgeCleared_fe51428d-3eeb-43d9-a2ca-2b8d58f254e9);

PROC
PROC_DEN_RaidingParty_RestoreConfrontationCharacters()
AND
DB_DEN_RaidingParty_ConfrontationCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350, _Var1);
PROC_SelfHealing_Enable(_Var1);
SetHasDialog(_Var1, 1);

IF
EntityEvent((GUIDSTRING)_Var1, "DEN_GoToConfrontation_MoveComplete", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_RaidingParty_Leaders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_RaidingParty_LeaderIsReady(_Var1);

IF
EntityEvent((GUIDSTRING)_Var1, "DEN_GoToConfrontation_MoveComplete", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_RaidingParty_Adventurers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetHasDialog(_Var1, 1);

IF
DB_DEN_RaidingParty_LeaderIsReady(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND
DB_DEN_RaidingParty_LeaderIsReady(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _, _, _, _)
AND NOT
DB_CantTalk(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _, _, _, _)
THEN
NOT DB_DEN_RaidingParty_LeaderIsReady(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
NOT DB_DEN_RaidingParty_LeaderIsReady(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
SetFlag(DEN_RaidingParty_Event_StartConfrontation_60fb6fc5-f579-4db7-4f7d-f27fce1140aa, NULL_00000000-0000-0000-0000-000000000000);
PROC_TriggerRegisterForPlayers(S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350);

IF
DB_InRegion(_Var1, S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_RaidingParty_ConfrontationDialog", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(DIALOGRESOURCEGUID_DEN_RaidingParty_Confrontation_9f62049b-025f-c424-debf-c4a133a02da9, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, 0, 0, 1, 1, _Var1, _Var1)
THEN
DB_OnlyOnce("DEN_RaidingParty_ConfrontationDialog");
PROC_TriggerUnregisterForPlayers(S_DEN_ConfrontationLookAt_8012202f-6143-4c3f-a482-8394325b8350);

IF
DialogEnded(DIALOGRESOURCEGUID_DEN_RaidingParty_Confrontation_9f62049b-025f-c424-debf-c4a133a02da9, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_DEN_RaidingParty_ConfrontationCompleted();

IF
FlagSet(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, _, _, _, _)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _Var3, _, _)
AND
DB_DEN_DefaultStates(_Var4, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND
DB_Players(_Var5, _, _, _, _)
THEN
QuestUpdate(_Var5, "HIDDEN_WLD_Boosters", "DEN_Confrontation_PersuadedAradin");

IF
FlagSet(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, _, _, _, _)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _Var3, _, _)
AND
DB_DEN_DefaultStates(_Var4, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND
DB_Players(_Var5, _, _, _, _)
THEN
QuestUpdate(_Var5, "HIDDEN_WLD_Boosters", "DEN_Confrontation_PersuadedAradin");

PROC
PROC_DEN_RaidingParty_SkipPleaAtGates()
THEN
PROC_SceneOver("DEN_RaidingParty_PleaAtGate");
PROC_TriggerUnregisterForPlayers(S_DEN_EntranceAreaMain_ee125fea-bd62-4f5c-8fde-04f02a7b6a74);
PROC_TriggerUnregisterForPlayers(S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f);
PROC_TriggerUnregisterForPlayers(S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a);
PROC_DEN_RaidingParty_GoblinRaidEnded();
Die(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, 0, 1);
TeleportTo(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, S_DEN_KanonDeathPos_3226b5b1-8e96-428a-8761-9f9f129125e8);
TeleportTo(CHARACTERGUID_S_DEN_Gatekeeper_847717b3-82eb-45a7-b875-78665c12ce9a, TRIGGERGUID_S_DEN_GatekeeperPos_12e49637-70dc-4b9f-b1a5-942a2c534314);
SetFlag(DEN_RaidingParty_Quest_GoblinRaidOver_98712d90-c46b-20c4-c4df-02c0117e85a5, NULL_00000000-0000-0000-0000-000000000000, 0);
TimerCancel("DEN_RaidingParty_CommotionPlaySoundTimer");
PlaySound(S_DEN_Gate_567055bf-ffeb-4236-8a61-e53877397fde, "SE_Crowd_Commotion_Stop");

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_SceneManager(_, "DEN_RaidingParty_PleaAtGate", _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_DEN_EntranceAreaMain_ee125fea-bd62-4f5c-8fde-04f02a7b6a74, 0, _Var1, _Var1)
THEN
PROC_DEN_RaidingParty_SkipPleaAtGates();

PROC
PROC_State_Progress(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _, _, _)
AND
DB_SceneManager(_, "DEN_RaidingParty_PleaAtGate", _, _, _)
THEN
PROC_DEN_RaidingParty_SkipPleaAtGates();

PROC
PROC_OneShotTriggerEntered((GUIDSTRING)_Var1, S_DEN_EntranceAreaMain_ee125fea-bd62-4f5c-8fde-04f02a7b6a74, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_DEN_RaidingParty_StartPleaAtGate(_Var1);

IF
FlagSet(DEN_RaidingParty_Event_UnsheatheForFight_520b53e9-b8a3-27b5-7a67-cd63f6d23411, _, _, _, _)
AND
DB_DEN_RaidingParty_GoblinRaidParticipants(_Var3, _, _, _, _)
AND NOT
DB_DEN_RaidingParty_RaidingGoblins(_Var3, _, _, _, _)
THEN
LookAtEntity(_Var3, S_DEN_GoblinRaiderPos_008_6925a317-d4dc-46a5-a617-638a0e02837a);
SetWeaponUnsheathed(_Var3, 1, 0);

IF
FlagSet(DEN_RaidingParty_Event_UnsheatheForFight_520b53e9-b8a3-27b5-7a67-cd63f6d23411, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
LookFromTrigger(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_DEN_AdventurerLookAt_f56f5c74-2c30-4081-a918-26d286285c59, 1);
PROC_CharacterMoveTo(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_DEN_PleaAdventuerCombatPos_002_676b483c-3a2a-4225-aab0-53993d68ae37, "Run", "DEN_RaidingParty_LookAtRaiders");
PROC_CharacterMoveTo(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, S_DEN_PleaAdventuerCombatPos_001_bd9a949b-bf67-4671-803b-3889ee38a1c1, "Run", "DEN_RaidingParty_LookAtRaiders");

IF
DialogActorJoined(DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, _, S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, _, (INTEGER)_)
THEN
DB_DialogDeath(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f);

IF
DialogActorLeft(DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, _, S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, _, (INTEGER)_)
THEN
NOT DB_DialogDeath(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f);

IF
FlagSet(DEN_RaidingParty_Event_KanonOpensGate_d9ea3a80-2a8f-0b85-fc2a-a0802cb5b99c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
LookFromTrigger(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, S_DEN_ShoutTrigger_09052582-3fff-4018-8361-2056d898e49d, 0);
TimerLaunch("DEN_RaidingParty_KanonDies", 5000);

IF
TimerFinished("DEN_RaidingParty_KanonDies", _, _, _, _)
THEN
Die(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, 0, 1);
TeleportTo(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, S_DEN_KanonPushbackPos_bb550eee-2a36-4a47-902b-193dcfb6f5fa, "");
SetFlag(DEN_RaidingParty_Event_LoverFallsDead_195a37d3-cb04-4e0a-9c32-ce76aa8cb564, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_StartDialog_AddExtraSpeakers(DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_Players(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);

PROC
PROC_StartDialog_AddExtraSpeakers(DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DEN_RaidingParty_PleaAtGateActors(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, _Var2);

IF
DialogEnded(DEN_RaidingParty_PleaAtGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f);

IF
DialogEnded(DIALOGRESOURCEGUID_DEN_RaidingParty_PleaAtTheGate_2e71ecd7-3a8e-2d46-8b37-716f6064417e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_DEN_RaidingParty_GateFightSetup();

PROC
PROC_DEN_RaidingParty_GateFightSetup()
AND NOT
DB_Players(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
THEN
SetTag(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, AI_UNPREFERRED_TARGET_9787450d-f34d-43bd-be88-d2bac00bb8ee);
ApplyStatus(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "FEATHER_FALL", 30, 0, NULL_00000000-0000-0000-0000-000000000000);
DB_DEN_RaidingParty_WyllClearUnpreferredTag(1);

IF
LeftCombat(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
AND
DB_DEN_RaidingParty_WyllClearUnpreferredTag(1, _, _, _, _)
THEN
NOT DB_DEN_RaidingParty_WyllClearUnpreferredTag(1);
ClearTag(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, AI_UNPREFERRED_TARGET_9787450d-f34d-43bd-be88-d2bac00bb8ee);

PROC
PROC_DEN_RaidingParty_GateFightSetup()
AND
DB_GlobalFlag(DEN_RaidingParty_Event_GoblinRaidFight_b4f0c21a-9ebc-9d8f-61f7-04b479196eb3, _, _, _, _)
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
THEN
FlushOsirisQueue(_Var1);
SetFaction(_Var1, ACT1_DEN_GoblinRaiders_6f5d49b5-1dc8-6226-e625-f0267cdbbbff);
SetCombatGroupID(_Var1, "893da9dc-8adb-4cd6-ae5e-231628de205a");
PROC_EnterCombat(_Var1, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);

PROC
PROC_DEN_RaidingParty_GateFightSetup()
AND NOT
DB_Avatars(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
AND
GetFaction(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_RaidingParty_WyllOriginalFaction(_Var1);
SetFaction(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, ACT1_DEN_RaidingPartyFight_c2a2e8f3-4c2a-4ebd-b374-1f9d691e585e);

PROC
PROC_DEN_RaidingParty_GateFightSetup()
THEN
SetFaction(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, ACT1_DEN_RaidingPartyFight_c2a2e8f3-4c2a-4ebd-b374-1f9d691e585e);
SetFaction(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, ACT1_DEN_RaidingPartyFight_c2a2e8f3-4c2a-4ebd-b374-1f9d691e585e);
SetFaction(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, ACT1_DEN_RaidingPartyFight_c2a2e8f3-4c2a-4ebd-b374-1f9d691e585e);
PROC_SetRelationToPlayers(ACT1_DEN_Tieflings_ca9de2d9-9022-9215-6d9b-676d916dcb5a, 100);
PROC_SetRelationToPlayers(ACT1_DEN_GoblinRaiders_6f5d49b5-1dc8-6226-e625-f0267cdbbbff, 0);

IF
RelationChanged(ACT1_DEN_GoblinRaiders_6f5d49b5-1dc8-6226-e625-f0267cdbbbff, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, _, (INTEGER)_)
THEN
PROC_DEN_RaidingParty_ForceAllIntoCombat();

PROC
PROC_DEN_RaidingParty_ForceAllIntoCombat()
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f, 1, _Var1, _Var1)
THEN
PROC_EnterCombat(_Var1, S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d);

IF
FlagSet(DEN_RaidingParty_Event_GoblinRaidFight_b4f0c21a-9ebc-9d8f-61f7-04b479196eb3, _, _, _, _)
AND
DB_DEN_Adventurers(_Var3, _, _, _, _)
THEN
FlushOsirisQueue(_Var3);

IF
EnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
AND NOT
DB_DEN_GoblinRaidCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_GoblinRaidCombatID(_Var2);

IF
SwitchedCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_GoblinRaidCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_RaidingParty_GoblinRaidParticipants(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_GoblinRaidCombatID(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_GoblinRaidCombatID(_Var2);
DB_DEN_GoblinRaidCombatID(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_GoblinRaidCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_GoblinRaidCombatID(_Var1);

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_RaidingParty_Goblins", _, _, _, _)
THEN
SetFlag(DEN_RaidingParty_Quest_GoblinRaidOver_98712d90-c46b-20c4-c4df-02c0117e85a5, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_RaidingParty_GoblinRaidEnded();

PROC
PROC_DEN_RaidingParty_GoblinRaidEnded()
AND
QRY_OnlyOnce("DEN_RaidingParty_GoblinRaidCleanup", _, _, _, _)
THEN
PROC_SetRelationMutual(ACT1_DEN_Tieflings_ca9de2d9-9022-9215-6d9b-676d916dcb5a, ACT1_DEN_Adventurers_d8ebdf1b-1362-460a-f51c-30ecd9b34e6b, 50);
PROC_RegisterWorldGossipTrigger(S_PartyBanterTrigger_CRA_RoadDen_05138b51-dc09-4238-80b4-4915f147597f);
SysClear("DB_DEN_RaidingParty_RaidingGoblins", 3);
SysClear("DB_DEN_RaidingParty_GoblinRaidParticipants", 1);
SetCombatGroupID(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "");
SetCombatGroupID(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, "");
SetCombatGroupID(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, "");
SetCombatGroupID(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, "");
SetCombatGroupID(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "");
PROC_DEN_RaidingParty_SetupAlignmentsAfterGoblinFight();

PROC
PROC_DEN_RaidingParty_SetupAlignmentsAfterGoblinFight()
THEN
PROC_SetRelationToPlayers(ACT1_DEN_Tieflings_ca9de2d9-9022-9215-6d9b-676d916dcb5a, 50);
SetFaction(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, ACT1_DEN_Adventurers_d8ebdf1b-1362-460a-f51c-30ecd9b34e6b);
SetFaction(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, ACT1_DEN_Adventurers_d8ebdf1b-1362-460a-f51c-30ecd9b34e6b);
SetFaction(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, ACT1_DEN_AdventurerLeader_8276868b-adf0-4b7e-fc32-2f268e43f51e);

PROC
PROC_DEN_RaidingParty_SetupAlignmentsAfterGoblinFight()
AND
DB_DEN_RaidingParty_WyllOriginalFaction(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_RaidingParty_WyllOriginalFaction(_Var1);
SetFaction(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1);

IF
FlagSet(DEN_RaidingParty_Event_GoblinsAppear_de5537a8-586c-6e56-a635-648679345c35, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
TeleportTo(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, S_DEN_ZevlorCombatPos_4f86355b-ed1b-481f-be48-2f480351f8f0, "");

IF
FlagSet(DEN_RaidingParty_Event_GoblinsAppear_de5537a8-586c-6e56-a635-648679345c35, _, _, _, _)
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var3, _Var4, _Var5, _, _)
THEN
PROC_AppearOutOfSightTo(_Var3, _Var5, S_DEN_GoblinAppearDirection_2d5a4623-399f-4b23-b7cc-2cd5f2635fc0, "");
SetForceUpdate(_Var3, 1);
PROC_CharacterMoveTo(_Var3, _Var4, "Run", "DEN_RaidingParty_GoblinArrived");

IF
EntityEvent((GUIDSTRING)_Var1, "DEN_RaidingParty_GoblinArrived", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
LookFromTrigger(_Var1, _Var2, 0);
SetForceUpdate(_Var1, 0);

IF
EnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_GoblinRaidCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "DEN_RaidingParty_EnteredRaidFight");

IF
TextEvent("DEN_OpenGate", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "DEN_OpenGate");

IF
DialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_RaidingParty_AdventurersLeaveDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_RaidingParty_AdventurersLeaveDen();

PROC
PROC_DEN_RaidingParty_AdventurersLeaveDen()
AND
DB_DEN_RaidingParty_Adventurers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "DEN_KNOCKEDOUT", 0, _Var1, _Var1)
THEN
NOT DB_DEN_RaidingParty_Adventurers(_Var1);
PROC_DEN_LeaveDen(_Var1);
PROC_DEN_RaidingParty_TryStartReactionVoiceBark();

PROC
PROC_DEN_RaidingParty_TryStartReactionVoiceBark()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_DEN_ConfrontationArea_59d80e7d-78b5-41b2-8b8a-6aa0abcc5982, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_RaidingParty_VoicebarkReactionPlayed", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(DEN_RaidingParty_VB_AdventurerLeaderLeaves_338fb23c-6bc8-318d-147f-6c1be037e88b, _Var1);

QRY
QRY_DEN_AnyAvailablePlayerInTrigger((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EnteredTrigger((GUIDSTRING)_Var1, S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_RaidingParty_Event_ApproachingVB", _Var1, _Var1, _Var1, _Var1)
THEN
ObjectTimerLaunch(_Var1, "DEN_RaidingParty_Event_ApproachingVB", 3000);

IF
EnteredTrigger((GUIDSTRING)_Var1, S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_CheckOtherPlayersInTrigger(_Var1, S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a, _Var1, _Var1, _Var1)
THEN
TimerLaunch("DEN_RaidingParty_CommotionPlaySoundTimer", 600);

IF
TimerFinished("DEN_RaidingParty_CommotionPlaySoundTimer", _, _, _, _)
THEN
PlaySound(S_DEN_Gate_567055bf-ffeb-4236-8a61-e53877397fde, "SE_Crowd_Commotion");

IF
LeftTrigger((CHARACTER)_Var1, S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a, _Var1, _Var1, _Var1, _Var1)
THEN
TimerCancel("DEN_RaidingParty_CommotionPlaySoundTimer");
PlaySound(S_DEN_Gate_567055bf-ffeb-4236-8a61-e53877397fde, "SE_Crowd_Commotion_Stop");

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "DEN_RaidingParty_Event_ApproachingVB", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
StartVoiceBark(VOICEBARKRESOURCEGUID_DEN_RaidingParty_VB_ApproachingGate_119fd3ea-67da-1036-bf6f-794a5bf7b7a5, _Var1);

IF
DialogActorLeft(DIALOGRESOURCEGUID_DEN_RaidingParty_AdventurerAfterKO_ed1090f6-6c29-0823-196b-d2e798ccf2ca, _, (CHARACTER)_Var2, _, _)
AND
DB_Players(_Var2, _, _, _, _)
THEN
ObjectTimerLaunch(_Var2, "DEN_RaidingParty_Event_ConclusionVB", 1500);

IF
ObjectTimerFinished((CHARACTER)_Var1, "DEN_RaidingParty_Event_ConclusionVB", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_InRegion(_Var1, S_DEN_EntranceArea_27796261-6c41-4fa2-8afe-6616d7d3e176, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_RaidingParty_EndVB", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(VOICEBARKRESOURCEGUID_DEN_RaidingParty_VB_PeacefulResolution_71ae380c-dca2-8915-b9e4-a65a2297054b, _Var1);

IF
StatusApplied((CHARACTER)_Var1, "DEN_KNOCKEDOUT", _, _, (CHARACTER)_Var1)
THEN
PROC_CharacterDisableAllCrimes(_Var1, 1);

IF
StatusRemoved((CHARACTER)_Var1, "DEN_KNOCKEDOUT", _, _, (CHARACTER)_Var1)
THEN
PROC_CharacterEnableAllCrimes(_Var1);

IF
DialogActorJoined(_, _, (GUIDSTRING)_Var3, _, _)
AND
DB_DEN_RaidingParty_LeaderIsKO(_Var3, _, _, _, _)
AND
HasActiveStatus(_Var3, "DEN_KNOCKEDOUT", 1, _, _)
THEN
RemoveStatus(_Var3, "DEN_KNOCKEDOUT");

IF
StatusRemoved((GUIDSTRING)_Var1, "DEN_KNOCKEDOUT", _, _, (GUIDSTRING)_Var1)
AND
DB_DEN_RaidingParty_LeaderIsKO(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_RaidingParty_LeaderIsKO(_Var1);

IF
FlagSet(DEN_RaidingParty_Event_KnockOutAdventurer_802fa2ca-c3dd-ae55-dc06-2adfadaf9ac0, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ApplyStatus(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "DEN_KNOCKEDOUT", -1);
DB_DEN_RaidingParty_LeaderIsKO(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_Dialogs(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, DIALOGRESOURCEGUID_DEN_RaidingParty_AdventurerAfterKO_ed1090f6-6c29-0823-196b-d2e798ccf2ca);

IF
FlagSet(DEN_RaidingParty_Event_KnockOutTiefling_8d41adfe-8595-7ba0-fc0c-95ebb61f2fbf, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ApplyStatus(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, "DEN_KNOCKEDOUT", -1);
DB_DEN_RaidingParty_LeaderIsKO(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);

IF
DialogStarted(DEN_RaidingParty_AdventurerAfterKO_ed1090f6-6c29-0823-196b-d2e798ccf2ca, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetEntityEvent(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "DEN_RaidingParty_LeaveDen");
SetFlag(DEN_RaidingParty_Event_AdventurerLeft_892fab5d-cf11-b3c9-43d2-b7d093c9eb5c, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DEN_RaidingParty_PlayWakeUpAD((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_RaidingParty_WakeUpADs(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_LongRest()
AND
DB_DEN_RaidingParty_Adventurers(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, _, _, _, _)
AND NOT
DB_Defeated(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND
QRY_OnlyOnce("DEN_RaidingParty_ForceEndConfrontation", _, _, _, _)
THEN
NOT DB_DEN_RaidingParty_Adventurers(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
RemoveStatus(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "DEN_KNOCKEDOUT");
SetOnStage(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0);
SetEntityEvent(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "DEN_RaidingParty_LeftDen");

IF
LeftTrigger((CHARACTER)_Var1, S_DEN_EntranceArea_27796261-6c41-4fa2-8afe-6616d7d3e176, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_CheckOtherPlayersInTrigger(NULL_00000000-0000-0000-0000-000000000000, S_DEN_EntranceArea_27796261-6c41-4fa2-8afe-6616d7d3e176, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_RaidingParty_ForceEndConfrontation", _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_RaidingParty_LeaderIsKO(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(_Var2, "DEN_KNOCKEDOUT");
PROC_DEN_RaidingParty_AdventurersLeaveDen();

IF
DB_InRegion(_Var1, S_DEN_Cave_SUB_adecafa4-27c6-4b2f-bf9e-6ffd7c81a766, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_ConfrontationCleanup", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_RaidingParty_Quest_ConfrontationResolved_dc97da68-5ed9-ffe2-7582-2533be0efbcd, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_CheckOtherPlayersInTrigger(_Var1, S_DEN_ConfrontationArea_59d80e7d-78b5-41b2-8b8a-6aa0abcc5982, _Var1, _Var1, _Var1)
THEN
PROC_DEN_RaidingParty_ConfrontationCompleted();
PROC_DEN_RaidingParty_AdventurersLeaveDen();

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
THEN
PROC_DEN_RaidingParty_ConfrontationCompleted();

IF
EntityEvent(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, "DEN_RaidingParty_ZevlorUsedHorn", _, _, _)
THEN
RealtimeObjectTimerLaunch(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, "DEN_RaidingParty_BlowHorn", 2600);

IF
ObjectTimerFinished(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, "DEN_RaidingParty_BlowHorn", _, _, _)
THEN
PROC_DEN_BattleHorn_Used(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 0);

IF
UseStarted((CHARACTER)_Var1, S_DEN_BattleHorn_baf1a4c5-b6f9-48c2-908d-164b967655d5, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
HasActiveStatus(S_DEN_BattleHorn_baf1a4c5-b6f9-48c2-908d-164b967655d5, "SILENCED", _Var2, _Var1, _Var1)
THEN
PROC_DEN_BattleHorn_Used(_Var1, _Var2);

PROC
PROC_DEN_BattleHorn_Used((CHARACTER)_Var1, 0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_DEN_BattleHorn_UsedBy(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_BattleHorn_UsedBy(_Var1);
PROC_DEN_BattleHorn_UsedAndAvailable(_Var1);

PROC
PROC_DEN_BattleHorn_UsedAndAvailable((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetCanInteract(S_DEN_BattleHorn_baf1a4c5-b6f9-48c2-908d-164b967655d5, 0);
PlayEffect(S_DEN_BattleHorn_vfxtrigger_271b6814-45c1-41f1-9c13-096107ff706b, VFX_Script_Wyll_Horn_Cast_01_a5b7b36f-8033-c0cb-4767-801ab6214323, "", 1);
TimerLaunch("DEN_BattleHorn_Used", 500);
TimerLaunch("DEN_BattleHorn_Finished", 4000);

PROC
PROC_DEN_BattleHorn_Used((CHARACTER)_Var1, 1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
TimerFinished("DEN_BattleHorn_Used", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_BattleHorn_UsedBy(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
IterateCharactersAround(_Var1, 45, "DEN_BattleHorn_Buff", "DEN_BattleHorn_Buff_Completion");

IF
EntityEvent((GUIDSTRING)_Var1, "DEN_BattleHorn_Buff", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_BattleHorn_UsedBy(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var1, _Var2, 0, _Var1, _Var1)
THEN
PlayEffect(_Var1, VFX_Script_Wyll_Horn_Impact_01_88eb47eb-5bca-cbec-ae9b-5b2273b8af45, "Dummy_BodyFX", 0.8);
ApplyStatus(_Var1, "RALLY", 30, 1, _Var2);

IF
TimerFinished("DEN_BattleHorn_Finished", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_BattleHorn_UsedBy(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_BattleHorn_UsedBy(_Var1);
SetCanInteract(S_DEN_BattleHorn_baf1a4c5-b6f9-48c2-908d-164b967655d5, 1);

IF
FlagSet(DEN_RaidingParty_Debug_ResolveConfrontation_cd991e7d-f05f-ddfe-d159-b4d80bf8075d, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(DEN_RaidingParty_Debug_ResolveConfrontation_cd991e7d-f05f-ddfe-d159-b4d80bf8075d, _Var1);
PROC_DEN_RaidingParty_DebugResolveConfrontation();

IF
FlagSet(DEN_RaidingParty_Debug_ResolveConfrontation_NotPeaceful_ecf261d5-1733-2a18-8482-b4d7535febc0, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(DEN_RaidingParty_Debug_ResolveConfrontation_NotPeaceful_ecf261d5-1733-2a18-8482-b4d7535febc0, _Var1, 0);
PROC_DEN_RaidingParty_DebugResolveConfrontationNotPeaceful();

IF
TextEvent("denraiddone", _, _, _, _)
THEN
PROC_DEN_RaidingParty_DebugKillGoblins();
PROC_DEN_RaidingParty_DebugResolveConfrontation();

IF
TextEvent("denraiddonenopeace", _, _, _, _)
THEN
PROC_DEN_RaidingParty_DebugKillGoblins();
PROC_DEN_RaidingParty_DebugResolveConfrontationNotPeaceful();

PROC
PROC_DEN_RaidingParty_DebugKillGoblins()
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var1, 1, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, 1);

PROC
PROC_DEN_RaidingParty_DebugResolveConfrontation()
AND
QRY_OnlyOnce("DEN_RaidingParty_ForceEndConfrontation", _, _, _, _)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_RaidingParty_SkipPleaAtGates();
SysClear("DB_DEN_GoblinRaidCombatID", 1);
SetFlag(DEN_RaidingParty_Debug_GoblinRaidOver_94aac9b4-dec7-48c7-a471-975179a28ce5, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_RaidingParty_State_PeacefulResolution_f4529d52-b459-6545-b4bf-8b2fb2cd6f2f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_RaidingParty_ConfrontationCompleted();

PROC
PROC_DEN_RaidingParty_DebugResolveConfrontationNotPeaceful()
AND
QRY_OnlyOnce("DEN_RaidingParty_ForceEndConfrontation", _, _, _, _)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_RaidingParty_SkipPleaAtGates();
SysClear("DB_DEN_GoblinRaidCombatID", 1);
SetFlag(DEN_RaidingParty_Debug_GoblinRaidOver_94aac9b4-dec7-48c7-a471-975179a28ce5, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_RaidingParty_ConfrontationCompleted();
PROC_DEN_RaidingParty_AdventurersLeaveDen();

IF
TextEvent("rpka", _, _, _, _)
THEN
PROC_ForceStopDialog(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
Die(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
TextEvent("rpkt", _, _, _, _)
THEN
PROC_ForceStopDialog(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
Die(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
TextEvent("pleaskip", _, _, _, _)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_EntranceAreaMain_ee125fea-bd62-4f5c-8fde-04f02a7b6a74);
PROC_TriggerUnregisterForPlayers(S_DEN_FallbackPleaSphere_b18fcf59-ea21-4f14-8ba2-af2d29b81d2f);
PROC_TriggerRegisterForPlayers(S_DEN_EntranceAreaDebug_a414d31e-8a59-4ae8-a720-c94ae5312a29);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_EntranceAreaDebug_a414d31e-8a59-4ae8-a720-c94ae5312a29, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, 0, 1);
TeleportTo(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, S_DEN_KanonDeathPos_3226b5b1-8e96-428a-8761-9f9f129125e8);
PROC_DEN_RaidingParty_DebugFight();

PROC
PROC_DEN_RaidingParty_DebugFight()
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
TeleportTo(_Var1, _Var2, "");

PROC
PROC_DEN_RaidingParty_DebugFight()
AND
DB_DEN_RaidingParty_RaidingGoblins(_Var1, _, _, _Var1, _Var1)
THEN
SetFaction(_Var1, ACT1_DEN_GoblinRaiders_6f5d49b5-1dc8-6226-e625-f0267cdbbbff);
SetCombatGroupID(_Var1, "893da9dc-8adb-4cd6-ae5e-231628de205a");
PROC_EnterCombat(_Var1, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);

IF
DialogActorLeft(DEN_RaidingParty_Confrontation_9f62049b-025f-c424-debf-c4a133a02da9, _, (GUIDSTRING)_Var2, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND
QRY_OnlyOnce("DEN_RaidingParty_ConfrontationResolvedVB", _, _, _, _)
THEN
StartVoiceBark(DEN_RaidingParty_VB_ConfrontationResolved_e5b4679a-b83a-6976-4344-b1c350e4ef8c, _Var2);

IF
FlagSet(DEN_AdventurersQuest_State_AtDen_a76436f9-d1c5-11ea-1340-fc7f5c02f87f, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, (INTEGER)_, (INTEGER)_)
THEN
PROC_RemoveDialog(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_Dialogs(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, DEN_AdventurerLeader_46fea64f-e098-2df5-f4ee-825080ef9728);

IF
FlagSet(DEN_AdventurersQuest_State_AtDen_a76436f9-d1c5-11ea-1340-fc7f5c02f87f, S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, _, (INTEGER)_, (INTEGER)_)
THEN
PROC_RemoveDialog(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d);
DB_Dialogs(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, DEN_AdventurersQuest_RaidAdventurer_33617ce2-882e-8c82-83da-3c6b0e0b06ef);

IF
TurnStarted(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d, _, _, _, _)
AND
HasActiveStatusWithGroup(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d, "SG_Incapacitated", 0, _, _)
AND
HasActiveStatusWithGroup(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d, "SG_Stunned", 0, _, _)
AND
HasActiveStatus(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d, "SILENCED", 0, _, _)
AND
QRY_OnlyOnce("DEN_GoblinRaider_Captain_AD", _, _, _, _)
THEN
SetEntityEventReal(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d, "GLO_CombatWait", 3);
PROC_TryStartAD(DEN_RaidingParty_AD_GoblinCaptain_b60b9208-94d2-6790-d636-b3c6f2fd5274, S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d);
DB_CombatReact_AD_OnNextTurn(S_DEN_GoblinRaider_Captain_22d80f21-7f31-4240-b981-9137d53ad77d, DEN_GoblinRaider_Captain_AD_TakingTurn_Combat_b1c0435d-060e-2623-8531-ce136cc8221e);

IF
DB_DEN_RaidingParty_WyllGoblins(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
TurnStarted(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
AND
DB_DEN_GoblinRaidCombatID(_Var3, _, _, _, _)
AND
DB_Is_InCombat(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var3, _, _, _)
AND
DB_DEN_RaidingParty_WyllAD(1, _, _, _, _)
AND
QRY_StartDialog(DIALOGRESOURCEGUID_DEN_RaidingParty_AD_WyllCharge_f261f885-77fb-7c1a-8415-e8a1cf373149, S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _)
THEN
NOT DB_DEN_RaidingParty_WyllAD(1);

IF
FlagSet(DEN_RaidingParty_Event_WyllEntersFight_95cc86b7-d74b-f176-3375-afcf87aada99, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_DEN_RaidingParty_WyllEntersFight();

PROC
PROC_DEN_RaidingParty_WyllEntersFight()
THEN
DB_DEN_RaidingParty_WyllAD(1);
TeleportTo(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, S_DEN_WyllJumpToPos_17d714bb-a0b8-492d-bba5-a673f789a1a4, "");

PROC
PROC_DEN_RaidingParty_WyllEntersFight()
AND
DB_DEN_RaidingParty_WyllGoblins(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);
CreatePuddle(_Var1, "SurfaceBlood", 3, 15, 12, 12, 1);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
