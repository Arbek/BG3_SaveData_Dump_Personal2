Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, DIALOGRESOURCEGUID_GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c);
PROC_CharacterMoveTo(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "Walk", "");
LookAtEntity(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
LookAtEntity(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
Unlock(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6);
PROC_TriggerRegisterForPlayers(S_GOB_Tortsurers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071);
PROC_TriggerRegisterForPlayers(S_GOB_HappyTorturers_QuestAddBox_b8dac444-277e-499f-8e0b-cb83fd77fd2f);
DB_KilledEvent(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, GOB_Torturers_KilledSpike_64863f03-e538-451d-86ab-5ce8684cf175);
DB_KilledEvent(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, GOB_Torturers_KilledGoblet_f3afc968-d6e8-46a4-aea3-fc06981554a1);
DB_KilledEvent(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, GOB_Torturers_KilledPrisoner_ecb838c2-26fe-4b78-ba28-b307b8e9aa19);
DB_ItemOwnerShipTriggers("WLD_Main_A", S_GOB_Torturers_OwnershipTrigger_90301e50-f33c-4795-a093-44d54add9727, S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f);
Use(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, "GOB_HappyTorturers_AdventurerRestrained");
ToInventory(S_GOB_HappyTorturers_Chains_Key_536107bd-277b-42bb-8eaf-2b787123615c, S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, 1, 0, 1);
DB_HasItemEvent(S_GOB_HappyTorturers_Chains_Key_536107bd-277b-42bb-8eaf-2b787123615c, GOB_Torturers_State_HasKey_b7a5d960-c173-4b79-852c-01cea0a45e2e);
DB_Inclusion_Object(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, GOB_Torturers_Goblet_Inclusion_Start_3611ee87-86b8-4869-a758-db7df455c45c, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_NPCDialog(GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c, S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc);
DB_GLO_CharacterCorpseDialog(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, GOB_Torturers_Spike_Dead_f5cfb502-ef15-30e6-5638-1090a97871a6);
DB_GLO_DefeatCounter(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, "GOB_HappyTorturers_Torturers");
DB_GLO_DefeatCounter(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, "GOB_HappyTorturers_Torturers");
DB_GLO_DefeatCounter(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, "GOB_HappyTorturers_Spike");
PROC_TriggerRegisterForPlayers(S_GOB_HappyTorturers_TortureScreamsRegion_0d98abd3-4d8a-4948-9cd9-d2ef581b3b53);
SetCanTrade(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 0);
SetFlag(GLO_State_NoCower_8180293e-4d0d-4e9b-9dfc-b195d4c67ddb, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 0);
DB_GlobalFlagReactionAfterDialog(GOB_Torturers_State_TorturedEnough_5ee00add-a8c8-4d61-4560-80582db6fe58, DIALOGRESOURCEGUID_GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c);
DB_GlobalFlagReactionAfterDialog(GOB_Torturers_State_Persuaded_d68ef3fa-08ba-52b9-8f39-7594dfde5c89, DIALOGRESOURCEGUID_GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c);
DB_NoLowAttitudeDialog(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f);
DB_NoLowAttitudeDialog(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc);
DB_NoLowAttitudeDialog(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
DB_PreventKnockedOutPermaDefeated(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
DB_GLO_DefeatCounter(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, "GOB_HappyTorturers_Defeated");
DB_GLO_DefeatCounter(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, "GOB_HappyTorturers_Defeated");
DB_GLO_DefeatCounter_AllDefeatedGlobalFlag("GOB_HappyTorturers_Defeated", GOB_Torturers_State_TorturersDefeated_b225be7d-fb72-4ec2-a504-17c5cd4ee5f9);
DB_DoNotFaceDialog(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, GOB_Torturers_Torture_AD_f0c41a90-ce2d-3440-346a-87e94873f2ed);
DB_DoNotFaceDialog(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, GOB_Torturers_Torture_AD_f0c41a90-ce2d-3440-346a-87e94873f2ed);
DB_GOB_TortureOverFlags(GOB_Torturers_State_Persuaded_d68ef3fa-08ba-52b9-8f39-7594dfde5c89);
DB_GOB_TortureOverFlags(GOB_Torturers_State_TorturedEnough_5ee00add-a8c8-4d61-4560-80582db6fe58);
DB_GOB_TortureOverFlags(GOB_Torturers_State_AfterLongRest_78b07dee-8461-9d1b-028a-1e7cf8d39532);
DB_GOB_TortureOverFlags(GOB_Torturers_State_TorturersDefeated_b225be7d-fb72-4ec2-a504-17c5cd4ee5f9);
DB_GOB_AdventurerFreedFlags(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977);
DB_GOB_AdventurerFreedFlags(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9);

KBSECTION
IF
FlagSet(Debug_Quest_GOB_TorturedAdventurer_Escort_a562b750-d572-d1c3-9cb9-b6c0a9542a96, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, 0, 1);
Die(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, 0, 1);
SetOnStage(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1);
SetHasDialog(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1);
ClearFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
ClearFlag(Debug_Quest_GOB_TorturedAdventurer_Escort_a562b750-d572-d1c3-9cb9-b6c0a9542a96, _Var1, 0);
PROC_TeleportPartiesTo(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "");

IF
FlagSet(Debug_Quest_GOB_TorturedAdventurer_Persuade_f481a534-aaad-2b3f-6e2f-8294e51e86f6, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1);
SetHasDialog(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1);
ClearFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
ClearFlag(Debug_Quest_GOB_TorturedAdventurer_Persuade_f481a534-aaad-2b3f-6e2f-8294e51e86f6, _Var1, 0);
PROC_TeleportPartiesTo(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "");
SetFlag(GOB_Torturers_State_Persuaded_d68ef3fa-08ba-52b9-8f39-7594dfde5c89, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_GOB_Torturers_MoveOut(1);

IF
FlagSet(Debug_Quest_GOB_TorturedAdventurer_KnowDen_1967e727-a12b-a07b-4d15-e0595c701863, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_Torturers_State_KnowDen_06207c03-9264-9790-99da-49b1df20be0c, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag(Debug_Quest_GOB_TorturedAdventurer_KnowDen_1967e727-a12b-a07b-4d15-e0595c701863, _Var1, 0);

IF
FlagSet(Debug_Quest_GOB_TorturedAdventurer_Teleport_30a05aeb-589f-525b-eb02-b1ab3853aca2, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TeleportPartiesTo(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "");
ClearFlag(Debug_Quest_GOB_TorturedAdventurer_Teleport_30a05aeb-589f-525b-eb02-b1ab3853aca2, _Var1, 0);

IF
TextEvent("GOB_Debug_Torturers_OrderGoblet", _, _, _, _)
THEN
DB_GOB_PainPriest_NotifyGoblins(1);
SetEntityEvent(S_GOB_PainPriest_cad1854b-8f41-4038-b640-156ee0272f81, "GOB_PainPriest_Event_ResetPenance");
SetFlag(GOB_PainPriest_State_ReadyForNextPenance_4afe4a86-2dcb-409f-b83c-63d1bb4f570e, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(GOB_PainPriest_State_PostPlayerPenance_103d9832-d8e2-415d-bde0-6e2d1599c636, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
TextEvent("GOB_Debug_HappyTorturers_Equip", _, _, _, _)
THEN
Equip(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, GOB_TorturerSpear_e066f59a-4012-47f1-a6f3-646d0338ab5e);

IF
TextEvent("GOB_Debug_HappyTorturers_Unequip", _, _, _, _)
THEN
Unequip(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, GOB_TorturerSpear_e066f59a-4012-47f1-a6f3-646d0338ab5e);

IF
TextEvent("GOB_Debug_HappyTorturers_Adventurer_Rest", _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
DB_Dialogs(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, DEN_TorturedAdventurer_Resting_b2315435-5fda-8c48-38aa-231c448b758c);
SetHasDialog(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1);
SetFlag(GOB_TorturedAdventurer_State_Resting_75e6b157-74c3-4bb1-bba7-c8046cd1486d, NULL_00000000-0000-0000-0000-000000000000, 0);
TeleportTo(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, S_DEN_TorturedAdventurer_Idle_103f07fe-8c42-4e61-8f7f-3ecbd8a96cbb, "debug_tp", 0, 0, 0);
Use(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, S_DEN_TorturedAdventurer_IdleBedroll_0e3bf7f6-9c73-4dca-8728-ded6ef833f1c, "debug_use");
GoalCompleted;

IF
UseFinished(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, 1, _, _)
THEN
Lock(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, "GOB_HappyTorturers_ChainsKey");
DB_GOB_TortureRackLocked(1);

IF
FlagSet(GOB_DrowCommander_Event_CompromisedDen_1fe44eb2-5437-ed3b-5ab8-6244d7980593, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(GOB_Torturers_State_KnowDen_06207c03-9264-9790-99da-49b1df20be0c, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(GOB_Torturers_HasMet_Spike_d3beebd0-2192-ffe6-1ac7-695917560679, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFlag(GOB_TorturedAdventurer_HasMet_5a0a2a5d-08e2-6d7c-054a-0c7e8ccf574b, _Var1, 0);

PROC
PROC_GLO_DefeatCounter_AllPermaDefeated("GOB_HappyTorturers_Spike", _, _, _, _)
THEN
SetFlag(GOB_Torturers_State_SpikeIsDead_a9f8e52f-fa21-1731-ec55-81b3b64c79e1, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogActorJoined(DIALOGRESOURCEGUID_GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c, _, (CHARACTER)_Var2, _, _)
AND
DB_Players(_Var2, _, _, _, _)
THEN
SetFlag(GOB_Torturers_Seen_b74063f0-8eda-b39a-a126-ac774873b51c, _Var2);

IF
FlagSet(GOB_Torturers_Assisted_aee96e28-e049-0e55-b5d8-c001580de642, (CHARACTER)_Var1, (INTEGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(GOB_Torturers_State_KnowDen_06207c03-9264-9790-99da-49b1df20be0c, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_Torturers_AssistedForFun_cb21983f-223e-5678-77e8-814f03e1ed00, _Var1, _Var2);

IF
DialogStarted(DIALOGRESOURCEGUID_GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(GOB_Torturers_State_Seen_5f7ba9b7-1414-48f9-b527-0e7d75ea05a6, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(GOB_Torturers_Persuaded_80ef00ea-6c66-6922-605b-8aafe43c1859, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFlag(GOB_Torturers_State_Persuaded_d68ef3fa-08ba-52b9-8f39-7594dfde5c89, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(GOB_Torturers_State_Persuaded_d68ef3fa-08ba-52b9-8f39-7594dfde5c89, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PeacefulResolve(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f);
PROC_PeacefulResolve(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc);

PROC
PROC_LongRest()
AND
QRY_OnlyOnce("GOB_Torture_LongRestStateChange_OnlyOnce", _, _, _, _)
AND
GetFlag(GOB_Torturers_State_Seen_5f7ba9b7-1414-48f9-b527-0e7d75ea05a6, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
SetFlag(GOB_Torturers_State_AfterLongRest_78b07dee-8461-9d1b-028a-1e7cf8d39532, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_GOB_Torturers_AfterLongRest();

IF
Died(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _, _, _)
THEN
SetFlag(GOB_Torturers_State_PrisonerDied_6208091a-2462-4f0b-abd4-77890be39f11, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(GOB_CapturedGoblin_Event_Resolved_aae95a8b-bbec-e7c6-f47a-53834c294a2b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(GOB_Torturers_State_KnowDen_06207c03-9264-9790-99da-49b1df20be0c, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
EntityEvent(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_HappyTorturers_AdventurerRestrained", _, _, _)
THEN
ApplyStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TORTURED_BASE", -1, 1);
ApplyStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TORTURED_SCREAMING_ANIMATIONOVERRIDE", -1);

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TortureOverFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TORTURED_SCREAMING_ANIMATIONOVERRIDE");

IF
FlagSet(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TORTURED_SCREAMING_ANIMATIONOVERRIDE");
ApplyStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TORTURED_FAINTED_ANIMATIONOVERRIDE", -1, 1);

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_AdventurerFreedFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TORTURED_BASE");

IF
FlagCleared(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TORTURED_FAINTED_ANIMATIONOVERRIDE");

IF
FlagSet(GOB_BattleStations_Event_ToStation_03a8bd66-c23f-4989-9a7b-775cf475104b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_TriggerUnregisterForPlayers(S_GOB_Tortsurers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071);

IF
EnteredTrigger((CHARACTER)_Var1, S_GOB_Torturers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialogWithAvailableSpeakerInRange(GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c, S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var1, 15)
THEN
DB_NOOP(1);

IF
DialogStarted(GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_TriggerUnregisterForPlayers(S_GOB_Tortsurers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071);

PROC
PROC_GOB_Torturers_ReplaceDialogs()
AND NOT
DB_PermaDefeated(S_GOB_TortureredAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
DB_Dialogs(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, DIALOGRESOURCEGUID_GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3);

PROC
PROC_GOB_Torturers_ReplaceDialogs()
AND NOT
DB_PermaDefeated(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f);
DB_Dialogs(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, GOB_Torturers_Spike_c61cd5b1-391a-ae0d-b677-12378d024abe);

PROC
PROC_GOB_Torturers_ReplaceDialogs()
THEN
PROC_TriggerUnregisterForPlayers(S_GOB_Tortsurers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071);

IF
Unlocked(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_TortureRackLocked(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_HappyTortures_AdventurerShackledAndAwake()
THEN
PlaySound(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "SE_Tortured_Adventurer_Screams_Stop");

IF
HitpointsChanged(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, _, _, _, _)
AND
GetHitpoints(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, _Var2, _, _, _)
AND
_Var2 <= 0
AND
DB_GOB_TortureRackDestroyer(_Var3, _, _, _, _)
AND
QRY_GOB_HappyTortures_AdventurerShackledAndAwake()
THEN
PlaySound(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "SE_Tortured_Adventurer_Screams_Stop");

IF
DestroyingBy(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, _, _, _, (CHARACTER)_)
THEN
PlaySound(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "SE_Tortured_Adventurer_Screams_Stop");

IF
FlagSet(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
PlaySound(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "SE_Tortured_Adventurer_Screams_Stop");

IF
DialogEnded(DIALOGRESOURCEGUID_GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3, _, _, _, _)
AND
GetFlag(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
PlaySound(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "SE_Tortured_Adventurer_Screams_Stop");

PROC
PROC_GLO_DefeatCounter_AllPermaDefeated("GOB_HappyTorturers_Torturers", _, _, _, _)
THEN
SetFlag(GOB_Torturers_State_GoblinsDied_3fa02923-ca0b-4f87-9b2d-9f896b523343, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Defeated(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, _, _, _, _)
THEN
PROC_GOB_Torturers_ReplaceDialogs();

IF
DB_PermaDefeated(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _, _, _)
THEN
PROC_GOB_Torturers_ReplaceDialogs();

PROC
PROC_GOB_Torturers_AfterLongRest()
THEN
PROC_GOB_Torturers_MoveOut(0);

PROC
PROC_GOB_Torturers_AfterLongRest()
AND NOT
QRY_GOB_AdventurerFreedOrUnlocked()
THEN
PROC_SetHitpointsPercentage_BlockSelfHealing(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 25);
SetFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

QRY
QRY_GOB_AdventurerFreedOrUnlocked()
AND
DB_GlobalFlag(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_GOB_AdventurerFreedOrUnlocked()
AND
DB_GlobalFlag(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9, _, _, _, _)
THEN
DB_NOOP(1);

IF
FlagSet(GOB_TorturedAdventurer_Event_SoftOption_351539cc-1601-f5ba-d55d-515b8bd79993, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _, _)
AND
GetHitpointsPercentage(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var2, _, _, _)
AND
RealSubtract(_Var2, 15, _Var3, _, _)
THEN
PROC_SetHitpointsPercentage_BlockSelfHealing(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var3);
PROC_GOB_Torturers_CheckKilled();

IF
FlagSet(GOB_TorturedAdventurer_Event_HardOption_26cf8dbf-0110-0681-bfff-f874c5b2dc07, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _, _)
AND
GetHitpointsPercentage(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var2, _, _, _)
AND
RealSubtract(_Var2, 25, _Var3, _, _)
THEN
PROC_SetHitpointsPercentage_BlockSelfHealing(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var3);
PROC_GOB_Torturers_CheckKilled();

PROC
PROC_GOB_Torturers_CheckKilled()
AND
DB_PermaDefeated(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _, _, _)
THEN
PROC_GOB_TorturedAdventurer_RemoveFromDialog();

PROC
PROC_GOB_TorturedAdventurer_RemoveFromDialog()
AND
DB_DialogNPCs(_Var1, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _Var1, _Var1)
AND
DialogRemoveActorFromDialog(_Var1, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagCleared(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, _, _)
AND
HasActiveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_OUT", 1, _, _)
THEN
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_OUT");
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_DOWN_INSTANT");

IF
StatusRemoved(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_OUT", _, _, _)
AND
GetFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1, _, _)
THEN
ClearFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

IF
StatusRemoved(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_OUT", _, _, _)
AND
HasActiveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_DOWN_INSTANT", 1, _, _)
THEN
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_DOWN_INSTANT");

IF
FlagSet(GOB_BattleStations_Event_ToStation_03a8bd66-c23f-4989-9a7b-775cf475104b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GOB_Torturers_MoveOut(0);

IF
FlagSet(GOB_HappyTorturers_Event_ClearSpearOwnership_be662c90-b121-8981-9c94-597bdfa07c56, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearOwnership(GOB_TorturerSpear_e066f59a-4012-47f1-a6f3-646d0338ab5e);

PROC
PROC_GlobalFlagReactionAfterDialog(GOB_Torturers_State_Persuaded_d68ef3fa-08ba-52b9-8f39-7594dfde5c89, _, _, _, _)
THEN
PROC_GOB_Torturers_MoveOut(1);

PROC
PROC_GlobalFlagReactionAfterDialog(GOB_Torturers_State_TorturedEnough_5ee00add-a8c8-4d61-4560-80582db6fe58, _, _, _, _)
THEN
PROC_GOB_Torturers_MoveOut(1);

PROC
PROC_GOB_Torturers_MoveOut((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_GOB_Torturers_ReplaceDialogs();
SetFlag(GOB_Torturers_State_MovedOut_a20ec730-dfec-56a7-6cc3-71ff51e16502, CHARACTERGUID_S_GOB_Torturers_Rat_000_ccde6943-0165-4885-b888-b4e44c8054bc, 0);
SetFlag(GOB_Torturers_State_MovedOut_a20ec730-dfec-56a7-6cc3-71ff51e16502, CHARACTERGUID_S_GOB_Torturers_Rat_001_720df859-7592-4f34-9000-1a2c0a313b94, 0);

PROC
PROC_GOB_Torturers_MoveOut(1, _, _, _, _)
THEN
TimerLaunch("GOB_Torturers_Timer_AD_Delay", 300);

IF
TimerFinished("GOB_Torturers_Timer_AD_Delay", _, _, _, _)
THEN
PROC_TryStartAD(DIALOGGUID_GOB_Torturers_MoveOut_AD_2c3e8fc9-2dd1-7397-0880-4c3dd25af147, S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f);

IF
FlagSet(GOB_Torturers_Hostile_a84f8147-fbc2-de26-5149-61147843f2eb, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_SetHostileToIndivPlayerFaction(ACT1_GOB_Torturers_8a9e7e9a-1e72-eed1-8175-6c8d50ef7372, _Var1);

IF
AttackedBy(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, (CHARACTER)_Var1, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, _, _Var1, _Var1, _Var1)
THEN
PROC_SetHostileToIndivPlayerFaction(ACT1_GOB_Torturers_8a9e7e9a-1e72-eed1-8175-6c8d50ef7372, _Var1);

QRY
QRY_GOB_HappyTortures_AdventurerShackledAndAwake()
AND NOT
DB_GlobalFlag(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9, _, _, _, _)
AND
GetFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 0, _, _)
THEN
DB_NOOP(1);

IF
Unlocked(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_TortureRackLocked(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_HappyTortures_AdventurerShackledAndAwake()
THEN
PROC_GlobalSetFlagAndCache(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9);
SetFlag(GOB_Torturers_Liberator_f14fc1ce-62c5-4eaa-a4c1-26c53daa8ef1, _Var1);

IF
AttackedBy(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var2, _, _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_GetCharacterOwnerIfItemSummon(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_GetCharacterOwnerIfItemSummon(_Var7, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var7, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_TortureRackDestroyer(_Var7);

IF
DB_GOB_TortureRackDestroyer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_TortureRackDestroyer(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
THEN
NOT DB_GOB_TortureRackDestroyer(_Var2);

IF
HitpointsChanged(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, _, _, _, _)
AND
GetHitpoints(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, _Var2, _, _, _)
AND
_Var2 <= 0
AND
DB_GOB_TortureRackDestroyer(_Var3, _, _, _, _)
AND
QRY_GOB_HappyTortures_AdventurerShackledAndAwake()
THEN
SetFlag(GOB_Torturers_Liberator_f14fc1ce-62c5-4eaa-a4c1-26c53daa8ef1, _Var3);
PROC_GlobalSetFlagAndCache(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977);

IF
DestroyingBy(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, _, _, _, (CHARACTER)_)
THEN
PROC_GlobalSetFlagAndCache(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977);

IF
FlagSet(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
Unlock(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6);

IF
Unlocked(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TortureRackLocked(1, _Var1, _Var1, _Var1, _Var1)
THEN
SetDisableUse(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, 1);
PROC_GlobalSetFlagAndCache(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977);

IF
FlagCleared(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, _, _, _, _)
AND
GetFlag(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
PROC_GlobalSetFlagAndCache(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9);

IF
FlagSet(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977, _, _, _, _)
AND
GetFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 0, _, _)
THEN
PROC_GlobalSetFlagAndCache(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9);

IF
FlagSet(GOB_Torturers_Liberator_f14fc1ce-62c5-4eaa-a4c1-26c53daa8ef1, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsInDialogRange(_Var1, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var1, _Var1, _Var1)
AND
QRY_StartDialogWithAvailableSpeakerInRange(DIALOGRESOURCEGUID_GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var1, 10, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DebugText(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "Unlocked");

IF
FlagSet(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977, _, _, _, _)
AND
QRY_GOB_AdventurerFaintedOrKnockedOut()
THEN
DebugText(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "Should lie");
ApplyStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_DOWN_INSTANT", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_GOB_AdventurerFaintedOrKnockedOut()
AND
GetFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1, _, _)
THEN
DB_NOOP(1);

QRY
QRY_GOB_AdventurerFaintedOrKnockedOut()
AND
HasActiveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_OUT", 1, _, _)
THEN
DB_NOOP(1);

IF
DialogEnded(DIALOGRESOURCEGUID_GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3, _, _, _, _)
AND
GetFlag(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
Unlock(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6);
PROC_GOB_TorturedAdventurer_DashOff();

IF
DestroyedBy(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, _, (CHARACTER)_Var2, _, (CHARACTER)_)
THEN
SetFlag(GOB_Torturers_Liberator_f14fc1ce-62c5-4eaa-a4c1-26c53daa8ef1, _Var2);

PROC
PROC_GOB_TorturedAdventurer_DashOff()
THEN
DebugText(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "running away");
GoalCompleted;

IF
FlagSet(GOB_TorturedAdventurer_Event_RemoveLockpick_f573673e-6fbd-4133-b0eb-57b4a4fa2206, _, (INTEGER)_Var2, _, _)
AND
DialogGetInvolvedPlayer(_Var2, 1, _Var3, _, _)
THEN
MagicPocketsDestroyLocalItemsByTag(_Var3, "LOCKPICKS_1013e720-9b0f-4783-8686-9b5506840088", 1);
ClearFlag(GOB_TorturedAdventurer_Event_RemoveLockpick_f573673e-6fbd-4133-b0eb-57b4a4fa2206, _Var3, 0);
PROC_GOB_TorturedAdventurer_CheckLockpicks(_Var3);

IF
FlagSet(GOB_TorturedAdventurer_Event_RemoveHealingPot_b75474b5-8741-4486-8a11-ee734b7d2290, _, (INTEGER)_Var2, _, _)
AND
DialogGetInvolvedPlayer(_Var2, 1, _Var3, _, _)
THEN
MagicPocketsDestroyLocalItemsByTag(_Var3, "HEALING_POTION_1879a93d-2edf-4f54-85dd-81a3724d677f", 1);

IF
StatusApplied(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, (STRING)_Var1, (GUIDSTRING)_Var2, _, (STRING)_Var1)
AND
QRY_IsHealingStatus(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_TorturedAdventurer_CheckRemoveKO()
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialogWithAvailableSpeakerInRange(GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var2, 10, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_GOB_TorturedAdventurer_CheckRemoveKO()
AND
GetFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1, _, _)
THEN
ClearFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 0);
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_OUT");
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "KNOCKED_DOWN");

PROC
PROC_DialogFlagSetup(GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_GOB_TorturedAdventurer_CheckLockpicks(_Var1);

PROC
PROC_DialogFlagSetup(GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_TaggedItemInMagicPockets(_Var1, "HEALING_POTION_1879a93d-2edf-4f54-85dd-81a3724d677f", _Var1, _Var1, _Var1)
THEN
SetFlag(Has_TaggedItem_HEALING_POTION_af0f38a4-183d-2c1f-aa3f-6652acb89fe0, _Var1, 0);

PROC
PROC_GOB_TorturedAdventurer_CheckLockpicks((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_TaggedItemInMagicPockets(_Var1, "LOCKPICKS_1013e720-9b0f-4783-8686-9b5506840088", _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_TorturedAdventurer_HasLockpick_cd56e778-ebf6-4f86-b6b0-fdc38318cb2e, _Var1, 0);

PROC
PROC_GOB_TorturedAdventurer_CheckLockpicks((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_TaggedItemInMagicPockets(_Var1, "LOCKPICKS_1013e720-9b0f-4783-8686-9b5506840088", _Var1, _Var1, _Var1)
THEN
ClearFlag(GOB_TorturedAdventurer_HasLockpick_cd56e778-ebf6-4f86-b6b0-fdc38318cb2e, _Var1, 0);

IF
DialogEnded(GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DialogGetInvolvedPlayer(_Var1, 1, _Var2, _Var1, _Var1)
THEN
ClearFlag(GOB_TorturedAdventurer_HasLockpick_cd56e778-ebf6-4f86-b6b0-fdc38318cb2e, _Var2, 0);
ClearFlag(Has_TaggedItem_HEALING_POTION_af0f38a4-183d-2c1f-aa3f-6652acb89fe0, _Var2, 0);

IF
FlagSet(GOB_TorturedAdventurer_State_Free_7feb23c9-0263-4ee0-913c-8c70a55306f7, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
NOT DB_PreventKnockedOutPermaDefeated(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

QRY
QRY_CheckOtherUsersInTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
_Var3 != _Var1
AND
DB_InRegion(_Var3, _Var2, _Var1, _Var1, _Var1)
AND NOT
QRY_SameUser(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
LeftTrigger((CHARACTER)_Var1, S_GOB_Tortsurers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_HappyTortures_AdventurerShackledAndAwake()
AND NOT
QRY_CheckOtherUsersInTrigger(_Var1, S_GOB_Tortsurers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071, _Var1, _Var1, _Var1)
THEN
PROC_GOB_TorturedAdventurer_AD_FlagSetup(_Var1);

PROC
PROC_GOB_TorturedAdventurer_AD_FlagSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(GOB_TorturedAdventurer_PromisedToFree_6c9ae7fc-7434-c475-b1e8-535cf738a7df, _Var1, 1, _Var1, _Var1)
THEN
SetFlag(GOB_TorturedAdventurer_GoodAD_eb6d0f24-7d2c-56a4-36cd-e794987f4bda, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

PROC
PROC_GOB_TorturedAdventurer_AD_FlagSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(GOB_TorturedAdventurer_LeftInChains_94987d71-bd64-df88-25b8-12ddf2d50d82, _Var1, 1, _Var1, _Var1)
THEN
SetFlag(GOB_TorturedAdventurer_BadAD_ae07b833-67a3-08d6-662a-618c8739c9cb, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

PROC
PROC_GOB_TorturedAdventurer_AD_FlagSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GOB_HappyTorturers_Adventurer_ShouldCallHelp()
AND
GetFlag(GOB_TorturedAdventurer_State_FailedPersuasion_1891e9e4-4aff-47f3-a874-048f24022d04, NULL_00000000-0000-0000-0000-000000000000, 0, _Var1, _Var1)
THEN
PROC_TryStartAD(DIALOGRESOURCEGUID_GOB_TorturedAdventurer_AD_CryForHelp_8a4790a3-2bc2-732e-2003-d4e01a5b679a, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

QRY
QRY_GOB_HappyTorturers_Adventurer_ShouldCallHelp()
AND
DB_GlobalFlag(GOB_Torturers_State_Persuaded_d68ef3fa-08ba-52b9-8f39-7594dfde5c89, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_GOB_HappyTorturers_Adventurer_ShouldCallHelp()
AND
DB_GlobalFlag(GOB_Torturers_State_TorturedEnough_5ee00add-a8c8-4d61-4560-80582db6fe58, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_GOB_HappyTorturers_Adventurer_ShouldCallHelp()
AND
DB_Defeated(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, _, _, _, _)
AND
DB_Defeated(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, _, _, _, _)
THEN
DB_NOOP(1);

IF
AutomatedDialogRequestFailed(DIALOGRESOURCEGUID_GOB_TorturedAdventurer_AD_CryForHelp_8a4790a3-2bc2-732e-2003-d4e01a5b679a, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
ClearFlag(GOB_TorturedAdventurer_BadAD_ae07b833-67a3-08d6-662a-618c8739c9cb, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
ClearFlag(GOB_TorturedAdventurer_GoodAD_eb6d0f24-7d2c-56a4-36cd-e794987f4bda, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

IF
DialogActorLeft(DIALOGRESOURCEGUID_GOB_TorturedAdventurer_AD_CryForHelp_8a4790a3-2bc2-732e-2003-d4e01a5b679a, _, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _, (INTEGER)_)
THEN
ClearFlag(GOB_TorturedAdventurer_BadAD_ae07b833-67a3-08d6-662a-618c8739c9cb, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);
ClearFlag(GOB_TorturedAdventurer_GoodAD_eb6d0f24-7d2c-56a4-36cd-e794987f4bda, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, (STRING)_Var2, (GUIDSTRING)_Var3, (CHARACTER)_Var4, _)
AND
_Var4 == S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847
AND
QRY_CRIME_IsCrimeFamilyMember(_Var2, "Murder", _Var1, _Var1, _Var1)
THEN
PROC_CharacterRegisterCrime(_Var1, "GOB_HappyTorturers_CustomMurder", _Var3, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 0);
DebugText(_Var1, "GOB_HappyTorturers_CustomMurder");

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, (STRING)_Var2, (GUIDSTRING)_Var3, (CHARACTER)_Var4, _)
AND
_Var4 == S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847
AND
QRY_CRIME_IsCrimeFamilyMember(_Var2, "Assault", _Var1, _Var1, _Var1)
AND
QRY_GOB_HappyTorturers_ShouldTriggerScene(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c, S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, _Var1, _Var1)
THEN
SetFlag(GOB_HappyTorturers_Assaulted_97dfba06-5e5a-8f1f-25db-7cc270cbd0d8, NULL_00000000-0000-0000-0000-000000000000, 0);

QRY
QRY_GOB_HappyTorturers_ShouldTriggerScene((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_TorturersSeeCriminal(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Torturers_State_TorturedEnough_5ee00add-a8c8-4d61-4560-80582db6fe58, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_TorturedAdventurer_State_Faint_1b34f04f-919a-8b6e-1cd4-39b2d003504c, S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 0, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_GOB_TorturersSeeCriminal((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Sees(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_GOB_TorturersSeeCriminal((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Sees(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DialogEnded(GOB_Torturers_Torture_66404335-c54e-5e67-3fb6-e85535b96e9c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
ClearFlag(GOB_HappyTorturers_Assaulted_97dfba06-5e5a-8f1f-25db-7cc270cbd0d8, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(GOB_TorturedAdventurer_State_Unlocked_34dbc4e3-6fdf-4154-aa2b-d51b553b3977, _, _, _, _)
AND NOT
GetHitpoints(S_GOB_HappyTorturers_TortureRack_dae2b64c-f4c3-4e44-bc57-1a17ad17d3a6, 0, _, _, _)
AND
IsReposedSitting(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, 1, _, _, _)
THEN
EndRepose(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847);

PROC
PROC_LevelLoadedOnce("BGO_Main_A", _, _, _, _)
THEN
GoalCompleted;

IF
FlagSet(GOB_TorturedAdventurer_State_Free_7feb23c9-0263-4ee0-913c-8c70a55306f7, _, _, _, _)
AND
DB_GlobalFlag(GOB_Torturers_State_Out_699e3e91-4b12-433e-ab95-fc37b9dcae90, _, _, _, _)
THEN
GoalCompleted;


EXITSECTION
NOT DB_OneTimeEventFlag(GOB_TorturedAdventurer_Event_Faint_dbeb939c-2e1d-4242-8524-2f82a0572b16);
RemoveStatus(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, "GOB_TIEDTOTORTURERACK");
SysClear("DB_GOB_Torturers_States", 1);
NOT DB_KilledEvent(S_GOB_Torturers_Spike_3f1fa953-6a0d-4589-adfd-23c69603da2f, GOB_Torturers_KilledSpike_64863f03-e538-451d-86ab-5ce8684cf175);
NOT DB_KilledEvent(S_GOB_Torturers_Goblet_0f18201e-2836-4642-8a26-d0a6e1a8a8cc, GOB_Torturers_KilledGoblet_f3afc968-d6e8-46a4-aea3-fc06981554a1);
NOT DB_KilledEvent(S_GOB_TorturedAdventurer_0dd6e9f1-d32d-41f1-b230-d540558e0847, GOB_Torturers_KilledPrisoner_ecb838c2-26fe-4b78-ba28-b307b8e9aa19);
NOT DB_GlobalFlagReactionAfterDialog(GOB_Torturers_State_PrisonerFreed_c3ebd7d6-243c-f355-5cff-94ceb315d5c9, DIALOGRESOURCEGUID_GOB_TorturedAdventurer_70f76b90-009e-b95a-0e76-65cc8eff73d3);
PROC_TriggerUnRegisterForPlayers(S_GOB_Tortsurers_DialogStartTrigger_aceaceca-245c-44b2-bbd3-48a2bd6ab071);
PROC_TriggerUnregisterForPlayers(S_GOB_HappyTorturers_TortureScreamsRegion_0d98abd3-4d8a-4948-9cd9-d2ef581b3b53);
ENDEXITSECTION

ParentTargetEdge "Act1"
