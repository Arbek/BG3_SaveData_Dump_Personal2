Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_LOW_HighberrysRitualPerformedItems(S_LOW_HighberrysHouse_SymbolOfTheAbsolute_d605e3e1-9f1b-477c-92cb-f6e73ddf984a);
DB_LOW_HighberrysRitualPerformedCharacters(S_LOW_SerialKiller_WineFestivalCivilian004_ce407b77-4218-4a8e-b5c8-399ee2aeffa4, S_LOW_HighberrysHouse_TP_WineFestivalCivilian004_3e2765c6-f85e-4cc7-ad77-e0184ed7e805);
DB_LOW_HighberrysRitualPerformedCharacters(S_LOW_SerialKiller_WineFestivalCivilian001_6d7ef189-307e-4b7a-8c3c-be0c4031b18c, S_LOW_HighberrysHouse_TP_WineFestivalCivilian001_7b15cd40-328d-4e4f-8f49-3b90ce7ec840);
DB_LOW_HighberrysRitualPerformedCharacters(S_LOW_SerialKiller_WineFestivalCivilian002_4396e623-f09b-4599-91f3-63900a0c3382, S_LOW_HighberrysHouse_TP_WineFestivalCivilian002_e6bf0c77-2099-4ec0-b488-43506a5cd0c0);
DB_LOW_HighberrysRitualPerformedCharacters(S_LOW_SerialKiller_WineFestivalCivilian003_3a893643-8e1f-4b14-ae7a-d0a8e868d5de, S_LOW_HighberrysHouse_TP_WineFestivalCivilian003_a78a48a6-1cd7-45e8-a64b-269d12f2214f);
DB_LOW_HighberrysRitualPerformedCharacters(S_LOW_SerialKiller_WineFestivalCivilian005_e6f2dd59-7fee-4ae7-a913-940ceef7fb52, S_LOW_HighberrysHouse_TP_WineFestivalCivilian005_4827f790-9b61-4ff7-bf08-066804cd2e89);
DB_LOW_HighberrysRitualPerformedCharacters(S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c, S_LOW_HighberrysHouse_ElfsongGuard1TP_fb0a9310-b017-4a38-8365-d89f3751b72f);
DB_LOW_HighberrysRitualPerformedCharacters(S_LOW_Elfsong_FlamingFist_002_971f5890-e0ae-49ef-9a04-5e69ebdf8159, S_LOW_HighberrysHouse_ElfsongGuard2TP_a3381125-4c09-4a6c-a354-0d6b8cc92a68);
DB_DeadEvent(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, LOW_SerialKiller_State_Cora_IsDead_d9ad6998-183f-4769-a2e0-3dac19962774);
DB_LOW_WineFestivalAttendants(S_LOW_SerialKiller_WineFestivalCivilian001_6d7ef189-307e-4b7a-8c3c-be0c4031b18c, LOW_SerialKiller_WineFestivalCivilian001_953245f3-ad92-29f8-e936-da3e27e83859);
DB_LOW_WineFestivalAttendants(S_LOW_SerialKiller_WineFestivalCivilian002_4396e623-f09b-4599-91f3-63900a0c3382, LOW_SerialKiller_WineFestivalCivilian002_760ef8a1-dd76-bf25-a4ad-678a5f89be73);
DB_LOW_WineFestivalAttendants(S_LOW_SerialKiller_WineFestivalCivilian004_ce407b77-4218-4a8e-b5c8-399ee2aeffa4, LOW_SerialKiller_WineFestivalCivilian004_3b7c221e-5a13-9a15-99d9-ae719789f854);
DB_LOW_WineFestivalAttendants(S_LOW_SerialKiller_WineFestivalCivilian003_3a893643-8e1f-4b14-ae7a-d0a8e868d5de, LOW_SerialKiller_WineFestivalCivilian003_d0d5df57-3325-2be3-7e1f-ff682e940af6);
DB_LOW_WineFestivalAttendants(S_LOW_SerialKiller_WineFestivalCivilian005_e6f2dd59-7fee-4ae7-a913-940ceef7fb52, LOW_SerialKiller_WineFestivalCivilian005_b60da820-8667-0365-df09-fee7f9309059);
DB_LOW_WineFestivalAttendants(S_LOW_SerialKiller_Ontur_74319ba4-80de-44ab-b254-3920195fbeef, LOW_SerialKiller_Ontur_da21ad8d-f64f-19c9-615f-df899ddfb15c);
DB_LOW_WineFestivalAttendants(S_LOW_SerialKiller_Flaerith_381a8770-5f64-454b-aa6f-ef8c57341c57, LOW_SerialKiller_Flaerith_fa5fe769-f244-2099-774b-76b3f792adad);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_BsG_CTZN_Talk_041_5dbfe603-d556-45cc-9ce4-d4e69570261f);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_BsG_CTZN_TalkREAC_041_b0b332fa-a695-4c0c-9570-5b2587547406);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_BsG_CTZN_TalkREAC_013_6d96d389-1369-4001-9709-0f3df05f8cb2);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_BsG_CTZN_Talk_013_d1cd637a-209e-46a4-81aa-a765a6835b16);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_ELFout_CTZN_TalkREAC_002_1a08ce6d-d588-408a-ad43-44745622c200);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_ELFout_CTZN_Talk_002_369a3744-c7d1-45bb-96d4-4191449bff47);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_BsG_CTZN_TalkREAC_014_c4d6088f-8fb5-44c2-a333-75bfef06ce3d);
DB_LOW_SerialKiller_WineFestivalCrowds(CCT_BsG_CTZN_Talk_014_d969ecb0-f2f9-4a08-84f1-90d12de7805c);
DB_LOW_DolorAndDoppelgangers(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, NULL_00000000-0000-0000-0000-000000000000, LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6);
DB_LOW_DolorAndDoppelgangers(S_LOW_SerialKiller_Doppelganger_001_108c54a2-b364-4da0-bfc7-15bd5a8f39f2, LOW_SerialKiller_DoppelgangerFemaleHuman_46aef1d8-e4e3-4443-8aba-d0370955db65, LOW_SerialKiller_Doppelganger_001_1ef275fb-854c-da96-3494-18228475fe2f);
DB_LOW_DolorAndDoppelgangers(S_LOW_SerialKiller_Doppelganger_002_41041cc2-d15c-4ea2-be5e-124a9e59a62c, LOW_SerialKiller_DoppelgangerHumanMale_e298d305-6359-4b61-be1f-9cb23b84c83f, LOW_SerialKiller_Doppelganger_002_557c6ecc-59a2-43bd-dbeb-af1b8c3c1cb0);
DB_LOW_DolorAndDoppelgangers(S_LOW_SerialKiller_Doppelganger_000_cb2bca61-95a9-4ce4-8bea-687682f95fb5, LOW_SerialKiller_DoppelgangerMaleHighElf_1ae83841-61ec-40a0-8b9a-4a78d7392ee4, LOW_SerialKiller_Doppelganger_000_d2979aa4-d03f-81ef-b304-a95474705acb);
DB_LOW_DolorAndDoppelgangers(S_LOW_SerialKiller_Doppelganger_003_64279955-a165-4a43-9b8b-64325e925300, LOW_SerialKiller_Doppelganger_DwarvenFemale_2fbd9480-e136-4d45-b0ec-ee83c225f8aa, LOW_SerialKiller_Doppelganger_003_fa9b5d31-3e33-798f-2f99-bff238294396);
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_WineFestivalCivilian00e3_3a893643-8e1f-4b14-ae7a-d0a8e868d5de, S_LOW_SerialKiller_WF_Group1_001_017eee3b-5ed7-4b4c-88c1-ce328bf596fc, S_LOW_SerialKiller_WF_AppearingPoint_001_dfb3ebb8-81d9-43fa-96ac-1461ab69b7a5, "Civilian");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_WineFestivalCivilian005_e6f2dd59-7fee-4ae7-a913-940ceef7fb52, S_LOW_SerialKiller_WF_Group1_002_153725e3-ac85-43dd-8645-f03989f43d5f, S_LOW_SerialKiller_WF_AppearingPoint_001_dfb3ebb8-81d9-43fa-96ac-1461ab69b7a5, "Civilian");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_Doppelganger_001_108c54a2-b364-4da0-bfc7-15bd5a8f39f2, S_LOW_SerialKiller_WF_Group2_001_5ff9ad23-54c5-4d54-ba35-a7e319263b5b, S_LOW_SerialKiller_WF_AppearingPoint_002_d23f851d-0d72-41b6-a9ed-b1ef1bd98e23, "Murderer");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_Doppelganger_003_64279955-a165-4a43-9b8b-64325e925300, S_LOW_SerialKiller_WF_Group2_002_6b41d41e-c443-4014-9257-0811513c27ba, S_LOW_SerialKiller_WF_AppearingPoint_002_d23f851d-0d72-41b6-a9ed-b1ef1bd98e23, "Murderer");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_Doppelganger_000_cb2bca61-95a9-4ce4-8bea-687682f95fb5, S_LOW_SerialKiller_WF_Group2_003_e8e59b8a-7a26-41b5-a5fc-eb508f98d59e, S_LOW_SerialKiller_WF_AppearingPoint_002_d23f851d-0d72-41b6-a9ed-b1ef1bd98e23, "Murderer");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_WineFestivalCivilian004_ce407b77-4218-4a8e-b5c8-399ee2aeffa4, S_LOW_SerialKiller_WF_Group3_001_9893c43c-1114-41a8-8385-cf97c098c54c, S_LOW_SerialKiller_WF_AppearingPoint_003_8b7bf829-4e1a-4864-b00e-9a604c5825e6, "Civilian");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_WineFestivalCivilian001_6d7ef189-307e-4b7a-8c3c-be0c4031b18c, S_LOW_SerialKiller_WF_Group3_002_aaa8ab66-3482-48d1-887f-b07e44c2cb89, S_LOW_SerialKiller_WF_AppearingPoint_003_8b7bf829-4e1a-4864-b00e-9a604c5825e6, "Civilian");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_WineFestivalCivilian002_4396e623-f09b-4599-91f3-63900a0c3382, S_LOW_SerialKiller_WF_Group3_003_8674e82c-97d4-4eac-884d-0b4eab7ac185, S_LOW_SerialKiller_WF_AppearingPoint_003_8b7bf829-4e1a-4864-b00e-9a604c5825e6, "Civilian");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_SerialKiller_WF_Group4_002_d899ba08-c3da-42ec-bf35-00e35be6e7a0, S_LOW_SerialKiller_WF_AppearingPoint_004_adbf1761-48bb-4004-98a9-26c86c5ce336, "Murderer");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_Doppelganger_002_41041cc2-d15c-4ea2-be5e-124a9e59a62c, S_LOW_SerialKiller_WF_Group4_001_918264ba-5715-4f9c-af6f-13c2ee9c3515, S_LOW_SerialKiller_WF_AppearingPoint_004_adbf1761-48bb-4004-98a9-26c86c5ce336, "Murderer");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_Flaerith_381a8770-5f64-454b-aa6f-ef8c57341c57, S_LOW_SerialKiller_WF_Group5_001_86873387-2cda-4515-b502-ce67617e00be, S_LOW_SerialKiller_WF_AppearingPoint_001_dfb3ebb8-81d9-43fa-96ac-1461ab69b7a5, "Civilian");
DB_LOW_SerialKiller_WineFestivalPositions(S_LOW_SerialKiller_Ontur_74319ba4-80de-44ab-b254-3920195fbeef, S_LOW_SerialKiller_WF_Group5_002_7cb4c3a6-83f5-4009-87d1-9fc85f99910e, S_LOW_SerialKiller_WF_AppearingPoint_003_8b7bf829-4e1a-4864-b00e-9a604c5825e6, "Civilian");
DB_LOW_SerialKiller_FlagsDrinkingWine(LOW_SerialKiller_Event_WineParalysis_Roger_54acda90-91d7-4937-a135-016df472f4ad);
DB_LOW_SerialKiller_FlagsDrinkingWine(LOW_SerialKiller_Event_WineParalysis_Cora_bf9e54bf-d2ce-4837-9f79-948ee5314133);
DB_LOW_SerialKiller_TheHighberrys(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679);
DB_LOW_SerialKiller_TheHighberrys(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);
PROC_TriggerRegisterForParty(S_LOW_SerialKiller_VisitWineFestival_f5419edc-b46c-4f87-9853-eaf67eaefa23);
DB_Dialogs(S_LOW_SerialKiller_WineFestivalWorker01_07663ad2-237c-4d11-9b55-fac1ac8e90ee, LOW_SerialKiller_WineFestivalWorker01_2d3475a3-ae3f-b102-3007-1ac771627114);
DB_Dialogs(S_LOW_SerialKiller_WineFestivalWorker02_42b6e6f1-07c5-4914-a434-75607aa24b6b, LOW_SerialKiller_WineFestivalWorker02_ef2b97a5-d235-2c49-0574-96fe6ca138e9);
DB_Dialogs(S_LOW_SerialKiller_RefugeeChild_001_284d96e2-b6a8-4766-85d1-57037efdd5ad, LOW_SerialKiller_RefugeeChild_001_dc11e092-8030-da71-1e0d-db07d60b78b4);
DB_Dialogs(S_LOW_SerialKiller_RefugeeChild_002_ae92b3ce-4cdd-47bc-866c-80c46d443114, LOW_SerialKiller_RefugeeChild_002_cddfb5c6-9404-dba2-d5ec-9947377894ed);
DB_LOW_SerialKiller_WineFestivalADs(LOW_SerialKiller_AD_WineFestivalChatter_002_39041a40-2400-cef3-cc36-9f90a736caff, S_LOW_SerialKiller_WineFestivalCivilian004_ce407b77-4218-4a8e-b5c8-399ee2aeffa4, S_LOW_SerialKiller_WineFestivalCivilian001_6d7ef189-307e-4b7a-8c3c-be0c4031b18c, S_LOW_SerialKiller_WineFestivalCivilian002_4396e623-f09b-4599-91f3-63900a0c3382, 1);
DB_LOW_SerialKiller_WineFestivalADs(LOW_SerialKiller_AD_WineFestivalChatter_003_abb50d86-2074-d5cd-7ce6-0aa002864c65, S_LOW_SerialKiller_Flaerith_381a8770-5f64-454b-aa6f-ef8c57341c57, S_LOW_SerialKiller_Ontur_74319ba4-80de-44ab-b254-3920195fbeef, S_LOW_SerialKiller_WineFestivalWorker01_07663ad2-237c-4d11-9b55-fac1ac8e90ee, 2);
DB_LOW_SerialKiller_WineFestivalADs(LOW_SerialKiller_AD_WineFestivalChatter_004_e0b93fdf-ba51-1c98-a797-a45c9e8ef6b6, S_LOW_SerialKiller_WineFestivalWorker02_42b6e6f1-07c5-4914-a434-75607aa24b6b, S_LOW_SerialKiller_WineFestivalCivilian003_3a893643-8e1f-4b14-ae7a-d0a8e868d5de, S_LOW_SerialKiller_WineFestivalCivilian005_e6f2dd59-7fee-4ae7-a913-940ceef7fb52, 3);
DB_LOW_SerialKiller_WineFestivalADs(LOW_SerialKiller_AD_WineFestivalChatter_001_c5e61941-1a45-0082-02a6-c865df953956, S_LOW_SerialKiller_Doppelganger_000_cb2bca61-95a9-4ce4-8bea-687682f95fb5, S_LOW_SerialKiller_Doppelganger_001_108c54a2-b364-4da0-bfc7-15bd5a8f39f2, S_LOW_SerialKiller_Doppelganger_003_64279955-a165-4a43-9b8b-64325e925300, 4);
DB_LOW_SerialKiller_WineFestivalADs(LOW_SerialKiller_AD_WineFestivalChatter_005_57c27c2f-8410-9f84-73a1-14f5b0eda11f, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, 5);
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(1);
DB_LOW_SerialKiller_ReproduceEscapePAD(NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
PROC_LOW_HighberrysHouse_NotMurderer_BothAlive();
PROC_LOW_CheckMissionTriggered();
ToInventory(S_LOW_DolorBag_43404e7f-b5a9-491d-b0ef-f3fc7f002229, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, 1, 0, 1);
DB_DialogMoneyTransfer(1, LOW_HighberrysHouse_WithoutMurderer_547725be-0fc8-c4c0-45bb-ab694a8732f2, 500, 3);
DB_Children(S_LOW_SerialKiller_RefugeeChild_001_284d96e2-b6a8-4766-85d1-57037efdd5ad);
DB_Children(S_LOW_SerialKiller_RefugeeChild_002_ae92b3ce-4cdd-47bc-866c-80c46d443114);
DB_SerialKiller_OrphanChilds(S_LOW_SerialKiller_RefugeeChild_001_284d96e2-b6a8-4766-85d1-57037efdd5ad);
DB_SerialKiller_OrphanChilds(S_LOW_SerialKiller_RefugeeChild_002_ae92b3ce-4cdd-47bc-866c-80c46d443114);
DB_ItemOwnerShipTriggers("CTY_Main_A", S_LOW_HighberrysHouse_Ownership_32048e8f-4afe-4f60-8e8c-0ac333a2217d, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);

KBSECTION
PROC
PROC_LOW_HighberrysHouse_NotMurderer_BothAlive()
AND NOT
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
THEN
PROC_LOW_HighberrysHouse_ShowRitualItems(0);
PROC_LOW_ShowAttendantsWineFestival(0);
PROC_LOW_ShowDolorAndDoppelgangers(0);
DB_Dialogs(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, LOW_HighberrysHouse_WithoutMurderer_547725be-0fc8-c4c0-45bb-ab694a8732f2);

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_SerialKiller_VisitWineFestival_f5419edc-b46c-4f87-9853-eaf67eaefa23, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_WineFestivalWorkers", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SerialKiller_AD_WineFestivalWorkers_dc5891d9-75b9-8969-767f-dfb54ead8b70, S_LOW_SerialKiller_WineFestivalWorker02_42b6e6f1-07c5-4914-a434-75607aa24b6b, S_LOW_SerialKiller_WineFestivalWorker01_07663ad2-237c-4d11-9b55-fac1ac8e90ee);

IF
AutomatedDialogEnded(LOW_SerialKiller_AD_WineFestivalWorkers_dc5891d9-75b9-8969-767f-dfb54ead8b70, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_OnlyOnce_Reset("LOW_WineFestivalWorkers", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5, _, _, _, _)
THEN
PROC_RemoveDialog(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);
DB_Dialogs(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, LOW_HighberrysHouse_OnlyRoger_d6248e4b-9e9d-73bf-25b7-19d4fc7b09f5);

IF
DB_Dead(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _, _, _, _)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "OffStage", _, _)
THEN
SetFlag(LOW_SerialKiller_State_HighberrysCoraDieBeforeDolor_10de93a2-d973-4be3-98a6-10b14ee23db1);
SetFlag(LOW_SerialKiller_Event_KillHighberrysAfterLongRest_c79f8fc7-272d-4398-8861-848d469b885b);
PROC_LOW_SerialKiller_FigarosSetupCommon();

IF
FlagSet(LOW_SerialKiller_State_HandHasItem_Cora_14b2403a-7a5b-44ab-ab99-903686f357cc, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SeveringCoraHand", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SerialKiller_State_Cora_SeveredHand_d8c2c89a-235d-486c-9bf7-4f5aed0b84e7);
ClearFlag(LOW_SerialKiller_Event_KillHighberrysAfterLongRest_c79f8fc7-272d-4398-8861-848d469b885b);

IF
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
THEN
DB_Dialogs(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, LOW_HighberrysHouse_OnlyCora_0943e58e-50f2-1d1e-2507-12047735acb3);
SetFlag(LOW_SerialKiller_State_HighberrysRogerDieBeforeDolor_e04a0ab1-6418-42a9-8187-8d4fd46cfe66);

IF
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
AND
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
THEN
SetFlag(LOW_SerialKiller_State_HighberrysRogerDieBeforeDolor_e04a0ab1-6418-42a9-8187-8d4fd46cfe66);
SetFlag(LOW_SerialKiller_State_HighberrysCoraDieBeforeDolor_10de93a2-d973-4be3-98a6-10b14ee23db1);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SerialKiller_State_HighberrysCoraDieBeforeDolor_10de93a2-d973-4be3-98a6-10b14ee23db1, _, _, _, _)
AND
DB_GlobalFlag(LOW_SerialKiller_State_Cora_SeveredHand_d8c2c89a-235d-486c-9bf7-4f5aed0b84e7, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
THEN
ClearFlag(LOW_SerialKiller_State_HighberrysDead_LongRest_fa08cce7-6c15-4a47-9806-c2bc042a7aca, NULL_00000000-0000-0000-0000-000000000000);
PROC_LOW_InitializeWineFestival();

IF
KilledBy((CHARACTER)_Var1, _, (CHARACTER)_Var3, _, (CHARACTER)_Var1)
AND
DB_LOW_SerialKiller_TheHighberrys(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_SerialKiller_OrphanChilds(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var5, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var5, "Run", 1, "");

PROC
PROC_LOW_CheckMissionTriggered()
AND
DB_CurrentLevel("CTY_Main_A", _, _, _, _)
AND
DB_GlobalFlag(LOW_SerialKiller_State_MissionTriggered_003250e5-2cca-4612-9b74-a9802e8fec12, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5, _, _, _, _)
THEN
PROC_LOW_InitializeWineFestival();
SetFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5);
ClearFlag(LOW_SerialKiller_State_MissionTriggered_003250e5-2cca-4612-9b74-a9802e8fec12);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SerialKiller_Event_KillHighberrysAfterLongRest_c79f8fc7-272d-4398-8861-848d469b885b, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _, _, _, _)
AND NOT
DB_Dead(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _, _)
THEN
ClearFlag(LOW_SerialKiller_Event_KillHighberrysAfterLongRest_c79f8fc7-272d-4398-8861-848d469b885b);
ClearFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5);
PROC_LOW_HighberrysHouse_PerformRitual();

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SerialKiller_State_DolorKillsCoraWineFestival_0fce13c6-8d48-4391-a890-f1397add7af4, _, _, _, _)
AND
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SerialKiller_CrimeSceneWithoutRitual", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_ShowAttendantsWineFestival(1);
PROC_LOW_HideOnlyDoppelgangers();
PROC_LOW_SetRitualCharactersInPosition();
PROC_RemoveDialog(S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c);
PROC_Removedialog(S_LOW_Elfsong_FlamingFist_002_971f5890-e0ae-49ef-9a04-5e69ebdf8159);
DB_Dialogs(S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c, LOW_HighberrysHouse_Guard_d3e5af13-a9a8-ad24-2841-fef76a50ef06);
DB_Dialogs(S_LOW_Elfsong_FlamingFist_002_971f5890-e0ae-49ef-9a04-5e69ebdf8159, LOW_HighberrysHouse_Guard_Interior_5a2426c2-b921-1704-b3d9-ecaf59683a5e);
NOT DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1);
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(-1);

IF
DB_Defeated(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
THEN
SetFlag(LOW_SerialKiller_State_DolorIsDefeated_fa48e3fe-dc3c-b5c5-09f1-039a5b6974cf);
DB_Dialogs(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, LOW_HighberrysHouse_WithoutMurderer_547725be-0fc8-c4c0-45bb-ab694a8732f2);

IF
DB_GlobalFlag(LOW_SerialKiller_State_MissionTriggered_003250e5-2cca-4612-9b74-a9802e8fec12, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5, _, _, _, _)
AND
DB_CurrentLevel("CTY_Main_A", _, _, _, _)
THEN
PROC_LOW_InitializeWineFestival();
SetFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5);
ClearFlag(LOW_SerialKiller_State_MissionTriggered_003250e5-2cca-4612-9b74-a9802e8fec12);

PROC
PROC_LOW_InitializeWineFestival()
AND NOT
DB_GlobalFlag(LOW_SerialKiller_State_HighberrysCoraDieBeforeDolor_10de93a2-d973-4be3-98a6-10b14ee23db1, _, _, _, _)
THEN
PROC_LOW_ShowDolorAndDoppelgangers(1);
PROC_LOW_SerialKiller_CharactersToWineFestival();
PROC_LOW_SerialKiller_SettingUpScene();
PROC_CharacterMoveTo(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, S_LOW_SerialKiller_RogerToFestival_e9581a27-db04-4ceb-9060-72d1867210e2, "Walk", "LOW_SerialKiller_RogerArrives");
PROC_CharacterMoveTo(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_SerialKiller_CoraToWineFestival_3308f1c9-e511-4811-85e2-25de71917060, "Walk", "LOW_SerialKiller_CoraArrives");
PROC_State_Progress(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival");

PROC
PROC_LOW_InitializeWineFestival()
AND
DB_GlobalFlag(LOW_SerialKiller_State_Cora_SeveredHand_d8c2c89a-235d-486c-9bf7-4f5aed0b84e7, _, _, _, _)
THEN
PROC_LOW_ShowDolorAndDoppelgangers(1);
PROC_LOW_FigarosSetup_NotLongRest("NotKillCora");
PROC_LOW_ShowAttendantsWineFestival(1);
PROC_CharacterMoveTo(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, S_LOW_SerialKiller_RogerToFestival_e9581a27-db04-4ceb-9060-72d1867210e2, "Walk", "");
PROC_CharacterMoveTo(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_SerialKiller_CoraToWineFestival_3308f1c9-e511-4811-85e2-25de71917060, "Walk", "LOW_SerialKiller_CoraArrives");
PROC_RemoveDialog(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);
DB_Dialogs(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, LOW_SerialKiller_RogerWineFestival_ee90229f-aa92-f1ca-a29d-1274374d0096);
PROC_State_Progress(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "Figaro");

PROC
PROC_LOW_SerialKiller_SettingUpScene()
AND NOT
DB_GlobalFlag(LOW_SerialKiller_State_HighberrysCoraDieBeforeDolor_10de93a2-d973-4be3-98a6-10b14ee23db1, _, _, _, _)
AND
DB_LOW_SerialKiller_WineFestivalADs(_, _Var2, _Var3, _Var4, _)
THEN
DB_SceneManager(_Var2, "LOW_SerialKiller_WineFestivalScene");
DB_SceneManager(_Var3, "LOW_SerialKiller_WineFestivalScene");
DB_SceneManager(_Var4, "LOW_SerialKiller_WineFestivalScene");

PROC
PROC_LOW_SerialKiller_SettingUpScene()
THEN
DB_SceneAllowAllDisturbances("LOW_SerialKiller_WineFestivalScene");

PROC
PROC_LOW_SerialKiller_CharactersToWineFestival()
AND
DB_LOW_SerialKiller_WineFestivalPositions(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
_Var4 == "Civilian"
AND
DB_LOW_WineFestivalAttendants(_Var1, _Var5, _Var1, _Var1, _Var1)
AND
GUIDToString(_Var1, _Var6, _Var1, _Var1, _Var1)
AND
Concatenate(_Var4, _Var6, _Var7, _Var1, _Var1)
THEN
PROC_AppearOutOfSightTo(_Var1, _Var2, _Var3, _Var7);
DB_Dialogs(_Var1, _Var5);
DB_LOW_SerialKiller_WineFestivalAppearingEvents(_Var1, _Var7);

PROC
PROC_LOW_SerialKiller_CharactersToWineFestival()
AND
DB_LOW_SerialKiller_WineFestivalPositions(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
_Var4 == "Murderer"
AND NOT
DB_PermaDefeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
AND
GUIDToString(_Var1, _Var5, _Var1, _Var1, _Var1)
AND
Concatenate(_Var4, _Var5, _Var6, _Var1, _Var1)
THEN
PROC_AppearOutOfSightTo(_Var1, _Var2, _Var3, _Var6);
DB_LOW_SerialKiller_WineFestivalAppearingEvents(_Var1, _Var6);

PROC
PROC_LOW_SerialKiller_CharactersToWineFestival()
AND
DB_LOW_SerialKiller_WineFestivalPositions(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
_Var4 == "Murderer"
AND
DB_PermaDefeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SerialKiller_WineFestivalPositions(_Var1, _Var2, _Var3, _Var4);

IF
EntityEvent((GUIDSTRING)_Var1, (STRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_WineFestivalAppearingEvents(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_LOW_SerialKiller_WineFestivalPositions(_Var1, _Var3, _, _, _Var1)
THEN
NOT DB_LOW_SerialKiller_WineFestivalAppearingEvents(_Var1, _Var2);
PROC_CharacterMoveTo(_Var1, _Var3, "Walk", _Var2);

IF
EntityEvent((GUIDSTRING)_Var1, (STRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_LOW_SerialKiller_WineFestivalAppearingEvents(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_LOW_SerialKiller_WineFestivalPositions(_Var1, _Var3, _Var4, _Var5, _Var1)
THEN
NOT DB_LOW_SerialKiller_WineFestivalPositions(_Var1, _Var3, _Var4, _Var5);
PROC_LOW_SerialKiller_TryStartChatter();

PROC
PROC_LOW_SerialKiller_TryStartChatter()
AND
QRY_IsEmptyDB("DB_LOW_SerialKiller_WineFestivalPositions", 4, _, _, _)
THEN
PROC_LOW_ReproduceWineFestivalChatter();

PROC
PROC_LOW_ShowAttendantsWineFestival((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 == 0
AND
DB_LOW_WineFestivalAttendants(_Var2, _, _Var1, _Var1, _Var1)
THEN
PROC_RemoveDialog(_Var2);
PROC_SetOnStage(_Var2, _Var1);

PROC
PROC_LOW_ShowAttendantsWineFestival((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 == 1
AND
DB_LOW_WineFestivalAttendants(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var2, _Var1);
DB_Dialogs(_Var2, _Var3);

PROC
PROC_LOW_ShowDolorAndDoppelgangers((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var2, _, _, _Var1, _Var1)
AND
_Var1 == 0
THEN
PROC_RemoveDialog(_Var2);
PROC_SetOnStage(_Var2, _Var1);

PROC
PROC_LOW_ShowDolorAndDoppelgangers((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var2, _, _Var4, _Var1, _Var1)
AND
_Var2 != S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134
AND
_Var1 == 1
THEN
DB_Dialogs(_Var2, _Var4);
PROC_SetOnStage(_Var2, _Var1);

PROC
PROC_LOW_ShowDolorAndDoppelgangers((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var2, _, _Var4, _Var1, _Var1)
AND
_Var1 == 1
THEN
PROC_CharacterDisableCrime(_Var2, "Murder");
PROC_CharacterDisableCrime(_Var2, "Assault");

PROC
PROC_LOW_ShowDolorAndDoppelgangers((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var2, _, _Var4, _Var1, _Var1)
AND
_Var1 == 1
AND
_Var2 == S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134
THEN
SetOnStage(_Var2, _Var1);
PROC_RemoveDialog(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679);
PROC_RemoveDialog(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);
DB_Dialogs(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6);

PROC
PROC_LOW_HideOnlyDoppelgangers()
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
_Var1 != S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134
THEN
PROC_SetOnStage(_Var1, 0);

PROC
PROC_LOW_ReproduceWineFestivalChatter()
AND
DB_GlobalFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5, _, _, _, _)
AND
QRY_OnlyOnce("LOW_WineFestivalHappening", _, _, _, _)
AND
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != -1
AND
DB_LOW_SerialKiller_WineFestivalADs(_Var2, _Var3, _Var4, _Var5, _Var1)
AND
IntegerSum(_Var1, 1, _Var6, _Var1, _Var1)
AND
GetHostCharacter(_Var7, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(_Var2, _Var3, _Var4, _Var5);
NOT DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1);
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var6);

IF
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(4, _, _, _, _)
AND
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
THEN
NOT DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(4);
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(1);

IF
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 > 4
THEN
NOT DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1);
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(1);

IF
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(-1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SerialKiller_WineFestivalADs(_Var1, _Var2, _Var3, _Var4, _Var5)
THEN
DialogRequestStop(_Var2);
DialogRequestStop(_Var3);
DialogRequestStop(_Var4);
NOT DB_LOW_SerialKiller_WineFestivalADs(_Var1, _Var2, _Var3, _Var4, _Var5);

IF
AutomatedDialogEnded((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_WineFestivalADs(_Var1, _, _, _, _Var6)
AND
QRY_OnlyOnce_Reset("LOW_WineFestivalHappening", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_ReproduceWineFestivalChatter();

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_SerialKiller_VisitWineFestival_f5419edc-b46c-4f87-9853-eaf67eaefa23, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_SerialKiller_State_DolorIsDefeated_fa48e3fe-dc3c-b5c5-09f1-039a5b6974cf, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SerialKiller_Event_HighberrysAlive_WillDieAfterLongRest_c79f8fc7-272d-4398-8861-848d469b885b, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_GLO_Combat_TemporaryHostile(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
GetFaction(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
NOT DB_GLO_Combat_TemporaryHostile(_Var1);
PROC_SetRelationMutual(_Var4, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);

IF
DB_GLO_Combat_TemporaryHostile(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
_Var1 != S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134
THEN
UseSpell(_Var1, "Shout_LOW_Shapechanger_Doppelganger_Highberry_000", _Var1);
SetStoryDisplayName(_Var1, "SerialKiller_Dolor_Name");
DB_LOW_SerialKiller_Doppelganger_AlreadyTransformed(_Var1);

IF
FlagSet(LOW_SerialKiller_Event_DolorCombatHighberrysHouse_a40b5a87-023d-0f2a-4a75-935646b139d0, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SerialKiller_WaitingCombat_NoWine(_Var1);
ClearFlag(LOW_SerialKiller_Event_DolorCombatHighberrysHouse_a40b5a87-023d-0f2a-4a75-935646b139d0);

IF
DialogEnded(LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6, _, _, _, _)
AND
DB_LOW_SerialKiller_WaitingCombat_NoWine(_Var2, _, _, _, _)
THEN
NOT DB_LOW_SerialKiller_WaitingCombat_NoWine(_Var2);
PROC_LOW_SerialKiller_DoppelgangersAsDolor();
SetStoryDisplayName(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "SerialKiller_Dolor_Name");
SetHostileAndEnterCombat(Hero_a1542c81-6895-929e-4522-10ce218bb360, Act3_LOW_Dolor_15f56a1e-42e3-458d-bf8d-140ed313b928, _Var2, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134);
PROC_SetRelationToPlayers(Act3_LOW_Dolor_HighberrysHouseDoppelgangers_d7decde4-a3f5-42ae-b63f-6b6dfeaff052, 0);
PROC_SetRelationMutual(Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, Act3_LOW_Dolor_HighberrysHouseDoppelgangers_d7decde4-a3f5-42ae-b63f-6b6dfeaff052, 0);
PROC_SetRelationMutual(Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, Act3_LOW_Dolor_15f56a1e-42e3-458d-bf8d-140ed313b928, 0);

IF
KilledBy(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, (CHARACTER)_Var1, _, (INTEGER)_Var3, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SerialKiller_AD_DolorSeeYouKillCora_9406383e-cbbc-6ef4-4abc-4558843e47bb, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134);

PROC
PROC_SceneInterrupted(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, (CHARACTER)_Var1, "LOW_SerialKiller_WineFestivalScene", "Attacked", (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SerialKiller_AD_DolorSeeYouKillCora_9406383e-cbbc-6ef4-4abc-4558843e47bb, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134);

IF
AutomatedDialogEnded(LOW_SerialKiller_AD_DolorSeeYouKillCora_9406383e-cbbc-6ef4-4abc-4558843e47bb, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_OnlyOnce("LOW_DolorSeeYouKillCora", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SerialKiller_DolorTryToEscape("LOW_Dolor_AwayWineFestival_NotKillingCora");

IF
AttackedBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, _, _, (INTEGER)_Var7, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var2, _, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SerialKiller_DoppelgangersAsDolor();
SetStoryDisplayName(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "SerialKiller_Dolor_Name");
SetHostileAndEnterCombat(Hero_a1542c81-6895-929e-4522-10ce218bb360, Act3_LOW_Dolor_15f56a1e-42e3-458d-bf8d-140ed313b928, _Var2, _Var1);
PROC_SetRelationToPlayers(Act3_LOW_Dolor_HighberrysHouseDoppelgangers_d7decde4-a3f5-42ae-b63f-6b6dfeaff052, 0);
PROC_SetRelationMutual(Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, Act3_LOW_Dolor_HighberrysHouseDoppelgangers_d7decde4-a3f5-42ae-b63f-6b6dfeaff052, 0);
PROC_SetRelationMutual(Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, Act3_LOW_Dolor_15f56a1e-42e3-458d-bf8d-140ed313b928, 0);

IF
AttackedBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, _, _, (INTEGER)_Var7, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
AND
DB_HiddenCharacters(_Var2, _, _Var1, _Var1, _Var1)
AND
DB_SerialKiller_DolorAttackedStealth("True", _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_SerialKiller_DolorAttackedStealth("True");
SetFlag(LOW_SerialKiller_State_DolorNotKillsCora_fde4182c-ace1-40a8-a5ef-d680f289b42a);
PROC_TryStartAD(LOW_SerialKiller_AD_DolorBeingAttackedRunAway_36292ecd-2ac0-2335-85b6-c0ee47338006, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134);
PROC_LOW_SerialKiller_DolorTryToEscape("LOW_Dolor_AwayWineFestival_NotKillingCora");
SetFlag(LOW_SerialKiller_State_CoraSavedInStealth_4779eeec-ec9e-4cb3-b863-da0cb7c0385b);

IF
AttackedBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, _, _, (INTEGER)_Var7, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
AND
DB_HiddenCharacters(_Var2, _, _Var1, _Var1, _Var1)
AND NOT
DB_SerialKiller_DolorAttackedStealth("True", _Var1, _Var1, _Var1, _Var1)
THEN
DB_SerialKiller_DolorAttackedStealth("True");
PROC_TryStartAD(LOW_SerialKiller_AD_DolorReceiveFirstAttackFestival_bb62c31a-045c-5b07-6438-908c08be4719, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134);

IF
TurnStarted(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _, _, _, _)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _, _)
AND NOT
DB_PermaDefeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
THEN
PROC_LOW_SerialKiller_DolorTryToEscape("LOW_Dolor_AwayWineFestival_NotKillingCora");

IF
TurnStarted(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _, _, _, _)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _, _)
AND
DB_PermaDefeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
THEN
PROC_LOW_SerialKiller_DolorTryToEscape("LOW_Dolor_AwayWineFestival_KillingCora");

IF
KilledBy((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var2, (INTEGER)_Var3, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_State_Current(_Var6, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(Act3_LOW_Dolor_15f56a1e-42e3-458d-bf8d-140ed313b928, 0);
PROC_SetRelationToPlayers(Act3_LOW_Dolor_HighberrysHouseDoppelgangers_d7decde4-a3f5-42ae-b63f-6b6dfeaff052, 0);
PROC_SetRelationMutual(Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, Act3_LOW_Dolor_HighberrysHouseDoppelgangers_d7decde4-a3f5-42ae-b63f-6b6dfeaff052, 0);
PROC_SetRelationMutual(Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, Act3_LOW_Dolor_15f56a1e-42e3-458d-bf8d-140ed313b928, 0);

IF
CombatStarted((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SerialKiller_WineFestivalCombat", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, S_LOW_HighberrysHouse_Roger_RunPoint_c5d63e62-feb9-42f1-b705-ed372e49e244, "Run", "", "check");
PROC_CharacterMoveTo(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_HighberrysHouse_Cora_RunPoint_b0fef3b7-1f43-48b4-81a2-12c1c2675749, "Run", "", "check");
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway(_Var1);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SerialKiller_PlayersIncombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SerialKiller_PlayersIncombat(_Var1, _Var2);

PROC
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway()
AND
DB_LOW_WineFestivalAttendants(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_RemoveDialog(_Var1);
PROC_DisappearOutOfSight(_Var1, "Run", 1, "");

PROC
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway()
AND
DB_LOW_SerialKiller_WineFestivalCrowds(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerSetCrowdBehaviour(_Var1, 0);
TriggerSetCrowdSpawningEnable(_Var1, 0);

PROC
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_WineFestivalAttendants(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_RemoveDialog(_Var2);
DB_LOW_SerialKiller_RunAwayAfterCombat(_Var1, _Var2);

PROC
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway()
THEN
ClearFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5);

PROC
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(LOW_SerialKiller_State_WineFestival_a83198eb-b080-4001-bd00-d8368f1334a5);

PROC
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway()
AND
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(-1);

PROC
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(-1);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_RunAwayAfterCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var2, "Run", 1, "");

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_PlayersIncombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "Figaro", _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_DolorScapes", _Var1, _Var1, _Var1, _Var1)
AND
QRY_GetRandom("DB_LOW_SerialKiller_PlayersInCombat", 2, "DB_LOW_SerialKiller_ReproduceEscapePAD", _Var1, _Var1)
AND
DB_LOW_SerialKiller_ReproduceEscapePAD(_Var3, _Var4, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SerialKiller_ReproduceEscapePAD(_Var3, _Var4);
PROC_TryStartAD(LOW_SerialKiller_PAD_DolorEscapes_0d8e6e34-90af-6387-1581-02dd06f415d5, _Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_PlayersIncombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SerialKiller_State_DolorNotKillsCora_fde4182c-ace1-40a8-a5ef-d680f289b42a);
DebugText(_Var2, "End combat");
NOT DB_LOW_SerialKiller_PlayersInCombat(_Var2, _Var1);
Attack(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, 1);

IF
AttackedBy(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _, _, _, _, _, (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
Die(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, 0, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, 0, 0, 0);
PROC_LOW_SerialKiller_DolorTryToEscape("LOW_Dolor_AwayWineFestival_KillingCora");
PROC_LOW_SerialKiller_WineFestivalAttendantsRunAway();

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_PlayersIncombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _Var1, _Var1, _Var1, _Var1)
AND
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SerialKiller_PlayersInCombat(_Var2, _Var1);
PROC_LOW_SerialKiller_DolorTryToEscape("LOW_Dolor_AwayWineFestival_KillingCora");

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_PlayersIncombat(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SerialKiller_PlayersInCombat(_Var2, _Var1);

IF
DialogEnded(LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6, _, _, _, _)
AND
DB_LOW_SerialKiller_FlagsDrinkingWine(_Var2, _, _, _, _)
AND
DB_LOW_SerialKiller_TheHighberrys(_Var3, _, _, _, _)
AND
GetFlag(_Var2, _Var3, 1, _, _)
THEN
ApplyStatus(_Var3, "LOW_SERIALKILLER_PARALYZED", 18, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
StatusApplied(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, "LOW_SERIALKILLER_PARALYZED", _, _, _)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _, _)
THEN
Attack(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, 1);

IF
FlagSet(LOW_SerialKiller_Event_WineParalysis_Players_f93c6e25-9b54-4c4d-6a31-1198234121fc, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_SerialKiller_WaitUntilFinishDialog_Paralysis(_Var1);

IF
DialogEnded(LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6, _, _, _, _)
AND
DB_SerialKiller_WaitUntilFinishDialog_Paralysis(_Var2, _, _, _, _)
THEN
NOT DB_SerialKiller_WaitUntilFinishDialog_Paralysis(_Var2);
ApplyStatus(_Var2, "LOW_SERIALKILLER_PARALYZED", 18, 1, NULL_00000000-0000-0000-0000-000000000000);
PROC_LOW_SerialKiller_DoppelgangersAsDolor();
SetStoryDisplayName(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "SerialKiller_Dolor_Name");
PROC_SetRelationMutual(Act3_LOW_Dolor_HighberrysHouseDoppelgangers_d7decde4-a3f5-42ae-b63f-6b6dfeaff052, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);
PROC_SetRelationMutual(Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, Act3_LOW_Dolor_15f56a1e-42e3-458d-bf8d-140ed313b928, 0);

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_SerialKiller_VisitWineFestival_f5419edc-b46c-4f87-9853-eaf67eaefa23, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
AND NOT
DB_Defeated(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SerialKiller_PlayersInWineFestival(_Var1);

IF
LeftTrigger((CHARACTER)_Var1, S_LOW_SerialKiller_VisitWineFestival_f5419edc-b46c-4f87-9853-eaf67eaefa23, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SerialKiller_PlayersInWineFestival(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SerialKiller_PlayersInWineFestival(_Var1);

PROC
PROC_LOW_SerialKiller_DoppelgangersAsDolor()
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
_Var1 != S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134
AND NOT
DB_LOW_SerialKiller_Doppelganger_AlreadyTransformed(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
UseSpell(_Var1, "Shout_LOW_Shapechanger_Doppelganger_Highberry_000", _Var1);
SetStoryDisplayName(_Var1, "SerialKiller_Dolor_Name");
DB_LOW_SerialKiller_Doppelganger_AlreadyTransformed(_Var1);

PROC
PROC_LOW_SerialKiller_DoppelgangersAsDolor()
AND
DB_LOW_DolorAndDoppelgangers(_Var1, _, _, _Var1, _Var1)
AND
_Var1 != S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134
AND
GUIDToString(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
Concatenate("LOW_SerialKiller_FindDagger_", _Var4, _Var5, _Var1, _Var1)
AND
Concatenate("LOW_SerialKiller_FinishSearch_", _Var4, _Var6, _Var1, _Var1)
THEN
IterateInventory(_Var1, _Var5, _Var6);
DB_LOW_SerialKiller_DoppelgangersIteration(_Var5, _Var6, _Var1);

IF
EntityEvent((ITEM)_Var1, (STRING)_Var2, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_LOW_SerialKiller_DoppelgangersIteration(_Var2, _, _Var4, _Var1, _Var1)
AND
GetTemplate(_Var1, WPN_HUM_Dagger_A_0_569b0f3d-abcd-4b01-aaf0-979091288163, _Var1, _Var1, _Var1)
THEN
Equip(_Var4, _Var1, 1, 0, 0);

IF
EntityEvent(_, (STRING)_Var2, _, _, _)
AND
DB_LOW_SerialKiller_DoppelgangersIteration(_Var3, _Var2, _Var4, _, _)
THEN
NOT DB_LOW_SerialKiller_DoppelgangersIteration(_Var3, _Var2, _Var4);

PROC
PROC_LOW_SerialKiller_DolorUseSpellGoAway()
THEN
UseSpell(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "Shout_LOW_SerialKiller_BootsOfDimensionDoor", S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134);

IF
CastedSpell((GUIDSTRING)_Var1, "Shout_LOW_SerialKiller_BootsOfDimensionDoor", _, _, _)
AND
GetPosition(_Var1, _Var5, _Var6, _Var7, _Var1)
THEN
EndTurn(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134);
PlayEffectAtPosition(VFX_Spells_Cast_Intent_Utility_DimensionDoor_Root_01_7a4c033f-4128-31c0-fc04-951f8b7f2242, _Var5, _Var6, _Var7, 1);
PlayEffect(_Var1, VFX_Spells_Cast_Intent_Utility_DimensionDoor_BodyFX_Textkey_01_f4de2ffb-353f-a215-3311-f729bd8de1d6);
RealtimeObjectTimerLaunch(_Var1, "LOW_SerialKiller_TeleportAnimationDelay", 600);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "LOW_SerialKiller_TeleportAnimationDelay", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SerialKiller_DolorGoAway(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, 0);
PROC_LOW_FigarosSetup_NotLongRest(_Var2);
NOT DB_LOW_SerialKiller_DolorGoAway(_Var2);

PROC
PROC_LOW_SerialKiller_DolorTryToEscape((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
_Var1 == "LOW_Dolor_AwayWineFestival_NotKillingCora"
THEN
PROC_LOW_SerialKiller_DolorUseSpellGoAway();
DB_LOW_SerialKiller_DolorGoAway("NotKillCora");

PROC
PROC_LOW_SerialKiller_DolorTryToEscape((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
_Var1 == "LOW_Dolor_AwayWineFestival_KillingCora"
THEN
SetFlag(LOW_SerialKiller_State_DolorKillsCoraWineFestival_0fce13c6-8d48-4391-a890-f1397add7af4);
PROC_LOW_SerialKiller_DolorUseSpellGoAway();
DB_LOW_SerialKiller_DolorGoAway("KilledCora");

IF
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "Figaro", _, _)
AND NOT
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
THEN
PROC_RemoveDialog(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);
PROC_RemoveDialog(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679);
DB_Dialogs(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, LOW_HighberrysHouse_WithoutMurderer_547725be-0fc8-c4c0-45bb-ab694a8732f2);

IF
DB_Defeated(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
THEN
PROC_RemoveDialog(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);
PROC_RemoveDialog(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679);
DB_Dialogs(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, LOW_HighberrysHouse_WithoutMurderer_547725be-0fc8-c4c0-45bb-ab694a8732f2);

QRY
QRY_SelectCustomDialog(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_HighberrysHouse_WithoutMurderer_547725be-0fc8-c4c0-45bb-ab694a8732f2, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _Var1);

QRY
QRY_SelectCustomDialog(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_HighberrysHouse_WithoutMurderer_547725be-0fc8-c4c0-45bb-ab694a8732f2, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _Var1);

QRY
QRY_SelectCustomDialog(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _Var1);

QRY
QRY_SelectCustomDialog(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _Var1);

QRY
QRY_SelectCustomDialog(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, "LOW_Dolor", "WineFestival", _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_HighberrysHouse_Dolor_d96be40a-b01f-dfbc-72e1-303796a5e6c6, S_LOW_Dolor_55837c0f-0171-4020-a4a3-dd6de7ffc134, S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _Var1);

PROC
PROC_LOW_HighberrysHouse_ShowRitualItems((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_HighberrysRitualPerformedItems(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var2, _Var1);

PROC
PROC_LOW_SetRitualCharactersInPosition()
AND
DB_LOW_HighberrysRitualPerformedCharacters(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);
TeleportTo(_Var1, _Var2);

PROC
PROC_LOW_HighberrysHouse_SetHighberrys()
THEN
SetFlag(LOW_SerialKiller_State_HighberrysRitualPerformed_00c1e2ab-8752-47f1-b847-51aedc0fb189);
PROC_LOW_SetRitualCharactersInPosition();
PROC_LOW_HighberrysHouse_ShowRitualItems(1);
Die(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679);
DB_GLO_CharacterCorpseDialog(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, LOW_HighberrysHouse_Cora_SwD_f7a40e0d-caa2-a08d-8d10-7eee2e0c265a);
Die(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404);
TeleportTo(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, S_LOW_HighberrysHouse_CoraTP_056984a3-8b78-443b-9005-a9d229db20c3);
TeleportTo(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, S_LOW_HighberrysHouse_RogerTP_ab7c4284-52bf-42c6-bda8-d8558532974a);

PROC
PROC_LOW_HighberrysHouse_PerformRitual()
AND NOT
DB_Dead(S_LOW_CoraHighberry_8a520cf7-c5da-419f-bdd4-792b27c5c679, _, _, _, _)
AND
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_ShowAttendantsWineFestival(1);
PROC_LOW_HighberrysHouse_SetHighberrys();
PROC_LOW_FigarosSetup_NotLongRest("KilledCora");
PROC_LOW_HideOnlyDoppelgangers();
PROC_RemoveDialog(S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c);
PROC_Removedialog(S_LOW_Elfsong_FlamingFist_002_971f5890-e0ae-49ef-9a04-5e69ebdf8159);
DB_Dialogs(S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c, LOW_HighberrysHouse_Guard_d3e5af13-a9a8-ad24-2841-fef76a50ef06);
DB_Dialogs(S_LOW_Elfsong_FlamingFist_002_971f5890-e0ae-49ef-9a04-5e69ebdf8159, LOW_HighberrysHouse_Guard_Interior_5a2426c2-b921-1704-b3d9-ecaf59683a5e);
NOT DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(_Var1);
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(-1);

PROC
PROC_LOW_HighberrysHouse_PerformRitual()
AND
DB_GlobalFlag(LOW_SerialKiller_State_Cora_SeveredHand_d8c2c89a-235d-486c-9bf7-4f5aed0b84e7, _, _, _, _)
AND
DB_Defeated(S_LOW_RogerHighberry_09559a52-5b22-42aa-abfa-04098ecae404, _, _, _, _)
THEN
PROC_LOW_SetRitualCharactersInPosition();
PROC_LOW_FigarosSetup_NotLongRest("NotKillCora");
PROC_LOW_HideOnlyDoppelgangers();
SetFlag(LOW_SerialKiller_State_HighberrysRitualPerformed_00c1e2ab-8752-47f1-b847-51aedc0fb189);
PROC_RemoveDialog(S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c);
PROC_Removedialog(S_LOW_Elfsong_FlamingFist_002_971f5890-e0ae-49ef-9a04-5e69ebdf8159);
DB_Dialogs(S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c, LOW_HighberrysHouse_Guard_d3e5af13-a9a8-ad24-2841-fef76a50ef06);
DB_Dialogs(S_LOW_Elfsong_FlamingFist_002_971f5890-e0ae-49ef-9a04-5e69ebdf8159, LOW_HighberrysHouse_Guard_Interior_5a2426c2-b921-1704-b3d9-ecaf59683a5e);
DB_LOW_SerialKiller_WineFestivalADs_CurrentOrder(-1);

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_SerialKiller_VisitWineFestival_f5419edc-b46c-4f87-9853-eaf67eaefa23, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(LOW_SerialKiller_State_HighberrysRitualPerformed_00c1e2ab-8752-47f1-b847-51aedc0fb189, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SerialKiller_GuardYelling", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SerialKiller_AD_FlamingFist01_Yelling_d167404a-5545-f200-25e1-e20498b1b82a, S_LOW_Elfsong_FlamingFist_001_990ad029-d291-4788-86f9-dfceacdf771c);
PROC_TriggerUnregisterForParty(S_LOW_SerialKiller_VisitWineFestival_f5419edc-b46c-4f87-9853-eaf67eaefa23);

IF
TextEvent("low_highberry_combat", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Debug_LOW_Highberry_CombatRequested(1);
TeleportTo(_Var1, S_DEBUG_Teleport_LOW_Start_fab2d4d4-8b03-4263-94d7-f9819ed26523, "debug_LOW_highberry_teleport_reset", 1, 1, 1, 1, 1);

IF
EntityEvent((GUIDSTRING)_Var1, "debug_LOW_highberry_teleport_reset", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("debug_LOW_highberry_teleport_reset", _Var1, _Var1, _Var1, _Var1)
THEN
LoadPartyPreset("Level12_Rogue_Fighter_Cleric_Wizard", _Var1);

IF
PartyPresetLoaded("Level12_Rogue_Fighter_Cleric_Wizard", _, _, _, _)
AND
DB_Debug_LOW_Highberry_CombatRequested(1, _, _, _, _)
THEN
NOT DB_Debug_LOW_Highberry_CombatRequested(1);
SetFlag(LOW_SerialKiller_State_MissionTriggered_003250e5-2cca-4612-9b74-a9802e8fec12);
SetFlag(LOW_SerialKiller_Knows_TargetList_262314d1-43bf-4ea5-ae23-4a77bfab2671);
SetFlag(Debug_LOW_SerialKiller_NextStageQuest_06aad8a3-cdeb-4fd1-b029-6cfe8c096397);
SetFlag(LOW_SerialKiller_Event_KillHighberrysAfterLongRest_c79f8fc7-272d-4398-8861-848d469b885b);
PROC_LongRest();
TimerLaunch("DEBUG_LOW_Highberry_TimerLaunched", 1000);

IF
TimerFinished("DEBUG_LOW_Highberry_TimerLaunched", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var1, S_Debug_Teleport_LOW_HighberrysHouse_77e3cb84-658e-439b-b1ce-824fa3cb3068, "", 1, 1, 1, 1, 1);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3b"
