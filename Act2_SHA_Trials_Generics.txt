Version 1
SubGoalCombiner SGC_AND

INITSECTION
PROC_TriggerRegisterForPlayers(S_SHA_TrialsHubRegion_95aa1f48-749a-48ca-ac6e-7ef4ca75d7f6);
DB_SHA_Trials_TrialStatues(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429);
DB_SHA_Trials_TrialStatues(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e);
DB_SHA_Trials_TrialStatues(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe);
DB_Dialogs(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, SHA_ObjectOfDarknessTrial_e4e07b8e-46fc-c4cd-afa1-7800c22fcea1);
DB_Dialogs(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, SHA_PathOfDarknessTrial_46c2a366-6232-f71e-eac5-cf61be82f51a);
DB_Dialogs(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, SHA_DoublesEncounterTrial_b9c1c1d9-1f55-d7b6-875c-137b0a55b1e7);
DB_FlagReactionAfterDialog(SHA_Trials_Event_StartTrial_e585331b-2acc-2624-2f7e-07dd8d425f06, SHA_ObjectOfDarknessTrial_e4e07b8e-46fc-c4cd-afa1-7800c22fcea1);
DB_FlagReactionAfterDialog(SHA_Trials_Event_StartTrial_e585331b-2acc-2624-2f7e-07dd8d425f06, SHA_PathOfDarknessTrial_46c2a366-6232-f71e-eac5-cf61be82f51a);
DB_FlagReactionAfterDialog(SHA_Trials_Event_StartTrial_e585331b-2acc-2624-2f7e-07dd8d425f06, SHA_DoublesEncounterTrial_b9c1c1d9-1f55-d7b6-875c-137b0a55b1e7);
DB_SHA_Trials_Atmospheres(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Atm_LT_WLD_SharTemple_C_000_642dbb31-a54a-8f00-498c-ff99bac7b618, "ddbdd506-dcbe-9151-761a-aaba7f4ae8fc");
DB_SHA_Trials_Atmospheres(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_MentalTortureTrial_Atm_LT_WLD_SharTemple_C_000_05ce8331-6a23-8e88-48a2-cffffdca5ec6, "ddbdd506-dcbe-9151-761a-aaba7f4ae8fc");
DB_SHA_Trials_Atmospheres(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathOfDarknessTrial_Atm_LT_WLD_SharTemple_C_000_016cf5df-69ce-8180-2360-41ea416e2a1a, "ddbdd506-dcbe-9151-761a-aaba7f4ae8fc");
DB_SHA_Trials_FlagProgress(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14);
DB_SHA_Trials_FlagProgress(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c);
DB_SHA_Trials_FlagProgress(SHA_Trials_Event_TrialFailed_e80850ea-ab84-4043-9809-960d4db885f6);
DB_SHA_Trials_FlagProgress(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1);
DB_SHA_Trials_TrialRoomTriggers(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrialTrigger_b40d88a4-d5d1-4511-8ae2-88e4b7e83f06, 0);
DB_SHA_Trials_TrialRoomTriggers(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathOfDarknessTrigger_d535f17f-7d95-4996-b4f7-2f53c4a7348c, 0);
DB_SHA_Trials_TrialRoomTriggers(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_MentalTortureTrigger_e272b659-024a-457d-a5f5-a9317d60e1eb, 0);
DB_SHA_Trials_TrialDoors(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_MentalTortureTrial_Door_db2320ec-7bef-4fa0-b1f7-e01631fe766a);
DB_SHA_Trials_TrialDoors(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Door_a76fbb69-9396-4a0d-b161-90d87f8a54d0);
DB_SHA_Trials_TrialDoors(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathOfDarknessTrial_Door_c162d4b8-c3c4-44b4-917d-34583a6dc03b);
DB_SHA_Trials_GemsNotTaken(S_SHA_TrialGem_000_5e3d0d3b-6fcf-48b8-a10c-580ff4efd1ff);
DB_SHA_Trials_GemsNotTaken(S_SHA_TrialGem_001_3c29b3b3-65ec-4d47-b689-e5eca053602b);
DB_SHA_Trials_GemsNotTaken(S_SHA_TrialGem_002_b8dda6e3-8cb8-4287-81a4-0ac5260859c7);
DB_SHA_Trials_GemsNotTaken(S_SHA_TrialGem_006_7fbf6a88-bce1-49e0-a216-0cb2ce23b0eb);
PROC_DeclareCounter("SHA_Trials_GemsTaken");
DB_PlayerHasTemplateItem(QUEST_SHA_TrialGem_fd3fd8a9-a5fc-4726-9b6e-77f5ecf54cea, SHA_Trials_State_HasGem_71e7fb14-ca8d-4023-816b-3e3bd658b4b9);
DB_SHA_Trials_TrackedHoldersWithGems(S_SHA_Necromancer_53651a9f-7ea8-444f-ba2d-224390b72f7d, SHA_Trials_State_NecromancerHasGem_c6e2b896-f650-4585-a319-71899a289bac);
DB_SHA_Trials_TrackedHoldersWithGems(S_GLO_Orthon_1dc8091d-2af6-4d33-9268-998ef266d19c, SHA_Trials_State_OrthonHasGem_37e92c8c-49c2-4231-b522-6c89a53466f5);
DB_GiveTemplateFromNpcToPlayerDialogEvent(QUEST_SHA_TrialGem_fd3fd8a9-a5fc-4726-9b6e-77f5ecf54cea, SHA_Trials_Event_GiveGem_5c447374-c407-4803-ac23-135a05adc27d, NULL_00000000-0000-0000-0000-000000000000, 1);
DB_SHA_Trials_GemSockets(S_LOW_UpperAltar_a856b852-e53d-4b3a-bfb8-5215d9a77141, 0, S_SHA_UpperSocketGem_000_369d939f-b54b-4348-bfbd-8b02ce6a69a5);
DB_SHA_Trials_GemSockets_Counters(S_LOW_UpperAltar_a856b852-e53d-4b3a-bfb8-5215d9a77141, "SHA_Disc_Unlock");
DB_SHA_Trials_GemSockets(S_SHA_LowerAltar_1a25fac4-dfb3-4103-91e2-e977c03681de, 0, S_SHA_LowerSocketGem_000_8c31b27b-7380-44a3-a004-1f78907caa2d);
DB_SHA_Trials_GemSockets(S_SHA_LowerAltar_1a25fac4-dfb3-4103-91e2-e977c03681de, 1, S_SHA_LowerSocketGem_001_9fa05213-543a-4fe6-875a-004b1370c55c);
DB_SHA_Trials_GemSockets(S_SHA_LowerAltar_1a25fac4-dfb3-4103-91e2-e977c03681de, 2, S_SHA_UpperSocketGem_002_011f6f31-bb46-4b73-9ec6-cd6bf010a3c8);
DB_SHA_Trials_GemSockets_Counters(S_SHA_LowerAltar_1a25fac4-dfb3-4103-91e2-e977c03681de, "SHA_NightsongChamber_Unlock");
DB_SHA_Trials_GemSockets_CountersMilestones("SHA_Disc_Unlock", 1, SHA_Upper_State_DiscUnlocked_4b056ce5-e145-4d90-8451-0ff502e11898);
DB_SHA_Trials_GemSockets_CountersMilestones("SHA_NightsongChamber_Unlock", 3, SHA_Trials_Event_UnlockNightsongChamber_8e857d0c-990b-4029-aa28-f5b935fb8c0f);
DB_SHA_Trials_DeathTriggers(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_DeathTrigger_000_f64911ce-012d-44ef-a3fb-35248bbf1618, S_SHA_PathOfDarknessTrial_DeathTriggerTP_000_6a28f53d-3819-4869-b961-fc564615962a);
DB_SHA_Trials_DeathTriggers(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_DeathTrigger_001_b0407d81-3dd6-4707-bee4-95c9ecf917ca, S_SHA_PathOfDarknessTrial_DeathTriggerTP_001_9c2f8c45-a159-4932-ba8e-183d0f3b6ef7);
DB_SHA_Trials_DeathTriggers(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_DeathTrigger_002_155162ae-74a2-4310-a9e4-a49b179f2ef6, S_SHA_PathOfDarknessTrial_DeathTriggerTP_002_791bd805-8200-488d-a97b-ed8de55eb524);
DB_SHA_Trials_DeathTriggers(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_DeathTrigger_003_c2b68785-4100-4562-b48d-aff82b030413, S_SHA_PathOfDarknessTrial_DeathTriggerTP_000_6a28f53d-3819-4869-b961-fc564615962a);
DB_SHA_Trials_DeathTriggers(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_DeathTrigger_004_545fbf62-b2cc-4b6e-be8a-380be836d56a, S_SHA_PathOfDarknessTrial_DeathTriggerTP_001_9c2f8c45-a159-4932-ba8e-183d0f3b6ef7);
DB_SHA_Trials_DeathTriggers(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_DeathTrigger_005_6090a602-e025-4aa2-9881-459affa3c18a, S_SHA_PathOfDarknessTrial_DeathTriggerTP_002_791bd805-8200-488d-a97b-ed8de55eb524);
PROC_SHA_Trials_InitGems();
DB_SHA_Trials_PhysicalTrialsHints(SHA_Trials_VB_MentalTortureHint_43c115eb-d866-89ab-2961-1adfe8cad7b5, S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, "SHA_MentalTortureHint");
DB_SHA_Trials_PhysicalTrialsHints(SHA_Trials_VB_ObjectOfDarknessHint_749a4585-4694-3cda-6725-1999275e0fa2, S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, "SHA_ObjectOfDarknessHint");
DB_SHA_Trials_PhysicalTrialsHints(SHA_Trials_VB_PathOfDarknessHint_dea0e052-1bcf-bf59-b7f6-ad97e39baa5d, S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, "SHA_PathOfDarknessHint");
DB_SHA_Trials_HintFlags(SHA_Trials_Knows_SneakTrialHint_b4efcc39-450d-41a1-83bc-383a62729aa2, S_SHA_SneakTrialBook_5c322223-3247-481a-87f8-849631181a92, "SHA_ObjectOfDarknessHint");
DB_SHA_Trials_HintFlags(SHA_Trials_Knows_PathOfDarknessHint_59f22c41-9f10-443b-b6da-a292694a3d6e, S_SHA_SilentLibrary_FaithLeapTrial_4c80d967-17d5-4323-b73c-1d1aca1bed3b, "SHA_PathOfDarknessHint");
DB_SHA_Trials_HintFlags(SHA_Trials_Knows_CloneEncounterTrialHint_80d1e9cb-501d-4fff-a899-e28ef425eb36, S_SHA_CloneEncounterTrialBook_e69403e4-1aa6-4cfb-9cc5-6135fa17cae2, "SHA_MentalTortureHint");
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_000_46d79690-257f-45fe-b06d-2e43d218ba4d);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_022_f71ced98-9042-4816-9604-8b51cc3687d6);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_016_71f21391-f043-4a93-8e84-3d07dae6e7f1);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_005_8514fab4-9ffa-4ee7-90cb-d2e7d01715f7);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_013_6db49cdb-5e84-4efc-bb19-b8336dff4be2);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_018_d758325e-aa26-4747-a634-35b3d30cbcaa);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_003_15696155-e607-4035-97ae-fc22b9d2a578);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_009_6a9d124d-ef81-4f5d-aabd-9eafb95d9351);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_010_4f506776-ac07-428c-a304-e517d0651734);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_005_695835b4-dc0c-4970-bef5-2ab09c87042d);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_019_5a8a12b3-5fbd-4b8f-b542-2e7d98a51c5f);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_023_872bca74-6582-4264-8d93-19d4b910aefe);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_021_cade9577-4c4b-4e31-a97c-0dfa2dad6e1e);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_008_7f6c7400-4f08-4b21-97a4-cf63c8bad0b5);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_012_d2107abd-18e3-407a-8bc0-042290cdebec);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_001_05562813-1517-4df3-afab-6e7fb89ba253);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, S_SHA_LightTrial_Candlestick_020_c32047ae-b2cc-4c4c-8b7d-0baf33d105c3);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_000_2f2cc50f-c85c-4503-ab87-32921bf4fe1c);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_001_5e0cab64-8e02-4fc2-b364-33536e8f8757);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_002_6eca4306-1fe9-4817-b5be-7f10836f0be9);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_003_96124ebf-9aa8-4074-b7c3-b3e0e41e59f0);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_004_c4c7c126-46ed-4f79-b59b-89c4db8a4054);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_005_4f562736-aa55-4c23-8fb9-d454312a7bd8);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_006_a9a0ec33-5a79-4098-96ba-97d79019edba);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, S_SHA_TortureTrial_Candlestick_007_2c1d1a29-a32a-4214-9738-3164efb04a79);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_000_135f841a-4ee3-46ca-9685-0ae277655230);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_001_9943f23a-0f9b-4e4b-9d6b-11c3789c8cab);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_002_84e1e94d-d353-4d13-8027-8a4072bec145);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_003_c97b16f1-c0ab-4c46-9fcd-8d1ce38efd96);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_004_8b9fb787-92cc-4d6b-9409-bab1f4d89703);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_005_333b650a-2f24-49ae-8736-1305fb84e764);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_006_cbe61912-24c7-4ddf-90b5-e6995670b447);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_007_c25e6b31-0123-402a-8aaa-a34080cb1d4a);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_008_18533f14-f38c-4f67-aa82-fc1e5f8b9acb);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_009_02964b66-5144-450a-8c84-d1405422c57c);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_010_56a4279c-2378-49b8-b674-d037a3e3cc4e);
DB_SHA_Trials_PassedTrialsCandles(S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, S_SHA_PathTrial_Candlestick_011_e29d80f4-d48d-4a3b-92b6-0e526ff9ca26);
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542);
SetOnStage(S_SHA_TrialElevator_TopLever_0dc881a5-dcb6-4323-af2f-1e3030b06adb, 0);
PROC_TriggerRegisterForParty(S_SHA_SquishTrigger_da24e0c7-9618-48e3-b3df-9b2f78a6c16d);

KBSECTION
IF
UseStarted(_, (GUIDSTRING)_Var2, _, _, _)
AND
DB_SHA_Trials_HintFlags(_Var3, _Var2, _, _, _)
THEN
SetFlag(_Var3, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SHA_Trials_PlayHint((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_PhysicalTrialsHints(_Var3, _Var2, _Var4, _Var1, _Var1)
AND
DB_SHA_Trials_HintFlags(_Var5, _, _Var4, _Var1, _Var1)
AND
DB_GlobalFlag(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(_Var3, _Var1);

PROC
PROC_SHA_Trials_PlayHint((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_PhysicalTrialsHints(_Var3, _Var2, _Var4, _Var1, _Var1)
AND
DB_SHA_Trials_HintFlags(_Var5, _, _Var4, _Var1, _Var1)
AND NOT
DB_GlobalFlag(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
Concatenate(_Var4, "_BookNotFound", _Var7, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, _Var7, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(_Var3, _Var1);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, SHA_Trials_Event_StartTrial_e585331b-2acc-2624-2f7e-07dd8d425f06, _, (INTEGER)_Var3, (GUIDSTRING)_Var1)
AND
GetFlag(SHA_Trials_Event_ShadowheartUsedAltar_c7b9e1bd-b623-3d2a-c952-4a210a1740dc, _Var1, 0, _Var1, _Var1)
AND
DB_DialogPlayers(_Var3, _Var4, 1, _Var1, _Var1)
THEN
PROC_SHA_Trials_StartTrial(_Var4, _Var1);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, SHA_Trials_Event_StartTrial_e585331b-2acc-2624-2f7e-07dd8d425f06, _, (INTEGER)_Var3, (GUIDSTRING)_Var1)
AND
GetFlag(SHA_Trials_Event_ShadowheartUsedAltar_c7b9e1bd-b623-3d2a-c952-4a210a1740dc, _Var1, 1, _Var1, _Var1)
THEN
PROC_SHA_Trials_StartTrial(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, SHA_Trials_Event_StartTrial_e585331b-2acc-2624-2f7e-07dd8d425f06, _, (INTEGER)_Var3, (GUIDSTRING)_Var1)
THEN
ClearFlag(SHA_Trials_Event_StartTrial_e585331b-2acc-2624-2f7e-07dd8d425f06, _Var1);
ClearFlag(SHA_Trials_Event_ShadowheartUsedAltar_c7b9e1bd-b623-3d2a-c952-4a210a1740dc, _Var1);

PROC
PROC_SHA_Trials_StartTrial((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ApplyStatus(_Var1, "SHA_TRIALS_BLEEDING", 6, 1, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SHA_Trials_StartTrial((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var2, 0, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, _Var2, 0, _Var1, _Var1)
THEN
SetFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var2);
PROC_SHA_Trials_PlayHint(_Var1, _Var2);

PROC
PROC_SHA_Trials_TurnOnLight((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialStatues(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LoopEffect(VFX_Script_Stub_Loop_01_a7f1b570-0326-2a9c-8109-e1b81c8bd1fd, _Var1, "SHA_TrialStatueLight", "SCL_Main_A", "");

IF
FlagSet(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_SHA_Trials_SetAtmosphere(_Var1);
PROC_SHA_Trials_LockAndCloseTrialDoors(_Var1);

PROC
PROC_SHA_Trials_LockAndCloseTrialDoors((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialDoors(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
Close(_Var2);
Lock(_Var2, "SHA_TrialDoor");

PROC
PROC_SHA_Trials_SetAtmosphere((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_Atmospheres(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
TriggerSetAtmosphere(_Var2, _Var3);

IF
FlagSet(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialStatues(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var1);
PROC_SHA_Trials_UnlockAndOpenTrialDoors(_Var1);
PROC_SHA_Trials_SetDefaultAtmosphere(_Var1);

PROC
PROC_SHA_Trials_SetDefaultAtmosphere((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_Atmospheres(_Var1, _Var2, _, _Var1, _Var1)
THEN
TriggerResetAtmosphere(_Var2);

PROC
PROC_SHA_Trials_UnlockAndOpenTrialDoors((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialDoors(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_ItemUnlockAndOpen(_Var2);

IF
FlagSet(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DebugText(_Var1, "Trial passed");
PROC_SHA_Trials_TurnOnLight(_Var1);
PROC_SHA_Trials_TrialPassed(_Var1);

PROC
PROC_SHA_Trials_TrialPassed((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialStatues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, _Var1, 0, _Var1, _Var1)
THEN
PROC_SHA_Trials_CheckTrialProgression(_Var1, 1);

PROC
PROC_SHA_Trials_TrialPassed(_, _, _, _, _)
AND NOT
DB_GlobalFlag(SHA_Trials_State_PassedAnyTrial_0ae81489-c9c9-9841-5176-5328e845b304, _, _, _, _)
THEN
SetFlag(SHA_Trials_State_PassedAnyTrial_0ae81489-c9c9-9841-5176-5328e845b304, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_SHA_Trials_TrialPassed(_, _, _, _, _)
AND
QRY_SHA_Trials_AllTrialsPassed()
THEN
SetFlag(SHA_Trials_State_AllTrialsPassed_1e2b44c1-b11d-4aca-8cc5-627bf7a32c65, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_SHA_Trials_ActivateTeleportStone((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
THEN
SetCanInteract(_Var1, 1);
ApplyStatus(_Var1, "SHA_STONEACTIVE", -1, 1);
Transform(_Var1, DEC_Dungeon_SharTemple_Gem_Socket_C_Glow_45bf5b56-754d-416c-8e5d-2d30dfd72fb1, Physical_4acc6277-6dcd-4110-9450-b9379beaedac);

QRY
QRY_SHA_Trials_AllTrialsPassed()
AND
GetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429, 1, _, _)
AND
GetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e, 1, _, _)
AND
GetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe, 1, _, _)
THEN
DB_NOOP(1);

IF
FlagSet(SHA_Trials_Event_TrialFailed_e80850ea-ab84-4043-9809-960d4db885f6, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DebugText(_Var1, "Trial failed");
PROC_SHA_Trials_TrialFailed(_Var1);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, SHA_Trials_Event_TrialPassedInDialog_4b5ff126-0c2e-4443-a4b2-db49787f7caa, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(SHA_Trials_Event_TrialPassedInDialog_4b5ff126-0c2e-4443-a4b2-db49787f7caa, _Var1);
SetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, _Var1);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, SHA_Trials_Event_TrialFailedInDialog_90e8c04e-b2ba-41b7-830f-dbe8fc9b4c74, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(SHA_Trials_Event_TrialFailedInDialog_90e8c04e-b2ba-41b7-830f-dbe8fc9b4c74, _Var1);
SetFlag(SHA_Trials_Event_TrialFailed_e80850ea-ab84-4043-9809-960d4db885f6, _Var1);

PROC
PROC_SHA_Trials_TrialFailed((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialStatues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, _Var1, 0, _Var1, _Var1)
THEN
PROC_SHA_Trials_CheckTrialProgression(_Var1, 0);

PROC
PROC_SHA_Trials_TrialFailed(_, (ITEM)_, (ITEM)_, (ITEM)_, (ITEM)_)
THEN
SetFlag(SHA_Trials_State_TooManyFailures_3ff4ad0b-c8cd-652b-4781-fa671eb39330, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_SHA_Trials_CheckTrialProgression((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFlag(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, _Var1);
PROC_SHA_Trials_CustomTrialOutcome(_Var1);

PROC
PROC_SHA_Trials_CheckTrialProgression((GUIDSTRING)_Var1, 0, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_SHA_Trials_RestartTrial(_Var1);

PROC
PROC_SHA_Trials_CustomTrialOutcome((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_NOOP(1);

PROC
PROC_SHA_Trials_RestartTrial((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_FlagProgress(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(_Var2, _Var1);

PROC
PROC_SHA_Trials_SetAlmostDead((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetHitpoints(_Var1, 1);

IF
DB_SHA_Trials_TrialRoomTriggers(_, _Var2, _, _, _)
THEN
PROC_TriggerRegisterForParty(_Var2);

IF
EnteredTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialRoomTriggers(_, _Var2, _, _Var1, _Var1)
AND
QRY_SHA_Trials_IsInParty(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SHA_Trials_PartyMembersInTrialRooms(_Var1, _Var2);

IF
LeftTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_PartyMembersInTrialRooms(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_TrialRoomTriggers(_Var3, _Var2, _, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_PartyMembersInTrialRooms(_Var1, _Var2);
PROC_SHA_Trials_CheckAnyPlayerInTrial(_Var3);

IF
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_PartyMembersInTrialRooms(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_TrialRoomTriggers(_Var3, _Var2, 0, _Var1, _Var1)
AND
QRY_SHA_Trials_IsInParty(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var3, 1, _Var1, _Var1)
THEN
PROC_SHA_Trials_CheckAnyPlayerInTrial(_Var3);

PROC
PROC_SHA_Trials_CheckAnyPlayerInTrial((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
GetFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var1, 1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, _Var1, 0, _Var1, _Var1)
AND
QRY_SHA_Trials_PlayersInTrial(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_SHA_Trials_PlayersInTrial((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
QRY_OnlyOnce_Reset("SHA_CheckPlayersInTrial", _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_TrialRoomTriggers(_Var1, _Var2, _, _Var1, _Var1)
AND NOT
DB_SHA_Trials_PartyMembersInTrialRooms(_, _Var2, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("SHA_CheckPlayersInTrial", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SHA_Trials_TrialFailed(_Var1);

QRY
QRY_SHA_Trials_PlayersInTrial((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND NOT
DB_OnlyOnce("SHA_CheckPlayersInTrial", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_SHA_Trials_AnyPlayerInsideTrialNonDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SHA_Trials_TrialFailed(_Var1);

QRY
QRY_SHA_Trials_AnyPlayerInsideTrialNonDefeated((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TrialRoomTriggers(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_SHA_Trials_PartyMembersInTrialRooms(_Var4, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_SHA_Trials_IsInParty((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_SHA_Trials_IsInParty((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_IsSummonOrPartyFollower(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_DeathTriggers(_Var3, _Var2, _Var4, _Var1, _Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SHA_Trials_MagicTeleport(_Var1, _Var4, _Var3);

IF
EnteredTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_DeathTriggers(_Var3, _Var2, _Var4, _Var1, _Var1)
AND NOT
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SHA_Trials_CharacterEnteredDeathTrigger(_Var3, _Var4, _Var1);

PROC
PROC_SHA_Trials_CharacterEnteredDeathTrigger((ITEM)_Var1, (TRIGGER)_Var2, (GUIDSTRING)_Var3, (ITEM)_Var1, (ITEM)_Var1)
THEN
DB_SHA_Trials_TeleportTo(_Var3, _Var2, _Var1);
PROC_SHA_Trials_CharacterEnteredDeathTrigger_Hook(_Var1, _Var2, _Var3);

PROC
PROC_SHA_Trials_CharacterEnteredDeathTrigger_Hook((ITEM)_Var1, (TRIGGER)_Var2, (GUIDSTRING)_Var3, (ITEM)_Var1, (ITEM)_Var1)
THEN
DB_NOOP(1);

PROC
PROC_SHA_Trials_CharacterEnteredDeathTrigger((ITEM)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var3, (ITEM)_Var1, (ITEM)_Var1)
AND NOT
QRY_SHA_Trials_BlockKillCharacter(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
Die(_Var3, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 0);
RealtimeObjectTimerLaunch(_Var3, "SHA_TeleportCharacter", 1300);

QRY
QRY_SHA_Trials_BlockKillCharacter((ITEM)_Var1, (CHARACTER)_Var2, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
0 == 1
THEN
DB_NOOP(1);

IF
ItemEnteredTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_DeathTriggers(_Var4, _Var2, _Var5, _Var1, _Var1)
THEN
PROC_SHA_Trials_MagicTeleport(_Var1, _Var5, _Var4);

IF
ObjectTimerFinished((CHARACTER)_Var1, "SHA_TeleportCharacter", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_SHA_Trials_DeathTriggerTeleport(_Var1);

PROC
PROC_SHA_Trials_DeathTriggerTeleport((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_TeleportTo(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
DB_SHA_Trials_AltDeathTriggerTeleport(_Var3, _Var4, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_TeleportTo(_Var1, _Var2, _Var3);
PROC_SHA_Trials_MagicTeleport(_Var1, _Var4, _Var3);

PROC
PROC_SHA_Trials_DeathTriggerTeleport((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_TeleportTo(_Var1, _Var2, _Var3, _Var1, _Var1)
AND NOT
DB_SHA_Trials_AltDeathTriggerTeleport(_Var3, _, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_TeleportTo(_Var1, _Var2, _Var3);
PROC_SHA_Trials_MagicTeleport(_Var1, _Var2, _Var3);

IF
EntityEvent((CHARACTER)_Var1, "SHA_Trials_FinishedTeleport", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_TrialRoomTriggers(_Var3, _Var2, 1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var3, 1, _Var1, _Var1)
THEN
Resurrect(_Var1);

PROC
PROC_SHA_Trials_MagicTeleport((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
IsTagged(_Var1, ACT2_SHA_TRIALS_DONTTELEPORT_6be0d584-ab13-402a-8e6c-ddab996f9813, 0, _Var1, _Var1)
THEN
DB_SHA_Trials_MagicTeleport(_Var1, _Var2);
ApplyStatus(_Var1, "SHA_TRIALS_TELEPORT_TECHNICAL", 6, 1, _Var3);
PlayEffect(_Var1, VFX_Script_SCL_Trial_Shar_Teleport_Disappear_BodyFX_01_0f13f03e-107a-22af-ef1f-5a7a8967d5b9);
RealtimeObjectTimerLaunch(_Var1, "SHA_Trials_MagicTeleport", 2250);

PROC
PROC_SHA_Trials_MagicTeleport((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var4
AND
InSamePartyGroup(_Var1, _Var4, 1, _Var1, _Var1)
THEN
DB_SHA_Trials_MagicTeleport(_Var4, _Var2);
ApplyStatus(_Var4, "SHA_TRIALS_TELEPORT_TECHNICAL", 6, 1, _Var3);
PlayEffect(_Var4, VFX_Script_SCL_Trial_Shar_Teleport_Disappear_BodyFX_01_0f13f03e-107a-22af-ef1f-5a7a8967d5b9);
RealtimeObjectTimerLaunch(_Var4, "SHA_Trials_MagicTeleport", 2250);

PROC
PROC_SHA_Trials_MagicTeleportToPosition((GUIDSTRING)_Var1, (REAL)_Var2, (REAL)_Var3, (REAL)_Var4, (GUIDSTRING)_Var5)
THEN
DB_SHA_Trials_MagicTeleportPosition(_Var1, _Var2, _Var3, _Var4);
ApplyStatus(_Var1, "SHA_TRIALS_TELEPORT_TECHNICAL", 6, 1, _Var5);
PlayEffect(_Var1, VFX_Script_SCL_Trial_Shar_Teleport_Disappear_BodyFX_01_0f13f03e-107a-22af-ef1f-5a7a8967d5b9);
RealtimeObjectTimerLaunch(_Var1, "SHA_Trials_MagicTeleport", 2250);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "SHA_Trials_MagicTeleport", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_MagicTeleport(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var1, _Var2, "SHA_Trials_FinishedTeleport", 0, 0, 1);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "SHA_Trials_MagicTeleport", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_MagicTeleportPosition(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
TeleportToPosition(_Var1, _Var2, _Var3, _Var4, "SHA_Trials_FinishedTeleport", 0, 0, 1);

IF
EntityEvent((GUIDSTRING)_Var1, "SHA_Trials_FinishedTeleport", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
RemoveStatus(_Var1, "SHA_TRIALS_TELEPORT_TECHNICAL");

IF
EntityEvent((GUIDSTRING)_Var1, "SHA_Trials_FinishedTeleport", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_MagicTeleport(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_MagicTeleport(_Var1, _Var2);

IF
AddedTo((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_GemsNotTaken(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_GemsNotTaken(_Var1);
PROC_IncreaseCounter("SHA_Trials_GemsTaken");

PROC
PROC_CounterIncreased("SHA_Trials_GemsTaken", 4, _, _, _)
THEN
SetFlag(SHA_Trials_Event_AllGemsFound_2d47ee89-2a15-4b33-b933-59f0b0aa6f3b, NULL_00000000-0000-0000-0000-000000000000);
PROC_RemoveCounter("SHA_Trials_GemsTaken");

PROC
PROC_SHA_Trials_InitGems()
AND
DB_SHA_Trials_GemSockets(_, _, _Var3, _, _)
THEN
SetOnStage(_Var3, 0);

PROC
PROC_SHA_Trials_InitGems()
AND
DB_SHA_Trials_GemSockets_Counters(_, _Var2, _, _, _)
AND NOT
DB_GlobalCounter(_Var2, _, _, _, _)
THEN
PROC_DeclareCounter(_Var2);

IF
Combined((GUIDSTRING)_Var1, _, _, _, _, (GUIDSTRING)_Var6, (GUIDSTRING)_Var7, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_GemSockets_Counters(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_SHA_Trials_AddGemToSocket(_Var1);
ObjectTimerLaunch(_Var7, "SHA_Trials_GemRemoval", 500);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "SHA_Trials_GemRemoval", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
RequestDelete(_Var1);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_GemSockets(_Var2, _, _, _Var1, _Var1)
AND NOT
QRY_ItemTemplateInMagicPockets(_Var1, QUEST_SHA_TrialGem_fd3fd8a9-a5fc-4726-9b6e-77f5ecf54cea, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(SHA_Trials_PAD_DontHaveGem_892393ff-4274-975d-703a-db75e5c08383, _Var1);

PROC
PROC_SHA_Trials_TryStartDiscAD((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(SHA_Upper_State_DiscUnlocked_4b056ce5-e145-4d90-8451-0ff502e11898, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "SHA_UnlockDiscAD", _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(SHA_Disc_PAD_Unlocked_153540d3-4632-071f-c189-a7ffadf5b296, _Var1);

PROC
PROC_SHA_Trials_AddGemToSocket((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_GemSockets_Counters(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GlobalCounter(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_GemSockets(_Var1, _Var3, _Var4, _Var1, _Var1)
THEN
SetCanInteract(_Var4, 0);
PROC_IncreaseCounter(_Var2);
SetOnStage(_Var4, 1);

IF
WentOnStage((GUIDSTRING)_Var1, 1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_GemSockets(_Var2, _, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_GemSockets_Counters(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_SHA_Trials_ResolveTrialsThroughGems(_Var4);

PROC
PROC_SHA_Trials_RemoveGemFromSocket((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_SHA_Trials_GemSockets_Counters(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GlobalCounter(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_GemSockets(_Var1, _Var4, _Var5, _Var1, _Var1)
THEN
PROC_DecreaseCounter(_Var2);
SetOnStage(_Var5, 0);
PROC_SHA_Trials_ResolveTrialsThroughGems(_Var2);

PROC
PROC_SHA_Trials_ResolveTrialsThroughGems((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_SHA_Trials_GemSockets_CountersMilestones(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
DB_GlobalCounter(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
QRY_SHA_Trials_GemSocketsProgress(_Var4, _Var2, _Var3, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_SHA_Trials_GemSocketsProgress((INTEGER)_Var1, (INTEGER)_Var2, (FLAG)_Var3, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 < _Var2
AND
DB_GlobalFlag(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(_Var3, NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_SHA_Trials_GemSocketsProgress((INTEGER)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var3, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 == _Var2
AND NOT
DB_GlobalFlag(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(_Var3);

PROC
PROC_SHA_Trials_LockDisc()
THEN
PROC_SHA_Disc_LockDestination(S_SHA_Disc_EntrancePos_f8dce590-e3eb-4557-8492-01bf20ecc4e4);
PROC_SHA_Disc_LockDestination(S_SHA_Disc_NightsongPos_df12413d-ef0f-43af-8fba-682ffe80c0d9);
TimerLaunch("SHA_Disc_MoveToCenter", 2500);
RemoveStatus(S_SHA_UpperTrialGemSocket_001_315fb18a-4092-450b-ae41-9149cd9d6c6e, "SHA_GEMS_ACTIVE");
RemoveStatus(S_SHA_UpperSocketGem_000_369d939f-b54b-4348-bfbd-8b02ce6a69a5, "SHA_GEMS_ACTIVE");

IF
TimerFinished("SHA_Disc_MoveToCenter", _, _, _, _)
THEN
PROC_SHA_Disc_MoveTo(S_SHA_Disc_CenterPos_5a15d75e-3f27-407c-9149-da0f1f8e2991);

PROC
PROC_SHA_Trials_UnlockDisc()
THEN
PlayEffect(S_SHA_UpperAltarPit_adffe953-f67f-4242-b99f-e5f433a377aa, VFX_Script_SharTempleAltar_LightBlast_01_50fef9ed-9149-675e-8350-a1a356fdde0f);
PROC_SHA_Disc_UnlockDestination(S_SHA_Disc_EntrancePos_f8dce590-e3eb-4557-8492-01bf20ecc4e4);
PROC_SHA_Disc_UnlockDestination(S_SHA_Disc_NightsongPos_df12413d-ef0f-43af-8fba-682ffe80c0d9);
PROC_SHA_Disc_MoveTo(S_SHA_Disc_EntrancePos_f8dce590-e3eb-4557-8492-01bf20ecc4e4);
SetCanInteract(S_LOW_UpperAltar_a856b852-e53d-4b3a-bfb8-5215d9a77141, 0);
ApplyStatus(S_SHA_UpperTrialGemSocket_001_315fb18a-4092-450b-ae41-9149cd9d6c6e, "SHA_GEMS_ACTIVE", -1, 1);
ApplyStatus(S_SHA_UpperSocketGem_000_369d939f-b54b-4348-bfbd-8b02ce6a69a5, "SHA_GEMS_ACTIVE", -1, 1);

IF
FlagSet(SHA_Upper_State_DiscUnlocked_4b056ce5-e145-4d90-8451-0ff502e11898, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SHA_Trials_UnlockDisc();

IF
FlagCleared(SHA_Upper_State_DiscUnlocked_4b056ce5-e145-4d90-8451-0ff502e11898, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SHA_Trials_LockDisc();

IF
FlagSet(SHA_Trials_Event_UnlockNightsongChamber_8e857d0c-990b-4029-aa28-f5b935fb8c0f, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PlayEffect(S_SHA_LowerAltarPit_be023d97-5de2-475d-bc31-ed77b22d920a, VFX_Script_SharTempleAltar_LightBlast_01_50fef9ed-9149-675e-8350-a1a356fdde0f);
SetCanInteract(S_SHA_LowerAltar_1a25fac4-dfb3-4103-91e2-e977c03681de, 0);
PROC_ItemUnlockAndOpen(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93);
ApplyStatus(S_SHA_UpperSocketGem_002_011f6f31-bb46-4b73-9ec6-cd6bf010a3c8, "SHA_GEMS_ACTIVE", -1, 1);
ApplyStatus(S_SHA_LowerSocketGem_000_8c31b27b-7380-44a3-a004-1f78907caa2d, "SHA_GEMS_ACTIVE", -1, 1);
ApplyStatus(S_SHA_LowerSocketGem_001_9fa05213-543a-4fe6-875a-004b1370c55c, "SHA_GEMS_ACTIVE", -1, 1);

IF
FlagCleared(SHA_Trials_Event_UnlockNightsongChamber_8e857d0c-990b-4029-aa28-f5b935fb8c0f, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
Lock(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93, "NOKEY");
Close(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93);
RemoveStatus(S_SHA_UpperSocketGem_002_011f6f31-bb46-4b73-9ec6-cd6bf010a3c8, "SHA_GEMS_ACTIVE");
RemoveStatus(S_SHA_LowerSocketGem_000_8c31b27b-7380-44a3-a004-1f78907caa2d, "SHA_GEMS_ACTIVE");
RemoveStatus(S_SHA_LowerSocketGem_001_9fa05213-543a-4fe6-875a-004b1370c55c, "SHA_GEMS_ACTIVE");

PROC
PROC_SHA_NightsongChamberDoor_SwitchState()
AND
IsOpened(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93, 1, _, _, _)
THEN
Lock(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93, "NOKEY");
Close(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93);

PROC
PROC_SHA_NightsongChamberDoor_SwitchState()
AND
IsClosed(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93, 1, _, _, _)
THEN
PROC_ItemUnlockAndOpen(S_SHA_NightsongChamberDoor_4689976f-7fe3-4d5f-933a-e872ce947d93);

IF
DualEntityEvent(_, S_SHA_NightsongChamberDoor_Lever_15237922-d7ff-4e6a-845d-914e86bcc031, "SHA_NightsongChamberDoor_Lever", (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SHA_NightsongChamberDoor_SwitchState();

IF
UseFinished(_, (ITEM)_Var2, 1, _, _)
AND
DB_SHA_Trials_GemSockets(_Var3, _, _Var2, _, _)
AND
DB_SHA_Trials_GemSockets_Counters(_Var3, "SHA_NightsongChamber_Unlock", _, _, _)
AND
DB_GlobalFlag(SHA_Trials_Event_UnlockNightsongChamber_8e857d0c-990b-4029-aa28-f5b935fb8c0f, _, _, _, _)
THEN
PROC_SHA_NightsongChamberDoor_SwitchState();

IF
UseFinished((CHARACTER)_Var1, (ITEM)_Var2, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_GemSockets(_Var3, _, _Var2, _Var1, _Var1)
AND
DB_SHA_Trials_GemSockets_Counters(_Var3, "SHA_NightsongChamber_Unlock", _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(SHA_Trials_Event_UnlockNightsongChamber_8e857d0c-990b-4029-aa28-f5b935fb8c0f, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogName(GLO_AD_CannotUseNow_057cb7cf-5aa4-1ed7-9639-65530939b2f9, _, _Var1, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
TemplateAddedTo(QUEST_SHA_TrialGem_fd3fd8a9-a5fc-4726-9b6e-77f5ecf54cea, _, (GUIDSTRING)_Var2, _, _)
AND
DB_SHA_Trials_TrackedHoldersWithGems(_Var2, _Var4, _, _, _)
THEN
SetFlag(_Var4, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(SHA_Trials_State_HasGem_71e7fb14-ca8d-4023-816b-3e3bd658b4b9, _Var2);

IF
DB_SHA_Trials_TrackedHoldersWithGems(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
TemplateIsInInventory(QUEST_SHA_TrialGem_fd3fd8a9-a5fc-4726-9b6e-77f5ecf54cea, _Var1, _Var3, _Var1, _Var1)
AND
_Var3 > 0
THEN
SetFlag(_Var2, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(SHA_Trials_State_HasGem_71e7fb14-ca8d-4023-816b-3e3bd658b4b9, _Var1);

IF
TemplateRemovedFrom(QUEST_SHA_TrialGem_fd3fd8a9-a5fc-4726-9b6e-77f5ecf54cea, _, (GUIDSTRING)_Var2, _, _)
AND
DB_SHA_Trials_TrackedHoldersWithGems(_Var2, _Var3, _, _, _)
AND
TemplateIsInInventory(QUEST_SHA_TrialGem_fd3fd8a9-a5fc-4726-9b6e-77f5ecf54cea, _Var2, 0, _, _)
THEN
ClearFlag(_Var3, NULL_00000000-0000-0000-0000-000000000000);
ClearFlag(SHA_Trials_State_HasGem_71e7fb14-ca8d-4023-816b-3e3bd658b4b9, _Var2);

PROC
PROC_SHA_Trials_TrialPassed((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SHA_Trials_PassedTrialsCandles(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var2, "BURNING", -1, 1);

IF
Combined(S_SHA_TrialElevator_BrokenLever_56ba35fc-bd73-4dd8-845b-4c9449f306f5, S_SHA_TrialElevator_LeverHandle_38f9b655-9a40-465b-8f15-f5e7227ce71e, _, _, _, _, (GUIDSTRING)_Var5, (ITEM)_, (ITEM)_, (ITEM)_)
THEN
SetOnStage(S_SHA_TrialElevator_TopLever_0dc881a5-dcb6-4323-af2f-1e3030b06adb, 1);
SetOnStage(S_SHA_TrialElevator_BrokenLever_56ba35fc-bd73-4dd8-845b-4c9449f306f5, 0);
ObjectTimerLaunch(_Var5, "SHA_Trials_HandleRemoval", 500);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "SHA_Trials_HandleRemoval", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
RequestDelete(_Var1);

IF
UseFinished((CHARACTER)_Var1, S_SHA_TrialElevator_BrokenLever_56ba35fc-bd73-4dd8-845b-4c9449f306f5, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInMagicPockets(S_SHA_TrialElevator_LeverHandle_38f9b655-9a40-465b-8f15-f5e7227ce71e, _Var1, 0, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
UseFinished((CHARACTER)_Var1, S_SHA_TrialElevator_BottomLever_21a0c76f-31ca-43df-88ac-758fd197ae09, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
UseFinished((CHARACTER)_Var1, S_SHA_TrialElevator_BottomLever_21a0c76f-31ca-43df-88ac-758fd197ae09, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09);
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542);
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb);
PROC_SHA_Trials_MoveElevatorTo(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542);

IF
UseFinished((CHARACTER)_Var1, S_SHA_TrialElevator_TopLever_0dc881a5-dcb6-4323-af2f-1e3030b06adb, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
UseFinished((CHARACTER)_Var1, S_SHA_TrialElevator_TopLever_0dc881a5-dcb6-4323-af2f-1e3030b06adb, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542);
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09);
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb);
PROC_SHA_Trials_MoveElevatorTo(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09);

IF
UseFinished((CHARACTER)_Var1, S_PLT_SHA_ElevatorLever_e0628a5e-6bad-4d77-aa4d-a1d556dcfb2d, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
UseFinished((GUIDSTRING)_Var1, S_PLT_SHA_ElevatorLever_e0628a5e-6bad-4d77-aa4d-a1d556dcfb2d, 1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542);
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09);
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb);
PROC_SHA_Trials_MoveElevatorTo(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09);

IF
UseFinished((GUIDSTRING)_Var1, S_PLT_SHA_ElevatorLever_e0628a5e-6bad-4d77-aa4d-a1d556dcfb2d, 1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var1, _Var1, _Var1, _Var1)
AND
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Top_d3a17282-1b35-4da8-9ea7-1709ffbcbd09);
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542);
DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb);
PROC_SHA_Trials_MoveElevatorTo(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542);

IF
PlatformMovementFinished(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, "SHA_Trials_ElevatorMoving", _, _, _)
THEN
NOT DB_SHA_Trials_ElevatorMoving(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb);

PROC
PROC_SHA_Trials_MoveElevatorTo((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetPosition(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
PlatformMoveTo(S_SHA_TrialElevator_465b0bce-a6d1-4811-b182-7b46849697cb, _Var2, _Var3, _Var4, 2, "SHA_Trials_ElevatorMoving", 0);

IF
EnteredTrigger((CHARACTER)_Var1, S_SHA_SquishTrigger_da24e0c7-9618-48e3-b3df-9b2f78a6c16d, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SHA_Trials_ElevatorPosition(S_SHA_TrialElevator_Bottom_7887e1c5-abbf-4e78-b859-419ba28f3542, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 0, 1);

IF
TextEvent("SHA_PassTrialsInProgress", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_SHA_Trials_TrialStatues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var1, 1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, _Var1, 0, _Var1, _Var1)
THEN
SetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, _Var1);

IF
TextEvent("SHA_FailTrialsInProgress", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_SHA_Trials_TrialStatues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialInProgress_87772420-50d7-4937-85ec-95c42fd9fd14, _Var1, 1, _Var1, _Var1)
AND
GetFlag(SHA_Trials_State_TrialFinished_b7dd2e12-2d84-4056-a35a-c0818e99e6d1, _Var1, 0, _Var1, _Var1)
THEN
SetFlag(SHA_Trials_Event_TrialFailed_e80850ea-ab84-4043-9809-960d4db885f6, _Var1);

IF
TextEvent("SHA_GiveTrialGems", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(S_SHA_TrialGem_000_5e3d0d3b-6fcf-48b8-a10c-580ff4efd1ff, 1);
SetOnStage(S_SHA_TrialGem_001_3c29b3b3-65ec-4d47-b689-e5eca053602b, 1);
SetOnStage(S_SHA_TrialGem_002_b8dda6e3-8cb8-4287-81a4-0ac5260859c7, 1);
ToInventory(S_SHA_TrialGem_000_5e3d0d3b-6fcf-48b8-a10c-580ff4efd1ff, _Var1, 1, 1, 1);
ToInventory(S_SHA_TrialGem_001_3c29b3b3-65ec-4d47-b689-e5eca053602b, _Var1, 1, 1, 1);
ToInventory(S_SHA_TrialGem_002_b8dda6e3-8cb8-4287-81a4-0ac5260859c7, _Var1, 1, 1, 1);

IF
TextEvent("SHA_GiveAllGems", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Debug_SHA_Trials_Generics_GiveAllGems(_Var1);

IF
TextEvent("SHA_PassOoDTrial", _, _, _, _)
THEN
SetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, S_SHA_ObjectOfDarknessTrial_3892d0a6-24f4-402e-8b51-03ba8cfb4429);

IF
TextEvent("SHA_PassPoDTrial", _, _, _, _)
THEN
SetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, S_SHA_PathOfDarknessTrial_ff2af557-dbc2-4e27-9c02-f13b25dbe86e);

IF
TextEvent("SHA_PassMTTrial", _, _, _, _)
THEN
SetFlag(SHA_Trials_Event_TrialPassed_a2bf1d24-4f81-4bae-ac3f-68a5760d122c, S_SHA_MentalTortureTrial_98811843-1086-4931-a3bd-3fef817347fe);

IF
TextEvent("SHA_LockDisc", _, _, _, _)
THEN
PROC_SHA_Trials_LockDisc();

IF
TextEvent("SHA_UnlockDisc", _, _, _, _)
THEN
PROC_SHA_Trials_UnlockDisc();

IF
FlagSet(Debug_SHA_GiveAllGems_7e45e767-525e-494b-83ba-1a398e55528d, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_Debug_SHA_Trials_Generics_GiveAllGems(_Var1);

PROC
PROC_Debug_SHA_Trials_Generics_GiveAllGems((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetOnStage(S_SHA_TrialGem_000_5e3d0d3b-6fcf-48b8-a10c-580ff4efd1ff, 1);
SetOnStage(S_SHA_TrialGem_001_3c29b3b3-65ec-4d47-b689-e5eca053602b, 1);
SetOnStage(S_SHA_TrialGem_002_b8dda6e3-8cb8-4287-81a4-0ac5260859c7, 1);
ToInventory(S_SHA_TrialGem_000_5e3d0d3b-6fcf-48b8-a10c-580ff4efd1ff, _Var1, 1, 1, 1);
ToInventory(S_SHA_TrialGem_001_3c29b3b3-65ec-4d47-b689-e5eca053602b, _Var1, 1, 1, 1);
ToInventory(S_SHA_TrialGem_002_b8dda6e3-8cb8-4287-81a4-0ac5260859c7, _Var1, 1, 1, 1);
ToInventory(S_SHA_TrialGem_006_7fbf6a88-bce1-49e0-a216-0cb2ce23b0eb, _Var1, 1, 1, 1);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act2"
