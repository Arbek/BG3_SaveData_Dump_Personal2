Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716);
DB_Dialogs(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, PLA_ZhentShipment_Agent_002_5198e66c-1609-e216-ddde-9663b3caee09);
DB_Inclusion_Object(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, PLA_ZhentShipment_Agent_002_StartInclusion_59a7ae31-e46c-986f-658f-890f9f9def69, PLA_ZhentShipment_Agent_002_EndInclusion_2bad0ac9-2099-42ce-b11a-741b467ac028);
DB_Inclusion_NPCDialog(PLA_ZhentDungeon_Zhent02_CaughtUp_96d44f6a-6ecc-00fb-298e-f0732fc77196, S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c);
DB_Inclusion_NPCDialog(PLA_ZhentShipment_Agent_001_ba3b62b6-9ca9-2e36-eec0-8d7272a14c8a, S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c);
DB_Inclusion_NPCDialog(PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716, S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c);
DB_DialogBlockTradeButton(PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716);
DB_DialogBlockTradeButton(PLA_ZhentShipment_Agent_002_5198e66c-1609-e216-ddde-9663b3caee09);
DB_DialogMoneyTransfer(1, PLA_ZhentShipment_Agent_001_ba3b62b6-9ca9-2e36-eec0-8d7272a14c8a, 150, 1, 1);
DB_DialogMoneyTransfer(1, PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716, 150, 1, 1);
DB_GlobalFlagReactionAfterDialog(PLA_ZhentShipment_Event_ProvokeGnolls_b7fe3fee-61ce-7d8d-64a6-519f0dc610cb, PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716);
DB_GLO_CharacterCorpseDialog(S_PLA_ZhentShipment_Agent_003_3c3f7d7c-6d91-4aa4-bec4-dbb7c2c12ea6, PLA_ZhentShipment_Agent_003_SwD_2849e535-df84-70d3-e039-b224d1267747);
DB_GLO_CharacterCorpseDialog(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, PLA_ZhentShipment_Agent_002_SpeakWithDead_190282f6-8d99-36b6-a762-7362c0898a79);
DB_GLO_CharacterCorpseDialog(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, PLA_ZhentShipment_Agent_001_SpeakWithDead_d7d827b3-24ce-dcc5-6e69-9bf1efd50902);
DB_PLA_ZhentShipment_Agents(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
DB_PLA_ZhentShipment_Agents(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c);
DB_PLA_ZhentShipment_AliveAgents(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
DB_PLA_ZhentShipment_AliveAgents(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c);
DB_SeenDeadNPCPartyFlag(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, PLA_ZhentShipment_State_Agent001Dead_62feb5b3-ecfd-4e43-ba22-e52d4e352f46);
DB_SeenDeadNPCPartyFlag(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, PLA_ZhentShipment_State_Agent002Dead_f51a12b5-e82a-4d88-a8c9-46ad0375107a);
AddSpell(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "Projectile_PLA_FakeAlchemistFire", 0, 0);
AddSpell(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, "Projectile_PLA_FakeAlchemistFire", 0, 0);
ApplyStatus(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "SWEATY", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "DIRT_COVERED", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "SWEATY", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, "BLOOD_COVERED_SLIGHT", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "PLA_ZhentShipment_AgentSpotter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "PLA_ZhentShipment_AgentSpotter");
DB_SpotPlayers_SpotTrigger(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "PLA_ZhentShipment_AgentSpotter", S_PLA_ZhentShipment_Agent_001_SpotTrigger_1d8f916d-d524-4da6-a9f7-07551fdb5061);
SetFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_SetHitpointsPercentage_BlockSelfHealing(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, 75);
PROC_SelfHealing_Disable(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
AddGold(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, 150);
PROC_TriggerRegisterForPlayers(TRIGGERGUID_S_PLA_ZhentShipment_WreckedCaravanArea_86c8011d-dc85-4b6f-ac98-fb8a60ae5b3a);
PROC_TriggerRegisterForParty(S_PLA_ZhentShipment_StartThrowingAlchFireArea_48f9b38a-0730-4f16-8a05-11f5c2f4bcd2);
PROC_TriggerRegisterForParty(S_PLA_ZhentShipment_StopThrowingAlchFireArea_ab77f4ff-7185-49cc-a104-9c4841d8fcdc);
PROC_TriggerRegisterForParty(TRIGGERGUID_S_PLA_ZhentShipment_GnollsBorderTrigger_f42b580d-5dec-4261-959c-27cfeaec20a0);
PROC_TriggerRegisterForParty(S_PLA_ZhentShipment_NoticingZhentsArea_9741f301-f369-4ecc-b9f1-fe48d8bb107a);
PROC_PLA_ZhentShipment_RegisterGnollsBorder();
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(0);
DB_PLA_ZhentShipment_CanThrowAlchFire(1);
DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
PROC_PLA_ZhentShipment_DisableCrimesOnGnolls();
DB_ItemOwnerShipTriggers("WLD_Main_A", S_PLA_ZhentShipment_OwnershipTrigger_893e9484-b653-4032-af9f-cdc28009bf13, S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
DB_PLA_ZhentShipment_Flasks(S_GLO_CursedIronFlask_83b010d4-7f1a-448c-9475-176347962cb2);
TriggerRegisterForItems(S_PLA_ZhentShipment_OwnershipTrigger_893e9484-b653-4032-af9f-cdc28009bf13);
DB_PLA_ZhentShipment_FireFlasksOnTheGround(S_PLA_ZhentShipment_FireFlask_A_000_4c97243c-3dff-4d90-95c2-53f1277d0d2d);
DB_PLA_ZhentShipment_FireFlasksOnTheGround(S_PLA_ZhentShipment_FireFlask_A_001_fccfb63d-4852-491c-a673-af08a5a439e8);
DB_PLA_ZhentShipment_FireFlasksOnTheGround(S_PLA_ZhentShipment_FireFlask_A_002_82b8d647-868e-49a0-903d-8bea7dca1bc7);
DB_PLA_ZhentShipment_FireFlasksOnTheGround(S_PLA_ZhentShipment_FireFlask_A_003_6425e8ac-a52c-4880-b687-c3665ef3e324);
DB_AutoSaveTrigger(S_PLA_ZhentDungeon_Autosave_ccd905fb-b68a-4cc8-85e3-90de349f3931);

KBSECTION
IF
FlagSet(PLA_ZhentDungeon_State_GnollZhentsPresent_2fe0f447-2276-a930-90c0-ab99b4dc8a2a, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
THEN
PROC_PLA_ZhentShipment_SwitchDialogToSecondPhase();

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_SwitchDialogToSecondPhase();

PROC
PROC_PLA_ZhentShipment_SwitchDialogToSecondPhase()
THEN
PROC_SpotPlayers_ClearSpotTrigger(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "PLA_ZhentShipment_AgentSpotter");
PROC_RemoveDialog(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4);
DB_Dialogs(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, PLA_ZhentShipment_Agent_001_ba3b62b6-9ca9-2e36-eec0-8d7272a14c8a);

IF
DialogStartRequested(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("PLA_ZhentShipment_AgentSpotter_InitialDialogStarted", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_HasMet_5359e72b-f8ca-d2d6-4c3a-8fc00efe5c2c, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dialogs(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var2, S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentSpotter_InitialDialogStarted", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

PROC
PROC_SpotPlayers_Spotted((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ConflictedFlind_NotEncounteredOrGone()
AND NOT
QRY_PLA_ZhentShipment_AreZhentsAndPlayerHostile(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_StartSpotDialog(_Var1, _Var3);

QRY
QRY_PLA_ConflictedFlind_NotEncounteredOrGone()
AND
DB_GlobalFlag(PLA_ConflictedFlind_State_NotEncountered_c4bed850-2d45-4806-bc6d-5d778e60cde4, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_PLA_ConflictedFlind_NotEncounteredOrGone()
AND
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_PLA_ZhentShipment_StartSpotDialog(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("PLA_ZhentShipment_AgentSpotter_SpotDialogStarted", _Var1, _Var1, _Var1, _Var1)
AND
DB_Dialogs(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var2, S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentSpotter_SpotDialogStarted", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

PROC
PROC_PLA_ZhentShipment_StartSpotDialog(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("PLA_ZhentShipment_AgentSpotter_SpotDialogStarted", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dialogs(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var2, S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentSpotter_SpotDialogStarted", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

PROC
PROC_PLA_ZhentShipment_StartSpotDialog(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("PLA_ZhentShipment_AgentSpotter_SpotDialogStarted", _Var1, _Var1, _Var1, _Var1)
AND
DB_Dialogs(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var2, S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentSpotter_SpotDialogStarted", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

IF
FlagCleared(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _, _, _, _)
AND NOT
DB_Defeated(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_HasMet_5359e72b-f8ca-d2d6-4c3a-8fc00efe5c2c, _, _, _, _)
AND
DB_SpotPlayers(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, "PLA_ZhentShipment_AgentSpotter", _, _, _)
THEN
DB_SpotPlayers_CustomRadius(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, "PLA_ZhentShipment_AgentSpotter", 8);
DB_SpotPlayers(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, "PLA_ZhentShipment_AgentSpotter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(PLA_ZhentDungeon_State_GnollZhentsPresent_2fe0f447-2276-a930-90c0-ab99b4dc8a2a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

IF
FlagSet(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

IF
FlagSet(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

PROC
PROC_PLA_ZhentShipment_AgentsStopSpotting()
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting(_Var1, "PLA_ZhentShipment_AgentSpotter");

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
AND NOT
DB_Defeated(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _, _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_TalkedToRugan_8100f823-5ecf-b1b8-497f-d151d980bcd2, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _, _, _, _)
AND
GetClosestAlivePlayer(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var3, _Var4, _, _)
AND
_Var4 < 25
AND
QRY_OnlyOnce("PLA_ZhentShipment_RuganMoveToAndTalk", _, _, _, _)
THEN
PROC_CharacterMoveToAndTalk(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var3, PLA_ZhentShipment_Agent_001_ba3b62b6-9ca9-2e36-eec0-8d7272a14c8a, "PLA_ZhentShipment_Event_RuganMovedToAndTalked", "Run", 20);

IF
EntityEvent(_, "PLA_ZhentShipment_Event_RuganMovedToAndTalked", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
AND
DB_DialogBlockTradeButton(PLA_ZhentShipment_Agent_002_5198e66c-1609-e216-ddde-9663b3caee09, _, _, _, _)
THEN
NOT DB_DialogBlockTradeButton(PLA_ZhentShipment_Agent_002_5198e66c-1609-e216-ddde-9663b3caee09);

IF
EnteredTrigger((GUIDSTRING)_Var1, TRIGGERGUID_S_PLA_ZhentShipment_WreckedCaravanArea_86c8011d-dc85-4b6f-ac98-fb8a60ae5b3a, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Knows_SurvivorsInCave_6318e058-45f9-4640-a9f5-59489fccb843, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "PLA_ZhentShipment_FoundCaravan", _Var1, _Var1, _Var1)
THEN
StartVoiceBark(VOICEBARKRESOURCEGUID_PLA_ZhentShipment_VB_WreckedCaravan_b6599109-8246-4827-6cce-45b6e667a8d0, _Var1);
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_Quest_FoundCaravan_f67929e9-34cc-45d0-a828-f7df4f298633);

IF
FlagSet(PLA_ZhentShipment_Quest_HasMet_5359e72b-f8ca-d2d6-4c3a-8fc00efe5c2c, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Knows_SurvivorsInCave_6318e058-45f9-4640-a9f5-59489fccb843, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_Knows_SurvivorsInCave_6318e058-45f9-4640-a9f5-59489fccb843);

IF
FlagSet(PLA_ZhentShipment_Knows_SurvivorsAreDead_d889b0c1-89aa-480f-9735-b24f04525453, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Knows_SurvivorsInCave_6318e058-45f9-4640-a9f5-59489fccb843, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_Knows_SurvivorsInCave_6318e058-45f9-4640-a9f5-59489fccb843);

IF
EnteredTrigger((GUIDSTRING)_Var1, S_PLA_ZhentShipment_StartThrowingAlchFireArea_48f9b38a-0730-4f16-8a05-11f5c2f4bcd2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 0, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a);

IF
EnteredTrigger((CHARACTER)_Var1, S_PLA_ZhentShipment_StopThrowingAlchFireArea_ab77f4ff-7185-49cc-a104-9c4841d8fcdc, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
LeftTrigger((CHARACTER)_Var1, S_PLA_ZhentShipment_StopThrowingAlchFireArea_ab77f4ff-7185-49cc-a104-9c4841d8fcdc, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_AgentsHaveFireFlasks()
AND
DB_GlobalFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 0, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_PLA_ZhentShipment_StartThrowingAlchFireArea_48f9b38a-0730-4f16-8a05-11f5c2f4bcd2, 1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a);

PROC
PROC_PLA_ZhentShipment_StopThrowingAlchFire()
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _, _, _, _)
THEN
PROC_TriggerUnregisterForParty(S_PLA_ZhentShipment_StopThrowingAlchFireArea_ab77f4ff-7185-49cc-a104-9c4841d8fcdc);
PROC_TriggerUnregisterForParty(S_PLA_ZhentShipment_StartThrowingAlchFireArea_48f9b38a-0730-4f16-8a05-11f5c2f4bcd2);
ClearFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 0);
TriggerUnregisterForItems(S_PLA_ZhentShipment_OwnershipTrigger_893e9484-b653-4032-af9f-cdc28009bf13);

PROC
PROC_PLA_ZhentShipment_StopThrowingAlchFire()
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _, _, _, _)
THEN
NOT DB_PLA_ZhentShipment_CanThrowAlchFire(1);

PROC
PROC_ConflictedFlind_OnStateChanged((FLAG)_Var1, _, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
_Var1 != PLA_ConflictedFlind_State_NotEncountered_c4bed850-2d45-4806-bc6d-5d778e60cde4
THEN
PROC_PLA_ZhentShipment_StopThrowingAlchFire();

IF
DialogStarted(PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716, _, _, _, _)
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _, _, _, _)
AND
GetFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
ClearFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogEnded(PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716, _, _, _, _)
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _, _, _, _)
AND
GetFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, NULL_00000000-0000-0000-0000-000000000000, 0, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a);

QRY
QRY_PLA_ZhentShipment_AgentsHaveFireFlasks()
AND
QRY_PLA_ZhentShipment_AgentsHaveFireFlaskOnTheGround()
THEN
DB_NOOP(1);

QRY
QRY_PLA_ZhentShipment_AgentsHaveFireFlasks()
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_AgentHasFireFlaskInInventory(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_PLA_ZhentShipment_AgentsHaveFireFlaskOnTheGround()
AND
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_PLA_ZhentShipment_AgentHasFireFlaskInInventory((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
TemplateIsInInventory(GRN_FireFlask_A_0b1aa718-fe45-4e4c-8811-ced51c581075, _Var1, _Var2, _Var1, _Var1)
AND
_Var2 > 0
THEN
DB_NOOP(1);

IF
TemplateRemovedFrom(GRN_FireFlask_A_0b1aa718-fe45-4e4c-8811-ced51c581075, (GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_StopThrowingIfNoFlasksLeft();

IF
TemplateAddedTo(GRN_FireFlask_A_0b1aa718-fe45-4e4c-8811-ced51c581075, (ITEM)_Var1, (GUIDSTRING)_Var2, _, (ITEM)_Var1)
AND
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1);
PROC_PLA_ZhentShipment_StopThrowingIfNoFlasksLeft();

IF
TemplateEnteredTrigger(GRN_FireFlask_A_0b1aa718-fe45-4e4c-8811-ced51c581075, (ITEM)_Var1, S_PLA_ZhentShipment_OwnershipTrigger_893e9484-b653-4032-af9f-cdc28009bf13, _, _)
AND
IsInInventory(_Var1, 0, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1);

IF
TemplateLeftTrigger(GRN_FireFlask_A_0b1aa718-fe45-4e4c-8811-ced51c581075, (GUIDSTRING)_Var1, S_PLA_ZhentShipment_OwnershipTrigger_893e9484-b653-4032-af9f-cdc28009bf13, _, _)
AND
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1);
PROC_PLA_ZhentShipment_StopThrowingIfNoFlasksLeft();

IF
DialogEnded(PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f, _, _, _, _)
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f);

IF
RequestPickpocket((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f);

IF
FlagSet(PLA_ZhentShipment_State_TouchedChest_1db4a628-dc86-4142-83cb-fe27d69532ef, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f);

PROC
PROC_PLA_ZhentShipment_StopThrowingIfNoFlasksLeft()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f);

PROC
PROC_PLA_ZhentShipment_StopThrowingIfNoFlasksLeft()
AND NOT
QRY_PLA_ZhentShipment_AgentsHaveFireFlasks()
AND
QRY_OnlyOnce("PLA_ZhentShipment_OnOutOfFlasks", _, _, _, _)
THEN
PROC_PLA_ZhentShipment_OnOutOfFlasks();
PROC_PLA_ZhentShipment_StopThrowingAlchFire();

IF
CastedSpell((CHARACTER)_Var1, "Projectile_PLA_FakeAlchemistFire", _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_CanThrowActualFlasks_dd620c49-a2c2-4f2b-9f09-a894e78ddc2f, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_TriggerEvents_AnyPartyMemberInTrigger(S_PLA_ZhentShipment_FlaskDepleteThrowingArea_938f9004-ca1e-4473-b3e9-2874d2ef8d25, _Var1, _Var1, _Var1, _Var1)
THEN
TemplateRemoveFrom(GRN_FireFlask_A_0b1aa718-fe45-4e4c-8811-ced51c581075, _Var1, 1);
PROC_PLA_ZhentShipment_StopThrowingIfNoFlasksLeft();
PROC_PLA_ZhentShipment_PickupFlaskIfNoLeftInInventory(_Var1);

PROC
PROC_PLA_ZhentShipment_PickupFlaskIfNoLeftInInventory((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce_Reset("PLA_ZhentShipment_TryPickupFlask", _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_AgentsHaveFireFlaskOnTheGround()
AND NOT
QRY_PLA_ZhentShipment_AgentHasFireFlaskInInventory(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_TryPickupFlask", _Var1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var1, _Var2, "PLA_ZhentShipment_Event_PickupFlask", 1);

PROC
PROC_PLA_ZhentShipment_OnOutOfFlasks()
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _, _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _, _, _, _)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "PLA_ZhentShipment_Event_OutOfFlasks", 1);
TimerLaunch("PLA_ZhentShipment_OnOutOfFlasks_Timer", 8000);

PROC
PROC_PLA_ZhentShipment_OnOutOfFlasks()
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _, _, _, _)
THEN
PROC_PLA_ZhentShipment_GnollsInstigatingAfterOutOfFlasks();

IF
TimerFinished("PLA_ZhentShipment_OnOutOfFlasks_Timer", _, _, _, _)
THEN
PROC_PLA_ZhentShipment_GnollsInstigatingAfterOutOfFlasks();

PROC
PROC_PLA_ZhentShipment_GnollsInstigatingAfterOutOfFlasks()
THEN
PROC_PLA_ConflictedFlind_StartInstigate(0);
PROC_PLA_ConflictedFlind_ChangeGnollsRelationToPlayers(0);
PROC_PLA_ZhentShipment_DefendPositions();

IF
EntityEvent((CHARACTER)_Var1, "PLA_ZhentShipment_Event_NoFlasksInPocket", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_StopThrowingIfNoFlasksLeft();
PROC_PLA_ZhentShipment_PickupFlaskIfNoLeftInInventory(_Var1);

IF
EntityEvent((ITEM)_Var1, "PLA_ZhentShipment_Event_FlaskUnreachable", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1);

IF
FlagSet(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, _, _, _, _)
AND
QRY_PLA_ZhentShipment_FindNextAgentToThrow()
AND
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var3, _, _, _, _)
THEN
SetEntityEvent(_Var3, "PLA_ZhentShipment_Event_PrepareThrow", 1);

IF
EntityEvent((GUIDSTRING)_Var1, "PLA_ConflictedFlind_Event_GnollRushesIntoFire", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_PLA_ZhentShipment_FindNextAgentToThrow()
AND
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var2, S_PLA_ConflictedFlind_BehindFireTrigger_850796f3-766e-4955-acf7-1490796ebe5a, "PLA_ZhentShipment_Event_PrepareThrow");
PROC_PLA_ZhentShipment_StartPreclusiveThrowingTimer();
DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(_Var2);

IF
TimerFinished("PLA_ZhentShipment_PreclusiveThrowing_Timer", _, _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_ZhentsThrowAlchFire_ce92177b-1162-4dc2-980f-ec64f3085c7a, _, _, _, _)
AND
QRY_PLA_ZhentShipment_FindNextAgentToThrow()
AND
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "PLA_ZhentShipment_Event_PrepareThrow", 1);
DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(_Var1);

IF
TimerFinished("PLA_ZhentShipment_PreclusiveThrowing_Timer", _, _, _, _)
AND
DB_PLA_ZhentShipment_CanThrowAlchFire(1, _, _, _, _)
THEN
PROC_PLA_ZhentShipment_StartPreclusiveThrowingTimer();

PROC
PROC_PLA_ZhentShipment_StartPreclusiveThrowingTimer()
AND
Random(5000, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var1, 7000, _Var2, _Var1, _Var1)
THEN
TimerCancel("PLA_ZhentShipment_PreclusiveThrowing_Timer");
TimerLaunch("PLA_ZhentShipment_PreclusiveThrowing_Timer", _Var2);

QRY
QRY_PLA_ZhentShipment_FindNextAgentToThrow()
AND
QRY_OnlyOnce_Reset("PLA_ZhentShipment_NextAgentToThrowFlask", _, _, _, _)
AND
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var1);

QRY
QRY_PLA_ZhentShipment_FindNextAgentToThrow()
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_AgentHasFireFlaskInInventory(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_NextAgentToThrowFlask", _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var1);

QRY
QRY_PLA_ZhentShipment_FindNextAgentToThrow()
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_AgentHasFireFlaskInInventory(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_NextAgentToThrowFlask", _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var1);

IF
DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
SysCount("DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown", 1, _Var2, _Var1, _Var1)
AND
SysCount("DB_PLA_ZhentShipment_AliveAgents", 1, _Var3, _Var1, _Var1)
AND
_Var2 >= _Var3
AND
DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
_Var4 != _Var1
THEN
NOT DB_PLA_ZhentShipment_PreviousAgentWhoHasThrown(_Var4);

IF
FlagSet(PLA_ZhentShipment_State_AgreedToHelpInBattle_185140b4-9dec-49d7-abad-e6e628cdf4cd, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_MakeZhentsAndPlayersAllies();

IF
DialogEnded(PLA_ZhentShipment_Agent_001_Cave_94dbe10c-0be7-7bef-85ee-35a617603716, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_Event_AgentsAttackGnolls_e9e42b1f-91ec-0779-013a-639bc8bc3f5e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_PlayerAgreedToHelpInDialog(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsAttackingGnolls(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentsStartCombat", _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_PlayerAgreedToHelpInDialog(_Var2);
DB_PLA_ZhentShipment_AgentsAttackingGnolls(1);
TimerLaunch("PLA_ZhentShipment_AgentsStartCombatThrow_Timer", 5000);
TimerLaunch("PLA_ZhentShipment_AgentsStartCombatRun_Timer", 10000);

IF
TimerFinished("PLA_ZhentShipment_AgentsStartCombatThrow_Timer", _, _, _, _)
AND
QRY_PLA_ZhentShipment_FindNextAgentToThrow()
AND
DB_PLA_ZhentShipment_NextAgentToThrowFlask(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var1, S_PLA_ConflictedFlind_GnollRanger02_BasePos_c85cb0a9-27cd-4524-a072-e121906b555d, "PLA_ZhentShipment_Event_PrepareThrow", 1);

IF
EntityEvent((GUIDSTRING)_Var1, "PLA_ZhentShipment_FireFlaskThrown", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_RunAwayAfterAttackingGnolls();

IF
EntityEvent((CHARACTER)_Var1, "PLA_ZhentShipment_Event_NoFlasksInPocket", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_RunAwayAfterAttackingGnolls();

IF
TimerFinished("PLA_ZhentShipment_AgentsStartCombatRun_Timer", _, _, _, _)
THEN
PROC_PLA_ZhentShipment_RunAwayAfterAttackingGnolls();

PROC
PROC_PLA_ZhentShipment_RunAwayAfterAttackingGnolls()
AND
DB_PLA_ZhentShipment_AgentsAttackingGnolls(1, _, _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_Event_AgentsAttackGnolls_e9e42b1f-91ec-0779-013a-639bc8bc3f5e, _, _, _, _)
THEN
NOT DB_PLA_ZhentShipment_AgentsAttackingGnolls(1);
PROC_PLA_ZhentShipment_CoverPositions();
PROC_PLA_ConflictedFlind_ChangeGnollsRelationToPlayers(0);
PROC_PLA_ConflictedFlind_StartInstigate(0);
TimerLaunch("PLA_ZhentShipment_AgentsStartCombatHostility_Timer", 3000);

IF
TimerFinished("PLA_ZhentShipment_AgentsStartCombatHostility_Timer", _, _, _, _)
THEN
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();

IF
TimerFinished("PLA_ZhentShipment_AgentsStartCombatHostility_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_Event_AgentsAttackGnolls_e9e42b1f-91ec-0779-013a-639bc8bc3f5e, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_EnterCombat(_Var1, S_PLA_ConflictedFlind_Boss_34464430-fed8-4f50-86d5-bd35846920a0);

IF
EnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_AgreedToHelpInBattle_185140b4-9dec-49d7-abad-e6e628cdf4cd, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_Event_AgentsAttackGnolls_e9e42b1f-91ec-0779-013a-639bc8bc3f5e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("PLA_ZhentShipment_EnterCombatOnZhentsStartFight", _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_PlayerAgreedToHelpInDialog(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var3, _, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_EnterCombatOnZhentsStartFight", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_EnterCombat(_Var3, _Var1);
PROC_GlobalClearFlagAndCache(PLA_ZhentShipment_Event_AgentsAttackGnolls_e9e42b1f-91ec-0779-013a-639bc8bc3f5e);

IF
LeftCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_PlayerAgreedToHelpInDialog(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_PlayerAgreedToHelpInDialog(_Var3);

PROC
PROC_PLA_ZhentShipment_CoverPositions()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff);
PROC_PLA_ZhentShipment_StopThrowingAlchFire();

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff, _, _, _, _)
THEN
ClearFlag(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_ZhentShipment_EnterCombatWithFlindToPlayAD()
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_PLA_ConflictedFlind_Boss_34464430-fed8-4f50-86d5-bd35846920a0, _, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Event_AgentsAttackGnolls_e9e42b1f-91ec-0779-013a-639bc8bc3f5e, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1);
PROC_PLA_ZhentShipment_ChangeRelationToFlind(0);

IF
RelationChanged(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, ACT1_PLA_ConflictedFlind_Flind_df4d741f-a2b3-c281-a3a4-111dac02f109, 0, 1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
PROC_EnterCombat(_Var1, S_PLA_ConflictedFlind_Boss_34464430-fed8-4f50-86d5-bd35846920a0);

IF
TurnEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_ZhentsAndGnollsHostile(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_ChangeRelationToFlind(50);
LeaveCombat(_Var2);

IF
EnterCombatFailed((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1);

IF
LeftCombat((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1);

PROC
PROC_PLA_ZhentShipment_OnGnollsHostileToZhents()
AND
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1);

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff, _, _, _, _)
THEN
ClearFlag(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_ZhentShipment_DefendPositions()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_OnDefensePositions_7ffc9c16-cffd-4fa1-8d76-32ceedbe3cc4, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_OnDefensePositions_7ffc9c16-cffd-4fa1-8d76-32ceedbe3cc4);
PROC_PLA_ZhentShipment_StopThrowingAlchFire();
PROC_PLA_ZhentShipment_StartMoveToDefendPositions();

PROC
PROC_PLA_ZhentShipment_DefendPositions()
AND
DB_GlobalFlag(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff, _, _, _, _)
THEN
ClearFlag(PLA_ZhentShipment_State_OnCoverPositions_4b302512-e44f-4960-b13b-03b0afc5b8ff, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_ZhentShipment_StartMoveToDefendPositions()
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStopDialogFor(_Var1);
SetHasDialog(_Var1, 0);

IF
EntityEvent((CHARACTER)_Var1, "PLA_ZhentShipment_Event_AtDefensePosition", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetHasDialog(_Var1, 1);

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var3, _, _, _, _)
THEN
SetHasDialog(_Var3, 1);

IF
EntityEvent((CHARACTER)_Var1, "PLA_ZhentShipment_Event_AtDefensePosition", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_OnZhentsArrivedOnDefensePos", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_OnZhentsArrivedOnDefensePos();

PROC
PROC_PLA_ZhentShipment_OnZhentsArrivedOnDefensePos()
AND NOT
QRY_PLA_ZhentShipment_PlayersAndGnollsAreFighting()
THEN
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();

PROC
PROC_PLA_ZhentShipment_OnZhentsArrivedOnDefensePos()
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_SetZhentsAndGnollsHostileSecondRound(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_SetZhentsAndGnollsHostileSecondRound", _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_SetZhentsAndGnollsHostileSecondRound(_Var2);

IF
CombatRoundStarted((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_SetZhentsAndGnollsHostileSecondRound(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 > 0
THEN
NOT DB_PLA_ZhentShipment_SetZhentsAndGnollsHostileSecondRound(_Var1);
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_OnDefensePositions_7ffc9c16-cffd-4fa1-8d76-32ceedbe3cc4, _, _, _, _)
THEN
ClearFlag(PLA_ZhentShipment_State_OnDefensePositions_7ffc9c16-cffd-4fa1-8d76-32ceedbe3cc4, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_GlobalFlagReactionAfterDialog(PLA_ZhentShipment_Event_ProvokeGnolls_b7fe3fee-61ce-7d8d-64a6-519f0dc610cb, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
THEN
PROC_PLA_ConflictedFlind_StartInstigate(0);
PROC_PLA_ConflictedFlind_ChangeGnollsRelationToPlayers(0);
PROC_PLA_ZhentShipment_DefendPositions();

IF
EnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_OnEnteredCombat(_Var2);

IF
EnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_OnEnteredCombat(_Var2);

PROC
PROC_PLA_ZhentShipment_OnEnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_AgreedToHelpInBattle_185140b4-9dec-49d7-abad-e6e628cdf4cd, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ConflictedFlind_FlindNotTurnedOnGnollsOrKilledThemOrDead()
AND
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1);
PROC_PLA_ZhentShipment_StopThrowingAlchFire();

PROC
PROC_PLA_ZhentShipment_OnEnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_Event_ProvokeGnolls_b7fe3fee-61ce-7d8d-64a6-519f0dc610cb, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1);
PROC_PLA_ZhentShipment_StopThrowingAlchFire();

PROC
PROC_PLA_ZhentShipment_OnEnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Event_ProvokeGnolls_b7fe3fee-61ce-7d8d-64a6-519f0dc610cb, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_IsAnyPlayerInCombatAndInCave(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1);

PROC
PROC_PLA_ZhentShipment_OnEnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Is_InCombat(S_PLA_ConflictedFlind_Boss_34464430-fed8-4f50-86d5-bd35846920a0, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_AgreedToHelpInBattle_185140b4-9dec-49d7-abad-e6e628cdf4cd, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_OnDefensePositions_7ffc9c16-cffd-4fa1-8d76-32ceedbe3cc4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Event_ProvokeGnolls_b7fe3fee-61ce-7d8d-64a6-519f0dc610cb, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_PLA_ZhentShipment_IsAnyPlayerInCombatAndInCave(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1);
PROC_PLA_ZhentShipment_CoverPositions();
PROC_PLA_ZhentShipment_EnterCombatWithFlindToPlayAD();

PROC
PROC_PLA_ZhentShipment_OnEnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_AgreedToHelpInBattle_185140b4-9dec-49d7-abad-e6e628cdf4cd, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_AgentsReactedOnCombatStart(1);

QRY
QRY_PLA_ZhentShipment_IsAnyPlayerInCombatAndInCave((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, S_PLA_ZhentShipment_InsideCaveCombatArea_1482ce04-5188-4759-a548-f609c6e74181, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_OnAgentEnteredCombat(_Var1, _Var2);

PROC
PROC_PLA_ZhentShipment_OnAgentEnteredCombat(_, _, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
PROC_PLA_ZhentShipment_StopThrowingAlchFire();

PROC
PROC_PLA_ZhentShipment_OnAgentEnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentsJoinCombatWithGnolls", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92);

IF
EnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentsJoinCombatWithGnolls", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92);

PROC
PROC_PLA_ZhentShipment_OnGnollsHostileToZhents()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Event_ProvokeGnolls_b7fe3fee-61ce-7d8d-64a6-519f0dc610cb, _, _, _, _)
AND
DB_PLA_ZhentShipment_AliveAgents(_, _, _, _, _)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentsJoinCombatWithGnolls", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92);

IF
FlagSet(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, NULL_00000000-0000-0000-0000-000000000000, 0, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);

PROC
PROC_PLA_ZhentShipment_RegisterGnollsBorder()
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(TRIGGERGUID_S_PLA_ZhentShipment_GnollsBorderTrigger_f42b580d-5dec-4261-959c-27cfeaec20a0, _Var1);

IF
EnteredTrigger((CHARACTER)_Var1, TRIGGERGUID_S_PLA_ZhentShipment_GnollsBorderTrigger_f42b580d-5dec-4261-959c-27cfeaec20a0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_OnDefensePositions_7ffc9c16-cffd-4fa1-8d76-32ceedbe3cc4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();

PROC
PROC_PLA_ZhentShipment_TryInstigateAfterGnollEntersBorder()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_AgreedToHelpInBattle_185140b4-9dec-49d7-abad-e6e628cdf4cd, _, _, _, _)
THEN
PROC_PLA_ConflictedFlind_StartInstigate(0);

IF
EnteredTrigger((CHARACTER)_Var1, TRIGGERGUID_S_PLA_ZhentShipment_GnollsBorderTrigger_f42b580d-5dec-4261-959c-27cfeaec20a0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_UnregisterGnollsBorder();

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_JoinedFightWithGnolls_834c500f-8718-47b5-b320-8d37b2ad9b92, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_PLA_ZhentShipment_GnollsBorderTrigger_f42b580d-5dec-4261-959c-27cfeaec20a0, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_UnregisterGnollsBorder();

IF
FlagSet(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_UnregisterGnollsBorder();

PROC
PROC_PLA_ZhentShipment_DefendPositions()
THEN
PROC_PLA_ZhentShipment_UnregisterGnollsBorder();

PROC
PROC_PLA_ZhentShipment_UnregisterGnollsBorder()
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(TRIGGERGUID_S_PLA_ZhentShipment_GnollsBorderTrigger_f42b580d-5dec-4261-959c-27cfeaec20a0, _Var1);

PROC
PROC_PLA_ZhentShipment_UnregisterGnollsBorder()
THEN
PROC_TriggerUnregisterForParty(TRIGGERGUID_S_PLA_ZhentShipment_GnollsBorderTrigger_f42b580d-5dec-4261-959c-27cfeaec20a0);

IF
TurnEnded((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("PLA_ZhentShipment_GnollsJoinCombatWithZhents", _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_AnyPlayersInCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ZhentShipment_ReadyToProvokeGnolls(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_ZhentShipment_ReadyToProvokeGnolls(_Var1);

IF
DB_PLA_ZhentShipment_ReadyToProvokeGnolls(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_TryProvokeGnolls();

IF
LeftCombat((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_TryProvokeGnolls();

PROC
PROC_PLA_ZhentShipment_TryProvokeGnolls()
AND
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _, _, _, _)
AND
SysCount("DB_PLA_ZhentShipment_ReadyToProvokeGnolls", 1, _Var1, _Var1, _Var1)
AND
SysCount("DB_PLA_ZhentShipment_AliveAgents", 1, _Var2, _Var1, _Var1)
AND
_Var1 >= _Var2
THEN
PROC_PLA_ConflictedFlind_StartInstigate(0);
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();
PROC_PLA_ConflictedFlind_ChangeGnollsRelationToPlayers(0);

QRY
QRY_PLA_ZhentShipment_AnyPlayersInCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
AttackedBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _Var1, _Var1, _Var1, _Var1)
AND
GetRelation(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var8, _Var1, _Var1)
AND
_Var8 < 50
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1);

IF
RelationChanged(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, (FACTION)_Var1, (INTEGER)_Var2, _, (FACTION)_Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_ConflictedFlind_InstigatingAlliedWithGnolls(1, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 < 50
AND
DB_PartyMembers(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
GetFaction(_Var4, _Var5, _Var1, _Var1, _Var1)
AND
_Var1 == _Var5
AND
QRY_OnlyOnce("PLA_ZhentShipment_PlayersAttackedAgentsRelationChanged", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1);

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
QRY_PLA_ZhentShipment_AnyPlayersInCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_GnollsJoinCombatWithZhents", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ConflictedFlind_StartInstigate(0);
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();
PROC_PLA_ConflictedFlind_ChangeGnollsRelationToPlayers(0);

IF
FlagSet(PLA_ZhentShipment_Agent_001_ToldToMeet_d7f2080d-45aa-fb89-578e-947b3e21cb46, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_TalkedAfterKilledGnolls_8c60be2a-fb0a-ec52-ca14-883cab378dc0, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e);

IF
DB_GlobalFlag(PLA_ZhentShipment_State_TalkedAfterKilledGnolls_8c60be2a-fb0a-ec52-ca14-883cab378dc0, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_ZhentShipment", "AgreedHelp", 1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e);

IF
FlagSet(PLA_ZhentShipment_Event_TalkedToOllyAfterCombat_b5927ed5-cfa3-fd2b-aaf2-425eb069b899, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e);

IF
FlagSet(PLA_ZhentShipment_Event_TalkedToOllyAfterCombat_b5927ed5-cfa3-fd2b-aaf2-425eb069b899, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_TalkedAfterKilledGnolls_8c60be2a-fb0a-ec52-ca14-883cab378dc0, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_TalkedAfterKilledGnolls_8c60be2a-fb0a-ec52-ca14-883cab378dc0);

IF
LeftTrigger((GUIDSTRING)_Var1, S_PLA_Plains_SUB_bcc3efa5-bfe1-4224-9df1-6758cac764cd, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_TriggerEvents_AnyPartyMemberInTrigger(S_PLA_ZhentShipment_Cave_DangerZone_0aa90ecf-f46e-441e-ac25-8a9e236f2738, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_LeftCave_ae55c369-a884-41d7-9622-ad49ae1b019c, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_RemoveAgentsFromTheCave", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave();

PROC
PROC_LongRest()
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_TriggerEvents_AnyPartyMemberInTrigger(S_PLA_ZhentShipment_Cave_DangerZone_0aa90ecf-f46e-441e-ac25-8a9e236f2738, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_ReadyToLeaveCave_e458690a-ebd9-a0a1-e44e-acca93224b3e, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_ZhentShipment_Quest_AttackedAgents_9efe32a4-5418-91b3-3674-6bfb15b2dda1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_PLA_ZhentShipment_SomePlayerHasChest()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_LeftCave_ae55c369-a884-41d7-9622-ad49ae1b019c, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_RemoveAgentsFromTheCave", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave();

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_LeftCave_ae55c369-a884-41d7-9622-ad49ae1b019c, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_LeftCave_ae55c369-a884-41d7-9622-ad49ae1b019c);

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a, _, _, _, _)
AND
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInInventory(_Var1, 0, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a, _, _, _, _)
THEN
PROC_PLA_ZhentShipment_RemoveItemFromCave(S_PLA_ZhentShipment_ZhentBackpack_000_1bd43073-7a20-4dd9-879e-8c6a2584c545);

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a, _, _, _, _)
THEN
PROC_PLA_ZhentShipment_RemoveItemFromCave(S_PLA_ZhentShipment_Bag_000_c3513515-0b7b-4f2e-a3b1-52e308998612);

PROC
PROC_PLA_ZhentShipment_RemoveItemFromCave((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
GetOwner(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var1, 1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
THEN
PROC_PLA_ZhentShipment_StopThrowingAlchFire();

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
THEN
PROC_PLA_ZhentShipment_AgentsStopSpotting();

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
AND NOT
DB_Defeated(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _, _, _, _)
AND
DB_Defeated(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, _, _, _, _)
THEN
PROC_PLA_ZhentShipment_LootSecondAgent();

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_AgentLeaveCave(_Var1);

PROC
PROC_PLA_ZhentShipment_AgentLeaveCave((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveSplatters(_Var1);
SetEntityEvent(_Var1, "PLA_ZhentShipment_Event_LeftCave");

PROC
PROC_PLA_ZhentShipment_AgentLeaveCave((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_State_ChestLost_a672d90e-72fa-4ce3-8152-6969e39ab521, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SelfHealing_Enable(_Var1);

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
THEN
TriggerUnregisterForItems(S_PLA_ZhentShipment_OwnershipTrigger_893e9484-b653-4032-af9f-cdc28009bf13);

PROC
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave()
THEN
PROC_PLA_ZhentShipment_ClearItemsOwnershipFromTrigger();

IF
FlagSet(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_ClearItemsOwnershipFromTrigger();

PROC
PROC_PLA_ZhentShipment_ClearItemsOwnershipFromTrigger()
THEN
TriggerClearItemsOwner(S_PLA_ZhentShipment_OwnershipTrigger_893e9484-b653-4032-af9f-cdc28009bf13);

IF
FlagSet(PLA_ZhentShipment_State_AgreedToHelpInBattle_185140b4-9dec-49d7-abad-e6e628cdf4cd, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_ClearFlaskOwnership();

IF
FlagSet(PLA_ZhentShipment_State_TalkedAfterKilledGnolls_8c60be2a-fb0a-ec52-ca14-883cab378dc0, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_ClearFlaskOwnership();

PROC
PROC_PLA_ZhentShipment_ClearFlaskOwnership()
AND
DB_PLA_ZhentShipment_FireFlasksOnTheGround(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInInventory(_Var1, 0, _Var1, _Var1, _Var1)
THEN
ClearOwnership(_Var1);

IF
EntityEvent(_, "PLA_ZhentShipment_Looting", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PLA_ZhentShipment_LootSecondAgent();

PROC
PROC_PLA_ZhentShipment_LootSecondAgent()
AND NOT
DB_OnlyOnce("PLA_ZhentShipment_LootSecondAgent", _, _, _, _)
AND
GetGold(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 > 0
AND
IntegerProduct(-1, _Var1, _Var2, _Var1, _Var1)
THEN
DB_OnlyOnce("PLA_ZhentShipment_LootSecondAgent");
AddGold(S_PLA_ZhentShipment_Agent_001_fd9b4edd-7828-4e22-85a9-ead2ba9d29e4, _Var1);
AddGold(S_PLA_ZhentShipment_Agent_002_7eda738e-8a85-4975-a1e1-1b3b2c4d641c, _Var2);

PROC
PROC_PLA_ZhentShipment_ChangeRelationToFlind((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_SetRelation(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, ACT1_PLA_ConflictedFlind_Flind_df4d741f-a2b3-c281-a3a4-111dac02f109, _Var1);

PROC
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile()
AND NOT
DB_PLA_ZhentShipment_ZhentsAndGnollsHostile(1, _, _, _, _)
THEN
DB_PLA_ZhentShipment_ZhentsAndGnollsHostile(1);
PROC_SetRelationMutual(ACT1_PLA_ConflictedFlind_GnollPack_6f5c2543-dadb-7f16-94d4-9c7e5f23acf2, ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, 0);
PROC_SetRelationMutual(ACT1_PLA_ConflictedFlind_Flind_df4d741f-a2b3-c281-a3a4-111dac02f109, ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, 0);

PROC
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile()
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);

PROC
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile()
THEN
PROC_PLA_ZhentShipment_UnregisterGnollsBorder();

IF
RelationChanged(ACT1_PLA_ConflictedFlind_GnollPack_6f5c2543-dadb-7f16-94d4-9c7e5f23acf2, ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, (INTEGER)_Var1, _, (INTEGER)_Var1)
AND
_Var1 < 50
THEN
PROC_PLA_ZhentShipment_OnGnollsHostileToZhents();

PROC
PROC_PLA_ZhentShipment_MakeZhentsAndPlayersHostile()
AND NOT
QRY_PLA_ZhentShipment_AreZhentsAndPlayersHostile()
THEN
PROC_SetRelationMutual(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);

PROC
PROC_PLA_ZhentShipment_MakeZhentsAndPlayersAllies()
AND
GetRelation(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var1, _Var1, _Var1)
AND
_Var1 < 100
THEN
PROC_SetRelationMutual(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100);

QRY
QRY_PLA_ZhentShipment_AreZhentsAndPlayersHostile()
AND
GetRelation(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var1, _Var1, _Var1)
AND
_Var1 < 50
THEN
DB_NOOP(1);

QRY
QRY_PLA_ZhentShipment_AreZhentsAndPlayerHostile((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFaction(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetRelation(ACT1_PLA_ShipmentZhents_Cave_4ab6ad89-f96c-7ac4-5e5b-142925bf56b9, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 < 50
THEN
DB_NOOP(1);

IF
Dying((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(PLA_ZhentShipment_State_BothAgentsAreAlive_d7404f8a-8101-90c1-3105-0b49cddf7e1f, NULL_00000000-0000-0000-0000-000000000000, 0);
NOT DB_PLA_ZhentShipment_AliveAgents(_Var1);
PROC_PLA_ZhentShipment_StopThrowingAlchFire();
PROC_PLA_ZhentShipment_TrySetStateDeadAgentsFlag();

PROC
PROC_PLA_ZhentShipment_TrySetStateDeadAgentsFlag()
AND NOT
DB_PLA_ZhentShipment_AliveAgents(_, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_State_SurvivorsAreDead_bb54af09-b0c2-46c2-84e8-642280ccec6a);

IF
KilledBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Gone_4152beef-e7d1-e10f-7b06-62584d3571f2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_ConflictedFlind_State_Instigate_273fb05a-4c2c-4816-8458-7af837d919a2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_MakeZhentsAndPlayersHostile();
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();
PROC_PLA_ConflictedFlind_StartInstigate(0);

IF
FlagSet(PLA_ZhentShipment_State_Agent001Dead_62feb5b3-ecfd-4e43-ba22-e52d4e352f46, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_PLA_ZhentShipment_TrySetSeenDeadAgentsFlag();

IF
FlagSet(PLA_ZhentShipment_State_Agent002Dead_f51a12b5-e82a-4d88-a8c9-46ad0375107a, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_PLA_ZhentShipment_TrySetSeenDeadAgentsFlag();

PROC
PROC_PLA_ZhentShipment_TrySetSeenDeadAgentsFlag()
AND NOT
DB_GlobalFlag(PLA_ZhentShipment_Knows_SurvivorsAreDead_d889b0c1-89aa-480f-9735-b24f04525453, _, _, _, _)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_ZhentShipment_Knows_Agent001Dead_62feb5b3-ecfd-4e43-ba22-e52d4e352f46, _Var1, 1, _Var1, _Var1)
AND
GetFlag(PLA_ZhentShipment_Knows_Agent002Dead_f51a12b5-e82a-4d88-a8c9-46ad0375107a, _Var1, 1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_State_SurvivorsAreDeadFlagSet", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_ZhentShipment_Knows_SurvivorsAreDead_d889b0c1-89aa-480f-9735-b24f04525453);

QRY
QRY_PLA_ZhentShipment_PlayersAndGnollsAreFighting()
AND
DB_PLA_ConflictedFlind_GnollPack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayer((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var4, _Var2, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentsJoinFightWithGnolls", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();
PROC_EnterCombat(_Var4, _Var3);

QRY
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayers((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_ZhentShipment_AgentsJoinFightWithGnolls", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_ZhentShipment_MakeZhentsAndGnollsHostile();
PROC_EnterCombat(_Var4, _Var2);

QRY
QRY_PLA_ZhentShipment_EnterCombatWithGnollsAndPlayers(_, _, _, _, _)
AND
DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var2, _, _, _, _)
THEN
NOT DB_PLA_ZhentShipment_ZhentEnteredCombatJustForAD(_Var2);

QRY
QRY_PLA_ZhentShipment_AnyAgentInCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_ZhentShipment_AliveAgents(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_PLA_ZhentShipment_DisableCrimesOnGnolls()
AND
DB_PLA_ZhentShipment_Agents(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_ConflictedFlind_GnollPack(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_AssaultFamilyIgnoreFor(_Var1, _Var2);
DB_MurderIgnoreFor(_Var1, _Var2);

IF
TextEvent("PLA_ZhentShipment_ZhentsToHideout", _, _, _, _)
THEN
SetFlag(PLA_ZhentShipment_Quest_HasMet_5359e72b-f8ca-d2d6-4c3a-8fc00efe5c2c, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(Debug_PLA_KillGnolls_5283045d-9655-55aa-0a55-213b7808f23c, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(PLA_ZhentShipment_State_TalkedAfterKilledGnolls_8c60be2a-fb0a-ec52-ca14-883cab378dc0, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave();

IF
TextEvent("PLA_ZhentShipment_ZhentsToHideout_TiedUp", _, _, _, _)
THEN
SetFlag(PLA_ZhentShipment_State_ChestLost_a672d90e-72fa-4ce3-8152-6969e39ab521, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(PLA_ZhentShipment_Quest_HasMet_5359e72b-f8ca-d2d6-4c3a-8fc00efe5c2c, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(Debug_PLA_KillGnolls_5283045d-9655-55aa-0a55-213b7808f23c, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(PLA_ZhentShipment_State_TalkedAfterKilledGnolls_8c60be2a-fb0a-ec52-ca14-883cab378dc0, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_PLA_ZhentShipment_RemoveAgentsFromTheCave();

IF
TextEvent("PLA_ZhentShipment_TestJournal", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_ZhentShipment", "NoticedStruggle_Cave");
QuestUpdate(_Var1, "PLA_ZhentShipment", "FoundOrders");

IF
TextEvent("PLA_ZhentShipment_StartZarys", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_ZhentShipment", "AgreedHelp");


EXITSECTION
PROC_TriggerUnregisterForParty(S_PLA_ZhentShipment_NoticingZhentsArea_9741f301-f369-4ecc-b9f1-fe48d8bb107a);
PROC_TriggerUnregisterForPlayers(TRIGGERGUID_S_PLA_ZhentShipment_WreckedCaravanArea_86c8011d-dc85-4b6f-ac98-fb8a60ae5b3a);
PROC_PLA_ZhentShipment_UnregisterGnollsBorder();
ENDEXITSECTION

ParentTargetEdge "Act1"
