Version 1
SubGoalCombiner SGC_AND

INITSECTION
PROC_TriggerRegisterForPlayers(S_DEN_AttackOnDenArea_66fa72fc-fd29-4608-89c1-6048467f4091);
PROC_TriggerRegisterForPlayers(S_DEN_AttackOnDenArea_Hideout_e8a663e9-2468-4a64-9127-62632507545f);
PROC_TriggerRegisterForPlayers(S_DEN_AttackOnDenArea_Druid_c940e172-79b0-4be3-b44d-dbdb3224e91f);
PROC_TriggerRegisterForPlayers(S_DEN_AttackOnDenArea_Vault_3c313775-1c89-4f98-9f0b-61a135135461);
TriggerRegisterForItems(S_DEN_FilledBarrelArea_4f668069-16b2-44fb-9f82-21ce86135058);
TriggerRegisterForItems(S_DEN_BarrelArea_72b42a80-92ac-4f80-bdb9-eb665de0656a);
SetForceUpdate(S_DEN_BattleHorn_baf1a4c5-b6f9-48c2-908d-164b967655d5, 1);
DB_DEN_AttackOnDen_CaveCombatPos(S_DEN_CaveCombatPos_001_b093864b-d0da-43ff-b730-9c7c5aa35cc9);
DB_DEN_AttackOnDen_CaveCombatPos(S_DEN_CaveCombatPos_002_ca70ee39-2c27-4577-88be-3a7c3a1803c5);
DB_DEN_AttackOnDen_CaveCombatPos(S_DEN_CaveCombatPos_003_651db5d1-92bb-41fc-9278-ebd67ee60ba8);
DB_DEN_AttackOnDen_CaveCombatPos(S_DEN_CaveCombatPos_004_6e57e217-e5c4-4a1c-a9b8-85a7e935e5ae);
DB_DEN_AttackOnDen_RoleFactions("Gate", ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f);
DB_DEN_AttackOnDen_RoleFactions("Cave", ACT1_DEN_AttackOnDen_Cave_be9ef27b-18d4-4168-a798-5c6b744e0c08);
DB_DEN_AttackOnDen_RoleFactions("Defenseless", ACT1_DEN_AttackOnDen_Defenseless_0d52984d-82c0-44b3-861c-5f8107982525);
DB_DEN_AttackOnDen_RoleFactions("Defenseless Offstage", ACT1_DEN_AttackOnDen_Defenseless_0d52984d-82c0-44b3-861c-5f8107982525);
DB_DEN_AttackOnDen_RoleFactions("Hideout", ACT1_DEN_AttackOnDen_Defenseless_0d52984d-82c0-44b3-861c-5f8107982525);
DB_DEN_AttackOnDen_RoleFactions("Lair", ACT1_DEN_AttackOnDen_Druid_7347ff55-56c1-4997-b6d1-22e5f29e86d9);
DB_DEN_AttackOnDen_RoleFactions("Lair Offstage", ACT1_DEN_AttackOnDen_Druid_7347ff55-56c1-4997-b6d1-22e5f29e86d9);
DB_DEN_AttackOnDen_RoleCombat("Gate", "DEN_AttackOnDen_GateCombat");
DB_DEN_AttackOnDen_RoleCombat("Cave", "DEN_AttackOnDen_CaveCombat");
DB_DEN_AttackOnDen_RoleCombat("Defenseless", "DEN_AttackOnDen_DefenselessCombat");
DB_DEN_AttackOnDen_RoleCombat("Lair", "DEN_AttackOnDen_DruidCombat");
DB_DEN_AttackOnDen_CombatGroupAreas("Cave", S_DEN_CaveCombatGroupArea_ddeef8aa-793e-42f0-9b15-b4e5edb16b28);
DB_DEN_AttackOnDen_CombatGroupAreas("Defenseless", S_DEN_DefenselessCombatGroupArea_fca0b8be-5db4-4ddc-a53a-1e5414529e5b);
DB_DEN_AttackOnDen_CombatGroupAreas("Lair", S_DEN_DruidCombatGroupArea_3a127577-6dd8-42f1-8203-550904142b2a);
DB_DEN_AttackOnDen_TieflingDefeatCounters("DEN_AttackOnDen_GateCombat");
DB_DEN_AttackOnDen_TieflingDefeatCounters("DEN_AttackOnDen_CaveCombat");
DB_DEN_AttackOnDen_TieflingDefeatCounters("DEN_AttackOnDen_DefenselessCombat");
DB_GLO_DefeatCounter(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "DEN_AttackOnDen_RaiderCombat");
DB_GLO_DefeatCounter_Target("DEN_AttackOnDen_RaiderCombat", 1);
DB_DEN_AttackOnDen_Raiders(S_GOB_RaiderBold_1c9fd1dd-12bc-4b81-acb8-9eef54174c55, S_DEN_GateAttackPos_001_d819ed19-9602-4488-aa3b-3f95c4c42e82, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_RaiderHardy_6687f78f-5d6a-40d4-8cfd-2b972dacde3c, S_DEN_GateAttackPos_002_b9778d54-6057-460e-b7af-a2a1f8a4e594, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_RaiderHefty_fcbb04a8-f4e6-4065-901c-1a4a708ccd54, S_DEN_GateAttackPos_003_5555c05a-a220-446c-86c2-74362c9947fe, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Sapper_001_392146c2-0849-4250-b907-e4fb9a13ddcf, S_DEN_GateAttackPos_004_2af1f574-7aed-44e5-b5e6-d2677c729185, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_RaiderStupid_5d049dbe-ff35-45be-88f9-5f999dc0ffe4, S_DEN_GateAttackPos_005_a57a9ec8-bf51-49d6-8305-40d034cc615d, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_RaiderCunning_abdd3748-0834-46f3-8214-18dd4dca9d40, S_DEN_GateAttackPos_006_c2279d0e-5295-4f81-92c0-9011aba71f78, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_RaiderChieftain_5bac0842-c1d4-4358-a85c-24ab745d0280, S_DEN_GateAttackPos_007_240d1673-0fe6-4b68-ad91-527fbd649425, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_GoblinLush_d738c9a4-a031-4dd9-912f-93cda8d8d8b7, S_DEN_GateAttackPos_008_4b0d02bf-9d84-4218-b2ef-1df62a03c0e1, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, S_DEN_GateAttackPos_009_25a4802a-8d2a-4301-8bac-bde91385e03a, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41, S_DEN_GateAttackPos_010_25ae7fb8-861c-400f-ac9b-d7ca52da55d4, S_DEN_RaidersAppearPos_7e13b040-c9ef-43dc-9541-099a013f4072, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b, S_DEN_GateAttackPos_013_a50c358e-41e6-4eeb-b56f-11bd5b6a58a7, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Sapper_003_4264ba13-c816-405c-bc55-9f91dcfd9793, S_DEN_GateAttackPos_014_8e118020-c75a-444e-9730-ff3b9095b7c2, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Bugbear_001_5673d584-cce4-4688-bc50-c0da7eb252ec, S_DEN_GateAttackPos_016_bd344ea0-86f9-4a4a-9874-9651486ac38b, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Melee_001_ebe03162-0d2d-4d9c-a5b2-aff64610479b, S_DEN_GateAttackPos_017_d834cd8b-ee34-48f2-a29f-1bec3d2047ac, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Ranged_001_12c5dc1a-f738-48bb-8b11-88a7899ec199, S_DEN_GateAttackPos_018_60d1d75b-f446-45e2-babe-945e94fe88d9, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Sapper_004_1b6dba51-be8b-47ac-a73b-94c29e56bbad, S_DEN_GateAttackPos_019_fd42261d-98de-43e0-96a9-538579291cc7, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Bugbear_002_e6af67ed-d549-4165-817c-78cb489f3020, S_DEN_GateAttackPos_020_75c8cc72-8217-4dc3-9794-809ec103d3d0, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Spider_001_16614e7b-b200-45f3-83fb-dded3641861f, S_DEN_GateAttackPos_021_b95cfacd-9cd6-4758-9a14-fca866f3316f, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Spider_002_de05b62e-6306-46e1-9f2f-2ac6554d0316, S_DEN_GateAttackPos_022_38cb2fd6-6aee-44f0-a999-45fc4ba4d4c3, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_Raiders(S_GOB_AttackOnDen_Ogre_001_04695229-6f1d-433c-8e74-88e21e720e9a, S_DEN_GateAttackPos_023_7a7220e0-750f-437f-b6ba-e345f1d74294, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_AttackOnDen_Sapper_001_392146c2-0849-4250-b907-e4fb9a13ddcf);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_AttackOnDen_Sapper_003_4264ba13-c816-405c-bc55-9f91dcfd9793);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_AttackOnDen_Sapper_004_1b6dba51-be8b-47ac-a73b-94c29e56bbad);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_RaiderCunning_abdd3748-0834-46f3-8214-18dd4dca9d40);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_RaiderHardy_6687f78f-5d6a-40d4-8cfd-2b972dacde3c);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_RaiderBold_1c9fd1dd-12bc-4b81-acb8-9eef54174c55);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_RaiderStupid_5d049dbe-ff35-45be-88f9-5f999dc0ffe4);
DB_DEN_AttackOnDen_VictoryRaiders(S_GOB_GoblinLush_d738c9a4-a031-4dd9-912f-93cda8d8d8b7);
DB_DEN_AttackOnDen_CaveRaiders(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
DB_DEN_AttackOnDen_CaveRaiders(S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41);
DB_DEN_AttackOnDen_CaveRaiders(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b);
DB_DEN_AttackOnDen_CaveRaiders(S_GOB_RaiderChieftain_5bac0842-c1d4-4358-a85c-24ab745d0280);
DB_DEN_AttackOnDen_CaveHoldRaiders(S_GOB_RaiderHefty_fcbb04a8-f4e6-4065-901c-1a4a708ccd54);
DB_DEN_AttackOnDen_CaveHoldRaiders(S_GOB_AttackOnDen_Melee_001_ebe03162-0d2d-4d9c-a5b2-aff64610479b);
DB_DEN_AttackOnDen_CaveHoldRaiders(S_GOB_AttackOnDen_Ranged_001_12c5dc1a-f738-48bb-8b11-88a7899ec199);
DB_DEN_AttackOnDen_SafeRaiders(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
DB_DEN_AttackOnDen_SafeRaiders(S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41);
DB_DEN_AttackOnDen_SafeRaiders(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b);
DB_DEN_AttackOnDen_DruidRaiders(S_GOB_RaiderViolent_71620f09-46cb-4c03-b874-7c97926e6fbf);
DB_DEN_AttackOnDen_DruidRaiders(S_GOB_RaiderCrafty_d0269a95-45f2-4877-b301-0c1740f3dd7d);
DB_DEN_AttackOnDen_DruidRaiders(S_GOB_RaiderFunny_b1e2d6a7-0fad-4485-ae2e-2ec78ce4e658);
DB_DEN_AttackOnDen_DruidRaiders(S_GOB_RaiderBossy_de48bba2-e616-4db1-9d1c-76c1f285927f);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_DrowPos_41dc4e47-8a7e-42f6-af43-03dcca94e2a4);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderBold_1c9fd1dd-12bc-4b81-acb8-9eef54174c55, S_DEN_BoldPos_39a98c09-cb80-4ff4-8f88-f08fe0f52631);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderHardy_6687f78f-5d6a-40d4-8cfd-2b972dacde3c, S_DEN_HardyPos_84708263-2be9-454a-a3a3-f2754cda7ee2);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderHefty_fcbb04a8-f4e6-4065-901c-1a4a708ccd54, S_DEN_HeftyPos_4b560ea9-8fb0-4dec-862d-2dda75fa67ff);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_AttackOnDen_Sapper_001_392146c2-0849-4250-b907-e4fb9a13ddcf, S_DEN_SapperPos001_209a56f9-3245-48c0-8ed3-f533087ebee8);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderStupid_5d049dbe-ff35-45be-88f9-5f999dc0ffe4, S_DEN_StupidPos_a92f2737-8cd0-47c9-afc8-1546e0719eaa);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderCunning_abdd3748-0834-46f3-8214-18dd4dca9d40, S_DEN_CunningPos_80492b7b-fd2f-4685-a3e2-b635930232f8);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderChieftain_5bac0842-c1d4-4358-a85c-24ab745d0280, S_DEN_ChieftainPos_03b445f3-d44d-44a3-bd77-eba49549721c);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_GoblinLush_d738c9a4-a031-4dd9-912f-93cda8d8d8b7, S_DEN_LushPos_4027ab10-1e1f-4736-9fc5-4b543f4bc976);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, S_DEN_BravePos_5cb9b648-734a-4fd3-89fc-91200a3319e7);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41, S_DEN_GrumpyPos_f807db88-9848-4ad2-8518-85ae3cd300db);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b, S_DEN_ArrogantPos_61298c4e-5a1d-4263-93db-c2ebbbbd40e5);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_AttackOnDen_Sapper_003_4264ba13-c816-405c-bc55-9f91dcfd9793, S_DEN_SapperPos003_47775bd3-9447-4999-a487-7ae1878e08e9);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_AttackOnDen_Melee_001_ebe03162-0d2d-4d9c-a5b2-aff64610479b, S_DEN_MeleePos_33fd76ca-9deb-42f4-9a94-2ee3251154d9);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_AttackOnDen_Ranged_001_12c5dc1a-f738-48bb-8b11-88a7899ec199, S_DEN_RangedPos_8997c989-32bb-495d-9689-507d3ef7eba1);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_AttackOnDen_Sapper_004_1b6dba51-be8b-47ac-a73b-94c29e56bbad, S_DEN_SapperPos004_acf9311e-612d-4282-9bfc-48495e5b3ae5);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderFunny_b1e2d6a7-0fad-4485-ae2e-2ec78ce4e658, S_DEN_PeeingGoblinPos_001_87c0bba6-bbdc-4fcf-b7a3-a54896aec73b);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderCrafty_d0269a95-45f2-4877-b301-0c1740f3dd7d, S_DEN_PeeingGoblinPos_002_5c9000a7-a8a1-47ba-a4e2-b7a32f6ff77e);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderBossy_de48bba2-e616-4db1-9d1c-76c1f285927f, S_DEN_PeeingGoblinPos_003_1a674c41-adad-4ba9-837b-da7cd2e8a559);
DB_DEN_AttackOnDen_RaiderVictoryPositions(S_GOB_RaiderViolent_71620f09-46cb-4c03-b874-7c97926e6fbf, S_DEN_PeeingGoblinPos_004_15477791-6171-4537-8b0a-577e4d70ce50);
DB_Dialogs(S_GOB_RaiderMurderous_04428629-2857-4795-b9b6-b41a06d9a889, DEN_AttackOnDen_RaiderMurderous_a5196b2d-bd16-3c20-48f8-7ad4a0e0c159);
DB_Dialogs(S_GOB_RaiderThirsty_64889786-dbc4-4acf-b17b-149527e898c7, DEN_AttackOnDen_RaiderThirsty_1d2a07f6-bf97-7756-5a99-3ba747f5695a);
SetOnStage(S_GOB_RaiderThirsty_64889786-dbc4-4acf-b17b-149527e898c7, 0);
SetOnStage(S_GOB_RaiderMurderous_04428629-2857-4795-b9b6-b41a06d9a889, 0);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_OilBarrel_003_51fd6be1-a7f8-43be-b6eb-5e2e735c520e);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_OilBarrel_005_df400bfd-7dbb-4c40-a63f-15ed4bbe894b);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_OilBarrel_007_abb26ff6-c0e0-4831-ad5a-f236756d6769);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_OilBarrel_008_ff099593-229c-497d-aa1e-2dd098dfe14e);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_EmptyBarrel_001_8e905c1f-5575-4f32-a1fa-5feacb4abfae);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_EmptyBarrel_002_e0bb7c2e-2080-47ea-a177-d26e4028c89c);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_EmptyBarrel_003_e58322c2-27af-4b7b-877c-5afd1ed53ba3);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_EmptyBarrel_004_79f9e8d8-cffd-48f3-ac02-1bad57b9711f);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_EmptyBarrel_005_670470f1-dce1-4334-ba4a-9b0be723f3d2);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_OilBasin_fc7b5d35-d467-40e1-84cf-9208486d5e27);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_SmokepowderTrap_001_b6b43929-1e5f-4a1d-94b5-78763cafe634);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_SmokepowderTrap_002_01882a87-db88-4a9d-9bdc-e8365775cbc1);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_SmokepowderTrap_003_b5a3b15b-efb1-4a8f-a96f-75944c041316);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_SmokepowderTrap_004_ec8a9084-7382-48de-9dc2-34d842b7a7d7);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_SmokepowderTrap_005_87a46b03-629c-40c2-a854-984ba115935f);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_SmokepowderTrap_006_06ea2e63-46c6-403d-9f49-9e43ad4092de);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_HighBarricade_001_a7a0d331-29ce-4f25-914b-e51138640522);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_HighBarricade_002_4fed22d9-6234-420e-bad1-0619d1a18858);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_HighBarricade_004_4c3dbd52-9f0a-45ce-b86d-5519d0071a33);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_HighBarricade_006_aae180c3-cb5d-40fd-a9ae-4befb093fc47);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_HighBarricade_007_63a50a04-1db7-445e-9864-dcc5ec254243);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_HighBarricade_008_d82f9fde-0967-4092-adf1-e98986cb973e);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_HighBarricade_009_5da32155-3198-43a0-b78e-3d78b2324f2b);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_LowBarricade_001_28a64cbb-5493-463d-a9b7-de560160670a);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_LowBarricade_002_edb3fef9-a1ea-41c5-b7f3-c08e805b672d);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_AttackFire_001_414eff40-4dd0-43de-8bb6-290b08c8c40e);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_AttackFire_002_ddd5ae67-a27c-4323-afa6-363323c7f276);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_AttackFire_003_164e1929-92a1-456f-b98a-b4b86d0c7531);
DB_DEN_AttackOnDen_PrepObjects(S_DEN_AttackFire_004_e3b5d6fa-5215-48bf-881f-387ad4cfc033);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_WeaponStandCrate_5e4fd4d9-0eda-4f04-98c6-dddeafd4552a);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_WeaponsmithDagger_648a92c5-1eb6-4e9d-b7eb-390ddeb396a5);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_WeaponsmithCrossbow_5fb4d30f-10f1-4a83-945b-c280cfa4143b);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_WeaponsmithSword_43e99e94-67b0-4f64-a259-6e08936b901d);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_WeaponsmithMace_6420c864-a383-47b5-919e-0e1850f6c4e8);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_WeaponsmithAxe_a4e16639-23de-4b38-8bdb-b17c1af94972);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_ARR_Arrow_Of_Detonation_02_1ff323a3-c75c-4f3f-9665-f5f9933ade65);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_ARR_Arrow_Of_Detonation_01_782b9884-27fe-4568-8f3e-c47c095807ef);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_ARR_Arrow_Of_Fire_01_9f6ab774-0cdb-4fe1-98d3-57447a20d780);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_CONS_Potion_Healing_A_Greater_01_6f193108-0134-42bc-9a52-3362f8ae8566);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_GRN_Bomb_A_02_2c8ba651-c505-4389-9094-063acb9bbcf6);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_GRN_Bomb_A_01_2d2fa809-b87f-48cb-aced-0119bb201511);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_LOOT_SCROLL_Entangle_0_d174cf99-ebc6-41eb-8c75-95d8a1b317b0);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_LOOT_SCROLL_FireBolt_01_c27bd173-74a9-47c6-8c83-19e06f05dc2f);
DB_DEN_AttackOnDen_LeaveObjects(S_AttackOnDen_WPN_HUM_Longsword_A_01_750abb29-9334-4e1a-a58f-d99fa565083d);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_KidLeavingCrate_001_a6146f73-a990-4a98-91a6-e0354cb55c87);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_KidLeavingCrate_002_2e72fc1f-de15-4765-9f68-a08eb1540c39);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_KidLeavingCrate_005_bbee5a70-64d0-4676-b5f3-039f53bdbfea);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_KidLeavingCrate_004_b5f0705a-8d50-47a8-a35e-8af7ceca8870);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_KidLeavingCrate_003_558c54eb-fcdd-48bd-abf7-0d5c9047ac99);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_KidLeavingCrate_006_978e2568-c896-4759-979c-4882192fbe39);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_KidLeavingCrate_007_ab3d79cf-f002-41f8-beaa-23639ec35305);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel001_19573ae6-d377-4368-9421-5cd15df36975);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel002_d61f3212-199b-423b-9b22-f25ad9084f77);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel003_20edb5dd-5f04-4d7c-930e-c5f1b2217669);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel004_9eef4c9b-90dc-4ac6-b092-c32ba025d88e);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel005_cf2dd37e-5ef0-485d-afd8-bd299df3e23a);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel016_0e07eadc-852d-495f-8798-f1487318a2ca);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel015_dd1b7a66-5108-4afb-8584-4e2a9a3350b3);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel014_d0910344-93a6-4901-ade9-bc4400df751f);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel012_b9c9fce9-73d1-4b86-b572-550a5fc01265);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel012_24dabb13-3aa0-4ca1-a3b4-f6898be7e46f);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel011_a463ae68-f404-4440-afd2-afbae56e3f6c);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel010_fd6c54f7-d2c1-43ca-bb65-e76dab723b15);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel009_3132d33d-b426-46a5-bab5-1f70bdbb4fb6);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel007_0b5b2c91-2e9b-46a8-b999-6fa9b9d4a054);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel006_602536fa-e355-414e-bd43-53ecc3c69915);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_LeaveApparel008_53ffe2c2-6c59-4b7f-b0d5-b0a197f2010f);
DB_DEN_AttackOnDen_LeaveObjects(S_DEN_TooHeavyChest_f6c6edad-8fb6-49e5-bae5-d6c6367f6909);
PROC_DEN_AttackOnDen_HideEventObjects();
DB_DEN_LeaveEvents(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingGone");
DB_DEN_LeaveEvents(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, "DEN_CapturedGoblin_FriendGone");
DB_DEN_LeaveEvents(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "DEN_HagTrader_Event_LeftDen");
DB_DEN_LeaveEvents(S_GLO_Volo_2af25a85-5b9a-4794-85d3-0bd4c4d262fa, "DEN_VoloLeft");
DB_DEN_LeaveEvents(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "DEN_RaidingParty_LeftDen");
DB_DEN_LeaveEvents(S_DEN_RobbedAdventurer_534bceaf-678c-40a0-8ca9-e1134f95ba0d, "DEN_RaidingParty_LeftDen");
DB_DEN_LeaveEvents(S_DEN_RaidAdventurer_4faf77a0-b883-4f7b-acbf-4500973f446d, "DEN_RaidingParty_LeftDen");
DB_AddCharactersInTriggerToDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, S_DEN_RaidersArriveIncludeSphere_dbfb7504-275f-4ae8-9699-a6aa2772219e, 1, 1, 1);
PROC_TriggerRegisterForPlayers(S_DEN_RaidersArriveIncludeSphere_dbfb7504-275f-4ae8-9699-a6aa2772219e);
DB_DropMutingStatussesDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b);
DB_DropMutingStatussesDialog(DEN_AttackOnDen_LairDoor_bdb3218d-bd21-d32a-e5f7-8df82e2e37a6);
DB_DropMutingStatussesDialog(DEN_AttackOnDen_EntranceMeetingWyll_fe7e5e63-53eb-3cba-c140-f7f5e4e68571);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_RaidersArriveAfterFight_f5fbe4d0-7e3e-f9a8-1e5c-3eb4f0561a8c);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_MindMeldAfterCombat_861cbf47-f9ab-f0c4-5ff7-821eb491bbaa);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_ChefAndSon_133f2381-a171-71f8-859d-9b9660d6e69b);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_EntranceMeeting_278c9ec1-02f0-c9ae-01d8-cd4507ce40cc);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_TieflingVictory_cedf9ba4-12ce-7d43-3e47-8cce3a00cc9f);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_TrainerVictory_611c2e09-f1d8-2b46-9aac-200aed1af200);
DB_Dialogs(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, DEN_AttackOnDen_BackupLeader_92b83e7a-534b-ebbc-8e8a-7a89d0d1bdab);
DB_Dialogs(S_GOB_RaiderBossy_de48bba2-e616-4db1-9d1c-76c1f285927f, DEN_AttackOnDen_RaiderBossy_407e9746-9999-748a-61bc-5653ae9464d8);
DB_Dialogs(S_GOB_RaiderCrafty_d0269a95-45f2-4877-b301-0c1740f3dd7d, DEN_AttackOnDen_RaiderCrafty_edd8caab-5a78-5485-816c-049ead260276);
DB_Dialogs(S_GOB_RaiderViolent_71620f09-46cb-4c03-b874-7c97926e6fbf, DEN_AttackOnDen_RaiderViolent_cc93a916-e9bb-a27d-0646-f02c2cdcded8);
DB_Dialogs(S_GOB_RaiderFunny_b1e2d6a7-0fad-4485-ae2e-2ec78ce4e658, DEN_AttackOnDen_RaiderFunny_564cc9a9-1ad9-3af6-a645-d44a5a4b2e40);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_RaiderBold_1c9fd1dd-12bc-4b81-acb8-9eef54174c55, DEN_AttackOnDen_RaiderBold_99c60df5-bcb1-3d3f-0451-de05a559f3b9);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_RaiderHardy_6687f78f-5d6a-40d4-8cfd-2b972dacde3c, DEN_AttackOnDen_RaiderHardy_d9fb622e-5684-3ee7-76e6-e2d6d0eb2015);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_RaiderHefty_fcbb04a8-f4e6-4065-901c-1a4a708ccd54, DEN_AttackOnDen_RaiderHefty_0d4f40e6-2ccb-154d-3133-4a46bc9a4959);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b, DEN_AttackOnDen_RaiderArrogant_e31586e5-afc7-6084-d048-7cfa3cbf786b);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_RaiderStupid_5d049dbe-ff35-45be-88f9-5f999dc0ffe4, DEN_AttackOnDen_RaiderStupid_bc6422f8-5f99-2812-56b0-b8ea2b180e29);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_RaiderCunning_abdd3748-0834-46f3-8214-18dd4dca9d40, DEN_AttackOnDen_RaiderCunning_578afb43-ecf5-480f-2a5f-1c0a48e6010d);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_RaiderChieftain_5bac0842-c1d4-4358-a85c-24ab745d0280, DEN_AttackOnDen_RaiderChieftain_f382ca79-1aa1-b6cb-489d-3afd1bb69ec7);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_GoblinLush_d738c9a4-a031-4dd9-912f-93cda8d8d8b7, DEN_AttackOnDen_GoblinLush_edecd45b-5d2d-6b63-eaed-e52e715f39e8);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, DEN_AttackOnDen_WarchiefBrave_cf79fd35-3abd-fdf5-45ea-8a9781ea7f83);
DB_DEN_AttackOnDen_RaiderDialogs(S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41, DEN_AttackOnDen_WarchiefGrumpy_4b62d2a1-4b11-c3d1-1f51-5bb591a336e6);
DB_Dialogs(S_GOB_AttackOnDen_Sapper_001_392146c2-0849-4250-b907-e4fb9a13ddcf, DEN_AttackOnDen_Sapper_001_7e101dfa-19e4-803f-e289-fd3abffa7f23);
DB_Dialogs(S_GOB_AttackOnDen_Sapper_003_4264ba13-c816-405c-bc55-9f91dcfd9793, DEN_AttackOnDen_Sapper_003_b826002a-7e80-4bd6-8404-09c09da657ef);
DB_Dialogs(S_GOB_AttackOnDen_Sapper_004_1b6dba51-be8b-47ac-a73b-94c29e56bbad, DEN_AttackOnDen_Sapper_004_70458c3a-d99e-f63f-c3d5-a0eae46f5758);
DB_Dialogs(S_GOB_AttackOnDen_Melee_001_ebe03162-0d2d-4d9c-a5b2-aff64610479b, DEN_AttackOnDen_Melee_001_d9b4e468-9e70-c847-79af-50f76e731747);
DB_Dialogs(S_GOB_AttackOnDen_Ranged_001_12c5dc1a-f738-48bb-8b11-88a7899ec199, DEN_AttackOnDen_Ranged_001_ea69cd84-d121-efe0-335b-d8aa8e2c99c6);
DB_DEN_AttackOnDen_LeaderDialogs(DEN_AttackOnDen_EntranceMeeting_278c9ec1-02f0-c9ae-01d8-cd4507ce40cc, 1, 1, 0, 1);
DB_DEN_AttackOnDen_LeaderDialogs(DEN_AttackOnDen_OpenGateBetrayal_d2904b97-9ebd-7ffc-135c-2d89ff6668f2, 0, 0, 0, 0);
DB_DEN_AttackOnDen_LeaderDialogs(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, 1, 1, 1, 1);
DB_DEN_AttackOnDen_MeetingDialogs(DEN_AttackOnDen_EntranceMeeting_278c9ec1-02f0-c9ae-01d8-cd4507ce40cc, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_DEN_AttackOnDen_MeetingDialogs(DEN_AttackOnDen_EntranceMeeting_278c9ec1-02f0-c9ae-01d8-cd4507ce40cc, S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435);
DB_DEN_AttackOnDen_MeetingDialogs(DEN_AttackOnDen_EntranceMeetingWyll_fe7e5e63-53eb-3cba-c140-f7f5e4e68571, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_DEN_AttackOnDen_MeetingDialogs(DEN_AttackOnDen_EntranceMeetingWyll_fe7e5e63-53eb-3cba-c140-f7f5e4e68571, S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435);
DB_DEN_AttackOnDen_MeetingDialogs(DEN_AttackOnDen_EntranceMeetingWyll_fe7e5e63-53eb-3cba-c140-f7f5e4e68571, S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d);
DB_DEN_AttackOnDen_MeetingDialogs(DEN_AttackOnDen_Trainer_32f4845d-c84b-6e67-23e1-1f17d68627d7, S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435);
DB_DEN_AttackOnDen_MeetingDialogs(DEN_AttackOnDen_TieflingLeader_58770ebe-023d-e18e-6d43-7b21512f08a6, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_DEN_AttackOnDen_VictoryDialogs(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, DEN_AttackOnDen_TieflingVictory_cedf9ba4-12ce-7d43-3e47-8cce3a00cc9f);
DB_DEN_AttackOnDen_VictoryDialogs(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, DEN_AttackOnDen_TrainerVictory_611c2e09-f1d8-2b46-9aac-200aed1af200);
DB_DEN_AttackOnDen_VictoryDialogs(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, DEN_AttackOnDen_BackupLeader_92b83e7a-534b-ebbc-8e8a-7a89d0d1bdab);
DB_GLO_Halsin_DruidLeaderMeetingNPCs(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);
DB_GLO_Halsin_DruidLeaderMeetingNPCs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_BlockPolymorphDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b);
DB_DialogBlockAttackButton(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b);
DB_DialogBlockTradeButton(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b);
DB_DialogBlockAttackButton(DEN_AttackOnDen_RaidersArriveAfterFight_f5fbe4d0-7e3e-f9a8-1e5c-3eb4f0561a8c);
DB_DialogBlockTradeButton(DEN_AttackOnDen_RaidersArriveAfterFight_f5fbe4d0-7e3e-f9a8-1e5c-3eb4f0561a8c);
SetOnStage(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, 0);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Gatekeeper_847717b3-82eb-45a7-b875-78665c12ce9a);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_Stargazer_cd442e20-a6de-4497-ac51-8466433a758e);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_TieflingScammer_9b6e1dc8-6871-4e88-b65a-bda3284302fc);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_TieflingRefugee_RangerTrader_001_637d8d68-2a04-409e-a77d-cf31ac9478ee);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_TieflingRefugee_004_bc4c4282-86b0-4330-9df8-246ed0a704a2);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_YoungLover_01_dd9178e7-1e3f-43bc-8a38-666dfcac7d0c);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_YoungLover_02_dcf597c0-36c5-4c81-957a-6fe9fca50a68);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Tiefling_004_c9562174-44af-4ffa-9e5e-da58538f23d8);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Tiefling_010_23129d6c-8d39-4a4c-a4f6-cfc6637b597c);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Tiefling_011_77439e86-3f60-4456-bd55-931e2f45654f);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_IrritatedTiefling_65ad9da0-0efb-4cc3-bf82-c006f43dda6c);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_TieflingKid_004_6644185d-385e-4dfc-973c-bb854cbfd540);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_TieflingKid_003_37ffec7a-b2be-4599-b8f0-22ec39d29dbc);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_RobberKid_94e865e9-790d-4633-a378-8fb50832b5e9);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Pickpocket_540ddc1f-42c6-4347-ba03-b3cf3d3942ab);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_PickpocketTrader_e1fda08b-45d4-41db-84b5-20e9931ba5af);
DB_DEN_AttackOnDen_LeaveNPCs(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Trainee_001_1f839ad2-2bcb-47d2-8de9-db7a1fb5d67f);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Trainee_002_bd7f31a6-98e8-46cd-97be-4347fa45d387);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Trainee_003_71bdc11d-b488-427d-8453-632e91178c7e);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Mule_002_ac37baa6-624a-418d-a6ca-52ed9a77f00c);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_Mule_001_06ed1274-9d16-4320-b5ad-162fca5fb85d);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_PrisonGuard_3ff71f38-28e9-4e72-ba17-9f6d3bb2a995);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_ParentA_d6d88c8b-6ba7-4350-b3b3-d60565a44e90);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_ParentB_397467d4-1631-447b-a505-d44275dca78e);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f);
DB_DEN_AttackOnDen_LeaveNPCs(S_DEN_CharmedKid_3b92c689-6024-4446-a6c9-584e9e8d77ca);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd, S_DEN_AttackServantReturn_003_0030b044-e55d-49d7-9d95-c0020430dfd3);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_RitualDruid_004_32bef45a-47ca-4c3a-b907-13a857b316fd, S_DEN_AttackServantReturn_002_1340e630-67de-427a-975a-122722a92271);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, S_DEN_AttackServantReturn_004_a2202223-824f-4678-9eff-22ec3f4468a0);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, S_DEN_AttackServantReturn_006_ac68f6a6-2f1c-4bad-b5f3-3bb836676ed4);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_ZenBear_d4d4bfd2-9639-45bc-a256-2f079e53db29, S_DEN_AttackServantReturn_005_27b069e1-fcfe-488d-9fb3-26489fdc4fde);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_VoloBear_893c5f40-a760-4b04-bd86-c8fb8f5dd08a, S_DEN_AttackServantReturn_008_8cd15276-9507-4f77-b76a-0d63c99140a9);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_ExcitedBoar_5e856a8e-957a-49b1-8ec7-f430984e08ca, S_DEN_AttackServantReturn_007_5d9bc4cd-18ca-495c-bc2b-67fb6c715a7e);
DB_DEN_AttackOnDen_NonLeaveNPCs(S_DEN_ElevatorBear_04b7ef23-1002-4682-b962-33a2328bcd5c, S_DEN_ElevatorBearPos_68c04fef-51d9-4a09-8d22-d72717379a9e);
DB_DEN_AttackOnDen_DruidAnimals(S_DEN_ExcitedBoar_5e856a8e-957a-49b1-8ec7-f430984e08ca);
DB_DEN_AttackOnDen_DruidAnimals(S_DEN_ZenBear_d4d4bfd2-9639-45bc-a256-2f079e53db29);
DB_DEN_AttackOnDen_DruidAnimals(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753);
DB_DEN_AttackOnDen_DruidAnimals(S_DEN_ElevatorBear_04b7ef23-1002-4682-b962-33a2328bcd5c);
DB_DEN_AttackOnDen_EmptyLair(1);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, S_DEN_AttackRikkaPos_1809d6fc-996c-4803-a6a2-dbb4cd261179);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_GLO_IrritatedTiefling_65ad9da0-0efb-4cc3-bf82-c006f43dda6c, S_DEN_SafeIrritatedPos_c3c4afb5-bda2-4cd7-831b-25085c0ac728);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492, S_DEN_SafePandirnaPos_cef87a5a-39d7-4633-a327-a62c28096770);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Tiefling_004_c9562174-44af-4ffa-9e5e-da58538f23d8, S_DEN_AttackKaldaniPos_9339d93b-f83e-4792-800b-eb8da15e9a83);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, S_DEN_AttackIkaronPos_c13ef8f3-4a2b-4c73-a6f9-e988d3fa5cc7);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Tiefling_010_23129d6c-8d39-4a4c-a4f6-cfc6637b597c, S_DEN_AttackLakrissaPos_ed043a81-03fd-4e0c-bcf0-8d920b5f432e);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, S_DEN_SafetyPos_016_081b597a-b17b-46df-b34a-981e31fead7c);
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, S_DEN_SafetyPos_003_bf03ff45-ba26-46d0-b8f6-9a69ebd079da);
DB_DEN_AttackOnDen_FleeingTieflings(S_GLO_IrritatedTiefling_65ad9da0-0efb-4cc3-bf82-c006f43dda6c);
DB_DEN_AttackOnDen_FleeingTieflings(S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492);
DB_DEN_AttackOnDen_FleeingTieflings(S_DEN_Tiefling_004_c9562174-44af-4ffa-9e5e-da58538f23d8);
DB_DEN_AttackOnDen_FleeingTieflings(S_DEN_Tiefling_010_23129d6c-8d39-4a4c-a4f6-cfc6637b597c);
DB_DEN_AttackOnDen_FleeingTieflings(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);
DB_DEN_AttackOnDen_DruidEncounter(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, S_DEN_AttackOnDruidsPos_001_3916cab4-92f1-4374-b8ff-19d7f5fa29e5);
DB_DEN_AttackOnDen_DruidEncounter(S_DEN_Apprentice_7cabf226-e34b-4556-8903-a45d0fe26caf, S_DEN_AttackOnDruidsPos_002_6cf6d2f5-b965-449e-b018-61e32d78ed77);
DB_DEN_AttackOnDen_DruidEncounter(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_AttackOnDruidsPos_003_35941ec7-e83e-463a-9eaa-471402989c75);
DB_DEN_AttackOnDen_DruidEncounter(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, S_DEN_AttackOnDruidsPos_004_25a3fd0f-ce59-42ec-bd54-2d4d15635510);
DB_DEN_AttackOnDen_DruidEncounter(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, S_DEN_AttackOnDruidsPos_005_802f124e-f18c-402f-9423-5e5292cadf0b);
DB_DEN_AttackOnDen_DruidEncounter(S_DEN_ServantPlight_005_13db744d-8a48-4131-8801-fd5fc289fdf6, S_DEN_AttackOnDruidsPos_006_da0c7ca6-4a14-497f-bb04-8b353ef51f60);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_LockdownAttackPos_001_cd88f985-05e3-49e4-a647-520328027856);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_RaiderBold_1c9fd1dd-12bc-4b81-acb8-9eef54174c55, S_DEN_LockdownAttackPos_002_f3f5f248-461e-45c6-8611-656e77a072b0);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_RaiderHardy_6687f78f-5d6a-40d4-8cfd-2b972dacde3c, S_DEN_LockdownAttackPos_003_fa696e65-443c-4960-9751-3de4869f68af);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_RaiderHefty_fcbb04a8-f4e6-4065-901c-1a4a708ccd54, S_DEN_LockdownAttackPos_004_510692f9-1500-4ed6-8f3e-46f793244508);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b, S_DEN_LockdownAttackPos_005_5b97d06b-eeac-4777-98f8-56ec7db811d9);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_RaiderStupid_5d049dbe-ff35-45be-88f9-5f999dc0ffe4, S_DEN_LockdownAttackPos_006_5142c78e-ae93-4e7c-a738-2d1d21c6e580);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_RaiderCunning_abdd3748-0834-46f3-8214-18dd4dca9d40, S_DEN_LockdownAttackPos_007_f120ee80-e91a-4085-94dc-f79c7eff14b5);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_RaiderChieftain_5bac0842-c1d4-4358-a85c-24ab745d0280, S_DEN_LockdownAttackPos_008_9c57eb89-90ce-4625-bcc8-0088d131bbcc);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_GoblinLush_d738c9a4-a031-4dd9-912f-93cda8d8d8b7, S_DEN_LockdownAttackPos_009_ae17750e-3827-46ef-a41b-3faa056ca974);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, S_DEN_LockdownAttackPos_010_f29c7d3d-6e09-4b35-8518-066da06d74bc);
DB_DEN_AttackOnDen_LockdownRaiders(S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41, S_DEN_LockdownAttackPos_011_2cd11630-f936-45fd-8a1a-c447ac6bbccf);
DB_DEN_AttackOnDen_GateCombatADs(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, DEN_AttackOnDen_AD_BetrayedLeader_bb1f8e2c-c994-9fef-77ee-43776438724a);
DB_DEN_AttackOnDen_GateCombatADs(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, DEN_AttackOnDen_AD_BetrayedTrainer_516c0159-34e1-3a7e-af5c-db273c30c5f8);
DB_DEN_AttackOnDen_FrightenedADs(S_GLO_Stargazer_cd442e20-a6de-4497-ac51-8466433a758e, DEN_AttackOnDen_AD_CoweringStargazer_ea9288f9-cf9d-699b-f14d-5453ad02f7a2);
DB_DEN_AttackOnDen_FrightenedADs(S_GLO_YoungLover_01_dd9178e7-1e3f-43bc-8a38-666dfcac7d0c, DEN_AttackOnDen_AD_CoweringRefugee002_70430065-7b4b-9ce1-754a-e465da63e256);
DB_DEN_AttackOnDen_FrightenedADs(S_GLO_YoungLover_02_dcf597c0-36c5-4c81-957a-6fe9fca50a68, DEN_AttackOnDen_AD_CoweringRefugee003_e25319b2-2314-2580-0602-28f3c2a3bed2);
DB_DEN_AttackOnDen_FrightenedADs(S_DEN_TieflingRefugee_004_bc4c4282-86b0-4330-9df8-246ed0a704a2, DEN_AttackOnDen_AD_CoweringRefugee004_3f4d9410-893a-185e-0470-9730eb9387e8);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_MainTransition_7faabc1b-a62d-abc2-7f3f-9cc45cb997ed);
DB_IgnoreMutingStatussesDialog(DEN_AttackOnDen_DruidTransition_a3b23114-ecc0-59bd-2ff5-1faa501b89e8);
DB_DEN_AttackOnDen_TransitionDialog(S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, DEN_AttackOnDen_DruidTransition_a3b23114-ecc0-59bd-2ff5-1faa501b89e8);
DB_DEN_AttackOnDen_TransitionDialog(S_DEN_DruidVault_SUB_f4c22466-5963-4192-b939-f1056f4f806a, DEN_AttackOnDen_DruidTransition_a3b23114-ecc0-59bd-2ff5-1faa501b89e8);
DB_DEN_AttackOnDen_TransitionDialog(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, DEN_AttackOnDen_MainTransition_7faabc1b-a62d-abc2-7f3f-9cc45cb997ed);
DB_DEN_AttackOnDen_TransitionDialog(S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b, DEN_AttackOnDen_MainTransition_7faabc1b-a62d-abc2-7f3f-9cc45cb997ed);
DB_DEN_AttackOnDen_TransitionDialog(S_DEN_EntranceArea_27796261-6c41-4fa2-8afe-6616d7d3e176, DEN_AttackOnDen_MainTransition_7faabc1b-a62d-abc2-7f3f-9cc45cb997ed);
DB_DEN_AttackOnDen_TransitionDialog(S_DEN_TieflingLeader_SUB_f667e6fe-2b30-4509-9bba-7918bb71a2a7, DEN_AttackOnDen_MainTransition_7faabc1b-a62d-abc2-7f3f-9cc45cb997ed);
DB_GLO_Backgrounds_Goal(HAUNTED_ONE_ce00b3b6-238e-4524-851b-3d1f2d2b1189, "Act1_HauntedOne_SidedAgainstGoblins", f611790f-df82-4967-8282-620c305ad0f3);
DB_GLO_Backgrounds_Goal(HAUNTED_ONE_ce00b3b6-238e-4524-851b-3d1f2d2b1189, "Act1_HauntedOne_SidedAgainstTieflings", 345c9e42-5758-44be-ba56-6012cd5f8c91);

KBSECTION
IF
FlagSet(DEN_Refugees_State_LeadersAreDead_1e6a42ed-8313-4f46-57e2-20dbdb2df923, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
GoalCompleted;

IF
FlagSet(DEN_AttackOnDen_State_RaiderVictory_abe1bce8-c234-4afe-a490-76210d98a078, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND
QRY_DEN_IsInDen(_Var3, _, _, _, _)
THEN
PROC_GLO_Backgrounds_CompleteGoal(_Var3, "Act1_HauntedOne_SidedAgainstTieflings");

IF
DB_GlobalFlag(DEN_AttackOnDen_Event_Start_c641da6a-b3f5-4873-bd34-c53768d30d6f, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_DenVictory_71c7f23e-3ff1-c9b8-3ef5-d75fa1b42c8d, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_DEN_IsInDen(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Backgrounds_CompleteGoal(_Var1, "Act1_HauntedOne_SidedAgainstGoblins");

IF
DB_DEN_AttackOnDen_MeetingDialogs(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_DialogBlockAttackButton(_Var1);
DB_DialogBlockTradeButton(_Var1);

IF
DB_DEN_AttackOnDen_VictoryDialogs(_, _Var2, _, _, _)
THEN
DB_DialogBlockAttackButton(_Var2);
DB_DialogBlockTradeButton(_Var2);

PROC
PROC_DEN_AttackOnDen_HideEventObjects()
AND
DB_DEN_AttackOnDen_PrepObjects(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInInventory(_Var1, 0, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_DEN_AttackOnDen_HideEventObjects()
AND
DB_DEN_AttackOnDen_LeaveObjects(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
DB_DEN_AttackOnDen_DruidRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_DEN_AttackOnDen_RemoveFromAttack((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_NPC(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
_Var2 != ""
THEN
DB_DEN_NPC(_Var1, "", NULL_00000000-0000-0000-0000-000000000000);
NOT DB_DEN_NPC(_Var1, _Var2, _Var3);

IF
FlagSet(DEN_CapturedGoblin_Event_GuardsLeft_b79734e0-8efc-228f-9a44-50641da7c55a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_DEN_AttackOnDen_RemoveFromAttack(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
PROC_DEN_AttackOnDen_RemoveFromAttack(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(GLO_AttackOnDen_State_RaidReady_eb361773-da88-dee4-f4c8-a22acae60948, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_StartSetup", _, _, _, _)
THEN
PROC_State_IfCurrentProgressElse(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_LockdownComplete", "DEN_State_LockdownAttackOnDen", "DEN_State_AttackOnDen");

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_LockdownAttackOnDen", _, _)
THEN
PROC_DEN_AttackOnDen_LockdownStart();

PROC
PROC_DEN_AttackOnDen_LockdownStart()
THEN
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 50);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25, Hero_a1542c81-6895-929e-4522-10ce218bb360, 50);
PROC_TriggerRegisterForPlayers(S_DEN_LockdownAttackOnDenArea_41d767e2-cc0e-4c16-9107-0a3f3c46f191);
PROC_DEN_AttackOnDen_LockdownStart_JournalHook();

PROC
PROC_DEN_AttackOnDen_LockdownStart()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
AND
DB_CRIME_Guards_RegionGuard(_Var5, _Var6, _Var1, _Var1, _Var1)
THEN
NOT DB_CRIME_Guards_RegionGuard(_Var5, _Var6, _Var1);

PROC
PROC_DEN_AttackOnDen_LockdownStart_JournalHook()
THEN
DB_DEN_AttackOnDen_AwaitingLockdownCombat(1);

PROC
PROC_DEN_AttackOnDen_LockdownStart()
AND
DB_DEN_AttackOnDen_LockdownRaiders(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);
SetCanJoinCombat(_Var1, 1);
TeleportTo(_Var1, _Var2, "");

IF
DB_InRegion(_Var1, S_DEN_LockdownAttackOnDenArea_41d767e2-cc0e-4c16-9107-0a3f3c46f191, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_LockdownFight", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_AttackOnDen_LockdownDrow_04fcdaa3-1e06-1587-d923-ced57bac82a9, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("DEN_AttackOnDen_LockdownFight");
PROC_TriggerUnregisterForPlayers(S_DEN_LockdownAttackOnDenArea_41d767e2-cc0e-4c16-9107-0a3f3c46f191);

IF
DB_InRegion(_Var1, S_DEN_LockdownAttackOnDenArea_41d767e2-cc0e-4c16-9107-0a3f3c46f191, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_LockdownFight", _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("DEN_AttackOnDen_LockdownFight");
PROC_TriggerUnregisterForPlayers(S_DEN_LockdownAttackOnDenArea_41d767e2-cc0e-4c16-9107-0a3f3c46f191);
SetImmortal(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);
PROC_DEN_AttackOnDen_LockdownCombat_JournalHook();

IF
DialogEnded(DEN_AttackOnDen_LockdownDrow_04fcdaa3-1e06-1587-d923-ced57bac82a9, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetImmortal(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);
PROC_DEN_AttackOnDen_LockdownCombat_JournalHook();

IF
AttackedBy(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (GUIDSTRING)_Var1, _, _, _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_AttackOnDen_AwaitingLockdownCombat(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_LockdownCombat_JournalHook();

PROC
PROC_DEN_AttackOnDen_LockdownCombat_JournalHook()
THEN
NOT DB_DEN_AttackOnDen_AwaitingLockdownCombat(1);

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _, _)
THEN
DB_LeaveCamp_ForbiddenReturnArea("WLD_Main_A", S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, S_DEN_WaypointPos_cdd91969-67d0-454e-b27b-cf34e542956b);
DB_LeaveCamp_ForbiddenReturnArea("WLD_Main_A", S_DEN_DruidVault_SUB_f4c22466-5963-4192-b939-f1056f4f806a, S_DEN_WaypointPos_cdd91969-67d0-454e-b27b-cf34e542956b);
PROC_DEN_AttackOnDen_Start();
PROC_DEN_AttackOnDen_Start_JournalHook();

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_PlayerInDen(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_InDenTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_TransitionDialog(_Var2, _Var3, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialogCustom(_Var3, _Var1, 0, 0, 0, 0, _Var1, _Var1, _Var1, _Var1)
AND
_Var3 == DEN_AttackOnDen_DruidTransition_a3b23114-ecc0-59bd-2ff5-1faa501b89e8
THEN
TeleportTo(_Var1, S_DEN_LairMainOutPoint_624be120-9ee0-496a-8f88-17a3bf84a320, "", 1, 1, 1);

IF
DialogActorJoined(DEN_AttackOnDen_DruidTransition_a3b23114-ecc0-59bd-2ff5-1faa501b89e8, _, (GUIDSTRING)_Var2, _, (INTEGER)_)
THEN
TeleportTo(_Var2, S_DEN_LairMainOutPoint_624be120-9ee0-496a-8f88-17a3bf84a320, "", 1, 1, 1);

PROC
PROC_DEN_AttackOnDen_Start_JournalHook()
THEN
DB_NOOP(1);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
AND
DB_CRIME_Guards_RegionGuard(_Var5, _Var6, _Var1, _Var1, _Var1)
THEN
NOT DB_CRIME_Guards_RegionGuard(_Var5, _Var6, _Var1);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_NPC(_Var1, "Lair", _, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_DruidAnimals(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d
THEN
DB_DEN_AttackOnDen_BlockLair(1);
NOT DB_DEN_AttackOnDen_EmptyLair(1);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_EmptyLair(1, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_RemoveFromAttack(S_DEN_ExcitedBoar_5e856a8e-957a-49b1-8ec7-f430984e08ca);
PROC_DEN_AttackOnDen_RemoveFromAttack(S_DEN_ZenBear_d4d4bfd2-9639-45bc-a256-2f079e53db29);
PROC_DEN_AttackOnDen_RemoveFromAttack(S_DEN_ElevatorBear_04b7ef23-1002-4682-b962-33a2328bcd5c);

PROC
PROC_DEN_AttackOnDen_Start()
THEN
RemoveSurfaceLayer(S_DEN_KanonPushbackPos_bb550eee-2a36-4a47-902b-193dcfb6f5fa, "Ground", 20);

PROC
PROC_DEN_AttackOnDen_Start()
AND NOT
DB_OffStage(S_DEN_BugbearNinja_4cb29070-a33c-4253-9f57-18d1c9a88523, _, _, _, _)
THEN
SetOnStage(S_DEN_BugbearNinja_4cb29070-a33c-4253-9f57-18d1c9a88523, 0);
RemoveSurfaceLayer(S_DEN_KanonPushbackPos_bb550eee-2a36-4a47-902b-193dcfb6f5fa, "Ground", 20);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_EmptyLair(1, _, _, _, _)
AND
DB_DEN_NPC(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, "Lair", _, _, _)
AND
DB_DEN_DruidAttack_OpposedDruids(_Var2, _, _, _, _)
AND
DB_DEN_NPC(_Var2, "Lair", _Var4, _, _)
THEN
NOT DB_DEN_NPC(_Var2, "Lair", _Var4);
DB_DEN_NPC(_Var2, "Cave", _Var4);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
THEN
SetOnStage(_Var1, 1);
SetCanJoinCombat(_Var1, 0);
TeleportTo(_Var1, S_DEN_AttackOnDen_DebugHoldingPoint_f922846c-1103-4ec2-aab7-a23b1d2ed7e8, "");
DB_DEN_AttackOnDen_BlockOwned(_Var1, 1);
PROC_CharacterDisableAllCrimes(_Var1);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_GoblinBarrels(_, _Var2, _, _, _)
THEN
DB_DEN_AttackOnDen_BlockOwned(_Var2, 1);
PROC_CharacterDisableAllCrimes(_Var2);

PROC
PROC_DEN_AttackOnDen_Start()
THEN
SetOnStage(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);
TeleportTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_AttackOnDen_DebugHoldingPoint_f922846c-1103-4ec2-aab7-a23b1d2ed7e8, "");

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_EmptyLair(1, _, _, _, _)
AND NOT
DB_DEN_NPC(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_RemoveFromAttack(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_GlobalFlag(DEN_Prodigy_State_Staying_479db0b1-cc1b-78bf-3e7b-9840747fbd4f, _, _, _, _)
AND NOT
DB_Defeated(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
AND NOT
DB_Defeated(S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b, _, _, _, _)
AND NOT
DB_Defeated(S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d, _, _, _, _)
THEN
SetFlag(DEN_Prodigy_State_ArgumentDone_9a1847e7-2249-0145-9294-0e6c87034e14, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _, _)
THEN
SetEntityEvent(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "DEN_States_Enable", 1);
SetDualEntityEvent(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, S_DEN_WyllAttackGatePos_e386c441-83ab-4dcb-aab8-2f5c1feb14f8, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _, _)
THEN
PROC_DEN_AddOrUpdateDenNPC(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "Cave", DEN_AttackOnDen_Griefling_4dc17e35-32f2-427d-c935-3171dc2fdebf);
SetDualEntityEvent(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_AttackWyllPos_c0bfe2a1-dbb3-4ce8-a6e7-744ef3edd3cc, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_Start()
THEN
PROC_RemoveOneShotTrigger(S_DEN_ApproachingGatesVB_211654fb-d641-4d84-a8f6-52b32de8320a);
SetFaction(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f);
SetFlag(DEN_GruntingKid_State_HatchOpened_0ff8129d-c04b-4b7d-bf9b-60b55b40fbcc, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(DEN_RaidingParty_Event_GateIsOpened_735e0e81-bd67-eb67-87ac-40da4c3e6c49, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_General_State_KanonTryBurial_7edf4538-ae5d-4fdd-968d-9ce4f6c63d7f, NULL_00000000-0000-0000-0000-000000000000, 0);
SetEntityEvent(S_DEN_Trainee_001_1f839ad2-2bcb-47d2-8de9-db7a1fb5d67f, "DEN_AttackOnDen_StopTrainee");
SetEntityEvent(S_DEN_Trainee_002_bd7f31a6-98e8-46cd-97be-4347fa45d387, "DEN_AttackOnDen_StopTrainee");
SetEntityEvent(S_DEN_Trainee_003_71bdc11d-b488-427d-8453-632e91178c7e, "DEN_AttackOnDen_StopTrainee");

PROC
PROC_DEN_AttackOnDen_Start()
AND NOT
DB_DEN_GateInUse(_, _, _, _, _)
THEN
DB_DEN_GateInUse(S_DEN_RepairedGate_de5708cf-758e-47d2-aef7-b7d7162ba69e);
SetFlag(DEN_AttackOnDen_Event_GateRepaired_44cd8f5e-c2b4-47ce-8443-5f613ec95c7d, NULL_00000000-0000-0000-0000-000000000000, 0);
SetOnStage(S_DEN_RepairedGate_de5708cf-758e-47d2-aef7-b7d7162ba69e, 1);
SetOnStage(S_DEN_Gate_567055bf-ffeb-4236-8a61-e53877397fde, 0);

PROC
PROC_DEN_AttackOnDen_Start()
THEN
PROC_DeclareCounter("DEN_AttackOnDen_Tieflings");
PROC_DeclareCounter("DEN_AttackOnDen_GateDefenders");
PROC_SceneOver("DEN_BugbearScout_Ambush");
PROC_SceneOver("DEN_SnakeCourt");
PROC_SceneOver("DEN_GuardedEntrance_ParentsScene");
SetVisible(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1, 1);
Unlock(S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1);
PROC_RemoveDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
DB_Dialogs(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, DEN_AttackOnDen_Drow_84abf1c9-de21-4db1-cbb1-0046faf2fc45);
SetForceUpdate(S_DEN_Gatekeeper_847717b3-82eb-45a7-b875-78665c12ce9a, 0);
PurgeOsirisQueue(S_DEN_Apprentice_7cabf226-e34b-4556-8903-a45d0fe26caf);
PurgeOsirisQueue(S_DEN_Gatekeeper_847717b3-82eb-45a7-b875-78665c12ce9a);
PROC_TriggerRegisterForPlayers(S_DEN_LeaderAttackSpotArea_41be541d-570b-447a-9636-6cbab92bbde2);
PROC_TriggerRegisterForPlayers(S_DEN_AttackOnDenEntranceArea_b45cb766-c7a2-44c8-bd73-91779cd8ce78);
SetFlag(DEN_AttackOnDen_Event_Start_c641da6a-b3f5-4873-bd34-c53768d30d6f, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_Event_PrepareNPCsForSetup_5e82ea1f-c31c-4929-a7a0-3a2db9b9b705, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_Gate_OpenOrCloseGate(1);

PROC
PROC_DEN_AttackOnDen_Start()
AND NOT
DB_GlobalFlag(DEN_GroveConflict_State_TooLowTieflings_ed9fe6c4-5037-4f74-968c-a166aeb29d9c, _, _, _, _)
AND
DB_DEN_AttackOnDen_PrepObjects(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_Start()
AND NOT
DB_GlobalFlag(DEN_GroveConflict_State_TooLowTieflings_ed9fe6c4-5037-4f74-968c-a166aeb29d9c, _, _, _, _)
AND
DB_DEN_AttackOnDen_LeaveObjects(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_Defeated(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c, _, _, _, _)
AND
DB_Defeated(S_DEN_CharmedKid_3b92c689-6024-4446-a6c9-584e9e8d77ca, _, _, _, _)
THEN
SetFlag(DEN_AttackOnDen_State_NoStoryteller_cd7198cb-4f9e-5239-3211-9aface6587b6, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_NPC(_Var1, _Var2, _Var3, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveHarmfulStatuses(_Var1);
LeaveCombat(_Var1);
PROC_ForceStopDialog(_Var1);
PurgeOsirisQueue(_Var1);
DB_DEN_AttackOnDen_BlockOwned(_Var1, 0);
PROC_DEN_AttackOnDen_SetupNPC(_Var1, _Var2, _Var3);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var2, _Var1, _Var1)
AND
DB_Defeated(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_SetupNPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "", _Var2);

PROC
PROC_DEN_AttackOnDen_Start()
THEN
DB_PartyDialogSuppressionZone(S_DEN_AttackOnDenArea_66fa72fc-fd29-4608-89c1-6048467f4091);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_InDenTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PartyDialogSuppressionZone(_Var1);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_EmptyLair(1, _, _, _, _)
THEN
SetFlag(DEN_AttackOnDen_State_DruidsAreDefeated_3c6d8a2c-dd85-48d1-b48d-f0c6d37959e4, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DEN_AttackOnDen_Start()
THEN
PROC_DEN_AttackOnDen_CheckInitialDefeat();

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, "Cave", _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetDualEntityEvent(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_AttackRathPos_6f92201d-6d8a-45d0-b026-9d9349ec1483, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, "Cave", _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetDualEntityEvent(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, S_DEN_AttackWolfPos_2ad61951-a080-41f4-a8b6-41581252a8c3, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "Specific", _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
THEN
Die(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, 0, 1);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _, _)
AND
IsOnStage(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 0, _, _, _)
THEN
SetOnStage(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 1);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, "Gate", _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(DEN_AttackOnDen_State_ZevlorIsLeader_f1e902bc-1258-7a2f-0ed2-9bc042aae88d, NULL_00000000-0000-0000-0000-000000000000, 0);
SetEntityEvent(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, "DEN_AttackOnDen_SetLeader");

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, "Gate", _, _, _)
AND
DB_PermaDefeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _, _, _, _)
THEN
SetDualEntityEvent(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, S_DEN_LeaderPos_05334587-5b2e-4b09-8fc0-220329fe9687, "DEN_AttackOnDen_UpdatePosition");
SetEntityEvent(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, "DEN_AttackOnDen_SetLeader");

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, "Hideout", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_DEN_AttackOnDen_EmptyLair(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_GruntingScene(1);
SetFlag(DEN_AttackOnDen_State_MissingDoni_65b22f09-459c-ebbf-1859-ddc005d067eb, NULL_00000000-0000-0000-0000-000000000000, 0);
LookAtEntity(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, "Hideout", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_AttackOnDen_EmptyLair(1, _Var1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_AttackKidPos_011_653cf07f-e6ac-46eb-bb02-041ed278498e, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, "Cave", DEN_AttackOnDen_Tiefling001_b9cfdd58-28ee-6859-b2bc-d5e22293e6e2, _, _)
AND NOT
DB_DEN_AttackOnDen_GruntingScene(1, _, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, S_DEN_AttackRikkaPos_1809d6fc-996c-4803-a6a2-dbb4cd261179);
SetDualEntityEvent(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, S_DEN_AttackRikkaPos_1809d6fc-996c-4803-a6a2-dbb4cd261179, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_PetBird_72bd7f25-0644-4323-a428-85ba5630e6ea, "", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_PetBird_72bd7f25-0644-4323-a428-85ba5630e6ea);
PROC_DEN_AttackOnDen_TryAddDialog(S_DEN_PetBird_72bd7f25-0644-4323-a428-85ba5630e6ea);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_WoundedBird_200bc56e-f3e1-445b-8b75-a5ddb541e123, "", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_WoundedBird_200bc56e-f3e1-445b-8b75-a5ddb541e123);
PROC_DEN_AttackOnDen_TryAddDialog(S_DEN_WoundedBird_200bc56e-f3e1-445b-8b75-a5ddb541e123);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, "Defenseless", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetEquippedItem(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, "Melee Main Weapon", _Var2, _Var1, _Var1)
AND
GetEquippedItem(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, "Melee Offhand Weapon", _Var3, _Var1, _Var1)
THEN
Unequip(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, _Var2);
Unequip(S_DEN_Weaponsmith_e2ad06ec-8034-479a-9f69-b86faea6dc79, _Var3);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_TieflingRefugee_RangerTrader_001_637d8d68-2a04-409e-a77d-cf31ac9478ee, "Defenseless", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetEquippedItem(S_DEN_TieflingRefugee_RangerTrader_001_637d8d68-2a04-409e-a77d-cf31ac9478ee, "Ranged Main Weapon", _Var2, _Var1, _Var1)
THEN
Unequip(S_DEN_TieflingRefugee_RangerTrader_001_637d8d68-2a04-409e-a77d-cf31ac9478ee, _Var2);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_TieflingRefugee_004_bc4c4282-86b0-4330-9df8-246ed0a704a2, "Defenseless", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetEquippedItem(S_DEN_TieflingRefugee_004_bc4c4282-86b0-4330-9df8-246ed0a704a2, "Melee Main Weapon", _Var2, _Var1, _Var1)
THEN
Unequip(S_DEN_TieflingRefugee_004_bc4c4282-86b0-4330-9df8-246ed0a704a2, _Var2);

PROC
PROC_DEN_AttackOnDen_SetupNPC(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, (STRING)_Var1, (GUIDSTRING)_Var2, (STRING)_Var1, (STRING)_Var1)
THEN
DB_PermaDefeatedEvent(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, DEN_AttackOnDen_Event_GrieflingPermadefeated_56cc42ff-1401-8e30-13de-91ce54e48e68);

PROC
PROC_DEN_AttackOnDen_SetupNPC((CHARACTER)_Var1, (STRING)_Var2, (DIALOGRESOURCE)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var2 != ""
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Var1);
PROC_DEN_AttackOnDen_TryAddDialog(_Var1);
PROC_DEN_AttackOnDen_AssignFaction(_Var1, _Var2);

PROC
PROC_DEN_AttackOnDen_SetupNPC((CHARACTER)_Var1, (STRING)_Var2, (DIALOGRESOURCE)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var2 != ""
AND
_Var2 != "Lair Offstage"
AND
_Var2 != "Defenseless Offstage"
THEN
PROC_DEN_AttackOnDen_AssignNewPosition(_Var1, _Var2);

PROC
PROC_DEN_AttackOnDen_AssignNewPosition((CHARACTER)_Var1, (STRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetEntityEvent(_Var1, "DEN_AttackOnDen_TeleportToPosition");
PROC_DEN_AttackOnDen_AssignToCombat(_Var1, _Var2);

PROC
PROC_DEN_AttackOnDen_AssignToCombat((CHARACTER)_Var1, (STRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_RoleCombat(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_AddToCombatTracking(_Var1, _Var3);

PROC
PROC_DEN_AttackOnDen_AssignFaction((CHARACTER)_Var1, (STRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_RoleFactions(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
_Var1 != S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52
THEN
SetFaction(_Var1, _Var3);

PROC
PROC_DEN_AttackOnDen_TrySetCombatGroup((CHARACTER)_Var1, (STRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _Var1, _Var1)
AND
DB_DEN_AttackOnDen_RoleCombat(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
SetCombatGroupID(_Var1, _Var3);

IF
BaseFactionChanged((CHARACTER)_Var1, _, ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DEN_AttackOnDen_TrySetCombatGroup(_Var1, "Gate");

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_CombatGroupAreas(_, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var1, _Var4, _, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(_Var2, _Var1);
PROC_DEN_AttackOnDen_TrySetCombatGroup(_Var1, _Var4);

PROC
PROC_StateSet_PermaDefeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_NPC(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _Var1, _Var1)
AND
DB_DEN_AttackOnDen_CombatGroupAreas(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(_Var4, _Var1);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_DruidCombatGroupArea_3a127577-6dd8-42f1-8203-550904142b2a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
TriggerUnregisterForCharacter(S_DEN_DruidCombatGroupArea_3a127577-6dd8-42f1-8203-550904142b2a, _Var1);
PROC_DEN_AttackOnDen_TrySetCombatGroup(_Var1, "Lair");

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDenVictory", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_NPC(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_CombatGroupAreas(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(_Var4, _Var1);

PROC
PROC_DEN_AttackOnDen_SetupNPC((CHARACTER)_Var1, "", (DIALOGRESOURCE)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetOnStage(_Var1, 0);
PROC_DEN_RemoveFromDenNPCs(_Var1);

PROC
PROC_DEN_AttackOnDen_SetupNPC((CHARACTER)_Var1, "", (DIALOGRESOURCE)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_LeaveEvents(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, _Var3);

PROC
PROC_DEN_AttackOnDen_SetupNPC((GUIDSTRING)_Var1, "Lair Offstage", (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_DEN_AttackOnDen_SetupNPC((GUIDSTRING)_Var1, "Defenseless Offstage", (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_DEN_AttackOnDen_AssignFaction(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, _, (STRING)_, (STRING)_, (STRING)_)
THEN
SetFaction(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, ACT1_DEN_AttackOnDen_Memnos_5f5dd07e-ebc3-4cee-8ed8-ce8bb35143ff);

PROC
PROC_DEN_AttackOnDen_TryAddDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_NPC(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 != NULL_00000000-0000-0000-0000-000000000000
THEN
DB_Dialogs(_Var1, _Var3);

PROC
PROC_DEN_AttackOnDen_SetupNPC((GUIDSTRING)_Var1, "Gate", (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_DEN_AttackOnDen_Count("DEN_AttackOnDen_GateDefenders");

PROC
PROC_DEN_AttackOnDen_SetupNPC((GUIDSTRING)_Var1, (STRING)_Var2, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var2 != "Lair"
AND
_Var2 != "Hideout"
AND
_Var2 != ""
THEN
PROC_DEN_AttackOnDen_Count("DEN_AttackOnDen_Tieflings");

PROC
PROC_DEN_AttackOnDen_Count((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
THEN
PROC_IncreaseCounter(_Var1);

PROC
PROC_DEN_AttackOnDen_CheckInitialDefeat()
AND
DB_PermaDefeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _, _, _, _)
AND
DB_PermaDefeated(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_StartAutoRaiderVictory", _, _, _, _)
THEN
SetFlag(DEN_AttackOnDen_Event_InsufficientDefense_d0710769-a13e-3677-39d9-e379d0b8838f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_AttackOnDen_ForceDefeat();

PROC
PROC_DEN_AttackOnDen_CheckInitialDefeat()
AND
DB_GlobalCounter("DEN_AttackOnDen_Tieflings", _Var1, _Var1, _Var1, _Var1)
AND
_Var1 < 12
AND
QRY_OnlyOnce("DEN_AttackOnDen_StartAutoRaiderVictory", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_Event_InsufficientDefense_d0710769-a13e-3677-39d9-e379d0b8838f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_AttackOnDen_ForceDefeat();

PROC
PROC_DEN_AttackOnDen_CheckInitialDefeat()
AND
DB_GlobalCounter("DEN_AttackOnDen_GateDefenders", _Var1, _Var1, _Var1, _Var1)
AND
_Var1 < 2
AND
QRY_OnlyOnce("DEN_AttackOnDen_StartAutoRaiderVictory", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_Event_InsufficientDefense_d0710769-a13e-3677-39d9-e379d0b8838f, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_AttackOnDen_ForceDefeat();

IF
DB_DEN_AttackOnDen_CheckDefeat(1, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_66fa72fc-fd29-4608-89c1-6048467f4091, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_Hideout_e8a663e9-2468-4a64-9127-62632507545f, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_Vault_3c313775-1c89-4f98-9f0b-61a135135461, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_Druid_c940e172-79b0-4be3-b44d-dbdb3224e91f, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_CheckDefeat(1);
DebugBreak("Start Defeat Timer");
TimerLaunch("DEN_AttackOnDen_CheckDefeat", 5000);

IF
TimerFinished("DEN_AttackOnDen_CheckDefeat", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_CheckDefeat();

PROC
PROC_DEN_AttackOnDen_CheckDefeat()
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_66fa72fc-fd29-4608-89c1-6048467f4091, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_Hideout_e8a663e9-2468-4a64-9127-62632507545f, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_Vault_3c313775-1c89-4f98-9f0b-61a135135461, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_AttackOnDenArea_Druid_c940e172-79b0-4be3-b44d-dbdb3224e91f, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_StartAutoRaiderVictory", _, _, _, _)
THEN
DB_DEN_AttackOnDen_Defeated(1);
PROC_DEN_AttackOnDen_ForceDefeat();

PROC
PROC_DEN_AttackOnDen_CheckDefeat()
AND NOT
DB_DEN_AttackOnDen_Defeated(1, _, _, _, _)
THEN
DB_DEN_AttackOnDen_CheckDefeat(1);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
THEN
SetFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_Event_RaidersWinByDefault_e0f44496-90a3-46d1-a1c9-1fbe19ca7632, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_Event_RaidersWinByDefault_e0f44496-90a3-46d1-a1c9-1fbe19ca7632, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_AttackOnDen_DefaultWinJournalHook", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_AoD_NoTieflings_JournalHook();

PROC
PROC_DEN_AttackOnDen_AoD_NoTieflings_JournalHook()
THEN
DB_NOOP(1);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
AND NOT
DB_GlobalFlag(GOB_General_State_Hostile_9816a6fb-54d7-4b9c-a5c7-bc6cda6bb276, _, _, _, _)
THEN
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
AND
DB_DEN_AttackOnDen_ExtraCharactersRemove(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
NOT DB_DEN_AttackOnDen_ExtraCharactersRemove(_Var1);
NOT DB_DEN_AttackOnDen_Raiders(_Var1, _Var2, _Var3, _Var4);
SetOnStage(_Var1, 0);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenArea_66fa72fc-fd29-4608-89c1-6048467f4091);
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenArea_Hideout_e8a663e9-2468-4a64-9127-62632507545f);
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenArea_Druid_c940e172-79b0-4be3-b44d-dbdb3224e91f);
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenArea_Vault_3c313775-1c89-4f98-9f0b-61a135135461);
PROC_TriggerUnregisterForPlayers(S_DEN_LeaderAttackSpotArea_41be541d-570b-447a-9636-6cbab92bbde2);
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenEntranceArea_b45cb766-c7a2-44c8-bd73-91779cd8ce78);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsOpened(_Var1, 0, _Var1, _Var1, _Var1)
THEN
Die(_Var1);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
AND
DB_DEN_NPC(_Var1, _Var2, _, _Var1, _Var1)
AND
_Var2 != ""
AND NOT
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, 1);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
AND
IsOnStage(_Var1, 0, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveHarmfulStatuses(_Var1);
LeaveCombat(_Var1);
PurgeOsirisQueue(_Var1);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, _Var1, 0);
PROC_CharacterEnableAllCrimes(_Var1);
SetCanJoinCombat(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_ForceDefeat()
THEN
RemoveHarmfulStatuses(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
LeaveCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
PurgeOsirisQueue(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);

PROC
PROC_DEN_AttackOnDen_DoniToHideout()
AND
QRY_OnlyOnce("DEN_AttackOnDen_DoniToHideout", _, _, _, _)
THEN
ClearFlag(DEN_AttackOnDen_State_MissingDoni_65b22f09-459c-ebbf-1859-ddc005d067eb, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_CharacterMoveTo(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_AttackKidPos_011_653cf07f-e6ac-46eb-bb02-041ed278498e, "Run", "DEN_AttackOnDen_GruntingInHideout");

IF
DialogActorLeft(DEN_AttackOnDen_LairDoor_bdb3218d-bd21-d32a-e5f7-8df82e2e37a6, _, S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, _, _)
AND
DB_OnlyOnce("DEN_AttackOnDen_GruntingThreeWay", _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_GruntingLeavesLairDoor", _, _, _, _)
THEN
TriggerRegisterForCharacter(S_DEN_MotherSightArea_c7688b7a-e2c6-4919-ba42-3f96de91fc5e, S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);
PROC_CharacterMoveTo(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_GruntingMovePos_0487027c-cac2-45fb-b435-19c8036276db, "Run", "DEN_AttackOnDen_GruntingAtDoor");
PROC_DEN_AttackOnDen_FoundDoni_JournalHook();

PROC
PROC_DEN_AttackOnDen_FoundDoni_JournalHook()
THEN
DB_NOOP(1);

IF
EntityEvent(_, "DEN_AttackOnDen_GruntingAtDoor", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_DEN_AttackOnDen_DoniAtDoor(1);

IF
DB_DEN_AttackOnDen_DoniAtDoor(1, _, _, _, _)
AND
DB_Defeated(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_DoniToHideout();

IF
DB_Sees(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, _, _, _)
THEN
SetEntityEvent(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, "DEN_AttackOnDen_RikkaToDoni");

IF
AutomatedDialogEnded(DEN_AttackOnDen_AD_RikkaAndDoni_a2e68aba-ccd2-7b41-bdcc-68d38284465a, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_DEN_AttackOnDen_DoniToHideout();

QRY
QRY_DEN_AttackOnDen_CanDoLairDialog()
AND
DB_DEN_AttackOnDen_BlockLair(1, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND
QRY_SpeakerIsAvailable(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, _, _, _, _)
AND
QRY_SpeakerIsAvailable(S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_DEN_AttackOnDen_ThreeWayLairDialogAvailable()
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, _, _, _)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_GruntingThreeWay", _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_SelectCustomDialog(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_DEN_AttackOnDen_CanDoLairDialog()
AND
QRY_DEN_AttackOnDen_ThreeWayLairDialogAvailable()
THEN
DB_SelectedDialog(DEN_AttackOnDen_LairDoor_bdb3218d-bd21-d32a-e5f7-8df82e2e37a6, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, _Var1, S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_DEN_AttackOnDen_CanDoLairDialog()
AND
QRY_DEN_AttackOnDen_ThreeWayLairDialogAvailable()
AND
QRY_StartDialog(DEN_AttackOnDen_LairDoor_bdb3218d-bd21-d32a-e5f7-8df82e2e37a6, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, _Var1, S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, _Var1)
THEN
DB_DEN_AttackOnDen_LairDialogStarted(1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_DEN_AttackOnDen_CanDoLairDialog()
AND
QRY_StartDialog(DEN_AttackOnDen_LairDoor_bdb3218d-bd21-d32a-e5f7-8df82e2e37a6, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_LairDialogStarted(1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_BlockLair(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, S_DEN_LairMainOutDoor_1f76e748-d0d5-4cb5-8d0f-7fd96f14285b, 0);
PROC_DEN_AttackOnDen_TryPlayBlockedLairAD(_Var1);

PROC
PROC_DEN_AttackOnDen_TryPlayBlockedLairAD((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_LairDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(DEN_AttackOnDen_PAD_LairDoorBlocked_6eeb78b9-fded-2761-c6f9-8d721ec089a7, _Var1);

IF
DialogActorJoined(DEN_AttackOnDen_LairDoor_bdb3218d-bd21-d32a-e5f7-8df82e2e37a6, _, S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, _, (INTEGER)_)
THEN
DB_OnlyOnce("DEN_AttackOnDen_GruntingThreeWay");

IF
DialogStarted(DEN_AttackOnDen_LairDoor_bdb3218d-bd21-d32a-e5f7-8df82e2e37a6, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
NOT DB_DEN_AttackOnDen_LairDialogStarted(1);

IF
UseStarted(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_GruntingKidHatch_4309dd70-89b1-44c7-a000-5790125ae6d1, _, _, _)
THEN
DB_DEN_AttackOnDen_RikkaBackToCave(1);

IF
DB_DEN_AttackOnDen_RikkaBackToCave(1, _, _, _, _)
AND
DB_DEN_AttackOnDen_GruntingScene(1, _, _, _, _)
AND NOT
DB_DialogNPCs(_, S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_MotherToPrison", _, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_GruntingScene(1);
NOT DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, S_DEN_AttackRikkaPos_1809d6fc-996c-4803-a6a2-dbb4cd261179);
PROC_CharacterMoveTo(S_DEN_Tiefling_001_82f8662d-76da-4352-b37e-01ba433b5d43, S_DEN_AttackRikkaPos_1809d6fc-996c-4803-a6a2-dbb4cd261179, "Walk", "DEN_AttackOnDen_MotherAtPrison");

PROC
PROC_DEN_AttackOnDen_HornBlown((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_GruntingScene(1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(DEN_AttackOnDen_State_MissingDoni_65b22f09-459c-ebbf-1859-ddc005d067eb, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_CharacterMoveTo(S_GLO_GruntingKid_0f8ef61e-cb63-49e1-a242-677173bff5e0, S_DEN_AttackKidPos_011_653cf07f-e6ac-46eb-bb02-041ed278498e, "Run", "DEN_AttackOnDen_GruntingInHideout");
NOT DB_DEN_AttackOnDen_GruntingScene(1);

PROC
PROC_DEN_AttackOnDen_HornBlown((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DEN_AttackONDen_HornBlown_JournalHook();

PROC
PROC_DEN_AttackONDen_HornBlown_JournalHook()
THEN
DB_NOOP(1);

PROC
PROC_DEN_AttackOnDen_UnblockLair()
AND
DB_DEN_AttackOnDen_BlockLair(1, _, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_BlockLair(1);

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_AttackOnDen_DruidFight", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_UnblockLair();

IF
FlagSet(DEN_AttackOnDen_State_DenVictory_71c7f23e-3ff1-c9b8-3ef5-d75fa1b42c8d, _, _, _, _)
AND
DB_GlobalFlag(GLO_AttackOnDen_State_RaidReady_eb361773-da88-dee4-f4c8-a22acae60948, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_UnblockLair();
PROC_SetRelationToPlayers(ACT1_DEN_AttackOnDen_Druid_7347ff55-56c1-4997-b6d1-22e5f29e86d9, 100);

IF
FlagSet(DEN_AttackOnDen_State_DenVictory_71c7f23e-3ff1-c9b8-3ef5-d75fa1b42c8d, _, _, _, _)
AND
DB_DEN_AttackOnDen_BlockOwned(_Var3, 0, _, _, _)
AND
DB_DEN_NPC(_Var3, _, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_BlockOwned(_Var3, 0);

PROC
PROC_DEN_AttackOnDen_DruidsLastStand()
THEN
PROC_DEN_AttackOnDen_UnblockLair();

PROC
PROC_DEN_AttackOnDen_AddToRaiderCombat((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_DefeatCounter_Target("DEN_AttackOnDen_RaiderCombat", _Var2, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var2, 1, _Var3, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "DEN_AttackOnDen_RaiderCombat");
NOT DB_GLO_DefeatCounter_Target("DEN_AttackOnDen_RaiderCombat", _Var2);
DB_GLO_DefeatCounter_Target("DEN_AttackOnDen_RaiderCombat", _Var3);

PROC
PROC_DEN_AttackOnDen_AddToCombatTracking((CHARACTER)_Var1, (STRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_GLO_DefeatCounter(_Var1, _Var2);

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_AttackOnDen_GateCombat", _, _, _, _)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_GateCombatArea_687f429f-91f5-4e8f-9ab2-04cf6cfa23ba);

PROC
PROC_GLO_DefeatCounter_AllDefeated((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_DEN_AttackOnDen_TieflingDefeatCounters(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_DefeatCounterComplete(_Var1);
PROC_DEN_AttackOnDen_EndOfCombat(_Var1);

IF
EnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(S_DEN_RaidersAggroArea_c4bc8b06-6b65-49a0-9e8a-89233c70a3a9);
DB_DEN_AttackOnDen_GateCombatID(_Var2);

IF
DB_DEN_AttackOnDen_GateCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(S_DEN_GateCombatArea_687f429f-91f5-4e8f-9ab2-04cf6cfa23ba);

IF
SwitchedCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_GateCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_GateCombatID(_Var2);
DB_DEN_AttackOnDen_GateCombatID(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_AttackOnDen_GateCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_RaidersAggroArea_c4bc8b06-6b65-49a0-9e8a-89233c70a3a9);
NOT DB_DEN_AttackOnDen_GateCombatID(_Var1);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_GateCombatArea_687f429f-91f5-4e8f-9ab2-04cf6cfa23ba, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_GateCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_TryJoinGateCombat(_Var1);

PROC
PROC_DEN_AttackOnDen_TryJoinGateCombat((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_GateCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetCombatGroupID(_Var1, "DEN_AttackOnDen_GateCombat");

IF
LeftTrigger((CHARACTER)_Var1, S_DEN_GateCombatArea_687f429f-91f5-4e8f-9ab2-04cf6cfa23ba, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetCombatGroupID(_Var1, "DEN_AttackOnDen_GateCombat", _Var1, _Var1, _Var1)
THEN
SetCombatGroupID(_Var1, "");

IF
LeftCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_GateCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
GetCombatGroupID(_Var1, "DEN_AttackOnDen_GateCombat", _Var1, _Var1, _Var1)
THEN
SetCombatGroupID(_Var1, "");

PROC
PROC_DEN_BattleHorn_UsedAndAvailable((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var2);
PROC_DEN_AttackOnDen_HornBlown(_Var1);
SetForceUpdate(S_DEN_BattleHorn_baf1a4c5-b6f9-48c2-908d-164b967655d5, 0);

PROC
PROC_DEN_AttackOnDen_HornBlown((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetRelation(ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var2, _Var1, _Var1)
AND
_Var2 > 24
THEN
PROC_DEN_AttackOnDen_ArrivalDialog(_Var1);
PROC_TriggerRegisterForPlayers(S_DEN_GateCombatArea_687f429f-91f5-4e8f-9ab2-04cf6cfa23ba);
PROC_TriggerUnregisterForPlayers(S_DEN_LeaderAttackSpotArea_41be541d-570b-447a-9636-6cbab92bbde2);
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenEntranceArea_b45cb766-c7a2-44c8-bd73-91779cd8ce78);
DB_OnlyOnce("DEN_AttackOnDen_LeaderEvent");
DB_OnlyOnce("DEN_AttackOnDen_EntranceEvent");

PROC
PROC_DEN_AttackOnDen_HornBlown((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetFlag(DEN_AttackOnDen_Event_ChefAndSonTalked_1877570b-a0f3-4d65-bbba-7db56293242a, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_Event_HornBlown_92dd6f14-e011-4c21-9738-5d49c720a24e, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_AttackOnDen_MoveAfterRaidStarted();

PROC
PROC_DEN_AttackOnDen_HornBlown((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_NPC(_Var2, "Gate", _, _Var1, _Var1)
THEN
SetEntityEvent(_Var2, "DEN_AttackOnDen_WaitAtGates");

PROC
PROC_DEN_AttackOnDen_MoveAfterRaidStarted()
AND
DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, S_DEN_SafetyPos_003_bf03ff45-ba26-46d0-b8f6-9a69ebd079da, _, _, _)
THEN
LeaveCombat(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);
SetFaction(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, ACT1_DEN_AttackOnDen_Defenseless_0d52984d-82c0-44b3-861c-5f8107982525);

PROC
PROC_DEN_AttackOnDen_MoveAfterRaidStarted()
AND
QRY_OnlyOnce("DEN_AttackOnDen_MoveAfterRaidStarted", _, _, _, _)
AND
DB_DEN_AttackOnDen_MoveAfterRaidStarted(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_MoveAfterRaidStarted(_Var1, _Var2);
SetEntityEvent(_Var1, "DEN_AttackOnDen_ForceStopBehaviour");
PROC_ForceStopDialog(_Var1);
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
PROC_CharacterMoveTo(_Var1, _Var2, "Run", "DEN_AttackOnDen_EndOfReturn");

IF
FlagSet(DEN_AttackOnDen_Event_PlayerOpensGate_7c6f5e23-1d26-f209-a307-e79321437576, _, _, _, _)
AND
DB_DEN_CurrentDefenderLeader(_Var3, _, _, _, _)
THEN
PROC_CharacterMoveTo(_Var3, S_DEN_BetrayalLeaderPoint_64f02a17-8d79-4350-a1e6-7f18732eca9d, "Run", "DEN_AttackOnDen_BetrayalLeaderMove");

IF
EntityEvent((CHARACTER)_Var1, "DEN_AttackOnDen_BetrayalLeaderMove", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
LookFromTrigger(_Var1, S_DEN_BetrayalLeaderPoint_8998a7a5-5f97-4239-8481-01a00f329f95, 1);

IF
EntityEvent((GUIDSTRING)_Var1, "DEN_AttackOnDen_EndOfReturn", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetCanJoinCombat(_Var1, 1);

IF
DialogActorJoined(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, _, (CHARACTER)_Var2, _, _)
AND
DB_Players(_Var2, _, _, _, _)
THEN
PROC_RemoveAllPolymorphs(_Var2);

PROC
PROC_DEN_AttackOnDen_ArrivalDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CurrentDefenderLeader(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, NULL_00000000-0000-0000-0000-000000000000, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1)
THEN
PROC_DEN_AttackOnDen_FailedLeaderDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b);

PROC
PROC_DEN_AttackOnDen_ArrivalDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CurrentDefenderLeader(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, NULL_00000000-0000-0000-0000-000000000000, S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1)
THEN
PROC_DEN_AttackOnDen_FailedLeaderDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b);

PROC
PROC_DEN_AttackOnDen_HornBlown((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_GateCombat", _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
GetRelation(ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var3, _Var1, _Var1)
AND
_Var3 < 25
THEN
SetFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, NULL_00000000-0000-0000-0000-000000000000, 0);
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
PROC_AppearOutOfSightTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98, "DEN_AttackOnDen_DrowAppeared");
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GOB_DrowCommander_LeftGoblinCamp");
PROC_CharacterMoveTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_AttackDrowPos_7ae2ec37-9424-4012-89ce-749d73671b12, "Run", "DEN_AttackOnDen_DrowArrivedDuringFight");
PROC_DEN_AttackOnDen_CombatSetup();

IF
EntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "DEN_AttackOnDen_DrowArrivedDuringFight", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_Event_RaidersJoinedCombat_e4535a5f-1967-4c44-9ef9-b30246fbc44d, NULL_00000000-0000-0000-0000-000000000000, 0);
SetCombatGroupID(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "DEN_AttackOnDen_GateCombat");
SetFaction(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5);
PROC_EnterCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1);
TriggerSetSoundState(Amb_SV_RangerCamp_FZ_000_3fd38540-d846-770c-ba66-21c4924dacd6, "CombatPhase_AttackOnDen", "DrowCommanderInCombat", 1);

IF
CombatRoundStarted((GUIDSTRING)_Var1, 2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_AttackOnDen_GateCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_RaidersArriving(1);

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_GateCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_RaidersArriving(1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_RaidersArriving(1);
SetFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, NULL_00000000-0000-0000-0000-000000000000, 0);
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
PROC_AppearOutOfSightTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98, "DEN_AttackOnDen_DrowAppeared");
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GOB_DrowCommander_LeftGoblinCamp");
PROC_CharacterMoveTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_AttackDrowPos_7ae2ec37-9424-4012-89ce-749d73671b12, "Run", "DEN_AttackOnDen_DrowArrivedDuringFight");
PROC_DEN_AttackOnDen_CombatSetup();

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_GateCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
THEN
PROC_TriggerRegisterForParty(S_DEN_FallBackRaiderArea_a66fd67a-a204-4e84-94c4-6263d620d8ec);

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_GateCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
THEN
PROC_CharacterEnableAllCrimes(_Var1);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_FallBackRaiderArea_a66fd67a-a204-4e84-94c4-6263d620d8ec, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("DEN_AttackOnDen_RaidersArrive", _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_RaidersArriving(1);
SetFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, NULL_00000000-0000-0000-0000-000000000000, 0);
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
PROC_AppearOutOfSightTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98, "DEN_AttackOnDen_DrowAppeared");
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GOB_DrowCommander_LeftGoblinCamp");
PROC_CharacterMoveTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_AttackDrowPos_7ae2ec37-9424-4012-89ce-749d73671b12, "Run", "DEN_AttackOnDen_DrowArrivedDuringFight");
PROC_DEN_AttackOnDen_CombatSetup();
PROC_DEN_AttackOnDen_RaidersShowAfterCombat(_Var1);

PROC
PROC_DEN_AttackOnDen_CombatSetup()
AND
GetRelation(ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_BlockGate(1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 < 25
THEN
DB_DEN_AttackOnDen_BlockGate(1);

IF
WentOnStage((ITEM)_Var1, 0, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_BlockGate(1, _Var1, _Var1, _Var1, _Var1)
THEN
SetCanInteract(S_DEN_GateMechanism_5564d21c-9033-4958-8cc8-cd3f497bb51b, 0);

IF
DB_InRegion(_Var1, S_DEN_AttackOnDenEntranceArea_b45cb766-c7a2-44c8-bd73-91779cd8ce78, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_EntranceEvent", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var3, _Var1, 0, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_CheckWyllEvent("Front", DEN_AttackOnDen_EntranceMeeting_278c9ec1-02f0-c9ae-01d8-cd4507ce40cc, _Var1);

IF
DB_InRegion(_Var1, S_DEN_LeaderAttackSpotArea_41be541d-570b-447a-9636-6cbab92bbde2, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_LeaderEvent", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dialogs(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var3, _Var1, 0, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, 0, 1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_CheckWyllEvent("Back", _Var4, _Var1);

PROC
PROC_DEN_AttackOnDen_CheckWyllEvent("Back", (DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var1, _Var4, _Var2, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_DEN_AttackOnDen_CheckWyllEvent("Back", (DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _Var1, _Var1)
AND NOT
QRY_SpeakerIsAvailable(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var1, _Var4, _Var2, _Var1, _Var1)
THEN
SetDualEntityEvent(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, S_DEN_DefenderPos_002_34486062-9eea-4457-8685-38fb06696727, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_CheckWyllEvent("Back", (DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_AttackOnDen_EntranceMeetingWyll_fe7e5e63-53eb-3cba-c140-f7f5e4e68571, S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var2)
THEN
SetDualEntityEvent(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, S_DEN_DefenderPos_002_34486062-9eea-4457-8685-38fb06696727, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_CheckWyllEvent("Front", (DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_LeaderDialog(DEN_AttackOnDen_EntranceMeeting_278c9ec1-02f0-c9ae-01d8-cd4507ce40cc, _Var2);

PROC
PROC_DEN_AttackOnDen_CheckWyllEvent("Front", (DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _Var1, _Var1)
AND NOT
QRY_SpeakerIsAvailable(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_LeaderDialog(DEN_AttackOnDen_EntranceMeeting_278c9ec1-02f0-c9ae-01d8-cd4507ce40cc, _Var2);
SetDualEntityEvent(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, S_DEN_DefenderPos_002_34486062-9eea-4457-8685-38fb06696727, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_CheckWyllEvent("Front", (DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Gate", _, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_AttackOnDen_EntranceMeetingWyll_fe7e5e63-53eb-3cba-c140-f7f5e4e68571, S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var2)
THEN
SetDualEntityEvent(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, S_DEN_DefenderPos_002_34486062-9eea-4457-8685-38fb06696727, "DEN_AttackOnDen_UpdatePosition");

PROC
PROC_DEN_AttackOnDen_LeaderDialog((DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var3, 1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var2, 1, 1, _Var1, _Var1)
AND NOT
QRY_DEN_AttackeOnDen_StartLeaderDialogCustom(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_FailedLeaderDialog(_Var1);

QRY
QRY_DEN_AttackeOnDen_StartLeaderDialogCustom((DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_AttackOnDen_LeaderDialogs(_Var1, _Var3, _Var4, _Var5, _Var6)
AND
QRY_StartDialogCustom(_Var1, S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, NULL_00000000-0000-0000-0000-000000000000, _Var2, _Var3, _Var4, _Var5, _Var6, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_DEN_AttackeOnDen_StartLeaderDialogCustom((DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_AttackOnDen_LeaderDialogs(_Var1, _Var3, _Var4, _Var5, _Var6)
AND
QRY_StartDialogCustom(_Var1, NULL_00000000-0000-0000-0000-000000000000, S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, _Var2, _Var3, _Var4, _Var5, _Var6, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DialogEnded(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_TieflingsGoHostile_1de63f35-f895-ee70-93b3-55aec390a976, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_SideWithTieflings_JournalHook();

PROC
PROC_DEN_AttackOnDen_FailedLeaderDialog(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, _, _, _, _)
THEN
SetFlag(DEN_AttackOnDen_Event_EnemiesAppear_c8e05643-4071-5879-4a4c-911494b6aa81, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_Event_CloseGate_3909ce5d-1ec7-a3c0-8002-f990abd434e3, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_AttackOnDen_SideWithTieflings_JournalHook();

PROC
PROC_DEN_AttackOnDen_SideWithTieflings_JournalHook()
THEN
DB_NOOP(1);

PROC
PROC_DEN_AttackOnDen_FailedLeaderDialog(DEN_AttackOnDen_OpenGateBetrayal_d2904b97-9ebd-7ffc-135c-2d89ff6668f2, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_BetrayTieflings();

IF
DialogActorJoined((DIALOGRESOURCE)_Var1, _, (CHARACTER)_Var3, _, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_AttackOnDen_MeetingDialogs(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_AttackOnDen_DisableLeaderMeeting", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_LeaderAttackSpotArea_41be541d-570b-447a-9636-6cbab92bbde2);
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenEntranceArea_b45cb766-c7a2-44c8-bd73-91779cd8ce78);
DB_OnlyOnce("DEN_AttackOnDen_LeaderEvent");
DB_OnlyOnce("DEN_AttackOnDen_EntranceEvent");

IF
FlagSet(DEN_AttackOnDen_Event_CloseGate_3909ce5d-1ec7-a3c0-8002-f990abd434e3, _, _, _, _)
AND
DB_DEN_GateInUse(_Var3, _, _, _, _)
THEN
PROC_DEN_Gate_OpenOrCloseGate(1);
SetCanInteract(_Var3, 1);

IF
FlagSet(DEN_AttackOnDen_Event_EnemiesAppear_c8e05643-4071-5879-4a4c-911494b6aa81, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, NULL_00000000-0000-0000-0000-000000000000, 0);
SetCanJoinCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
PROC_AppearOutOfSightTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, S_DEN_RaidersAppearDirection_23297c54-bc3e-4c46-88f4-0864d444ff98, "DEN_AttackOnDen_DrowAppeared");
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GOB_DrowCommander_LeftGoblinCamp");
PROC_CharacterMoveTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_AttackDrowPos_7ae2ec37-9424-4012-89ce-749d73671b12, "Run", "");
PROC_DEN_AttackOnDen_CombatSetup();

PROC
PROC_DEN_AttackOnDen_CombatSetup()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _Var3, _Var4, _Var1)
THEN
PROC_AppearOutOfSightTo(_Var1, _Var3, _Var4, "DEN_AttackOnDen_RaiderAppeared");
PROC_DEN_AttackOnDen_AddToRaiderCombat(_Var1);

IF
EntityEvent((CHARACTER)_Var1, "DEN_AttackOnDen_RaiderAppeared", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _Var2, _, _, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, _Var2, "Run", "DEN_AttackOnDen_InCombatPosition");

IF
EntityEvent((CHARACTER)_Var1, "DEN_AttackOnDen_InCombatPosition", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _Var2, _, _, _Var1)
THEN
LookFromTrigger(_Var1, _Var2, 0);

IF
DB_DEN_AttackOnDen_Raiders(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_Raiders(_Var1, _Var2, _Var3, _Var4);

IF
DialogEnded(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_EnemiesAppear_c8e05643-4071-5879-4a4c-911494b6aa81, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_Event_EnemiesAppear_c8e05643-4071-5879-4a4c-911494b6aa81, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogEnded(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
SetCombatGroupID(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "DEN_AttackOnDen_GateCombat");
SetFaction(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5);

IF
BaseFactionChanged(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, (FACTION)_, (FACTION)_)
THEN
PROC_DEN_AttackOnDen_StartCombat();

PROC
PROC_DEN_AttackOnDen_StartCombat()
AND
QRY_OnlyOnce("DEN_AttackOnDen_DrowJoinsFight", _, _, _, _)
AND
DB_DEN_CurrentDefenderLeader(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_EnterCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1);
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "GOB_SetAiTarget_DenGate");
TriggerSetSoundState(Amb_SV_RangerCamp_FZ_000_3fd38540-d846-770c-ba66-21c4924dacd6, "CombatPhase_AttackOnDen", "DrowCommanderInCombat", 1);

PROC
PROC_DEN_AttackOnDen_StartCombat()
AND
QRY_OnlyOnce("DEN_AttackOnDen_PlayersJoinFight", _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_DEN_GateCombatArea_687f429f-91f5-4e8f-9ab2-04cf6cfa23ba, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_EnterCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1);
TriggerSetSoundState(Amb_SV_RangerCamp_FZ_000_3fd38540-d846-770c-ba66-21c4924dacd6, "CombatPhase_AttackOnDen", "DrowCommanderInCombat", 1);

IF
DialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_AttackOnDen_MeetingDialogs(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_Event_BetrayTieflingsBeforeFight_1491f60b-8d1a-7987-22d0-dfaf2dac8863, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_BetrayTieflings();

IF
FlagSet(DEN_AttackOnDen_Event_PlayerOpensGate_7c6f5e23-1d26-f209-a307-e79321437576, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_GateInUse(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_BlockGate(1);
Use(_Var1, S_DEN_GateMechanism_5564d21c-9033-4958-8cc8-cd3f497bb51b, "DEN_AttackOnDen_PlayerOpensGate");

IF
UseStarted(_, (ITEM)_Var2, _, _, _)
AND
DB_DEN_GateInUse(_Var2, _, _, _, _)
AND
DB_DEN_AttackOnDen_BlockGate(1, _, _, _, _)
THEN
TimerLaunch("DEN_AttackOnDen_DisableLeverTimer", 2000);

IF
TimerFinished("DEN_AttackOnDen_DisableLeverTimer", _, _, _, _)
THEN
SetCanInteract(S_DEN_GateMechanism_5564d21c-9033-4958-8cc8-cd3f497bb51b, 0);

IF
DialogEnded(DEN_AttackOnDen_RaidersArriveBeforeFight_b99a0f87-92fa-0e6f-1bf4-c668ae3d012b, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_Event_TieflingsGoHostile_1de63f35-f895-ee70-93b3-55aec390a976, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_BetrayTieflings();

PROC
PROC_DEN_AttackOnDen_BetrayTieflings()
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_BetrayTieflings", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_MoveAfterRaidStarted();
SetImmortal(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
SetFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100);
PROC_SetRelationMutual(ACT1_DEN_AttackOnDen_NPC_08f28bce-a261-35e2-9914-6aa8b3eea155, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);
PROC_DEN_AttackOnDen_TieflingBetrayal_JournalHook();
PROC_DEN_AttackOnDen_SomeTieflingsFlee();

PROC
PROC_DEN_AttackOnDen_BetrayTieflings()
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_BetrayTieflings", _, _, _, _)
AND
DB_DEN_NPC(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_CombatGroupAreas(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(_Var4, _Var1);

PROC
PROC_DEN_AttackOnDen_BetrayTieflings()
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_BetrayTieflings", _, _, _, _)
AND
DB_DEN_NPC(_Var1, _, _, _Var1, _Var1)
AND
DB_DialogNPCs(_, _Var1, _, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);

PROC
PROC_DEN_AttackOnDen_BetrayTieflings()
THEN
DB_OnlyOnce("DEN_AttackOnDen_BetrayTieflings");

PROC
PROC_DEN_AttackOnDen_SomeTieflingsFlee()
AND
DB_DEN_AttackOnDen_FleeingTieflings(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetCanJoinCombat(_Var1, 0);
SetCanFight(_Var1, 0);
PROC_CharacterMoveTo(_Var1, S_DEN_SafeFleePos_0c928fd6-ef89-47bc-9fa8-7c37b29ea51c, "Run", "DEN_AttackOnDen_Fled");

PROC
PROC_DEN_AttackOnDen_SomeTieflingsFlee()
AND
DB_DEN_AttackOnDen_FleeingTieflings(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var1, _, _, _Var1, _Var1)
AND
DB_GLO_DefeatCounter(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_DefeatCounter(_Var1, _Var4);

IF
EntityEvent((GUIDSTRING)_Var1, "DEN_AttackOnDen_Fled", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetOnStage(_Var1, 0);

IF
FlagSet(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
TriggerClearItemsOwner(S_DEN_Trainer_Ownership_5db200ee-bcb1-4a41-b5cc-72be9bc9cbc4);
TriggerClearItemsOwner(S_DEN_CookOwnership_c24dc854-a503-48b8-9f4a-9529a21af5ce);
TriggerClearItemsOwner(S_DEN_AdventurersOwnership_cae8006a-7681-40a9-a30f-226a98222f11);
TriggerClearItemsOwner(S_DEN_HagOwnership_d19456f1-799e-46d4-8a9c-e817997d0d6f);
TriggerClearItemsOwner(S_DEN_Refugee001_Ownership_7af2e1ed-65e7-4de0-b2e3-01f63c23621f);
TriggerClearItemsOwner(S_DEN_TieflingGuard_004_Ownership_9f0db868-d124-4b57-8546-8c4b35492161);
TriggerClearItemsOwner(S_DEN_YoungLover_Ownership_f2100a37-48df-40a3-bdfa-fe6630db40cf);
TriggerClearItemsOwner(S_DEN_Tiefling005_Trespassing_a2f33199-1006-4371-ac62-3dbfbd6513fb);
TriggerClearItemsOwner(S_DEN_Weaponsmith_Ownership_85ef12d9-33ce-4772-9519-b902935d1232);
TriggerClearItemsOwner(S_DEN_Pickpocket_Ownership_4c0e2489-d97c-49da-aedd-9b27d0251cd5);
TriggerClearItemsOwner(S_DEN_Hideout_ThiefSpotBox_de0d46cf-d0bf-4879-b79e-bcec68bf64f4);
TriggerClearItemsOwner(S_DEN_SenderOwnership_78e70f78-e183-497f-ace8-462df3dd8b56);
TriggerClearItemsOwner(S_DEN_PondOwnership_aff112d5-b79e-405e-9114-6b70aea65a06);
TriggerClearItemsOwner(S_DEN_ZenBearOwnership_d2c760c9-32d1-4cef-8ddd-7337325cf178);
TriggerClearItemsOwner(S_DEN_DruidEntrance_Ownership_137c1348-fafd-44cf-924e-eb4df6de9bb6);
TriggerClearItemsOwner(S_DEN_DruidsQuartersOwnership_989c7fa8-4a8d-4159-8625-b802dbf81b97);
TriggerClearItemsOwner(S_DEN_SecretLibrary_SUB_14dd754c-4b74-4aa7-bbec-471c2f8a0c61);
TriggerClearItemsOwner(S_DEN_AppOwnership_6b0e6f9c-bffe-4643-922e-2c97ea39dca7);
TriggerClearItemsOwner(S_DEN_LeaderMainOwnership_7ff915af-57a5-4d4d-9fd3-95e33d37c433);

PROC
PROC_DEN_AttackOnDen_TieflingBetrayal_JournalHook()
THEN
DB_NOOP(1);

IF
AttackedBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var1, _, _, _Var1, _Var1)
AND
_Var1 != S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsEnemy(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1, 0, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_BetrayTieflings();

IF
DestroyedBy((ITEM)_Var1, (CHARACTER)_Var2, _, _, (ITEM)_Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_BetrayTieflings();

IF
FlagSet(DEN_AttackOnDen_Event_WyllLeaves_cfefd3d2-bfa4-0c1f-7109-41ad313abc9d, _, (INTEGER)_Var2, _, _)
AND
DB_PartOfTheTeam(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
AND
QRY_Origins_PlayerForItemsOfLeavingCompanion(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var2, _, _, _)
AND
DB_QRYRTN_Origins_PlayerForItemsOfLeavingCompanion(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var3, _, _, _)
THEN
DB_CompanionLeaving(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var3);
PROC_Origins_CompanionLeavePermanently(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "CompanionLowRelation");
PROC_DEN_AttackOnDen_WyllLeaves_CheckWyllInCamp();

PROC
PROC_DEN_AttackOnDen_WyllLeaves_CheckWyllInCamp()
AND
DB_InCamp(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
THEN
PROC_DisappearOutOfSight(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, "Run", 0, "GLO_CompanionLeaves_LowRelation");

PROC
PROC_DEN_AttackOnDen_WyllLeaves_CheckWyllInCamp()
AND NOT
DB_InCamp(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _, _)
THEN
SetFaction(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, ACT1_DEN_AttackOnDen_Gate_4ec9e6b5-f0c2-e413-489c-1f6c10a1a50f);

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_AttackOnDen_RaiderCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_LeaderCelebration", _, _, _, _)
THEN
DebugBreak("Raiders defeated!");
PROC_DEN_AttackOnDen_BringBackOffstageCharacters();
ClearFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_State_DenVictory_71c7f23e-3ff1-c9b8-3ef5-d75fa1b42c8d, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_AttackOnDen_VictoryInvitation();

PROC
PROC_DEN_AttackOnDen_BringBackOffstageCharacters()
AND
DB_DEN_NPC(_Var1, "Lair Offstage", _, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_BringBackOffstageCharacters()
AND
DB_DEN_NPC(_Var1, "Defenseless Offstage", _, _Var1, _Var1)
THEN
PROC_AppearOutOfSightTo(_Var1, S_DEN_LeaderCavePoint_03f82037-c5ca-4cb6-a858-02c5cc6a52ff, S_DEN_LeaderCavePoint_03f82037-c5ca-4cb6-a858-02c5cc6a52ff, "");

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_GateCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(_Var1, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var2, _Var1, _Var1)
AND
_Var2 < 55
AND
QRY_OnlyOnce("DEN_AttackOnDen_MindMeldAfterGateCombat", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialogCustom(DEN_AttackOnDen_DrowMindMeldAfterGateCombat_861cbf47-f9ab-f0c4-5ff7-821eb491bbaa, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1, 1, 1, 0, 1, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_RaidersReadyToMove(1);

IF
FlagSet(DEN_AttackOnDen_Event_OpenGateAfterCombat_87870d5c-74b1-6c3c-2968-c6dea44e7f0b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_DEN_Gate_OpenOrCloseGate(0);

IF
DialogEnded(DEN_AttackOnDen_DrowMindMeldAfterGateCombat_861cbf47-f9ab-f0c4-5ff7-821eb491bbaa, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
DB_DEN_AttackOnDen_RaidersReadyToMove(1);

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_GateCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_RaidersWinByDefault_e0f44496-90a3-46d1-a1c9-1fbe19ca7632, _, _, _, _)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_MindMeldAfterGateCombat", _, _, _, _)
THEN
DB_DEN_AttackOnDen_RaidersReadyToMove(1);

PROC
PROC_DEN_AttackOnDen_RaidersShowAfterCombat((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_StartDialog(DEN_AttackOnDen_RaidersArriveAfterFight_f5fbe4d0-7e3e-f9a8-1e5c-3eb4f0561a8c, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_RaidersReadyToMove(1);

IF
DialogEnded(DEN_AttackOnDen_RaidersArriveAfterFight_f5fbe4d0-7e3e-f9a8-1e5c-3eb4f0561a8c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
DB_DEN_AttackOnDen_RaidersReadyToMove(1);

IF
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_PotentialCaveRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_PotentialCaveRaiders(_Var1);

IF
DB_DEN_OpenedGate(1, _, _, _, _)
AND
DB_DEN_AttackOnDen_RaidersReadyToMove(1, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_RaidersWinByDefault_e0f44496-90a3-46d1-a1c9-1fbe19ca7632, _, _, _, _)
THEN
SetCanInteract(S_DEN_GateMechanism_5564d21c-9033-4958-8cc8-cd3f497bb51b, 0);
SetFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_DEN_AttackOnDen_RaidersGoInsideDen();

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
THEN
PROC_SetRelationMutual(ACT1_DEN_AttackOnDen_Cave_be9ef27b-18d4-4168-a798-5c6b744e0c08, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, 0);

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
THEN
SetCombatGroupID(_Var1, "");
SetCanJoinCombat(_Var1, 1);
PROC_SetCanFight(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND
DB_DEN_AttackOnDen_VictoryRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, _Var1);

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
THEN
Unlock(S_DEN_StorageDoor_e2911d4f-2b43-48e4-a1c2-5c4cc53bae8d);

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND
SysCount("DB_DEN_AttackOnDen_CaveRaiders", 1, _Var1, _Var1, _Var1)
AND
_Var1 < 4
THEN
PROC_DEN_AttackOnDen_RefillCaveRaiders();

PROC
PROC_DEN_AttackOnDen_RefillCaveRaiders()
AND
DB_DEN_AttackOnDen_CaveHoldRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
SysCount("DB_DEN_AttackOnDen_CaveRaiders", 1, _Var2, _Var1, _Var1)
AND
_Var2 < 4
THEN
DB_DEN_AttackOnDen_CaveRaiders(_Var1);
NOT DB_DEN_AttackOnDen_CaveHoldRaiders(_Var1);

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND
DB_DEN_AttackOnDen_CaveHoldRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
TriggerGetRandomPosition(S_DEN_CaveHoldArea_d9120f68-0d1a-47d6-9e10-0e896eb0132a, _Var2, _Var3, _Var4, _Var1)
THEN
SetCombatGroupID(_Var1, "");
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
PROC_CharacterMoveToPosition(_Var1, _Var2, _Var3, _Var4, "Run", "DEN_AttackOnDen_AtCaveHoldPos");

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND NOT
DB_Defeated(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, _, _, _, _)
AND
TriggerGetRandomPosition(S_DEN_CaveHoldArea_d9120f68-0d1a-47d6-9e10-0e896eb0132a, _Var1, _Var2, _Var3, _Var1)
THEN
SetCombatGroupID(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, "");
SetEntityEvent(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, "ClearPeaceReturn", 1);
PROC_CharacterMoveToPosition(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, _Var1, _Var2, _Var3, "Run", "DEN_AttackOnDen_AtCaveHoldPos");

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND
DB_DEN_AttackOnDen_CaveRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
TriggerGetRandomPosition(S_DEN_CaveHoldArea2_4d34380b-ef29-4d6e-9cf8-72aa39851a05, _Var2, _Var3, _Var4, _Var1)
THEN
SetCombatGroupID(_Var1, "");
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
PROC_CharacterMoveToPosition(_Var1, _Var2, _Var3, _Var4, "Run", "DEN_AttackOnDen_AtCaveCombatPos");

PROC
PROC_DEN_AttackOnDen_DruidsLastStand()
AND NOT
DB_PermaDefeated(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, _, _, _, _)
AND
TriggerGetRandomPosition(S_DEN_DruidHoldArea_3a69cc72-ddec-40f3-bfea-206603c7701b, _Var1, _Var2, _Var3, _Var1)
THEN
ClearFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39);
PROC_CharacterMoveToPosition(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, _Var1, _Var2, _Var3, "Run", "DEN_AttackOnDen_AtDruidCombatPos");

PROC
PROC_DEN_AttackOnDen_DruidsLastStand()
AND
DB_DEN_AttackOnDen_DruidRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
TriggerGetRandomPosition(S_DEN_DruidHoldArea_3a69cc72-ddec-40f3-bfea-206603c7701b, _Var2, _Var3, _Var4, _Var1)
THEN
PROC_AppearOutOfSightTo(_Var1, S_DEN_DruidHoldArea_3a69cc72-ddec-40f3-bfea-206603c7701b, S_DEN_DruidGoblinsAppearDirection_e9ed2e9b-41cf-44cc-a1a8-1c1a90955228, "GOB_DrowCommander_LeftGoblinCamp");
PROC_CharacterMoveToPosition(_Var1, _Var2, _Var3, _Var4, "Run", "DEN_AttackOnDen_AtDruidCombatPos");

IF
DB_GlobalFlag(DEN_AttackOnDen_State_DruidsAreDefeated_3c6d8a2c-dd85-48d1-b48d-f0c6d37959e4, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND
DB_DEN_AttackOnDen_DruidRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, _Var1);

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND NOT
DB_PermaDefeated(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND
DB_DEN_AttackOnDen_AllTieflingsDefeatCounters(1, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_DrowCelebration", _, _, _, _)
THEN
SetCombatGroupID(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "");
PROC_RemoveDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
DB_Dialogs(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, DEN_AttackOnDen_Drow_84abf1c9-de21-4db1-cbb1-0046faf2fc45);
FlushOsirisQueue(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "ClearPeaceReturn", 1);
PROC_CharacterMoveTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_DrowSafePos_f25283db-31d2-4ced-a0fa-c0a75d6f5621, "Run", "DEN_AttackOnDen_Victory");

IF
DB_DEN_AttackOnDen_RaidersReadyToMove(1, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_ExtraRaidersLeave();

PROC
PROC_DEN_AttackOnDen_ExtraRaidersLeave()
AND
DB_DEN_AttackOnDen_ExtraCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_RaiderVictoryPositions(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_DEN_GoblinAppearDirection_2d5a4623-399f-4b23-b7cc-2cd5f2635fc0, "Walk", "DEN_AttackOnDen_RaiderDisappear");

IF
EntityEvent((CHARACTER)_Var1, "DEN_AttackOnDen_RaiderDisappear", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 1, "");

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
AND
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_CaveCombat", _, _, _, _)
AND NOT
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_DefenselessCombat", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_CaveCombat");

IF
FlagSet(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_RaiderVictoryPositions(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
SetCombatGroupID(_Var1, "");
SetFaction(_Var1, ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25);
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
PROC_CharacterMoveTo(_Var1, _Var3, "Run", "DEN_AttackOnDen_Victory");

IF
FlagSet(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_CaveRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "DEN_AttackOnDen_Victory");

IF
WentOnStage((CHARACTER)_Var1, 1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
THEN
SetEntityEvent(_Var1, "GOB_DrowCommander_LeftGoblinCamp");

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_CaveCombat", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_DruidsLastStand();

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_CaveCombat", _, _, _, _)
AND
GetFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
AND NOT
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_DefenselessCombat", _, _, _, _)
AND NOT
DB_PermaDefeated(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_RaidersToSafeArea();

PROC
PROC_DEN_AttackOnDen_RaidersToSafeArea()
AND
DB_DEN_AttackOnDen_SafeRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
TriggerGetRandomPosition(S_DEN_SafeHoldArea_7e41e6ac-21ea-4235-be57-78a07b389a76, _Var2, _Var3, _Var4, _Var1)
THEN
FlushOsirisQueue(_Var1);
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
PROC_CharacterMoveToPosition(_Var1, _Var2, _Var3, _Var4, "Run", "DEN_AttackOnDen_RaiderAtPrison");

IF
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_DruidsAreDefeated_3c6d8a2c-dd85-48d1-b48d-f0c6d37959e4, _, _, _, _)
AND
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_CaveCombat", _, _, _, _)
THEN
SetEntityEvent(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, "ClearPeaceReturn", 1);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39);

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_CaveCombat", _, _, _, _)
AND
GetFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
AND
DB_DEN_AttackOnDen_CaveHoldRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, _Var1);

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_CaveCombat", _, _, _, _)
AND
GetFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
AND
DB_DEN_AttackOnDen_CaveRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_SafeRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, _Var1);

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_CaveCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND
DB_DEN_AttackOnDen_AllTieflingsDefeatCounters(1, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_DrowCelebration", _, _, _, _)
THEN
PROC_RemoveDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
DB_Dialogs(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, DEN_AttackOnDen_Drow_84abf1c9-de21-4db1-cbb1-0046faf2fc45);
FlushOsirisQueue(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "ClearPeaceReturn", 1);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39);
PROC_AttackOnDen_StartDrowSpotting();

PROC
PROC_AttackOnDen_StartDrowSpotting()
THEN
DB_SpotPlayers(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "DEN_AttackOnDen_DrowVictory", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "DEN_AttackOnDen_DrowVictory", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialog(DEN_AttackOnDen_Drow_84abf1c9-de21-4db1-cbb1-0046faf2fc45, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);
PROC_CharacterMoveToAndTalk(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1, DEN_AttackOnDen_Drow_84abf1c9-de21-4db1-cbb1-0046faf2fc45, "DEN_AttackOnDen_DrowMovesToPlayer", "Run", 20);

IF
DB_DEN_AttackOnDen_DefeatCounterComplete(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugBreak(_Var1);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var1, "Defenseless", _, _Var1, _Var1)
AND
DB_Is_InCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var2, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "FRIGHTENED", -1, 1);

IF
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _Var1, _Var1)
AND
DB_DEN_NPC(_Var1, "Defenseless", _, _Var1, _Var1)
THEN
RequestSetSwarmGroup(_Var1, "DEN_AttackOnDen_DefenselessNPC");

IF
FlagSet(DEN_AttackOnDen_State_DenVictory_71c7f23e-3ff1-c9b8-3ef5-d75fa1b42c8d, _, _, _, _)
AND
DB_DEN_NPC(_Var3, "Defenseless", _, _, _)
THEN
RequestSetSwarmGroup(_Var3, "");

IF
CombatStarted((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_DefenselessFacing", _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var2, "Defenseless", _, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, S_DEN_SafetyIntroArea_0a8547e8-e0b2-4c46-abdd-a0a2f1a5faf8, 1, _Var1, _Var1)
THEN
LookAtEntity(_Var2, S_DEN_TieflingLeaderInDoor_a5378747-7087-4adf-a529-8ce24ae9d1e2);
DB_OnlyOnce("DEN_AttackOnDen_DefenselessFacing");

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var1, "Defenseless", _, _Var1, _Var1)
AND
DB_Is_InCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var2, _Var1, _Var1, _Var1)
THEN
FleeFrom(_Var1, "Enemy", 5);

IF
EntityEvent((GUIDSTRING)_Var1, "DEN_AttackOnDen_RaiderAtPrison", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("DEN_AttackOnDen_DefenselessCombat", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationMutual(ACT1_DEN_AttackOnDen_Defenseless_0d52984d-82c0-44b3-861c-5f8107982525, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, 0);

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_DefenselessCombat", _, _, _, _)
AND
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_CaveCombat", _, _, _, _)
AND
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_GateCombat", _, _, _, _)
THEN
ClearFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, NULL_00000000-0000-0000-0000-000000000000, 0);
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_DefenselessCombat");

IF
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND
DB_DEN_AttackOnDen_AllTieflingsDefeatCounters(1, _, _, _, _)
THEN
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41);
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b);

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_DefenselessCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND
DB_DEN_AttackOnDen_AllTieflingsDefeatCounters(1, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_DrowCelebration", _, _, _, _)
THEN
PROC_RemoveDialog(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
DB_Dialogs(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, DEN_AttackOnDen_Drow_84abf1c9-de21-4db1-cbb1-0046faf2fc45);
FlushOsirisQueue(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);
SetEntityEvent(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "ClearPeaceReturn", 1);
PROC_AttackOnDen_StartDrowSpotting();

IF
FlagSet(DEN_AttackOnDen_State_RaiderVictory_abe1bce8-c234-4afe-a490-76210d98a078, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_DEN_AttackOnDen_ClearPartyDialogSuppression();

IF
FlagSet(DEN_AttackOnDen_State_DenVictory_71c7f23e-3ff1-c9b8-3ef5-d75fa1b42c8d, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_DEN_AttackOnDen_ClearPartyDialogSuppression();

PROC
PROC_DEN_AttackOnDen_ClearPartyDialogSuppression()
THEN
NOT DB_PartyDialogSuppressionZone(S_DEN_AttackOnDenArea_66fa72fc-fd29-4608-89c1-6048467f4091);

PROC
PROC_DEN_AttackOnDen_ClearPartyDialogSuppression()
AND
DB_DEN_InDenTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PartyDialogSuppressionZone(_Var1);

IF
FlagSet(DEN_AttackOnDen_State_RaiderVictory_abe1bce8-c234-4afe-a490-76210d98a078, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetImmortal(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);
PROC_State_Progress(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RaiderVictory");

IF
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_CaveCombat", _, _, _, _)
AND
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_DefenselessCombat", _, _, _, _)
AND
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_GateCombat", _, _, _, _)
THEN
DB_DEN_AttackOnDen_AllTieflingsDefeatCounters(1);

IF
DB_DEN_AttackOnDen_AllTieflingsDefeatCounters(1, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_DruidsAreDefeated_3c6d8a2c-dd85-48d1-b48d-f0c6d37959e4, _, _, _, _)
THEN
ClearFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_State_RaiderVictory_abe1bce8-c234-4afe-a490-76210d98a078, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DEN_AttackOnDen_KillEveryone()
AND
DB_DEN_NPC(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
Die(_Var1, 0, 1);

PROC
PROC_DEN_AttackOnDen_End()
THEN
ClearFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DEN_AttackOnDen_End()
AND
DB_DEN_NPC(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
_Var2 != ""
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);
SetEntityEvent(_Var1, "DEN_AttackOnDen_Event_AttackIsOver");

IF
FlagSet(DEN_AttackOnDen_Debug_Start_10b6026f-b246-7f88-aa40-a653fe08d861, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_GOB_DrowCommander_DEBUG_BlockSortie(1);
SetFlag(GOB_DrowCommander_Event_RaidersSortie_26816b01-2d64-b50c-3bf6-bffd7dc5f0b9, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_GOB_DrowCommander_RaidersForceLeave();

IF
TextEvent("ReadyAttackOnDen", _, _, _, _)
THEN
PROC_DEN_RaidingParty_DebugResolveConfrontation();
PROC_TeleportPartiesTo(S_CHA_Debug_LaezelRecruitPoint_22095e5a-57af-438e-a303-6c5a38b2cef8, "");
SetFlag(DEN_AttackOnDen_Debug_Start_10b6026f-b246-7f88-aa40-a653fe08d861, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_GlobalFlag(DEN_AttackOnDen_Debug_Start_10b6026f-b246-7f88-aa40-a653fe08d861, _, _, _, _)
AND
DB_GlobalFlag(GLO_AttackOnDen_State_RaidReady_eb361773-da88-dee4-f4c8-a22acae60948, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_StartSetup", _, _, _, _)
THEN
PROC_State_IfCurrentProgressElse(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_LockdownComplete", "DEN_State_LockdownAttackOnDen", "DEN_State_AttackOnDen");

IF
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_DEN_HideoutArea_c4f9e65f-fc63-42b6-bd2e-eba70b24a700, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_KidsDieOrRun", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_KillKids();

IF
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND
QRY_TriggerEvents_AnyPlayerInTrigger(S_DEN_HideoutArea_c4f9e65f-fc63-42b6-bd2e-eba70b24a700, _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_KidsDieOrRun", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_KidsRunAway();

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_HideoutArea_c4f9e65f-fc63-42b6-bd2e-eba70b24a700, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("DEN_AttackOnDen_KidsDieOrRun", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_KidsRunAway();

PROC
PROC_DEN_AttackOnDen_KidsRunAway()
AND
DB_DEN_NPC(_Var1, "Hideout", _, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);
PROC_DisappearOutOfSight(_Var1, "Run", 1, "");

PROC
PROC_DEN_AttackOnDen_KidsRunAway()
THEN
PROC_ForceStopDialog(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c);
PROC_TryStartAD(DEN_AttackOnDen_AD_BardDefendsKids_4891a78e-5b0c-c5b6-f1a6-35c38aadc939, S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c);

PROC
PROC_DEN_AttackOnDen_KillKids()
AND
DB_DEN_NPC(_Var1, "Hideout", _, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_DeadKid(_Var1);
SetImmortal(_Var1, 0);
Die(_Var1, 0, 1);
CreatePuddle(_Var1, "SurfaceBlood", 10, 15, 10, 20, 1);

PROC
PROC_DEN_AttackOnDen_KillKids()
THEN
Die(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c, 0, 1);
CreatePuddle(S_DEN_Bard_4a405fba-3000-4c63-97e5-a8001ebb883c, "SurfaceBlood", 10, 15, 10, 20, 1);
SetOnStage(S_GOB_RaiderThirsty_64889786-dbc4-4acf-b17b-149527e898c7, 1);
SetOnStage(S_GOB_RaiderMurderous_04428629-2857-4795-b9b6-b41a06d9a889, 1);

IF
DB_DEN_AttackOnDen_DeadKid(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_DeadKidsReaction(1, _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(DEN_AttackOnDen_VB_DeadKids_3282fab5-a566-96be-d472-e69d93434f35, _Var2);
DB_DEN_AttackOnDen_DeadKidsReaction(1);

IF
DB_DEN_CurrentDefenderLeader(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var1, S_DEN_LeaderVictoryPos_04e4c483-3125-40bc-9bfe-e9bfa589b6d7, "DEN_AttackOnDen_VictoryPosition");

PROC
PROC_DEN_AttackOnDen_VictoryInvitation()
AND
DB_DEN_CurrentDefenderLeader(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_State_WaitingForCelebration_97e3e4e8-eab2-4d32-1ae7-f0ba20a75c42, _Var1, 0);
PROC_DEN_Gate_OpenOrCloseGate(0);
PROC_State_Progress(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDenVictory");

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDenVictory", _, _)
THEN
PROC_DEN_AttackOnDen_Victory();

PROC
PROC_DEN_AttackOnDen_Victory()
AND
DB_DEN_AttackOnDen_NonLeaveNPCs(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, _Var2, "Walk", "");

PROC
PROC_DEN_AttackOnDen_Victory()
AND
GetEquippedItem(S_DEN_Trainee_001_1f839ad2-2bcb-47d2-8de9-db7a1fb5d67f, "Melee Main Weapon", _Var1, _Var1, _Var1)
THEN
RequestDelete(_Var1);

PROC
PROC_DEN_AttackOnDen_Victory()
AND
DB_PermaDefeated(S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a, _, _, _, _)
AND
DB_PermaDefeated(S_DEN_Trainer_02025646-347a-4235-aef7-e46b7c94b435, _, _, _, _)
THEN
SetOnStage(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, 1);
TriggerRegisterForCharacter(S_DEN_VictorySceneArea_a0b30a20-2514-4238-b220-fdf45c6a4f19, S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892);

PROC
PROC_DEN_AttackOnDen_Victory()
AND
DB_DEN_CurrentDefenderLeader(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, _, _, _, _)
AND
DB_GLO_Halsin_ReadyForDen(1, _, _, _, _)
THEN
PROC_GLO_Halsin_TeleportToDen();

IF
EnteredTrigger(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, S_DEN_VictorySceneArea_a0b30a20-2514-4238-b220-fdf45c6a4f19, _, _, _)
THEN
PROC_AttackOnDen_TryRegisterBackupSpotting();
TriggerUnregisterForCharacter(S_DEN_VictorySceneArea_a0b30a20-2514-4238-b220-fdf45c6a4f19, S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892);

PROC
PROC_AttackOnDen_TryRegisterBackupSpotting()
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_TieflingPartyInvitation_545593fd-42e6-15c1-1e96-18e0e0be0443, _, _, _, _)
THEN
DB_SpotPlayers_SpotTrigger(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, "DEN_AttackOnDen_BackupVictorySpotting", S_DEN_VictorySceneArea_a0b30a20-2514-4238-b220-fdf45c6a4f19);
DB_SpotPlayers(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, "DEN_AttackOnDen_BackupVictorySpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted(S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, "DEN_AttackOnDen_BackupVictorySpotting", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialog(DEN_AttackOnDen_BackupLeader_92b83e7a-534b-ebbc-8e8a-7a89d0d1bdab, S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EntityEvent((CHARACTER)_Var1, "DEN_AttackOnDen_VictoryMoveComplete", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GLO_Halsin_DebugAttackOnDenMeet(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(S_DEN_VictorySceneArea_a0b30a20-2514-4238-b220-fdf45c6a4f19);

IF
DialogStarted((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_AttackOnDen_VictoryDialogs(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_TieflingPartyInvitation_545593fd-42e6-15c1-1e96-18e0e0be0443, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_Event_TieflingPartyInvitation_545593fd-42e6-15c1-1e96-18e0e0be0443, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_InRegion(_Var1, S_DEN_VictorySceneArea_a0b30a20-2514-4238-b220-fdf45c6a4f19, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_DEN_BackupLeader_b304e07d-019c-4ec6-b5ea-c4ccb29ed892
AND NOT
DB_DialogNPCs(_, _Var2, _, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_AttackOnDen_VictoryScene", _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_VictoryDialogs(_Var2, _Var5, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var5, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DB_DialogName(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_VictoryDialogs(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_VictorySpeech_8d24f0ca-a22d-f4fa-5bc5-931dd02bfb56, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk_IgnoreStatuses(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_DEN_IsInDen(_Var4, 1, S_DEN_DruidVault_SUB_f4c22466-5963-4192-b939-f1056f4f806a, S_DEN_Tunnel_SUB_6d2ed20e-f315-463a-9783-d02b173cb35a, _Var1)
THEN
PROC_DialogAddListeningActor(_Var2, _Var4);

IF
DialogStarted((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_AttackOnDen_VictoryDialogs(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_VictorySpeech_8d24f0ca-a22d-f4fa-5bc5-931dd02bfb56, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var4, _, _, _Var1, _Var1)
AND NOT
DB_Defeated(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CurrentDefenderLeader(_Var7, _Var1, _Var1, _Var1, _Var1)
AND
_Var4 != _Var7
THEN
PROC_ForceStopDialog(_Var4);
SetEntityEvent(_Var4, "DEN_AttackOnDen_TeleportToVictoryPos");

IF
DialogStarted((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_AttackOnDen_VictoryDialogs(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_VictorySpeech_8d24f0ca-a22d-f4fa-5bc5-931dd02bfb56, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_Event_VictorySpeech_8d24f0ca-a22d-f4fa-5bc5-931dd02bfb56, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
RelationChanged(ACT1_DEN_AttackOnDen_NPC_08f28bce-a261-35e2-9914-6aa8b3eea155, Hero_a1542c81-6895-929e-4522-10ce218bb360, (INTEGER)_Var1, 1, (INTEGER)_Var1)
AND
_Var1 < 50
THEN
SetFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_StateSet_PermaDefeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_NPC(_Var1, _, _, _Var1, _Var1)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDenVictory", _Var1, _Var1)
AND
DB_Players(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var1, _Var4, 1, _Var1, _Var1)
AND
QRY_OnlyOnce("DEN_AttackOnDen_BetrayTieflingsAfterVictory", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_BetrayTieflings();
SetFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackOnDen_NPC_08f28bce-a261-35e2-9914-6aa8b3eea155, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0);

PROC
PROC_DEN_AttackOnDen_Start()
AND NOT
DB_PermaDefeated(S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, _, _, _, _)
THEN
PROC_TriggerRegisterForPlayers(S_DEN_SafetyIntroArea_0a8547e8-e0b2-4c46-abdd-a0a2f1a5faf8);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_ChefAndSonTalked_1877570b-a0f3-4d65-bbba-7db56293242a, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(DEN_AttackOnDen_ChefAndSon_133f2381-a171-71f8-859d-9b9660d6e69b, S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_ChefAndSonTalked_1877570b-a0f3-4d65-bbba-7db56293242a, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(DEN_AttackOnDen_ChefAndSon_133f2381-a171-71f8-859d-9b9660d6e69b, S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, _Var1);

IF
DialogStarted(DEN_AttackOnDen_ChefAndSon_133f2381-a171-71f8-859d-9b9660d6e69b, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_SafetyIntroArea_0a8547e8-e0b2-4c46-abdd-a0a2f1a5faf8);
SetFlag(DEN_AttackOnDen_Event_ChefAndSonTalked_1877570b-a0f3-4d65-bbba-7db56293242a, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_InRegion(_Var1, S_DEN_SafetyIntroArea_0a8547e8-e0b2-4c46-abdd-a0a2f1a5faf8, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_UnderAttack_4ebba932-b9cf-41c5-b897-e77a63b93511, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_ChefAndSonTalked_1877570b-a0f3-4d65-bbba-7db56293242a, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_AttackOnDen_ChefAndSon_133f2381-a171-71f8-859d-9b9660d6e69b, S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17, S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DialogEnded(DEN_AttackOnDen_ChefAndSon_133f2381-a171-71f8-859d-9b9660d6e69b, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_TryStartAD(DEN_AttackOnDen_AD_ChefAndSon_314aadc8-7c5a-aa74-a2df-bd3c99613eef, S_DEN_Tiefling_FoodTrader_001_1b35671b-e5d7-4943-bbd0-4c816b69b7cb, S_DEN_Tiefling_008_03b6fae4-d250-4ce9-9a01-19cb427deb17);

QRY
QRY_SelectCustomDialog_AfterGenerics((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _Var1, _Var1)
AND
DB_GLO_Prodigy_NPCs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(DEN_AttackOnDen_ProdigyTrio_d43f9a4f-c19d-cb84-54cd-1193b76b9de7, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d, S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b, _Var2);

IF
DialogActorLeft(DEN_AttackOnDen_GrieflingFriend_ab984a7f-9474-e39d-714a-eb63c948173a, _, S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_Event_GrieflingFriendFights_e614acaf-3696-4ec4-903b-178d11076148, _, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_MoveAfterRaidStarted(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, S_DEN_SafetyPos_003_bf03ff45-ba26-46d0-b8f6-9a69ebd079da);
SetCombatGroupID(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, "");
SetFaction(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, ACT1_DEN_AttackOnDen_Cave_be9ef27b-18d4-4168-a798-5c6b744e0c08);
PROC_CharacterMoveTo(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, S_DEN_AttackFriendCavePos_003_67a8fa52-c949-44a4-aa1b-0bb17170c102, "Run", "");
NOT DB_DEN_AttackOnDen_FleeingTieflings(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);

PROC
PROC_DEN_AttackOnDen_Start()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _, _, _, _Var1)
THEN
DB_Sound_ScriptedCombatMusic(_Var1, "DEN_AttackOnDen");

PROC
PROC_DEN_AttackOnDen_Start()
THEN
PROC_DEN_AttackOnDen_SetupOver();

PROC
PROC_DEN_AttackOnDen_SetupOver()
THEN
DB_NOOP(1);

IF
DB_DEN_AttackOnDen_DruidEncounter(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "DEN_AttackOnDen_DruidFight");

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_AttackOnDen_DruidFight", _, _, _, _)
THEN
SetFlag(DEN_AttackOnDen_State_DruidsAreDefeated_3c6d8a2c-dd85-48d1-b48d-f0c6d37959e4, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_AttackOnDen_DruidFight", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND
DB_DEN_AttackOnDen_DruidRaiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, _Var1, 0);

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_AttackOnDen_DruidFight", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, _, _, _, _)
THEN
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, 0);
PROC_CharacterMoveTo(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, S_DEN_CaveHoldArea2_4d34380b-ef29-4d6e-9cf8-72aa39851a05, "Run", "");

PROC
PROC_DEN_AttackOnDen_DruidsLastStand()
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_DruidsAreDefeated_3c6d8a2c-dd85-48d1-b48d-f0c6d37959e4, _, _, _, _)
AND
DB_DEN_AttackOnDen_DruidEncounter(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_NPC(_Var1, "Lair", _, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, _Var2, "Run", "DEN_AttackOnDen_DruidAtCombatPos");

IF
EntityEvent((CHARACTER)_Var1, "DEN_AttackOnDen_DruidAtCombatPos", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_DruidEncounter(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
LookFromTrigger(_Var1, _Var2, 0);

PROC
PROC_StateSet_PermaDefeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_DruidEncounter(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_DruidEncounter(_Var1, _Var2);

IF
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _, _)
AND
IsInTrigger(S_DEN_SilvanusIdol_a841d36c-9a00-4a26-943e-c0af6895bb16, S_DEN_PondOwnership_aff112d5-b79e-405e-9114-6b70aea65a06, 1, _, _)
THEN
NOT DB_DEN_DruidAttack_CurrentIdolTrigger(S_DEN_PondOwnership_aff112d5-b79e-405e-9114-6b70aea65a06);
DB_DEN_DruidAttack_CurrentIdolTrigger(S_DEN_DruidEntrance_Ownership_137c1348-fafd-44cf-924e-eb4df6de9bb6);
TeleportTo(S_DEN_SilvanusIdol_a841d36c-9a00-4a26-943e-c0af6895bb16, S_DEN_AttackOnDen_IdolPoint_0d2b6b1c-05e7-47dc-ac92-a6a7cfe7090a);

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDenVictory", _, _)
THEN
NOT DB_LeaveCamp_ForbiddenReturnArea("WLD_Main_A", S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, S_DEN_WaypointPos_cdd91969-67d0-454e-b27b-cf34e542956b);
NOT DB_LeaveCamp_ForbiddenReturnArea("WLD_Main_A", S_DEN_DruidVault_SUB_f4c22466-5963-4192-b939-f1056f4f806a, S_DEN_WaypointPos_cdd91969-67d0-454e-b27b-cf34e542956b);

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RaiderVictory", _, _)
THEN
NOT DB_LeaveCamp_ForbiddenReturnArea("WLD_Main_A", S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, S_DEN_WaypointPos_cdd91969-67d0-454e-b27b-cf34e542956b);
NOT DB_LeaveCamp_ForbiddenReturnArea("WLD_Main_A", S_DEN_DruidVault_SUB_f4c22466-5963-4192-b939-f1056f4f806a, S_DEN_WaypointPos_cdd91969-67d0-454e-b27b-cf34e542956b);

IF
TextEvent("attackondenraidervictory", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_DebugRaiderVictory();

PROC
PROC_DEN_AttackOnDen_DebugRaiderVictory()
THEN
SetFaction(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5);
SetCombatGroupID(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "");

PROC
PROC_DEN_AttackOnDen_DebugRaiderVictory()
AND
DB_DEN_NPC(_Var1, _, _, _Var1, _Var1)
THEN
Die(_Var1, 0, 1);

PROC
PROC_DEN_AttackOnDen_DebugRaiderVictory()
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var1);
SetFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_AttackOnDen_State_RaiderVictory_abe1bce8-c234-4afe-a490-76210d98a078, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100);
PROC_SetRelationMutual(ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100);

PROC
PROC_DEN_AttackOnDen_DebugRaiderVictory()
AND
DB_DEN_AttackOnDen_RaiderVictoryPositions(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_RaiderVictoryPositions(_Var1, _Var2);
SetOnStage(_Var1, 1);
SetCombatGroupID(_Var1, "");
SetCanJoinCombat(_Var1, 1);
TeleportTo(_Var1, _Var2, "");
SetEntityEvent(_Var1, "GOB_DrowCommander_LeftGoblinCamp");
SetFlag(DEN_AttackOnDen_State_Victorious_ebe2c997-93ae-93f2-7f11-34057122b19b, _Var1);
SetEntityEvent(_Var1, "DEN_AttackOnDen_Victory");

IF
TextEvent("attackondenvictory", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_DebugDenVictory();

PROC
PROC_DEN_AttackOnDen_DebugDenVictory()
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_LeaderAttackSpotArea_41be541d-570b-447a-9636-6cbab92bbde2);
PROC_TriggerUnregisterForPlayers(S_DEN_AttackOnDenEntranceArea_b45cb766-c7a2-44c8-bd73-91779cd8ce78);
DB_OnlyOnce("DEN_AttackOnDen_LeaderEvent");
DB_OnlyOnce("DEN_AttackOnDen_EntranceEvent");

PROC
PROC_DEN_AttackOnDen_DebugDenVictory()
THEN
SetFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, NULL_00000000-0000-0000-0000-000000000000, 0);
TeleportTo(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, S_DEN_RaidersAppearPos_002_06ec17f6-b313-49a1-a91d-be76de132da2, "");
Die(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0, 1);

PROC
PROC_DEN_AttackOnDen_DebugDenVictory()
AND
DB_DEN_AttackOnDen_Raiders(_Var1, _Var2, _, _, _Var1)
THEN
SetOnStage(_Var1, 1);
TeleportTo(_Var1, _Var2, "");
Die(_Var1, 0, 1);

IF
TextEvent("fullattackonden", _, _, _, _)
THEN
ClearFlag(DEN_Prodigy_State_Leaving_5f02e553-2798-7837-0a7c-6996c6352bbc, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(DEN_Prodigy_State_Staying_479db0b1-cc1b-78bf-3e7b-9840747fbd4f, NULL_00000000-0000-0000-0000-000000000000, 0);
SetOnStage(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 1);
SetOnStage(S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d, 1);
SetOnStage(S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b, 1);
PROC_GOB_WolfPens_HalsinForceBreakoutAndLeaving();

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_FrightenedADs(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_FrightenedADs(_Var1, _Var3);
PROC_TryStartAD(_Var3, _Var1);

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_GateCombatADs(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_GateCombatADs(_Var1, _Var2);
PROC_TryStartAD(_Var2, _Var1);

IF
FlagSet(DEN_AttackOnDen_State_HostileTieflings_c5641caa-4409-4739-a1fe-8263b8271f4e, _, _, _, _)
AND
DB_Is_InCombat(_Var3, _, _, _, _)
AND
DB_DEN_CurrentDefenderLeader(_Var3, _, _, _, _)
AND
DB_DEN_AttackOnDen_GateCombatADs(_Var3, _Var5, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_GateCombatADs(_Var3, _Var5);
PROC_TryStartAD(_Var5, _Var3);

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_BlockOwned(_Var1, 1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_BlockOwned(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_OnlyOnce("DEN_AttackOnDen_BetrayTieflings", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_CorpseLooting_BlockMakeOwned(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND
DB_GlobalFlag(GLO_AttackOnDen_State_RaidReady_eb361773-da88-dee4-f4c8-a22acae60948, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_CorpseLooting_BlockMakeOwned((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_AttackOnDen_GoblinBarrels(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_CharacterRegisterCrime_Success((GUIDSTRING)_Var1, (STRING)_Var2, (INTEGER)_Var3, (GUIDSTRING)_Var4, (CHARACTER)_Var5, (INTEGER)_Var6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_NPCIsOrWasInDen(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_Raiders(_Var7, _, _, _, _Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var7, _Var1, _Var1, _Var1, _Var1)
THEN
CrimeIgnoreCrime(_Var6, _Var7);

PROC
PROC_CharacterRegisterCrime_Success((GUIDSTRING)_Var1, (STRING)_Var2, (INTEGER)_Var3, (GUIDSTRING)_Var4, (CHARACTER)_Var5, (INTEGER)_Var6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_NPCIsOrWasInDen(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
THEN
CrimeIgnoreCrime(_Var6, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

PROC
PROC_CharacterRegisterCrime_Success((GUIDSTRING)_Var1, (STRING)_Var2, (INTEGER)_Var3, (GUIDSTRING)_Var4, (GUIDSTRING)_Var5, (INTEGER)_Var6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_AttackOnDen_Raiders(_Var5, _, _, _, _Var1)
AND
DB_DEN_NPC(_Var10, _, _, _Var1, _Var1)
THEN
CrimeIgnoreCrime(_Var6, _Var10);

PROC
PROC_CharacterRegisterCrime_Success((GUIDSTRING)_Var1, (STRING)_Var2, (INTEGER)_Var3, (GUIDSTRING)_Var4, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, (INTEGER)_Var5, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_NPC(_Var6, _, _, _Var1, _Var1)
THEN
CrimeIgnoreCrime(_Var5, _Var6);

IF
DB_DEN_AttackOnDen_TieflingDefeatCounters(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_DefeatCounter(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_NPC(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _, _, _Var1, _Var1)
THEN
NOT DB_GLO_DefeatCounter(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, _Var1);
PROC_GLO_DefeatCounter_CheckFinished(_Var1);

IF
FlagSet(Act2_PointOfNoReturnReached_a3155f30-b8f3-4db5-ac21-d3036f4426e3, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
GoalCompleted;


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
