Version 1
SubGoalCombiner SGC_AND

INITSECTION
SetOnStage(S_ORI_Gale_TressymItem_39fed5b1-1f0b-40d4-96bb-14bd45901c97, 0);
DB_GiveItemToEventWithClear(S_ORI_Gale_TressymItem_39fed5b1-1f0b-40d4-96bb-14bd45901c97, ORI_Gale_Event_GiveTressymItem_cbc2a5b6-cc9d-4c9b-9e71-5f740e37bb8a);
DB_TadpolePowers_UnlockedByDefault(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);
DB_GLO_CharacterCorpseDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, Gale_Dead_0d778ae3-1eae-a1db-1902-951d3be7b619);
DB_ORI_Gale_GoalFlag(1, 1, ORI_Gale_State_WillingForCrown_3d441746-263e-4e4d-b904-a00f5cc70265);
DB_ORI_Gale_GoalFlag(1, 6, ORI_Gale_State_EagerForCrown_e3b1b1af-9952-428b-a7df-8370656d3f35);
DB_ORI_Gale_GoalFlag(1, 3, ORI_Gale_State_SwayedTowardsCrown_76150a10-511d-4eeb-b263-46994bab0b48);
DB_ORI_Gale_GoalFlag(0, 6, ORI_Gale_State_EagerToDie_99da124a-3995-4fd5-90c5-47a89d7e277e);
DB_ORI_Gale_GoalFlag(0, 3, ORI_Gale_State_ReadyToDie_53a7fbbd-7920-4e7f-894f-bcdb46f6221a);
DB_ORI_Gale_GoalFlag(0, 1, ORI_Gale_State_WillingToDie_3f22f471-60e6-11df-1c95-19f756f81994);
DB_ORI_Gale_ChangeGoal(0, 1, ORI_Gale_Event_PushTowardsDeath_34bfb6e7-f557-4d3f-835f-2f42b5791c0d, ORI_Gale_State_PushedTowardsDeath_a693b8d5-5ac6-4982-8bd3-851c7f212423);
DB_ORI_Gale_ChangeGoal(1, 1, ORI_Gale_Event_PushTowardsCrown_96fad101-7c29-495c-91d3-3645b30c2bab, ORI_Gale_State_PushedTowardsCrown_83843c4f-6c61-4f0f-8ace-b2c17066bb04);
DB_ORI_Gale_ChangeGoal(1, -1, ORI_Gale_Event_PushAwayFromCrown_303eeb6d-22cb-4832-a186-f366a4a6eacc, ORI_Gale_State_PushedAwayFromCrown_b0870966-4fb1-442e-88ae-c39881bb1fe0);
DB_ORI_Gale_ChangeGoal(0, -1, ORI_Gale_Event_PushAwayFromDeath_98241d31-012b-4b01-a153-aad9c02e3c32, ORI_Gale_State_PushedAwayFromDeath_f62aa105-4816-4589-b716-f44b85226e75);
DB_OriginMayLeaveDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574);
DB_ORI_Gale_IncubusUnderwear(Underwear_Incubus_5fa043bf-0445-49ad-9e82-0df77c639fe2);
DB_ORI_Gale_IncubusUnderwear(Underwear_Incubus_B_82c84433-0464-442a-8e5a-0891d829f99a);
DB_ExclamationDialog_NeverStop(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_Act2End_05706143-82c3-616d-6850-9281f08c9b9f);
DB_ExclamationDialog_NeverStop(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_AskMagicItemApproval_f05f6be6-967f-6612-988f-636150f94b5a);
DB_ExclamationDialog_NeverStop(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_NeedMagicItem1_c1899c40-e4c4-72d6-4360-444cea41e72f);
DB_ExclamationDialog_NeverStop(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_NeedMagicItem2_170a6564-a01e-f145-6958-bf84312d0e03);
DB_ExclamationDialog_NeverStop(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_NeedMagicItem3_b2db2afd-74a2-b432-df34-6073d7c78b62);
DB_ExclamationDialog_NeverStop(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_NeedMagicReminder_3834abc3-f70e-7bbf-b286-32b795cfc3c4);
DB_ORI_Gale_IPRDOverFlag(ORI_Gale_IPRD_AskMagicItemApproval_f05f6be6-967f-6612-988f-636150f94b5a, ORI_Gale_Knows_NeedsMagicItems_d3827f86-fc4f-411d-9623-9ae5d35d6735);
DB_TopicalGreeting(TG_ORI_Gale_ConsumedItem_d891c321-8124-a88d-0a88-fad59e3d2ce8);
DB_TopicalGreeting(TG_ORI_Gale_ElminsterVisit_702a96d6-192a-00b6-5e9b-bd5bd46bd7c8);
DB_TopicalGreeting(TG_ORI_GaleResurrected_6b24c954-9738-4c47-8995-5a701cb25378);
DB_TopicalGreetingEndCondition_FlagSet(TG_ORI_Gale_ConsumedItem_d891c321-8124-a88d-0a88-fad59e3d2ce8, ORI_Gale_Event_CoveredConsumedItemTG_c1044864-2596-4da2-9eab-a353e31011d0);
DB_TopicalGreetingEndCondition_FlagSet(TG_ORI_Gale_ElminsterVisit_702a96d6-192a-00b6-5e9b-bd5bd46bd7c8, ORI_Gale_Knows_Avatar_ReactedElminster_7ff035bf-0a38-34bb-f949-0bf2808094e1);
DB_ORI_Gale_Companion_AteMagicItemIPRDs(ORI_Gale_State_GotOneMagicItem_6fec5439-a66e-4aff-b62b-69f88648c34d, ORI_Gale_IPRD_Ate1Item_3ec52828-6eb2-e2cd-6a2a-f5b7d1b443e3);
DB_ORI_Gale_Companion_AteMagicItemIPRDs(ORI_Gale_State_GotTwoMagicItems_c757086e-4696-441d-b19c-fdb65982776f, ORI_Gale_IPRD_Ate2Items_359f4afc-378f-83f0-3602-21f1ec6511a0);
DB_ORI_Gale_Companion_AteMagicItemIPRDs(ORI_Gale_State_GotThreeMagicItems_484d97f2-5c79-a557-0635-fbf81e8c0307, ORI_Gale_IPRD_Ate3Items_a8e84a1d-7cfe-574a-b92d-34c58a02ba8b);
DB_ORI_Gale_Companion_AteMagicItemIPRDs_CancelFlag(ORI_Gale_IPRD_Ate1Item_3ec52828-6eb2-e2cd-6a2a-f5b7d1b443e3, ORI_Gale_Event_ThankedForItem1_06b9cd61-8d37-721d-784e-b5f2a4cf0cb2);
DB_ORI_Gale_Companion_AteMagicItemIPRDs_CancelFlag(ORI_Gale_IPRD_Ate2Items_359f4afc-378f-83f0-3602-21f1ec6511a0, ORI_Gale_Event_ThankedForItem2_2c6edb9b-ce0e-359b-abcc-412520192560);
DB_ORI_Gale_Companion_AteMagicItemIPRDs_CancelFlag(ORI_Gale_IPRD_Ate3Items_a8e84a1d-7cfe-574a-b92d-34c58a02ba8b, ORI_Gale_Knows_LearnedBackstory_0a9731cf-4769-249f-818d-b4c6e542083d);
SetFlag(ORI_Gale_State_NotDating_21f19438-754d-4ad2-883e-fd3f8814b917, NULL_00000000-0000-0000-0000-000000000000, 0);
DB_QuestDef_State(ORI_Gale_State_EnoughRegionsToAskMagicItem1_a1faa546-4525-437e-a528-a4ccfd541a93, "ORI_Avatar_Gale", "NeedItem1");
DB_QuestDef_State(ORI_Gale_State_EnoughRegionsToAskMagicItem2_fd8f43cd-a2c1-4211-8978-de2db47fafe8, "ORI_Avatar_Gale", "NeedItem2");
DB_QuestDef_State(ORI_Gale_State_EnoughRegionsToAskMagicItem3_40cd9192-878b-480f-9a41-9f69c61f2bd9, "ORI_Avatar_Gale", "NeedItem3");
DB_QuestDef_State(ORI_Gale_State_GotOneMagicItem_6fec5439-a66e-4aff-b62b-69f88648c34d, "ORI_Avatar_Gale", "GotItem1");
DB_QuestDef_State(ORI_Gale_State_GotTwoMagicItems_c757086e-4696-441d-b19c-fdb65982776f, "ORI_Avatar_Gale", "GotItem2");
DB_QuestDef_State(ORI_Gale_State_GotThreeMagicItems_484d97f2-5c79-a557-0635-fbf81e8c0307, "ORI_Avatar_Gale", "GotItem3");
DB_QuestDef_State(ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c, "ORI_Avatar_Gale", "ElminsterBrief");
DB_QuestDef_State(ORI_Gale_Knows_ReadKarsusNotes_2b0e541f-f49e-7e82-27d6-15fccd6ff1ff, "ORI_Avatar_Gale", "ReadNotes");
DB_QuestDef_State(ORI_Gale_Quest_MystraRequest_3b3e7fbc-08c5-4b03-bace-40250a99ce7b, "ORI_Avatar_Gale", "MystraRequest");
DB_QuestDef_State(ORI_Gale_Knows_KarsiteWeave_22350fca-200a-bbf7-90ad-8d15168641f9, "ORI_Avatar_Gale", "KarsiteWeave");
DB_QuestDef_State(ORI_Gale_State_Met_ElminsterInWYR_82b0cbde-1d3b-1f67-86a8-d05744462209, "ORI_Avatar_Gale", "MeetElminsterCTY");
DB_QuestDef_State(ORI_Gale_Quest_NoTolna_c105de73-0701-4289-95f4-f6c79cb85ba3, "ORI_Avatar_Gale", "NoTolna");
DB_QuestDef_State(ORI_Gale_Quest_FindBook2_Accidental_20ddb12d-1ae4-46cd-80ad-363416d60d10, "ORI_Avatar_Gale", "FindBook2_Accidental");
DB_QuestDef_State(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, "ORI_Avatar_Gale", "FoundBook");
DB_QuestDef_State(ORI_Gale_Quest_FindBook2_6202429c-e813-43bb-a431-040cc6214069, "ORI_Avatar_Gale", "FindBook2");
DB_QuestDef_State(LOW_SorcerousSundries_State_GotVaultHint_e912c718-92e7-27bd-fd24-848e9d43f5dc, "ORI_Avatar_Gale", "TolnaDirectedOffice");
DB_QuestDef_State(ORI_Gale_Quest_TolnaRefusedVault_bfa16247-9659-6d16-a999-06667134b492, "ORI_Avatar_Gale", "TolnaRefusedVault");
DB_QuestDef_State(ORI_Gale_State_OpenedPouch_a533861d-a4f9-482a-8be2-7c9523df9c90, "ORI_Avatar_Gale", "OpenedPouch");
DB_QuestDef_State(ORI_Gale_DeathNote_State_Open_6e3af093-fce9-fcb1-87ec-bd6c45788ac5, "ORI_Avatar_Gale", "GotScroll");
DB_QuestDef_State(ORI_Gale_State_DestroyedPouch_5b7b8189-7b89-4cf5-a4a1-a80cc992a654, "ORI_Avatar_Gale", "DestroyedPouch");
DB_QuestDef_State(LOW_SorcerousSundries_State_TolnaWarnedBooksNotForSaleOnce_6c76ca24-9373-f3ec-0621-801a4b2d70a6, "ORI_Avatar_Gale", "TolnaMentionedVault");
DB_ORI_Gale_MystraUpdate(ORI_Gale_Quest_PromiseMystra_f8fbe426-fa11-4bf8-b4c1-913f4a82d371, "PromiseMystra", "ContractAfterPromisedMystra");
DB_ORI_Gale_MystraUpdate(ORI_Gale_Quest_RefusedMystra_6e414e31-5d35-4416-8ac2-786e6451ee4e, "RefusedMystra", "ContractAfterRefusedMystra");
DB_ORI_Gale_MystraUpdate(ORI_Gale_Quest_DelayedMystra_d749277f-942b-43b5-baa7-74fc4cdc9930, "DelayedMystra", "ContractAfterDelayedMystra");
DB_QuestDef_State(LOW_SorcerousSundries_State_GotVaultHint_e912c718-92e7-27bd-fd24-848e9d43f5dc, "ORI_COM_Gale", "TolnaDirectedOffice");
DB_QuestDef_State(ORI_Gale_Quest_TolnaRefusedVault_bfa16247-9659-6d16-a999-06667134b492, "ORI_COM_Gale", "TolnaRefusedVault");
DB_QuestDef_State(ORI_Gale_Quest_FindBook_Tolna_bac7b8d2-22ca-d22e-715f-1d8b52b001a9, "ORI_COM_Gale", "FindBook_Tolna");
DB_QuestDef_State(LOW_SorcerousSundries_State_TolnaWarnedBooksNotForSaleOnce_6c76ca24-9373-f3ec-0621-801a4b2d70a6, "ORI_COM_Gale", "TolnaMentionedVault");
DB_ORI_Gale_SearchVaultFlag(ORI_Gale_Quest_FindBook2_Accidental_20ddb12d-1ae4-46cd-80ad-363416d60d10);
DB_ORI_Gale_SearchVaultFlag(ORI_Gale_Quest_TeleportedVault_eeef2800-2e55-4e3b-b816-35fa583a9ca3);
DB_QuestDef_State_CompanionLeft(REALLY_GALE_9b0354c0-56d9-4723-8034-918ac9abab19, "ORI_COM_Gale", "ORI_Gale_AbandonedBombNotDisarmed");
DB_QuestDef_State_CompanionLeft(REALLY_GALE_9b0354c0-56d9-4723-8034-918ac9abab19, "ORI_COM_Gale", "ORI_Gale_BombNotDisarmed");

KBSECTION
IF
TextEvent("gale_ignoregoalscore", _, _, _, _)
AND NOT
DB_DEBUG_Gale_IgnoreGoalScore(1, _, _, _, _)
THEN
DB_DEBUG_Gale_IgnoreGoalScore(1);
PROC_DEBUG_Gale_ClearGoalFlags();

PROC
PROC_DEBUG_Gale_ClearGoalFlags()
AND
DB_ORI_Gale_GoalFlag(_, _, _Var3, _, _)
THEN
ClearFlag(_Var3);

IF
TextEvent("gale_enablegoalscore", _, _, _, _)
AND
DB_DEBUG_Gale_IgnoreGoalScore(1, _, _, _, _)
THEN
NOT DB_DEBUG_Gale_IgnoreGoalScore(1);

IF
DB_RelationshipDialogsFinished(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var2, _Var1, _Var1)
AND
DB_ORI_Gale_IPRDOverFlag(_Var2, _Var3, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_RelationshipDialogsFinished(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var2);
PROC_RelationshipDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var2, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);

PROC
PROC_CampNight_GaleTressym_ToCamp((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236);
DB_Dialogs(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, CAMP_Gale_Tressym_00706ce9-cbf7-95ee-912d-b42909b483a7);
PROC_ORI_SetupCamp(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, _Var1);
SetStoryDisplayName(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, "Gale_Tressym_Name");

IF
FlagSet(ORI_Gale_Event_GiveTressymItem_cbc2a5b6-cc9d-4c9b-9e71-5f740e37bb8a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetOnStage(S_ORI_Gale_TressymItem_39fed5b1-1f0b-40d4-96bb-14bd45901c97, 1);

QRY
QRY_ORI_Gale_NeedsMoreMagicItems()
AND NOT
DB_GlobalFlag(ORI_Gale_State_GotThreeMagicItems_484d97f2-5c79-a557-0635-fbf81e8c0307, _, _, _, _)
THEN
DB_NOOP(1);

IF
FlagSet(ORI_Gale_State_GotOneMagicItem_6fec5439-a66e-4aff-b62b-69f88648c34d, _, _, _, _)
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
SetFlag(TG_ORI_Gale_ConsumedItem_d891c321-8124-a88d-0a88-fad59e3d2ce8, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);

IF
FlagSet(ORI_Gale_State_GotOneMagicItem_6fec5439-a66e-4aff-b62b-69f88648c34d, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND
DB_Avatars(_Var3, _, _, _, _)
THEN
SetFlag(TG_ORI_Gale_ConsumedItem_d891c321-8124-a88d-0a88-fad59e3d2ce8, _Var3, 0);

IF
FlagSet(ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c, _, _, _, _)
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
SetFlag(TG_ORI_Gale_ConsumedItem_d891c321-8124-a88d-0a88-fad59e3d2ce8, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);

IF
FlagSet(ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND
DB_Avatars(_Var3, _, _, _, _)
THEN
SetFlag(TG_ORI_Gale_ElminsterVisit_702a96d6-192a-00b6-5e9b-bd5bd46bd7c8, _Var3, 0);

IF
Resurrected(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND
DB_GlobalFlag(Gale_DeathVoice_KnowProtocol_d40c7790-7dd7-6e76-df72-81d8e7cdcf23, _, _, _, _)
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
SetFlag(TG_ORI_GaleResurrected_6b24c954-9738-4c47-8995-5a701cb25378, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);

IF
FlagSet(ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
AddSpell(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, "Shout_END_Gale_ActivateNethereseOrb", 1, 0);
SetTag(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, ORI_GALE_BOMBDISARMED_f37724b5-9235-4ab2-8d65-78efcf50f95b);
PROC_ORI_Gale_DisableDeathEffect();

IF
CastedSpell(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, "Shout_END_Gale_ActivateNethereseOrb", _, _, _)
AND NOT
QRY_ORI_Gale_InterruptOrbGameOver()
THEN
SetFlag(ORI_Gale_Event_CommittedSuicide_78354925-1f86-8675-5bd0-11dbf09193a1, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_ORI_Gale_Explosion();

QRY
QRY_ORI_Gale_InterruptOrbGameOver()
AND
1 == 0
THEN
DB_NOOP(1);

IF
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
SetFlag(ORI_Gale_State_IsAvatar_578ee9d2-a8eb-b44f-c39a-7a16a82dd023, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_GlobalFlag(ORI_Gale_State_IsAvatar_578ee9d2-a8eb-b44f-c39a-7a16a82dd023, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
ClearFlag(ORI_Gale_State_IsAvatar_578ee9d2-a8eb-b44f-c39a-7a16a82dd023, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
KilledBy(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, (GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1)
AND
QRY_ORI_Gale_TaraRecognised()
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(ORI_Gale_State_TaraKiller_08844f2a-aab5-4d93-b810-e952d24d76b7, _Var1, 0);

QRY
QRY_ORI_Gale_TaraRecognised()
AND
DB_Is_InCombat(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ORI_Gale_ReactTaraDeath();

QRY
QRY_ORI_Gale_TaraRecognised()
AND
CanSee(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1, _, _)
THEN
PROC_ORI_Gale_ReactTaraDeath();

PROC
PROC_ORI_Gale_ReactTaraDeath()
AND NOT
DB_OnlyOnce("ORI_Gale_ReactTaraDeath", _, _, _, _)
AND
QRY_StartDialog_Fixed(ORI_Gale_TaraKilled_AD_2b71a795-464a-d564-23eb-47b6f1a8b44b, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _)
THEN
DB_NOOP(1);

IF
DB_PartOfTheTeam(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND NOT
DB_ORI_Gale_GoalScore(_, _, _, _, _)
THEN
DB_ORI_Gale_GoalScore(0, 0);
DB_ORI_Gale_GoalScore(1, 3);

IF
DB_ORI_Gale_ChangeGoal(_Var1, 1, _Var2, _, _Var1)
AND
DB_Negate(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
DB_ORI_Gale_ChangeGoal(_Var4, -1, _Var2, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_DEBUG_Gale_IgnoreGoalScore(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Gale_ChangeGoal(_Var4, _Var5, _Var1, _, _Var1)
AND
DB_ORI_Gale_GoalScore(_Var4, _Var7, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var7, _Var5, _Var8, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_GoalScore(_Var4, _Var7);
DB_ORI_Gale_GoalScore(_Var4, _Var8);
ClearFlag(_Var1, _Var2, 0);

IF
FlagSet((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_DEBUG_Gale_IgnoreGoalScore(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Gale_ChangeGoal(_, _, _Var1, _Var6, _Var1)
AND
_Var6 != NULL_00000000-0000-0000-0000-000000000000
THEN
SetFlag(_Var6, _Var2, 0);

IF
DB_ORI_Gale_GoalScore(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_DEBUG_Gale_IgnoreGoalScore(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Gale_GoalFlag(_Var1, _Var3, _Var4, _Var1, _Var1)
AND
_Var2 >= _Var3
AND NOT
DB_GlobalFlag(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(_Var4);

IF
DB_ORI_Gale_GoalScore(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_DEBUG_Gale_IgnoreGoalScore(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Gale_GoalFlag(_Var1, _Var3, _Var4, _Var1, _Var1)
AND
_Var2 < _Var3
AND
DB_GlobalFlag(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalClearFlagAndCache(_Var4);

PROC
PROC_ORI_Gale_ConsumedMagicItem()
AND
DB_GlobalFlag(ORI_Gale_State_GotTwoMagicItems_c757086e-4696-441d-b19c-fdb65982776f, _, _, _, _)
THEN
SetFlag(ORI_Gale_State_GotThreeMagicItems_484d97f2-5c79-a557-0635-fbf81e8c0307);
SetTag(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, ORI_GALE_BOMBDISARMED_f37724b5-9235-4ab2-8d65-78efcf50f95b);

IF
DB_DialogSpeakers(_Var1, _Var2, _, _Var1, _Var1)
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogSpeakers(_Var1, S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, _, _Var1, _Var1)
AND
QRY_SameUser(_Var2, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ORI_Gale_State_DiscussedTressymEncounter_e1b72019-f2b1-bbeb-8190-20756fb3f55d, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(ORI_Gale_State_MetTressym_d794b24d-b68b-441c-a405-4dded461b1a3, _Var2, 0);
PROC_RelationshipDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_MetTressym_f07a0073-f70e-0ddb-1f64-1701d6369cf8, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);

QRY
QRY_SelectCustomDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HandlingRelationshipDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, ORI_Gale_IPRD_MetTressym_f07a0073-f70e-0ddb-1f64-1701d6369cf8, _, _, _, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SameUser(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(ORI_Gale_State_MetTressym_d794b24d-b68b-441c-a405-4dded461b1a3, _Var1, 0, _Var1, _Var1)
THEN
DB_SelectedDialog(GLO_AD_NonBondedCompanionDialog_62ba7c46-8d22-c591-f04c-2e99441cd02a, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

IF
TagSet((GUIDSTRING)_Var1, ORI_GALE_CONSUMABLEARTEFACT_7b96246c-54ba-43ea-b01d-4e0b20ad35f1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_ORI_Gale_UninterestedInMagicItems()
THEN
DB_ORI_Gale_Consumables(_Var1);

IF
TagCleared((GUIDSTRING)_Var1, ORI_GALE_CONSUMABLEARTEFACT_7b96246c-54ba-43ea-b01d-4e0b20ad35f1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_ORI_Gale_Consumables(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_Consumables(_Var1);

QRY
QRY_ORI_Gale_UninterestedInMagicItems()
AND
DB_PermaDefeated(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Gale_UninterestedInMagicItems()
AND
DB_GlobalFlag(ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Gale_UninterestedInMagicItems()
AND
DB_GlobalFlag(ORI_Gale_State_GotThreeMagicItems_484d97f2-5c79-a557-0635-fbf81e8c0307, _, _, _, _)
THEN
DB_NOOP(1);

IF
DB_ORI_Gale_Consumables(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PermaDefeated(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_Consumables(_Var1);

IF
DB_ORI_Gale_Consumables(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_Consumables(_Var1);

IF
DB_ORI_Gale_Consumables(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(ORI_Gale_State_GotThreeMagicItems_484d97f2-5c79-a557-0635-fbf81e8c0307, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_Consumables(_Var1);

IF
DB_ORI_Gale_Consumables(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_ORI_Gale_ConsumableMarkedObject(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
Exists(_Var1, 1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "ORI_GALE_CONSUMABLE", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_ORI_Gale_Consumables(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(ORI_Gale_Knows_NeedsMagicItems_d3827f86-fc4f-411d-9623-9ae5d35d6735, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_ORI_Gale_ConsumableMarkedObject(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
Exists(_Var1, 1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "ORI_GALE_CONSUMABLE", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
LevelLoaded(_, _, _, _, _)
AND
DB_ORI_Gale_Consumables(_Var2, _, _, _, _)
AND
QRY_ORI_Gale_PlayersKnowWantsMagicItem()
AND NOT
DB_ORI_Gale_ConsumableMarkedObject(_Var2, _, _, _, _)
AND
Exists(_Var2, 1, _, _, _)
THEN
ApplyStatus(_Var2, "ORI_GALE_CONSUMABLE", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
StatusApplied((GUIDSTRING)_Var1, "ORI_GALE_CONSUMABLE", _, _, (GUIDSTRING)_Var1)
THEN
DB_ORI_Gale_ConsumableMarkedObject(_Var1);

IF
FlagSet(ORI_Gale_Event_BombDisarmed_3d014e79-5595-9365-87bb-5cbb1f87fe5c, _, _, _, _)
AND
DB_ORI_Gale_ConsumableMarkedObject(_Var3, _, _, _, _)
AND
Exists(_Var3, 1, _, _, _)
THEN
RemoveStatus(_Var3, "ORI_GALE_CONSUMABLE", NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(ORI_Gale_State_GotThreeMagicItems_484d97f2-5c79-a557-0635-fbf81e8c0307, _, _, _, _)
AND
DB_ORI_Gale_ConsumableMarkedObject(_Var3, _, _, _, _)
AND
Exists(_Var3, 1, _, _, _)
THEN
RemoveStatus(_Var3, "ORI_GALE_CONSUMABLE", NULL_00000000-0000-0000-0000-000000000000);

IF
LevelLoaded(_, _, _, _, _)
AND
DB_ORI_Gale_ConsumableMarkedObject(_Var2, _, _, _, _)
AND
QRY_ORI_Gale_UninterestedInMagicItems()
AND
Exists(_Var2, 1, _, _, _)
THEN
RemoveStatus(_Var2, "ORI_GALE_CONSUMABLE", NULL_00000000-0000-0000-0000-000000000000);

IF
StatusRemoved((GUIDSTRING)_Var1, "ORI_GALE_CONSUMABLE", _, _, (GUIDSTRING)_Var1)
THEN
NOT DB_ORI_Gale_ConsumableMarkedObject(_Var1);

QRY
QRY_ORI_Gale_PlayersKnowWantsMagicItem()
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Gale_PlayersKnowWantsMagicItem()
AND
DB_GlobalFlag(ORI_Gale_Knows_NeedsMagicItems_d3827f86-fc4f-411d-9623-9ae5d35d6735, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_DialogFlagSetup(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, _, (CHARACTER)_Var2, _, _)
AND NOT
DB_OnlyOnce("ORI_Gale_Event_WoreIncubusUnderwear", _, _, _, _)
AND
QRY_ORI_Gale_WearingOnlyIncubusUnderwear(_Var2, _, _, _, _)
THEN
SetFlag(ORI_Gale_State_WearingIncubusUnderwear_057df7e4-19ca-e0b1-bc8d-63a8784a4a2c, _Var2, 0);

IF
DialogEnded(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogSpeakers(_Var1, _Var2, 2, _Var1, _Var1)
THEN
ClearFlag(ORI_Gale_State_WearingIncubusUnderwear_057df7e4-19ca-e0b1-bc8d-63a8784a4a2c, _Var2, 0);

QRY
QRY_ORI_Gale_WearingOnlyIncubusUnderwear((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_ORI_Gale_WearingIncubusUnderwear(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_ORI_Gale_UnderwearInvisible(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("ORI_Gale_Event_WoreIncubusUnderwear");

QRY
QRY_ORI_Gale_WearingIncubusUnderwear((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetEquippedItem(_Var1, "Underwear", _Var2, _Var1, _Var1)
AND
GetTemplate(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
DB_ORI_Gale_IncubusUnderwear(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Gale_UnderwearInvisible((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GetArmourSet(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_GetArmourSet(0, _Var1, _Var1, _Var1, _Var1)
AND
GetEquippedItem(_Var1, "Breast", _Var2, _Var1, _Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
DB_NOOP(1);

QRY
QRY_ORI_Gale_UnderwearInvisible((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GetArmourSet(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_GetArmourSet(0, _Var1, _Var1, _Var1, _Var1)
AND
GetEquippedItem(_Var1, "VanityBody", _Var2, _Var1, _Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
DB_NOOP(1);

IF
DialogEnded(CAMP_Gale_Tressym_00706ce9-cbf7-95ee-912d-b42909b483a7, _, _, _, _)
AND
DB_GlobalFlag(CAMP_Gale_Tressym_Event_FlyOff_38725547-4917-b375-f825-4f7a390c78d4, _, _, _, _)
THEN
DB_ORI_Gale_Tara_Disappearing(1);
SetHasDialog(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
CharacterDisableAllCrimes(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236);
PROC_ORI_Gale_Tara_CheckPlayersInCamp();
SetDetached(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
PROC_SetInvulnerable(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
PlayAnimation(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, CUST_FlyAway_01_8c213e7c-ae64-4dab-b254-af09e8e9c0d1, "GLO_Gale_Tressym_Disappeared");
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236);
ClearFlag(CAMP_Gale_Tressym_Event_FlyOff_38725547-4917-b375-f825-4f7a390c78d4);

IF
EntityEvent(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, "GLO_Gale_Tressym_Disappeared", _, _, _)
AND NOT
DB_ORI_Gale_Tara_DisappearingInterrupted(1, _, _, _, _)
THEN
DB_ORI_Gale_Tara_Disappearing(1);
SetOnStage(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
PROC_ORI_Gale_Tara_CheckPlayersInCamp();
DB_ORI_Gale_Tara_Disappeared(1);

IF
EntityEvent(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, "GLO_Gale_Tressym_Disappeared", _, _, _)
AND
DB_ORI_Gale_Tara_DisappearingInterrupted(1, _, _, _, _)
THEN
NOT DB_ORI_Gale_Tara_DisappearingInterrupted(1);
SetDetached(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
PROC_SetInvulnerable(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
SetOnStage(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
PROC_CampNight_GaleTressym_ToCamp(1);

PROC
PROC_ORI_Gale_Tara_CheckPlayersInCamp()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_Gale_Tara_InCampPlayers(_Var1);

IF
DB_ORI_Gale_Tara_InCampPlayers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_Tara_InCampPlayers(_Var1);

IF
DB_ORI_Gale_Tara_InCampPlayers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_InCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_Tara_InCampPlayers(_Var1);

IF
DB_ORI_Gale_Tara_Disappeared(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_Gale_Tara_InCampPlayers(_Var1);

IF
DB_ORI_Gale_Tara_Disappeared(1, _, _, _, _)
AND NOT
DB_ORI_Gale_Tara_InCampPlayers(_, _, _, _, _)
THEN
NOT DB_ORI_Gale_Tara_Disappeared(1);
SetDetached(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
PROC_SetInvulnerable(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
SetOnStage(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
PROC_CampNight_GaleTressym_ToCamp(1);

PROC
PROC_Camp_SetModeToDay()
AND
DB_ORI_Gale_Tara_Disappeared(1, _, _, _, _)
THEN
NOT DB_ORI_Gale_Tara_Disappeared(1);
SetDetached(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
PROC_SetInvulnerable(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
SetOnStage(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
PROC_CampNight_GaleTressym_ToCamp(1);

PROC
PROC_Camp_SetModeToDay()
AND
DB_ORI_Gale_Tara_Disappearing(1, _, _, _, _)
THEN
NOT DB_ORI_Gale_Tara_Disappearing(1);
StopAnimation(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
DB_ORI_Gale_Tara_DisappearingInterrupted(1);

PROC
PROC_Camp_SetModeToNight()
AND
DB_ORI_Gale_Tara_Disappeared(1, _, _, _, _)
THEN
NOT DB_ORI_Gale_Tara_Disappeared(1);
SetDetached(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
PROC_SetInvulnerable(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 0);
SetOnStage(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
PROC_CampNight_GaleTressym_ToCamp(1);

PROC
PROC_Camp_SetModeToNight()
AND
DB_ORI_Gale_Tara_Disappearing(1, _, _, _, _)
THEN
NOT DB_ORI_Gale_Tara_Disappearing(1);
StopAnimation(S_GLO_Gale_Tressym_ada7ee81-829d-48c7-ba73-9c9ec191d236, 1);
DB_ORI_Gale_Tara_DisappearingInterrupted(1);

IF
DB_ORI_Gale_Companion_AteMagicItemIPRDs(_, _Var2, _, _, _)
THEN
DB_ExclamationDialog_NeverStop(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, _Var2);
DB_RelationshipDialog_WRD_TriggerInCamp(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, _Var2);

PROC
PROC_ORI_Gale_ConsumedMagicItem()
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND
QRY_OnlyOnce_Reset("ORI_Gale_AteMagicItemIPRDs", _, _, _, _)
AND
DB_ORI_Gale_Companion_AteMagicItemIPRDs(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetFlag(_Var1, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
AND
QRY_OnlyOnce("ORI_Gale_AteMagicItemIPRDs", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ORI_Gale_QueueAteMagicItemIPRDs(_Var2);
NOT DB_ORI_Gale_Companion_AteMagicItemIPRDs(_Var1, _Var2);

PROC
PROC_ORI_Gale_ConsumedMagicItem()
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND
DB_ORI_Gale_TradingMagicItem(_Var1, _, _Var1, _Var1, _Var1)
AND
ChangeApprovalRating(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, 0, 10, _)
THEN
DB_NOOP(1);

PROC
PROC_ORI_Gale_ConsumedMagicItem()
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND NOT
DB_ORI_Gale_TradingMagicItem(_, _, _, _, _)
AND
DB_Avatars(_Var3, _, _, _, _)
AND
QRY_SameUser(_Var3, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _)
AND
ChangeApprovalRating(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var3, 0, 10, _)
THEN
DB_NOOP(1);

PROC
PROC_ORI_Gale_QueueAteMagicItemIPRDs((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND NOT
DB_InteractiveDialogSpeaker(_, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1)
THEN
PROC_RelationshipDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, _Var1, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);
DB_RelationshipDialog_Autostart(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, _Var1);

PROC
PROC_ORI_Gale_QueueAteMagicItemIPRDs((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_InteractiveDialogSpeaker(_Var2, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1)
THEN
DB_ORI_Gale_AteMagicItemIRPD_DelayUntilDialogEnd(_Var1, _Var2);

IF
DialogEnded(_, (INTEGER)_Var2, _, _, _)
AND
DB_ORI_Gale_AteMagicItemIRPD_DelayUntilDialogEnd(_Var3, _Var2, _, _, _)
THEN
PROC_RelationshipDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, _Var3, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_ORI_Gale_Companion_AteMagicItemIPRDs_CancelFlag(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Gale_AteMagicItemIRPD_DelayUntilDialogEnd(_Var5, _Var6, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Gale_AteMagicItemIRPD_DelayUntilDialogEnd(_Var5, _Var6);

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_ORI_Gale_Companion_AteMagicItemIPRDs_CancelFlag(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CancelRelationshipDialog(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, _Var4);
NOT DB_ORI_Gale_Companion_AteMagicItemIPRDs_CancelFlag(_Var4, _Var1);

IF
TadpolePowerAssigned(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, (STRING)_, (STRING)_, (STRING)_)
THEN
SetFlag(ORI_Gale_State_HasTadpolePowers_74cb9768-43ce-41f6-b4a4-829dbf996fe5, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
QuestUpdate(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, "ORI_Avatar_Gale", "Start");

PROC
PROC_ORI_Gale_Explosion()
AND NOT
QRY_Gale_PreventGameOver()
AND
QRY_Gale_BuildGaleExplosionSpeakerList()
AND NOT
DB_ORI_Gale_Teleporting(1, _, _, _, _)
AND
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(2, _Var2, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(3, _Var3, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(4, _Var4, _Var1, _Var1, _Var1)
AND
QRY_ORI_Gale_Explosion_SetDialogDeath(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialogCustom(Gale_Explosion_120fa809-81a9-79da-1d2b-4acf31ec602e, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var2, _Var3, _Var4, 0, 0, 0, 0)
THEN
ShowGameOverMenu();

QRY
QRY_ORI_Gale_Explosion_SetDialogDeath((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_DialogDeath(_Var1);
DB_DialogDeath(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

QRY
QRY_Gale_PreventGameOver()
AND
1 == 0
THEN
DB_NOOP(1);

IF
DialogEnded(Gale_Explosion_120fa809-81a9-79da-1d2b-4acf31ec602e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
ShowGameOverMenu();

QRY
QRY_Gale_BuildGaleExplosionSpeakerList()
AND
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_Var1, _Var2);

QRY
QRY_Gale_BuildGaleExplosionSpeakerList()
AND
DB_CurrentLevel(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetRegion(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 != _Var1
THEN
PROC_GlobalSetFlagAndCache(ORI_Gale_State_OtherLevel_25036f69-3877-c0a8-d7e9-bb837a119fbc);

QRY
QRY_Gale_BuildGaleExplosionSpeakerList()
AND
QRY_DoNTimes(4, _, _, _, _)
AND
DB_QRY_RTN_DoNTimes(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_Gale_BuildGaleExplosionSpeaker(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_Var1, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_, _Var2, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_State_OtherLevel_25036f69-3877-c0a8-d7e9-bb837a119fbc, _, _, _, _)
AND
DB_CurrentLevel(_Var3, _, _, _, _)
AND
GetRegion(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var4, _, _, _)
AND
_Var4 != _Var3
AND NOT
DB_ORI_Gale_Teleporting(1, _, _, _, _)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
DB_ORI_Gale_Teleporting(1);
SetOnStage(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 0);
TeleportTo(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var2, "ORI_Gale_PostDeathTeleport");

QRY
QRY_Gale_BuildGaleExplosionSpeakerList()
AND NOT
DB_GlobalFlag(ORI_Gale_State_OtherLevel_25036f69-3877-c0a8-d7e9-bb837a119fbc, _, _, _, _)
AND
DB_MiniCampTrigger("WLDUND", _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, 1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(ORI_Gale_State_UNDDeath_6198e28a-643f-0783-876e-49a7cb84c746);

QRY
QRY_Gale_BuildGaleExplosionSpeaker(1, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_State_OtherLevel_25036f69-3877-c0a8-d7e9-bb837a119fbc, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
AND NOT
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var1, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1)
AND NOT
QRY_ORI_Gale_GaleExplosionSpeakerUnavailable(1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(ORI_Gale_State_PlayerAvailableForDeath_56175253-c303-c80d-f00c-c41acc6d790b, _Var1, 0);
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(1, _Var1);

QRY
QRY_Gale_BuildGaleExplosionSpeaker((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
AND NOT
QRY_ORI_Gale_GaleExplosionSpeakerUnavailable(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var2);
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_Var1, _Var2);

QRY
QRY_ORI_Gale_GaleExplosionSpeakerUnavailable((INTEGER)_Var1, (CHARACTER)_Var2, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Gale_GaleExplosionSpeakerUnavailable((INTEGER)_Var1, (CHARACTER)_Var2, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_QRYRTN_Gale_BuildGaleExplosionSpeakerList(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EnteredLevel(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, (STRING)_Var2, (ROOT)_, (ROOT)_)
THEN
MapMarkerChangeLevel("ORI_Gale_Companion", _Var2);

IF
FlagSet(ORI_State_Dating_a3346d5b-c54b-4c73-bf18-0a2bf90c35da, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(ORI_Gale_State_Dating_6e5dc80a-db14-4659-a790-e81aa6490307, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag(ORI_Gale_State_NotDating_21f19438-754d-4ad2-883e-fd3f8814b917, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagCleared(ORI_State_Dating_a3346d5b-c54b-4c73-bf18-0a2bf90c35da, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, (INTEGER)_, (INTEGER)_)
THEN
ClearFlag(ORI_Gale_State_Dating_6e5dc80a-db14-4659-a790-e81aa6490307, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(ORI_Gale_State_NotDating_21f19438-754d-4ad2-883e-fd3f8814b917, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet((FLAG)_Var1, _, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_ORI_Gale_MystraUpdate(_Var1, _Var4, _, _Var1, _Var1)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var6, _Var7, _Var1, _Var1, _Var1)
THEN
PROC_ORI_Gale_MystraUpdate(_Var6, _Var7, _Var4);

IF
FlagSet(GLO_Monitor_State_MadeDeal_86f40f63-0bfa-4ab6-b3b0-d01475c3cbdc, _, _, _, _)
AND
DB_ORI_Gale_MystraUpdate(_Var3, _, _Var5, _, _)
AND
DB_GlobalFlag(_Var3, _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var6, _Var7, _, _, _)
THEN
QuestUpdate(_Var6, _Var7, _Var5);

QRY
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2);

QRY
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
DB_QRYRTN_Gale_JournalUpdateCandidate(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, "ORI_Avatar_Gale");

QRY
QRY_ORI_Gale_JournalUpdateCandidate()
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, "ORI_COM_Gale");

PROC
PROC_ORI_Gale_MystraUpdate((CHARACTER)_Var1, (STRING)_Var2, (STRING)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
QuestUpdate(_Var1, _Var2, _Var3);

PROC
PROC_ORI_Gale_MystraUpdate((CHARACTER)_Var1, (STRING)_Var2, (STRING)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(GLO_Monitor_State_MadeDeal_86f40f63-0bfa-4ab6-b3b0-d01475c3cbdc, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_HouseOfHope_State_ContractIsDestroyed_1a51a77c-d549-4d50-95df-97ab9d1ef9f6, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, _Var2, "MystraWithContract");

IF
FlagSet(WYR_RaphaelTango_Knows_WantsCrown_bb036e77-187b-f44d-9b26-8abc004bd9f6, _, (INTEGER)_Var2, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_ORI_Gale_LearnedRaphaelWantsCrown(_Var2);

IF
DialogEnded(_, (INTEGER)_Var2, _, _, _)
AND
DB_ORI_Gale_LearnedRaphaelWantsCrown(_Var2, _, _, _, _)
AND NOT
DB_GlobalFlag(GLO_Monitor_State_MadeDeal_86f40f63-0bfa-4ab6-b3b0-d01475c3cbdc, _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var3, _Var4, _, _, _)
AND
DB_ORI_Gale_MystraUpdate(_Var5, _, _, _, _)
AND
DB_GlobalFlag(_Var5, _, _, _, _)
THEN
QuestUpdate(_Var3, _Var4, "NoContractAfterMystra");

IF
FlagSet(LOW_HouseOfHope_State_ContractIsDestroyed_1a51a77c-d549-4d50-95df-97ab9d1ef9f6, _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var3, _Var4, _, _, _)
AND
DB_ORI_Gale_MystraUpdate(_Var5, _, _, _, _)
AND
DB_GlobalFlag(_Var5, _, _, _, _)
THEN
QuestUpdate(_Var3, _Var4, "DestroyedContract");

IF
FlagSet(ORI_Gale_Knows_BrainHasCrownOfKarsus_FromRaphael_4451456b-6f9b-7de2-9fae-68fc5a86f9d9, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Knows_BrainHasCrownOfKarsus_e456f90c-13ac-4f79-b7b1-e21db1800fe4, _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var3, _Var4, _, _, _)
THEN
QuestUpdate(_Var3, _Var4, "FindBook_Raphael");

IF
FlagSet(ORI_Gale_Knows_BrainHasCrownOfKarsus_e456f90c-13ac-4f79-b7b1-e21db1800fe4, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Knows_BrainHasCrownOfKarsus_FromRaphael_4451456b-6f9b-7de2-9fae-68fc5a86f9d9, _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var3, _Var4, _, _, _)
THEN
QuestUpdate(_Var3, _Var4, "FindBook_Raphael");

IF
DB_GlobalFlag(ORI_Gale_Quest_TeleportedVault_eeef2800-2e55-4e3b-b816-35fa583a9ca3, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_State_SentToFindBook_223470bc-af59-c833-500a-ace86e5cc1df, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_GotVaultHint_e912c718-92e7-27bd-fd24-848e9d43f5dc, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_OpenedPortal_3500399d-ca3b-4e3f-bae4-befc600a0a5d, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
AND NOT
DB_ORI_Gale_EnteredOffice(1, _, _, _, _)
THEN
PROC_ORI_Gale_JournalUpdate("TeleportedToVault1");

IF
DB_GlobalFlag(ORI_Gale_Quest_TeleportedVault_eeef2800-2e55-4e3b-b816-35fa583a9ca3, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_State_SentToFindBook_223470bc-af59-c833-500a-ace86e5cc1df, _, _, _, _)
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
QuestUpdate(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, "ORI_Avatar_Gale", "TeleportedToVault2");

IF
DB_GlobalFlag(ORI_Gale_State_SentToFindBook_223470bc-af59-c833-500a-ace86e5cc1df, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_GotVaultHint_e912c718-92e7-27bd-fd24-848e9d43f5dc, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_TeleportedVault_eeef2800-2e55-4e3b-b816-35fa583a9ca3, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_OpenedPortal_3500399d-ca3b-4e3f-bae4-befc600a0a5d, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
THEN
DB_OneShotPartyTrigger(S_ORI_Gale_TolnaOffice_1f835834-46e1-4e7f-8afd-2e85935ac488);

PROC
PROC_OneShotTriggerEntered(_, S_ORI_Gale_TolnaOffice_1f835834-46e1-4e7f-8afd-2e85935ac488, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var2, _Var3, _, _, _)
THEN
DB_ORI_Gale_EnteredOffice(1);
QuestUpdate(_Var2, _Var3, "EnteredOffice");

PROC
PROC_LOW_SorcerousSundries_ActivateBasementRoute()
THEN
SetFlag(ORI_Gale_Quest_OpenedPortal_3500399d-ca3b-4e3f-bae4-befc600a0a5d, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_RemoveOneShotTrigger(S_ORI_Gale_TolnaOffice_1f835834-46e1-4e7f-8afd-2e85935ac488);

IF
DB_GlobalFlag(ORI_Gale_Quest_OpenedPortal_3500399d-ca3b-4e3f-bae4-befc600a0a5d, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_TeleportedVault_eeef2800-2e55-4e3b-b816-35fa583a9ca3, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_State_SentToFindBook_223470bc-af59-c833-500a-ace86e5cc1df, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_GotVaultHint_e912c718-92e7-27bd-fd24-848e9d43f5dc, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, _Var2, "OpenedPortal");
PROC_RemoveOneShotTrigger(S_ORI_Gale_TolnaOffice_1f835834-46e1-4e7f-8afd-2e85935ac488);
DB_ORI_Gale_SearchVaultFlag(ORI_Gale_Quest_OpenedPortal_3500399d-ca3b-4e3f-bae4-befc600a0a5d);

IF
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Gale_SearchVaultFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_Gale_SearchingVault(1);

IF
GameBookInterfaceClosed(BOOK_LOW_SorcerousSundries_SorcerousBasementMystrylVaultHint_001_e66c8178-c987-4724-a21f-a76191b5a9a4, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetFlag(ORI_Gale_Quest_ReadVaultPath_2d329a79-0465-4e13-84d0-056efeac45c5, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_ORI_Gale_SearchingVault(1, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_Quest_ReadVaultPath_2d329a79-0465-4e13-84d0-056efeac45c5, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
AND
QRY_OnlyOnce("ORI_Gale_ReadVaultPath", _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, _Var2, "BookHintPath");

IF
DialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_ORI_Gale_DeathVoiceDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var3, _Var4, "LearnedMephit", 0, _Var1)
THEN
QuestUpdate(_Var3, _Var4, "PrematureProjectionEnd");

IF
GameBookInterfaceClosed(BOOK_LOW_SorcerousSundries_SorcerousBasementInvisibleLootHint_000_bf11de73-2ac6-4160-af0a-e588f79371ec, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetFlag(ORI_Gale_Quest_ReadInvisibilityHint_cda4fbb5-e568-40f2-aecc-6c2ca0d54565, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DualEntityEvent(_, (CHARACTER)_Var2, "LOW_RamazithsTower_TeleportedToSorcerousCellar", _, _)
AND
DB_PartyMembers(_Var2, _, _, _, _)
THEN
SetFlag(ORI_Gale_Quest_TeleportedVault_eeef2800-2e55-4e3b-b816-35fa583a9ca3, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_GlobalFlag(ORI_Gale_Quest_ReadInvisibilityHint_cda4fbb5-e568-40f2-aecc-6c2ca0d54565, _, _, _, _)
AND NOT
DB_ORI_Gale_SearchingVault(1, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_GotVaultHint_e912c718-92e7-27bd-fd24-848e9d43f5dc, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
AND
QRY_OnlyOnce("BookHintInvisibility", _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, _Var2, "BookHintInvisibility3");

IF
DB_GlobalFlag(ORI_Gale_Quest_ReadInvisibilityHint_cda4fbb5-e568-40f2-aecc-6c2ca0d54565, _, _, _, _)
AND NOT
DB_ORI_Gale_SearchingVault(1, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_GotVaultHint_e912c718-92e7-27bd-fd24-848e9d43f5dc, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
AND
QRY_OnlyOnce("BookHintInvisibility", _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, _Var2, "BookHintInvisibility3");

IF
DB_GlobalFlag(ORI_Gale_Quest_ReadInvisibilityHint_cda4fbb5-e568-40f2-aecc-6c2ca0d54565, _, _, _, _)
AND
DB_ORI_Gale_SearchingVault(1, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_Quest_ReadVaultPath_2d329a79-0465-4e13-84d0-056efeac45c5, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_Quest_ReadVaultPath_2d329a79-0465-4e13-84d0-056efeac45c5, _, _, _, _)
AND
QRY_OnlyOnce("BookHintInvisibility", _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, _Var2, "BookHintInvisibility2");

IF
DB_GlobalFlag(ORI_Gale_Quest_ReadInvisibilityHint_cda4fbb5-e568-40f2-aecc-6c2ca0d54565, _, _, _, _)
AND
DB_ORI_Gale_SearchingVault(1, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_Quest_ReadVaultPath_2d329a79-0465-4e13-84d0-056efeac45c5, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_FoundBook_3f0fc364-1d8b-4327-a234-d6623c698ec9, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Quest_ReadVaultPath_2d329a79-0465-4e13-84d0-056efeac45c5, _, _, _, _)
AND
QRY_OnlyOnce("BookHintInvisibility", _, _, _, _)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, _Var2, "BookHintInvisibility1");

PROC
PROC_ORI_Gale_JournalUpdate((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
QRY_ORI_Gale_JournalUpdateCandidate()
AND
DB_QRYRTN_Gale_JournalUpdateCandidate(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var2, _Var3, _Var1);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "ModWrapper_Gustav"
