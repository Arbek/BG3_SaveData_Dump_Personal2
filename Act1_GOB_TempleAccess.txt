Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_GOB_TempleAccess_Disk(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266);
DB_GOB_TempleAccess_Disk(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c);
DB_GOB_TempleAccess_Disk(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22);
DB_GOB_TempleAccess_Disk(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7);
DB_GOB_TempleAccess_Rotation(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 0);
DB_GOB_TempleAccess_Rotation(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 0);
DB_GOB_TempleAccess_Rotation(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 0);
DB_GOB_TempleAccess_Rotation(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 0);
DB_GOB_TempleAccess_DiskBones(0, "Dummy_Attachment_04", "GOB_TempleAccess_MoonState0");
DB_GOB_TempleAccess_DiskBones(1, "Dummy_Attachment_03", "GOB_TempleAccess_MoonState1");
DB_GOB_TempleAccess_DiskBones(2, "Dummy_Attachment_02", "GOB_TempleAccess_MoonState2");
DB_GOB_TempleAccess_DiskBones(3, "Dummy_Attachment_01", "GOB_TempleAccess_MoonState3");
DB_GOB_TempleAccess_DiskBones(4, "Dummy_Attachment_08", "GOB_TempleAccess_MoonState4");
DB_GOB_TempleAccess_DiskBones(5, "Dummy_Attachment_07", "GOB_TempleAccess_MoonState5");
DB_GOB_TempleAccess_DiskBones(6, "Dummy_Attachment_06", "GOB_TempleAccess_MoonState6");
DB_GOB_TempleAccess_DiskBones(7, "Dummy_Attachment_05", "GOB_TempleAccess_MoonState7");
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 0, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 1, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 2, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 3, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 0, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 1, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 2, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 3, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 0, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 1, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 2, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 3, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 0, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 1, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 2, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 3, 2);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 1, ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 2, ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 2, ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 3, ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 0, ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 1, ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 0, ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c);
DB_GOB_TempleAccess_Neighbours(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 3, ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22);
DB_GOB_TempleAccess_MoonState(2, VFX_Script_PUZ_Temple_Shar_Moon_Full_A_01_31b64b6c-918e-451f-91d5-bbda02959246);
DB_GOB_TempleAccess_MoonState(1, VFX_Script_PUZ_Temple_Shar_Moon_Crescent_A_01_be15adbd-e8c6-47ae-f6d4-ac257bfd1f85);
DB_GOB_TempleAccess_MoonState(0, VFX_Script_PUZ_Temple_Shar_Moon_New_A_01_4e356292-a2a4-1400-4564-3f5b052b0827);
PROC_GOB_TempleAccess_InitialEffects();
DB_GOB_TempleAccess_GoalState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 2);
DB_GOB_TempleAccess_GoalState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 0);
DB_KnowledgeCheckTrigger_AD("GOB_TempleAccess_PuzzleApproach", TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1, "Investigation", DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539, DIALOGRESOURCEGUID_GOB_TempleAccess_PuzzleApproach_AD_b1cf463a-da1c-c6fd-00c6-b15387da8a98, GOB_TempleAccess_State_Puzzle_CheckMade_b5774b21-5d68-1480-7fc0-bd4bd28cb1fa);
PROC_TriggerRegisterForPlayers(S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1);
DB_BookFlags(S_GOB_TempleAccess_Lorebook_283d7eff-f6e5-401f-852e-7ad7fb728b88, SHA_TempleOfShar_Quest_ReadInstructionPaper_c52a5b36-9a3b-4c68-843b-bc5242436019);

KBSECTION
PROC
PROC_GOB_TempleAccess_InitialEffects()
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
DB_GOB_TempleAccess_Neighbours(_Var1, _Var2, _Var4, _Var1, _Var1)
AND
DB_GOB_TempleAccess_Neighbours(_Var4, _Var5, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_Var5, _, _Var7, _Var1, _Var1)
AND NOT
DB_LoopEffect(_Var4, _, _Var7, _, _, _, _, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_Var2, _Var13, _Var14, _Var1, _Var1)
AND
DB_GOB_TempleAccess_MoonState(_Var3, _Var15, _Var1, _Var1, _Var1)
THEN
PROC_LoopEffect(_Var15, _Var1, _Var14, "WLD_Main_A", _Var13, 1);

PROC
PROC_GOB_TempleAccess_InitialEffects()
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _Var2, _Var3, _Var1, _Var1)
AND NOT
DB_GOB_TempleAccess_Neighbours(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_Var2, _Var5, _Var6, _Var1, _Var1)
AND
DB_GOB_TempleAccess_MoonState(_Var3, _Var7, _Var1, _Var1, _Var1)
THEN
PROC_LoopEffect(_Var7, _Var1, _Var6, "WLD_Main_A", _Var5, 1);

IF
UseStarted(_, (GUIDSTRING)_Var2, _, _, _)
AND
DB_GOB_TempleAccess_Disk(_Var2, _, _, _, _)
THEN
PROC_GOB_TempleAccess_DisksCanUse(0);
PROC_GOB_TempleAccess_SwitchEffectsTo(_Var2);
PROC_GOB_TempleAccess_Rotate(_Var2);

PROC
PROC_GOB_TempleAccess_DisksCanUse((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GOB_TempleAccess_Disk(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetCanInteract(_Var2, _Var1);

PROC
PROC_GOB_TempleAccess_SwitchEffectsTo((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_Rotation(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_Var3, _, _, _Var1, _Var1)
AND
IntegerModulo(_Var3, 4, _Var6, _Var1, _Var1)
AND
IntegerSubtract(_Var3, _Var6, _Var7, _Var1, _Var1)
AND
IntegerSubtract(_Var3, _Var2, _Var8, _Var1, _Var1)
AND
IntegerSum(_Var8, 8, _Var9, _Var1, _Var1)
AND
IntegerModulo(_Var9, 4, _Var10, _Var1, _Var1)
AND
DB_GOB_TempleAccess_Neighbours(_Var1, _Var10, _Var11, _Var1, _Var1)
AND
DB_GOB_TempleAccess_Rotation(_Var11, _Var12, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var10, 2, _Var13, _Var1, _Var1)
AND
IntegerModulo(_Var13, 4, _Var14, _Var1, _Var1)
AND
IntegerSum(_Var14, _Var12, _Var15, _Var1, _Var1)
AND
IntegerModulo(_Var15, 4, _Var16, _Var1, _Var1)
AND
IntegerSum(4, _Var7, _Var17, _Var1, _Var1)
AND
IntegerModulo(_Var17, 8, _Var18, _Var1, _Var1)
AND
IntegerSum(_Var18, _Var16, _Var19, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_Var19, _Var20, _Var21, _Var1, _Var1)
AND
DB_LoopEffect(_Var11, _, _Var21, _, _, _, _, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_Var3, _Var27, _Var28, _Var1, _Var1)
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _Var10, _Var29, _Var1, _Var1)
AND
DB_GOB_TempleAccess_MoonState(_Var29, _Var30, _Var1, _Var1, _Var1)
THEN
PROC_GOB_TempleAccess_DebugText("Removing ", _Var11, _Var20, _Var19);
PROC_GOB_TempleAccess_DebugText("Adding ", _Var1, _Var27, _Var3);
PROC_StopLoopEffect(_Var11, _Var21);
PROC_LoopEffect(_Var30, _Var1, _Var28, "WLD_Main_A", _Var27, 0.2);

PROC
PROC_GOB_TempleAccess_DebugText((STRING)_Var1, (GUIDSTRING)_Var2, (STRING)_Var3, (INTEGER)_Var4, (STRING)_Var1)
AND
Concatenate(_Var1, _Var3, _Var5, _Var1, _Var1)
AND
Concatenate(_Var5, ", at ID ", _Var6, _Var1, _Var1)
AND
ConcatenateInteger(_Var6, _Var4, _Var7, _Var1, _Var1)
THEN
DebugText(_Var2, _Var7);

IF
TextEvent("GOB_TempleAccess_DebugDiskEffect", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetTextEventParamInteger(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_Disk(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_Var1, _Var3, _, _Var1, _Var1)
THEN
PlayEffect(_Var2, VFX_Script_Stub_Poof_01_f0cf792a-0f74-d17e-ad0d-6052a6131416, _Var3, 1);

PROC
PROC_GOB_TempleAccess_Rotate((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_Rotation(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_GOB_TempleAccess_RotatingDisks(_Var1);
ObjectTimerLaunch(_Var1, "GOB_TempleAccess_Rotating", 2300);
SetAnimationEventInt(_Var1, "TempleDiscState", _Var2);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "GOB_TempleAccess_Rotating", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
NOT DB_GOB_TempleAccess_RotatingDisks(_Var1);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "GOB_TempleAccess_Rotating", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GOB_TempleAccess_RotatingDisks(_, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_TempleAccess_FinishedRotation(_Var1);

PROC
PROC_GOB_TempleAccess_FinishedRotation((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_Rotation(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var2, 1, _Var3, _Var1, _Var1)
AND
IntegerModulo(_Var3, 4, _Var4, _Var1, _Var1)
THEN
NOT DB_GOB_TempleAccess_Rotation(_Var1, _Var2);
DB_GOB_TempleAccess_Rotation(_Var1, _Var4);

PROC
PROC_GOB_TempleAccess_FinishedRotation((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
IntegerSubtract(_Var2, 1, _Var4, _Var1, _Var1)
AND
IntegerSum(_Var4, 4, _Var5, _Var1, _Var1)
AND
IntegerModulo(_Var5, 4, _Var6, _Var1, _Var1)
THEN
DB_GOB_TempleAccess_TempState(_Var1, _Var6, _Var3);
NOT DB_GOB_TempleAccess_CurrentState(_Var1, _Var2, _Var3);

PROC
PROC_GOB_TempleAccess_FinishedRotation((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_TempState(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
NOT DB_GOB_TempleAccess_TempState(_Var1, _Var2, _Var3);
DB_GOB_TempleAccess_CurrentState(_Var1, _Var2, _Var3);

PROC
PROC_GOB_TempleAccess_FinishedRotation((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
DB_GOB_TempleAccess_Neighbours(_Var1, _Var2, _Var4, _Var1, _Var1)
AND
IntegerSum(_Var2, 2, _Var5, _Var1, _Var1)
AND
IntegerModulo(_Var5, 4, _Var6, _Var1, _Var1)
AND
DB_GOB_TempleAccess_CurrentState(_Var4, _Var6, _Var7, _Var1, _Var1)
THEN
NOT DB_GOB_TempleAccess_CurrentState(_Var4, _Var6, _Var7);
DB_GOB_TempleAccess_CurrentState(_Var4, _Var6, _Var3);

PROC
PROC_GOB_TempleAccess_FinishedRotation((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_GOB_TempleAccess_DisksCanUse(1);

QRY
QRY_GOB_TempleAccess_AllDisksCorrect()
AND NOT
QRY_GOB_TempleAccess_AnyDiskWrong()
THEN
DB_NOOP(1);

QRY
QRY_GOB_TempleAccess_AnyDiskWrong()
AND
DB_GOB_TempleAccess_GoalState(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _, _Var4, _Var1, _Var1)
AND
_Var2 != _Var4
THEN
DB_NOOP(1);

PROC
PROC_GOB_TempleAccess_FinishedRotation((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
QRY_GOB_TempleAccess_AllDisksCorrect()
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1, 1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var2, 1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("GOB_TempleAccess_DoorWasOpened", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(GOB_TempleAccess_VB_SolvedPuzzle_d01f181a-617e-bc4b-2fd0-b1b8e7a9b986, _Var2);

IF
DB_GOB_TempleAccess_DesiredPosition(1, _, _, _, _)
THEN
DB_OnlyOnce("GOB_TempleAccess_DoorWasOpened");
NOT DB_KnowledgeCheckTrigger_AD("GOB_TempleAccess_PuzzleApproach", TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1, "Investigation", DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539, DIALOGRESOURCEGUID_GOB_TempleAccess_PuzzleApproach_AD_b1cf463a-da1c-c6fd-00c6-b15387da8a98, GOB_TempleAccess_State_Puzzle_CheckMade_b5774b21-5d68-1480-7fc0-bd4bd28cb1fa);

PROC
PROC_GOB_TempleAccess_FinishedRotation((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
QRY_GOB_TempleAccess_AllDisksCorrect()
THEN
PROC_GOB_TempleAccess_OpenDoor();
PROC_GOB_TempleAccess_SolvedPuzzleSound();

PROC
PROC_GOB_TempleAccess_SolvedPuzzleSound()
AND
IsLocked(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55, 1, _, _, _)
AND
IsClosed(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55, 1, _, _, _)
THEN
PlaySound(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55, "SE_PUZ_GoblinTemple_Complete");

PROC
PROC_GOB_TempleAccess_OpenDoor()
AND
QRY_OnlyOnce("GOB_TempleAccess_DoorOpenReward", _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "HIDDEN_WLD_Boosters", "GOB_TempleAccess_Solved");

PROC
PROC_GOB_TempleAccess_OpenDoor()
THEN
SetFlag(GOB_TempleAccess_Event_PuzzleSolved_e48a7760-a5b2-4f2e-9e9c-52645d772bd3, NULL_00000000-0000-0000-0000-000000000000, 0);
Open(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55);
SetPortalIsOpen(S_TempleAccess_RoomTrigger_30655ce6-8b68-442f-9f16-ee253fb49f55, 1);
SetEntityEvent(ITEMGUID_S_GOB_TempleAccess_SconceHolder_c9efc370-7ed3-4c2e-a9b3-f2b5fc159b70, "StoryReveal");
TriggerUnregisterForPlayers(TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1);

PROC
PROC_GOB_TempleAccess_OpenDoor()
AND
IsLocked(S_GOB_TempleAccess_SconceHolder_c9efc370-7ed3-4c2e-a9b3-f2b5fc159b70, 1, _, _, _)
THEN
Unlock(ITEMGUID_S_GOB_TempleAccess_SconceHolder_c9efc370-7ed3-4c2e-a9b3-f2b5fc159b70);

PROC
PROC_GOB_TempleAccess_FinishedRotation((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_Disk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_GOB_TempleAccess_AllDisksCorrect()
THEN
Close(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55);

IF
UseStarted(_, (GUIDSTRING)_Var2, _, _, _)
AND
DB_GOB_TempleAccess_Disk(_Var2, _, _, _, _)
AND NOT
DB_GlobalFlag(GOB_TempleAccess_SconceHolderLockpicked_fce36e1c-ca39-48fc-b276-bfacde3663ed, _, _, _, _)
AND
QRY_GOB_TempleAccess_DiskHasDifferentSymbols(_Var2, _, _, _, _)
THEN
Lock(ITEMGUID_S_GOB_TempleAccess_SconceHolder_c9efc370-7ed3-4c2e-a9b3-f2b5fc159b70, "Act1_TempleAccess_PuzzleLock");

QRY
QRY_GOB_TempleAccess_DiskHasDifferentSymbols((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _, _Var3, _Var1, _Var1)
AND
DB_GOB_TempleAccess_CurrentState(_Var1, _, _Var5, _Var1, _Var1)
AND
_Var3 != _Var5
THEN
DB_NOOP(1);

IF
DualEntityEvent(_, _, "SHA_TempleAccess_Lever", _, _)
AND NOT
QRY_GOB_OpenTempleAccessDoor()
THEN
Close(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55);

QRY
QRY_GOB_OpenTempleAccessDoor()
AND
IsOpened(IITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55, 0, _, _, _)
THEN
SetFlag(GOB_TempleAccess_Event_PuzzleSolved_e48a7760-a5b2-4f2e-9e9c-52645d772bd3, NULL_00000000-0000-0000-0000-000000000000, 0);
Open(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55);
SetPortalIsOpen(S_TempleAccess_RoomTrigger_30655ce6-8b68-442f-9f16-ee253fb49f55, 1);
TriggerUnregisterForPlayers(TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1);

IF
UseStarted(_, S_SHA_TempleAccess_StairsDownstairs_3780fa8f-9257-4998-81c4-1b28c293b26e, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
SetPortalIsOpen(S_TempleAccess_RoomTrigger_30655ce6-8b68-442f-9f16-ee253fb49f55, 1);
TriggerUnregisterForPlayers(TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1);

PROC
PROC_UND_TransitionCinematic_PassingTo(S_GOB_TempleAccess_TriggerUpstairs_67b88035-5a5c-4303-bf67-daa9b04497e5, _, _, _, _)
THEN
SetPortalIsOpen(S_TempleAccess_RoomTrigger_30655ce6-8b68-442f-9f16-ee253fb49f55, 1);
TriggerUnregisterForPlayers(TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1);

IF
Unlocked(S_GOB_TempleAccess_SconceHolder_c9efc370-7ed3-4c2e-a9b3-f2b5fc159b70, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 != NULL_00000000-0000-0000-0000-000000000000
THEN
SetFlag(GOB_TempleAccess_SconceHolderLockpicked_fce36e1c-ca39-48fc-b276-bfacde3663ed, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_GOB_TempleAccess_DesiredPosition(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DesiredPosition(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
THEN
NOT DB_GOB_TempleAccess_DesiredPosition(_Var2);

PROC
PROC_GOB_TempleAccess_DebugSolve()
THEN
SysClear("DB_GOB_TempleAccess_CurrentState", 3);

PROC
PROC_GOB_TempleAccess_DebugSolve()
AND
DB_GOB_TempleAccess_Disk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_TempleAccess_DiskBones(_, _, _Var4, _Var1, _Var1)
THEN
PROC_StopLoopEffect(_Var1, _Var4);

PROC
PROC_GOB_TempleAccess_DebugSolve()
THEN
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 0, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 1, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 2, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk11_a8bd8016-7cc5-4a5a-92de-15613aebc266, 3, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 0, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 1, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 2, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk22_fca07efd-bd0c-4936-9e9d-2df2532864f7, 3, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 0, 1);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 1, 1);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 2, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk12_75ae740b-0cf0-411f-b49d-9d339711493c, 3, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 0, 2);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 1, 0);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 2, 1);
DB_GOB_TempleAccess_CurrentState(ITEMGUID_S_GOB_TempleAccess_Disk21_242d119d-cb79-45d4-a394-b190f488fa22, 3, 1);

PROC
PROC_GOB_TempleAccess_DebugSolve()
THEN
PROC_GOB_TempleAccess_InitialEffects();
Open(ITEMGUID_S_GOB_TempleAccess_Door_7241f91d-e34f-4615-b484-3b338c109d55);
SetPortalIsOpen(S_TempleAccess_RoomTrigger_30655ce6-8b68-442f-9f16-ee253fb49f55, 1);
TriggerUnregisterForPlayers(TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1);

IF
FlagSet(SHA_TempleOfShar_Quest_ReadInstructionPaper_c52a5b36-9a3b-4c68-843b-bc5242436019, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
NOT DB_KnowledgeCheckTrigger_AD("GOB_TempleAccess_PuzzleApproach", TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1, "Investigation", DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539, DIALOGRESOURCEGUID_GOB_TempleAccess_PuzzleApproach_AD_b1cf463a-da1c-c6fd-00c6-b15387da8a98, GOB_TempleAccess_State_Puzzle_CheckMade_b5774b21-5d68-1480-7fc0-bd4bd28cb1fa);

IF
DB_InRegion(_Var1, TRIGGERGUID_S_GOB_TempleAccess_PuzzleApproach_AD_04cc41aa-0675-4c25-b5a7-5360f33a85a1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(SHA_TempleOfShar_Quest_ReadInstructionPaper_c52a5b36-9a3b-4c68-843b-bc5242436019, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "GOB_TempleAccess_InformedVB", _Var1, _Var1, _Var1)
THEN
StartVoiceBark(VOICEBARKRESOURCEGUID_GOB_TempleAccess_PuzzleApproach_ReadInstructions_VB_e1f8165c-2e3c-08b3-bbfa-7c476c3a816a, _Var1);

IF
GameBookInterfaceClosed(S_GOB_TempleAccess_Lorebook_283d7eff-f6e5-401f-852e-7ad7fb728b88, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_TempleAccess_ReadLorebook(1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "SHA_Nightsong", "ReadHalsinDiary", 1, _Var1)
THEN
QuestUpdate(_Var1, "SHA_Nightsong", "ReadAgedJournal");

IF
GameBookInterfaceClosed(S_GOB_TempleAccess_Lorebook_283d7eff-f6e5-401f-852e-7ad7fb728b88, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_TempleAccess_ReadLorebook(1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "SHA_Nightsong", "SawBook", 1, _Var1)
THEN
QuestUpdate(_Var1, "SHA_Nightsong", "ReadAgedJournal");

IF
GameBookInterfaceClosed(S_GOB_TempleAccess_Lorebook_283d7eff-f6e5-401f-852e-7ad7fb728b88, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_TempleAccess_ReadLorebook(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_TempleAccess_ReadLorebook(1);

IF
QuestUpdateUnlocked((CHARACTER)_Var1, "SHA_Nightsong", "ReadHalsinDiary", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_TempleAccess_ReadLorebook(1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "SHA_Nightsong", "ReadAgedJournal");

IF
QuestUpdateUnlocked((CHARACTER)_Var1, "SHA_Nightsong", "SawBook", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_TempleAccess_ReadLorebook(1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "SHA_Nightsong", "ReadAgedJournal");


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
