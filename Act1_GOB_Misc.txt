Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_PermaDefeatedEvent(S_GOB_GoblinKing_11337af0-6a57-426b-a820-c4b00923dd54, GLO_GoblinKing_State_PermaDefeated_d985480d-6158-0b0f-adfc-4bf3db785bf1);
DB_GLO_DefeatCounter(S_GOB_DrunkGoblin_0c3404d4-af6f-4c3c-8873-101a79cc4d86, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_PartyingGoblin_000_69ab2a7d-9035-4e4e-97e5-2d005c9662ee, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_PartyingGoblin_001_4aa22ae0-1f97-42e3-8fd7-474f2f3b7269, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_PartyingGoblin_002_bedb5fe5-2fa7-42f4-82c0-dda23883ff7c, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_000_031e9fb7-136a-46c7-91d7-77ce3e20236a, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_001_774c78ed-1227-48f9-812e-aac0021c71bf, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_002_bb9c82a2-7ed9-45ed-99b6-58f84520fb8c, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_003_0296a9f6-b2bc-46a0-8632-ba72679a36d3, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_004_e63401de-04ea-40b6-a988-b2f90a90f748, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_005_a955aea9-9040-4d4c-9264-e46e385dea94, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_006_f3f416d1-b946-4019-95ba-7053f63dd776, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Goblin_007_10a00987-1dbe-4540-aa34-e96976c7bac0, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_VoloGuard_c25f0e79-b9f7-453c-8138-964bca267d93, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_RoastingDwarfOperator_000_1fe911f8-c9c9-4405-83fa-d343d59c7be9, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_RoastingDwarfOperator_001_3837d519-dc92-459c-ab2d-1eac0b208fc7, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_ChickenChase_Commentator_eb2c434d-1833-485e-bca2-f181eed6010b, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Trader_3c9f9d17-835c-46bf-929d-240e3b4adb55, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Ogre_00_ffe2ab58-fddc-47ce-b369-bdb93b4a52dd, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_Festivities_Bugbear_Wanderer_c45936ea-2e38-4cf5-b5e1-1ff382888737, "GOB_FestivitiesArea");
DB_GOB_Festivities_Kids(S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518);
DB_GOB_Festivities_Kids(S_GOB_Festivities_GoblinKid_000_c8de613d-be02-42ab-ae91-3ed7ba5edafa);
DB_GOB_Festivities_Kids(S_GOB_Festivities_GoblinKid_001_73b27c74-5462-463d-ac82-67a40b87db2c);
DB_Dialogs(S_GOB_Festivities_GoblinKid_000_c8de613d-be02-42ab-ae91-3ed7ba5edafa, GOB_Festivities_GoblinKid000_e95670e5-77d1-3154-2bec-4f7a1d2a26ae);
DB_Dialogs(S_GOB_Festivities_GoblinKid_001_73b27c74-5462-463d-ac82-67a40b87db2c, GOB_Festivities_GoblinKid001_d9f09071-6102-eb93-7018-447098669e1e);
DB_Dialogs(S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518, GOB_Festivities_GoblinKid002_1f537b03-3118-20bc-b056-6bb78a0b1947);
DB_GOB_ShadowHeart_Trigger(S_GOB_MuralSphere_85551ba5-6916-4532-87fa-1f06045286b0, GOB_ShadowHeart_VB_Mural_6712960e-a6aa-cebe-d137-c913ad513884);
DB_GOB_ShadowHeart_Trigger(S_GOB_TempleBox_002_568b8a67-dfb6-4531-868f-dda7a05036f5, GOB_ShadowHeart_VB_Temple_09346a27-fd3a-8539-9160-d3b070fb936a);
DB_GOB_ShadowHeart_Trigger(S_GOB_StatueSphere_000_cbb7b039-445e-4657-b8b2-7f3965ed5450, GOB_ShadowHeart_VB_Statue_155b6052-2abf-a7c3-3f7e-10bece45a253);
DB_GOB_ShadowHeart_Trigger(S_GOB_StatueSphere_001_426b340d-9ef1-4631-b7f3-0759caad041b, GOB_ShadowHeart_VB_Statue_155b6052-2abf-a7c3-3f7e-10bece45a253);
DB_GOB_ShadowHeart_Trigger(S_GOB_StatueSphere_002_410c761f-ec00-4de3-abbe-2983251b55cf, GOB_ShadowHeart_VB_Statue_155b6052-2abf-a7c3-3f7e-10bece45a253);
PROC_TriggerRegisterForPlayers(S_GOB_MuralSphere_85551ba5-6916-4532-87fa-1f06045286b0);
PROC_TriggerRegisterForPlayers(S_GOB_TempleBox_002_568b8a67-dfb6-4531-868f-dda7a05036f5);
PROC_TriggerRegisterForPlayers(S_GOB_StatueSphere_000_cbb7b039-445e-4657-b8b2-7f3965ed5450);
PROC_TriggerRegisterForPlayers(S_GOB_StatueSphere_001_426b340d-9ef1-4631-b7f3-0759caad041b);
PROC_TriggerRegisterForPlayers(S_GOB_StatueSphere_002_410c761f-ec00-4de3-abbe-2983251b55cf);
DB_Singleton("GOB_ShadowHeart_VB", 0);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_001_2e21e856-f46c-405e-bdcb-9feaaf39a0a7, S_GOB_Firebowl_Hinge_001_e2dcc9da-c548-4937-a9b4-cc011b4aa23c);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_002_369396b4-4cf3-4403-b274-9dc0264b2328, S_GOB_Firebowl_Hinge_002_d73a89da-d573-40f5-bdd3-0ec6d4c8fbc7);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_003_03665d71-23e2-4bc3-be99-1bca7fedca9f, S_GOB_Firebowl_Hinge_003_d3080fb3-2020-4e40-af32-1a1e9443ce97);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_004_1e8a5515-543a-4d41-b750-42e2614f95cc, S_GOB_Firebowl_Hinge_004_bc199917-d1f2-44f1-9d0d-ee485388de63);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_005_0ad92e4a-8d39-4bb0-888d-84c30bd19785, S_GOB_Firebowl_Hinge_005_174ca644-8d06-4a20-bb0c-9a82c9835b60);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_007_8b1cbb19-a89a-40ee-8fcf-9410d3efe0b5, S_GOB_Firebowl_Hinge_007_f2f01421-eb38-492e-b984-82213c413237);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_008_5715caa0-6f6a-46b4-a99c-a2e93045f603, S_GOB_Firebowl_Hinge_008_566d43d5-8833-4060-a89c-1bac263c8ed2);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_009_931531b8-0115-4022-bec1-0d15d8d1bd11, S_GOB_Firebowl_Hinge_009_85ce5dee-d72d-43ee-8093-36d43f5efacd);
DB_GLO_FireBowls(S_GOB_Firebowl_Bowl_010_7d52aeb0-ed1a-47a4-b194-950472bfae7b, S_GOB_Firebowl_Hinge_010_32da5c3c-05b2-4a79-949d-ca2558116a13);
PROC_SetCorpseOwner(S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518);
DB_GOB_Festivities_PlayerCanLootBody(0);
DB_GOB_Festivities_KidsSurrenderAD(S_GOB_Festivities_GoblinKid_000_c8de613d-be02-42ab-ae91-3ed7ba5edafa, GOB_Festivities_AD_Kid_000_Booyahg_2cccf563-029a-613a-8475-2a30415ec9a3, "Booyahg");
DB_GOB_Festivities_KidsSurrenderAD(S_GOB_Festivities_GoblinKid_001_73b27c74-5462-463d-ac82-67a40b87db2c, GOB_Festivities_AD_Kid_001_Damaged_ff1a4d18-ba53-309d-dd9e-fb98345a71d6, "Damage");
DB_GOB_Festivities_KidsSurrenderAD(S_GOB_Festivities_GoblinKid_000_c8de613d-be02-42ab-ae91-3ed7ba5edafa, GOB_Festivities_AD_Kid_000_Damaged_4583c47e-65f9-f64f-1bf9-a8b34d82684c, "Damage");
DB_GOB_Festivities_KidsSurrenderAD(S_GOB_Festivities_GoblinKid_001_73b27c74-5462-463d-ac82-67a40b87db2c, GOB_Festivities_AD_Kid_001_Booyahg_c5f353f1-f9de-b844-4cef-d40205e1029a, "Booyahg");
DB_GOB_Festivities_KidsSurrenderDialogs(S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518, GOB_Festivities_GoblinKid002_1f537b03-3118-20bc-b056-6bb78a0b1947);
DB_GOB_Festivities_KidsSurrenderDialogs(S_GOB_Festivities_GoblinKid_001_73b27c74-5462-463d-ac82-67a40b87db2c, GOB_Festivities_GoblinKid001_d9f09071-6102-eb93-7018-447098669e1e);
DB_GOB_Festivities_KidsSurrenderDialogs(S_GOB_Festivities_GoblinKid_000_c8de613d-be02-42ab-ae91-3ed7ba5edafa, GOB_Festivities_GoblinKid000_e95670e5-77d1-3154-2bec-4f7a1d2a26ae);
DB_GOB_Festivities_Booyahg("CALM");
DB_GOB_Festivities_Booyahg("FRIGHTENED");
DB_GOB_Festivities_Booyahg("PARALYZED");
DB_GOB_Festivities_Booyahg("PETRIFIED");
DB_GOB_Festivities_Booyahg("BLINDNESS");
DB_GOB_Festivities_Booyahg("CHILL_TOUCH");
DB_GOB_Festivities_Booyahg("COMMAND_FLEE");
DB_GOB_Festivities_Booyahg("CONFUSION");
DB_GOB_Festivities_Booyahg("CHARMED");
DB_GOB_Festivities_Booyahg("MADNESS");
DB_GOB_Festivities_Booyahg("SLEEP");
DB_GOB_Festivities_Booyahg("FROZEN");
DB_GOB_Festivities_Booyahg("SLEEPING");
PROC_CharacterDisableCrime(S_GOB_Festivities_GoblinKid_000_c8de613d-be02-42ab-ae91-3ed7ba5edafa, "GOB_Festivities_Kids_AdventurerCorpseLooting");
PROC_CharacterDisableCrime(S_GOB_Festivities_GoblinKid_001_73b27c74-5462-463d-ac82-67a40b87db2c, "GOB_Festivities_Kids_AdventurerCorpseLooting");
PROC_CharacterEnableCrime(S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518, "GOB_Festivities_Kids_AdventurerCorpseLooting");
DB_CRIME_AddressOwnerWithCombatFallback("GOB_Festivities_Kids_AdventurerCorpseLooting");
DB_GlobalFlagReactionAfterDialog(GOB_Festivities_State_KidsFighting_fdc4b841-296b-4f3a-88df-a70c30cd838b, GOB_Festivities_GoblinKid002_LootingCrime_29f3c83c-83d8-76a1-dc60-a50f1b8fbab2);
DB_GOB_General_HostilityVBAreas(S_GOB_AfterDenHelp_VB_Zone_00_f292fe11-5b93-409c-b3d0-d234a32204c2);
DB_GOB_General_HostilityVBAreas(S_GOB_AfterDenHelp_VB_Zone_01_a52fb246-d99b-4e4f-bc33-e8923ef28533);
SetTag(S_GOB_GoblinThrone_SecretEntrance_LadderFrom_1e4c968c-370c-4c8d-a074-ab227d85b28d, NO_PATHFINDING_PORTAL_d9793375-20f0-437f-8033-011014b0b9ca);
PROC_CharacterDisableCrime(S_GOB_Festivities_Ogre_00_ffe2ab58-fddc-47ce-b369-bdb93b4a52dd, "DangerousMonsterReactionFallback");
PROC_CharacterDisableCrime(S_GOB_Festivities_Bugbear_Wanderer_c45936ea-2e38-4cf5-b5e1-1ff382888737, "DangerousMonsterReactionFallback");
PROC_CharacterDisableCrime(S_GOB_DrunkGoblin_0c3404d4-af6f-4c3c-8873-101a79cc4d86, "DangerousMonsterReactionFallback");
PROC_CharacterDisableCrime(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, "DangerousMonsterReactionFallback");
PROC_CharacterDisableCrime(S_GOB_GoblinPriest_b983c336-9a14-4e9b-adb9-4689e7e0afa9, "DangerousMonsterReactionFallback");
PROC_CharacterDisableCrime(S_GOB_GoblinKing_11337af0-6a57-426b-a820-c4b00923dd54, "DangerousMonsterReactionFallback");
PROC_CharacterDisableCrime(S_GOB_GoblinKing_11337af0-6a57-426b-a820-c4b00923dd54, "DangerousMonsterReaction");
DB_BookFlags(S_GOB_SharTempleMap_f01b15a1-e670-43ac-abeb-e7ec9d5fc803, GOB_TempleAccess_State_Puzzle_Check2Made_972e520a-6271-46a5-8f20-679924d4eb63);
DB_CorpseLooting_ClearRedOutlineOnFactionGroupTagged("WLD_Main_A", "Act1_GOB_Festivities", ACT1_GOB_FestivitiesAreaGoblins_0e01ffb1-ecd5-834b-edc4-f19a61dcd405, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727);
DB_CorpseLooting_ClearRedOutlineOnFactionGroupTagged("WLD_Main_A", "Act1_GOB_Festivities", ACT1_GOB_DrunkGoblin_FistFight_381ddd56-5aa8-dd7b-bb2e-b1d1fba64a8f, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727);
DB_CorpseLooting_ClearRedOutlineOnFactionGroupTagged("WLD_Main_A", "Act1_GOB_Festivities", ACT1_GOB_PatrolBugbear_4675c262-b1fe-4055-84a3-acabc3dac69a, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727);
DB_CorpseLooting_ClearRedOutlineOnFactionGroupTagged("WLD_Main_A", "Act1_GOB_Festivities", ACT1_GOB_VoloGuard_5e50ffef-d250-4a18-a3d4-b3fe4f574a4b, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727);
DB_GOB_AllCampAreas(S_GOB_Festivities_SUB_217424e5-f9b7-4441-ab09-715076696a12);
DB_GOB_AllCampAreas(S_GOB_ThroneRoom_SUB_bb81678b-641c-43fc-bd41-53295d59be03);
DB_GOB_AllCampAreas(S_GOB_PriestDungeon_SUB_d693268c-84c9-44c2-ac7d-11ebc5524764);
DB_GOB_AllCampAreas(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6);
DB_GOB_AllCampAreas(S_GOB_PainPenance_SUB_3189cec7-0f63-468c-a147-6a5fe426f518);
DB_Dialogs(S_GOB_AftermathTrader_5e3467b4-9186-4ab2-81b8-cf379bcbd982, GOB_AftermathTrader_53e95029-a8e0-73c5-9de3-c61f40109a68);
SetOnStage(S_GOB_AftermathTrader_5e3467b4-9186-4ab2-81b8-cf379bcbd982, 0);

KBSECTION
IF
DB_GOB_AllCampAreas(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_TriggerEvents_TriggerSet("GOB_GoblinCamp", _Var1);

IF
DB_InRegion(_Var1, S_GOB_Festivities_SUB_217424e5-f9b7-4441-ab09-715076696a12, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GLO_GoblinCamp_EverEnteredBefore_7a0172dd-df95-448a-aa2e-a04acdf7eabe, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(GLO_GoblinCamp_EverEnteredBefore_7a0172dd-df95-448a-aa2e-a04acdf7eabe);

PROC
PROC_GLO_DefeatCounter_AllPermaDefeated("GOB_FestivitiesArea", _, _, _, _)
THEN
SetFlag(GOB_FestivitiesArea_State_Swept_01863b85-a514-473a-9fa9-2869612480a2, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_RegisterWorldGossipTrigger(S_PartyBanterTrigger_GOB_CampCleared_e45070fa-4c29-47bf-b1fd-00050702dcab);

PROC
PROC_GOB_SetFactionGroupHostileToPlayers((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_CorpseLooting_ClearRedOutlineOnFactionGroupTagged("WLD_Main_A", _Var1, _Var2, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727, _Var1)
THEN
PROC_SetRelationToPlayers(_Var2, 0);
PROC_FactionSetLootOwned(_Var2, 0);

PROC
PROC_GOB_MakeFestivitiesAreaHostile()
AND
QRY_OnlyOnce("GOB_MakeFestivitiesAreaHostile", _, _, _, _)
THEN
PROC_GOB_SetFactionGroupHostileToPlayers("Act1_GOB_Festivities");
PROC_GOB_SetFactionGroupHostileToPlayers("Act1_GOB_Checkpoint");
PROC_GOB_SetFactionGroupHostileToPlayers("Act1_GOB_Checkpoint_Backup");
PROC_GlobalSetFlagAndCache(GOB_FestivitiesArea_State_Hostile_d5ee4e10-d88b-4226-9607-41b7399a837f);

IF
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SurrenderManually(_Var1);

IF
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "GOB_Festivities_Kids");

PROC
PROC_StateSet_Defeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_GOB_Festivities_PlayerSeesKid(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Festivities_RemoveKids();

PROC
PROC_StateSet_Defeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_Festivities_PlayerSeesKid(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_Surrender_GetSurrenderCause(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_Surrender_GetSurrenderCause(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Festivities_KidsSurrender("Damage", _Var2);

QRY
QRY_GOB_Festivities_PlayerSeesKid((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
StatusApplied((CHARACTER)_Var1, (STRING)_Var2, (CHARACTER)_Var3, _, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Booyahg(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Festivities_KidsSurrender("Booyahg", _Var3);

PROC
PROC_GOB_Festivities_KidsSurrender((STRING)_Var1, (CHARACTER)_Var2, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
DB_GlobalFlag(GOB_Festivities_State_KidsSurrendered_d9a99c62-f755-4719-aaca-4e82ad0de126, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("GOB_Festivities_RemoveKids", _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var3, 1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_KidsSurrenderAD(_Var3, _Var5, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("GOB_Festivities_SurrenderADPlayed", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(_Var5, _Var3);

PROC
PROC_GOB_Festivities_KidsSurrender((STRING)_Var1, (CHARACTER)_Var2, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
DB_GlobalFlag(GOB_Festivities_State_KidsSurrendered_d9a99c62-f755-4719-aaca-4e82ad0de126, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("GOB_Festivities_RemoveKids", _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var4, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Gestivities_PausedCombat(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("GOB_Festivities_KidsSurrenderTimerLaunched", _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_Gestivities_PausedCombat(_Var4);
PauseCombat(_Var4);
DB_GOB_Festivities_Kids_SurrenderCause(_Var2);
TimerLaunch("GOB_Festivities_KidsSurrender_Timer", 2300);

IF
TimerFinished("GOB_Festivities_KidsSurrender_Timer", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_Gestivities_PausedCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_Gestivities_PausedCombat(_Var1);
ResumeCombat(_Var1);

IF
TimerFinished("GOB_Festivities_KidsSurrender_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var1, 1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_KidsSurrenderDialogs(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("GOB_Festivities_SurrenderStarted", _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids_SurrenderCause(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_Festivities_Kids_SurrenderCause(_Var4);
PROC_GlobalSetFlagAndCache(GOB_Festivities_State_KidsSurrendered_d9a99c62-f755-4719-aaca-4e82ad0de126);
PROC_Surrender(_Var1, _Var4, _Var3);

IF
CombatStarted((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_Festivities_Kids(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, S_GOB_Festivities_KidsArea_0ebcc246-af8b-4305-b5c6-b01d19e5a6fd, 1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Festivities_State_KidsFighting_fdc4b841-296b-4f3a-88df-a70c30cd838b, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(GOB_Festivities_State_KidsFighting_fdc4b841-296b-4f3a-88df-a70c30cd838b);

IF
LeftCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(GOB_Festivities_State_KidsFighting_fdc4b841-296b-4f3a-88df-a70c30cd838b, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
_Var3 != _Var1
AND NOT
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_GlobalClearFlagAndCache(GOB_Festivities_State_KidsFighting_fdc4b841-296b-4f3a-88df-a70c30cd838b);

PROC
PROC_GlobalFlagReactionAfterDialog(GOB_Festivities_State_KidsFighting_fdc4b841-296b-4f3a-88df-a70c30cd838b, GOB_Festivities_GoblinKid002_LootingCrime_29f3c83c-83d8-76a1-dc60-a50f1b8fbab2, _, _, _)
AND NOT
DB_Defeated(S_GOB_SecludedSpot_Goblin_b811fc94-bcd7-4be3-a53a-0663cbc16c34, _, _, _, _)
THEN
PROC_SetRelation(ACT1_GOB_SecludedGoblin_9782ad5f-54be-40cb-ba2d-5f8ec4d0fcf6, ACT1_GOB_FestivitiesKids_021b58fe-a0de-4cef-af2c-ca03b475de50, 50);

IF
FlagCleared(GOB_Festivities_State_KidsFighting_fdc4b841-296b-4f3a-88df-a70c30cd838b, _, _, _, _)
AND NOT
DB_Defeated(S_GOB_SecludedSpot_Goblin_b811fc94-bcd7-4be3-a53a-0663cbc16c34, _, _, _, _)
THEN
PROC_SetRelation(ACT1_GOB_SecludedGoblin_9782ad5f-54be-40cb-ba2d-5f8ec4d0fcf6, ACT1_GOB_FestivitiesKids_021b58fe-a0de-4cef-af2c-ca03b475de50, 100);

IF
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterEnableCrime(_Var1, "GOB_Checkpoint_WarPaint");

PROC
PROC_BlockLootCorpse((CHARACTER)_Var1, S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Festivities_PlayerCanLootBody(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_Festivities_AnyKidCanBlockCorpseLooting(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_CustomLootCorpseResponse(_Var1, S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, 0);
PROC_CharacterRegisterCrime(_Var1, "GOB_Festivities_Kids_AdventurerCorpseLooting", S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518, 0);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, (STRING)_Var2, S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, (CHARACTER)_Var3, (INTEGER)_Var4)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Festivities_PlayerCanLootBody(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_CRIME_IsCrimeFamilyMember(_Var2, "LootOwnedCorpse", _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, "MoveOwnedCorpse", S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, (CHARACTER)_Var2, (INTEGER)_Var3)
AND
DB_GOB_Festivities_Kids(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(GOB_Festivities_Event_CorpseShoved_cba2b424-30dc-4039-b7a9-6dc8f05c3763);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, "MoveOwnedCorpse", S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, (CHARACTER)_Var2, (INTEGER)_Var3)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Festivities_PlayerCanLootBody(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_Festivities_AnyKidCanBlockCorpseLooting(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterRegisterCrime(_Var1, "GOB_Festivities_Kids_AdventurerCorpseLooting", S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab, S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518, 0);

IF
FlagSet(GOB_Festivities_State_KidsSurrendered_d9a99c62-f755-4719-aaca-4e82ad0de126, _, _, _, _)
AND NOT
DB_GOB_Festivities_PlayerCanLootBody(1, _, _, _, _)
THEN
PROC_ClearCorpseOwner(S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab);
DB_GOB_Festivities_PlayerCanLootBody(1);

PROC
PROC_GOB_Festivities_RemoveKids_Internal()
AND NOT
DB_GOB_Festivities_PlayerCanLootBody(1, _, _, _, _)
THEN
PROC_ClearCorpseOwner(S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab);
DB_GOB_Festivities_PlayerCanLootBody(1);

PROC
PROC_StateSet_PermaDefeated(S_GOB_Festivities_GoblinKid_002_f11d525d-e94d-4e96-a4ae-e43f34430518, _, _, _, _)
AND NOT
DB_GOB_Festivities_PlayerCanLootBody(1, _, _, _, _)
THEN
PROC_ClearCorpseOwner(S_GOB_GeneralFestivities_DeadBody_f8d0a86d-4df7-443c-81fd-b267703b48ab);
DB_GOB_Festivities_PlayerCanLootBody(1);

IF
CharacterOnCrimeSensibleActionNotification((CHARACTER)_Var1, _, _, (STRING)_Var4, _, _, _, _, _, _)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_CRIME_FleeReaction(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Festivities_RemoveKids();

IF
KilledBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_Festitivies_KidKiller(_Var1, _Var2);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_Festitivies_KidKiller(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
DB_Was_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_Festitivies_KidKiller(_Var2, _Var3);
PROC_CharacterRegisterCrime(_Var3, "Murder", NULL_00000000-0000-0000-0000-000000000000, _Var2, 0);

QRY
QRY_GOB_Festivities_AnyKidCanBlockCorpseLooting((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_Festivities_Kids(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var2, _, _Var1, _Var1, _Var1)
AND
CanSee(_Var2, _Var1, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DB_Was_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(GOB_Festivities_Event_CorpseShoved_cba2b424-30dc-4039-b7a9-6dc8f05c3763, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Festivities_State_KidsSurrendered_d9a99c62-f755-4719-aaca-4e82ad0de126, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Festivities_RemoveKids();

IF
DialogEnded(GOB_Festivities_GoblinKid002_LootingCrime_29f3c83c-83d8-76a1-dc60-a50f1b8fbab2, _, _, _, _)
AND
DB_GlobalFlag(GOB_Festivities_Event_KidsRun_8e6522c7-e0c1-8e17-1346-97ea30a05135, _, _, _, _)
THEN
PROC_GOB_Festivities_RemoveKids();

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_GOB_Festivities_SUB_217424e5-f9b7-4441-ab09-715076696a12, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_Festivities_Kids(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var3, _, _Var1, _Var1, _Var1)
AND
CanSee(_Var3, _Var1, 1, _Var1, _Var1)
THEN
PROC_GOB_Festivities_RemoveKids();

PROC
PROC_GOB_MakeFestivitiesAreaHostile()
THEN
PROC_GOB_Festivities_RemoveKids();

IF
FlagSet(GOB_GoblinToast_Event_ToStations_0b555ee8-2b8e-3881-b35e-9811f6baf77a, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
PROC_GOB_Festivities_RemoveKids();

PROC
PROC_GOB_Festivities_RemoveKids()
AND
QRY_OnlyOnce("GOB_Festivities_RemoveKids", _, _, _, _)
THEN
PROC_GOB_Festivities_RemoveKids_Internal();

PROC
PROC_GOB_Festivities_RemoveKids_Internal()
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
LeaveCombat(_Var1);
SetImmortal(_Var1, 1);
SetCanJoinCombat(_Var1, 0);
PROC_SetCanFight(_Var1, 0);

PROC
PROC_GOB_Festivities_RemoveKids_Internal()
AND
DB_GOB_Festivities_Kids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_UnSurrender(_Var1, NULL_00000000-0000-0000-0000-000000000000);
PROC_ForceStopDialog(_Var1);
PROC_DisappearOutOfSight(_Var1, "Run", 1, "");

IF
FlagSet(GOB_FestivitiesArea_State_Swept_01863b85-a514-473a-9fa9-2869612480a2, _, _, _, _)
AND
QRY_OnlyOnce("GLO_Camp_SetSoundStateDead", _, _, _, _)
THEN
PROC_GOB_Misc_MakeFestivitiesDead();

IF
FlagSet(GOB_GoblinToast_State_RealizedPoison_0e867c08-b2b9-4f43-8260-168026663e2c, _, _, _, _)
AND
QRY_OnlyOnce("GLO_Camp_SetSoundStatePoisoned", _, _, _, _)
THEN
PROC_GOB_Misc_MakeFestivitiesPoisoned();

PROC
PROC_GOB_Misc_MakeFestivitiesPoisoned()
THEN
TriggerSetSoundState(Amb_SV_Forest_Dense_FZ_001_727b95fa-f30c-3d41-cbe2-dc0d67f8f105, "S_GOB_Festivities_States", "Poisoned", 1);
TriggerSetSoundState(Amb_SV_GoblinCamp_FZ_001_68aa2d33-5615-5c33-4a4d-7892c2c8f108, "S_GOB_Festivities_States", "Poisoned", 1);
TriggerSetSoundState(Amb_SV_Plains_FZ_000_9878e6ab-03c9-dca0-a345-193a021d1906, "S_GOB_Festivities_States", "Poisoned", 1);

PROC
PROC_GOB_Misc_MakeFestivitiesDead()
THEN
TriggerSetSoundState(Amb_SV_Forest_Dense_FZ_001_727b95fa-f30c-3d41-cbe2-dc0d67f8f105, "S_GOB_Festivities_States", "Dead", 1);
TriggerSetSoundState(Amb_SV_GoblinCamp_FZ_001_68aa2d33-5615-5c33-4a4d-7892c2c8f108, "S_GOB_Festivities_States", "Dead", 1);
TriggerSetSoundState(Amb_SV_Plains_FZ_000_9878e6ab-03c9-dca0-a345-193a021d1906, "S_GOB_Festivities_States", "Dead", 1);

IF
DB_GLO_DefeatCounter(_Var1, "GOB_FestivitiesArea", _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "GOB_FESTIVITIES_DRUNK", -1);

IF
UseStarted(S_GOB_VoloGuard_c25f0e79-b9f7-453c-8138-964bca267d93, S_GOB_ThroneRoom_Door_Entrance_bf8a7b29-383d-4344-bbe6-b72f10c1ba50, _, _, _)
THEN
NOT DB_GLO_DefeatCounter(S_GOB_VoloGuard_c25f0e79-b9f7-453c-8138-964bca267d93, "GOB_FestivitiesArea");
DB_GLO_DefeatCounter(S_GOB_VoloGuard_c25f0e79-b9f7-453c-8138-964bca267d93, "GOB_GoblinThroneGeneral");

IF
EnteredTrigger(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_GOB_ShadowHeart_Trigger(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Singleton("GOB_ShadowHeart_VB", _Var3, _Var1, _Var1, _Var1)
AND
_Var3 < 2
AND
IntegerSum(_Var3, 1, _Var4, _Var1, _Var1)
THEN
DB_Singleton("GOB_ShadowHeart_VB", _Var4);
StartVoiceBark(_Var2, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
NOT DB_GOB_ShadowHeart_Trigger(_Var1, _Var2);
PROC_TriggerUnregisterForPlayers(_Var1);

IF
FlagSet(GOB_TorturedAdventurer_Knows_ToldHiddenSharTemple_802ac505-3d90-7eba-d822-4d5e73b65d07, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_Singleton("GOB_ShadowHeart_VB", 1);

IF
DB_GlobalFlag(GOB_TorturedAdventurer_Knows_ToldHiddenSharTemple_802ac505-3d90-7eba-d822-4d5e73b65d07, _, _, _, _)
AND
DB_Singleton("GOB_ShadowHeart_VB", 2, _, _, _)
AND
DB_GOB_ShadowHeart_Trigger(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_ShadowHeart_Trigger(_Var1, _Var2);
PROC_TriggerUnregisterForPlayers(_Var1);
NOT DB_Singleton("GOB_ShadowHeart_VB", 2);

IF
UseStarted((GUIDSTRING)_Var1, S_WLD_RoadToMountainPass_a81232d7-af15-4c77-b0e1-d7e791fd463b, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_TeleportPartiesTo(efe2f85a-c4ed-4299-bd73-3eac80962da6, "");

IF
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND NOT
DB_GlobalFlag(GOB_General_State_Hostile_9816a6fb-54d7-4b9c-a5c7-bc6cda6bb276, _, _, _, _)
AND
DB_Is_InCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_AttackOnDen_EnterCombatWithDrow", _Var1, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var2, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1, _Var1, _Var1)
THEN
SetImmortal(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);
DB_OnlyOnce("DEN_AttackOnDen_EnterCombatWithDrow");
SetFlag(GOB_General_State_Hostile_9816a6fb-54d7-4b9c-a5c7-bc6cda6bb276, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(DEN_AttackOnDen_State_DenVictory_71c7f23e-3ff1-c9b8-3ef5-d75fa1b42c8d, _, _, _, _)
AND
DB_GlobalFlag(GLO_AttackOnDen_State_RaidReady_eb361773-da88-dee4-f4c8-a22acae60948, _, _, _, _)
AND NOT
DB_GlobalFlag(GOB_General_State_Hostile_9816a6fb-54d7-4b9c-a5c7-bc6cda6bb276, _, _, _, _)
THEN
SetFlag(GOB_General_State_Hostile_9816a6fb-54d7-4b9c-a5c7-bc6cda6bb276, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(GOB_General_State_Hostile_9816a6fb-54d7-4b9c-a5c7-bc6cda6bb276, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_FactionSetLootOwned(ACT1_GOB_Goblins_General_633245e8-cbb8-b0c4-12ec-32d2ff9424e2, 0);
PROC_GOB_MakeRegionHostile();

PROC
PROC_GOB_MakeRegionHostile()
THEN
DebugBreak("Goblin Camp hostile!");

PROC
PROC_GOB_MakeRegionHostile()
THEN
PROC_GOB_Checkpoint_MakeCheckpointHostile();
PROC_GOB_MakeFestivitiesAreaHostile();
SetFlag(GOB_BattleStations_Event_ToStation_03a8bd66-c23f-4989-9a7b-775cf475104b, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GOB_MakeRegionHostile()
AND
DB_GOB_General_HostilityVBAreas(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(_Var1);

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_General_HostilityVBAreas(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "GOB_PAD_WarningAfterDenHelp", _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(GOB_PAD_WarningAfterDenHelp_bbb1a1af-53f4-bbb6-4558-3b907cb2a7b1, _Var1);
PROC_GOB_General_UnregisterHostilityVBTriggers();
PROC_GOB_PostAoD_GoblinCampHostile_JournalHook();
PROC_CAMP_GoblinHuntCelebration_RaidersBetrayal_JournalHook();

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var3, _Var1, _Var4, _Var1, _Var1)
AND
DB_DialogName(GOB_PAD_WarningAfterDenHelp_bbb1a1af-53f4-bbb6-4558-3b907cb2a7b1, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopSpecificDialog(_Var1, GOB_PAD_WarningAfterDenHelp_bbb1a1af-53f4-bbb6-4558-3b907cb2a7b1);

PROC
PROC_GOB_PostAoD_GoblinCampHostile_JournalHook()
THEN
DB_NOOP(1);

PROC
PROC_GOB_General_UnregisterHostilityVBTriggers()
AND
DB_GOB_General_HostilityVBAreas(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(_Var1);

IF
DB_GlobalFlag(GLO_GoblinKing_State_PermaDefeated_d985480d-6158-0b0f-adfc-4bf3db785bf1, _, _, _, _)
THEN
PROC_GOB_CheckSetKingDeadNoPoisonState();
SetFlag(GOB_GoblinToast_State_RealizedPoison_0e867c08-b2b9-4f43-8260-168026663e2c, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(GOB_GoblinToast_Event_ToStations_0b555ee8-2b8e-3881-b35e-9811f6baf77a, NULL_00000000-0000-0000-0000-000000000000);
PROC_GOB_MakeFestivitiesAreaHostile();

PROC
PROC_GOB_CheckSetKingDeadNoPoisonState()
AND NOT
DB_GlobalFlag(GOB_GoblinToast_State_RealizedPoison_0e867c08-b2b9-4f43-8260-168026663e2c, _, _, _, _)
THEN
SetFlag(GOB_Festivities_State_KingDeadNoPoison_74d1d1b5-b8de-4685-8c30-4325aedbab03, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GOB_GoblinHuntAftermath_Pacified()
THEN
PROC_GOB_General_UnregisterHostilityVBTriggers();
PROC_GOB_RemoveAllGoblins();

PROC
PROC_GOB_RemoveAllGoblins()
AND
DB_GOB_AllCampAreas(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerLaunchIterator(_Var1, "GOB_GoblinHuntCelebration_Aftermath_ClearCamp", "GOB_GoblinHuntCelebration_Aftermath_ClearCamp_Finish");

IF
EntityEvent((CHARACTER)_Var1, "GOB_GoblinHuntCelebration_Aftermath_ClearCamp", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PartOfTheTeam(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
EntityEvent(S_GOB_Festivities_SUB_217424e5-f9b7-4441-ab09-715076696a12, "GOB_GoblinHuntCelebration_Aftermath_ClearCamp_Finish", _, _, _)
THEN
SetOnStage(S_GOB_AftermathTrader_5e3467b4-9186-4ab2-81b8-cf379bcbd982, 1);

IF
FlagSet(Act2_PointOfNoReturnReached_a3155f30-b8f3-4db5-ac21-d3036f4426e3, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GOB_Festivities_CompleteGoal();

PROC
PROC_GOB_Festivities_CompleteGoal()
THEN
GoalCompleted;


EXITSECTION
PROC_GOB_General_UnregisterHostilityVBTriggers();
ENDEXITSECTION

ParentTargetEdge "Act1"
