Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_OneShot_VoiceBarkTrigger(S_PLA_Tavern_VB_Arrival_9d34d24a-2a7a-4de2-a971-9face0384548, VOICEBARKRESOURCEGUID_PLA_Tavern_VB_Arrival_04c3503e-4a5a-26f0-6870-a54c00a96b10);
DB_OneShot_VoiceBarkTrigger(S_PLA_Tavern_VB_House_05dae15b-885a-4ccc-b958-d7e1450db526, VOICEBARKRESOURCEGUID_PLA_Tavern_VB_House_addce811-7f32-3cf5-5d3d-ff335f63f6ba);
DB_OneShot_VoiceBarkTrigger(S_PLA_StuckHalfElf_VB_Door_cd74de97-21a4-4158-ae3a-b4706ec2165b, PLA_StuckHalfElf_VB_Door_3633542e-1622-ff65-a29f-60ea8ee3d36a);
DB_GLO_CharacterCorpseDialog(S_PLA_Tavern_DeadCiv1_1ed658d0-e88a-4b7b-ab9e-1e520ae7d0c7, PLA_Tavern_DeadCiv1_Dead_4840f358-407f-0fdb-352d-c1db600ed975);
DB_GLO_CharacterCorpseDialog(S_PLA_Tavern_DeadGoblin1_dbab2024-e7d5-4e1b-99cf-abc15c71755a, PLA_Tavern_DeadGoblin1_Dead_a8fc2d3e-439b-d7d9-0ef5-6b5112852a66);
DB_GLO_CharacterCorpseDialog(S_PLA_Tavern_DeadDrow1_1e367bd5-da56-4fb3-9f49-d0ecc3b45599, PLA_Tavern_DeadDrow1_Dead_0ec4cb0f-5f4c-d286-ea69-04ed9a63e39f);
DB_GLO_CharacterCorpseDialog(S_PLA_Tavern_DeadFF1_cfd9d50a-14b1-4a25-9d2e-ca626818dcd2, PLA_Tavern_DeadFF1_Dead_e2023b6e-ed8b-8ffe-ddeb-dbe928147f3b);
DB_PLA_TavernFloors(S_PLA_Tavern_Support3_52471f6d-8514-4168-96da-0f09b7a3b36f, S_PLA_Floor3_e8d5e5f9-90c6-423d-8d1c-73fbf3d08985);
PROC_TriggerRegisterForParty(S_PLA_TavernInvestigation_BurnDownTrigger_Inner_df11a25c-e374-499b-9993-47c44b9b84b0);
PROC_TriggerRegisterForParty(S_PLA_TavernInvestigation_BurnDownTrigger_Outer_9886da68-ca75-490c-a9ea-8198fbdeac1a);
DB_PLA_FlamingFistsOutsideDialog(PLA_FlamingFist5_68ff8388-74bc-9372-1be6-81ffe7d1acc7);
DB_PLA_FlamingFistsOutsideDialog(PLA_FlamingFist7_17e4c2ef-75ae-5951-81c8-aa0ef4321847);
DB_PLA_FlamingFistsOutsideDialog(PLA_FlamingFist8_8b84fbc5-db69-85a4-afd7-b2108150a832);
DB_Dialogs(S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae, PLA_FlamingFist5_68ff8388-74bc-9372-1be6-81ffe7d1acc7);
DB_Dialogs(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441, PLA_FlamingFist7_17e4c2ef-75ae-5951-81c8-aa0ef4321847);
DB_Dialogs(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, PLA_FlamingFist8_Dousing_b898eab7-e944-68fb-fc47-cd084f6394e1);
SetOnStage(PLA_PersistentFlame_003_f66d1256-dcd2-425d-a5e7-12b6245653ab, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire01_1e1efef8-e728-48fb-97ee-09c714e3b7ec, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire02_14e9c573-bade-4b3d-97cf-578d76ba61ec, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire03_f4a5b9b0-b19c-45cc-ae97-5b32723d98bd, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire04_c191f4ee-1830-41bc-8b1e-4d04cd44e341, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire05_27aff04a-b6e6-4983-9f19-af7fe3f8118f, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire06_0c076fe6-b588-4304-a6e4-5c33d81e840b, 0);
Use(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 1, 0, "");
TriggerRegisterForCharacter(S_PLA_StuckHalfElfRoom_c7cfc4f1-f740-49e8-b721-10574b6f1a76, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
TriggerRegisterForCharacter(S_PLA_StuckHalfElf_FreedTrigger_37541d1f-d461-4411-8704-af2e767908f5, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
TriggerRegisterForCharacter(S_PLA_Tavern_FlamingFist6Box_6e37cccf-f9dd-4053-81a0-2ad7f81e960f, S_PLA_FlamingFist6_0ba41cd1-e1f6-4f17-8e92-10ebef850268);
DB_PermaDefeatedEvent(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441, PLA_FlamingFist7_State_Permadefeated_d5b2c296-4543-4cf1-965f-b270c0dabf22);
SetHasDialog(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, 1);
DB_Inclusion_Object(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, PLA_StuckHalfElf_StartInclusion_94f71b80-ee91-4e1f-b754-c2d230a99b58, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_NPCDialog(PLA_Tavern_DeadCiv1_Dead_4840f358-407f-0fdb-352d-c1db600ed975, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
TriggerRegisterForItems(S_PLA_TavernInvestigation_DukeRoom_dd5b0510-6067-490f-8bb8-392a1a430a59);
DB_Dialogs(S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, PLA_Tavern_OxAlive_5a920f74-a41f-cb9f-b4ac-fac7e452703b);
DB_SpotPlayers(S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, "PLA_Tavern_Ox", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, "PLA_Tavern_Ox");
DB_HostileToPlayerGroupCancelFlag(PLA_Tavern_Event_CancelOxHostility_0254f6f1-88f7-4250-aa58-f9022b2cba40, Act1_PLA_Tavern_Ox_9312f73a-0272-43e3-a23f-b1e98c400d1c);
DB_SpotPlayers_SpotTrigger(S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, "PLA_Tavern_Ox", S_PLA_Tavern_OxBox_b995b68b-55aa-4fb9-906f-fa10417b3862);
TriggerRegisterForCharacter(S_PLA_StuckHalfElf_TavernBox_fc69dced-9f44-4760-9378-8598b4a9e859, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
TriggerRegisterForCharacter(S_PLA_FlamingFist8_CorpseBox_bdbbb67a-19ae-4fd6-86eb-eae30ce864d9, S_PLA_Tavern_DeadFF6_8c93ab9c-9717-4a89-a7df-afbb033436a7);
TriggerRegisterForCharacter(S_PLA_FlamingFist8Home_25d8f28d-fbf5-4971-bde0-b25cbdebeed1, S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
SetOnStage(S_PLA_StuckHalfElf_Dowry_Chest_d7368244-74f3-46f6-9198-d0dd81d72a78, 0);
DB_HasItemEvent(S_PLA_StuckHalfElf_Dowry_67cbd092-e206-4eff-8863-74894d8ccadb, PLA_StuckHalfElf_State_HasDowry_464445ee-74e3-4838-98dc-435074439303);
DB_GiveItemToEvent(S_PLA_StuckHalfElf_Dowry_67cbd092-e206-4eff-8863-74894d8ccadb, PLA_StuckHalfElf_Event_GiveDowry_636372fa-088a-4cdf-b34a-cd5fbaf5f89d);
DB_TavernInvestigation_HalfElfDoors(S_PLA_TavernInvestigation_RoomDoor_5b269eea-01eb-4e52-9566-b208c9019aea, S_PLA_StuckHalfElf_DoorSurge_f85209cc-6842-4807-b22d-2df79a447923);
DB_TavernInvestigation_HalfElfDoors(S_PLA_TavernInvestigation_RoomDoor2_f4ad4ed3-5906-47a4-b874-20c7c96780d0, S_PLA_StuckHalfElf_DoorSurge_000_d940de1a-b271-411c-ac67-c8607e7ada48);
DB_TavernInvestigation_HalfElfDoors(S_PLA_TavernInvestigation_RoomDoor3_9fff6aeb-8bd1-43bd-b215-ef218729e0b1, S_PLA_StuckHalfElf_DoorSurge_001_41b004bf-62b4-4000-ae5d-7435d9b685f0);
DB_QuestDef_State(PLA_TavernInvestigation_State_HalfElfFoundWife_6cd9377b-e300-4396-94d0-c537fd193a48, "PLA_StuckHalfElf", "ReachedWife");
DB_QuestDef_State(Act2_PointOfNoReturnReached_a3155f30-b8f3-4db5-ac21-d3036f4426e3, "PLA_StuckHalfElf", "ReachedNoReturn");
DB_KnowledgeCheckItem_AD("PLA_StuckHalfElf_HayStack", S_PLA_StuckHalfElf_Dowry_HayStack_6852a1ef-7e0e-463c-832d-647561700528, "Perception", DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539, PLA_StuckHalfElf_PAD_FoundChest_979c2e3c-9fed-930b-cadc-4014f5a86ce2, PLA_StuckHalfElf_Event_FoundChestInHay_90956a72-6a92-47d1-a3e5-a65e142afafc);
PROC_SetCorpseOwner(S_PLA_Tavern_DeadFF6_8c93ab9c-9717-4a89-a7df-afbb033436a7, S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
DB_QuestDef_State(PLA_Tavern_State_OxPacified_cc948928-15b4-2dd1-5fe4-11b5fa79d78f, "HIDDEN_WLD_Boosters", "PLA_Tavern_CalmedOx");
PROC_SelfHealing_Disable(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
DB_IgnoreMutingStatussesDialog(PLA_StuckHalfElf_AD_TooHeavy_c966db8b-1882-4c70-06fa-9eb500d0d850);
DB_BookFlags(S_PLA_Tavern_DeadFF5Letter_d56310f5-be71-4e64-8ec9-2ba97beb98d8, PLA_Tavern_DeadFF5_State_ReadLetter_7b834854-a612-4333-903c-48a2179bf8ab);

KBSECTION
IF
AddedTo(ITEMGUID_S_PLA_Tavern_DeadDrow1Armor_f781e07e-9c02-433a-adc3-209128118378, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_Tavern_VB_DeadDrow1Armor", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_Tavern_CheckDrowArmourIdentification();
StartVoiceBark(VOICEBARKRESOURCEGUID_PLA_Tavern_VB_DeadDrow1Armor_96d57486-140f-34e7-de84-f38418f5cb5d, _Var1);

PROC
PROC_PLA_Tavern_CheckDrowArmourIdentification()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
CalculatePassiveSkill(_Var1, "History", _Var2, _Var1, _Var1)
AND
_Var2 >= 15
THEN
SetFlag(PLA_Tavern_Knows_DrowArmour_26eacf55-a0eb-4188-bb40-78f912d211ee, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_Tavern_CheckDrowArmourIdentification()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var1, REALLY_UNDERDARK_2d0a73b9-f113-4d35-bdee-a31ab9163d74, 1, _Var1, _Var1)
AND
CalculatePassiveSkill(_Var1, "History", _Var2, _Var1, _Var1)
AND
_Var2 >= 10
THEN
SetFlag(PLA_Tavern_Knows_DrowArmour_26eacf55-a0eb-4188-bb40-78f912d211ee, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_Tavern_CheckDrowArmourIdentification()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var1, REALLY_DROWELF_676e854b-d74b-44f3-8363-3ef27164a54d, 1, _Var1, _Var1)
THEN
SetFlag(PLA_Tavern_Knows_DrowArmour_26eacf55-a0eb-4188-bb40-78f912d211ee, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_Tavern_CheckDrowArmourIdentification()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var1, REALLY_DROWELF_676e854b-d74b-44f3-8363-3ef27164a54d, 1, _Var1, _Var1)
THEN
SetFlag(PLA_Tavern_Knows_DrowArmour_26eacf55-a0eb-4188-bb40-78f912d211ee, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DestroyingBy(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, _, _, _, _)
AND
QRY_OnlyOnce("PLA_Tavern_StartCollapse", _, _, _, _)
THEN
PROC_PLA_Tavern_StartCollapse();

IF
TemplateOpening(_, (ITEM)_Var2, _, _, _)
AND
DB_TavernInvestigation_HalfElfDoors(_Var2, _, _, _, _)
AND
QRY_OnlyOnce("PLA_Tavern_StartCollapse", _, _, _, _)
THEN
PROC_PLA_Tavern_StartCollapse();

IF
DB_Destroyed(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_TavernInvestigation_HalfElfDoors(_Var1, _, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_Tavern_StartCollapse", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_Tavern_StartCollapse();

IF
EnteredTrigger((CHARACTER)_Var1, S_PLA_Tavern_StartCollapse_9243881a-3da1-449e-9834-bd8113290897, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, _Var1, _Var1, _Var1, _Var1)
AND
IsPartyMember(_Var1, 1, 1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_Tavern_StartCollapse", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_Tavern_StartCollapse();

IF
TextEvent("PLA_Tavern_TestBackdraft", _, _, _, _)
THEN
SetEntityEvent(S_PLA_StuckHalfElf_DoorSurge_f85209cc-6842-4807-b22d-2df79a447923, "PLA_StuckHalfElf_Backdraft");

PROC
PROC_PLA_Tavern_StartCollapse()
AND
DB_TavernInvestigation_HalfElfDoors(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_PLA_Tavern_DoorIsOpen(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var2, "PLA_StuckHalfElf_Backdraft");

QRY
QRY_PLA_Tavern_DoorIsOpen(S_PLA_TavernInvestigation_RoomDoor_5b269eea-01eb-4e52-9566-b208c9019aea, _, _, _, _)
AND
IsClosed(S_PLA_TavernInvestigation_RoomDoor_5b269eea-01eb-4e52-9566-b208c9019aea, 0, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_PLA_Tavern_DoorIsOpen((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Destroyed(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_PLA_Tavern_StartCollapse()
THEN
SetOnStage(PLA_PersistentFlame_003_f66d1256-dcd2-425d-a5e7-12b6245653ab, 1);
CreateSurface(S_PLA_TavernInvestigation_CollapseStartPoint_47f7878f-88fe-4720-ac5d-d6071359af14, "SurfaceFire", 3, -1);
SetOnStage(S_PLA_StuckHalfElf_HazardFire01_1e1efef8-e728-48fb-97ee-09c714e3b7ec, 1);
SetOnStage(S_PLA_StuckHalfElf_HazardFire02_14e9c573-bade-4b3d-97cf-578d76ba61ec, 1);
SetOnStage(S_PLA_StuckHalfElf_HazardFire03_f4a5b9b0-b19c-45cc-ae97-5b32723d98bd, 1);
SetOnStage(S_PLA_StuckHalfElf_HazardFire04_c191f4ee-1830-41bc-8b1e-4d04cd44e341, 1);
SetOnStage(S_PLA_StuckHalfElf_HazardFire05_27aff04a-b6e6-4983-9f19-af7fe3f8118f, 1);
SetOnStage(S_PLA_StuckHalfElf_HazardFire06_0c076fe6-b588-4304-a6e4-5c33d81e840b, 1);
SetFlag(PLA_StuckHalfElf_State_FireStarted_2785238e-5a98-4b39-b668-f26885a8db8d, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_RemoveOneShotVoiceBarkTrigger(S_PLA_StuckHalfElf_VB_Door_cd74de97-21a4-4158-ae3a-b4706ec2165b, PLA_StuckHalfElf_VB_Door_3633542e-1622-ff65-a29f-60ea8ee3d36a);
PROC_RemoveOneShotVoiceBarkTrigger(S_PLA_Tavern_VB_House_05dae15b-885a-4ccc-b958-d7e1450db526, PLA_Tavern_VB_House_addce811-7f32-3cf5-5d3d-ff335f63f6ba);

IF
DB_PLA_TavernFloors(_Var1, _, _Var1, _Var1, _Var1)
THEN
SetHitpoints(_Var1, 20);

IF
DestroyingBy((GUIDSTRING)_Var1, _, _, _, (GUIDSTRING)_Var1)
AND
DB_PLA_TavernFloors(_Var1, _Var5, _Var1, _Var1, _Var1)
THEN
DestroyPlatform(_Var5);

IF
DestroyedBy(S_PLA_Tavern_Support1_24e8985e-0557-4b27-a7b4-914f0188f1ae, _, _, _, (CHARACTER)_)
THEN
Die(S_PLA_Tavern_Support2_9a6bce5e-9bf4-4656-834f-40740061f2fb, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 1);

IF
DestroyedBy(S_PLA_Tavern_Support2_9a6bce5e-9bf4-4656-834f-40740061f2fb, _, _, _, (CHARACTER)_)
THEN
Die(S_PLA_Tavern_Support1_24e8985e-0557-4b27-a7b4-914f0188f1ae, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 1);

IF
UseStarted(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, _, _, _)
THEN
ApplyStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "GROUNDED", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_PLA_StuckHalfElf_CanStartDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetSurfaceGroundAt(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 != "SurfaceFire"
AND
GetSurfaceGroundAt(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
_Var3 != "SurfaceFire"
AND
HasActiveStatus(_Var1, "BURNING", 0, _Var1, _Var1)
AND
HasActiveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "BURNING", 0, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
HasActiveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", 1, _Var1, _Var1)
AND
QRY_PLA_StuckHalfElf_CanStartDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(PLA_StuckHalfElf_88c9f41a-cce8-fc12-8a36-1e9574be588d, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
HasActiveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", 1, _Var1, _Var1)
AND NOT
DB_SelectedDialog(PLA_StuckHalfElf_88c9f41a-cce8-fc12-8a36-1e9574be588d, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(PLA_StuckHalfElf_AD_fd8a9193-0d8f-670d-76e6-a42039861d3d, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);

IF
DialogStarted(PLA_StuckHalfElf_88c9f41a-cce8-fc12-8a36-1e9574be588d, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_StuckHalfElf_FTB", _Var1, _Var1, _Var1, _Var1)
THEN
ForceTurnBasedMode(_Var2, 1);

IF
DialogStarted(PLA_StuckHalfElf_TryJoinParty_78248a7c-2182-3bae-bbd9-d57e2a9a29ec, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_StuckHalfElf_FTB", _Var1, _Var1, _Var1, _Var1)
THEN
ForceTurnBasedMode(_Var2, 1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, _Var1, _Var1)
AND
QRY_PLA_StuckHalfElf_CanStartDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SelectAndStartDialog(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, _Var1, _Var1)
AND NOT
QRY_PLA_StuckHalfElf_CanStartDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_StuckHalfElfRubble_OutOfDialogFallback(_Var1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, _Var1, _Var1)
AND
GetFlag(PLA_StuckHalfElf_State_Failed_274d7b42-175b-bfb0-f697-fb98863aa89c, _Var1, 1, _Var1, _Var1)
THEN
PROC_TryStartAD(PLA_StuckHalfElf_AD_TooHeavy_c966db8b-1882-4c70-06fa-9eb500d0d850, _Var1);
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, _Var1, _Var1)
THEN
PROC_PLA_StuckHalfElfRubble_OutOfDialogFallback(_Var1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0);

PROC
PROC_PLA_StuckHalfElfRubble_OutOfDialogFallback((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(PLA_StuckHalfElf_State_Failed_274d7b42-175b-bfb0-f697-fb98863aa89c, _Var1, 0, _Var1, _Var1)
THEN
RequestActiveRoll(_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, "RawAbility", "Strength", DC_Legacy_10_625be976-7a67-4394-97c8-14c69715ae4b, 0, "PLA_TavernInvestigation_StuckHalfElfMove");

PROC
PROC_PLA_StuckHalfElfRubble_OutOfDialogFallback((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(PLA_StuckHalfElf_State_Failed_274d7b42-175b-bfb0-f697-fb98863aa89c, _Var1, 1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(PLA_StuckHalfElf_AD_TooHeavy_c966db8b-1882-4c70-06fa-9eb500d0d850, _Var1);

IF
RollResult("PLA_TavernInvestigation_StuckHalfElfMove", (CHARACTER)_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 1, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Destroyed(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, _Var1, _Var1, _Var1, _Var1)
THEN
Die(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, _Var1, 0, 0, 2);

IF
RollResult("PLA_TavernInvestigation_StuckHalfElfMove", (CHARACTER)_Var1, S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_TryStartAD(PLA_StuckHalfElf_AD_TooHeavy_c966db8b-1882-4c70-06fa-9eb500d0d850, _Var1);

IF
DB_CantTalk(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, _, _, _)
AND NOT
DB_Destroyed(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, _, _, _, _)
THEN
DB_PLA_StuckHalfElf_RubbleUnavailable(1);
SetCanInteract(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0);

IF
DB_Destroyed(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, _, _, _, _)
AND
DB_PLA_StuckHalfElf_RubbleUnavailable(1, _, _, _, _)
THEN
NOT DB_PLA_StuckHalfElf_RubbleUnavailable(1);

IF
DB_PLA_StuckHalfElf_RubbleUnavailable(1, _, _, _, _)
AND NOT
DB_CantTalk(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, _, _, _)
THEN
NOT DB_PLA_StuckHalfElf_RubbleUnavailable(1);
SetCanInteract(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 1);

IF
DestroyingBy(S_PLA_TavernInvestigation_RoomDoor3_9fff6aeb-8bd1-43bd-b215-ef218729e0b1, _, _, _, (CHARACTER)_)
THEN
SetFlag(PLA_StuckHalfElf_State_Door3Destroyed_f7810ae8-56f1-4084-9aa7-45aee41fdf5f, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_BurnDownTavern()
AND
HasActiveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", 1, _, _)
THEN
Die(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
DialogEnded(PLA_StuckHalfElf_88c9f41a-cce8-fc12-8a36-1e9574be588d, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetFlag(PLA_StuckHalfElf_Event_Free_48093e85-4d7d-2ded-75f4-a29560e39f5c, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, 1, _Var1, _Var1)
THEN
Die(S_PLA_TrappedDwarfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 0);

IF
DestroyedBy(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, (CHARACTER)_Var1, _, _, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_StuckHalfElf_DestroyedRubble(_Var1, _Var1);

IF
DestroyedBy(S_PLA_StuckHalfElfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, (CHARACTER)_Var1, _, _, (CHARACTER)_Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsCharacter(_Var1, 1, _Var1, _Var1, _Var1)
AND
CharacterGetOwner(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
DB_Players(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_StuckHalfElf_DestroyedRubble(_Var1, _Var4);

IF
FlagSet(PLA_StuckHalfElf_Event_AddToParty_691762e6-29d0-2119-b6b5-5a84e0d48a58, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, 1, _, _)
THEN
AddPartyFollower(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var3);

IF
StatusRemoved(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "GROUNDED");
SetFlag(PLA_StuckHalfElf_State_Freed_b45d2b7b-a865-4612-8138-e19c7ae17044, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_RemoveDialog(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
DB_AD_Dialog(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, PLA_StuckHalfElf_AD_Escaping_d5cff3c5-0e9d-13a0-cd40-d08b7c89b790);

IF
StatusRemoved(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1)
AND
DB_CurrentLevel("WLD_Main_A", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_StuckHalfElf_State_Door3Destroyed_f7810ae8-56f1-4084-9aa7-45aee41fdf5f, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_StuckHalfElf_AddToParty();

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND
DB_GlobalFlag(PLA_StuckHalfElf_Event_AddToParty_691762e6-29d0-2119-b6b5-5a84e0d48a58, _, _, _, _)
THEN
DB_PLA_StuckHalfElf_AddToPartyHandled(1);

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND
DB_GlobalFlag(PLA_StuckHalfElf_State_DoNotAddToParty_a95f92c5-1753-2b16-b105-a4b3cba09212, _, _, _, _)
THEN
DB_PLA_StuckHalfElf_AddToPartyHandled(1);

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND NOT
DB_PLA_StuckHalfElf_AddToPartyHandled(1, _, _, _, _)
AND
DB_PLA_StuckHalfElf_DestroyedRubble(_Var1, _, _Var1, _Var1, _Var1)
AND
Exists(_Var1, 1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var1, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728, 1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(PLA_StuckHalfElf_TryJoinParty_78248a7c-2182-3bae-bbd9-d57e2a9a29ec, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
THEN
DB_PLA_StuckHalfElf_AddToPartyHandled(1);

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND NOT
DB_PLA_StuckHalfElf_AddToPartyHandled(1, _, _, _, _)
AND
DB_PLA_StuckHalfElf_DestroyedRubble(_, _Var2, _, _, _)
AND NOT
DB_Players(_Var2, _, _, _, _)
AND
QRY_IsPartyMember(_Var2, 1, _, _, _)
AND
CharacterGetOwner(_Var2, _Var3, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var3, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, _, _)
AND
IsInTrigger(_Var3, S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728, 1, _, _)
AND NOT
DB_HiddenCharacters(_Var3, _, _, _, _)
AND
QRY_StartDialog(PLA_StuckHalfElf_TryJoinParty_78248a7c-2182-3bae-bbd9-d57e2a9a29ec, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var3, _, _)
THEN
DB_PLA_StuckHalfElf_AddToPartyHandled(1);

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_StuckHalfElf_AddToPartyHandled(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var1, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728, 1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(PLA_StuckHalfElf_TryJoinParty_78248a7c-2182-3bae-bbd9-d57e2a9a29ec, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
THEN
DB_PLA_StuckHalfElf_AddToPartyHandled(1);

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_StuckHalfElf_AddToPartyHandled(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728, 1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "Freed1");
AddPartyFollower(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1);
DB_PLA_StuckHalfElf_AddToPartyHandled(1);

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_StuckHalfElf_AddToPartyHandled(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728, 1, _Var1, _Var1)
AND
CharacterGetOwner(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "Freed1");
AddPartyFollower(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var3);
DB_PLA_StuckHalfElf_AddToPartyHandled(1);

PROC
PROC_PLA_StuckHalfElf_AddToParty()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_StuckHalfElf_AddToPartyHandled(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_StuckHalfElf_AddToPartyHandled(1);
QuestUpdate(_Var1, "PLA_StuckHalfElf", "Freed2");

IF
LeftTrigger(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElf_TavernBox_fc69dced-9f44-4760-9378-8598b4a9e859, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
CharacterGetOwner(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1, _Var1)
THEN
RemovePartyFollower(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1);

IF
LeftTrigger(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElf_TavernBox_fc69dced-9f44-4760-9378-8598b4a9e859, _, _, _)
THEN
PROC_SelfHealing_Enable(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);

IF
DestroyingBy(S_PLA_TrappedDwarfRubble_f67f111e-160e-4050-ba9e-a16d034f7434, _, _, _, _)
AND
HasActiveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", 1, _, _)
THEN
RemoveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM");

IF
EnteredTrigger(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElf_FreedTrigger_37541d1f-d461-4411-8704-af2e767908f5, _, _, _)
AND
QRY_OnlyOnce("PLA_StuckHalfElf_AD_Rescued", _, _, _, _)
THEN
PROC_TryStartAD(PLA_StuckHalfElf_AD_Rescued_4256d35a-3e7c-17c6-8ce8-9957cc8bb160, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);

IF
EnteredTrigger(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElf_FreedTrigger_37541d1f-d461-4411-8704-af2e767908f5, _, _, _)
AND
DB_CurrentLevel("WLD_Main_A", _, _, _, _)
THEN
PROC_RemoveNPCADs(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
DB_Dialogs(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, PLA_StuckHalfElf_Freed_f8ad3437-e419-38c5-8237-d81c1a83de77);

IF
RemovedFrom(_, S_PLA_TavernInvestigation_DukesRiches_003cce23-b6ac-4442-a968-cd3430cb150c, _, _, _)
AND NOT
DB_OnlyOnce("PLA_TryBurnDownTavern", _, _, _, _)
THEN
SetFlag(PLA_Tavern_State_LootedDukeRiches_9bda8056-49e2-4e85-9125-a551ce00c32b, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
ItemLeftTrigger(S_PLA_TavernInvestigation_DukesRiches_003cce23-b6ac-4442-a968-cd3430cb150c, S_PLA_TavernInvestigation_DukeRoom_dd5b0510-6067-490f-8bb8-392a1a430a59, _, _, _)
AND NOT
DB_OnlyOnce("PLA_TryBurnDownTavern", _, _, _, _)
THEN
SetFlag(PLA_Tavern_State_LootedDukeRiches_9bda8056-49e2-4e85-9125-a551ce00c32b, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
Saw(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_Tavern_DeadCiv1_1ed658d0-e88a-4b7b-ab9e-1e520ae7d0c7, _, (INTEGER)_, (INTEGER)_)
THEN
PROC_SetCorpseOwner(S_PLA_Tavern_DeadCiv1_1ed658d0-e88a-4b7b-ab9e-1e520ae7d0c7, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
SetFlag(PLA_TavernInvestigation_State_HalfElfFoundWife_6cd9377b-e300-4396-94d0-c537fd193a48, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_StateSet_Defeated(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
CharacterGetOwner(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1, _Var1)
THEN
RemovePartyFollower(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1);

IF
CharacterLootedCharacter((CHARACTER)_Var1, S_PLA_Tavern_DeadCiv1_1ed658d0-e88a-4b7b-ab9e-1e520ae7d0c7, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("PLA_StuckHalfElf_PAD_FoundWife", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_DeadCiv1_Knows_Seen_114d5031-e195-4575-9197-8d3cda728a3f, _Var1, 0, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_StuckHalfElf", "LearnedWife", 1, _Var1)
AND
QRY_StartDialog(PLA_StuckHalfElf_PAD_FoundWife_28f0cce2-136e-266f-6fcd-aa32a288283f, _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("PLA_StuckHalfElf_PAD_FoundWife");

IF
CharacterLootedCharacter((GUIDSTRING)_Var1, S_PLA_Tavern_DeadCiv1_1ed658d0-e88a-4b7b-ab9e-1e520ae7d0c7, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
IsPartyMember(_Var1, 1, 1, _Var1, _Var1)
THEN
SetFlag(PLA_DeadCiv1_Knows_Seen_114d5031-e195-4575-9197-8d3cda728a3f, _Var1, 0);

IF
FlagSet(PLA_DeadCiv1_Knows_Seen_114d5031-e195-4575-9197-8d3cda728a3f, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_StuckHalfElf", "LearnedWife", 1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "FoundWife");

IF
QuestUpdateUnlocked((CHARACTER)_Var1, "PLA_StuckHalfElf", "LearnedWife", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(PLA_DeadCiv1_Knows_Seen_114d5031-e195-4575-9197-8d3cda728a3f, _Var1, 1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "FoundWife");

IF
FlagSet(PLA_StuckHalfElf_State_HeadingToWife_3eb6d0dd-cb93-cc29-f6e5-bbb7a9b27aea, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, (INTEGER)_, (INTEGER)_)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
DB_AD_Dialog(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, PLA_StuckHalfElf_AD_ToWife_8ce5ce8e-1a1d-ee8e-9505-7129ae6eaa0a);
TriggerRegisterForCharacter(S_PLA_StuckHalfElf_NearWifeCorpse_cd059bea-aaef-48a5-94c7-2ba01ed91bc9, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);

IF
EnteredTrigger(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElf_NearWifeCorpse_cd059bea-aaef-48a5-94c7-2ba01ed91bc9, _, _, _)
THEN
TriggerUnregisterForCharacter(S_PLA_StuckHalfElf_NearWifeCorpse_cd059bea-aaef-48a5-94c7-2ba01ed91bc9, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
SetFlag(PLA_StuckHalfElf_State_ReachedWifeBox_985da4c2-f0fa-e104-bced-c6371c25d4a9, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, 0);

IF
FlagSet(PLA_TavernInvestigation_State_HalfElfFoundWife_6cd9377b-e300-4396-94d0-c537fd193a48, _, _, _, _)
AND
GetFlag(PLA_StuckHalfElf_State_HeadingToWife_3eb6d0dd-cb93-cc29-f6e5-bbb7a9b27aea, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, 1, _, _)
THEN
PROC_RemoveNPCADs(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
DB_Dialogs(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, PLA_StuckHalfElf_Freed_f8ad3437-e419-38c5-8237-d81c1a83de77);

IF
StatusApplied((GUIDSTRING)_Var1, "BURNING", _, _, (GUIDSTRING)_Var1)
AND
DB_InteractiveDialogSpeaker(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogName(PLA_StuckHalfElf_88c9f41a-cce8-fc12-8a36-1e9574be588d, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);

PROC
PROC_GLO_KnowledgeCheckSuccess(_, "PLA_StuckHalfElf_HayStack", _, (CHARACTER)_, (CHARACTER)_)
THEN
SetOnStage(S_PLA_StuckHalfElf_Dowry_Chest_d7368244-74f3-46f6-9198-d0dd81d72a78, 1);
ItemDragTo(S_PLA_StuckHalfElf_Dowry_Chest_d7368244-74f3-46f6-9198-d0dd81d72a78, S_PLA_StuckHalfElf_Dowry_Trigger_7569fdd6-0eae-4e03-8b74-1cdf38292c69);
SetCanInteract(S_PLA_StuckHalfElf_Dowry_HayStack_6852a1ef-7e0e-463c-832d-647561700528, 0);

QRY
QRY_GLO_SkillCheck_CheckAdvantage((CHARACTER)_Var1, S_PLA_StuckHalfElf_Dowry_HayStack_6852a1ef-7e0e-463c-832d-647561700528, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_StuckHalfElf", "KnowDowry", 1, _Var1)
THEN
DB_QRYRTN_GLO_Skillcheck_CheckAdvantage(2);

IF
EnteredTrigger((CHARACTER)_Var1, S_PLA_Tavern_StartCollapse_9243881a-3da1-449e-9834-bd8113290897, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("PLA_StuckHalfElf_Start", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, "PLA_PINNEDUNDERBEAM", 1, _Var1, _Var1)
AND
IsPartyMember(_Var1, 1, 1, _Var1, _Var1)
THEN
DB_OnlyOnce("PLA_StuckHalfElf_Start");
QuestUpdate(_Var1, "PLA_StuckHalfElf", "Start");

IF
DB_PermaDefeated(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, _, _, _)
AND NOT
DB_Dead(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, _, _, _)
AND
DB_Sees(_Var1, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_StuckHalfElf_Dead", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "Defeated");

IF
DB_Dead(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var1, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_StuckHalfElf_Dead", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "Dead");

IF
DB_InRegion(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, S_PLA_StuckHalfElf_FreedTrigger_37541d1f-d461-4411-8704-af2e767908f5, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var1, S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("PLA_StuckHalfElf_Safe", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "Safe");

IF
QuestUpdateUnlocked((CHARACTER)_Var1, "PLA_StuckHalfElf", "KnowDowry", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(PLA_StuckHalfElf_State_HasDowry_464445ee-74e3-4838-98dc-435074439303, _Var1, 1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "DowryGold");

IF
QuestUpdateUnlocked((CHARACTER)_Var1, "PLA_StuckHalfElf", "KnowDowry_Benryn", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(PLA_StuckHalfElf_State_HasDowry_464445ee-74e3-4838-98dc-435074439303, _Var1, 1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "DowryGold");

IF
FlagSet(PLA_StuckHalfElf_State_HasDowry_464445ee-74e3-4838-98dc-435074439303, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_StuckHalfElf", "KnowDowry", 1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "DowryGold");

IF
FlagSet(PLA_StuckHalfElf_State_HasDowry_464445ee-74e3-4838-98dc-435074439303, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_StuckHalfElf", "KnowDowry_Benryn", 1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_StuckHalfElf", "DowryGold");

IF
FlagSet(GLO_SpeakWithDead_State_QuestionsLimitReached_01c40268-4a8d-4787-8566-77e01ff04762, S_PLA_Tavern_DeadCiv1_1ed658d0-e88a-4b7b-ab9e-1e520ae7d0c7, _, _, _)
AND
QuestUpdateIsUnlocked(NULL_00000000-0000-0000-0000-000000000000, "PLA_StuckHalfElf", "KnowDowry", 0, _)
THEN
SetFlag(PLA_StuckHalfElf_State_WifeCantAnswer_c0f175fd-724b-4207-af19-4727f3784ad5, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogEnded(PLA_Tavern_DeadCiv1_Dead_4840f358-407f-0fdb-352d-c1db600ed975, _, _, _, _)
AND
QuestUpdateIsUnlocked(NULL_00000000-0000-0000-0000-000000000000, "PLA_StuckHalfElf", "KnowDowry", 0, _)
THEN
SetFlag(PLA_StuckHalfElf_State_WifeCantAnswer_c0f175fd-724b-4207-af19-4727f3784ad5, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(PLA_StuckHalfElf_Knows_ExplainedDowry_964ce6a1-bc82-0892-5e94-9dbd27054a38, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
THEN
QuestUpdate(_Var3, "PLA_StuckHalfElf", "KnowDowry_Benryn");

IF
DB_InRegion(_Var1, S_PLA_TavernInvestigation_BurnDownTrigger_Inner_df11a25c-e374-499b-9993-47c44b9b84b0, _Var1, _Var1, _Var1)
THEN
DB_PLA_TavernInvestigation_PrimeForFire(1);
PROC_TriggerUnregisterForParty(S_PLA_TavernInvestigation_BurnDownTrigger_Inner_df11a25c-e374-499b-9993-47c44b9b84b0);
PROC_GlobalSetFlagAndCache(PLA_Tavern_Knows_Burning_f1d6e5cf-e8d4-4095-a6ef-17dfcd4521b0);

IF
DB_PLA_TavernInvestigation_PrimeForFire(1, _, _, _, _)
AND NOT
DB_InRegion(_, S_PLA_TavernInvestigation_BurnDownTrigger_Inner_df11a25c-e374-499b-9993-47c44b9b84b0, _, _, _)
AND NOT
DB_InRegion(_, S_PLA_TavernInvestigation_BurnDownTrigger_Outer_9886da68-ca75-490c-a9ea-8198fbdeac1a, _, _, _)
THEN
PROC_PLA_TryBurnDownTavern();

PROC
PROC_LongRest()
AND
DB_PLA_TavernInvestigation_PrimeForFire(1, _, _, _, _)
THEN
PROC_PLA_TryBurnDownTavern();

PROC
PROC_LevelUnloading("WLD_Main_A", _, _, _, _)
THEN
PROC_PLA_TryBurnDownTavern();

IF
DB_PLA_FlamingFistsOutsideDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_FlagReactionAfterDialog(PLA_FlamingFists_Knows_ZhentDungeon_6226a6b7-2d34-99c3-c81c-bcd7795c228a, _Var1);

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Var1, PLA_FlamingFists_Knows_ZhentDungeon_6226a6b7-2d34-99c3-c81c-bcd7795c228a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "PLA_FlamingFists_VB_ToldOfZhentDungeon", _Var1, _Var1, _Var1)
THEN
StartVoiceBark(PLA_FlamingFists_VB_ToldOfZhentDungeon_a6c8a2bd-1b2f-675a-8c05-8644ad95f07c, _Var1);

PROC
PROC_DialogFlagSetup(PLA_Tavern_OxAlive_5a920f74-a41f-cb9f-b4ac-fac7e452703b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_PLA_Ox_BlockSpotReaction(1);

IF
DialogEnded(PLA_Tavern_OxAlive_5a920f74-a41f-cb9f-b4ac-fac7e452703b, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
NOT DB_PLA_Ox_BlockSpotReaction(1);

PROC
PROC_SpotPlayers_Spotted(S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, "PLA_Tavern_Ox", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PLA_Ox_BlockSpotReaction(1, _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, 0, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(PLA_Tavern_OxAlive_5a920f74-a41f-cb9f-b4ac-fac7e452703b, S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(PLA_Tavern_OxAlive_AD_5f15ffec-ab1f-2288-547c-9071d5a0d092, S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(PLA_Tavern_OxAlive_AD_5f15ffec-ab1f-2288-547c-9071d5a0d092, S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c);
DB_HostileToPlayerGroup(Act1_PLA_Tavern_Ox_9312f73a-0272-43e3-a23f-b1e98c400d1c, _Var1);

IF
AutomatedDialogStarted(PLA_Tavern_OxAlive_AD_5f15ffec-ab1f-2288-547c-9071d5a0d092, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
DB_HostileToPlayerGroup(Act1_PLA_Tavern_Ox_9312f73a-0272-43e3-a23f-b1e98c400d1c, _Var2);

IF
FlagSet(PLA_Tavern_State_OxPacified_cc948928-15b4-2dd1-5fe4-11b5fa79d78f, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SpotPlayers_StopSpotting(S_PLA_Tavern_OxAlive_c69aa4c1-bac2-401f-b4ec-cce8d545ba7c, "PLA_Tavern_Ox");

IF
DB_GlobalFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, _, _, _, _)
AND
DB_InRegion(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, S_PLA_FlamingFist8Home_25d8f28d-fbf5-4971-bde0-b25cbdebeed1, _, _, _)
AND
IsInTrigger(S_PLA_Tavern_DeadFF6_8c93ab9c-9717-4a89-a7df-afbb033436a7, S_PLA_FlamingFist8_CorpseBox_bdbbb67a-19ae-4fd6-86eb-eae30ce864d9, 1, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
DB_Dialogs(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, PLA_FlamingFist8_8b84fbc5-db69-85a4-afd7-b2108150a832);

IF
EnteredTrigger(S_PLA_Tavern_DeadFF6_8c93ab9c-9717-4a89-a7df-afbb033436a7, S_PLA_FlamingFist8_CorpseBox_bdbbb67a-19ae-4fd6-86eb-eae30ce864d9, _, _, _)
AND
DB_GlobalFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, _, _, _, _)
AND
DB_InRegion(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, S_PLA_FlamingFist8Home_25d8f28d-fbf5-4971-bde0-b25cbdebeed1, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
DB_Dialogs(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, PLA_FlamingFist8_8b84fbc5-db69-85a4-afd7-b2108150a832);

IF
DB_GlobalFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, _, _, _, _)
AND NOT
DB_InRegion(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, S_PLA_FlamingFist8Home_25d8f28d-fbf5-4971-bde0-b25cbdebeed1, _, _, _)
AND NOT
DB_PermaDefeated(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, _, _, _, _)
AND NOT
DB_Dialogs(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, PLA_FlamingFist8_AwayFromCorpse_767207ed-fd6f-910a-0665-739dc3e45724, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
DB_Dialogs(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, PLA_FlamingFist8_AwayFromCorpse_767207ed-fd6f-910a-0665-739dc3e45724);

IF
LeftTrigger(S_PLA_Tavern_DeadFF6_8c93ab9c-9717-4a89-a7df-afbb033436a7, S_PLA_FlamingFist8_CorpseBox_bdbbb67a-19ae-4fd6-86eb-eae30ce864d9, _, _, _)
AND
DB_GlobalFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, _, _, _, _)
AND NOT
DB_Dialogs(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, PLA_FlamingFist8_AwayFromCorpse_767207ed-fd6f-910a-0665-739dc3e45724, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
DB_Dialogs(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, PLA_FlamingFist8_AwayFromCorpse_767207ed-fd6f-910a-0665-739dc3e45724);

IF
EntityEvent((GUIDSTRING)_Var1, "PLA_Tavern_ReadyForDisappear", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_DisappearOutOfSightTo(_Var1, S_PLA_Tavern_DisappearToPoint_f296b506-c345-411f-b250-092a0ca16cdb, "Walk", 0, "");

IF
DB_OnlyOnce("PLA_StuckHalfElf_AD_Rescued", _, _, _, _)
AND
DB_Defeated(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _, _, _, _)
AND
QRY_OnlyOnce("PLA_TavernInvestigation_AllFreed", _, _, _, _)
THEN
TriggerSetSoundState(Amb_SV_Plains_FZ_000_9878e6ab-03c9-dca0-a345-193a021d1906, "Amb_SV_Plains_Caravanserai", "Saved", 1);

IF
DB_GlobalFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, _, _, _, _)
AND
DB_Defeated(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, _, _, _)
AND
QRY_OnlyOnce("PLA_TavernInvestigation_AllFreed", _, _, _, _)
THEN
TriggerSetSoundState(Amb_SV_Plains_FZ_000_9878e6ab-03c9-dca0-a345-193a021d1906, "Amb_SV_Plains_Caravanserai", "Saved", 1);

IF
DB_GlobalFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, _, _, _, _)
AND
DB_OnlyOnce("PLA_StuckHalfElf_AD_Rescued", _, _, _, _)
AND
QRY_OnlyOnce("PLA_TavernInvestigation_AllFreed", _, _, _, _)
THEN
TriggerSetSoundState(Amb_SV_Plains_FZ_000_9878e6ab-03c9-dca0-a345-193a021d1906, "Amb_SV_Plains_Caravanserai", "Saved", 1);

IF
DB_Defeated(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb, _, _, _, _)
AND
DB_Defeated(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _, _, _, _)
AND
QRY_OnlyOnce("PLA_TavernInvestigation_AllFreed", _, _, _, _)
THEN
TriggerSetSoundState(Amb_SV_Plains_FZ_000_9878e6ab-03c9-dca0-a345-193a021d1906, "Amb_SV_Plains_Caravanserai", "Saved", 1);

IF
DB_GlobalFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, _, _, _, _)
AND
DB_PLA_FlamingFist(_, _Var2, _, _, _)
AND NOT
DB_PermaDefeated(_Var2, _, _, _, _)
AND NOT
DB_InteractiveDialogSpeaker(_, _Var2, _, _, _)
AND NOT
DB_Is_InCombat(_Var2, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Var2);
PROC_DisappearOutOfSight(_Var2, "Walk", 1, "");


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
