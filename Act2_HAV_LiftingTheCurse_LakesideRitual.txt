Version 1
SubGoalCombiner SGC_AND

INITSECTION
PROC_DeclareCounter("HAV_LiftingTheCurse_TurnCount");
PROC_DeclareCounter("HAV_LiftingTheCurse_TetherDropped_TurnCount");
DB_HAV_LiftingTheCurse_ReactivityVBs(HAV_HalsinQuest_VB_WaveSpawned0_8308d5dc-108e-4a0c-b9b7-e9c0b763ee05, 0);
DB_HAV_LiftingTheCurse_ReactivityVBs(HAV_HalsinQuest_VB_WaveSpawned2_6f411e3a-3315-74c1-8b73-d026ab864789, 1);
DB_HAV_LiftingTheCurse_ReactivityVBs(HAV_HalsinQuest_VB_WaveSpawned3_b6dd47f8-988d-00d0-25c9-f6b87fcd8687, 2);
DB_HAV_LiftingTheCurse_ReactivityVBs(HAV_HalsinQuest_VB_WaveSpawned4_d80b8045-6a27-0478-6647-2cc284733fc5, 3);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave0_Wraith_001_d51f412c-8b40-4141-a65f-057a81d549fb, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave0_ShadowCursed_Warrior_Pilgrim_003_1a9b065b-d2cd-44c5-95e4-307d6bd82fe7, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave0_Shadow_007_7e722c07-0bd0-4091-aa5a-d7391404229a, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave0_Shadow_008_01e7cde6-a4df-403c-87c3-d5377682a6eb, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave0_Shadow_009_702751d5-1ac0-4399-b02e-972c7258e974, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave0_ShadowCursed_Warrior_Pilgrim_005_be15abb7-2ea6-4cf8-bf56-bd8465b570e3, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave0_ShadowCursed_Warrior_Pilgrim_006_2c25ec5b-c162-4579-9f1e-435fbdcfd6e3, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave4_ShadowMastiff_003_06c47934-bc30-48f0-b297-4f99272d1241, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave4_ShadowMastiff_004_06451f28-98fa-4ab9-9b6b-92edb5ceb9af, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave1_ShadowCursed_Ranger_Harper_005_5e59d1af-a2b7-43b7-8d6c-5a6439a129f6, 0);
DB_HAV_LiftingTheCurse_Waves(0, S_HAV_Wave1_ShadowCursed_Ranger_Harper_007_2112e248-7cbc-4db6-a629-34dd87dc2386, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave1_ShadowCursed_Ranger_Harper_004_9430b751-a5f9-40bc-888d-e3e8abe4dcf3, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_ShadowCursed_Warrior_Pilgrim_004_9f16d360-533a-43b2-8149-dc39632a4fed, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_ShadowCursed_Warrior_Pilgrim_007_e0d36900-5a00-4f11-b19b-74512d1554c8, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave1_ShadowCursed_Ranger_Harper_006_1108b8a5-0d22-4a0e-8973-37b0442f2070, 0);
DB_HAV_LiftingTheCurse_Waves(1, DarkVine_Tentacle_000_bb3e4ea7-7f7a-4c65-84c9-de788a2b3d7c, 0);
DB_HAV_LiftingTheCurse_Waves(1, DarkVine_Tentacle_001_abd0896f-555c-43a1-b9d1-71144ff7e87d, 0);
DB_HAV_LiftingTheCurse_Waves(1, DarkVine_Tentacle_002_c172ed73-4f81-4dbe-a577-0d5a56b42ffb, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave3_ShadowCursed_Melee_FlamingFist_007_66deff82-b495-489b-872a-4b544bc941bc, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave3_ShadowCursed_Melee_FlamingFist_005_da1e6ca1-6c54-4b82-b94a-901745d64f2e, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave3_ShadowCursed_Melee_FlamingFist_008_a410b3f0-f025-4fd1-8b90-d8c0d8fd21e6, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_007_2ad074e8-a5a4-452e-bcfe-7a946887a539, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_008_91b23b1d-0583-4118-81b6-a3f9c18e9fe8, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_009_2edb73bb-9831-44d3-bc6f-76b829e5d898, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_010_ddb92490-a75d-496e-9b8d-78dcf1f9fef3, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_011_77f588f6-e792-4b41-a61c-09bfe44d0bdc, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_012_1303ff46-5200-4986-9d73-d85ad7918ec5, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_013_fc6da3fd-f4d7-4ebf-b125-7d77387a746f, 0);
DB_HAV_LiftingTheCurse_Waves(1, S_HAV_Wave0_Raven_Dire_ShadowCursed_014_1e41607c-ed56-43bb-9bd2-98de3796d52a, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave1_ShadowCursed_Warrior_Zealot_005_7c4c46d9-6d0d-4e8a-8473-476eb071bd49, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave3_ShadowCursed_Melee_FlamingFist_004_1ede9b50-0b85-4a48-8872-738ddd1fc4cd, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave1_ShadowCursed_Warrior_Zealot_003_4337f668-9c2d-47cc-8530-b620109de1b4, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave2_Shadow_001_61dfdf61-6860-464a-8e38-bce3458846a7, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave3_ShadowCursed_Melee_FlamingFist_006_e81fbbc9-a2ec-40e4-800e-fe02acc4fc69, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave2_Wraith_001_98dde2d9-06c1-4cfd-83b9-a9d2338b514d, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave3_ShadowCursed_Warrior_Githyanki_005_7052676a-7ba6-442b-8e63-b9670e4384a9, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave3_ShadowCursed_Warrior_Githyanki_004_3ef3995a-a195-4982-987d-4cdf22b98235, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave3_ShadowCursed_Warrior_Githyanki_003_06fe050e-86f5-47f8-bda9-53d91b9f6fdf, 0);
DB_HAV_LiftingTheCurse_Waves(2, S_HAV_Wave1_ShadowCursed_Warrior_Zealot_004_f72a9c81-7fac-4bc2-a6ce-b775e3ea7721, 0);
PROC_HAV_LiftingTheCurse_ShadowsInit();
SetOnStage(S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a, 0);
DB_Dialogs(S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a, HAV_HalsinQuest_Spirit_85232c87-9912-7c37-c068-3196688f88b3);
DB_GlobalFlagReactionAfterDialog(HAV_LiftingTheCurse_State_ReachedPortal_9deedd00-3ffc-4b91-98ff-56aa4873c850, HAV_LiftingTheCurse_Portal_0eee8461-c736-e852-ff90-376d32b3823a);
PROC_TriggerRegisterForPlayers(S_HAV_TetherLeaveBounds_7ae97f8d-1809-4236-b8b2-d64ef1142f3c);
SetOnStage(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0);
SetCanExamine(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0);
DB_Combat_DifficultyItems(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, "HALSIN_SHADOWPORTAL_HARDCORE", "HARD");

KBSECTION
IF
TextEvent("HalsinLakeside", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GLO_LiftingTheCurse_Debug_HalsinAtLakeSide_89683244-0daf-4175-9808-2e87f1a4240b);
TeleportTo(_Var1, S_HAV_HalsinShorePoint_64c1cdf5-0a4c-462e-a9ea-71e5edc3031d, "", 0, 0, 0, 1, 1);
ApplyStatus(_Var1, "SCL_MOONSHIELD", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(GLO_LiftingTheCurse_Debug_HalsinAtLakeSide_89683244-0daf-4175-9808-2e87f1a4240b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GLO_LiftingTheCurse_Debug_HalsinSetUp("GLO_LiftingTheCurse_Debug_LakeSideRitual");

PROC
PROC_GLO_LiftingTheCurse_Debug_HalsinSetUp_State("GLO_LiftingTheCurse_Debug_LakeSideRitual", _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(GLO_LiftingTheCurse_Debug_HalsinAtLakeSide_89683244-0daf-4175-9808-2e87f1a4240b);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, HAV_HalsinQuest_Portal_0eee8461-c736-e852-ff90-376d32b3823a);
TeleportTo(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_HAV_HalsinShorePoint_64c1cdf5-0a4c-462e-a9ea-71e5edc3031d, "", 0, 0, 0, 1, 1);
SetOnStage(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1);
ApplyStatus(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "SCL_MOONSHIELD", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
PROC_State_Progress(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "SCL_LiftingTheCurse", "SCL_LiftingTheCurse_State_HalsinAtPortal");

IF
FlagSet(GLO_LiftingTheCurse_Debug_HalsinPostPortal_69608804-1ae8-467f-b3d9-a425d82beb17, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GLO_LiftingTheCurse_Debug_HalsinSetUp("GLO_LiftingTheCurse_Debug_PostRitual");

PROC
PROC_GLO_LiftingTheCurse_Debug_HalsinSetUp_State("GLO_LiftingTheCurse_Debug_PostRitual", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(SCL_ShadowCurse_Knows_Oliver_Is_Thaniel_56af8bbd-eafe-3861-22a2-c253f16952e2);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, HAV_HalsinQuest_PortalConclusion_c1112847-6f1b-2a3e-2807-4b0937b16a52);
TeleportTo(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_HAV_HalsinShorePoint_64c1cdf5-0a4c-462e-a9ea-71e5edc3031d, "", 0, 0, 0, 1, 1);
SetOnStage(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1);
PROC_Foop(S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a);
PROC_State_Progress(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "SCL_LiftingTheCurse", "SCL_LiftingTheCurse_State_HalsinAtPostPortal");

IF
DialogEnded(HAV_HalsinQuest_Portal_0eee8461-c736-e852-ff90-376d32b3823a, _, _, _, _)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_Debug_SkipLakeSideCombat_48201e5e-2683-458a-8fdd-cd5f0b2f56af, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61);
PROC_GlobalSetFlagAndCache(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3);

PROC
PROC_HAV_LiftingTheCurse_ShadowsInit()
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var2, _, _, _)
THEN
DB_GLO_DefeatCounter(_Var2, "HAV_LiftingTheCurse_Shadows");
SetOnStage(_Var2, 0);

IF
FlagSet(HAV_LiftingTheCurse_State_HalsinGoToLake_bc4cd1f7-5e60-40e1-a583-aa886fe5b682, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetHasDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 0);

IF
FlagSet(HAV_LiftingTheCurse_State_HalsinArrivedAtLake_78dc335f-ec52-4c22-8b3a-33705205c2a0, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "SCL_LiftingTheCurse", "SCL_LiftingTheCurse_State_HalsinAtPortal");
PROC_RemoveDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, HAV_HalsinQuest_Portal_0eee8461-c736-e852-ff90-376d32b3823a);
SetHasDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1);

IF
FlagSet(HAV_LiftingTheCurse_Event_PortalAppears_333d9c5e-501a-470d-9708-90b9d9b1ec01, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_Foop(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

IF
WentOnStage(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 1, _, _, _)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var2, _, _, _)
THEN
AiAddInterestingItem(_Var2, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

IF
DB_PermaDefeated(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var4, _, _Var1, _Var1)
AND
DB_Is_InCombat(_Var4, _Var2, _Var1, _Var1, _Var1)
AND
IsEnemy(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1, 0, _Var1, _Var1)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_DeathPAD", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(HAV_HalsinQuest_VB_HalsinDeath_f52dd9f7-22ec-9c3c-97c1-89368af1aa60, _Var1);

IF
FlagSet(HAV_LiftingTheCurse_State_ReachedPortal_9deedd00-3ffc-4b91-98ff-56aa4873c850, _, _, _, _)
AND
QRY_GetClosestAvailableCharacterTo(S_HAV_PortalPoint_520a70e1-f45b-42ef-9be6-0fc8d1a3d82b, 0, 0, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, 1, _, _, _, _)
AND
DB_ClosestAvailableCharacterTo(_Var3, S_HAV_PortalPoint_520a70e1-f45b-42ef-9be6-0fc8d1a3d82b, _Var4, _, _)
AND
_Var4 <= 30
THEN
StartVoiceBark(HAV_HalsinQuest_VB_HalsinReachedPortal_c80ca01b-903d-11b2-b36b-745c26b47355, _Var3);

IF
EnteredTrigger((CHARACTER)_Var1, S_ShadowCurse_SafeZone_Haven_f4f81c2b-5428-4d06-a65e-3ba21e105cba, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var1, _, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "HAV_SHIELDSHADOWBURN", 0, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "HAV_SHIELDSHADOWBURN", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
LeftTrigger((CHARACTER)_Var1, S_ShadowCurse_SafeZone_Haven_f4f81c2b-5428-4d06-a65e-3ba21e105cba, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var1, _, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "HAV_SHIELDSHADOWBURN", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "HAV_SHIELDSHADOWBURN", NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_HAV_IsRitualActive()
AND
DB_GlobalFlag(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_GlobalFlagReactionAfterDialog(HAV_LiftingTheCurse_State_ReachedPortal_9deedd00-3ffc-4b91-98ff-56aa4873c850, _, _, _, _)
THEN
PROC_State_Progress(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "SCL_LiftingTheCurse", "SCL_LiftingTheCurse_State_HalsinInShadowFell");
PROC_Poof(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
PROC_CharacterDisableAllCrimes(S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a, 1);

IF
DialogEnded(HAV_LiftingTheCurse_Portal_0eee8461-c736-e852-ff90-376d32b3823a, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_Debug_SkipLakeSideCombat_48201e5e-2683-458a-8fdd-cd5f0b2f56af, _, _, _, _)
THEN
PROC_HAV_LiftingTheCurse_SpawnWave(0);

IF
DialogEnded(HAV_LiftingTheCurse_Portal_0eee8461-c736-e852-ff90-376d32b3823a, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_Debug_SkipLakeSideCombat_48201e5e-2683-458a-8fdd-cd5f0b2f56af, _, _, _, _)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_StartedChanneling", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var1, _, _Var1, _Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var6, _, _Var1, _Var1)
AND
DB_Is_InCombat(_Var6, _Var8, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _Var8, _Var1, _Var1, _Var1)
THEN
SetCombatGroupAndEnterCombat(_Var1, "8e09a1fc-35e8-4c34-9ecf-089009cb1d80", S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

IF
EnteredCombat(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Avatars(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 <= 20
THEN
PROC_EnterCombat(_Var2, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

IF
EnteredCombat(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("HAV_LakesideCombat_InitiateTimer", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
ObjectQuestTimerLaunch(_Var2, "HAV_LikesideCombat_CombatRoundTimer", "HAV_HalsinPortalTimer", 24000, 1);

IF
TurnStarted(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _)
AND
QRY_OnlyOnce_Reset("HAV_HalsinQuest_PlayedVoiceBark", _, _, _, _)
THEN
DB_NOOP(1);

IF
TurnStarted(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _)
THEN
PROC_IncreaseCounter("HAV_LiftingTheCurse_TurnCount");

PROC
PROC_CounterIncreased("HAV_LiftingTheCurse_TurnCount", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_HAV_LiftingTheCurse_SpawnWave(_Var1);
PROC_HAV_LiftingTheCurse_DeclareRound(_Var1);

PROC
PROC_CounterIncreased("HAV_LiftingTheCurse_TurnCount", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var3, _, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var5, _Var1, _Var1, _Var1)
AND
DB_Players(_Var6, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var6, _Var5, _Var1, _Var1, _Var1)
AND
DB_HAV_LiftingTheCurse_ReactivityVBs(_Var7, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("HAV_HalsinQuest_PlayedVoiceBark", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(_Var7, _Var6);

PROC
PROC_HAV_LiftingTheCurse_SpawnWave((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_HAV_LiftingTheCurse_Waves(_Var1, _, _, _Var1, _Var1)
THEN
EndTurn(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

PROC
PROC_HAV_LiftingTheCurse_SpawnWave((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_AllWavesSpawned_928db093-f718-483a-9e0a-aaa0a8765ff9, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
ObjectTimerLaunch(_Var2, "HAV_LiftingTheCurse_ShadowSpawn", _Var3, 0);

PROC
PROC_HAV_LiftingTheCurse_SpawnWave(4, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(HAV_LiftingTheCurse_State_AllWavesSpawned_928db093-f718-483a-9e0a-aaa0a8765ff9);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "HAV_LiftingTheCurse_ShadowSpawn", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_Var2, _Var1, _, _Var1, _Var1)
THEN
DB_HAV_LiftingTheCurse_ShadeSpawned(_Var1);
TriggerRegisterForCharacter(S_ShadowCurse_SafeZone_Haven_f4f81c2b-5428-4d06-a65e-3ba21e105cba, _Var1);
AppearAt(_Var1, _Var1, 1, DFLT_UTIL_Spawn_01_510ff37e-0618-40e4-8ce0-236e3dc9c291, "", 0);
PROC_HAV_LiftingTheCurse_EndTurn(_Var2);

IF
WentOnStage((GUIDSTRING)_Var1, 1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var1, _, _Var1, _Var1)
THEN
EnterCombat(_Var1, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

PROC
PROC_HAV_LiftingTheCurse_EndTurn((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
QRY_HAV_LiftingTheCurse_CheckSpawned(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
EndTurn(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

QRY
QRY_HAV_LiftingTheCurse_CheckSpawned((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_HAV_LiftingTheCurse_Waves(_Var1, _Var2, _, _Var1, _Var1)
AND NOT
DB_HAV_LiftingTheCurse_ShadeSpawned(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_HAV_LiftingTheCurse_DeclareRound((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
IntegerSubtract(5, _Var1, _Var2, _Var1, _Var1)
THEN
PROC_HAV_LiftingTheCurse_CheckRound(_Var2);

PROC
PROC_HAV_LiftingTheCurse_CheckRound((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 > 0
AND
IntegerToString(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
Concatenate(_Var2, "rounds left till Halsin returns.", _Var3, _Var1, _Var1)
THEN
DebugText(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _Var3);

PROC
PROC_HAV_LiftingTheCurse_CheckRound((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 == 0
THEN
PROC_GlobalSetFlagAndCache(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3);

IF
DB_GLO_DefeatCounter_WaitForCombatEnd("HAV_LiftingTheCurse_Shadows", _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_DefeatCounter_WaitForCombatEnd("HAV_LiftingTheCurse_Shadows", _Var1);
DB_GLO_DefeatCounter_CountMet("HAV_LiftingTheCurse_Shadows");
PROC_GLO_DefeatCounter_AllDefeated("HAV_LiftingTheCurse_Shadows");

PROC
PROC_GLO_DefeatCounter_AllDefeated("HAV_LiftingTheCurse_Shadows", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(HAV_LiftingTheCurse_State_PortalEnemiesDefeated_3836d472-c42f-438c-94bb-e2e83cdc6629);

IF
DB_PermaDefeated(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61);
Die(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, 0, 1);

PROC
PROC_HAV_LiftingTheCurse_DeathVB()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_DeathPAD", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(HAV_HalsinQuest_VB_HalsinDeath_f52dd9f7-22ec-9c3c-97c1-89368af1aa60, _Var1);

IF
DestroyedBy(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _, _, _, _)
THEN
Die(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 1, 0);
PROC_HAV_LiftingTheCurse_RemoveShadows();
PROC_HAV_LiftingTheCurse_DeathVB();

IF
LeftCombat(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_PortalEnemiesDefeated_3836d472-c42f-438c-94bb-e2e83cdc6629, _, _, _, _)
AND
QRY_HAV_IsRitualActive()
THEN
PROC_HAV_LiftingTheCurse_DestroyPortal();

PROC
PROC_HAV_LiftingTheCurse_DestroyPortal()
THEN
PROC_HAV_LiftingTheCurse_RemoveShadows();
PROC_GlobalClearFlagAndCache(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61);
Die(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, 0, 1);

PROC
PROC_HAV_LiftingTheCurse_RemoveShadows()
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var2, _, _, _)
AND NOT
DB_PermaDefeated(_Var2, _, _, _, _)
AND
IsOnStage(_Var2, 1, _, _, _)
AND
GetPosition(_Var2, _Var4, _Var5, _Var6, _)
THEN
Die(_Var2, 0, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, 0, 1);
PlayEffectAtPosition(VFX_Spells_Cast_Damage_Radiant_DivineIntervention_Attack_Impact_BodyFX_Textkey_01_1aee90d5-d5b2-9f9b-90e7-117e755bd8b1, _Var4, _Var5, _Var6);

IF
DB_GlobalFlag(HAV_LiftingTheCurse_State_PortalEnemiesDefeated_3836d472-c42f-438c-94bb-e2e83cdc6629, _, _, _, _)
AND NOT
DB_Defeated(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3);

IF
FlagSet(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PlayEffect(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, VFX_Spells_Cast_Intent_Whitebox_ZoneCone_CastFX_Textkey_02_9ecfa347-83b7-a697-53e9-c81f9a9ad184);
TimerLaunch("HAV_LiftingTheCurse_HalsinAppearance", 1000);

IF
TimerFinished("HAV_LiftingTheCurse_HalsinAppearance", _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_PortalEnemiesDefeated_3836d472-c42f-438c-94bb-e2e83cdc6629, _, _, _, _)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var2, _, _, _)
AND NOT
DB_Dead(_Var2, _, _, _, _)
AND
IsOnStage(_Var2, 1, _, _, _)
AND
GetPosition(_Var2, _Var4, _Var5, _Var6, _)
THEN
Die(_Var2, 0, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, 0, 1);
PlayEffectAtPosition(VFX_Spells_Cast_Damage_Radiant_DivineIntervention_Attack_Impact_BodyFX_Textkey_01_1aee90d5-d5b2-9f9b-90e7-117e755bd8b1, _Var4, _Var5, _Var6);

IF
TimerFinished("HAV_LiftingTheCurse_HalsinAppearance", _, _, _, _)
AND NOT
DB_Defeated(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
THEN
PROC_Foop(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
PROC_Foop(S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a);

IF
FlagSet(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _, _, _, _)
AND
DB_HAV_LiftingTheCurse_Waves(_, _Var4, _, _, _)
AND
IsOnStage(_Var4, 0, _, _, _)
THEN
NOT DB_GLO_DefeatCounter(_Var4, "HAV_LiftingTheCurse_Shadows");

IF
WentOnStage(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1, _, _, _)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61, _, _, _, _)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_HAV_TetherLeaveBounds_7ae97f8d-1809-4236-b8b2-d64ef1142f3c, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, 1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_HalsinReturned", _Var1, _Var1, _Var1, _Var1)
THEN
DB_HAV_LiftingTheCurse_EmergeSpeaker(_Var1);
PROC_HAV_LiftingTheCurse_EmergeDialog(_Var1);

PROC
PROC_HAV_LiftingTheCurse_EmergeDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_StartDialogCustom(HAV_HalsinQuest_PortalEmerge_603c48af-cffb-2998-f1ee-6f6ece03a4f2, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a, _Var1, 0, 0, 0, 0, _Var1, _Var1)
THEN
PROC_GlobalClearFlagAndCache(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61);
Die(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, 0, 1);

IF
DialogEnded(HAV_HalsinQuest_PortalEmerge_603c48af-cffb-2998-f1ee-6f6ece03a4f2, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_Event_HalsinClosesPortal_33aa334a-3127-4be1-ad94-518aa4f24ef4, _, _, _, _)
THEN
NOT DB_OnlyOnce("HAV_LiftingTheCurse_HalsinReturnedFallback");
TimerLaunch("HAV_Halsin_EmergeDialog_Fallback", 1000);

IF
TimerFinished("HAV_Halsin_EmergeDialog_Fallback", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_HAV_TetherLeaveBounds_7ae97f8d-1809-4236-b8b2-d64ef1142f3c, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, 1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_HalsinReturnedFallback", _Var1, _Var1, _Var1, _Var1)
THEN
DB_HAV_LiftingTheCurse_EmergeSpeaker(_Var1);
PROC_HAV_LiftingTheCurse_EmergeDialog(_Var1);

PROC
PROC_StartDialog_AddExtraSpeakers(HAV_LiftingTheCurse_PortalEmerge_603c48af-cffb-2998-f1ee-6f6ece03a4f2, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HAV_LiftingTheCurse_EmergeSpeaker(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, S_HAV_TetherLeaveBounds_7ae97f8d-1809-4236-b8b2-d64ef1142f3c, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, _Var2);

IF
TurnStarted(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_FinishedADs_5a7704ad-6b00-4a7f-ac2d-f4540dc00899, _, _, _, _)
THEN
PROC_TryStartAD(HAV_HalsinQuest_AD_HalsinCombat_2cd7375e-0cc0-e52e-d0c2-cb8643346f3e, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);

IF
FlagSet(HAV_LiftingTheCurse_Event_HalsinClosesPortal_33aa334a-3127-4be1-ad94-518aa4f24ef4, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GlobalClearFlagAndCache(HAV_LiftingTheCurse_State_HalsinIsInRitual_3350ed7d-835e-4b5e-886e-3c544d27ce61);
Die(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, 0, 1);

IF
DB_GlobalFlag(HAV_LiftingTheCurse_State_PortalEnemiesDefeated_3836d472-c42f-438c-94bb-e2e83cdc6629, _, _, _, _)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_FinishedRitual", _, _, _, _)
THEN
PROC_State_Progress(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "SCL_LiftingTheCurse", "SCL_LiftingTheCurse_State_HalsinAtPostPortal");

IF
DB_GlobalFlag(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _, _, _, _)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_FinishedRitual", _, _, _, _)
THEN
PROC_State_Progress(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "SCL_LiftingTheCurse", "SCL_LiftingTheCurse_State_HalsinAtPostPortal");

IF
DialogEnded(HAV_HalsinQuest_PortalEmerge_603c48af-cffb-2998-f1ee-6f6ece03a4f2, _, _, _, _)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_Event_HalsinClosesPortal_33aa334a-3127-4be1-ad94-518aa4f24ef4, _, _, _, _)
THEN
PROC_Poof(S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a);
PROC_SetOnStage(S_HAV_SpiritOfTheLand_1403cdfd-0660-4592-90c6-bfe4607ccd3a, 0);
PROC_DisappearOutOfSight(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "Walk", 0, "HAV_LiftingTheCurse_Halsin_HalsinLeavesLakeSide");

IF
UseStarted((CHARACTER)_Var1, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(HAV_LiftingTheCurse_Event_PortalAppears_333d9c5e-501a-470d-9708-90b9d9b1ec01, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAV_LiftingTheCurse_State_ChannelingComplete_1afd47bc-e8d5-464d-823a-7dba82fcf5c3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("HAV_LiftingTheCurse_TriedEnteringPortal", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(HAV_HalsinQuest_PortalEntry_082e8b98-87c8-72ed-5d62-a3da28a76f8c, _Var1, 1, 1, 0, 0, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("HAV_LiftingTheCurse_TriedEnteringPortal", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(HAV_LiftingTheCurse_RemovePortal_a114f810-3258-401e-8dfe-f5ee628604ec, _, _, _, _)
AND
IsOnStage(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1, _, _, _)
THEN
Die(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 0, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, 0, 1, 1);

IF
FlagSet(HAV_LiftingTheCurse_RemovePortal_a114f810-3258-401e-8dfe-f5ee628604ec, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_HAV_LiftingTheCurse_DestroyPortal();

IF
AttackedBy(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _, _, _, _, _, _)
AND
HasActiveStatus(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, "HAV_HALSINLAKESIDE_DAMAGEDPORTAL_FIRST", 0, _, _)
AND
GetHitpointsPercentage(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _Var7, _, _, _)
AND
_Var7 < 70
AND NOT
DB_Defeated(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _)
THEN
ApplyStatus(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, "HAV_HALSINLAKESIDE_DAMAGEDPORTAL_FIRST", -1, 1, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);

IF
AttackedBy(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _, _, _, _, _, _)
AND
HasActiveStatus(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, "HAV_HALSINLAKESIDE_DAMAGEDPORTAL_SECOND", 0, _, _)
AND
GetHitpointsPercentage(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _Var7, _, _, _)
AND
_Var7 < 40
AND NOT
DB_Defeated(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, _, _, _, _)
THEN
ApplyStatus(S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6, "HAV_HALSINLAKESIDE_DAMAGEDPORTAL_SECOND", -1, 1, S_HAV_HalsinPortal_f2b5ad7f-013c-4c9e-a755-5fe9ff3287f6);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act2"
