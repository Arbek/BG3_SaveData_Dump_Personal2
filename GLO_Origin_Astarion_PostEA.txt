Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_TadpolePowers_UnlockedByDefault(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);
DB_GLO_CompoundFlag(ORI_Astarion_Knows_CazadorMaster_7236c69b-fe20-afdb-a6fa-15c1fb9fb6ae, ORI_Astarion_Knows_HasMaster_38f33e31-9914-409e-a592-fb1f58ddd9fa);
DB_ORI_Astarion_ForcedInPartyDiscussionFlags(ORI_Astarion_State_PartyNeedsToDiscussAstarionsIdentity_25ed2869-3fdc-4f74-8acd-0adaba69c41e);
DB_ORI_Astarion_ForcedInPartyDiscussionFlags(ORI_Astarion_State_PartyNeedsToDiscussCampNightBite_4fb192a2-a068-461e-b23e-9dd517f77fda);
DB_ORI_Astarion_ForcedInPartyDiscussionFlags(ORI_Astarion_State_PartyNeedsToDiscussGameplayBite_c3f96c88-b404-497f-b287-e3453e334c94);
DB_GlobalFlagReactionAfterDialog(ORI_Astarion_State_GurHunterForceReveal_21836280-71de-4895-8c47-c0b3e225c127, HAG_GurHunter_OM_Astarion_AOM_OOM_607d464a-3738-9dd2-c716-6cf3bf507761);
DB_ORI_Astarion_ForceIdentityDiscussionTriggers(S_CRE_Mountains_SUB_bb2094fe-5094-4dae-87a6-a8a9319d11fa);
DB_ORI_Astarion_ForceIdentityDiscussionTriggers(S_SCL_AstarionForceRevealTrigger_d315831e-0a2c-4f11-b234-bc9b8bf43a97);
DB_QuestDef_State_ConditionalFlag(ORI_Astarion_State_RequestedConversationWithRaphael_0f717745-2fbf-465a-8ada-51bb94919378, "ORI_COM_Astarion", "AstarionToldRaphael_NoScars", 0, ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9);
DB_QuestDef_State_ConditionalFlag(ORI_Astarion_State_RequestedConversationWithRaphael_0f717745-2fbf-465a-8ada-51bb94919378, "ORI_COM_Astarion", "AstarionToldRaphael", 1, ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9);
DB_QuestDef_State(HAV_MolsDeal_State_Lanceboard_ThreeWay_AstarionAskedRaphael_e1fabb89-91f2-d95f-a0e7-2870baebbaae, "ORI_COM_Astarion", "MetRaphaelHaven");
DB_QuestDef_State(ORI_Astarion_State_RaphaelLeftHavenNoInfo_NoScars_051a4f2e-63bf-4578-a7ac-d8f35578ccd7, "ORI_COM_Astarion", "MetRaphaelHaven_NoInfo_NoScars");
DB_QuestDef_State(ORI_Astarion_State_RaphaelLeftHavenNoInfo_dc012756-d655-4bae-803f-a7741d5cfdd8, "ORI_COM_Astarion", "MetRaphaelHaven_NoInfo");
DB_QuestDef_State(ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5, "ORI_COM_Astarion", "MetRaphaelMasoleum");
DB_QuestDef_State_ConditionalFlag(SHA_Orthon_State_DefeatedOnce_8dd589d6-90fc-4a3b-b369-10440bd56520, "ORI_COM_Astarion", "KilledOrhon", 1, ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5);
DB_QuestDef_State(ORI_Astarion_State_RaphaelToldRitual_7b30820e-92e5-4f64-a2f5-92edbd9a0e2f, "ORI_COM_Astarion", "ScarsRevealed");
DB_QuestDef_State(VISITEDREGION_BGO_Main_A_40f06537-814f-4796-b012-5ffaa648a8d9, "ORI_COM_Astarion", "ReachedBG");
DB_QuestDef_State(WYR_GurCamp_State_AstarionPromisedToHelp_69b7e436-5e7a-4f53-8e51-fd8ede064a0e, "ORI_COM_Astarion", "Ulma_GurPeace");
DB_QuestDef_State(WYR_GurCamp_State_AttackedGur_6f6d0421-e12e-7a1a-5658-64f85ef6b236, "ORI_COM_Astarion", "Ulma_GurHostile");
DB_QuestDef_State(GLO_GurCamp_State_GurLeaderPermaDefeated_2dd63ae4-02c6-4360-8bdd-4d8d938a56e0, "ORI_COM_Astarion", "Ulma_Dead");
DB_QuestDef_State(WYR_GurCamp_State_BetrayedAstarion_e9410d3a-0ade-4bfe-93b8-af51fb7fc399, "ORI_COM_Astarion", "Ulma_BetrayedAstarion");
DB_QuestDef_State(CAMP_VampireAmbush_State_AmbushFailed_c7ad2cf7-59de-4310-aac1-2635d66474bf, "ORI_COM_Astarion", "MetAmbushSpawns_Failed");
DB_QuestDef_State(CAMP_VampireAmbush_State_AstarionKidnapped_b52d681f-4722-4f43-ba95-ac9f49c173d8, "ORI_COM_Astarion", "MetAmbushSpawns_Succeeded");
DB_QuestDef_State(ORI_Astarion_State_LeftKennelAfterKidnapping_378e24eb-7b5b-43f4-8662-1a7f4ffed5ed, "ORI_COM_Astarion", "EscapedFromKennel");
DB_QuestDef_State_ConditionalFlag(LOW_CazadorsPalace_State_EnteredMansion_97df5c27-5740-4277-96e1-5fdd4c5e6699, "ORI_COM_Astarion", "EnteredPalace", 0, CAMP_VampireAmbush_State_AstarionKidnapped_b52d681f-4722-4f43-ba95-ac9f49c173d8);
DB_QuestDef_State(LOW_CazadorsPalace_Event_TeleportToDungeonLevel_edece03f-595c-47ef-aebd-3eb516277956, "ORI_COM_Astarion", "EnteredDungeon");
DB_QuestDef_State(ORI_Astarion_State_MetSebastian_b0158356-c6ca-4734-bc24-1d0b52c1d6bd, "ORI_COM_Astarion", "MetSebastian");
DB_QuestDef_State(LOW_CazadorsPalace_Cells_Knows_StaffUnlocksCells_2aa3f8e1-1578-145e-40b0-8a69a20e9f7f, "ORI_COM_Astarion", "LearnedStaff");
DB_QuestDef_BookReadState("ORI_COM_Astarion", "LearnedRitual", S_LOW_CazadorsPalace_Crypt_Scroll_591d390d-68b7-4937-9103-3772493ab132);
DB_QuestDef_State(LOW_CazadorsPalace_Cazador_State_FetchingAstarion_a2d019a4-164c-1028-e2ae-8651b3e4cf08, "ORI_COM_Astarion", "FoundCazador_Fetching");
DB_QuestDef_State(ORI_Astarion_State_CapturedInCombat_705422ce-924a-4267-a16e-067aed0f3089, "ORI_COM_Astarion", "RitualCapture");
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_CazadorInCoffin_15322f0b-da2e-48f8-b7d0-a6418c58893c, "ORI_COM_Astarion", "CazadorInCoffin");
DB_QuestDef_State(ORI_Astarion_State_BecameVampireLord_c446ce94-efd8-45d5-b407-284177b6b57e, "ORI_COM_Astarion", "Ascended");
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_ReleasedPrisoners_5784cf70-bff9-467c-b150-39d1f5a78240, "ORI_COM_Astarion", "ReleasedPrisoners");
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_KilledPrisoners_a138792f-04ae-410b-afce-1bf661e9c868, "ORI_COM_Astarion", "KilledPrisoners");
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_LeftPrisonersRot_52cc991c-1d18-4d84-ab28-61e21ac958b5, "ORI_COM_Astarion", "LeftPrisoners");
DB_QuestDef_State(ORI_Astarion_State_LeftToEndNoCazador_eb702db1-b81f-4316-8b1e-667500fa3ca8, "ORI_COM_Astarion", "LeftToEND");
DB_GLO_CompoundFlag(CAMP_Astarion_TheHungerA_LeaveParty_cc3d051f-c334-f432-e618-5e0de55924bf, ORI_Astarion_State_Bite_CompanionLeft_ac7f524a-c51f-45be-8f51-cf66b5def2e9);
DB_QuestDef_State(ORI_Astarion_State_FirstDreamEnded_872b076a-0475-4184-a756-b3a0c9d872ae, "ORI_Avatar_Astarion", "FirstDream");
DB_QuestDef_State(CAMP_Astarion_TheHungerA_HuntAnimal_ef9c902d-0940-4a39-a926-5717795b89fe, "ORI_Avatar_Astarion", "Bite_Animal");
DB_QuestDef_State(CAMP_Astarion_TheHungerA_Drain_cb67cffc-791b-c790-3a79-6c3d68ce3609, "ORI_Avatar_Astarion", "Bite_Stealth_Murder");
DB_QuestDef_State(CAMP_Astarion_TheHungerA_HalfDrain_3f739f8d-d423-5020-eaf0-6f478b8cb1be, "ORI_Avatar_Astarion", "Bite_Stealth_HalfDrain");
DB_QuestDef_State_ConditionalFlag(ORI_Astarion_State_Bite_RevealSuccess_b460aa45-8b1e-44c9-bbc8-57726aac920e, "ORI_Avatar_Astarion", "Bite_Reveal_Success", 0, CAMP_AstarionAvatar_DrankGaleBlood_296a74f4-4a62-2a59-8363-8f99048b9204);
DB_QuestDef_State(CAMP_Astarion_TheHungerA_BadDream_27d97b60-0e42-bb16-0606-803c17345576, "ORI_Avatar_Astarion", "Bite_Lie_Success");
DB_QuestDef_State(ORI_Astarion_State_Bite_CompanionLeft_ac7f524a-c51f-45be-8f51-cf66b5def2e9, "ORI_Avatar_Astarion", "Bite_CompanionLeft");
DB_QuestDef_State(CAMP_Astarion_TheHungerA_BiteAvatarFail_2b6d4686-a8df-44b5-8dfe-86560ac867f8, "ORI_Avatar_Astarion", "Bite_Avatar_Failure");
DB_QuestDef_State(ORI_Astarion_State_MetGurHunter_e9d0ed27-506f-4295-89d2-448a4b46b174, "ORI_Avatar_Astarion", "MetGurHunter");
DB_QuestDef_State_ConditionalFlag(GLO_GurHunter_State_PermaDefeated_90970c15-b3ac-4bde-a242-4d37abeec99a, "ORI_Avatar_Astarion", "MetGurHunter_Murder", 1, ORI_Astarion_State_MetGurHunter_e9d0ed27-506f-4295-89d2-448a4b46b174);
DB_QuestDef_State_ConditionalFlag(ORI_Astarion_Knows_MaidenFel_fe63f819-fcd1-fcaa-e611-64a631945fb6, "ORI_Avatar_Astarion", "MetGurHunter_LearnedEmployer", 1, ORI_Astarion_State_MetGurHunter_e9d0ed27-506f-4295-89d2-448a4b46b174);
DB_QuestDef_State(ORI_Astarion_State_PartyNeedsToDiscussBite_c3f96c88-b404-497f-b287-e3453e334c94, "ORI_Avatar_Astarion", "GameplayBiteReveal");
DB_QuestDef_State(ORI_Astarion_State_PartyNeedsToDiscussAstarionsIdentity_25ed2869-3fdc-4f74-8acd-0adaba69c41e, "ORI_Avatar_Astarion", "Act1LeftReveal");
DB_QuestDef_State(NIGHT_Astarion_CazadorNightmare_SecondDream_c4214d0e-ed58-49ba-9d44-e1ce8366fc87, "ORI_Avatar_Astarion", "SecondDream");
DB_QuestDef_State(HAV_MolsDeal_State_Lanceboard_ThreeWay_AstarionAskedRaphael_e1fabb89-91f2-d95f-a0e7-2870baebbaae, "ORI_Avatar_Astarion", "MetRaphaelHaven");
DB_QuestDef_State(ORI_Astarion_State_RaphaelLeftHavenNoInfo_dc012756-d655-4bae-803f-a7741d5cfdd8, "ORI_Avatar_Astarion", "MetRaphaelHaven_NoInfo");
DB_QuestDef_State(ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5, "ORI_Avatar_Astarion", "MetRaphaelMasoleum");
DB_QuestDef_State_ConditionalFlag(SHA_Orthon_State_DefeatedOnce_8dd589d6-90fc-4a3b-b369-10440bd56520, "ORI_Avatar_Astarion", "KilledOrhon", 1, ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5);
DB_QuestDef_State(ORI_Astarion_State_RaphaelToldRitual_7b30820e-92e5-4f64-a2f5-92edbd9a0e2f, "ORI_Avatar_Astarion", "ScarsRevealed");
DB_QuestDef_State_ConditionalFlag(ORI_Astarion_State_RaphaelLeftMasoleumEntrance_ee881edf-2d4d-40a2-a6f1-c790a01c9ed5, "ORI_Avatar_Astarion", "RaphaelLeftNoInfo", 0, ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5);
DB_QuestDef_State(VISITEDREGION_BGO_Main_A_40f06537-814f-4796-b012-5ffaa648a8d9, "ORI_Avatar_Astarion", "ReachedBG");
DB_QuestDef_State(WYR_GurCamp_State_GaveQuestToKillCazador_109ed582-3803-4e0d-9e4a-7440e4fe02d0, "ORI_Avatar_Astarion", "Ulma_GurPeace");
DB_QuestDef_State(WYR_GurCamp_State_AttackedGur_6f6d0421-e12e-7a1a-5658-64f85ef6b236, "ORI_Avatar_Astarion", "Ulma_GurHostile");
DB_QuestDef_State(GLO_GurCamp_State_GurLeaderPermaDefeated_2dd63ae4-02c6-4360-8bdd-4d8d938a56e0, "ORI_Avatar_Astarion", "Ulma_Dead");
DB_QuestDef_State(CAMP_VampireAmbush_State_AmbushFailed_c7ad2cf7-59de-4310-aac1-2635d66474bf, "ORI_Avatar_Astarion", "MetAmbushSpawns_Failed");
DB_QuestDef_State(CAMP_VampireAmbush_State_AstarionKidnapped_b52d681f-4722-4f43-ba95-ac9f49c173d8, "ORI_Avatar_Astarion", "MetAmbushSpawns_Succeeded");
DB_QuestDef_State_ConditionalFlag(LOW_CazadorsPalace_State_EnteredMansion_97df5c27-5740-4277-96e1-5fdd4c5e6699, "ORI_Avatar_Astarion", "EnteredPalace", 0, CAMP_VampireAmbush_State_AstarionKidnapped_b52d681f-4722-4f43-ba95-ac9f49c173d8);
DB_QuestDef_State(LOW_CazadorsPalace_Event_TeleportToDungeonLevel_edece03f-595c-47ef-aebd-3eb516277956, "ORI_Avatar_Astarion", "EnteredDungeon");
DB_QuestDef_State(ORI_Astarion_State_MetSebastian_b0158356-c6ca-4734-bc24-1d0b52c1d6bd, "ORI_Avatar_Astarion", "MetSebastian");
DB_QuestDef_BookReadState("ORI_Avatar_Astarion", "LearnedRitual", S_LOW_CazadorsPalace_Crypt_Scroll_591d390d-68b7-4937-9103-3772493ab132);
DB_QuestDef_State(LOW_CazadorsPalace_Cells_Knows_StaffUnlocksCells_2aa3f8e1-1578-145e-40b0-8a69a20e9f7f, "ORI_Avatar_Astarion", "LearnedStaff");
DB_QuestDef_State_ConditionalFlag(ORI_Astarion_State_PreRitualSceneEnded_8e60ef2f-d3cc-49b2-a552-70a545caceed, "ORI_Avatar_Astarion", "FoundCazador_NoRitual", 0, LOW_CazadorsPalace_RitualRoom_Event_TeleportAstarion_1318f561-8b32-4ac2-bb85-a4f2b93f53d4);
DB_QuestDef_State_ConditionalFlag(ORI_Astarion_State_PreRitualSceneEnded_8e60ef2f-d3cc-49b2-a552-70a545caceed, "ORI_Avatar_Astarion", "FoundCazador_Ritual", 1, LOW_CazadorsPalace_RitualRoom_Event_TeleportAstarion_1318f561-8b32-4ac2-bb85-a4f2b93f53d4);
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_CazadorInCoffin_15322f0b-da2e-48f8-b7d0-a6418c58893c, "ORI_Avatar_Astarion", "CazadorInCoffin");
DB_QuestDef_State(ORI_Astarion_State_BecameVampireLord_c446ce94-efd8-45d5-b407-284177b6b57e, "ORI_Avatar_Astarion", "Ascended");
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_ReleasedPrisoners_5784cf70-bff9-467c-b150-39d1f5a78240, "ORI_Avatar_Astarion", "ReleasedPrisoners");
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_KilledPrisoners_a138792f-04ae-410b-afce-1bf661e9c868, "ORI_Avatar_Astarion", "KilledPrisoners");
DB_QuestDef_State(LOW_CazadorsPalace_RitualRoom_State_LeftPrisonersRot_52cc991c-1d18-4d84-ab28-61e21ac958b5, "ORI_Avatar_Astarion", "LeftPrisoners");
DB_QuestDef_State(ORI_Astarion_State_LeftToEndNoCazador_eb702db1-b81f-4316-8b1e-667500fa3ca8, "ORI_Avatar_Astarion", "LeftToEND");
DB_CAMP_Astarion_StandingStillDialogs(CAMP_AstarionHunger_PAD_AftermathAvatarStealthDrain_775dcb4b-b054-c8b3-6154-958498252cab);
DB_CAMP_Astarion_StandingStillDialogs(CAMP_AstarionHunger_PAD_AftermathAvatarKilled_538b7717-cbee-b956-8fd0-78d3e97603ad);
DB_CAMP_Astarion_StandingStillDialogs(GLO_Astarion_PAD_AstarionKidnapped_6ce11a30-ad07-ef5e-7352-28fd78b75a92);
NOT DB_CAMP_Astarion_StandingStillDialogs_SteerTo(NULL_00000000-0000-0000-0000-000000000000);
DB_ORI_Astarion_IPRDWorthyDarkUrgeMoment(ORI_DarkUrge_State_TorturedWithGoblins_84ee880f-83cb-9c00-49d9-f2bed9a2a235);
DB_ORI_Astarion_IPRDWorthyDarkUrgeMoment(ORI_DarkUrge_State_HackedGale_a18d0203-6c1e-b758-242a-c01c60b243a6);
DB_ORI_Astarion_IPRDWorthyDarkUrgeMoment(ORI_DarkUrge_State_WoundedBird_PulledWings_f2d614bb-fc65-1356-8a75-502b6dcb4701);
DB_ORI_Astarion_IPRDWorthyDarkUrgeMoment(ORI_DarkUrge_State_KilledSquirrel_d070da3d-d3e4-b686-07a7-a3d8d3b81ab2);
DB_RelationshipDialog_WRD_TriggerInCamp(Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f);

KBSECTION
IF
TextEvent("AstarionSwap", _, _, _, _)
THEN
PROC_RemoveDialogEntryForSpeaker(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46);
DB_Dialogs(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InPartyB_7f99620e-15fb-a35b-04fe-3d6faf708945);

IF
TextEvent("AstarionRestore", _, _, _, _)
THEN
PROC_RemoveDialogEntryForSpeaker(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InPartyB_7f99620e-15fb-a35b-04fe-3d6faf708945);
DB_Dialogs(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46);

PROC
PROC_GLO_PartyMembers_AddHook(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
THEN
SetFlag(ORI_Astarion_State_WasRecruited_e3021e44-45ad-475c-9456-0bc54d06accc);

IF
DB_PermaDefeated(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND
IsTagged(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, BLOCK_RESURRECTION_22a75dbb-1588-407e-b559-5aa4e6d4e6a6, 1, _, _)
THEN
DB_GLO_CharacterCorpseDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_Dead_0b569c55-f1bc-036a-2842-5b2bcc0d46c4);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(ORI_Astarion_State_FeedingTonight_cda3fa90-4fae-4334-b5e0-dc833d473842, _, _, _, _)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(ORI_Astarion_State_FeedingTarget_469b943c-d986-470f-bd2e-84077b458fdc, _Var1, 1, _Var1, _Var1)
THEN
PROC_Astarion_Feeding(_Var1);
PROC_GlobalClearFlagAndCache(ORI_Astarion_State_FeedingTonight_cda3fa90-4fae-4334-b5e0-dc833d473842);
ClearFlag(ORI_Astarion_State_FeedingTarget_469b943c-d986-470f-bd2e-84077b458fdc, _Var1);

PROC
PROC_Astarion_Feeding((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ApplyStatus(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ASTARION_HAPPY", -1, 0, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(_Var1, "ASTARION_WEAK", -1, 0, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);

IF
UsingSpellOnTarget(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (GUIDSTRING)_Var1, "Target_VampireBite_Astarion", _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(ORI_Astarion_State_GameplayBiteVictim_487360df-d763-4e22-bd0d-cf5aa4762843, _Var1);
NOT DB_ORI_Astarion_GameplayBiteTarget(_Var5);

IF
UsingSpellOnTarget(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (GUIDSTRING)_Var1, "Target_VampireBite_Astarion", _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_ORI_Astarion_GameplayBiteTarget(_Var1);

IF
UsingSpellOnTarget(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (CHARACTER)_Var1, "Target_VampireBite_Astarion", _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_ORI_Astarion_NeedToBlockDefaultAssaultReaction(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_BlockPartyDisturbanceReactions(_Var1);

QRY
QRY_ORI_Astarion_NeedToBlockDefaultAssaultReaction((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var1 == S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
AND NOT
DB_OnlyOnce("ORI_Astarion_GaleReactedToGameplayBite", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Astarion_NeedToBlockDefaultAssaultReaction((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_ORI_Astarion_IsKarlachNoTouch(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("ORI_Astarion_KarlachNoTouchReactedToGameplayBite", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_ORI_Astarion_NeedToBlockDefaultAssaultReaction((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
AND NOT
QRY_ORI_Astarion_IsKarlachNoTouch(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
CastedSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", _, _, _)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var4, _, _, _, _)
AND
DB_Players(_Var4, _, _, _, _)
AND
IsTagged(_Var4, ASTARION_BITE_VICTIM_c912718b-b200-4305-80ef-4020de96356e, 0, _, _)
THEN
SetTag(_Var4, ASTARION_BITE_VICTIM_c912718b-b200-4305-80ef-4020de96356e);

IF
CastedSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", _, _, _)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var4, _, _, _, _)
AND
DB_Players(_Var4, _, _, _, _)
AND
GetFlag(ORI_Astarion_State_GameplayBiteVictim_487360df-d763-4e22-bd0d-cf5aa4762843, _Var4, 0, _, _)
THEN
SetFlag(ORI_Astarion_State_GameplayBiteVictim_487360df-d763-4e22-bd0d-cf5aa4762843, _Var4);

IF
CastedSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", _, _, _)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var4, _, _, _, _)
AND
DB_Players(_Var4, _, _, _, _)
AND NOT
DB_Avatars(_Var4, _, _, _, _)
AND
ChangeApprovalRating(_Var4, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, 0, -5, _)
THEN
DB_NOOP(1);

IF
CastedSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", _, _, _)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var4, _, _, _, _)
AND
_Var4 == S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
AND
DB_Sees(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _)
AND
QRY_OnlyOnce("ORI_Astarion_GaleReactedToGameplayBite", _, _, _, _)
THEN
PROC_ORI_Astarion_BiteWitnessed_Intern(_Var4, ORI_AstarionIsAVamp_PAD_GaleWasBitten_529e12b5-dda9-fa5f-137d-413d003b85db);

IF
CastedSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", _, _, _)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var4, _, _, _, _)
AND
QRY_ORI_Astarion_IsKarlachNoTouch(_Var4, _, _, _, _)
AND
DB_Sees(_Var4, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _)
AND
QRY_OnlyOnce("ORI_Astarion_KarlachNoTouchReactedToGameplayBite", _, _, _, _)
THEN
PROC_ORI_Astarion_BiteWitnessed_Intern(_Var4, ORI_AstarionIsAVamp_PAD_KarlachWasBitten_3c6a6cb3-bec4-f9dc-a546-a3b7e36048ee);

QRY
QRY_ORI_Astarion_IsKarlachNoTouch((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var1 == S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c
AND NOT
DB_GlobalFlag(GLO_ForgingOfTheHeart_State_KarlachSecondUpgrade_f6dc0de4-1089-43c0-b392-306a9a44387c, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
CastedSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", _, _, _)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var4, _, _, _, _)
AND
QRY_ORI_Astarion_GameplayBiteTargetIsWitness(_Var4, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartyWitnessedBite_145d874f-db54-475e-98ab-edcc55c08262, _, _, _, _)
THEN
PROC_ORI_Astarion_BiteWitnessed_Intern(_Var4, ORI_AstarionIsAVamp_PAD_c992d43f-b55b-2e55-24e7-901f8ce46896);

IF
CastedSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", _, _, _)
AND
DB_ORI_Astarion_GameplayBiteTarget(_Var4, _, _, _, _)
AND NOT
QRY_ORI_Astarion_GameplayBiteTargetIsWitness(_Var4, _, _, _, _)
AND
DB_Players(_Var5, _, _, _, _)
AND
_Var5 != _Var4
AND
_Var5 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
DB_Sees(_Var5, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartyWitnessedBite_145d874f-db54-475e-98ab-edcc55c08262, _, _, _, _)
THEN
PROC_ORI_Astarion_BiteWitnessed_Intern(_Var5, ORI_AstarionIsAVamp_PAD_c992d43f-b55b-2e55-24e7-901f8ce46896);

QRY
QRY_ORI_Astarion_GameplayBiteTargetIsWitness((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
DB_Sees(_Var1, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_ORI_Astarion_BiteWitnessed_Intern((CHARACTER)_Var1, (DIALOGRESOURCE)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartyWitnessedBite_145d874f-db54-475e-98ab-edcc55c08262, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_State_PartyWitnessedBite_145d874f-db54-475e-98ab-edcc55c08262);

PROC
PROC_ORI_Astarion_BiteWitnessed_Intern((CHARACTER)_Var1, (DIALOGRESOURCE)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_ORI_Astarion_BiteWitness(_Var1, _Var2);
PROC_ORI_Astarion_BiteWitnessed(_Var1, _Var2);

PROC
PROC_ORI_Astarion_BiteWitnessed((CHARACTER)_Var1, (DIALOGRESOURCE)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_StartDialog_Fixed(_Var2, _Var1, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1)
THEN
NOT DB_ORI_Astarion_BiteWitness(_Var1, _Var2);
PROC_ORI_Astarion_CheckSetUpForcedPartyDiscussionAfterPAD(_Var1);

IF
AutomatedDialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_ORI_Astarion_BiteWitness(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Astarion_BiteWitness(_Var3, _Var1);
PROC_ORI_Astarion_CheckSetUpForcedPartyDiscussionAfterPAD(_Var3);

PROC
PROC_ORI_Astarion_CheckSetUpForcedPartyDiscussionAfterPAD((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5);
PROC_GlobalSetFlagAndCache(ORI_Astarion_State_PartyNeedsToDiscussBite_c3f96c88-b404-497f-b287-e3453e334c94);
PROC_ORI_Astarion_SetUpForcedPartyDiscussion(_Var1, 500);

PROC
PROC_GlobalFlagReactionAfterDialog(ORI_Astarion_State_GurHunterForceReveal_21836280-71de-4895-8c47-c0b3e225c127, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Origins(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
GetDistanceTo(_Var1, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var2, _Var1, _Var1)
AND
_Var2 < 10
AND
QRY_OnlyOnce("ORI_Astarion_ForcedIdentityReveal", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_State_PartyNeedsToDiscussAstarionsIdentity_25ed2869-3fdc-4f74-8acd-0adaba69c41e);
PROC_ORI_Astarion_SetUpForcedPartyDiscussion(_Var1, 1000);

IF
DB_InRegion(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Astarion_ForceIdentityDiscussionTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
DB_OriginInPartyDialog(_Var2, _, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("ORI_Astarion_ForcedIdentityReveal", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_State_PartyNeedsToDiscussAstarionsIdentity_25ed2869-3fdc-4f74-8acd-0adaba69c41e);
PROC_ORI_Astarion_SetUpForcedPartyDiscussion(_Var2, 5000);

PROC
PROC_ORI_Astarion_SetUpForcedPartyDiscussion((CHARACTER)_Var1, (INTEGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_ORI_Astarion_SelectCompanionForInPartyDiscussion(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var3);
ObjectTimerLaunch(_Var3, "ORI_Astarion_ForcedInPartyDiscussion", _Var2);
DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var3);

QRY
QRY_ORI_Astarion_SelectCompanionForInPartyDiscussion((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion(_Var2);

QRY
QRY_ORI_Astarion_SelectCompanionForInPartyDiscussion((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsInDialogRange(_Var1, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1)
THEN
DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion(_Var1);

QRY
QRY_ORI_Astarion_SelectCompanionForInPartyDiscussion((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
QRY_SpeakerIsInDialogRange(_Var2, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1)
AND
QRY_IsEmptyDB("DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion", 1, _Var1, _Var1, _Var1)
THEN
DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion(_Var2);

QRY
QRY_ORI_Astarion_SelectCompanionForInPartyDiscussion((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
QRY_SpeakerIsInDialogRange(_Var1, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1)
AND
QRY_IsEmptyDB("DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion", 1, _Var1, _Var1, _Var1)
THEN
DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion(_Var1);

QRY
QRY_ORI_Astarion_SelectCompanionForInPartyDiscussion((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != _Var1
AND
_Var2 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
QRY_SpeakerIsInDialogRange(_Var2, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1)
AND
QRY_IsEmptyDB("DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion", 1, _Var1, _Var1, _Var1)
THEN
DB_QRYTN_ORI_Astarion_SelectedCompanionForInPartyDiscussion(_Var2);

IF
DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var1, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var1);
ObjectTimerLaunch(_Var1, "ORI_Astarion_ForcedInPartyDiscussion", 2000);

IF
DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var1);
NOT DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var1);
ObjectTimerCancel(_Var1, "ORI_Astarion_ForcedInPartyDiscussion");
PROC_ORI_Astarion_SetUpForcedPartyDiscussion(_Var1, 500);

IF
ObjectTimerFinished((CHARACTER)_Var1, "ORI_Astarion_ForcedInPartyDiscussion", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_OriginInPartyDialog(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog_Fixed(_Var2, _Var1, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1)
THEN
NOT DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var1);

IF
DialogStarted((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_OriginInPartyDialog(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var4);
ObjectTimerCancel(_Var4, "ORI_Astarion_ForcedInPartyDiscussion");

IF
ObjectTimerFinished((CHARACTER)_Var1, "ORI_Astarion_ForcedInPartyDiscussion", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_OriginInPartyDialog(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(ORI_Astarion_VB_VampiricNatureDiscussion_355ac4b5-d0da-8527-0de2-fc4b49c1da85, _Var1);
PROC_GlobalSetFlagAndCache(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5);
NOT DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var1);

IF
ObjectTimerFinished((CHARACTER)_Var1, "ORI_Astarion_ForcedInPartyDiscussion", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
NOT DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var1);

IF
VoiceBarkEnded(ORI_Astarion_VB_VampiricNatureDiscussion_355ac4b5-d0da-8527-0de2-fc4b49c1da85, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_ORI_Astarion_ClearForcedDiscussionFlags();

IF
VoiceBarkFailed(ORI_Astarion_VB_VampiricNatureDiscussion_355ac4b5-d0da-8527-0de2-fc4b49c1da85, _, _, _, _)
THEN
PROC_ORI_Astarion_ClearForcedDiscussionFlags();

PROC
PROC_ORI_Astarion_ClearForcedDiscussionFlags()
AND
DB_ORI_Astarion_ForcedInPartyDiscussionFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalClearFlagAndCache(_Var1);

IF
FlagCleared((FLAG)_Var1, _, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_ORI_Astarion_ForcedInPartyDiscussionFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ORI_Astarion_CleanUpForcedDiscussion();

PROC
PROC_ORI_Astarion_CleanUpForcedDiscussion()
AND
DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ObjectTimerCancel(_Var1, "ORI_Astarion_ForcedInPartyDiscussion");
NOT DB_ORI_Astarion_LaunchInPartyDiscussionAfterTimerIsFinished(_Var1);

PROC
PROC_ORI_Astarion_CleanUpForcedDiscussion()
AND
DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Astarion_CompanionForInPartyDiscussion(_Var1);

PROC
PROC_ORI_Astarion_CleanUpForcedDiscussion()
AND
DB_ORI_Astarion_BiteWitness(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_Astarion_BiteWitness(_Var1, _Var2);

IF
DB_CurrentLevel("BGO_Main_A", _, _, _, _)
AND
DB_PartyMembers(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_DiscussedCazadorAfterSCL_1d23b665-e2c1-4d61-9c53-25aff637529f, _, _, _, _)
AND NOT
DB_GlobalFlag(VISITEDREGION_CTY_Main_A_ce5346f4-c176-43ea-8da0-2067450e26ac, _, _, _, _)
AND NOT
DB_RelationshipDialogsFinished(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_State_NeedsToDiscussCazadorAfterSCL_3c1b76cd-6d29-4780-b1b0-cfb5ffbb7bf6, _, _)
AND NOT
DB_OnlyOnce("ORI_Astarion_WYR_CazadorDiscussion", _, _, _, _)
THEN
DB_OnlyOnce("ORI_Astarion_WYR_CazadorDiscussion");
PROC_RelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_State_NeedsToDiscussCazadorAfterSCL_3c1b76cd-6d29-4780-b1b0-cfb5ffbb7bf6, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, 0);

IF
DialogStarted(HAV_MolsDeal_Raphael_f7a2c41b-2b2c-c91e-faf2-b8f6ccdede44, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(ORI_Astarion_State_MetRaphaelAtHaven_89fe5dde-24f8-4ff8-9560-bfd667c18d64);

IF
DialogStarted(HAV_MolsDeal_Lanceboard_ThreeWay_3fc20a5a-83a6-e4a9-d9c2-536b0558ec2c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(ORI_Astarion_State_MetRaphaelAtHaven_89fe5dde-24f8-4ff8-9560-bfd667c18d64);

PROC
PROC_HAV_MolsDeal_MonitorPoof()
AND
DB_GlobalFlag(ORI_Astarion_State_MetRaphaelAtHaven_89fe5dde-24f8-4ff8-9560-bfd667c18d64, _, _, _, _)
AND
DB_GlobalFlag(ORI_Astarion_State_RequestedConversationWithRaphael_0f717745-2fbf-465a-8ada-51bb94919378, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_MolsDeal_State_Lanceboard_ThreeWay_AstarionAskedRaphael_e1fabb89-91f2-d95f-a0e7-2870baebbaae, _, _, _, _)
AND
DB_GlobalFlag(ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9, _, _, _, _)
THEN
SetFlag(ORI_Astarion_State_RaphaelLeftHavenNoInfo_dc012756-d655-4bae-803f-a7741d5cfdd8);

PROC
PROC_HAV_MolsDeal_MonitorPoof()
AND
DB_GlobalFlag(ORI_Astarion_State_MetRaphaelAtHaven_89fe5dde-24f8-4ff8-9560-bfd667c18d64, _, _, _, _)
AND
DB_GlobalFlag(ORI_Astarion_State_RequestedConversationWithRaphael_0f717745-2fbf-465a-8ada-51bb94919378, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_MolsDeal_State_Lanceboard_ThreeWay_AstarionAskedRaphael_e1fabb89-91f2-d95f-a0e7-2870baebbaae, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9, _, _, _, _)
THEN
SetFlag(ORI_Astarion_State_RaphaelLeftHavenNoInfo_NoScars_051a4f2e-63bf-4578-a7ac-d8f35578ccd7);

IF
FlagSet(ORI_Astarion_State_RaphaelLeftMasoleumEntrance_ee881edf-2d4d-40a2-a6f1-c790a01c9ed5, _, _, _, _)
AND
DB_QuestIsOpened("ORI_COM_Astarion", _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5, _, _, _, _)
AND
DB_GlobalFlag(ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "RaphaelLeftNoInfo");

IF
FlagSet(ORI_Astarion_State_RaphaelLeftMasoleumEntrance_ee881edf-2d4d-40a2-a6f1-c790a01c9ed5, _, _, _, _)
AND
DB_QuestIsOpened("ORI_COM_Astarion", _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_GotQuestFromRaphael_21b2c417-9d93-4df3-87b6-027e5d1cd4c5, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "RaphaelLeftNoInfo_NoScars");

PROC
PROC_LevelLoadedOnce("END_Main", _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_CazadorPermaDefeated_5258c8d8-09a3-4343-bb6e-13ff5b8e3438, _, _, _, _)
AND
DB_QuestIsOpened("ORI_COM_Astarion", _, _, _, _)
THEN
SetFlag(ORI_Astarion_State_LeftToEndNoCazador_eb702db1-b81f-4316-8b1e-667500fa3ca8);

PROC
PROC_LevelLoadedOnce("END_Main", _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_CazadorPermaDefeated_5258c8d8-09a3-4343-bb6e-13ff5b8e3438, _, _, _, _)
AND
DB_QuestIsOpened("ORI_Avatar_Astarion", _, _, _, _)
THEN
SetFlag(ORI_Astarion_State_LeftToEndNoCazador_eb702db1-b81f-4316-8b1e-667500fa3ca8);

PROC
PROC_LevelLoadedOnce("WLD_Main_A", _, _, _, _)
AND
DB_Avatars(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "Start");

IF
DialogEnded(CAMP_AstarionHunger_IVB_SCO_Avatar_Choice_731b7b80-cbc9-9db4-dcc7-3e92b9c5087c, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_Bite_CompanionLeft_ac7f524a-c51f-45be-8f51-cf66b5def2e9, _, _, _, _)
AND
DB_GlobalFlag(CAMP_AstarionAvatar_DrankGaleBlood_296a74f4-4a62-2a59-8363-8f99048b9204, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_Knows_Bomb_810e296b-f01b-6457-e2c9-43db5c5c140d, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "Bite_Gale_KnowsBomb");

IF
DialogEnded(CAMP_AstarionHunger_IVB_SCO_Avatar_Choice_731b7b80-cbc9-9db4-dcc7-3e92b9c5087c, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_Bite_CompanionLeft_ac7f524a-c51f-45be-8f51-cf66b5def2e9, _, _, _, _)
AND
DB_GlobalFlag(CAMP_AstarionAvatar_DrankGaleBlood_296a74f4-4a62-2a59-8363-8f99048b9204, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_Knows_Bomb_810e296b-f01b-6457-e2c9-43db5c5c140d, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "Bite_Gale_NoBomb");

PROC
PROC_HAV_MolsDeal_MonitorPoof()
AND
DB_GlobalFlag(ORI_Astarion_State_MetRaphaelAtHaven_89fe5dde-24f8-4ff8-9560-bfd667c18d64, _, _, _, _)
AND
DB_GlobalFlag(NIGHT_Astarion_CazadorNightmare_SecondDream_c4214d0e-ed58-49ba-9d44-e1ce8366fc87, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_MolsDeal_State_Lanceboard_ThreeWay_AstarionAskedRaphael_e1fabb89-91f2-d95f-a0e7-2870baebbaae, _, _, _, _)
THEN
SetFlag(ORI_Astarion_State_RaphaelLeftHavenNoInfo_dc012756-d655-4bae-803f-a7741d5cfdd8);

IF
FlagSet(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _, (INTEGER)_Var2, _, _)
AND
DB_Avatars(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartyNeedsToDiscussAstarionsIdentity_25ed2869-3fdc-4f74-8acd-0adaba69c41e, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartyNeedsToDiscussCampNightBite_4fb192a2-a068-461e-b23e-9dd517f77fda, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartyNeedsToDiscussGameplayBite_c3f96c88-b404-497f-b287-e3453e334c94, _, _, _, _)
AND NOT
DB_DialogName(CAMP_AstarionHunger_IVB_SCO_Avatar_Choice_731b7b80-cbc9-9db4-dcc7-3e92b9c5087c, _Var2, _, _, _)
AND
QuestUpdateIsUnlocked(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "GameplayBiteReveal", 0, _)
AND
QuestUpdateIsUnlocked(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "Act1LeftReveal", 0, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "TruthReveal");

IF
FlagSet(OR_Astarion_State_PreRitualSceneEnded_8e60ef2f-d3cc-49b2-a552-70a545caceed, _, _, _, _)
AND
DB_GlobalFlag(LOW_CazadorsPalace_Cazador_State_FetchingAstarion_a2d019a4-164c-1028-e2ae-8651b3e4cf08, _, _, _, _)
AND
DB_GlobalFlag(LOW_CazadorsPalace_RitualRoom_Event_TeleportAstarion_1318f561-8b32-4ac2-bb85-a4f2b93f53d4, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "FoundCazador_Fetching_Ritual");

IF
FlagSet(OR_Astarion_State_PreRitualSceneEnded_8e60ef2f-d3cc-49b2-a552-70a545caceed, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_CazadorsPalace_Cazador_State_FetchingAstarion_a2d019a4-164c-1028-e2ae-8651b3e4cf08, _, _, _, _)
AND
DB_GlobalFlag(LOW_CazadorsPalace_RitualRoom_Event_TeleportAstarion_1318f561-8b32-4ac2-bb85-a4f2b93f53d4, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "FoundCazador_Ritual");

IF
FlagSet(OR_Astarion_State_PreRitualSceneEnded_8e60ef2f-d3cc-49b2-a552-70a545caceed, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_CazadorsPalace_Cazador_State_FetchingAstarion_a2d019a4-164c-1028-e2ae-8651b3e4cf08, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_CazadorsPalace_RitualRoom_Event_TeleportAstarion_1318f561-8b32-4ac2-bb85-a4f2b93f53d4, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "FoundCazador_NoRitual");

IF
FlagSet(WYR_VampireSpawns_State_MovedToCazador_a03cf538-552c-a672-db83-10e9ceaf99e2, _, _, _, _)
AND
DB_GlobalFlag(WYR_VampireSpawns_State_ToldAscension_a48047ea-da16-4451-838d-d129ed8ecbae, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_RitualLocation_9d64bed2-d3b1-8751-f208-2865fffa6129, _, _, _, _)
AND
QuestIsAccepted(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", 1, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "MetFlophouseSpawns");

IF
FlagSet(WYR_VampireSpawns_State_MovedToCazador_a03cf538-552c-a672-db83-10e9ceaf99e2, _, _, _, _)
AND
DB_GlobalFlag(WYR_VampireSpawns_State_ToldAscension_a48047ea-da16-4451-838d-d129ed8ecbae, _, _, _, _)
AND
DB_GlobalFlag(ORI_Astarion_Knows_RitualLocation_9d64bed2-d3b1-8751-f208-2865fffa6129, _, _, _, _)
AND
QuestIsAccepted(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", 1, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_Avatar_Astarion", "MetFlophouseSpawns_Ritual");

IF
FlagSet(WYR_VampireSpawns_State_MovedToCazador_a03cf538-552c-a672-db83-10e9ceaf99e2, _, _, _, _)
AND
DB_GlobalFlag(WYR_VampireSpawns_State_ToldAscension_a48047ea-da16-4451-838d-d129ed8ecbae, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_RitualLocation_9d64bed2-d3b1-8751-f208-2865fffa6129, _, _, _, _)
AND
QuestIsAccepted(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", 1, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "MetFlophouseSpawns");

IF
FlagSet(WYR_VampireSpawns_State_MovedToCazador_a03cf538-552c-a672-db83-10e9ceaf99e2, _, _, _, _)
AND
DB_GlobalFlag(WYR_VampireSpawns_State_ToldAscension_a48047ea-da16-4451-838d-d129ed8ecbae, _, _, _, _)
AND
DB_GlobalFlag(ORI_Astarion_Knows_RitualLocation_9d64bed2-d3b1-8751-f208-2865fffa6129, _, _, _, _)
AND
QuestIsAccepted(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", 1, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "MetFlophouseSpawns_Ritual");

IF
DialogActorJoined((DIALOGRESOURCE)_Var1, _, (GUIDSTRING)_Var3, _, (DIALOGRESOURCE)_Var1)
AND
DB_CAMP_Astarion_StandingStillDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GLO_CAMP_StandingStill_776de2de-871c-4cf4-bcbb-72d26f244489, _Var3);

IF
DialogActorJoined((DIALOGRESOURCE)_Var1, _, (CHARACTER)_Var3, _, (DIALOGRESOURCE)_Var1)
AND
DB_CAMP_Astarion_StandingStillDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_CAMP_Astarion_StandingStillDialogs_SteerTo(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
SteerTo(_Var3, _Var5, 1);
NOT DB_CAMP_Astarion_StandingStillDialogs_SteerTo(_Var5);

IF
DialogActorLeft((DIALOGRESOURCE)_Var1, _, (GUIDSTRING)_Var3, _, (DIALOGRESOURCE)_Var1)
AND
DB_CAMP_Astarion_StandingStillDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(GLO_CAMP_StandingStill_776de2de-871c-4cf4-bcbb-72d26f244489, _Var3);

IF
DB_CAMP_Astarion_BiteSceneMurderVictim(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_CAMP_Astarion_CleanupCorpseAfterNextLongRest(_Var1);
DB_CAMP_Astarion_StandingStillDialogs_SteerTo(_Var1);
DB_CorpseCleanup_Ignore(_Var1);

IF
DB_CAMP_Astarion_CleanupCorpseAfterNextLongRest(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PlayerInCamp(_, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_CorpseCleanup_Ignore(_Var1);
NOT DB_CAMP_Astarion_CleanupCorpseAfterNextLongRest(_Var1);
PROC_CAMP_Astarion_RemoveBiteVictim(_Var1);

PROC
PROC_Camp_SetModeToNight()
AND
DB_CAMP_Astarion_CleanupCorpseAfterNextLongRest(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_CorpseCleanup_Ignore(_Var1);
NOT DB_CAMP_Astarion_CleanupCorpseAfterNextLongRest(_Var1);
PROC_CAMP_Astarion_RemoveBiteVictim(_Var1);

PROC
PROC_CAMP_Astarion_RemoveBiteVictim((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInInventory(_Var1, 0, _Var1, _Var1, _Var1)
AND NOT
DB_OffStage(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CorpseCleanup_RemoveCorpse(_Var1);

IF
FlagSet((FLAG)_Var1, _, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_ORI_Astarion_IPRDWorthyDarkUrgeMoment(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ORI_Astarion_DUFirstDiscussion();

IF
DialogEnded(CAMP_FirstNight_AvD_PostEA_69e79939-6148-1b93-d654-e54374ef9353, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_ORI_DarkUrge(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
THEN
DB_ORI_Astarion_ScheduleDarkUrgeFirstDiscussion(1);

PROC
PROC_CampNight_StartMorningMoments()
AND
DB_ORI_Astarion_ScheduleDarkUrgeFirstDiscussion(1, _, _, _, _)
THEN
NOT DB_ORI_Astarion_ScheduleDarkUrgeFirstDiscussion(1);
DB_RelationshipDialog_WRD_TriggerInCamp(Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f);
PROC_ORI_Astarion_DUFirstDiscussion();

PROC
PROC_ORI_Astarion_DUFirstDiscussion()
AND
DB_Players(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND
DB_ORI_DarkUrge(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SameUser(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_RelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f, _Var1, 0, 0);

QRY
QRY_SelectCustomDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HandlingRelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f, _, _, _, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SameUser(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_ORI_DarkUrge(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(GLO_AD_NonBondedCompanionDialog_62ba7c46-8d22-c591-f04c-2e99441cd02a, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255);

PROC
PROC_CAMP_LeftCamp(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND
DB_HandlingRelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f, _, _, _, _, _, _, _)
THEN
PROC_CancelRelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f);

IF
CharacterReservedUserIDChanged(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND
DB_HandlingRelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f, _, _, _, _, _, _, _)
THEN
PROC_CancelRelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_DarkUrge_FirstDiscussion_49cf2a9e-341e-49f9-ac10-01e2490d556f);

IF
TextEvent("ast_sunlance", _, _, _, _)
THEN
Die(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 1, 3);
PROC_GlobalSetFlagAndCache(ORI_Astarion_State_WantsToDiscussSunLance_affe619d-8c66-4982-8273-22ee89f240e2);

IF
Resurrected(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND
DB_GlobalFlag(ORI_Astarion_State_WantsToDiscussSunLance_affe619d-8c66-4982-8273-22ee89f240e2, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(ORI_Astarion_State_WantsToDiscussSunLance_affe619d-8c66-4982-8273-22ee89f240e2);
DB_ORI_Astarion_ResurrectedAfterSunlance(1);

IF
DB_ORI_Astarion_ResurrectedAfterSunlance(1, _, _, _, _)
AND NOT
DB_CantTalk(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
THEN
NOT DB_ORI_Astarion_ResurrectedAfterSunlance(1);
PROC_CampRelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_Sunlance_ecefaa19-1962-42b0-9965-2fff07b44527, 0);
PROC_Try_CampRelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, 1);

PROC
PROC_DialogFlagSetup(Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(ORI_Astarion_IPRD_TadpolePowers_State_HasTadpoleJar_f0b7c2d7-659c-4b95-a4d3-9bee3f64e725, _Var1, 1, _Var1, _Var1)
THEN
ClearFlag(ORI_Astarion_IPRD_TadpolePowers_State_HasTadpoleJar_f0b7c2d7-659c-4b95-a4d3-9bee3f64e725, _Var1);

PROC
PROC_DialogFlagSetup(Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_ORI_Astarion_HasTadpoleJar(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(ORI_Astarion_IPRD_TadpolePowers_State_HasTadpoleJar_f0b7c2d7-659c-4b95-a4d3-9bee3f64e725, _Var1);

QRY
QRY_ORI_Astarion_HasTadpoleJar((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_TadpolePowers_TadpolePowerJar_Templates(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_ItemTemplateInMagicPockets(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DialogEnded(GLO_Tadpole_Consume_b8af6722-476f-9d04-d36d-484db6e0d56f, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
AND
_Var2 != S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255
AND
DB_Players(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GetBestAvatarForCompanion(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, 1, 1, _Var1, _Var1)
AND
DB_QRYRTN_GetBestAvatarForCompanion(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _Var4, _Var1, _Var1, _Var1)
AND
_Var2 == _Var4
AND
QRY_OnlyOnce("ORI_Astarion_IPRD_TadpolePowers", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_RelationshipDialog(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_IPRD_TadpolePowers_257a1233-7539-4e92-8a9e-d43d3df16935, S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, 0);

IF
FlagSet(ORI_Astarion_State_RaphaelToldRitual_7b30820e-92e5-4f64-a2f5-92edbd9a0e2f, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_LongRestCountDown(2, ORI_Astarion_State_TwoDaysPassedAfterRaphaelToldRitual_11e1d367-03a8-421c-9618-9e8e9f654514);

IF
FlagSet(HAG_GurHunter_HasMet_50a41bc8-ab94-463f-e403-0d10b8969087, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GlobalSetFlagAndCache(HAG_GurHunter_HasMet_Global_68eca456-15af-476f-954d-261364e03655);

IF
FlagSet(ORI_Astarion_State_DiscussedCazadorAfterSCL_1d23b665-e2c1-4d61-9c53-25aff637529f, _, _, _, _)
AND
DB_GlobalFlag(CURRENTREGION_INT_Main_A_7f78a1d7-3e5e-4cd2-8fcd-f751b01c0ee0, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "ToldOtherSpawns_INT");

IF
TextEvent("ast_spawns_int", _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "ToldOtherSpawns_INT");
DB_RelationshipDialogsFinished(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, Astarion_InParty_53aba16e-55bb-a0fc-a444-522e237dbe46, ORI_Astarion_State_NeedsToDiscussCazadorAfterSCL_3c1b76cd-6d29-4780-b1b0-cfb5ffbb7bf6);

IF
QuestUpdateUnlocked((GUIDSTRING)_Var1, "ORI_COM_Astarion", "ReachedBG", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_QuestUpdateIsUnlockedForAny("ORI_COM_Astarion", "ToldOtherSpawns_INT", _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "ORI_COM_Astarion", "ReachedBG_KnowSpawns");

IF
FlagSet(ORI_Astarion_State_DiscussedCazadorAfterSCL_1d23b665-e2c1-4d61-9c53-25aff637529f, _, _, _, _)
AND
DB_GlobalFlag(CURRENTREGION_BGO_Main_A_11239767-48ad-4879-8312-b9164b6e4978, _, _, _, _)
THEN
QuestUpdate(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "ORI_COM_Astarion", "ToldOtherSpawns_WYR");

IF
FlagSet(ORI_Astarion_Knows_PoemInfernal_256ed5ae-356b-255c-bd82-e1cf2aa35c55, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_ScarsIsCazadorPoem_Global_e0384248-60ef-4ed3-9bbe-d751461c93b8, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_Knows_ScarsIsCazadorPoem_Global_e0384248-60ef-4ed3-9bbe-d751461c93b8);

IF
FlagSet(ORI_Astarion_Knows_ScarsIsCazadorPoem_Global_e0384248-60ef-4ed3-9bbe-d751461c93b8, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_State_PartySawScars_32bbdc0b-6c04-2db1-75ce-df811a8646e9);

IF
FlagSet(ORI_Astarion_Knows_RitualsPurpose_d1dc0f8a-b77d-4e40-a501-a66e163b8376, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_RitualGeneralInfo_abfca940-2838-41f1-b7dd-142ebba67137, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_Knows_RitualGeneralInfo_abfca940-2838-41f1-b7dd-142ebba67137);

IF
FlagSet(WYR_VampireSpawns_State_ToldAscension_a48047ea-da16-4451-838d-d129ed8ecbae, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Astarion_Knows_RitualGeneralInfo_abfca940-2838-41f1-b7dd-142ebba67137, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(ORI_Astarion_Knows_RitualGeneralInfo_abfca940-2838-41f1-b7dd-142ebba67137);

IF
FlagSet(ORI_Astarion_Knows_Vampireness_43c71ab0-1aca-484a-950d-54106ae46da5, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _, _, _, _)
AND
HasSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", 0, _, _)
THEN
AddSpell(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "Target_VampireBite_Astarion", 1, 0);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "ModWrapper_Gustav"
