Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_OriginNPCAlignment(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, Origin_ShadowHeart_901cd370-86ff-b538-e1e8-574c84135ca0);
DB_OriginCampFlags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, SHADOWHEART_8d98083d-b6ba-449e-a47a-be130a93d780, SHADOWHEARTAVATAR_2d6fd16d-5ddc-4d1b-9317-60e1c7076c30, SHADOWHEARTCOMPANION_09baaab1-c743-44d5-84e4-1915165b9935, SHADOWHEARTPARTY_88397c7c-b031-4cf8-be14-0fa976c85542, SHADOWHEARTCAMP_b5669a01-dc2d-475a-a29d-aedba34ab495);
DB_OriginInPartyGlobal(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ORI_ShadowHeart_State_IsInParty_9a029c5a-e3c3-45ef-9cd4-1cb45718deb1);
DB_OriginPartOfTheTeamFlag(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, GLO_Origin_PartOfTheTeam_Shadowheart_7f9ac9e8-1e8d-4bf8-8716-68215f0f066e, GLO_Origin_Avatar_Shadowheart_1a2858f5-f481-4af8-9440-1a2315df86b8, ORI_Shadowheart_ControlledByUser_a0e97ef6-0fdf-4bb6-a0fb-29275c127de2);
DB_OriginKickFromPartyFlags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ORI_Shadowheart_Event_KickCompanion_ebde864e-5493-43ef-938f-63821a67e3f9, ORI_Shadowheart_State_CanBeKicked_f81c9f73-0d01-4c5c-a2e1-ec2b07a1dcee);
DB_OriginRecruitmentDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ShadowHeart_Recruitment_f553d51e-18ed-659b-e418-56fdca0d0a0a);
DB_OriginInPartyDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ShadowHeart_InParty_95ca3833-09d0-5772-b16a-c7a5e9208fe5);
DB_OriginWarning1Dialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ShadowHeart_Warning1_b9280087-c073-468c-f6cd-f7986296a572);
DB_OriginWarning2Dialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ShadowHeart_Warning2_ac4cf9b4-b630-1092-a33c-b8f271406d3e);
DB_OriginLeavingDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ShadowHeart_Leaving_db3f8e78-2bc1-7bfe-0e4c-73ba4b2248d1);
DB_Inclusion_Object(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ORI_Inclusion_ShadowHeart_b7b419d9-2148-4acd-af40-85a1cae55204, ORI_Inclusion_End_ShadowHeart_cdc93794-08f8-4563-b721-c00872170dbf);
DB_Debug_CharacterAddFlags(Debug_AddShadowHeart_c3be7a23-a663-d778-50f9-a52f6cfe78bf, CHARACTERGUID_S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, Debug_ShadowHeartIsPlayer_50d74708-485b-4342-2b1a-2efb5f1ba211);
DB_Debug_CharacterRemoveHideFlags(Debug_RemoveHideShadowHeart_18695428-f724-c564-fa82-a6005f1d7afe, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
DB_ORI_OriginCampData(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "WLDMAIN", S_CAMP_ShadowHeart_A_0cac0d45-c68c-8c45-38f3-77bb82e5771c);
DB_ORI_OriginCampData(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "WLDCAVGRN", S_CAMP_Shadowheart_A_7bc42314-6938-8229-6cae-6925b5130c7a);
DB_ORI_OriginCampData(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "WLDCAVSND", S_CAMP_Shadowheart_A_16fb389c-5f47-8165-327f-1a071e5454e4);
DB_ORI_OriginCampData(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "WLDDUNABB", S_CAMP_Shadowheart_A_5ea25861-30fc-82f7-4666-273c5ccf68e9);
DB_ORI_OriginCampData(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "WLDDUNSHA", S_CAMP_Shadowheart_A_bf2680b0-72a0-8f14-3269-af6a83ecb77b);
DB_ORI_OriginCampData(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "WLDUND", S_CAMP_Shadowheart_A_8aedc798-cc0b-8de1-4580-eb61b04e91eb);
DB_ORI_OriginCampData(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "WLDBAS", S_CAMP_Shadowheart_A_9733851c-2260-8f30-4a62-2e260f0251a8);
DB_CompanionCanPartner(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ORI_State_DatingShadowheart_e87f1e21-a758-47ae-8c0e-9e715eb289b5, ORI_State_PartneredWithShadowheart_3808ae35-ad4e-465b-800b-63d32b77211e, ORI_State_WasPartneredWithShadowheart_542e6cf4-bfd1-471d-b4b5-693d630376cb, ORI_State_HandledBreakupWithShadowheart_d400a4f6-4a10-48a4-a425-73786e473815, ORI_State_ChosePartnerOverShadowheart_3928d3fc-b2c8-44ac-850d-e269177f8c0a, "dateshadowheart");
DB_QuestDef_State_CompanionLeft(REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, "ORI_COM_ShadowHeart", "ShadowHeartDead_SUB_Justiciar");
DB_QuestDef_State_CompanionLeft(REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, "ORI_COM_ShadowHeart", "ShadowheartLeftParty_SUB_Justiciar");
DB_QuestDef_State_CompanionLeft(REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, "ORI_COM_ShadowHeart", "CompanionHostile");
DB_QuestDef_State_CompanionLeft(REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, "ORI_COM_ShadowHeart", "CompanionLowRelation");
DB_QuestDef_State_CompanionLeft(REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, "ORI_COM_ShadowHeart", "CompanionMurdered");
SetFlag(GLO_InfernalBox_Event_ForceGiveBox_7addbb64-502f-48aa-9b71-da1b8d6c28eb, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
SetFlag(ORI_Shadowheart_State_PreFight_83208bb5-4eb9-4394-845d-954d3ec3febb, NULL_00000000-0000-0000-0000-000000000000);
DB_ORI_ShadowHeart_ADFoe(S_CRA_Escape_Mindflayer_d5385cd0-f371-43dc-a0a2-50381fc50ea4);
DB_ORI_ShadowHeart_ADFoe(S_CRA_Escape_IntDevourer3_c158fa86-3ecf-4d1b-a502-34618f77e3a9);
DB_ORI_ShadowHeart_ADFoe(S_CRA_Escape_IntDevourer1_edd4c1c0-422f-82de-1b22-4a3d734da5c8);
DB_ORI_ShadowHeart_ADFoe(S_CRA_Escape_IntDevourer2_a2838af7-698b-8761-2004-d118d80cf848);
DB_GLO_CharacterCorpseDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, Shadowheart_Dead_7ba2079b-27f5-07e9-b675-eedae0a579e7);
DB_DeadEvent(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, GLO_Shadowheart_State_Dead_49895e67-443f-46f0-96db-4f49706ac58d);
DB_State_Priority(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "TUT", 900);
DB_State_Priority(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "CHA", 1000);
DB_State_Priority(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "BEACH", 1100);
DB_State_Priority(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "DEN", 2000);
DB_State_Priority(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "CAMP", 4000);
DB_State_Priority(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "GOB", 5000);
DB_State_Flags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "CHA", GLO_Shadowheart_State_ChapelRecruitment_e16f2c82-4298-40ee-9b5d-f772b4f5c769);
DB_State_Flags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "BEACH", GLO_Shadowheart_State_BeachRecruitment_14468bb2-c6bf-4aa0-a00e-011ced4823fb);
DB_State_Flags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "DEN", GLO_Shadowheart_State_GroveRecruitment_1fd54cd1-9441-4746-a56b-56f2a206ba8c);
DB_State_Flags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "GOB", GLO_Shadowheart_State_GobRecruitment_56a87492-2550-4232-ae52-c1a01ceeacc1);
DB_State_Current(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "TUT");
PROC_State_Progress(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "CHA");

KBSECTION
PROC
PROC_CheckFirstTimeRecruited(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
THEN
NOT DB_GLO_CharacterCorpseDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, Shadowheart_Dead_7ba2079b-27f5-07e9-b675-eedae0a579e7);

PROC
PROC_ORI_Shadowheart_COM_Init()
AND
DB_GlobalFlag(ORI_ShadowheartRecruitment_State_BoxRecruit_7b706c7d-f23e-49b8-9171-6d493c947ee8, _, _, _, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "Recruited_Box");

PROC
PROC_ORI_Shadowheart_COM_Init()
AND
DB_GlobalFlag(ORI_ShadowheartRecruitment_State_RevivedShadowheart_039a34b8-395a-47db-97ea-acd66fe527e7, _, _, _, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "Recruited_Reanimated");

PROC
PROC_ORI_Shadowheart_COM_Init()
AND
DB_GlobalFlag(CAMP_ShadowheartUltimatum_State_Rest_a86925f5-c656-d1c3-59b9-95d5f7b626ea, _, _, _, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "Recruited_Camp");

PROC
PROC_ORI_Shadowheart_COM_Init()
AND
DB_GlobalFlag(DEN_Shadowheart_Event_ToDen_5e61b083-4c7f-4f1a-982f-0b4d28fbbd79, _, _, _, _)
AND NOT
DB_GlobalFlag(CAMP_ShadowheartUltimatum_State_Rest_a86925f5-c656-d1c3-59b9-95d5f7b626ea, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_ShadowheartRecruitment_State_RevivedShadowheart_039a34b8-395a-47db-97ea-acd66fe527e7, _, _, _, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "Recruited_Den");

PROC
PROC_ORI_Shadowheart_COM_Init()
AND
QuestIsAccepted(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", 0, _, _)
AND NOT
DB_GlobalFlag(ORI_ShadowheartRecruitment_State_RevivedShadowheart_039a34b8-395a-47db-97ea-acd66fe527e7, _, _, _, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "Recruited_Beach");

PROC
PROC_ORI_Shadowheart_COM_Init()
AND
DB_Players(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _, _, _, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "Recruited_Laezel");

PROC
PROC_ORI_Shadowheart_COM_Init()
AND NOT
DB_Players(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var1, GITHYANKI_677ffa76-2562-4217-873e-2253d4720ba4, 1, _Var1, _Var1)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "Recruited_Githyanki");

IF
FlagSet(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND
_Var3 != S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679
AND
IsTagged(_Var3, SHAR_486e4a27-e6f9-40a5-9dd1-108a1d0f60eb, 1, _, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "LearnedSharWorship_Many");

IF
FlagSet(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, _, _)
AND
QuestUpdateIsUnlocked(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "LearnedSharWorship_Many", 0, _)
THEN
QuestUpdate(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_COM_ShadowHeart", "LearnedSharWorship_Alone");

IF
FlagSet(GLO_ShadowHeart_Knows_WildMagic_1759ac9b-47bb-bfdb-be9f-bedb6e6847d3, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "SawWildMagic");

IF
FlagSet(GLO_ShadowHeart_Knows_CityGoal_e1e57952-2b37-cc62-4e69-c0e4c2713c4e, _, (INTEGER)_Var2, _, _)
AND
DB_DialogName(CAMP_Shadowheart_IVB_CFM_LaezelFight_23f9c168-1017-fc9f-ed65-7e8a1e33a09f, _Var2, _, _, _)
AND
DB_GlobalFlag(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
AND
QRY_OnlyOnce("ORI_COM_ShadowHeart_LearnedMission", _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "LearnedMission_KnowShar_KnowBoxMission");

IF
FlagSet(GLO_ShadowHeart_Knows_CityGoal_e1e57952-2b37-cc62-4e69-c0e4c2713c4e, _, (INTEGER)_Var2, _, _)
AND
DB_DialogName(CAMP_Shadowheart_IVB_CFM_LaezelFight_23f9c168-1017-fc9f-ed65-7e8a1e33a09f, _Var2, _, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
AND
QRY_OnlyOnce("ORI_COM_ShadowHeart_LearnedMission", _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "LearnedMission_UnknowShar_KnowBoxMission");

IF
FlagSet(GLO_ShadowHeart_Knows_CityGoal_e1e57952-2b37-cc62-4e69-c0e4c2713c4e, _, (INTEGER)_Var2, _, _)
AND
DB_GlobalFlag(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
AND
QRY_OnlyOnce("ORI_COM_ShadowHeart_LearnedMission", _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "LearnedMission_KnowShar_UnknowBoxMission");

IF
FlagSet(GLO_ShadowHeart_Knows_CityGoal_e1e57952-2b37-cc62-4e69-c0e4c2713c4e, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
AND
QRY_OnlyOnce("ORI_COM_ShadowHeart_LearnedMission", _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "LearnedMission_UnknowShar_UnknowBoxMission");

IF
FlagSet(CAMP_ShadowheartLaezelFight_State_ResolvedPeacefully_f212b8b3-0490-1663-4645-e4fa7ca350e4, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "CampFight_Peace");

IF
Died(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _, _, _, _)
AND
GetFlag(CAMP_Shadowheart_Event_Fight_9e208379-c14f-b65a-c4a2-a029162939cb, S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, 1, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "ORI_COM_ShadowHeart", "CampFight_LaezelDied");

IF
Died(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
GetFlag(CAMP_Shadowheart_Event_Fight_9e208379-c14f-b65a-c4a2-a029162939cb, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "ORI_COM_ShadowHeart", "CampFight_ShadowheartDied");

PROC
PROC_ORI_Shadowheart_COM_Init()
THEN
PROC_TriggerRegisterForPlayers(S_UND_SharTempleVista_77fb985c-36ee-47b6-8d5e-b2304613e13f);

IF
FlagSet((GUIDSTRING)_Var1, _, (INTEGER)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(ORI_Shadowheart_Knows_BecomeJusticiar_c29b8679-3e0b-43f9-8578-2a5d7659180e, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var3, _Var4, _, _Var1, _Var1)
THEN
QuestUpdate(_Var4, "ORI_COM_ShadowHeart", "SearchJusticiarLair_KnowShar");

IF
TextEvent("test", _, _, _, _)
THEN
QuestUpdate("ORI_COM_ShadowHeart", "SearchJusticiarLair_KnowShar");

IF
FlagSet((FLAG)_Var1, _, (INTEGER)_Var3, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GlobalFlag(ORI_Shadowheart_Knows_BecomeJusticiar_c29b8679-3e0b-43f9-8578-2a5d7659180e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var3, _Var4, _, _Var1, _Var1)
THEN
QuestUpdate(_Var4, "ORI_COM_ShadowHeart", "SearchJusticiarLair_UnknowShar");

IF
FlagSet(UND_DarkJusticiars_Quest_FoundCorpses_d0385e17-0730-4c65-863d-0235395a05ed, _, (INTEGER)_Var2, _, _)
AND
DB_GlobalFlag(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "FoundJusiticiar_KnowShar");

IF
FlagSet(UND_DarkJusticiars_Quest_FoundCorpses_d0385e17-0730-4c65-863d-0235395a05ed, _, (INTEGER)_Var2, _, _)
AND NOT
DB_GlobalFlag(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "FoundJusiticiar_UnknowShar");

IF
FlagSet(UND_DarkJusticiars_Quest_FoundFiends_8393d02d-0343-48b5-a27b-1c35e3641e37, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
AND
QRY_OnlyOnce("UND_DarkJusticiars_FoughtMerregon", _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "FoughtFiends");

IF
EnteredCombat(S_UND_KethericCity_LostMerregon_07e9b38f-624c-45db-b3fa-b45737314796, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("UND_DarkJusticiars_FoughtMerregon", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var2, "ORI_COM_ShadowHeart", "FoughtFiends");

IF
EnteredTrigger((GUIDSTRING)_Var1, S_UND_DuergarCamp_SUB_05c3bf1f-29a6-437c-9a98-c1ff0ec53a53, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_OnlyOnce("RecruitedFirstTime_ShadowHeart", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "ORI_COM_ShadowHeart", "EnteredKethericCity");

IF
FlagSet(UND_DarkJusticiars_Quest_HeardSharTemple_810cc654-76ab-4070-af16-47147dbea6b8, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "HeardSharTemple");

IF
FlagSet(UND_DarkJusticiars_Quest_HeardSharTempleBlocked_f99761c4-132c-47f0-92bc-f466b5de7cbb, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
AND
QRY_OnlyOnce("UND_DarkJusticiars_LearnedBlocked", _, _, _, _)
THEN
QuestUpdate(_Var3, "ORI_COM_ShadowHeart", "HeardSharTemplePathBlocked");

IF
EnteredTrigger((GUIDSTRING)_Var1, S_UND_SharTempleVista_77fb985c-36ee-47b6-8d5e-b2304613e13f, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "ORI_COM_ShadowHeart", "HeardSharTemple", 1, _Var1)
AND
QRY_OnlyOnce("UND_DarkJusticiars_LearnedBlocked", _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("UND_DarkJusticiars_SharVistaSeen", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(S_UND_SharTempleVista_77fb985c-36ee-47b6-8d5e-b2304613e13f);
QuestUpdate(_Var1, "ORI_COM_ShadowHeart", "HeardSharTemplePathBlocked");

IF
EnteredTrigger((CHARACTER)_Var1, S_UND_SharTempleVista_77fb985c-36ee-47b6-8d5e-b2304613e13f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "ORI_COM_ShadowHeart", "HeardSharTemple", 0, _Var1)
AND
QRY_OnlyOnce("UND_DarkJusticiars_SharVistaSeen", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(S_UND_SharTempleVista_77fb985c-36ee-47b6-8d5e-b2304613e13f);
QuestUpdate(_Var1, "ORI_COM_ShadowHeart", "WalkedSharTemplePathBlocked");

PROC
PROC_GLO_PartyMembers_AddHook(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("RecruitedFirstTime_ShadowHeart", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ORI_SetupCamp(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 0);
SetFlag(ORI_ShadowHeart_HasMet_d06842a4-248e-7f83-da87-4eec7606178e, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_GLO_PartyMembers_AddHook(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND NOT
DB_CurrentLevel("TUT_Avernus_C", _, _, _, _)
AND
QRY_OnlyOnce("ORI_ShadowHeart_COM_Init", _, _, _, _)
THEN
PROC_ORI_Shadowheart_COM_Init();

IF
EntityEvent(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "ORI_ToCamp", _, _, _)
AND
QRY_OnlyOnce("ORI_ShadowHeart_COM_Init", _, _, _, _)
THEN
PROC_ORI_Shadowheart_COM_Init();

PROC
PROC_ORI_Shadowheart_COM_Init()
AND
DB_GlobalFlag(TUT_TransformChamber_State_FreedShadowheart_c3980ab3-9370-4c2d-9c76-38aff5fe575a, _, _, _, _)
THEN
SetFlag(ORI_Shadowheart_Event_LaezelFirst_d68af374-5808-5b37-210c-21f9e1c8c201, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_ORI_Shadowheart_COM_Init()
AND NOT
DB_GlobalFlag(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, _, _)
THEN
DB_StoryHideGodTags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

IF
FlagSet(ShadowHeart_InParty_Knows_SharWorshipper_634f858d-9b54-0711-e31f-075d304422ab, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
NOT DB_StoryHideGodTags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

IF
TextEvent("shadowheart2camp", _, _, _, _)
THEN
PROC_ORI_SetupCamp(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1);

IF
EntityEvent(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "DebugTeleportedToCamp", _, _, _)
THEN
PROC_ORI_SetupCamp(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1);

IF
DB_ORI_ShadowHeart_ADFoe(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_ShadowHeart_ADFoe(_Var1);

IF
DB_ORI_ShadowHeart_ADFoe(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_OnlyOnce("ORI_ShadowHeart_FirstCombatVB", _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_ShadowHeart_ADFoe(_Var1);

IF
DB_CHA_OutsideBandits(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_ShadowHeart_ADFoe(_Var1);

IF
DB_CHA_InsideBandits(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_ORI_ShadowHeart_ADFoe(_Var1);

IF
DB_CHA_Outpost_CreviceFoe(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_ORI_ShadowHeart_ADFoe(_Var1);

IF
DB_DEN_HarpyMeal_Harpies(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_ORI_ShadowHeart_ADFoe(_Var1);

IF
DB_DEN_GoblinScouts(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_ShadowHeart_ADFoe(_Var1);

IF
EnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_ORI_ShadowHeart_ADFoe(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_ORI_ShadowHeart_FirstCombat(_Var2, 1);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_ORI_ShadowHeart_FirstCombat(_Var2, 1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679
THEN
DB_ORI_ShadowHeart_FirstCombat(_Var2, 2);

IF
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_ORI_ShadowHeart_FirstCombat(_Var2, 1, _Var1, _Var1, _Var1)
THEN
DB_ORI_ShadowHeart_FirstCombat(_Var2, 0);

QRY
QRY_ORI_ShadowHeart_EnemyRemains((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_IsEnemy(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
LeftCombat(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_OnlyOnce("ORI_ShadowHeart_FirstCombatVB", _Var1, _Var1, _Var1, _Var1)
AND
DB_ORI_ShadowHeart_FirstCombat(_Var1, 2, _Var1, _Var1, _Var1)
AND NOT
DB_ORI_ShadowHeart_FirstCombat(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_Players(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_ORI_ShadowHeart_EnemyRemains(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(ORI_ShadowHeart_AD_SuccessfulCombat_23bccc36-35be-91ca-a3d0-a8f954629e06, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 0, 0, 0, 0, _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("ORI_ShadowHeart_FirstCombatVB");

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_ORI_ShadowHeart_FirstCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_ORI_ShadowHeart_FirstCombat(_Var1, _Var2);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "ModWrapper_Gustav"
