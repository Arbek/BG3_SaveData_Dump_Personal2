Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_UND_EbonLake_Raft_Parts(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d, S_UND_EbonLake_RaftAtCave_FullRaft_a24aa852-9f72-48bc-8d94-7a92da7ca4c1);
DB_UND_EbonLake_Raft_Parts(S_UND_EbonLake_RaftInvisibleHelperAtCamp_98ee3fd4-031b-4d3a-b305-34b4889c2040, S_UND_EbonLake_RaftAtCamp_FullRaft_eec3661a-7173-48c2-8793-2970d2c9618d);
DB_UND_EbonLake_Raft_Dialogs(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d, UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f);
DB_UND_EbonLake_Raft_Dialogs(S_UND_EbonLake_RaftInvisibleHelperAtCamp_98ee3fd4-031b-4d3a-b305-34b4889c2040, UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f);
DB_UND_EbonLake_Raft_Dialogs(S_UND_EbonLake_RaftInvisibleHelperAtLake_7a06c836-c692-4682-afcb-a67421b43c5a, UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f);
DB_BlockPolymorphDialog(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f);
DB_UND_EbonLake_Raft_DefaultLocations(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d, UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8);
DB_UND_EbonLake_Raft_DefaultLocations(S_UND_EbonLake_RaftInvisibleHelperAtLake_7a06c836-c692-4682-afcb-a67421b43c5a, UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650);
DB_UND_EbonLake_Raft_DefaultLocations(S_UND_EbonLake_RaftInvisibleHelperAtCamp_98ee3fd4-031b-4d3a-b305-34b4889c2040, UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5);
DB_UND_EbonLake_Raft_Locations(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d, UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, UND_EbonLake_Event_MoveToLake_c3786fb8-8c5e-4ad5-8742-3b50477aedfa);
DB_UND_EbonLake_Raft_Locations(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d, UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, UND_EbonLake_Event_MoveToCamp_0da8fee9-b7cb-4551-9baa-ec930c118716);
DB_UND_EbonLake_Raft_Locations(S_UND_EbonLake_RaftInvisibleHelperAtLake_7a06c836-c692-4682-afcb-a67421b43c5a, UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, UND_EbonLake_Event_MoveToCave_00de3138-c329-4446-86a0-33c0b2956793);
DB_UND_EbonLake_Raft_Locations(S_UND_EbonLake_RaftInvisibleHelperAtLake_7a06c836-c692-4682-afcb-a67421b43c5a, UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, UND_EbonLake_Event_MoveToCamp_0da8fee9-b7cb-4551-9baa-ec930c118716);
DB_UND_EbonLake_Raft_Locations(S_UND_EbonLake_RaftInvisibleHelperAtCamp_98ee3fd4-031b-4d3a-b305-34b4889c2040, UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, UND_EbonLake_Event_MoveToCave_00de3138-c329-4446-86a0-33c0b2956793);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, 1, S_UND_DarkLake_BoatPassengerPositionAtCave_906d8dc6-3824-4d37-a09a-40d49831ef74);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, 2, S_UND_DarkLake_BoatPassengerPositionAtCave_906d8dc6-3824-4d37-a09a-40d49831ef74);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, 3, S_UND_DarkLake_BoatPassengerPositionAtCave_906d8dc6-3824-4d37-a09a-40d49831ef74);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, 4, S_UND_DarkLake_BoatPassengerPositionAtCave_906d8dc6-3824-4d37-a09a-40d49831ef74);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, 1, S_UND_DarkLake_PlayerPositionOnBoat_001_5fcbda6a-c5fa-42ce-99b4-026c7c437833);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, 2, S_UND_DarkLake_PlayerPositionOnBoat_002_901baaec-bbfd-4d73-bba7-1b6274438e9d);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, 3, S_UND_DarkLake_PlayerPositionOnBoat_003_568d79f5-d6a7-4b3d-a3a1-dd3b1ef721e4);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, 4, S_UND_DarkLake_PlayerPositionOnBoat_004_3aa8d1e5-ea5e-425e-a47e-8f37a0908f26);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, 1, S_UND_DarkLake_BoatPassengerPositionAtCamp_3478b34d-0e4f-4a4b-8f9f-b7d9361eec8b);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, 2, S_UND_DarkLake_BoatPassengerPositionAtCamp_3478b34d-0e4f-4a4b-8f9f-b7d9361eec8b);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, 3, S_UND_DarkLake_BoatPassengerPositionAtCamp_3478b34d-0e4f-4a4b-8f9f-b7d9361eec8b);
DB_UND_EbonLake_Raft_Locations_PlayerPositions(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, 4, S_UND_DarkLake_BoatPassengerPositionAtCamp_3478b34d-0e4f-4a4b-8f9f-b7d9361eec8b);
DB_UND_EbonLake_Raft_Hideable(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d, UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, S_UND_EbonLake_RaftAtCave_FullRaft_a24aa852-9f72-48bc-8d94-7a92da7ca4c1, 1);
DB_UND_EbonLake_Raft_Hideable(S_UND_EbonLake_RaftInvisibleHelperAtCamp_98ee3fd4-031b-4d3a-b305-34b4889c2040, UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, S_UND_EbonLake_RaftAtCamp_FullRaft_eec3661a-7173-48c2-8793-2970d2c9618d, 0);
DB_UND_EbonLake_Raft_ComposeCrewFromTrigger(S_UND_EbonLake_RaftInvisibleHelperAtLake_7a06c836-c692-4682-afcb-a67421b43c5a, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9);
DB_GLO_CompoundFlag(UND_DarkLake_State_PeacefulResolution_629a38e0-ba91-2a6b-bdcc-636fdbb9d20e, UND_DarkLake_State_LakeEncounterHappened_8fbcde00-13b9-633c-7ccf-2486d983ca3e);
DB_GLO_CompoundFlag(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, UND_DarkLake_State_LakeEncounterHappened_8fbcde00-13b9-633c-7ccf-2486d983ca3e);
DB_AddCharactersInTriggerToDialog(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f, S_UND_DarkLake_BoatDialogTriggerAtCave_d3060315-27c6-4060-b4ca-335dc03bf2d0, 1, 0, 1);
DB_AddCharactersInTriggerToDialog(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, 1, 0, 1);
DB_AddCharactersInTriggerToDialog(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, 1, 0, 1);
SetFlag(UND_DarkLake_State_DuergarsAtLake_85d7bbfc-bffe-48bb-955d-f1f450b16e39, NULL_00000000-0000-0000-0000-000000000000);
TriggerRegisterForCharacter(S_UND_DarkLake_RaftCaptainBoxOnPlayerRaft_e8dcba26-a7e1-4a72-8d9d-4a6f52dd3eef, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec);
DB_UND_DuergarSquad(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec);
DB_UND_DuergarSquad(S_UND_DuergarSquadDefiant_3cec487d-d5cf-42c9-a009-0124cb432341);
DB_UND_DuergarSquad(S_UND_DuergarSquadDilligent_a7338653-4d88-440e-aee6-4d5b3e611a2d);
DB_UND_DuergarSquad(S_UND_DuergarSquadRatty_64e38ef0-9779-499c-9f0a-ea013ee81442);
DB_UND_DuergarSquad(S_UND_DuergarSquadRude_b15669aa-831b-43d7-ac7b-efea2eb09018);
DB_UND_DuergarSquad(S_UND_DuergarSquadAlchemist_2243e892-f360-44cf-b2ef-90364059dd22);
DB_UND_DuergarSquad_PositionsAtShore(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_UND_DarkLake_AfterCombatPosition_000_a14be182-83c7-41a6-818c-1660bb78f910);
DB_UND_DuergarSquad_PositionsAtShore(S_UND_DuergarSquadDefiant_3cec487d-d5cf-42c9-a009-0124cb432341, S_UND_DarkLake_AfterCombatPosition_001_d1cc2458-259a-4655-950a-0fa8387e021f);
DB_UND_DuergarSquad_PositionsAtShore(S_UND_DuergarSquadDilligent_a7338653-4d88-440e-aee6-4d5b3e611a2d, S_UND_DarkLake_AfterCombatPosition_002_e786d8e9-43a1-47f2-a0a4-a8ee4625e160);
DB_UND_DuergarSquad_PositionsAtShore(S_UND_DuergarSquadRatty_64e38ef0-9779-499c-9f0a-ea013ee81442, S_UND_DarkLake_AfterCombatPosition_003_f48f438b-c619-4203-9a5b-5b56a4347b70);
DB_UND_DuergarSquad_PositionsAtShore(S_UND_DuergarSquadRude_b15669aa-831b-43d7-ac7b-efea2eb09018, S_UND_DarkLake_AfterCombatPosition_004_5946d2b1-c154-44f8-8372-ebf5a3eb1b5d);
DB_UND_DuergarSquad_PositionsAtShore(S_UND_DuergarSquadAlchemist_2243e892-f360-44cf-b2ef-90364059dd22, S_UND_DarkLake_AfterCombatPosition_005_adff257e-73d3-4f08-9219-b818e0fd9808);
DB_Dialogs(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc);
DB_Dialogs(S_UND_DuergarSquadDefiant_3cec487d-d5cf-42c9-a009-0124cb432341, UND_DuergarSquadDefiant_66347140-d6d5-9b5e-04b0-4602e0bd6339);
DB_Dialogs(S_UND_DuergarSquadDilligent_a7338653-4d88-440e-aee6-4d5b3e611a2d, UND_DuergarSquadDilligent_cf562f4e-1a0f-71ff-1637-37200d1efb5a);
DB_Dialogs(S_UND_DuergarSquadRatty_64e38ef0-9779-499c-9f0a-ea013ee81442, UND_DuergarSquadRatty_245eb40c-fa30-e79e-7695-3497433d1a9c);
DB_Dialogs(S_UND_DuergarSquadRude_b15669aa-831b-43d7-ac7b-efea2eb09018, UND_DuergarSquadRude_981754dd-ffd5-40c4-d465-51d1308a177c);
DB_Dialogs(S_UND_DuergarSquadAlchemist_2243e892-f360-44cf-b2ef-90364059dd22, UND_DuergarSquadAlchemist_b12a3303-3f06-0a29-54fb-5ae03b18064a);
DB_DialogBlockTradeButton(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc);
DB_UND_EbonLake_RaftCaptainTrackDialogAttack(1);
DB_DangerZone(S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, "UND_EbonLake_LakeEncounter");
PROC_TriggerRegisterForPlayers(S_UND_DarkLake_BoatDialogTriggerAtCave_d3060315-27c6-4060-b4ca-335dc03bf2d0);
PROC_TriggerRegisterForPlayers(S_UND_DarkLake_BoatDialogTriggerAtCave_ReadyCheck_90302dc3-8659-4b13-beb3-0194ccb3be38);
PROC_TriggerRegisterForPlayers(S_UND_DarkLake_BoatAtCaveArea_ec8377d5-69da-43bb-a4e4-6de0caf59924);
PROC_TriggerRegisterForPlayers(S_UND_DarkLake_LakeVB_14a19173-ec4c-403a-bfb1-715bc1430219);
SetFlag(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, NULL_00000000-0000-0000-0000-000000000000);
DB_FlagReactionAfterDialog(UND_DarkLake_Event_PushRaftCaptainOffRaft_fa9f5b35-925c-c18d-4d00-6497194b1293, DIALOGRESOURCEGUID_UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc);
DB_FlagReactionAfterDialog(UND_DarkLake_Event_MoveToCave_d580a352-2202-7c43-07c6-3ede5683cb0f, UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc);
DB_GlobalFlagReactionAfterDialog(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, DIALOGRESOURCEGUID_UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc);
DB_GlobalFlagReactionAfterDialog(UND_DarkLake_State_PeacefulResolution_629a38e0-ba91-2a6b-bdcc-636fdbb9d20e, DIALOGRESOURCEGUID_UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc);
DB_AutoSaveTrigger(S_UND_DarkLake_Autosave_218c10ed-142f-4952-970f-3db54bf7bf71);
DB_OneShot_VoiceBarkTrigger(S_UND_DarkLake_LakeVB_14a19173-ec4c-403a-bfb1-715bc1430219, UND_DarkLake_VB_FoundBoat_1dd40113-54e6-c3ef-01df-d778bd964e7b, "PerUserAndNearbyPlayers");
SetOnStage(S_UND_DarkLake_Patrol_000_cb258cd3-3b7f-48b4-883e-a008ea6e9e38, 0);
SetOnStage(S_UND_DarkLake_Patrol_001_a154f62e-771e-4bac-8af6-c28d62019d1a, 0);
DB_UND_EbonLake_BoatsAtCamp(S_UND_DuergarCamp_Boat001_75d50606-a7ff-4b37-9791-6cb80f2dbbb6);
DB_UND_EbonLake_BoatsAtCamp(S_UND_DuergarCamp_Boat002_8206ab2e-3a61-4412-916d-53487698f7f6);
DB_UND_EbonLake_BoatsAtCamp(S_UND_DuergarCamp_Boat003_a3e38c4f-c095-4ec0-892c-cec99e8ded5e);
DB_UND_EbonLake_BoatsAtCamp(S_UND_DuergarCamp_Boat004_04b4dff4-faef-4d03-9e20-d75f068ce8fb);
DB_UND_EbonLake_BoatsAtCave(S_UND_DuergarCamp_BoatAtCave_f350ecc8-67ab-4ffa-ba0f-2ca6a4bc9845);
DB_FlagReactionAfterDialog(UND_DarkLake_Event_MoveToCaveOnBoat_443df3f1-d0c4-4e72-a968-194ee6dc6c40, UND_DarkLake_DuergarBoatAtCamp_b7ab6b74-0da5-938f-40e3-ae8d1222c77a);
DB_FlagReactionAfterDialog(UND_DarkLake_Event_MoveToCampOnBoat_28ab45e0-54ae-48a3-a164-82f39971e64e, UND_DarkLake_DuergarBoatAtCave_0c3d00d8-77ac-d41e-0ed2-f2d213d94c00);
DB_DialogBlockTradeButton(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e);
DB_DialogBlockAttackButton(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e);
DB_GlobalFlagReactionAfterDialog(UND_DuergarCamp_State_DocsHostile_c2e36c80-970a-4fc0-ac4b-45a665bbfcd4, UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e);
PROC_TriggerRegisterForPlayers(S_UND_DarkLake_BoatAtCampArea_467f81f9-f1d6-4c2a-a3d5-1ac0d8897b76);
DB_DialogMoneyTransfer(1, UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e, 100);
DB_AddCharactersInTriggerToDialog(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e, S_UND_DarkLake_BoatAtCampArea_467f81f9-f1d6-4c2a-a3d5-1ac0d8897b76, 1);
TriggerRegisterForItems(S_UND_DarkLake_LakeEncounter_ItemTrigger_81f523da-e930-433f-8734-4988d3bdd1ef);

KBSECTION
IF
EnteredTrigger(_, S_UND_DarkLake_BoatAtCampArea_467f81f9-f1d6-4c2a-a3d5-1ac0d8897b76, _, _, _)
AND
GetFlag(Debug_UND_DarkLake_HostileResolution_1eb679da-0be9-cb33-4f02-b4c7ebd4e72a, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
PROC_Debug_UND_EbonLake_HostileResolution();

PROC
PROC_Debug_UND_EbonLake_HostileResolution()
THEN
SetFlag(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(UND_DarkLake_State_LakeEncounterHappened_8fbcde00-13b9-633c-7ccf-2486d983ca3e, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, NULL_00000000-0000-0000-0000-000000000000);
PROC_UND_EbonLake_Raft_Show(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5);
PROC_UND_EbonLake_Raft_Hide(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d);
PROC_GlobalClearFlagAndCache(Debug_UND_DarkLake_HostileResolution_1eb679da-0be9-cb33-4f02-b4c7ebd4e72a);
ObjectTimerLaunch(S_UND_DuergarGuard_AtPier_01_5ff28d97-e070-4805-a856-3112df670e1f, "UND_DuergarCamp_DocsCheckpoint", 1000);

IF
ObjectTimerFinished(S_UND_DuergarGuard_AtPier_01_5ff28d97-e070-4805-a856-3112df670e1f, "UND_DuergarCamp_DocsCheckpoint", _, _, _)
THEN
DB_SpotPlayers(S_UND_DuergarGuard_AtPier_01_5ff28d97-e070-4805-a856-3112df670e1f, "UND_DuergarCamp_DocsCheckpoint", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_Debug_UND_EbonLake_HostileResolution()
AND
DB_UND_DuergarSquad(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, 1);
SetOnStage(_Var1, 0);

IF
EnteredTrigger(_, S_UND_DarkLake_BoatAtCampArea_467f81f9-f1d6-4c2a-a3d5-1ac0d8897b76, _, _, _)
AND
GetFlag(Debug_UND_DarkLake_PeacefulResolution_c7997694-456a-1529-be70-362b77c1050a, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
SetCombatGroupID(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "");
PROC_Debug_UND_EbonLake_PeacefulResolution();

PROC
PROC_Debug_UND_EbonLake_PeacefulResolution()
THEN
SetFlag(UND_DarkLake_State_PeacefulResolution_629a38e0-ba91-2a6b-bdcc-636fdbb9d20e, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(UND_DarkLake_State_LakeEncounterHappened_8fbcde00-13b9-633c-7ccf-2486d983ca3e, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, NULL_00000000-0000-0000-0000-000000000000);
PROC_UND_EbonLake_Raft_Show(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5);
PROC_UND_EbonLake_Raft_Hide(S_UND_EbonLake_RaftInvisibleHelperAtCave_dc1b4e53-bd15-43d7-8a19-0fc32e875e7d);
TeleportTo(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_Debug_DuergarCamp_bf6e6f0b-0e6c-47e6-bff4-474a427372a0);
SetOnStage(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, 1);
ObjectTimerLaunch(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "UND_DarkLake_RaftCaptain_StartSpottingInCamp", 1000);
PROC_GlobalClearFlagAndCache(Debug_UND_DarkLake_PeacefulResolution_c7997694-456a-1529-be70-362b77c1050a);

IF
TextEvent("debug_toraft", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(S_UND_LoneDuergar_BoatGuard_8146788d-9d39-4cf2-99ca-03484deb0c55);
Die(S_UND_LoneDuergar_05c338d9-4590-4c4b-b87e-8c27ea2c2b18);
SetFlag(Debug_ShadowHeartIsPlayer_50d74708-485b-4342-2b1a-2efb5f1ba211, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(Debug_AddShadowHeart_c3be7a23-a663-d778-50f9-a52f6cfe78bf, _Var1);
PROC_TeleportPartiesTo(S_UND_DarkLake_BoatPassengerPositionAtCave_906d8dc6-3824-4d37-a09a-40d49831ef74, "");

IF
DB_UND_DuergarSquad(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "UND_EbonLake_DuergarSquad");

IF
DB_UND_EbonLake_Raft_Hideable(_, _, _Var3, 0, _)
THEN
SetOnStage(_Var3, 0);

IF
UseFinished((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, 1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_Parts(_Var3, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_UND_EbonLake_ProcessUseOfRaft(_Var1, _Var3);

PROC
PROC_UND_EbonLake_ProcessUseOfRaft((GUIDSTRING)_Var1, (ITEM)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_Dialogs(_Var2, _Var3, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_UND_EbonLake_RaftUsed(_Var3, _Var1);
SysClear("DB_UND_EbonLake_ReadyPlayers", 1);
PROC_UND_EbonLake_RaftUsedReadyCheck(_Var1);

PROC
PROC_UND_EbonLake_RaftUsedReadyCheck((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_UND_EbonLake_GetPlayerInRaftTrigger(_Var1, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var1, _Var1)
AND
DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_UND_EbonLake_GetPlayerInRaftTrigger(_Var1, _Var2, NULL_00000000-0000-0000-0000-000000000000, _Var1, _Var1)
AND
DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_UND_EbonLake_GetPlayerInRaftTrigger(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_UND_EbonLake_ReadyPlayers(_Var1);
DB_UND_EbonLake_ReadyPlayers(_Var2);
DB_UND_EbonLake_ReadyPlayers(_Var3);
DB_UND_EbonLake_ReadyPlayers(_Var4);
PROC_UND_EbonLake_BlockReadyCheckForGlutOwner(_Var1);
PROC_UND_EbonLake_BlockReadyCheckForGlutOwner(_Var2);
PROC_UND_EbonLake_BlockReadyCheckForGlutOwner(_Var3);
PROC_UND_EbonLake_BlockReadyCheckForGlutOwner(_Var4);
PROC_UND_EbonLake_ReadyCheckSpecific(_Var1, _Var2, _Var3, _Var4);

PROC
PROC_UND_EbonLake_BlockReadyCheckForGlutOwner((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
CharacterGetOwner(S_UND_Myconid_BroodingSovereign_82af0858-d739-4c9d-84c8-5e6760e22e46, _Var1, _Var1, _Var1, _Var1)
THEN
DB_UND_EbonLake_GlutOwnerReadyCheckBlocked(_Var1);
SetReadyCheckBlocked(_Var1, 1);
PROC_UND_BroodingSovereign_GoHome(_Var1);
PROC_UND_BroodingSovereign_LeaveDialog(UND_Myconid_BroodingSovereign_Raft_f6f33683-5889-e6b0-e6a9-0810856ec3ea, _Var1, _Var1);

PROC
PROC_UND_EbonLake_ReadyCheckSpecific((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var3, (CHARACTER)_Var4, (CHARACTER)_Var1)
AND
_Var2 == NULL_00000000-0000-0000-0000-000000000000
AND
DB_UND_EbonLake_GlutOwnerReadyCheckBlocked(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_UND_EbonLake_GlutOwnerReadyCheckBlocked(_Var5);
SetReadyCheckBlocked(_Var5, 0);

PROC
PROC_UND_EbonLake_ReadyCheckSpecific((GUIDSTRING)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var3, (CHARACTER)_Var4, (GUIDSTRING)_Var1)
AND
_Var2 == NULL_00000000-0000-0000-0000-000000000000
AND
DB_UND_EbonLake_RaftUsed(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_UND_EbonLake_ReadyCheckSpecific((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var3, (CHARACTER)_Var4, (CHARACTER)_Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
ReadyCheckSpecific("ReadyCheck_EbonLake", "ReadyCheck_EbonLake", 0, _Var1, _Var2, _Var3, _Var4);

QRY
QRY_UND_EbonLake_GetPlayerInRaftTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SysClear("DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger", 1);

QRY
QRY_UND_EbonLake_GetPlayerInRaftTrigger((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var4, S_UND_DarkLake_BoatDialogTriggerAtCave_ReadyCheck_90302dc3-8659-4b13-beb3-0194ccb3be38, 1, _Var1, _Var1)
AND NOT
DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger(_, _Var1, _Var1, _Var1, _Var1)
AND
_Var4 != _Var1
AND NOT
QRY_SameUser(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
_Var4 != _Var2
AND NOT
QRY_SameUser(_Var4, _Var2, _Var1, _Var1, _Var1)
AND
_Var4 != _Var3
AND NOT
QRY_SameUser(_Var4, _Var3, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger(_Var4);

QRY
QRY_UND_EbonLake_GetPlayerInRaftTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_UND_EbonLake_GetPlayerInRaftTrigger(NULL_00000000-0000-0000-0000-000000000000);

IF
ReadyCheckPassed("ReadyCheck_EbonLake", (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_UND_EbonLake_RaftUsed(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
ReadyCheckPassed("ReadyCheck_EbonLake", (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_UND_EbonLake_RaftUsed(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SysClear("DB_UND_EbonLake_RaftUsed", 2);

IF
ReadyCheckPassed("ReadyCheck_EbonLake", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_EbonLake_GlutOwnerReadyCheckBlocked(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_UND_EbonLake_GlutOwnerReadyCheckBlocked(_Var1);
SetReadyCheckBlocked(_Var1, 0);

IF
ReadyCheckFailed("ReadyCheck_EbonLake", (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_UND_EbonLake_RaftUsed(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SysClear("DB_UND_EbonLake_RaftUsed", 2);

IF
ReadyCheckFailed("ReadyCheck_EbonLake", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_EbonLake_GlutOwnerReadyCheckBlocked(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_UND_EbonLake_GlutOwnerReadyCheckBlocked(_Var1);
SetReadyCheckBlocked(_Var1, 0);

IF
DialogEnded((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_UND_EbonLake_Raft_Dialogs(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_DefaultLocations(_Var4, _Var5, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_Locations(_Var4, _Var6, _Var7, _Var1, _Var1)
AND
DB_DialogPlayers(_Var2, _Var8, 1, _Var1, _Var1)
AND
GetFlag(_Var7, _Var8, 1, _Var1, _Var1)
THEN
ClearFlag(_Var7, _Var8);
PROC_UND_EbonLake_PrepareAndMoveRaft_Internal(_Var4, _Var8, _Var6);

PROC
PROC_UND_EbonLake_PrepareAndMoveRaft_Internal((ITEM)_Var1, (GUIDSTRING)_Var2, (FLAG)_Var3, (ITEM)_Var1, (ITEM)_Var1)
AND NOT
DB_UND_EbonLake_Raft_ComposeCrewFromTrigger(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_UND_EbonLake_PrepareAndMoveRaft(_Var1, _Var2, _Var3);

PROC
PROC_UND_EbonLake_PrepareAndMoveRaft_Internal((ITEM)_Var1, (CHARACTER)_Var2, (FLAG)_Var3, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_UND_EbonLake_Raft_ComposeCrewFromTrigger(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_UND_EbonLake_PrepareAndMoveRaftFromTrigger(_Var1, _Var4, _Var3);

PROC
PROC_UND_EbonLake_PrepareAndMoveRaft((ITEM)_Var1, (GUIDSTRING)_Var2, (FLAG)_Var3, (ITEM)_Var1, (ITEM)_Var1)
THEN
SysClear("DB_UND_EbonLake_Raft_Captain", 1);
SysClear("DB_UND_EbonLake_Raft_Crew", 1);
PROC_UND_EbonLake_Raft_ComposeCrew(_Var2);
PROC_UND_EbonLake_Raft_MoveCrewIn();
PROC_UND_EbonLake_Raft_Hide(_Var1);
PROC_UND_EbonLake_Raft_Move(_Var3);

PROC
PROC_UND_EbonLake_PrepareAndMoveRaftFromTrigger((ITEM)_Var1, (TRIGGER)_Var2, (FLAG)_Var3, (ITEM)_Var1, (ITEM)_Var1)
THEN
SysClear("DB_UND_EbonLake_Raft_Crew", 1);
PROC_UND_EbonLake_Raft_ComposeCrewFrom(_Var2);
PROC_UND_EbonLake_Raft_MoveCrewIn();
PROC_UND_EbonLake_Raft_Hide(_Var1);
PROC_UND_EbonLake_Raft_Move(_Var3);

PROC
PROC_UND_EbonLake_Raft_ComposeCrew((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_UND_EbonLake_Raft_Captain(_Var1);
DB_UND_EbonLake_Raft_Crew(_Var1);

PROC
PROC_UND_EbonLake_Raft_ComposeCrew((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
AND
IsInPartyWith(_Var2, _Var1, 1, _Var1, _Var1)
AND
InSamePartyGroup(_Var2, _Var1, 1, _Var1, _Var1)
THEN
DB_UND_EbonLake_Raft_Crew(_Var2);

PROC
PROC_UND_EbonLake_Raft_ComposeCrew((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_EbonLake_ReadyPlayers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
DB_UND_EbonLake_Raft_Crew(_Var2);

PROC
PROC_UND_EbonLake_Raft_ComposeCrew((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_EbonLake_ReadyPlayers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != _Var1
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
_Var3 != _Var1
AND
_Var3 != _Var2
AND
IsInPartyWith(_Var3, _Var2, 1, _Var1, _Var1)
AND
InSamePartyGroup(_Var3, _Var2, 1, _Var1, _Var1)
THEN
DB_UND_EbonLake_Raft_Crew(_Var3);

PROC
PROC_UND_EbonLake_Raft_ComposeCrewFrom((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, _Var1, 1, _Var1, _Var1)
THEN
DB_UND_EbonLake_Raft_Crew(_Var2);

PROC
PROC_UND_EbonLake_Raft_ComposeCrewWithAll()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_UND_EbonLake_Raft_Crew(_Var1);

IF
DB_UND_EbonLake_Raft_Crew(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);

PROC
PROC_UND_EbonLake_Raft_MoveCrewIn()
AND
DB_UND_EbonLake_Raft_Crew(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetVisible(_Var1, 0);
PROC_SetInvulnerable(_Var1, 1);
Freeze(_Var1);
PROC_UND_EbonLake_Fading_FadeOut(_Var1, 1);

PROC
PROC_UND_EbonLake_Raft_Hide((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_UND_EbonLake_Raft_Hideable(_Var1, _, _Var3, _, _Var1)
THEN
SetOnStage(_Var3, 0);

PROC
PROC_UND_EbonLake_Raft_Move((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
THEN
DB_UND_EbonLake_Raft_InTrip(_Var1);
TimerLaunch("UND_EbonLake_Timer_RaftMoving", 1000);

IF
TimerFinished("UND_EbonLake_Timer_RaftMoving", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_UND_EbonLake_Raft_InTrip(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_UND_EbonLake_Raft_ClearLocation();
SetFlag(_Var1, NULL_00000000-0000-0000-0000-000000000000);
PROC_UND_EbonLake_Raft_Show(_Var1);
TimerLaunch("UND_EbonLake_Timer_RaftMoved", 1000);

PROC
PROC_UND_EbonLake_Raft_ClearLocation()
AND
DB_UND_EbonLake_Raft_Locations(_, _Var2, _, _, _)
THEN
ClearFlag(_Var2, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_UND_EbonLake_Raft_Show((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_UND_EbonLake_Raft_Hideable(_, _Var1, _Var3, _, _Var1)
THEN
SetOnStage(_Var3, 1);

IF
TimerFinished("UND_EbonLake_Timer_RaftMoved", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_UND_EbonLake_Raft_InTrip(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_UND_EbonLake_Raft_InTrip(_Var1);
PROC_UND_EbonLake_DisembarkCrew(_Var1);
PROC_UND_EbonLake_Raft_Arrived_Hook(_Var1);

PROC
PROC_UND_EbonLake_Raft_Arrived_Hook((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
THEN
DB_NOOP(1);

PROC
PROC_UND_EbonLake_Fading_FadeOut((GUIDSTRING)_Var1, (REAL)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetReservedUserID(_Var1, _Var3, _Var1, _Var1, _Var1)
AND NOT
DB_UND_EbonLake_Fading_FadedOutUsers(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
ScreenFadeTo(_Var1, _Var2, 0, "UND_EbonLake_Fading");
DB_UND_EbonLake_Fading_FadedOutUsers(_Var3);

PROC
PROC_UND_EbonLake_Fading_FadeIn((GUIDSTRING)_Var1, (REAL)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetReservedUserID(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Fading_FadedOutUsers(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
ClearScreenFade(_Var1, _Var2, "UND_EbonLake_Fading");
NOT DB_UND_EbonLake_Fading_FadedOutUsers(_Var3);

PROC
PROC_UND_EbonLake_DisembarkCrew((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
THEN
DB_UND_EbonLake_Raft_DisembarkPlayerIndex(0);
PROC_UND_EbonLake_Raft_Disembark(_Var1);
TimerLaunch("UND_EbonLake_ChainParty", 100);
SysClear("DB_UND_EbonLake_Raft_DisembarkPlayerIndex", 1);
SysClear("DB_UND_EbonLake_Raft_Disembarked", 1);

PROC
PROC_UND_EbonLake_Raft_Disembark((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_UND_EbonLake_Raft_Crew(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_UND_EbonLake_Raft_Disembarked(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_DisembarkPlayerIndex(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var3, 1, _Var4, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_Locations_PlayerPositions(_Var1, _Var4, _Var5, _Var1, _Var1)
THEN
DB_UND_EbonLake_Raft_Disembarked(_Var2);
DB_UND_EbonLake_Raft_DisembarkPlayerIndex(_Var4);
NOT DB_UND_EbonLake_Raft_DisembarkPlayerIndex(_Var3);
TeleportTo(_Var2, _Var5, "", 0, 1, 1);
Unfreeze(_Var2);
PROC_SetInvulnerable(_Var2, 0);
SetVisible(_Var2, 1);
PROC_UND_EbonLake_Fading_FadeIn(_Var2, 1);

IF
TimerFinished("UND_EbonLake_ChainParty", _, _, _, _)
THEN
PROC_UND_EbonLake_Raft_ChainParty();

PROC
PROC_UND_EbonLake_Raft_ChainParty()
AND
DB_UND_EbonLake_Raft_Captain(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, 0, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_Crew(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != _Var1
THEN
AttachToPartyGroup(_Var2, _Var1);

PROC
PROC_UND_EbonLake_Raft_Arrived_Hook(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, _, _, _, _)
AND
GetFlag(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
PROC_UND_EbonLake_ImitatePassageOfTime(S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9);
PROC_UND_DarkLake_StartRaftDialog();

PROC
PROC_UND_EbonLake_ImitatePassageOfTime((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, _Var1, 1, _Var1, _Var1)
THEN
PROC_RemoveMutingPolymorphs(_Var2);
PROC_RemoveMutingStatusses(_Var2);
RemoveStatusesWithGroup(_Var2, "SG_Invisible");
PROC_GLO_BreakConcentration(_Var2);
RemoveSplatters(_Var2);

PROC
PROC_UND_DarkLake_StartRaftDialog()
AND
DB_UND_EbonLake_Raft_Captain(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, _Var1, _Var1, _Var1)
THEN
PROC_UND_DarkLake_OnDialogFailedToStart();

IF
DialogRequestFailed(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_UND_DarkLake_OnDialogFailedToStart();

PROC
PROC_UND_DarkLake_OnDialogFailedToStart()
THEN
PROC_UND_DarkLake_MakeJump();
SetFlag(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, NULL_00000000-0000-0000-0000-000000000000);
PROC_SetRelationToPlayers(ACT1_UND_DuergarSquad_0b8fb7f0-e0c2-1c15-7f87-20fdb1d220f2, 0);

IF
DialogStarted(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
TeleportTo(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_UND_DarkLake_RaftCaptainPointOnPlayerRaft_1d030056-f5ca-486e-8d56-1b6d62f99210);

PROC
PROC_UND_DarkLake_MakeJump()
THEN
UseSpell(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "Projectile_UND_DarkLake_RaftCaptainJump", S_UND_DarkLake_RaftCaptainPointOnPlayerRaft_1d030056-f5ca-486e-8d56-1b6d62f99210);

PROC
PROC_GlobalFlagReactionAfterDialog(UND_DarkLake_State_PeacefulResolution_629a38e0-ba91-2a6b-bdcc-636fdbb9d20e, _, _, _, _)
THEN
PROC_UND_DarkLake_MoveToCampAfterLakeEncounter();

PROC
PROC_GlobalFlagReactionAfterDialog(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, _, _, _, _)
THEN
PROC_SetRelationToPlayers(ACT1_UND_DuergarSquad_0b8fb7f0-e0c2-1c15-7f87-20fdb1d220f2, 0);

IF
DialogAttackRequested(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_EbonLake_RaftCaptainTrackDialogAttack(1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_UND_EbonLake_RaftCaptainTrackDialogAttack(1);

PROC
PROC_UND_DarkLake_MoveToCampAfterLakeEncounter()
THEN
ClearFlag(UND_DarkLake_State_DuergarsAtLake_85d7bbfc-bffe-48bb-955d-f1f450b16e39, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_UND_EbonLake_PrepareAndMoveRaftFromTrigger(S_UND_EbonLake_RaftInvisibleHelperAtLake_7a06c836-c692-4682-afcb-a67421b43c5a, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5);
PROC_UND_DarkLake_SendDuergarCrewToPatrol();

PROC
PROC_UND_DarkLake_SendDuergarCrewToPatrol()
AND
DB_UND_DuergarSquad(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec
THEN
SetOnStage(_Var1, 0);

PROC
PROC_UND_EbonLake_Raft_Arrived_Hook(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, _, _, _, _)
AND
DB_GlobalFlag(UND_DarkLake_State_PeacefulResolution_629a38e0-ba91-2a6b-bdcc-636fdbb9d20e, _, _, _, _)
AND
QRY_OnlyOnce("UND_DarkLake_RaftCaptainCampIntroductionDialog", _, _, _, _)
THEN
PROC_UND_EbonLake_ImitatePassageOfTime(S_UND_DarkLake_BoatAtCampArea_467f81f9-f1d6-4c2a-a3d5-1ac0d8897b76);
TeleportTo(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_UND_DarkLake_RaftCaptainPositionAtCamp_9a4f395f-d268-458e-a878-b7c1adfc2cd3, "UND_EbonLake_TeleportedToCamp");

IF
EntityEvent(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "UND_EbonLake_TeleportedToCamp", _, _, _)
THEN
ObjectTimerLaunch(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "UND_DarkLake_RaftCaptain_StartSpottingInCamp", 1000);

IF
ObjectTimerFinished(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "UND_DarkLake_RaftCaptain_StartSpottingInCamp", _, _, _)
THEN
SetFlag(UND_DarkLake_State_CampIntro_d488b36c-6d1c-d5b4-7862-7f771c02bb24, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec);
NOT DB_UND_EbonLake_RaftCaptainTrackDialogAttack(1);

IF
DialogEnded(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(UND_DarkLake_State_PeacefulResolution_629a38e0-ba91-2a6b-bdcc-636fdbb9d20e, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_Captain(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e, S_UND_DuergarGuard_AtPier_01_5ff28d97-e070-4805-a856-3112df670e1f, _Var2, S_UND_DuergarGuard_AtPier_02_2dd2a840-35ff-4ed6-bf43-f9aae0e69c32, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec)
THEN
PROC_UND_DarkLake_ClearScreenFadeTimeline(_Var1);

IF
DialogEnded(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_UND_DarkLake_ClearScreenFadeTimeline(_Var1);

IF
DialogActorLeft(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e, _, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, _, _)
AND
GetFlag(UND_DarkLake_State_CampIntro_d488b36c-6d1c-d5b4-7862-7f771c02bb24, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, 1, _, _)
THEN
ClearFlag(UND_DarkLake_State_CampIntro_d488b36c-6d1c-d5b4-7862-7f771c02bb24, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec);

IF
FlagCleared(UND_DarkLake_State_CampIntro_d488b36c-6d1c-d5b4-7862-7f771c02bb24, S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, _, _, _)
AND
GetCombatGroupID(S_UND_DuergarGuardSergeant_0aeb5411-5f13-4263-acb0-87f0689de2e5, _Var2, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec);
DB_Dialogs(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, UND_DuergarRaftCaptain_Camp_84d266a9-3764-b81b-05e4-69da1f331d67);
PROC_CharacterMoveTo(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_UND_DuergarRaftCaptain_DebriefTrigger_822a3bfd-ff40-44f5-b07d-f4ef20909a1c, "Run", "UND_DuergarCamp_SquadMemberReturned");
PROC_GlobalSetFlagAndCache(UND_DuergarRaftCaptain_Debrief_df399331-418a-4990-9759-076b46f2de56);
DB_GLO_DefeatCounter(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "UND_PermaDefeatedExcavationGuards");
DB_GLO_DefeatCounter(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "UND_PermaDefeatedDuergarAbsolutists");
DB_UND_DuergarGuards_Excavation(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_UND_DuergarRaftCaptain_DebriefTrigger_822a3bfd-ff40-44f5-b07d-f4ef20909a1c);
DB_UND_DuergarCamp_Absolutists(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec);
SetFaction(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, ACT1_UND_DuergarGuards_ec33d1c9-262d-05e5-5c15-05bcb84cc6a5);
SetCombatGroupID(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, _Var2);

PROC
PROC_UND_EbonLake_Raft_Arrived_Hook(UND_EbonLake_State_RaftAtCamp_526b966d-e826-4290-8331-e4747c1df3a5, _, _, _, _)
AND
DB_GlobalFlag(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, _, _, _, _)
AND
QRY_OnlyOnce("UND_DarkLake_NoRaftCaptainCampIntroductionDialog", _, _, _, _)
THEN
PROC_UND_EbonLake_ImitatePassageOfTime(S_UND_DarkLake_BoatAtCampArea_467f81f9-f1d6-4c2a-a3d5-1ac0d8897b76);

IF
DialogEnded(UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, _, _, _, _)
AND
DB_GlobalFlag(UND_DarkLake_State_HostileResolution_d9683a6f-10b4-87e5-9921-e25287267211, _, _, _, _)
THEN
DB_UND_DarkLake_CheckpointFadingWithoutCaptain(1);

IF
FlagSet(UND_EbonLake_Event_MoveToCamp_0da8fee9-b7cb-4551-9baa-ec930c118716, _, _, _, _)
AND
DB_UND_DarkLake_CheckpointFadingWithoutCaptain(1, _, _, _, _)
THEN
DB_UND_DarkLake_MovingToCamp(1);

IF
DialogEnded(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_UND_DarkLake_CheckpointFadingWithoutCaptain(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_DarkLake_MovingToCamp(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_UND_EbonLake_Raft_Captain(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e, S_UND_DuergarGuard_AtPier_01_5ff28d97-e070-4805-a856-3112df670e1f, _Var2, S_UND_DuergarGuard_AtPier_02_2dd2a840-35ff-4ed6-bf43-f9aae0e69c32, _Var1)
THEN
PROC_UND_DarkLake_ClearScreenFadeTimeline(_Var1);

IF
DialogEnded(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_UND_DarkLake_CheckpointFadingWithoutCaptain(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_UND_DarkLake_ClearScreenFadeTimeline(_Var1);

IF
DialogEnded(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_UND_DarkLake_CheckpointFadingWithoutCaptain(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_UND_DarkLake_MovingToCamp(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_UND_DarkLake_ClearScreenFadeTimeline(_Var1);

IF
DialogEnded(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f, _, _, _, _)
AND
DB_UND_DarkLake_CheckpointFadingWithoutCaptain(1, _, _, _, _)
AND
DB_UND_DarkLake_MovingToCamp(1, _, _, _, _)
THEN
NOT DB_UND_DarkLake_MovingToCamp(1);
NOT DB_UND_DarkLake_CheckpointFadingWithoutCaptain(1);

PROC
PROC_UND_DarkLake_ClearScreenFadeTimeline((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
THEN
PROC_ClearScreenFadeTimeline(_Var2, 0.5);

IF
DialogStarted(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
PROC_UnlockWaypoint("WAYP_UND_Duergar", _Var2);

IF
DialogEnded(UND_DuergarCamp_Checkpoint_c40716bd-9e42-54a5-06ea-7c0cbea85a8e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
TimerLaunch("UND_EbonLake_ArrivalAutoSave", 1000);

IF
TimerFinished("UND_EbonLake_ArrivalAutoSave", _, _, _, _)
THEN
AutoSave();

QRY
QRY_DialogAttackRequested_CustomResponse(S_UND_DuergarRebel_AtPier_01_5ff28d97-e070-4805-a856-3112df670e1f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_GlobalSetFlagAndCache(UND_DuergarCamp_State_DocsHostile_c2e36c80-970a-4fc0-ac4b-45a665bbfcd4);
PROC_OnDialogAttackRequested(S_UND_DuergarRebel_AtPier_01_5ff28d97-e070-4805-a856-3112df670e1f, _Var1);

PROC
PROC_GlobalFlagReactionAfterDialog(UND_DuergarCamp_State_DocsHostile_c2e36c80-970a-4fc0-ac4b-45a665bbfcd4, _, _, _, _)
THEN
PROC_UND_EbonLake_MakeDocksHostile();

PROC
PROC_UND_EbonLake_MakeDocksHostile()
THEN
PROC_SetRelationToPlayers(ACT1_UND_DuergarGuards_DocsCheckpoint_2054725d-78b9-4704-8a87-93a0b9a1c5fd, 0);

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Var1, UND_DarkLake_Event_PushRaftCaptainOffRaft_fa9f5b35-925c-c18d-4d00-6497194b1293, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, 0, _Var1, 1, 1);
SetOnStage(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, 0);

IF
QuestUpdateUnlocked((GUIDSTRING)_Var1, "UND_LoneDuergar", "GaveQuest", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFlag(UND_DarkLake_Knows_GnomeHunt_0c91ee97-9683-5d3a-77c5-44e67bd8677d, NULL_00000000-0000-0000-0000-000000000000);

IF
QuestUpdateUnlocked((CHARACTER)_Var1, "UND_LoneDuergar", "ToldQuest", (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetFlag(UND_DarkLake_Knows_GnomeHunt_0c91ee97-9683-5d3a-77c5-44e67bd8677d, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, UND_DarkLake_Event_MoveToCave_d580a352-2202-7c43-07c6-3ede5683cb0f, UND_DarkLake_RaftEvent_10631f38-24d4-b8eb-c913-286fedfb5cfc, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(UND_DarkLake_Event_MoveToCave_d580a352-2202-7c43-07c6-3ede5683cb0f, _Var1);
PROC_UND_EbonLake_PrepareAndMoveRaftFromTrigger(S_UND_EbonLake_RaftInvisibleHelperAtLake_7a06c836-c692-4682-afcb-a67421b43c5a, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8);
TeleportTo(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_UND_DarkLake_DuergarPositionsOnRaft_11bbae59-5ebc-4546-8d28-e537a2c3ecbb, "UND_DarkLake_TeleportRaftCaptainBack", 0, 0, 0);

IF
EntityEvent(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, "UND_DarkLake_TeleportRaftCaptainBack", _, _, _)
THEN
LookFromTrigger(S_UND_DuergarRaftCaptain_473ae3b0-d8e9-428d-9129-bbffe449b8ec, S_UND_DarkLake_DuergarPositionsOnRaft_11bbae59-5ebc-4546-8d28-e537a2c3ecbb, 1);

PROC
PROC_GLO_DefeatCounter_AllDefeated("UND_EbonLake_DuergarSquad", _, _, _, _)
THEN
PROC_UND_DarkLake_AfterCombatResolution();

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_UND_EbonLake_IsLakeCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TimerLaunch("UND_DarkLake_AfterCombatResolution", 2000);

QRY
QRY_UND_EbonLake_IsLakeCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
AND
DB_UND_DuergarSquad(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Was_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TimerFinished("UND_DarkLake_AfterCombatResolution", _, _, _, _)
THEN
PROC_UND_DarkLake_AfterCombatResolution();

PROC
PROC_UND_DarkLake_AfterCombatResolution()
AND NOT
QRY_UND_DarkLake_PlayerSquadWon()
AND NOT
QRY_UND_DarkLake_DuergarSquadWon()
AND
QRY_OnlyOnce("UND_EbonLake_LakeEncounterEnded", _, _, _, _)
THEN
PROC_UND_DarkLake_SetCaveRaftAsCurrentRaft();
PROC_UND_DarkLake_SendNewDuergarSquadToShore();
PROC_UND_DarkLake_SendPlayerBodiesToShore();

PROC
PROC_UND_DarkLake_AfterCombatResolution()
AND
QRY_UND_DarkLake_PlayerSquadWon()
AND NOT
QRY_UND_DarkLake_DuergarSquadWon()
AND
QRY_OnlyOnce("UND_EbonLake_LakeEncounterEnded", _, _, _, _)
THEN
PROC_LoopEffect(VFX_Script_Perception_Default_01_46bd169e-bbb5-a6fe-0fe7-97c64f620d5d, S_UND_EbonLake_Rudder_21e36312-bb41-4187-ad50-50979e5e43a2, "UND_EbonLake_Rudder", "WLD_Main_A", "");
DB_UND_EbonLake_RudderHighlighted(1);

IF
UseStarted((CHARACTER)_Var1, S_UND_EbonLake_Rudder_21e36312-bb41-4187-ad50-50979e5e43a2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_EbonLake_RudderHighlighted(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_StopLoopEffect(S_UND_EbonLake_Rudder_21e36312-bb41-4187-ad50-50979e5e43a2, "UND_EbonLake_Rudder");

PROC
PROC_UND_DarkLake_AfterCombatResolution()
AND NOT
QRY_UND_DarkLake_PlayerSquadWon()
AND
QRY_UND_DarkLake_DuergarSquadWon()
AND
QRY_OnlyOnce("UND_EbonLake_LakeEncounterEnded", _, _, _, _)
THEN
PROC_UND_DarkLake_SetCaveRaftAsCurrentRaft();
PROC_UND_DarkLake_SendDuergarSquadToShore();
PROC_UND_DarkLake_SendPlayerBodiesToShore();

PROC
PROC_UND_DarkLake_SendNewDuergarSquadToShore()
THEN
PROC_Foop(S_UND_DarkLake_Patrol_000_cb258cd3-3b7f-48b4-883e-a008ea6e9e38);
PROC_Foop(S_UND_DarkLake_Patrol_001_a154f62e-771e-4bac-8af6-c28d62019d1a);

PROC
PROC_UND_DarkLake_SendDuergarSquadToShore()
AND
DB_UND_DuergarSquad_PositionsAtShore(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveHarmfulStatuses(_Var1);
PROC_Poof(_Var1);
TeleportTo(_Var1, _Var2, "UND_DarkLake_DuergarTeleportedToShore", 0, 0, 1);

IF
EntityEvent((CHARACTER)_Var1, "UND_DarkLake_DuergarTeleportedToShore", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_Foop(_Var1);
PROC_ClearStoryMove(_Var1);
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);

PROC
PROC_UND_DarkLake_SetCaveRaftAsCurrentRaft()
THEN
ClearFlag(UND_EbonLake_State_RaftAtLake_8ff8fe26-4546-40e0-94a5-03dba9001650, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8, NULL_00000000-0000-0000-0000-000000000000);
PROC_UND_EbonLake_Raft_Show(UND_EbonLake_State_RaftAtCave_beb83efd-711a-4e20-8d87-470050aebee8);

QRY
QRY_UND_DarkLake_PlayerSquadWon()
AND
DB_UND_EbonLake_Raft_Crew(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_UND_EbonLake_PlayerIsVictor(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_UND_EbonLake_PlayerIsVictor((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInTrigger(_Var1, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, 1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_UND_DarkLake_DuergarSquadWon()
AND
DB_UND_DuergarSquad(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, 1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
UseStarted((CHARACTER)_Var1, S_UND_EbonLake_Rudder_21e36312-bb41-4187-ad50-50979e5e43a2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialog(UND_DarkLake_Boat_3a2b4e5e-2406-f9c1-9879-c36072d1580f, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_UND_DarkLake_SendPlayerBodiesToShore()
AND
QRY_UND_EbonLake_AtLeastOnePlayerIsAlive()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, 1, _Var1, _Var1)
THEN
PROC_UND_EbonLake_SendDeadCharacterToShore(_Var1);

QRY
QRY_UND_EbonLake_AtLeastOnePlayerIsAlive()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_UND_EbonLake_SendDeadCharacterToShore((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GUIDToString(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_UND_EbonLake_Fading_FadeOut(_Var1, 1);
TimerLaunch(_Var2, 1000);
DB_UND_DarkLake_Combat_GUIDTimers(_Var1, _Var2);

IF
TimerFinished((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_UND_DarkLake_Combat_GUIDTimers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
TriggerGetRandomPosition(S_UND_Raft_CorpseTrigger_2f2ae987-aaf8-4244-b790-63d5bc7f9a14, _Var3, _Var4, _Var5, _Var1)
AND
FindValidPosition(_Var3, _Var4, _Var5, 0.5, _Var2, 0, _Var6, _Var7, _Var8, _Var1)
THEN
NOT DB_UND_DarkLake_Combat_GUIDTimers(_Var2, _Var1);
TeleportToPosition(_Var2, _Var6, _Var7, _Var8, "", 0, 0, 1);
PROC_UND_EbonLake_Fading_FadeIn(_Var2, 1);

IF
DB_UND_EbonLake_BoatsAtCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Dialogs(_Var1, UND_DarkLake_DuergarBoatAtCamp_b7ab6b74-0da5-938f-40e3-ae8d1222c77a);

IF
DB_UND_EbonLake_BoatsAtCave(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Dialogs(_Var1, UND_DarkLake_DuergarBoatAtCave_0c3d00d8-77ac-d41e-0ed2-f2d213d94c00);
SetOnStage(_Var1, 0);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, UND_DarkLake_Event_MoveToCaveOnBoat_443df3f1-d0c4-4e72-a968-194ee6dc6c40, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(UND_DarkLake_Event_MoveToCaveOnBoat_443df3f1-d0c4-4e72-a968-194ee6dc6c40, _Var1);
TeleportTo(_Var1, S_UND_DuergarCamp_Boats_PassengerPositionAtCave_16c4c455-c8f6-41e7-bf6b-d36c624ddb8a, "UND_EbonLake_UsedDuergarBoat", 1, 1, 1, 0, 1);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, UND_DarkLake_Event_MoveToCampOnBoat_28ab45e0-54ae-48a3-a164-82f39971e64e, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(UND_DarkLake_Event_MoveToCampOnBoat_28ab45e0-54ae-48a3-a164-82f39971e64e, _Var1);
TeleportTo(_Var1, S_UND_DuergarCamp_Boats_PassengerPositionAtCamp_2bd5015d-157e-4b7a-8255-f503740b16e0, "UND_EbonLake_UsedDuergarBoat", 1, 1, 1, 0, 1);

IF
EntityEvent(_, "UND_EbonLake_UsedDuergarBoat", _, _, _)
AND
QRY_OnlyOnce("UND_EbonLake_UsedDuergarBoat", _, _, _, _)
AND
DB_UND_EbonLake_BoatsAtCave(_Var2, _, _, _, _)
THEN
SetOnStage(_Var2, 1);

IF
ItemEnteredTrigger((ITEM)_Var1, S_UND_DarkLake_LakeEncounter_ItemTrigger_81f523da-e930-433f-8734-4988d3bdd1ef, _, (ITEM)_Var1, (ITEM)_Var1)
AND
GetOwner(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
GetStackAmount(_Var1, _Var4, _, _Var1, _Var1)
THEN
DB_UND_EbonLake_StoredItems(_Var1, _Var4, _Var3);

IF
DB_UND_EbonLake_StoredItems(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
DB_Destroyed(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_UND_EbonLake_StoredItems(_Var1, _Var2, _Var3);

IF
ItemLeftTrigger((ITEM)_Var1, S_UND_DarkLake_LakeEncounter_ItemTrigger_81f523da-e930-433f-8734-4988d3bdd1ef, _, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_UND_EbonLake_StoredItems(_Var1, _Var3, _Var4, _Var1, _Var1)
THEN
NOT DB_UND_EbonLake_StoredItems(_Var1, _Var3, _Var4);

IF
LeftTrigger((CHARACTER)_Var1, S_UND_DarkLake_LakeEncounterTrigger_d26a46e5-4711-4fd9-80c6-18c5a1196ec9, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_EbonLake_StoredItems(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
NOT DB_UND_EbonLake_StoredItems(_Var2, _Var3, _Var1);
ToInventory(_Var2, _Var1, _Var3, 1, 0);

PROC
PROC_GlobalFlagReactionAfterDialog(UND_DarkLake_State_PeacefulResolution_629a38e0-ba91-2a6b-bdcc-636fdbb9d20e, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UND_DuergarSquad(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PeacefulResolve(_Var1);

PROC
PROC_LevelLoadedOnce("BGO_Main_A", _, _, _, _)
THEN
GoalCompleted;


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
