Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_LOW_GrottoSentry_90c54fce-9a57-4ff5-9d36-0363ef90c5f1, LOW_SharGrotto_GrottoSentry_223eba2a-fa66-36d3-edb6-23a7ec8bb323);
DB_TrespassTrigger(S_LOW_InnerGrottoTrespass_73a192ef-e53d-4944-890c-c4210ffa7f96, NULL_00000000-0000-0000-0000-000000000000, "LOW_SharGrotto_Trespass");
DB_FlagReactionAfterDialog(LOW_SharGrotto_Event_TrespasserSpotted_ba8392e8-fa2f-4ce8-966f-7bfbf101e39c, LOW_NGB_SharGrotto_Trespassing_fac07fbe-0d24-e220-7b2b-35932fa5c844);
DB_GlobalFlagReactionAfterDialog(LOW_SharGrotto_State_PromisedBringShadowheart_ba85fccc-c09b-41c3-82ec-69693db59204, LOW_SharGrotto_ConfrontViconia_NoShadowheart_78e68cb8-fc4e-fa55-c4a9-5f7224b86fe4);
DB_CheckPoint(S_LOW_GrottoCheckpointGuard_000_4502bf48-a7fc-4708-94ef-52bfd8285c6c, S_LOW_GrottoCheckpointGuard_001_1effcc57-318d-4d42-873d-7550a399a40b, S_LOW_GrottoHallRight_PrimarySpotTrigger_977ce7a1-0c00-45c2-b05d-303b4f6fcb3f, S_LOW_GrottoHallRight_WarningSpotTrigger_e8131466-f817-410a-9de7-7bdfb0db33f6, S_LOW_InnerGrottoTrespass_73a192ef-e53d-4944-890c-c4210ffa7f96, "S_LOW_GrottoRightHallCheckpoint", LOW_SharGrotto_State_GrottoAdmitted_3a92f2ee-8d50-4557-915b-f7bae85c7546, "LOW_SharGrotto_Trespass");
DB_CheckPoint(S_LOW_GrottoCheckpointGuard_002_4ed10e2c-72d0-47cd-aee3-ecd531205ac8, S_LOW_GrottoCheckpointGuard_003_67f579e5-655b-41e3-b74c-37fe1abd03d4, S_LOW_GrottoHallLeft_PrimarySpotTrigger_0facf95a-f84c-409a-aacb-5975905c0b0c, S_LOW_GrottoHallLeft_WarningSpotTrigger_e5ec1039-429b-4a92-a8ef-ae50e74e4288, S_LOW_InnerGrottoTrespass_73a192ef-e53d-4944-890c-c4210ffa7f96, "S_LOW_GrottoLeftHallCheckpoint", LOW_SharGrotto_State_GrottoAdmitted_3a92f2ee-8d50-4557-915b-f7bae85c7546, "LOW_SharGrotto_Trespass");
DB_LOW_SharGrotto_FearTags(LOW_SharGrotto_State_Fear_Betrayal_a4afbf03-0e9c-4eeb-87ff-d77c98dc1f40, ACT3_LOW_HOUSEOFGRIEF_FEAR_BETRAYAL_64c980e9-5a36-4445-bb73-be08a2cd70e6);
DB_LOW_SharGrotto_FearTags(LOW_SharGrotto_State_Fear_Darkness_9a37addc-52bf-4018-a4d0-43f60119ed4b, ACT3_LOW_HOUSEOFGRIEF_FEAR_DARKNESS_2905d006-36ac-4dd2-8cfc-f6f898001a52);
DB_LOW_SharGrotto_FearTags(LOW_SharGrotto_State_Fear_Disease_a5df90d7-8ee9-409e-a4a6-0e1bd1950a50, ACT3_LOW_HOUSEOFGRIEF_FEAR_DISEASE_10a6215e-1152-4550-bf6f-443f15369951);
DB_LOW_SharGrotto_FearTags(LOW_SharGrotto_State_Fear_Mindflayer_0fe87179-b848-4a09-afa9-9d0472bd18fb, ACT3_LOW_HOUSEOFGRIEF_FEAR_MINDFLAYER_6aeefcd3-25b4-4d13-928f-6c13ff63d0a9);
DB_LOW_SharGrotto_FearTags(LOW_SharGrotto_State_Fear_Powerless_74c4b6e3-7199-4d2d-9dba-4e14ea52593e, ACT3_LOW_HOUSEOFGRIEF_FEAR_POWERLESS_2e33a20d-0a3a-495a-83e6-aa91503d489d);
DB_LOW_SharGrotto_FearTags(LOW_SharGrotto_State_Fear_Spiders_d9d0a2ad-4492-430d-9221-c2c539acb833, ACT3_LOW_HOUSEOFGRIEF_FEAR_SPIDERS_b0581c50-c2c8-4140-b793-dfaea33945da);
DB_LOW_SharGrotto_HeartFormTags(LOW_HouseOfGrief_State_HeartViolent_3e1caeae-f449-45a2-bfe2-3b95130c4282, ACT3_LOW_HOUSEOFGRIEF_HEART_VIOLENT_71c456cd-8cc2-4eac-9425-e7e359b3eea9);
DB_LOW_SharGrotto_HeartFormTags(LOW_HouseOfGrief_State_HeartCraven_af6a7f33-6463-4683-bb72-3eaea2a2b2ba, ACT3_LOW_HOUSEOFGRIEF_HEART_CRAVEN_fe684418-2454-45c1-a482-328b12f60b7a);
DB_LOW_SharGrotto_HeartFormTags(LOW_HouseOfGrief_State_HeartJealous_9f69fa5d-5e86-41ee-9c7c-ef873fa63bd5, ACT3_LOW_HOUSEOFGRIEF_HEART_JEALOUS_9b15de08-d0aa-439f-bcad-e7a6201505a7);
DB_LOW_SharGrotto_HeartFormTags(LOW_HouseOfGrief_State_HeartYearning_c4b91748-43e0-46aa-8457-05d8ac961d43, ACT3_LOW_HOUSEOFGRIEF_HEART_MELANCHOLY_e57c19fe-4f1c-4a44-9b5a-a9b511fdbbef);
DB_LOW_SharGrotto_HeartFormTags(LOW_HouseOfGrief_State_HeartPrying_d772ec00-a8bc-46d0-b499-42642b4a2155, ACT3_LOW_HOUSEOFGRIEF_HEART_PRYING_f8d720f9-9c6b-4097-be00-1661ec059de8);
DB_LOW_SharGrotto_HeartFormTags(LOW_HouseOfGrief_State_HeartFalse_4c684059-73bc-48c4-85ff-dfad3c45ad75, ACT3_LOW_HOUSEOFGRIEF_HEART_FALSE_04bfa5a1-5701-443b-90a3-cf8e596ac503);
DB_GlobalFlagReactionAfterDialog(LOW_SharGrotto_Event_SurrenderShadowheart_bfc7f3b7-4e58-44e1-bb58-131ee77fc0ad, LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd);
DB_Dialogs(S_LOW_SharranTrainee_000_9a3f9520-f900-4f00-b244-546e89bebc16, LOW_SharGrotto_Trainee_000_e5071211-1b4a-7d46-532f-d84116fbd894);
DB_Dialogs(S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249, LOW_SharGrotto_Trainee_001_6b1310ca-9c0a-9470-ac63-ca09ea9ba45a);
DB_Dialogs(S_LOW_SharranTrainee_002_37441df0-a3fa-4709-800f-a4cfcec2448d, LOW_SharGrotto_Trainee_002_2fbbb81c-6f4d-920d-61b9-7f2d7f06d2a9);
DB_Dialogs(S_LOW_SharranTrainee_003_a071057d-8106-4556-b12f-92b3a7335368, LOW_SharGrotto_Trainee_003_9f270691-91a0-a523-2f8a-ff9970d28303);
DB_Dialogs(S_LOW_SharranTrainee_004_24498358-fc73-4e6f-bf64-466c8bb22fb8, LOW_SharGrotto_Trainee_004_e31c0250-23d7-7211-16b8-1cad6bcfaa11);
DB_Dialogs(S_LOW_SharranTrainee_005_d31ee394-f77e-435f-8db0-390f780f2b39, LOW_SharGrotto_Trainee_005_7c9ae059-ac70-2647-39aa-01313bca6b7e);
DB_Dialogs(S_LOW_SharranTrainee_006_279da1af-4002-4add-af07-95a7f249aabd, LOW_SharGrotto_Trainee_006_638fd515-e703-8345-3d2d-839e94e4be73);
DB_Dialogs(S_LOW_ViconiaCultist_000_73bbaf85-e889-48b8-81cd-f2350fa0802b, LOW_SharGrotto_Cultist_000_9593a269-f51f-3af7-77ba-fc930b19a96e);
DB_Dialogs(S_LOW_ViconiaCultist_001_5ce3f68d-a9b4-4ae0-adae-26f84e20f39a, LOW_SharGrotto_Cultist_001_f3413a22-a25b-1d54-d57f-cb0c37cf395f);
DB_Dialogs(S_LOW_ViconiaCultist_002_29503898-388a-4f16-a429-ef2f778ba43e, LOW_SharGrotto_Cultist_002_f4a2d5e2-a91f-d6be-1c59-0bb9673bb051);
DB_Dialogs(S_LOW_OptionalCultist_000_68f11a56-ab1d-432c-adbf-8d9b24083915, LOW_SharGrotto_OptionalCultist_000_af825f1c-cb1d-b8c9-9ef6-60cd0791ef88);
DB_Dialogs(S_LOW_OptionalCultist_001_3c3af72b-2ae5-4ea4-86f3-ed8ce9a09d30, LOW_SharGrotto_OptionalCultist_001_ba29416b-c610-9a5b-1e9a-e958f5c6c1f8);
DB_Dialogs(S_LOW_SwayedDarkJusticiar_0e473c58-f86f-4952-a8c8-73e8ffb348c6, LOW_SharGrotto_SwayedJusticiar_1ec74020-6302-c13a-ffe8-909e03e1c648);
DB_Dialogs(S_GLO_SharranInformer_b2cf2efe-ec06-48cd-8fb7-ad596d61164f, LOW_SharGrotto_SharranInformer_30f22c6b-1842-2cbd-ba19-bdf316b18893);
DB_Dialogs(S_LOW_LossDoorGuard_90f9cb08-1019-424e-9b97-84d6a28898f2, LOW_SharGrotto_DoorGuard_a49eac82-b735-7d4c-bb03-58359b9fbcee);
DB_GLO_CharacterCorpseDialog(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_Dead_Viconia_ba7d66a5-3c22-daba-7d5e-f747a10bc731);
DB_SceneManager(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SharranTrainee_000_9a3f9520-f900-4f00-b244-546e89bebc16, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SharranTrainee_002_37441df0-a3fa-4709-800f-a4cfcec2448d, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SharranTrainee_003_a071057d-8106-4556-b12f-92b3a7335368, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SharranTrainee_004_24498358-fc73-4e6f-bf64-466c8bb22fb8, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SharranTrainee_005_d31ee394-f77e-435f-8db0-390f780f2b39, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SharranTrainee_006_279da1af-4002-4add-af07-95a7f249aabd, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_ViconiaCultist_000_73bbaf85-e889-48b8-81cd-f2350fa0802b, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_ViconiaCultist_001_5ce3f68d-a9b4-4ae0-adae-26f84e20f39a, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_ViconiaCultist_002_29503898-388a-4f16-a429-ef2f778ba43e, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_OptionalCultist_000_68f11a56-ab1d-432c-adbf-8d9b24083915, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_OptionalCultist_001_3c3af72b-2ae5-4ea4-86f3-ed8ce9a09d30, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_LOW_SwayedDarkJusticiar_0e473c58-f86f-4952-a8c8-73e8ffb348c6, "LOW_SharGrotto_SermonScene");
DB_SceneManager(S_GLO_SharranInformer_b2cf2efe-ec06-48cd-8fb7-ad596d61164f, "LOW_SharGrotto_SermonScene");
DB_DropMutingStatussesDialog(LOW_SharGrotto_ConfrontViconia_NoShadowheart_78e68cb8-fc4e-fa55-c4a9-5f7224b86fe4);
DB_DropMutingStatussesDialog(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491);
DB_DropMutingStatussesDialog(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd);
DB_KnowledgeCheckTrigger_AD("LOW_SharGrotto_SpotHideOut", S_LOW_SecretHoleSpot_9391dc0e-2b3f-42c4-a708-35478f592a4d, "Perception", Act3_Medium_77cee1c4-384a-4217-b670-67db3c7add57, LOW_SharGrotto_PAD_SpottedCaveHole_af712553-6486-7e28-4c6b-724e2025f373, LOW_SharGrotto_State_SucceededPerceptionCheck_c00483cc-9d13-4ad0-9c77-5b27f36bd1ea);
DB_OneShot_VoiceBarkTrigger(S_LOW_SecretHideOut_a40c8c00-b8c5-46c4-95ae-86f407199e2d, LOW_SharGrotto_VB_FoundHideOut_62043e30-4a81-62e2-c9db-ea950ce747de, "Global");
SetCanInteract(S_LOW_CaveObstruction_90f012d6-595c-4a76-a6dc-1d77d2a61dc7, 0);
DB_Dialogs(S_LOW_ShadowheartFriend_2c10ff0f-d2ff-4dcb-8f8b-c6f870044f5d, LOW_SharGrotto_ShadowheartFriend_b35f5ec6-2635-89a2-9eee-573d2545b04e);
PROC_DefineSingleOriginMoment(LOW_SharGrotto_ShadowheartFriend_b35f5ec6-2635-89a2-9eee-573d2545b04e, REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, LOW_SharGrotto_FamiliarFace_OM_Shadowheart_AOM_OOM_76131ed2-b08c-9014-8997-f3af9f1968ba, LOW_SharGrotto_FamiliarFace_OM_Shadowheart_COM_7c87d40e-6e62-66a7-8c4a-20d5edbf37c8, LOW_SharGrotto_FamiliarFace_OM_Shadowheart_AOM_OOM_76131ed2-b08c-9014-8997-f3af9f1968ba);
DB_ItemDialog_PlayerVB(S_LOW_BookShelf_31f77d0b-bc74-4394-a401-5d707bbfe91a, LOW_SharGrotto_VB_ShadowheartShelf_8cbbe9d3-af3f-3f2b-4aa2-5e45c318ca24);
DB_ItemDialog_PlayerVB(S_LOW_JewelryBox_3ef06131-8238-4dc2-8408-fcee993743cc, LOW_SharGrotto_VB_QueenJewels_f762316e-7723-b57f-803d-5d4ba5385d54);
DB_LOW_SharGrotto_ConfrontationParticipants("Unaligned", S_LOW_SharranTrainee_000_9a3f9520-f900-4f00-b244-546e89bebc16);
DB_LOW_SharGrotto_ConfrontationParticipants("Unaligned", S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249);
DB_LOW_SharGrotto_ConfrontationParticipants("Unaligned", S_LOW_SharranTrainee_002_37441df0-a3fa-4709-800f-a4cfcec2448d);
DB_LOW_SharGrotto_ConfrontationParticipants("Unaligned", S_LOW_SharranTrainee_003_a071057d-8106-4556-b12f-92b3a7335368);
DB_LOW_SharGrotto_ConfrontationParticipants("Unaligned", S_LOW_SharranTrainee_004_24498358-fc73-4e6f-bf64-466c8bb22fb8);
DB_LOW_SharGrotto_ConfrontationParticipants("Unaligned", S_LOW_SharranTrainee_005_d31ee394-f77e-435f-8db0-390f780f2b39);
DB_LOW_SharGrotto_ConfrontationParticipants("Unaligned", S_LOW_SharranTrainee_006_279da1af-4002-4add-af07-95a7f249aabd);
DB_LOW_SharGrotto_ConfrontationParticipants("Lackeys", S_LOW_ViconiaCultist_000_73bbaf85-e889-48b8-81cd-f2350fa0802b);
DB_LOW_SharGrotto_ConfrontationParticipants("Lackeys", S_LOW_ViconiaCultist_001_5ce3f68d-a9b4-4ae0-adae-26f84e20f39a);
DB_LOW_SharGrotto_ConfrontationParticipants("Lackeys", S_LOW_ViconiaCultist_002_29503898-388a-4f16-a429-ef2f778ba43e);
DB_LOW_SharGrotto_ConfrontationParticipants("Lackeys", S_LOW_OptionalCultist_000_68f11a56-ab1d-432c-adbf-8d9b24083915);
DB_LOW_SharGrotto_ConfrontationParticipants("Lackeys", S_LOW_OptionalCultist_001_3c3af72b-2ae5-4ea4-86f3-ed8ce9a09d30);
DB_LOW_SharGrotto_ConfrontationParticipants("ShadowheartAlly", S_LOW_SwayedDarkJusticiar_0e473c58-f86f-4952-a8c8-73e8ffb348c6);
DB_LOW_SharGrotto_ConfrontationParticipants("Informer", S_GLO_SharranInformer_b2cf2efe-ec06-48cd-8fb7-ad596d61164f);
DB_LOW_SharGrotto_ConfrontationParticipants("Viconia", S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313);
PROC_DefineSingleOriginMoment(LOW_SharGrotto_ConfrontViconia_NoShadowheart_78e68cb8-fc4e-fa55-c4a9-5f7224b86fe4, REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491, LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd, LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491);
DB_OriginMoment_MaxDistance(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491, 30);
DB_OriginMoment_MaxDistance(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd, 30);
PROC_DefineSingleOriginMoment(LOW_SharGrotto_ViconiaDefeated_NoShadowheart_6c6f05fc-391a-40f8-c7c0-68bd37dd1e09, REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, LOW_SharGrotto_ViconiaDefeated_OM_Shadowheart_AOM_OOM_a13d9a9f-6c85-a18a-cfef-8889c0e19e34, LOW_SharGrotto_ViconiaDefeated_OM_Shadowheart_COM_03382bb9-9c85-28fd-4c24-9069e44a0807, LOW_SharGrotto_ViconiaDefeated_OM_Shadowheart_AOM_OOM_a13d9a9f-6c85-a18a-cfef-8889c0e19e34);
DB_KeepDialogsOnDeath(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313);
DB_Dialogs(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_ConfrontViconia_NoShadowheart_78e68cb8-fc4e-fa55-c4a9-5f7224b86fe4);
DB_SpotPlayers(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_ViconiaSpot", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_IncludeSummons(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_ViconiaSpot");
DB_SpotPlayers_IncludeWildshapedPlayers(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_ViconiaSpot");
DB_SpotPlayers_TargetIgnoreCantTalk(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_ViconiaSpot");
DB_LOW_SharGrotto_CultistSwayFlags("Unaligned", LOW_SharGrotto_Event_SwayedUnaligned_3162ef49-99cd-4714-b9e1-6159999b2362);
DB_LOW_SharGrotto_CultistSwayFlags("Lackeys", LOW_SharGrotto_Event_SwayedLackeys_f99ff6dc-4b3b-4367-9666-36c750c2c64e);
DB_LOW_SharGrotto_CultistSwayFlags("ShadowheartAlly", LOW_SharGrotto_Event_SwayedAllies_d3da43d4-b5e8-400b-81f7-76944035a5d8);
DB_GLO_DefeatCounter(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_SharranCultists");
DB_GLO_DefeatCounter_AllPermaDefeatedGlobalFlag("LOW_SharGrotto_SharranCultists", LOW_SharGrotto_State_KilledCultists_2f9e0755-1f69-45f4-b7d7-7ad1814ecc3c);
DB_CombatReact_AD_OnTurn(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_Viconia_AD_TauntPlayer_32fcf81d-c32c-695b-55fb-d2f52fd64e36, 1);
DB_CombatReact_AD_OnTurn(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_Viconia_AD_TauntPlayer_32fcf81d-c32c-695b-55fb-d2f52fd64e36, 2);
DB_CombatReact_AD_OnTurn(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_Viconia_AD_TauntPlayer_32fcf81d-c32c-695b-55fb-d2f52fd64e36, 3);
DB_CombatReact_AD_OnTurn(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_Viconia_AD_TauntPlayer_32fcf81d-c32c-695b-55fb-d2f52fd64e36, 4);
DB_CombatReact_AD_OnCast(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_AD_ViconiaExploitFear_7ada322f-a52a-6072-ea02-c854b3b3c42a, "Target_LOW_HouseOfGrief_ExploitFear_Darkness");
DB_CombatReact_AD_OnCast(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_AD_ViconiaExploitFear_7ada322f-a52a-6072-ea02-c854b3b3c42a, "Target_LOW_HouseOfGrief_ExploitFear_Disease");
DB_CombatReact_AD_OnCast(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_AD_ViconiaExploitFear_7ada322f-a52a-6072-ea02-c854b3b3c42a, "Target_LOW_HouseOfGrief_ExploitFear_Powerless");
DB_CombatReact_AD_OnCast(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_AD_ViconiaExploitFear_7ada322f-a52a-6072-ea02-c854b3b3c42a, "Target_LOW_HouseOfGrief_ExploitFear_Mindflayer");
DB_CombatReact_AD_OnCast(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_AD_ViconiaExploitFear_7ada322f-a52a-6072-ea02-c854b3b3c42a, "Target_LOW_HouseOfGrief_ExploitFear_Betrayal");
DB_CombatReact_AD_OnCast(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_AD_ViconiaExploitFear_7ada322f-a52a-6072-ea02-c854b3b3c42a, "Target_LOW_HouseOfGrief_ExploitFear_Spider_2");
DB_CombatReact_AD_OnCast(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_AD_ViconiaExploitFear_7ada322f-a52a-6072-ea02-c854b3b3c42a, "Target_LOW_HouseOfGrief_ExploitFear_Wolf_2");
DB_CombatReact_AD_AppliedStatus(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, LOW_SharGrotto_AD_ViconiaHeartForm_38a8eac5-0d91-84bb-037b-95067e586774, "LOW_HOUSEOFGRIEF_HEART_CURSE_VIOLENT");
DB_CombatReact_AD_AppliedStatus(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, LOW_SharGrotto_AD_ViconiaHeartForm_38a8eac5-0d91-84bb-037b-95067e586774, "LOW_HOUSEOFGRIEF_HEART_CURSE_CRAVEN");
DB_CombatReact_AD_AppliedStatus(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, LOW_SharGrotto_AD_ViconiaHeartForm_38a8eac5-0d91-84bb-037b-95067e586774, "LOW_HOUSEOFGRIEF_HEART_CURSE_JEALOUS");
DB_CombatReact_AD_AppliedStatus(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, LOW_SharGrotto_AD_ViconiaHeartForm_38a8eac5-0d91-84bb-037b-95067e586774, "LOW_HOUSEOFGRIEF_HEART_CURSE_MELANCHOLY");
DB_CombatReact_AD_AppliedStatus(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, LOW_SharGrotto_AD_ViconiaHeartForm_38a8eac5-0d91-84bb-037b-95067e586774, "LOW_HOUSEOFGRIEF_HEART_CURSE_PRYING");
DB_CombatReact_AD_AppliedStatus(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, LOW_SharGrotto_AD_ViconiaHeartForm_38a8eac5-0d91-84bb-037b-95067e586774, "LOW_HOUSEOFGRIEF_HEART_CURSE_FALSE");
DB_CombatReact_AD_AppliedStatus(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, LOW_SharGrotto_AD_ViconiaHeartForm_38a8eac5-0d91-84bb-037b-95067e586774, "LOW_HOUSEOFGRIEF_HEART_CURSE_SHADOWHEART");
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_001_1effcc57-318d-4d42-873d-7550a399a40b, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_001_dad1c5b6-4bfa-3dfd-94a6-493eae86d1cd, 1);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_001_1effcc57-318d-4d42-873d-7550a399a40b, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_001_dad1c5b6-4bfa-3dfd-94a6-493eae86d1cd, 3);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_001_1effcc57-318d-4d42-873d-7550a399a40b, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_001_dad1c5b6-4bfa-3dfd-94a6-493eae86d1cd, 6);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_001_1effcc57-318d-4d42-873d-7550a399a40b, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_001_dad1c5b6-4bfa-3dfd-94a6-493eae86d1cd, 9);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_000_4502bf48-a7fc-4708-94ef-52bfd8285c6c, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_000_4a6fed76-64b7-7997-c9d2-ebebe5a87598, 2);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_000_4502bf48-a7fc-4708-94ef-52bfd8285c6c, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_000_4a6fed76-64b7-7997-c9d2-ebebe5a87598, 6);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_000_4502bf48-a7fc-4708-94ef-52bfd8285c6c, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_000_4a6fed76-64b7-7997-c9d2-ebebe5a87598, 9);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_000_4502bf48-a7fc-4708-94ef-52bfd8285c6c, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_000_4a6fed76-64b7-7997-c9d2-ebebe5a87598, 10);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_003_67f579e5-655b-41e3-b74c-37fe1abd03d4, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_003_968a6226-2a6d-2e83-a32b-594204c442b9, 2);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_003_67f579e5-655b-41e3-b74c-37fe1abd03d4, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_003_968a6226-2a6d-2e83-a32b-594204c442b9, 6);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_003_67f579e5-655b-41e3-b74c-37fe1abd03d4, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_003_968a6226-2a6d-2e83-a32b-594204c442b9, 8);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_003_67f579e5-655b-41e3-b74c-37fe1abd03d4, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_003_968a6226-2a6d-2e83-a32b-594204c442b9, 10);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_002_4ed10e2c-72d0-47cd-aee3-ecd531205ac8, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_002_9fe57c20-bcc6-d0b8-b131-c91f5f85ffcb, 1);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_002_4ed10e2c-72d0-47cd-aee3-ecd531205ac8, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_002_9fe57c20-bcc6-d0b8-b131-c91f5f85ffcb, 4);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_002_4ed10e2c-72d0-47cd-aee3-ecd531205ac8, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_002_9fe57c20-bcc6-d0b8-b131-c91f5f85ffcb, 7);
DB_CombatReact_AD_OnTurn(S_LOW_GrottoCheckpointGuard_002_4ed10e2c-72d0-47cd-aee3-ecd531205ac8, LOW_SharGrotto_AD_OnTurn_GrottoCheckpointGuard_002_9fe57c20-bcc6-d0b8-b131-c91f5f85ffcb, 8);
DB_CombatReact_AD_OnTurn(S_LOW_ViconiaCultist_001_5ce3f68d-a9b4-4ae0-adae-26f84e20f39a, LOW_SharGrotto_AD_OnTurn_ViconiaCultist_001_04b0883c-5347-5f40-70e8-932e0ce36b71, 3);
DB_CombatReact_AD_OnTurn(S_LOW_ViconiaCultist_001_5ce3f68d-a9b4-4ae0-adae-26f84e20f39a, LOW_SharGrotto_AD_OnTurn_ViconiaCultist_001_04b0883c-5347-5f40-70e8-932e0ce36b71, 4);
DB_CombatReact_AD_OnTurn(S_LOW_ViconiaCultist_001_5ce3f68d-a9b4-4ae0-adae-26f84e20f39a, LOW_SharGrotto_AD_OnTurn_ViconiaCultist_001_04b0883c-5347-5f40-70e8-932e0ce36b71, 5);
DB_CombatReact_AD_OnTurn(S_LOW_ViconiaCultist_001_5ce3f68d-a9b4-4ae0-adae-26f84e20f39a, LOW_SharGrotto_AD_OnTurn_ViconiaCultist_001_04b0883c-5347-5f40-70e8-932e0ce36b71, 6);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249, LOW_SharGrotto_AD_OnTurn_SharranTrainee_001_5c92c012-daa5-33f2-359f-72b08fd00957, 1);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249, LOW_SharGrotto_AD_OnTurn_SharranTrainee_001_5c92c012-daa5-33f2-359f-72b08fd00957, 2);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249, LOW_SharGrotto_AD_OnTurn_SharranTrainee_001_5c92c012-daa5-33f2-359f-72b08fd00957, 3);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249, LOW_SharGrotto_AD_OnTurn_SharranTrainee_001_5c92c012-daa5-33f2-359f-72b08fd00957, 8);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_002_37441df0-a3fa-4709-800f-a4cfcec2448d, LOW_SharGrotto_AD_OnTurn_SharranTrainee_002_43806894-9a59-b461-1c8a-0bd094181b45, 1);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_002_37441df0-a3fa-4709-800f-a4cfcec2448d, LOW_SharGrotto_AD_OnTurn_SharranTrainee_002_43806894-9a59-b461-1c8a-0bd094181b45, 4);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_002_37441df0-a3fa-4709-800f-a4cfcec2448d, LOW_SharGrotto_AD_OnTurn_SharranTrainee_002_43806894-9a59-b461-1c8a-0bd094181b45, 6);
DB_CombatReact_AD_OnTurn(S_LOW_SharranTrainee_002_37441df0-a3fa-4709-800f-a4cfcec2448d, LOW_SharGrotto_AD_OnTurn_SharranTrainee_002_43806894-9a59-b461-1c8a-0bd094181b45, 9);
DB_LOW_SharGrotto_JusticiarArmor(UNI_SHA_JusticiarArmor_Breastplate_742d43ff-b74d-4cbe-9554-51773bbccdc2, "Breast");
DB_LOW_SharGrotto_JusticiarArmor(UNI_SHA_JusticiarArmor_Gloves_73a443e0-2056-4e4c-b8d2-d4283d8d3595, "Gloves");
PROC_LOW_SharGrotto_ViconiaConfrontation_SetUp();
DB_GLO_DieFlag(ORI_Shadowheart_Event_KillViconia_551f236d-6e7f-461d-bbf6-94cf0cc4ae88, S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, 0, NULL_00000000-0000-0000-0000-000000000000);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_SparedViconia_cd5421b3-6051-4641-a56f-69588173c13c, LOW_SharGrotto_ViconiaDefeated_OM_Shadowheart_COM_03382bb9-9c85-28fd-4c24-9069e44a0807);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_SparedViconia_cd5421b3-6051-4641-a56f-69588173c13c, LOW_SharGrotto_ViconiaDefeated_OM_Shadowheart_AOM_OOM_a13d9a9f-6c85-a18a-cfef-8889c0e19e34);
TriggerRegisterForItems(S_LOW_AltarTrigger_cb619852-ce0b-449f-b009-a16fb12da49d);
TriggerRegisterForCharacter(S_LOW_LossDoorBounds_43068efd-75c3-4299-a27f-d3e82c36ee17, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
TriggerRegisterForCharacter(S_LOW_AltarProximity_02066208-2947-4f99-8c25-7c02210e53c3, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
TriggerRegisterForCharacter(S_LOW_PostViconiaBounds_b23e10f4-2c85-45d3-a8a8-206c3afc11f9, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
PROC_TriggerRegisterForParty(S_LOW_DoorOpenBounds_7ed73ca2-8acf-4eec-b237-a894804dad96);
DB_LOW_SharGrotto_LossAltar(S_LOW_LossAltarStatue_37760d6c-056a-4f23-9256-bc01217b9056);
DB_LOW_SharGrotto_LossAltar(S_LOW_LossAltarPedestal_d962c6eb-08ab-4bbc-8664-d8f24fc0b480);
DB_LOW_SharGrotto_LossAltar(S_LOW_HelperEffect_f064268a-a84b-4677-b50b-11b465e14c62);
PROC_DeclareCounter("LOW_SharGrotto_AltarCount");
PROC_LOW_SharGrotto_LossAltarInit();
Use(S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449, S_LOW_FatherDisc_b86ca835-ece4-4b7f-8fe4-b5437af62377, "LOW_SharGrotto_AttachedToWheel");
Use(S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e, S_LOW_MotherDisc_c11dbb3d-7fe1-4a5b-bd85-8da2992f3987, "LOW_SharGrotto_AttachedToWheel");
SetCanInteract(S_LOW_FatherDisc_b86ca835-ece4-4b7f-8fe4-b5437af62377, 0);
SetCanInteract(S_LOW_MotherDisc_c11dbb3d-7fe1-4a5b-bd85-8da2992f3987, 0);
SetCanInteract(S_LOW_FeetDisc_a3eecd10-0271-4e06-b6fc-806e2afff9cc, 0);
PROC_DefineSingleOriginMoment(LOW_SharGrotto_ShadowheartFather_c07cb7d4-21d6-8203-86d6-dcc60764e9b0, REALLY_SHADOWHEART_642d2aee-e3df-47e3-9f47-bbcd441bb9e0, LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1, LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2, LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1);
DB_OneShot_VoiceBarkTrigger(S_LOW_SpotParents_08cf60ce-80ea-4035-950d-459c358816aa, LOW_SharGrotto_VB_SpottedParents_adc86a57-00c6-8d40-2fd7-2be466acb430, "Global");
DB_Dialogs(S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449, LOW_SharGrotto_ShadowheartFather_c07cb7d4-21d6-8203-86d6-dcc60764e9b0);
DB_Dialogs(S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e, LOW_SharGrotto_ShadowheartMother_37b44def-24e6-c5f0-427e-d4dda1890207);
DB_OriginMayLeaveDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, CAMP_Shadowheart_CRD_DefeatedParents_fae58cb0-9bf8-6f91-4b15-f08d23604107);
DB_OriginMayLeaveDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, LOW_SharGrotto_DefeatedParents_cd8e69ea-d78d-aa3b-6f23-202e67e0cff4);
DB_LOW_SharGrotto_ExclusiveReacts("Murder");
DB_LOW_SharGrotto_ExclusiveReacts("Assault");
PROC_CharacterDisableAllCrimes(S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449);
PROC_CharacterDisableAllCrimes(S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e);
DB_LOW_SharGrotto_ShadowheartParents(S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449, LOW_SharGrotto_ShadowheartFather_c07cb7d4-21d6-8203-86d6-dcc60764e9b0, S_CAMP_SLUMS_Shadowdad_22d7fad3-af80-4ea2-8e3e-c49afe13ec6f, CAMP_ShadowheartFather_215fdd40-89b6-fbd7-9a5b-a18d031cd0d4);
DB_LOW_SharGrotto_ShadowheartParents(S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e, LOW_SharGrotto_ShadowheartMother_37b44def-24e6-c5f0-427e-d4dda1890207, S_CAMP_SLUMS_Shadowmom_a07a0368-dd93-471f-81b9-2e29e9b9089f, CAMP_ShadowheartMother_88c80e2e-a203-0627-6c2a-12695a769c7e);
DB_DialogDeath(S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449);
DB_DialogDeath(S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e);
DB_OriginMoment_ExtraNPCs(LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1, S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e);
DB_OriginMoment_ExtraNPCs(LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2, S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_RejectShar_SavedParents_486d69d4-a7c2-4cb5-8fcb-8f2cb738ada9, LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_RejectShar_SavedParents_486d69d4-a7c2-4cb5-8fcb-8f2cb738ada9, LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_Shar_SavedParents_8a0fad17-1615-4a0d-a045-21661d9a2aa0, LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_Shar_SavedParents_8a0fad17-1615-4a0d-a045-21661d9a2aa0, LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_RejectShar_KilledParents_e9060caf-66b0-4701-8dfd-5ae1125f5afd, LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_RejectShar_KilledParents_e9060caf-66b0-4701-8dfd-5ae1125f5afd, LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac, LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1);
DB_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac, LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2);
DB_LOW_SharGrotto_ParentsResolutions(SHADOWHEART_ENEMYOFSHARPATH_8eca8027-996c-4c61-bec6-77f853de295b, ORI_Shadowheart_State_RejectShar_KilledParents_e9060caf-66b0-4701-8dfd-5ae1125f5afd, ORI_Shadowheart_State_RejectShar_SavedParents_486d69d4-a7c2-4cb5-8fcb-8f2cb738ada9);
DB_LOW_SharGrotto_ParentsResolutions(SHADOWHEART_SHARPATH_9624a3fe-bb9e-47c5-b9ab-417e6da6f84b, ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac, ORI_Shadowheart_State_Shar_SavedParents_8a0fad17-1615-4a0d-a045-21661d9a2aa0);
DB_KnowledgeCheckTrigger("LOW_SharGrotto_GithLog", S_LOW_GithInvestigation_649d48cf-809c-47ee-a133-bd0508eefa1a, "Investigation", Act3_Medium_77cee1c4-384a-4217-b670-67db3c7add57);
SetCanInteract(S_LOW_RubbleContainer_30a493be-7dc7-48c7-ac38-5c9fce2b5e13, 0);
PROC_TriggerRegisterForPlayers(S_LOW_ChamberOfLoss_15d3d070-5887-4305-a931-0ce2882c1955);
TriggerRegisterForCharacter(S_LOW_GrottoOutfitRoom_SHCheck_264402e8-71f4-4136-afa6-78449165f7f3, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
DB_ItemDialog_PlayerVB(S_LOW_SharMannequin_Bard_1650e818-14b0-4e17-8cd6-15d3310aa1b4, LOW_SharGrotto_VB_Mannequins_701382d3-f8d3-ff27-200c-0aeaef6f0ab1);
DB_ItemDialog_PlayerVB(S_LOW_SharMannequin_DaisyDress_5f1aa05c-a0f8-4eee-a048-7715c2b23b77, LOW_SharGrotto_VB_Mannequins_701382d3-f8d3-ff27-200c-0aeaef6f0ab1);
DB_ItemDialog_PlayerVB(S_LOW_SharMannequin_Doublet_6c54a5e4-e397-41f2-92b7-d2692f8d200d, LOW_SharGrotto_VB_Mannequins_701382d3-f8d3-ff27-200c-0aeaef6f0ab1);
DB_ItemDialog_PlayerVB(S_LOW_SharMannequin_RichDress_48ac5dd6-818c-4423-8138-b757f05d4475, LOW_SharGrotto_VB_Mannequins_701382d3-f8d3-ff27-200c-0aeaef6f0ab1);
DB_ItemDialog_PlayerVB(S_LOW_TortureRack_21464900-5f2c-440c-8238-d55b6fca4eb1, LOW_SharGrotto_VB_TortureRack_d0e59beb-88b1-1344-580b-0515d077d9e1);
DB_ItemDialog_PlayerVB(S_LOW_TortureBench_81acb432-b3c8-4fdd-b71c-734ea496d2d7, LOW_SharGrotto_VB_TortureBench_f2cd853a-59a0-1074-da22-cce3e300e3ef);
DB_OneShot_VoiceBarkTrigger(S_LOW_GrottoOutfitRoom_2ae4a62a-b910-49a0-80d1-9f43ee281056, LOW_SharGrotto_VB_OutfitRoom_a5dc531b-4275-5347-df7c-a6772018013a, "Global");
DB_OneShot_VoiceBarkTrigger(S_LOW_TortureOutfitRoom_b9e67623-17d1-4eda-b738-3e13622e4b85, LOW_SharGrotto_VB_TortureRoom_b8322397-15c1-ba31-4a3e-95edcaeb1f76, "Global");
DB_OneShot_VoiceBarkTrigger(S_LOW_ShadowheartCorridor_46b52925-9351-46a1-b20f-3cc6edc3bbf1, LOW_SharGrotto_VB_ShadowheartCorridor_6a2b9334-762a-fcf0-77e9-8cc4efbd6ca3, "Global");
DB_LOW_SharGrotto_Mannequins(S_LOW_SharMannequin_Doublet_6c54a5e4-e397-41f2-92b7-d2692f8d200d, LOW_SharGrotto_PAD_Mannequin_Doublet_260161bd-7972-4d72-16d4-47651f3c489b);
DB_LOW_SharGrotto_Mannequins(S_LOW_SharMannequin_DaisyDress_5f1aa05c-a0f8-4eee-a048-7715c2b23b77, LOW_SharGrotto_PAD_Mannequin_FancyDress_18648eee-45f3-3f8a-19b7-4e02ce4cf395);
DB_LOW_SharGrotto_Mannequins(S_LOW_SharMannequin_RichDress_48ac5dd6-818c-4423-8138-b757f05d4475, LOW_SharGrotto_PAD_Mannequin_GreenDress_281afa60-f8f9-1395-d787-053903f4cb46);
DB_LOW_SharGrotto_Mannequins(S_LOW_SharMannequin_Bard_1650e818-14b0-4e17-8cd6-15d3310aa1b4, LOW_SharGrotto_PAD_Mannequin_Bard_4835967a-a6f0-d486-47aa-06043b733cb5);
DB_Dialogs(S_LOW_BlackMirror_d9907043-c08f-49bb-87d0-bb3eeb723a06, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_LOW_SharGrotto_MirrorFlags(0, LOW_SharGrotto_State_Mirror_AtleastOne_006137c3-12e6-49e2-bf66-1e9c903488e6);
DB_LOW_SharGrotto_MirrorFlags(1, LOW_SharGrotto_State_Mirror_AtleastTwo_312b7945-539c-498e-9cb9-d2d6ecf369cd);
DB_LOW_SharGrotto_MirrorFlags(2, LOW_SharGrotto_State_Mirror_AtleastThree_dc046b91-3122-4fd4-b0cd-93dc6d3246c5);
DB_LOW_SharGrotto_MirrorFlags(3, LOW_SharGrotto_State_Mirror_AtleastFour_3048b621-ee24-4835-bb42-47b23675ea25);
DB_LOW_SharGrotto_MirrorFlags(4, LOW_SharGrotto_State_Mirror_AtleastFive_6585b24f-75b9-491f-8f77-8938d9a0bec9);
DB_LOW_SharGrotto_MirrorFlags(5, LOW_SharGrotto_State_Mirror_AtleastSix_e91d99ae-ceb1-4bb8-ae4a-4731702649bf);
DB_LOW_SharGrotto_MirrorMemories(LOW_SharGrotto_State_Mirror_StrengthBoon_a56dc9d9-ad76-4c50-80d0-220a143b7350, "LOW_SharGrotto_Mirror_StrengthBoon_Passive");
DB_LOW_SharGrotto_MirrorMemories(LOW_SharGrotto_State_Mirror_DexterityBoon_4acd716a-be6f-407a-a2c4-ca05df6dbaad, "LOW_SharGrotto_Mirror_DexterityBoon_Passive");
DB_LOW_SharGrotto_MirrorMemories(LOW_SharGrotto_State_Mirror_ConstitutionBoon_75de0426-0ec0-4e8e-b515-f29e4959d091, "LOW_SharGrotto_Mirror_ConstitutionBoon_Passive");
DB_LOW_SharGrotto_MirrorMemories(LOW_SharGrotto_State_Mirror_IntelligenceBoon_3748609d-1bd3-4e1b-84df-17fc048ac2a2, "LOW_SharGrotto_Mirror_IntelligenceBoon_Passive");
DB_LOW_SharGrotto_MirrorMemories(LOW_SharGrotto_State_Mirror_WisdomBoon_39efe295-9388-443a-bc8f-9159da9c4ea7, "LOW_SharGrotto_Mirror_WisdomBoon_Passive");
DB_LOW_SharGrotto_MirrorMemories(LOW_SharGrotto_State_Mirror_CharismaBoon_bd441ffc-da74-4e01-a7bc-d6b8128a281f, "LOW_SharGrotto_Mirror_CharismaBoon_Passive");
DB_LOW_SharGrotto_MirrorMemories(LOW_SharGrotto_State_Mirror_MinorCharismaBoon_980c4489-7ce3-4539-9781-24eaff117c10, "LOW_SharGrotto_Mirror_MinorCharismaBoon_Passive");
DB_LOW_SharGrotto_MirrorPlayerMemories(LOW_SharGrotto_State_Mirror_OfferedStrengthMemory_53b26466-e873-49ff-8290-12f9dae27f3c, "LOW_STRENGTHSACRIFICE");
DB_LOW_SharGrotto_MirrorPlayerMemories(LOW_SharGrotto_State_Mirror_OfferedDexterityMemory_d367b7c2-3ea0-4936-884c-3f0e66b82d22, "LOW_DEXTERITYSACRIFICE");
DB_LOW_SharGrotto_MirrorPlayerMemories(LOW_SharGrotto_State_Mirror_OfferedConstitutionMemory_4ca660eb-efe5-4242-927a-9c6484dd6eeb, "LOW_CONSTITUTIONSACRIFICE");
DB_LOW_SharGrotto_MirrorPlayerMemories(LOW_SharGrotto_State_Mirror_OfferedIntelligenceMemory_16dbd751-9d30-46af-9dec-ad11a4b975ff, "LOW_INTELLIGENCESACRIFICE");
DB_LOW_SharGrotto_MirrorPlayerMemories(LOW_SharGrotto_State_Mirror_OfferedWisdomMemory_aaabef4b-0f60-4e1a-8c31-0e8daa2cd403, "LOW_WISDOMSACRIFICE");
DB_LOW_SharGrotto_MirrorPlayerMemories(LOW_SharGrotto_State_Mirror_OfferedCharismaMemory_be63a02d-e7c7-43bc-adfd-bdcd8d2c7c85, "LOW_CHARISMASACRIFICE");
DB_LOW_SharGrotto_MirrorShadowheartMemories(LOW_SharGrotto_State_Mirror_SHhasRomance_0669a1c6-8f6d-4be7-9bf0-812bd2cb40a6, LOW_SharGrotto_State_Mirror_OfferedCharismaMemory_be63a02d-e7c7-43bc-adfd-bdcd8d2c7c85);
DB_LOW_SharGrotto_MirrorShadowheartMemories(ORI_Shadowheart_State_NobleStalkMemory_d0d87954-6563-4e26-9f2c-4616e3cfeb0e, LOW_SharGrotto_State_Mirror_OfferedConstitutionMemory_4ca660eb-efe5-4242-927a-9c6484dd6eeb);
DB_LOW_SharGrotto_MirrorShadowheartMemories(ORI_Shadowheart_State_HideoutMemoryUnlocked_b14b2caa-27c5-4cd9-b365-babf4f959f3f, LOW_SharGrotto_State_Mirror_OfferedWisdomMemory_aaabef4b-0f60-4e1a-8c31-0e8daa2cd403);
DB_LOW_SharGrotto_MirrorShadowheartMemories(ORI_Shadowheart_State_GraffitiMemoryUnlocked_eb535c3e-a33f-4d0b-94cb-2abf7c66ab18, LOW_SharGrotto_State_Mirror_OfferedDexterityMemory_d367b7c2-3ea0-4936-884c-3f0e66b82d22);
DB_LOW_SharGrotto_MirrorShadowheartMemories(ORI_Shadowheart_State_GraveMemoryUnlocked_f1382026-f257-42cf-b10d-98c6eeb10ad5, LOW_SharGrotto_State_Mirror_OfferedIntelligenceMemory_16dbd751-9d30-46af-9dec-ad11a4b975ff);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_StrengthBoon_a56dc9d9-ad76-4c50-80d0-220a143b7350, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_DexterityBoon_4acd716a-be6f-407a-a2c4-ca05df6dbaad, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_ConstitutionBoon_75de0426-0ec0-4e8e-b515-f29e4959d091, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_IntelligenceBoon_3748609d-1bd3-4e1b-84df-17fc048ac2a2, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_WisdomBoon_39efe295-9388-443a-bc8f-9159da9c4ea7, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_CharismaBoon_bd441ffc-da74-4e01-a7bc-d6b8128a281f, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_MinorCharismaBoon_980c4489-7ce3-4539-9781-24eaff117c10, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_OfferedStrengthMemory_53b26466-e873-49ff-8290-12f9dae27f3c, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_OfferedDexterityMemory_d367b7c2-3ea0-4936-884c-3f0e66b82d22, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_OfferedConstitutionMemory_4ca660eb-efe5-4242-927a-9c6484dd6eeb, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_OfferedIntelligenceMemory_16dbd751-9d30-46af-9dec-ad11a4b975ff, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_OfferedWisdomMemory_aaabef4b-0f60-4e1a-8c31-0e8daa2cd403, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
DB_FlagReactionAfterDialog(LOW_SharGrotto_State_Mirror_OfferedCharismaMemory_be63a02d-e7c7-43bc-adfd-bdcd8d2c7c85, LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112);
PROC_LOW_SharGrotto_MemoryCheck();
SetOnStage(PUZ_GEN_Key_Threshold_of_Loss_b49e15a1-e63f-488a-9649-6140c363fe5b, 0);
DB_SpotPlayers(S_LOW_GrottoSentry_90c54fce-9a57-4ff5-9d36-0363ef90c5f1, "LOW_SharGrotto_SentryGreet", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_TargetIgnoreCantTalk(S_LOW_GrottoSentry_90c54fce-9a57-4ff5-9d36-0363ef90c5f1, "LOW_SharGrotto_SentryGreet");
DB_SpotPlayers_CustomRadius(S_LOW_GrottoSentry_90c54fce-9a57-4ff5-9d36-0363ef90c5f1, "LOW_SharGrotto_SentryGreet", 10);
DB_LOW_SharGrotto_PrayingCultists(S_LOW_OptionalCultist_000_68f11a56-ab1d-432c-adbf-8d9b24083915);
DB_LOW_SharGrotto_PrayingCultists(S_LOW_SharranTrainee_000_9a3f9520-f900-4f00-b244-546e89bebc16);
DB_LOW_SharGrotto_PrayingCultists(S_LOW_SharranTrainee_001_6869f71b-d661-4544-8211-708ec2225249);
DB_LOW_SharGrotto_PrayingCultists(S_LOW_SharranTrainee_004_24498358-fc73-4e6f-bf64-466c8bb22fb8);
DB_TopicalGreeting(TG_LOW_SharGrotto_InGrotto_fa6de38a-6cd5-463d-8492-61952782b85f);
DB_TopicalGreetingEndCondition_FlagSet(TG_LOW_SharGrotto_InGrotto_fa6de38a-6cd5-463d-8492-61952782b85f, LOW_SharGrotto_Event_LeftGrotto_5e8e8690-a1f4-47f5-93a1-2c99a65a35a6);

KBSECTION
IF
DialogStarted(LOW_NGB_SharGrotto_Trespassing_fac07fbe-0d24-e220-7b2b-35932fa5c844, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogNPCs(_Var1, _Var2, 1, _Var1, _Var1)
THEN
DB_LOW_SharGrotto_CultistSpottedSneaker(_Var2);

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Var1, LOW_SharGrotto_Event_TrespasserSpotted_ba8392e8-fa2f-4ce8-966f-7bfbf101e39c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_CultistSpottedSneaker(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_LOW_SharGrotto_ViconiaDialogActive()
THEN
PROC_LOW_SharGrotto_TriggerDialog(_Var1);
CharacterStopCrime(_Var1, "LOW_SharGrotto_Trespass", NULL_00000000-0000-0000-0000-000000000000);
NOT DB_LOW_SharGrotto_CultistSpottedSneaker(_Var2);

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Var1, LOW_SharGrotto_Event_TrespasserSpotted_ba8392e8-fa2f-4ce8-966f-7bfbf101e39c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_CultistSpottedSneaker(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_LOW_SharGrotto_ViconiaDialogActive()
AND
DB_QRYRTN_LOW_SharGrotto_ConfrontID(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
CharacterStopCrime(_Var1, "LOW_SharGrotto_Trespass", NULL_00000000-0000-0000-0000-000000000000);
PROC_DialogAddListeningActor(_Var3, _Var1);
NOT DB_LOW_SharGrotto_CultistSpottedSneaker(_Var2);
NOT DB_QRYRTN_LOW_SharGrotto_ConfrontID(_Var3);

QRY
QRY_LOW_SharGrotto_ViconiaDialogActive()
AND
DB_DialogName(LOW_SharGrotto_ConfrontViconia_NoShadowheart_78e68cb8-fc4e-fa55-c4a9-5f7224b86fe4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_SharGrotto_ConfrontID(_Var1);

QRY
QRY_LOW_SharGrotto_ViconiaDialogActive()
AND
DB_DialogName(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_SharGrotto_ConfrontID(_Var1);

QRY
QRY_LOW_SharGrotto_ViconiaDialogActive()
AND
DB_DialogName(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_SharGrotto_ConfrontID(_Var1);

IF
FlagSet(LOW_SharGrotto_ConfrontViconia_SharranAlliance_ea829b7c-5f69-c4fc-6b4c-b8a190d31a86, _, _, _, _)
AND
DB_LOW_SharGrotto_ConfrontationParticipants(_, _Var4, _, _, _)
THEN
PROC_PeacefulResolve(_Var4);

IF
FlagSet(LOW_SharGrotto_State_PromisedBringShadowheart_ba85fccc-c09b-41c3-82ec-69693db59204, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_SharGrotto_Admitted();

IF
FlagSet(LOW_SharGrotto_ConfrontViconia_SharranAlliance_ea829b7c-5f69-c4fc-6b4c-b8a190d31a86, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_SharGrotto_Admitted();

IF
FlagSet(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_SharGrotto_Admitted();

PROC
PROC_LOW_SharGrotto_Admitted()
AND
DB_TrespassTrigger(S_LOW_GreaterGrottoTrespass_fa9add2a-81e6-4a4f-a37b-09a1cd680192, NULL_00000000-0000-0000-0000-000000000000, "LOW_SharGrotto_Trespass", _, _)
THEN
PROC_RemoveDBTrespassTrigger(S_LOW_GreaterGrottoTrespass_fa9add2a-81e6-4a4f-a37b-09a1cd680192, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_LOW_SharGrotto_Admitted()
AND
DB_TrespassTrigger(S_LOW_InnerGrottoTrespass_73a192ef-e53d-4944-890c-c4210ffa7f96, NULL_00000000-0000-0000-0000-000000000000, "LOW_SharGrotto_Trespass", _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_GrottoAdmitted_3a92f2ee-8d50-4557-915b-f7bae85c7546);
PROC_RemoveDBTrespassTrigger(S_LOW_InnerGrottoTrespass_73a192ef-e53d-4944-890c-c4210ffa7f96, NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, "LOW_SharGrotto_Trespass", _, _, _)
AND
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, "LOW_SharGrotto_Trespass", _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_CrimeGetCustomArrestDialogCustom((CHARACTER)_Var1, (INTEGER)_Var2, _, (CHARACTER)_Var4, _, S_LOW_ShadowheartFriend_2c10ff0f-d2ff-4dcb-8f8b-c6f870044f5d, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
CrimeGetType(_Var2, "LOW_SharGrotto_Trespass", _Var1, _Var1, _Var1)
THEN
DB_CrimeArrest_CustomDialog(_Var1, _Var2, LOW_NGB_SharGrotto_Trespassing_fac07fbe-0d24-e220-7b2b-35932fa5c844);

PROC
PROC_CheckPointDialogue((CHARACTER)_Var1, S_LOW_GrottoCheckpointGuard_000_4502bf48-a7fc-4708-94ef-52bfd8285c6c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartCheckpointWarningDialog("S_LOW_GrottoRightHallCheckpoint", LOW_SharGrotto_RightCheckpoint_Primary_2500639e-c7b9-bb6f-f0d5-f6117171d7a4, S_LOW_GrottoCheckpointGuard_000_4502bf48-a7fc-4708-94ef-52bfd8285c6c, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_CheckPointDialogue((CHARACTER)_Var1, S_LOW_GrottoCheckpointGuard_001_1effcc57-318d-4d42-873d-7550a399a40b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartCheckpointWarningDialog("S_LOW_GrottoRightHallCheckpoint", LOW_SharGrotto_RightCheckpoint_Warning_54258d40-2c71-8051-9850-22a52bdcf804, S_LOW_GrottoCheckpointGuard_001_1effcc57-318d-4d42-873d-7550a399a40b, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_CheckPointDialogue((CHARACTER)_Var1, S_LOW_GrottoCheckpointGuard_002_4ed10e2c-72d0-47cd-aee3-ecd531205ac8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartCheckpointWarningDialog("S_LOW_GrottoLeftHallCheckpoint", LOW_SharGrotto_LeftCheckpoint_Primary_4b2b82cf-f734-587a-e186-0054b6b140e1, S_LOW_GrottoCheckpointGuard_002_4ed10e2c-72d0-47cd-aee3-ecd531205ac8, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_CheckPointDialogue((CHARACTER)_Var1, S_LOW_GrottoCheckpointGuard_003_67f579e5-655b-41e3-b74c-37fe1abd03d4, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartCheckpointWarningDialog("S_LOW_GrottoLeftHallCheckpoint", LOW_SharGrotto_LeftCheckpoint_Warning_7e66a3df-17ff-9967-4c2d-bb7c95b7c175, S_LOW_GrottoCheckpointGuard_003_67f579e5-655b-41e3-b74c-37fe1abd03d4, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(LOW_SharGrotto_Event_CheckArmor_c138c905-e511-4bc1-97f0-6332cb888007, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_LOW_SharGrotto_CheckArmor(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_HasDarkJusticiarArmourSet_8e6b195c-9171-4e71-b496-a65ca4463c63);

QRY
QRY_LOW_SharGrotto_CheckArmor((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_JusticiarArmor(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
GetEquippedItem(_Var1, _Var3, _Var4, _Var1, _Var1)
AND
GetTemplate(_Var4, _Var5, _Var1, _Var1, _Var1)
AND
_Var5 != _Var2
THEN
DB_NOOP(1);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_SharGrotto_Event_SurrenderShadowheart_bfc7f3b7-4e58-44e1-bb58-131ee77fc0ad, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, _, _, _)
THEN
DB_CompanionLeaving(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var3);
PROC_Origins_CompanionLeavePermanently(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "LOW_SharGrotto_SoldToViconia");
PROC_DisappearOutOfSightTo(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_LOW_ShadowheartMovePos_33535284-bed1-49f4-ae32-f9c2c25af352, "Walk", 0, "LOW_SharGrotto_ShadowheartLeftForWipe");

PROC
PROC_LongRest()
AND NOT
DB_PermaDefeated(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
DB_GlobalFlag(LOW_SharGrotto_Event_SurrenderShadowheart_bfc7f3b7-4e58-44e1-bb58-131ee77fc0ad, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SharGrotto_ShadowheartWiped", _, _, _, _)
THEN
TeleportTo(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_LOW_ShadowheartPos_936e4555-544b-46fd-a93c-cf2fbffb9c6b, "", 0, 0, 0, 1, 1);
SetOnStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1);
SetFaction(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ACT3_LOW_SharCultist_Grotto_415731a9-1e23-4873-afe9-a4619a973bfa);
PROC_RemoveDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
DB_Dialogs(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, LOW_SharGrotto_ShadowheartMindWiped_0b35060c-8e9e-a818-6f39-9874bed2e5ef);

PROC
PROC_LOW_SharGrotto_ViconiaConfrontation_SetUp()
THEN
TeleportTo(S_SHA_VoiceOfShar_OverrideSpeaker_9293e853-5c10-45a1-a158-ebcde08c02ee, S_LOW_SharPoint_2d57442d-1bb0-4d77-bccb-d495275cdd9f, "LOW_SharGrotto_SharTeleport", 0, 0, 0, 1, 0);

PROC
PROC_LOW_SharGrotto_ViconiaConfrontation_SetUp()
AND
DB_GlobalFlag(WYR_SharInformer_State_InformerEnemy_da9d89d1-e5d1-4b68-bf20-0da80ab148cc, _, _, _, _)
THEN
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("Unaligned");
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("Lackeys");
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("ShadowheartAlly");
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("Informer");

PROC
PROC_LOW_SharGrotto_ViconiaConfrontation_SetUp()
AND NOT
DB_GlobalFlag(WYR_SharInformer_State_InformerEnemy_da9d89d1-e5d1-4b68-bf20-0da80ab148cc, _, _, _, _)
THEN
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("Unaligned");
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("Lackeys");
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("ShadowheartAlly");

PROC
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_LOW_SharGrotto_ConfrontationParticipants(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_OriginMoment_ExtraNPCs(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491, _Var2);
DB_OriginMoment_ExtraNPCs(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd, _Var2);

PROC
PROC_LOW_SharGrotto_ViconiaConfrontation_DefineExtraSpeakers("Informer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_ConfrontationParticipants("Informer", _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(S_GLO_SharranInformer_b2cf2efe-ec06-48cd-8fb7-ad596d61164f, S_LOW_FergAppear_cee56731-eb3e-4a8a-ac81-f33ab96020ac, "", 0, 0, 0, 0, 0);

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "LOW_SharGrotto_SermonScene", "DisturbanceRegistering", _)
AND
DB_SceneManager_DisturbanceRegistering(_Var2, "Assault", _, _, _, _, _, _, _, _)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SharCultist_Grotto_415731a9-1e23-4873-afe9-a4619a973bfa, 0);
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_FinishedSermon_1ab561f3-1756-494a-bbbd-90580e530c36);
PROC_SceneOver("LOW_SharGrotto_SermonScene");

PROC
PROC_SceneInterrupted(_, _, "LOW_SharGrotto_SermonScene", (STRING)_Var3, (GUIDSTRING)_)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_FinishedSermon_1ab561f3-1756-494a-bbbd-90580e530c36);
PROC_SceneOver("LOW_SharGrotto_SermonScene");

PROC
PROC_SpotPlayers_Spotted(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_ViconiaSpot", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_LOW_SharGrotto_TriggerDialog(_Var1);

PROC
PROC_LOW_SharGrotto_TriggerDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialog(LOW_SharGrotto_ConfrontViconia_NoShadowheart_78e68cb8-fc4e-fa55-c4a9-5f7224b86fe4, S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, (STRING)_Var2, (GUIDSTRING)_Var3, S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _)
THEN
DB_NOOP(1);

IF
DialogStarted(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SharGrotto_ConfrontationStarted", _, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_ViconiaSpot");

IF
DialogStarted(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SharGrotto_ConfrontationStarted", _, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SharGrotto_ViconiaSpot");

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_AOM_OOM_2a789ab8-8c27-ce72-9cc1-13c14c4cc491, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_ConfrontViconia_OM_Shadowheart_COM_6ebbe983-6aa1-1f25-6fcb-ec0aed2252bd, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

IF
FlagSet((FLAG)_Var1, (CHARACTER)_Var2, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_LOW_SharGrotto_CultistSwayFlags(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ConfrontationParticipants(_Var4, _Var5, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var5, _Var2, 0, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
SetFaction(_Var5, ACT3_LOW_SharCultist_SwayedCultist_6829cbb6-ef01-4423-8b12-130912ce302a);

IF
FlagSet((FLAG)_Var1, (GUIDSTRING)_Var2, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_LOW_HouseOfGrief_HeartForms(_, _, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_HeartFormTags(_Var1, _Var6, _Var1, _Var1, _Var1)
THEN
SetTag(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var6);

IF
FlagSet((FLAG)_Var1, (GUIDSTRING)_Var2, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_LOW_SharGrotto_FearTags(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
SetTag(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var4);

IF
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _, _, _, _)
THEN
ApplyStatus(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_HOUSEOFGRIEF_SH_PRESENCE", -1, 1);
DB_LOW_SharGrotto_ViconiaHasStatus(1);

IF
DB_LOW_SharGrotto_ViconiaHasStatus(1, _, _, _, _)
AND NOT
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _, _, _, _)
THEN
RemoveStatus(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_HOUSEOFGRIEF_SH_PRESENCE");

IF
DB_Is_InCombat(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SharGrotto_HeartTagged(1, _Var1, _Var1, _Var1, _Var1)
THEN
SetTag(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, ACT3_LOW_HOUSEOFGRIEF_SHADOWHEART_f16ff923-66b8-46d2-80db-95108612bbee);
DB_LOW_SharGrotto_HeartTagged(1);

IF
DB_LOW_SharGrotto_HeartTagged(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SharGrotto_HeartTagged(1);
ClearTag(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, ACT3_LOW_HOUSEOFGRIEF_SHADOWHEART_f16ff923-66b8-46d2-80db-95108612bbee);

IF
DB_LOW_SharGrotto_HeartTagged(1, _, _, _, _)
AND NOT
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _, _, _, _)
THEN
NOT DB_LOW_SharGrotto_HeartTagged(1);
ClearTag(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, ACT3_LOW_HOUSEOFGRIEF_SHADOWHEART_f16ff923-66b8-46d2-80db-95108612bbee);

IF
DB_Is_InCombat(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("ORI_Shadowheart_ViconiaWolfReaction", _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("ORI_Shadowheart_ViconiaWolfReaction");
DB_CombatReact_AD_OnCastOther(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, ORI_Shadowheart_PAD_ViconiaWolf_cf8b3753-feb9-cd10-d044-2d8bcdf410c1, "Target_LOW_HouseOfGrief_ExploitFear_Wolf_2");

QRY
QRY_DialogAttackRequested_CustomResponse(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_TryStopDialogFor(_Var1);
PROC_SetRelationToPlayers(ACT3_LOW_SharCultist_Grotto_415731a9-1e23-4873-afe9-a4619a973bfa, 0);

IF
EnteredCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _, _, _, _)
AND
DB_LOW_SharGrotto_ConfrontationParticipants(_, _Var3, _, _, _)
AND NOT
DB_Defeated(_Var3, _, _, _, _)
AND
GetFaction(_Var3, ACT3_LOW_SharCultist_Grotto_415731a9-1e23-4873-afe9-a4619a973bfa, _, _, _)
THEN
DB_GLO_DefeatCounter(_Var3, "LOW_SharGrotto_SharranCultists");

IF
DB_Is_InCombat(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _Var1, _Var1, _Var1, _Var1)
THEN
SetImmortal(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, 1);

IF
HitpointsChanged(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, 0, _, _, _)
AND NOT
DB_OnlyOnce("LOW_SharGrotto_ViconiaConfronted", _, _, _, _)
THEN
PROC_CombatReact_RemoveCombatADs(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313);
SetFaction(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, ACT3_LOW_ViconiaDefeated_873c1fe1-508c-45bb-969c-e986cdab1b3e);
PROC_SetRelationMutual(ACT3_LOW_SharCultist_SwayedCultist_6829cbb6-ef01-4423-8b12-130912ce302a, ACT3_LOW_ViconiaDefeated_873c1fe1-508c-45bb-969c-e986cdab1b3e, 51);
ApplyStatus(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SHARGROTTO_VICONIADEFEAT", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_CombatStarted(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("LOW_SharGrotto_ViconiaConfronted", _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SharGrotto_ViconiaCombat(_Var1);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SharGrotto_ViconiaCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsImmortal(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, 1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SHARGROTTO_VICONIADEFEAT", 1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_ViconiaConfronted", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterDisableAllCrimes(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, 1);
PROC_GlobalSetFlagAndCache(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097);
PROC_RemoveDialog(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313);
SetHitpointsPercentage(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, 10);
SetImmortal(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, 0);
DB_Dialogs(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, LOW_SharGrotto_ViconiaDefeated_NoShadowheart_6c6f05fc-391a-40f8-c7c0-68bd37dd1e09);

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_ConfrontationParticipants(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DB_PermaDefeated(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
THEN
PROC_LOW_SharGrotto_Admitted();
PROC_GlobalSetFlagAndCache(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SharGrotto_ViconiaCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SharGrotto_ViconiaCombat(_Var1);

IF
DB_InRegion(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_LOW_AltarProximity_02066208-2947-4f99-8c25-7c02210e53c3, _, _, _)
AND
DB_GlobalFlag(LOW_SharGrotto_State_KilledCultists_2f9e0755-1f69-45f4-b7d7-7ad1814ecc3c, _, _, _, _)
AND
IsTagged(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, SHADOWHEART_SHARPATH_9624a3fe-bb9e-47c5-b9ab-417e6da6f84b, 1, _, _)
AND
QRY_OnlyOnce("LOW_SharGrotto_SharCalledOut", _, _, _, _)
THEN
TriggerUnregisterForCharacter(S_LOW_AltarProximity_02066208-2947-4f99-8c25-7c02210e53c3, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
PROC_TryStartAD(LOW_SharGrotto_AD_SharVoiceAltar_5857e168-ec5f-14e1-5a6b-b8c6509aa613, S_LOW_LossAltarStatue_37760d6c-056a-4f23-9256-bc01217b9056);

IF
DB_InRegion(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_LOW_PostViconiaBounds_b23e10f4-2c85-45d3-a8a8-206c3afc11f9, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SharGrotto_State_LossDoorOpened_7e985e7e-b56b-40cf-a7d2-db08295ae07c, _, _, _, _)
AND
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
AND NOT
DB_CantTalk(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SharGrotto_PostViconia", _, _, _, _)
THEN
StartVoiceBark(LOW_SharGrotto_VB_PostViconia_bf7329d2-25d3-e0e1-095d-e0af6e1c50bb, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_ViconiaDefeated_OM_Shadowheart_AOM_OOM_a13d9a9f-6c85-a18a-cfef-8889c0e19e34, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_ViconiaDefeated_OM_Shadowheart_COM_03382bb9-9c85-28fd-4c24-9069e44a0807, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

PROC
PROC_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_SparedViconia_cd5421b3-6051-4641-a56f-69588173c13c, _, _, _, _)
THEN
RemoveStatus(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, "LOW_SHARGROTTO_VICONIADEFEAT", NULL_00000000-0000-0000-0000-000000000000);
PROC_DisappearOutOfSightTo(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, S_LOW_SharranTrainee_003_GuardLookAt_0e201d44-29e8-4539-8bad-fc5efaaba4e3, "Walk", 0, "");

IF
FlagSet(ORI_Shadowheart_State_BecamePontiff_4c521953-3277-4a59-9e3d-8e161916ed8b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
TriggerRegisterForCharacter(S_LOW_FealtyBounds_9098c9fb-df62-4c7d-87cd-4070678fb9f9, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

IF
EnteredTrigger(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_LOW_FealtyBounds_9098c9fb-df62-4c7d-87cd-4070678fb9f9, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_OfferFealty_9a7b540c-8f3e-4ea8-bde7-01e67e3e2020);
TriggerUnregisterForCharacter(S_LOW_FealtyBounds_9098c9fb-df62-4c7d-87cd-4070678fb9f9, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SharGrotto_State_OfferFealty_9a7b540c-8f3e-4ea8-bde7-01e67e3e2020, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SharGrotto_State_CultistActivity_ed215bbf-787d-4b2f-811e-7e9aec032c2d, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_CultistActivity_ed215bbf-787d-4b2f-811e-7e9aec032c2d);

IF
FlagSet(LOW_SharGrotto_State_CultistActivity_ed215bbf-787d-4b2f-811e-7e9aec032c2d, _, _, _, _)
AND
DB_LOW_SharGrotto_PrayingCultists(_Var3, _, _, _, _)
AND NOT
DB_PermaDefeated(_Var3, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SharGrotto_State_CultistsPraying_daa525da-ebae-4a39-87b0-31e36790e6e7, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_CultistsPraying_daa525da-ebae-4a39-87b0-31e36790e6e7);

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_FamiliarFace_OM_Shadowheart_AOM_OOM_76131ed2-b08c-9014-8997-f3af9f1968ba, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_FamiliarFace_OM_Shadowheart_COM_7c87d40e-6e62-66a7-8c4a-20d5edbf37c8, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

IF
FlagSet(LOW_SharGrotto_State_UnlockedFriendDialog_dd67ca1e-b36d-49d1-8822-6bb47ebfe2fe, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetCanTrade(S_LOW_ShadowheartFriend_2c10ff0f-d2ff-4dcb-8f8b-c6f870044f5d, 1);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SharGrotto_State_TraderLeavingNextRest_ebc26739-3c56-4798-94c4-e6643cfaa518, _, _, _, _)
THEN
SetOnStage(S_LOW_ShadowheartFriend_2c10ff0f-d2ff-4dcb-8f8b-c6f870044f5d, 0);

IF
FlagSet(LOW_SharGrotto_State_TraderJoiningCombat_c7308f7d-05c0-41f5-9489-35e1865b7920, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFaction(S_LOW_ShadowheartFriend_2c10ff0f-d2ff-4dcb-8f8b-c6f870044f5d, ACT3_LOW_SharCultist_SwayedCultist_6829cbb6-ef01-4423-8b12-130912ce302a);

IF
Opened(S_LOW_LossDoor_cf162070-3360-49d1-9f26-0919b6856c02, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, 0);
PROC_SetRelationToPlayers(ACT3_LOW_SharCultist_DoorGuard_02694e65-8567-4147-a8eb-3956b1b7606a, 0);

IF
RelationChanged(ACT3_LOW_Viconia_645c9175-5efd-411b-a3c2-b098de8f7c00, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, _, _)
AND NOT
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
THEN
DB_LOW_SharGrotto_ViconiaHostile(1);

IF
DB_GlobalFlag(LOW_SharGrotto_State_LossDoorOpened_7e985e7e-b56b-40cf-a7d2-db08295ae07c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
AND
DB_LOW_SharGrotto_ViconiaHostile(1, _, _, _, _)
AND
GetClosestAlivePlayer(S_LOW_LossDoor_cf162070-3360-49d1-9f26-0919b6856c02, _Var1, _, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_LOW_DoorOpenBounds_7ed73ca2-8acf-4eec-b237-a894804dad96, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_StartedCombat", _Var1, _Var1, _Var1, _Var1)
THEN
EnterCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1);
EnterCombat(S_LOW_LossDoorGuard_90f9cb08-1019-424e-9b97-84d6a28898f2, _Var1);

IF
DB_GlobalFlag(LOW_SharGrotto_State_LossDoorOpened_7e985e7e-b56b-40cf-a7d2-db08295ae07c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
AND
DB_LOW_SharGrotto_ViconiaHostile(1, _, _, _, _)
AND
DB_InRegion(_Var1, S_LOW_DoorOpenBounds_7ed73ca2-8acf-4eec-b237-a894804dad96, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_StartedCombat", _Var1, _Var1, _Var1, _Var1)
THEN
EnterCombat(S_LOW_Viconia_b1ea974d-96fb-47ca-b6d9-9c85fcb69313, _Var1);
EnterCombat(S_LOW_LossDoorGuard_90f9cb08-1019-424e-9b97-84d6a28898f2, _Var1);

IF
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
AND
DB_LOW_SharGrotto_ViconiaHostile(1, _, _, _, _)
THEN
NOT DB_LOW_SharGrotto_ViconiaHostile(1);

IF
UseFinished((CHARACTER)_Var1, S_LOW_LossDoor_cf162070-3360-49d1-9f26-0919b6856c02, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _Var1, _Var1, _Var1, _Var1)
AND
IsClosed(S_LOW_LossDoor_cf162070-3360-49d1-9f26-0919b6856c02, 1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_LossDoorInteract", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SharGrotto_PAD_LossDoor_925eb985-1b9b-cc8c-c520-8fc7e3be9f71, _Var1);

PROC
PROC_LOW_SharGrotto_LossAltarInit()
AND
DB_LOW_SharGrotto_LossAltar(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetPosition(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
SetCanInteract(_Var1, 0);
DB_LOW_SharGrotto_LossAltarPos(_Var1, _Var2, _Var3, _Var4);

IF
ItemEnteredTrigger((GUIDSTRING)_Var1, S_LOW_AltarTrigger_cb619852-ce0b-449f-b009-a16fb12da49d, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_LOW_SharGrotto_LossAltar(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsStoryItem(_Var1, 0, _Var1, _Var1, _Var1)
AND
ItemGetGoldValue(_Var1, _Var3, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SharGrotto_AltarItems(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SharGrotto_CheckValue(_Var1, _Var3);

PROC
PROC_LOW_SharGrotto_CheckValue((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_IncreaseCounter("LOW_SharGrotto_AltarCount", _Var2);
PROC_LoopEffect(VFX_Status_Dipped_Fire_Overlay_01_3adb1e74-983e-40cb-935d-8ad1abc3db92, _Var1, "LOW_SharGrotto_ItemSacrifice", "CTY_Main_A", "");
DB_LOW_SharGrotto_AltarItems(_Var1);

IF
ItemLeftTrigger((ITEM)_Var1, S_LOW_AltarTrigger_cb619852-ce0b-449f-b009-a16fb12da49d, _, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_LOW_SharGrotto_AltarItems(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
ItemGetGoldValue(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_DecreaseCounter("LOW_SharGrotto_AltarCount", _Var3);
PROC_StopLoopEffect(_Var1, "LOW_SharGrotto_ItemSacrifice");
NOT DB_LOW_SharGrotto_AltarItems(_Var1);

PROC
PROC_CounterIncreased("LOW_SharGrotto_AltarCount", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_LOW_SharGrotto_PrepareAltarMove(_Var1);

PROC
PROC_CounterDecreased("LOW_SharGrotto_AltarCount", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_LOW_SharGrotto_PrepareAltarMove(_Var1);

PROC
PROC_CounterDecreased("LOW_SharGrotto_AltarCount", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_OnlyOnce("LOW_SharGrotto_RaisedFirstTime", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var2, S_LOW_AltarTrigger_cb619852-ce0b-449f-b009-a16fb12da49d, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_RaisedFirstTime", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SharGrotto_BlockAltarLootVB(1, _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_AltarLoot_4083ef00-8f95-71e1-f1f1-a5c01b6f535c, _Var2);

PROC
PROC_LOW_SharGrotto_PrepareAltarMove((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 < 1000
THEN
PROC_LOW_SharGrotto_MoveAltar(_Var1);

PROC
PROC_LOW_SharGrotto_PrepareAltarMove((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 >= 1000
THEN
PROC_LOW_SharGrotto_MoveAltar(1000);

PROC
PROC_LOW_SharGrotto_MoveAltar((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
IntegerToReal(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
RealDivide(_Var2, 1000, _Var3, _Var1, _Var1)
AND
RealProduct(0.3, _Var3, _Var4, _Var1, _Var1)
AND
DB_LOW_SharGrotto_LossAltarPos(_Var5, _Var6, _Var7, _Var8, _Var1)
AND
RealSubtract(_Var7, _Var4, _Var9, _Var1, _Var1)
THEN
ItemMoveToPosition(_Var5, _Var6, _Var9, _Var8, 1, 1, "LOW_SharGrotto_MoveAltar", 0);
PROC_LOW_SharGrotto_MoveTrigger(_Var4);

PROC
PROC_LOW_SharGrotto_MoveTrigger((REAL)_Var1, (REAL)_Var1, (REAL)_Var1, (REAL)_Var1, (REAL)_Var1)
AND
GetPosition(S_LOW_AltarTriggerOrigin_065e39e5-5a44-46b7-b223-d8383bc5487e, _Var2, _Var3, _Var4, _Var1)
AND
RealSubtract(_Var3, _Var1, _Var5, _Var1, _Var1)
THEN
TeleportToPosition(S_LOW_AltarTrigger_cb619852-ce0b-449f-b009-a16fb12da49d, _Var2, _Var5, _Var4, "", 0, 0, 0, 0, 0);

PROC
PROC_CounterIncreased("LOW_SharGrotto_AltarCount", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(LOW_SharGrotto_State_LossDoorOpened_7e985e7e-b56b-40cf-a7d2-db08295ae07c, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 >= 1000
AND
HasActiveStatus(S_LOW_LossPyre_43f40930-2239-4c6d-bb19-1809dcf03d01, "BURNING", 1, _Var1, _Var1)
THEN
RemoveStatus(S_LOW_LossPyre_43f40930-2239-4c6d-bb19-1809dcf03d01, "BURNING");

IF
StatusRemoved(S_LOW_LossPyre_43f40930-2239-4c6d-bb19-1809dcf03d01, "BURNING", _, _, _)
AND NOT
DB_GlobalFlag(LOW_SharGrotto_State_LossDoorOpened_7e985e7e-b56b-40cf-a7d2-db08295ae07c, _, _, _, _)
AND
DB_GlobalCounter("LOW_SharGrotto_AltarCount", _Var3, _, _, _)
AND
_Var3 >= 1000
THEN
PROC_Low_SharGrotto_OpenDoor();
PROC_Low_SharGrotto_RemoveOfferedItems();

PROC
PROC_Low_SharGrotto_RemoveOfferedItems()
THEN
PlayEffect(S_LOW_AltarTrigger_cb619852-ce0b-449f-b009-a16fb12da49d, VFX_Script_DestroyAction_Thayan_Incense_Burner_A_Purple_01_a14661ee-1fbc-cb6b-395e-b2c9cfee09a3);

PROC
PROC_Low_SharGrotto_RemoveOfferedItems()
AND
DB_LOW_SharGrotto_AltarItems(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SharGrotto_AltarItems(_Var1);
SetOnStage(_Var1, 0);

IF
DB_InRegion(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_LOW_LossDoorBounds_43068efd-75c3-4299-a27f-d3e82c36ee17, _, _, _)
AND
DB_GlobalFlag(LOW_Grotto_State_ViconiaDefeated_8e27eb4e-8d52-4966-8aa4-e658ff595097, _, _, _, _)
AND NOT
DB_Is_InCombat(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
IsTagged(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, SHADOWHEART_SHARPATH_9624a3fe-bb9e-47c5-b9ab-417e6da6f84b, 1, _, _)
THEN
DB_LOW_SharGrotto_BlockAltarLootVB(1);
TriggerUnregisterForCharacter(S_LOW_LossDoorBounds_43068efd-75c3-4299-a27f-d3e82c36ee17, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
PROC_Low_SharGrotto_OpenDoor();

PROC
PROC_Low_SharGrotto_OpenDoor()
AND
QRY_OnlyOnce("LOW_SharGrotto_OpenLossDoor", _, _, _, _)
THEN
PROC_ItemUnlockAndOpen(S_LOW_LossDoor_cf162070-3360-49d1-9f26-0919b6856c02);

IF
Opened(S_LOW_LossDoor_cf162070-3360-49d1-9f26-0919b6856c02, _, _, _, _)
THEN
TriggerUnregisterForItems(S_LOW_AltarTrigger_cb619852-ce0b-449f-b009-a16fb12da49d);
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_LossDoorOpened_7e985e7e-b56b-40cf-a7d2-db08295ae07c);
SetCanInteract(S_LOW_LossDoor_cf162070-3360-49d1-9f26-0919b6856c02, 0);

IF
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var1, _, _, _, _Var1)
AND
DB_LOW_SharGrotto_ParentsResolutions(_, _Var6, _, _Var1, _Var1)
AND NOT
DB_GlobalFlag(_Var6, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ORI_Shadowheart_State_ConcludedGrotto_438098b7-3b50-48d6-ac53-6960b2849e10, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var8, _, _, _, _Var1)
AND NOT
DB_Dead(_Var8, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var8, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 0);

QRY
QRY_LOW_SharGrotto_KilledParents()
AND
DB_LOW_SharGrotto_ParentsResolutions(_, _Var2, _, _, _)
AND
DB_GlobalFlag(_Var2, _, _, _, _)
THEN
DB_NOOP(1);

IF
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var1, _, _, _, _Var1)
AND NOT
QRY_LOW_SharGrotto_KilledParents()
AND
DB_GlobalFlag(ORI_Shadowheart_State_ConcludedGrotto_438098b7-3b50-48d6-ac53-6960b2849e10, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var5, _, _, _, _Var1)
AND NOT
DB_PermaDefeated(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SharGrotto_ParentLeave(_Var5);

PROC
PROC_LOW_SharGrotto_ParentLeave((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "LOW_SharGrotto_ParentCrimeReadyToLeave");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_SharGrotto_ParentCrimeReadyToLeave", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 1, "LOW_SharGrotto_ParentCrimeReadyToLeave");

PROC
PROC_ReadyToMoveOn_Failed((CHARACTER)_Var1, "LOW_SharGrotto_ParentCrimeReadyToLeave", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetOnStage(_Var1, 0);

QRY
QRY_CRIME_BlockRegisterCrime((CHARACTER)_Var1, (STRING)_Var2, _, (CHARACTER)_Var4, (INTEGER)_Var5)
AND NOT
DB_Avatars(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_LOW_SharGrotto_ParentsQuestKill()
AND
DB_LOW_SharGrotto_ExclusiveReacts(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var4, _, _, _, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SharGrotto_ParentAssault(_Var4, _Var1);

QRY
QRY_LOW_SharGrotto_ParentsQuestKill()
AND
DB_LOW_SharGrotto_ParentsResolutions(_, _Var2, _, _, _)
AND
DB_GlobalFlag(_Var2, _, _, _, _)
THEN
DB_NOOP(1);

IF
KilledBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, (CHARACTER)_Var1)
AND NOT
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ParentsResolutions(_, _Var6, _, _Var1, _Var1)
AND NOT
DB_GlobalFlag(_Var6, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var1, _, _, _, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_DefeatedParents_a97d7fe5-340d-4b78-b38a-1949627698bf);
PROC_LOW_SharGrotto_ParentAssault_NoKiller(_Var1);

PROC
PROC_LOW_SharGrotto_ParentAssault_NoKiller((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_SpeakerIsInDialogRange(_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SharGrotto_PAD_DefeatedParentNoAvatar_fd311fcf-1709-d194-5268-0f43bb32614f, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_LOW_SharGrotto_ParentAssault_NoKiller((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_SpeakerIsInDialogRange(_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SharGrotto_PAD_DefeatedParentAway_16a1ae04-c1c2-e7c4-40a2-04322c882b80, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_LOW_SharGrotto_ParentAssault((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_SpeakerIsInDialogRange(_Var2, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
AND
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_DefeatedParents_a97d7fe5-340d-4b78-b38a-1949627698bf);
PROC_TryStartAD(LOW_SharGrotto_PAD_DefeatedParentAway_16a1ae04-c1c2-e7c4-40a2-04322c882b80, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SharGrotto_State_DefeatedParents_a97d7fe5-340d-4b78-b38a-1949627698bf, _, _, _, _)
THEN
PROC_RemoveDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
DB_Dialogs(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, CAMP_Shadowheart_CRD_DefeatedParents_fae58cb0-9bf8-6f91-4b15-f08d23604107);
PROC_GLO_PartyMembers_MakeNPC(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_LOW_SharGrotto_ParentAssault((CHARACTER)_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679
AND NOT
QRY_SpeakerIsInDialogRange(_Var2, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
AND
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_DefeatedParents_a97d7fe5-340d-4b78-b38a-1949627698bf);
PROC_TryStartAD(LOW_SharGrotto_PAD_DefeatedParentNoAvatar_fd311fcf-1709-d194-5268-0f43bb32614f, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_LOW_SharGrotto_ParentAssault((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var2 != S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679
AND
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsInDialogRange(_Var2, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_ProvokedConfrontation", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog_Fixed(LOW_SharGrotto_DefeatedParents_cd8e69ea-d78d-aa3b-6f23-202e67e0cff4, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var2, _Var1, _Var1)
THEN
PROC_Origins_CompanionLeavePermanently(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "CompanionHostile");
PROC_GLO_PartyMembers_TransferStoryItems(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var2);
PROC_SetRelationToPlayers(Origin_ShadowHeart_901cd370-86ff-b538-e1e8-574c84135ca0, 0);
PROC_LOW_SharGrotto_FightPlayerAD();

PROC
PROC_LOW_SharGrotto_ParentAssault((CHARACTER)_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679
AND
QRY_SpeakerIsInDialogRange(_Var2, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
AND
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_ProvokedConfrontation", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog_Fixed(LOW_SharGrotto_DefeatedParents_cd8e69ea-d78d-aa3b-6f23-202e67e0cff4, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var2, _Var1, _Var1)
THEN
PROC_Origins_CompanionLeavePermanently(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "CompanionHostile");
PROC_SetRelationToPlayers(Origin_ShadowHeart_901cd370-86ff-b538-e1e8-574c84135ca0, 0);
PROC_LOW_SharGrotto_FightPlayerAD();

IF
DialogEnded(LOW_SharGrotto_DefeatedParents_cd8e69ea-d78d-aa3b-6f23-202e67e0cff4, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
AND
_Var2 != S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679
THEN
PROC_Origins_CompanionLeavePermanently(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "CompanionHostile");
PROC_SetRelationToPlayers(Origin_ShadowHeart_901cd370-86ff-b538-e1e8-574c84135ca0, 0);
PROC_LOW_SharGrotto_FightPlayerAD();

PROC
PROC_LOW_SharGrotto_FightPlayerAD()
AND
QRY_SpeakerIsAvailable(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
THEN
PROC_TryStartAD(LOW_SharGrotto_PAD_DefeatedParent_869fb81a-d0cf-b8c0-e9fe-928d62a10975, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_LOW_SharGrotto_ParentAssault((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_SpeakerIsInDialogRange(_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_AttackedParents", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_AttackedParent_11404ca2-ba17-1768-1427-65eb4b1348c1, _Var2);

PROC
PROC_LOW_SharGrotto_ParentAssault((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsInDialogRange(_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_AttackedParents", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SharGrotto_PAD_AttackedParentSH_22aa986e-1103-1817-caf5-a7600f03eb03, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SharGrotto_AttachedToWheel", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ApplyStatus(_Var1, "LOW_SHARPRISON", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
UseFinished((CHARACTER)_Var1, (ITEM)_Var2, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var1, _, _, _, _Var1)
AND
GetTemplate(_Var2, DEC_Dungeon_Shar_Wheel_A_18f3c376-05fb-4bf9-ada4-82982375a81f, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "LOW_SHARPRISON", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "LOW_SHARPRISON");

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_ShadowheartMother_d085272a-f1d0-4ff8-a498-80728030f83e, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(ORI_Shadowheart_State_ConcludedGrotto_438098b7-3b50-48d6-ac53-6960b2849e10, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_SelectedDialog(LOW_SharGrotto_ShadowheartFather_c07cb7d4-21d6-8203-86d6-dcc60764e9b0, S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_SharGrotto_ShadowheartFather_c07cb7d4-21d6-8203-86d6-dcc60764e9b0, S_LOW_ShadowheartFather_c12d561f-beae-4ef6-917e-0bec2f829449, _Var1);

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_SpeakerIsAvailable(S_SHA_VoiceOfShar_OverrideSpeaker_9293e853-5c10-45a1-a158-ebcde08c02ee, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, S_SHA_VoiceOfShar_OverrideSpeaker_9293e853-5c10-45a1-a158-ebcde08c02ee);

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_SpeakerIsAvailable(S_SHA_VoiceOfShar_OverrideSpeaker_9293e853-5c10-45a1-a158-ebcde08c02ee, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, S_SHA_VoiceOfShar_OverrideSpeaker_9293e853-5c10-45a1-a158-ebcde08c02ee);

PROC
PROC_GlobalFlagReactionAfterDialog(ORI_Shadowheart_State_RejectShar_KilledParents_e9060caf-66b0-4701-8dfd-5ae1125f5afd, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var1, _, _, _, _Var1)
THEN
PROC_Poof(_Var1, VFX_Cinematic_MistyStep_Disappear_01_61463e09-06f6-bbc5-a667-27983f1d7135);
PROC_GlobalSetFlagAndCache(ORI_Shadowheart_State_ConcludedGrotto_438098b7-3b50-48d6-ac53-6960b2849e10);

IF
FlagSet(ORI_Shadowheart_State_Shar_KilledParents_3a3b0ecf-a1ed-4733-8548-0348befc6bac, _, _, _, _)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var3, _, _, _, _)
THEN
Die(_Var3, 0, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 0, 0, 0);
PROC_GlobalSetFlagAndCache(ORI_Shadowheart_State_ConcludedGrotto_438098b7-3b50-48d6-ac53-6960b2849e10);

IF
DialogEnded(LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_LOW_SharGrotto_ParentsFate();

IF
DialogEnded(LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_LOW_SharGrotto_ParentsFate();

PROC
PROC_LOW_SharGrotto_ParentsFate()
AND
DB_LOW_SharGrotto_ParentsResolutions(_, _, _Var3, _, _)
AND
DB_GlobalFlag(_Var3, _, _, _, _)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var4, _, _Var6, _Var7, _)
AND NOT
DB_PermaDefeated(_Var4, _, _, _, _)
THEN
RemoveStatus(_Var4, "LOW_SHARPRISON");
EndRepose(_Var4);
PROC_GlobalSetFlagAndCache(ORI_Shadowheart_State_ConcludedGrotto_438098b7-3b50-48d6-ac53-6960b2849e10);

IF
ReposeRemoved((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_ParentsResolutions(_, _, _Var5, _Var1, _Var1)
AND
DB_GlobalFlag(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var1, _, _, _, _Var1)
AND
DB_GlobalFlag(ORI_Shadowheart_State_ConcludedGrotto_438098b7-3b50-48d6-ac53-6960b2849e10, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSightTo(_Var1, S_LOW_SharranTrainee_003_GuardLookAt_0e201d44-29e8-4539-8bad-fc5efaaba4e3, "Walk", 0, "LOW_SharGrotto_ParentLeft");

IF
EntityEvent((CHARACTER)_Var1, "LOW_SharGrotto_ParentLeft", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_ShadowheartParents(_Var1, _, _Var3, _Var4, _Var1)
THEN
PROC_Camp_TeleportToCamp(_Var1, _Var3);
SetOnStage(_Var1, 1);
PROC_RemoveDialog(_Var1);
DB_Dialogs(_Var1, _Var4);

IF
FlagSet(ORI_Shadowheart_State_Shar_SavedParents_8a0fad17-1615-4a0d-a045-21661d9a2aa0, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_SharGrotto_CultistsHostile();

IF
FlagSet(ORI_Shadowheart_State_RejectShar_KilledParents_e9060caf-66b0-4701-8dfd-5ae1125f5afd, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_SharGrotto_CultistsHostile();

IF
FlagSet(ORI_Shadowheart_State_RejectShar_SavedParents_486d69d4-a7c2-4cb5-8fcb-8f2cb738ada9, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_SharGrotto_CultistsHostile();

PROC
PROC_LOW_SharGrotto_CultistsHostile()
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SharCultist_Grotto_415731a9-1e23-4873-afe9-a4619a973bfa, 0);
PROC_SetRelationToPlayers(ACT3_LOW_SharCultist_House_a97a8fce-e4ba-43ac-b3e3-60ff9d273d72, 0);
PROC_SetRelationToPlayers(ACT3_LOW_SharCultist_SwayedCultist_6829cbb6-ef01-4423-8b12-130912ce302a, 0);

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_ParentsFate_OM_Shadowheart_AOM_OOM_93197c73-73c0-4482-e023-252cdf461dc1, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog(LOW_SharGrotto_ParentsFate_OM_Shadowheart_COM_aa3b3a6b-b584-90f1-6a20-7a3ed4f037c2, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_NOOP(1);

PROC
PROC_SpotPlayers_Spotted(S_LOW_GrottoSentry_90c54fce-9a57-4ff5-9d36-0363ef90c5f1, "LOW_SharGrotto_SentryGreet", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_TryStartAD(LOW_SharGrotto_AD_GrottoSentry_7b9acbe4-c97d-d44d-8bd1-99436112dbff, S_LOW_GrottoSentry_90c54fce-9a57-4ff5-9d36-0363ef90c5f1);
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_GreetedParty_12192fc3-0ad6-4da6-b41f-5a559135dbe2);

PROC
PROC_GLO_KnowledgeCheckSuccess((CHARACTER)_Var1, "LOW_SharGrotto_GithLog", S_LOW_GithInvestigation_649d48cf-809c-47ee-a133-bd0508eefa1a, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_PlayPerceptionRevealEffect(S_LOW_RubbleContainer_30a493be-7dc7-48c7-ac38-5c9fce2b5e13, "LOW_SharGrotto_PileReveal");
SetCanInteract(S_LOW_RubbleContainer_30a493be-7dc7-48c7-ac38-5c9fce2b5e13, 1);
StartVoiceBark(LOW_SharGrotto_VB_FoundDebris_e998bb2f-66f9-576f-2c3e-cc7f6ad3a66d, _Var1);

PROC
PROC_GLO_KnowledgeCheckSuccess((CHARACTER)_Var1, "LOW_SharGrotto_SpotHideOut", S_LOW_SecretHoleSpot_9391dc0e-2b3f-42c4-a708-35478f592a4d, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_PlayPerceptionRevealEffect(S_LOW_CaveObstruction_90f012d6-595c-4a76-a6dc-1d77d2a61dc7, "LOW_SharGrotto_BlockadeReveal", 500);
SetCanInteract(S_LOW_CaveObstruction_90f012d6-595c-4a76-a6dc-1d77d2a61dc7, 1);

IF
CharacterLootedCharacter((CHARACTER)_Var1, S_LOW_TonguelessGith_969a6a9b-ca6a-49bb-9291-04e7afdab39e, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_ReadNote", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_FoundGith_c1c52c6f-7465-06ec-79eb-41b5c199d331, _Var1);

IF
GameBookInterfaceClosed(S_LOW_GithNote_1a15be9f-4764-4bb4-8edc-04ff741babf8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_ReadNote", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_HeistInterrogation_07b9b08b-55c4-c100-a43f-3601396c0571, _Var1);

IF
AddedTo(S_LOW_JusticiarHelm_a76e8999-9a14-41af-868b-03fa9c31a3bb, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_LootedJusticiarHelmet", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_JusticiarHelmet_b118062b-1f30-dd6b-e499-7a10fe105729, _Var1);

IF
AddedTo(S_LOW_WyvernWhiskey_f52f56f5-686d-4341-848b-5916c6913f39, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_LootedWhiskey", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_KnowledgeCheck(_Var1, "LOW_SharGrotto_WhiskeyCheck", S_LOW_WyvernWhiskey_f52f56f5-686d-4341-848b-5916c6913f39, "History", Act3_Easy_5028066b-6ea0-4a6a-9e3e-53bee62559a7, LOW_SharGrotto_PAD_WyvernWhiskey_803ca3cf-5881-360d-f3ff-ea4d5031e58c, LOW_SharGrotto_State_PassedWhiskeyCheck_a7bdbbc6-3c3f-4719-bc09-ef750bff3cee);

IF
GameBookInterfaceClosed(S_LOW_SharGithRecords_d8307160-02da-4db8-bf94-1ad4c8b19ae4, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_ReadHeistInfo", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_HeistPreparation_0337d245-c15a-843f-8d26-6b166204a6f7, _Var1);

IF
GameBookInterfaceClosed(S_LOW_ViconiaHistory_feac28f5-58dc-428b-a764-8d17773e9fd5, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SharGrotto_ReadLetter", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_CalimportLetter_08cedc50-c2d5-9cfd-42d9-bba87a6e6f0e, _Var1);

IF
DB_InRegion(_Var1, S_LOW_SharranGrotto_SUB_852ec92c-713b-48de-80f5-353d95bbd3de, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("TG_LOW_SharGrotto_EnteredGrotto", _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(TG_LOW_SharGrotto_InGrotto_fa6de38a-6cd5-463d-8492-61952782b85f, _Var2);

IF
DB_TopicalGreeting(TG_LOW_SharGrotto_InGrotto_fa6de38a-6cd5-463d-8492-61952782b85f, _, _, _, _)
AND NOT
DB_InRegion(_, S_LOW_SharranGrotto_SUB_852ec92c-713b-48de-80f5-353d95bbd3de, _, _, _)
AND
QRY_OnlyOnce("TG_LOW_SharGrotto_LeftGrotto", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_Event_LeftGrotto_5e8e8690-a1f4-47f5-93a1-2c99a65a35a6);

PROC
PROC_BlockUseOfItem(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_LOW_SharGrotto_Mannequins(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var3, _Var1, 0);
PROC_TrySkillCheck(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, "History", Act3_Hard_6298329e-255c-4826-9209-e911873b64e7, "LOW_SharGrotto_Mannequin");

PROC
PROC_RollResult("LOW_SharGrotto_Mannequin", (CHARACTER)_Var1, (ITEM)_Var2, 1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_Mannequins(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(_Var3, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_RollResult("LOW_SharGrotto_Mannequin", (CHARACTER)_Var1, (ITEM)_Var2, 0, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_Mannequins(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(LOW_SharGrotto_VB_Mannequins_701382d3-f8d3-ff27-200c-0aeaef6f0ab1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);

PROC
PROC_RollResult("LOW_SharGrotto_Mannequin", (CHARACTER)_Var1, (ITEM)_Var2, _, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_Mannequins(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SharGrotto_Mannequins(_Var2, _Var4);

IF
GameBookInterfaceClosed(S_LOW_ShadowheartNote_099b5fa8-f80e-4cbb-a7bc-ca5d6119ac4e, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(LOW_SharGrotto_Knows_Mirror_MirrorNature_dccb63c4-7563-454a-8dd5-21bd302cabca, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_Knows_Mirror_MirrorNature_dccb63c4-7563-454a-8dd5-21bd302cabca);
StartVoiceBark(LOW_SharGrotto_VB_FoundMirrorNote_5e83d356-6f2b-f186-7ae9-4b6b8526a97f, _Var1);

IF
FlagSet(LOW_SharGrotto_Event_Mirror_RollMemory_9ae217ca-c5c2-458b-9f48-93df07e35a06, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
Random(5, _Var3, _Var1, _Var1, _Var1)
AND
QRY_LOW_SharGrotto_CalculateMirrorBonus(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SharGrotto_MirrorBonus(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var3, _Var4, _Var5, _Var1, _Var1)
AND
DB_LOW_SharGrotto_MirrorFlags(_Var6, _Var7, _Var1, _Var1, _Var1)
AND
_Var5 >= _Var6
THEN
ClearFlag(LOW_SharGrotto_Event_Mirror_RollMemory_9ae217ca-c5c2-458b-9f48-93df07e35a06, _Var1);
SetFlag(_Var7, _Var1);

QRY
QRY_LOW_SharGrotto_CalculateMirrorBonus((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_LOW_SharGrotto_MirrorBonus(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_LOW_SharGrotto_MirrorBonus(_Var1, 0);

QRY
QRY_LOW_SharGrotto_CalculateMirrorBonus((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SharGrotto_MirrorBonus(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_SharGrotto_State_Mirror_PrayerSuccess_f98c5c36-e1fa-4c16-b74d-0ccaefd836eb, _Var1, 1, _Var1, _Var1)
AND
IntegerSum(_Var2, 3, _Var3, _Var1, _Var1)
THEN
ClearFlag(LOW_SharGrotto_State_Mirror_PrayerSuccess_f98c5c36-e1fa-4c16-b74d-0ccaefd836eb, _Var1);
DB_LOW_SharGrotto_MirrorBonus(_Var1, _Var3);

QRY
QRY_LOW_SharGrotto_CalculateMirrorBonus((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_NOOP(1);

IF
DialogEnded(LOW_SharGrotto_MemoryMirror_03dcc001-edc1-9d40-3b93-14a162c86112, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_LOW_SharGrotto_MirrorFlags(_, _Var5, _Var1, _Var1, _Var1)
AND
GetFlag(_Var5, _Var2, 1, _Var1, _Var1)
THEN
ClearFlag(_Var5, _Var2);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, (FLAG)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SharGrotto_MirrorMemories(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
AddPassive(_Var1, _Var3);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, (FLAG)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SharGrotto_MirrorPlayerMemories(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, _Var3, -1, 1, S_LOW_BlackMirror_d9907043-c08f-49bb-87d0-bb3eeb723a06);

IF
FlagSet(LOW_SharGrotto_Event_Mirror_RobMemory_b285a99b-8dc2-463c-b7f9-2dd5147d37e5, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SharGrotto_MirrorPlayerMemories(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
GetFlag(_Var3, _Var1, 0, _Var1, _Var1)
AND NOT
DB_LOW_SharGrotto_Mirror_MemoryFabricated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(_Var3, _Var1);
ApplyStatus(_Var1, _Var4, -1, 1, S_LOW_BlackMirror_d9907043-c08f-49bb-87d0-bb3eeb723a06);
DB_LOW_SharGrotto_Mirror_MemoryFabricated(_Var1);

PROC
PROC_LOW_SharGrotto_MemoryCheck()
AND
GetFlag(ORI_State_Partnered_6c1a31e8-1d3d-42a5-af4f-72ef7a798f74, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_Mirror_SHhasRomance_0669a1c6-8f6d-4be7-9bf0-812bd2cb40a6);

IF
FlagSet(ORI_State_Partnered_6c1a31e8-1d3d-42a5-af4f-72ef7a798f74, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, (INTEGER)_, (INTEGER)_)
THEN
PROC_GlobalSetFlagAndCache(LOW_SharGrotto_State_Mirror_SHhasRomance_0669a1c6-8f6d-4be7-9bf0-812bd2cb40a6);

PROC
PROC_LOW_SharGrotto_MemoryCheck()
AND
DB_LOW_SharGrotto_MirrorShadowheartMemories(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SharGrotto_MirrorShadowheartMemories_Active(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SharGrotto_MirrorShadowheartMemories_Active(_Var1, _Var2);

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SharGrotto_MirrorShadowheartMemories(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
DB_LOW_SharGrotto_MirrorShadowheartMemories_Active(_Var1, _Var4);

IF
FlagSet((FLAG)_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_LOW_SharGrotto_MirrorShadowheartMemories_Active(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SharGrotto_MirrorShadowheartMemories_Active(_Var3, _Var1);

IF
DB_GlobalFlag(LOW_SharGrotto_State_Mirror_SHhasMemories_1b5541eb-dc65-4dac-9b6d-c8e4dd3ed0e1, _, _, _, _)
AND NOT
DB_LOW_SharGrotto_MirrorShadowheartMemories_Active(_, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(LOW_SharGrotto_State_Mirror_SHhasMemories_1b5541eb-dc65-4dac-9b6d-c8e4dd3ed0e1);

IF
DB_LOW_SharGrotto_MirrorShadowheartMemories_Active(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_SharGrotto_State_Mirror_SHhasMemories_1b5541eb-dc65-4dac-9b6d-c8e4dd3ed0e1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalClearFlagAndCache(LOW_SharGrotto_State_Mirror_SHhasMemories_1b5541eb-dc65-4dac-9b6d-c8e4dd3ed0e1);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3b"
