Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130);
SetImmortal(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, 1);
DB_BookFlags(S_HAG_HagAmbush_NoteFromSister_c1a242f8-410c-4fca-990b-a3dc2b2cb7db, HAG_HagAmbush_Knows_ReadMayrinaLetter_7fe356fc-19e4-4f2c-a966-83ecc8916470);
DB_HAG_HagAmbush_Confrontation_PlayerSidedNone_ClearFlags(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78);
DB_HAG_HagAmbush_Confrontation_PlayerSidedNone_ClearFlags(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0);
DB_HAG_HagAmbush_Brothers(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);
DB_HAG_HagAmbush_Brothers(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);
PROC_TriggerRegisterForPlayers(S_HAG_HagAmbush_AmbushArea_22f061d6-a87f-419b-8fbb-1d31f8df9f94);
DB_HAG_HagAmbush_BrothersDeathTrigger(HAG_Hag_State_HagInLair_b1559527-2aa5-41e1-bab2-89ace2bf450c, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_Brother_001_DeathLocation_Swamp_ac91dae3-f254-45bd-b262-df9081632696);
DB_HAG_HagAmbush_BrothersDeathTrigger(HAG_Hag_State_HagInLair_b1559527-2aa5-41e1-bab2-89ace2bf450c, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_Brother_002_DeathLocation_Swamp_a54ccd59-68fa-49f9-b69f-f64fb6c63c9b);
DB_HAG_HagAmbush_BrothersDeathTrigger(HAG_Hag_EnteredHome_231cda70-853f-47e4-91b9-31f126b395ba, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_Brother_001_DeathLocation_TeaHouse_bdc64f90-12aa-4317-9c01-e5c6c9c73ae5);
DB_HAG_HagAmbush_BrothersDeathTrigger(HAG_Hag_EnteredHome_231cda70-853f-47e4-91b9-31f126b395ba, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_Brother_002_DeathLocation_TeaHouse_8f35aceb-c494-49c3-88d1-fa8d53a6c63c);
DB_HAG_HagAmbush_BrothersDeathTrigger(NULL_00000000-0000-0000-0000-000000000000, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_Brother_001_DeathLocation_Swamp_ac91dae3-f254-45bd-b262-df9081632696);
DB_HAG_HagAmbush_BrothersDeathTrigger(NULL_00000000-0000-0000-0000-000000000000, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_Brother_002_DeathLocation_Swamp_a54ccd59-68fa-49f9-b69f-f64fb6c63c9b);
DB_HAG_GreaterHagAreaTriggers(S_HAG_HagLair_f84e3319-4a1d-483c-a718-dee3bff70d07);
DB_HAG_GreaterHagAreaTriggers(S_HAG_HagSwamp_Outer_9bdef32b-ddf2-44e8-adfe-75e39639bb75);
DB_HAG_InnerHagAreaTriggers(S_HAG_HagLair_f84e3319-4a1d-483c-a718-dee3bff70d07);
DB_HAG_InnerHagAreaTriggers(S_HAG_HagSwamp_Inner_b006fbfb-e2f1-4e31-af29-f76bf5aac949);
DB_HAG_HagAmbush_Brothers_FallbackAD(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, DIALOGRESOURCEGUID_HAG_HagAmbush_Brother_001_AD_Fallback_829850f5-0733-d0c0-d823-c722c7662521);
DB_HAG_HagAmbush_Brothers_FallbackAD(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, DIALOGRESOURCEGUID_HAG_HagAmbush_Brother_002_AD_Fallback_c848b0c6-a07c-c1cc-c542-e55d10ca4f44);
DB_Inclusion_Object(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, HAG_HagAmbush_Brother1_Inclusion_Start_826e0b56-ce45-a627-df09-ff857793a70c, HAG_HagAmbush_Brother1_Inclusion_End_6f037547-9670-4c6d-9c57-048eb67696a6);
DB_Inclusion_Object(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, HAG_HagAmbush_Brother2_Inclusion_Start_1bb396d0-4428-5691-bd6c-d8800185bcec, HAG_HagAmbush_Brother2_Inclusion_End_4f00125b-504b-478a-9b4a-6d416b1986a9);
DB_SeenDeadNPCGlobalFlag(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, HAG_HagAmbush_Brother_001_Quest_FoundDead_0f120e4b-2f9b-4d19-b5a5-a0bbaaf8f4bd);
DB_SeenDeadNPCGlobalFlag(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, HAG_HagAmbush_Brother_002_Quest_FoundDead_443e8283-1ebd-41a7-8970-1a870d31c46e);
DB_SpotPlayers(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, "HAG_HagAmbush_Confrontation", NULL_00000000-0000-0000-0000-000000000000, HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4);
DB_SpotPlayers(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, "HAG_HagAmbush_Confrontation", NULL_00000000-0000-0000-0000-000000000000, HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4);
DB_SpotPlayers(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_Confrontation", NULL_00000000-0000-0000-0000-000000000000, HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4);
DB_SpotPlayers_CustomRadius(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_Confrontation", 9);
DB_SpotPlayers_CustomRadius(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, "HAG_HagAmbush_Confrontation", 9);
DB_SpotPlayers_CustomRadius(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, "HAG_HagAmbush_Confrontation", 9);
DB_SceneManager(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_Confrontation");
DB_SceneManager(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, "HAG_HagAmbush_Confrontation");
DB_SceneManager(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, "HAG_HagAmbush_Confrontation");
DB_QuestDef_State(HAG_Hag_Knows_HagDead_6bc41bd0-ef96-4358-0493-0ff80438d5c2, "HAG_HagSpawn", "HagDead");
DB_QuestDef_State(HAG_Hag_State_HagTookMother_38dc6752-5ab3-e108-64ed-fe63971d69fd, "HAG_HagSpawn", "MercyMayrinaNotFree");
DB_QuestDef_State(HAG_Hag_State_HagTookMother_38dc6752-5ab3-e108-64ed-fe63971d69fd, "HIDDEN_HAG_Reward", "HagReward");
DB_QuestDef_State(Act2_PointOfNoReturnReached_a3155f30-b8f3-4db5-ac21-d3036f4426e3, "HAG_HagSpawn", "ReachedNoReturn");
DB_GLO_CharacterCorpseDialog(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, HAG_HagAmbush_Brother_001_Dead_28b59a35-b3c7-20e1-b93c-714276a1cd96);
DB_GLO_CharacterCorpseDialog(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, HAG_HagAmbush_Brother_002_Dead_5cfbf8d8-cea2-0483-35af-e91af5750fee);
DB_ReportKiller(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, NULL_00000000-0000-0000-0000-000000000000);
DB_DialogBlockAttackButton(HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130);

KBSECTION
PROC
PROC_SpotPlayers_Spotted(_, "HAG_HagAmbush_Confrontation", (GUIDSTRING)_Var2, _, _)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, _, _, _, _)
AND
QRY_OnlyOnce("HAG_HagAmbush_Confrontation_Spotted", _, _, _, _)
AND
QRY_StartDialogCustomWithAvailableSpeakerInRange(HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _Var2, 5, 0, 1, 1, 0)
THEN
PROC_SceneOver("HAG_HagAmbush_Confrontation");
DB_SceneManager(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_Confrontation2");

IF
DialogStarted(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_Activated_85f67c35-6bbf-8983-f670-6a0260edbe3e, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedNone_85a61d34-b0a6-c310-7042-8ebc3d478223, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_SceneOver("HAG_HagAmbush_Confrontation");
DB_SceneManager(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_Confrontation2");

IF
FlagSet(HAG_Hag_EnteredHome_231cda70-853f-47e4-91b9-31f126b395ba, _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_Activated_85f67c35-6bbf-8983-f670-6a0260edbe3e, _, _, _, _)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(DEN_HagDouble_HasMet_3bbd361a-0fe5-fd0e-88ed-18b8cfc8e00c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_HAG_HagAmbush_HagTraderMet(1);

IF
EnteredTrigger((CHARACTER)_Var1, S_HAG_HagAmbush_AmbushArea_22f061d6-a87f-419b-8fbb-1d31f8df9f94, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_Activated_85f67c35-6bbf-8983-f670-6a0260edbe3e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "Start", 0, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "Start_KnowEthel", 0, _Var1)
AND
DB_HAG_HagAmbush_HagTraderMet(1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "Start_KnowEthel");

IF
EnteredTrigger((CHARACTER)_Var1, S_HAG_HagAmbush_AmbushArea_22f061d6-a87f-419b-8fbb-1d31f8df9f94, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_Activated_85f67c35-6bbf-8983-f670-6a0260edbe3e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "Start", 0, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "Start_KnowEthel", 0, _Var1)
AND NOT
DB_HAG_HagAmbush_HagTraderMet(1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "Start");

IF
DB_GlobalFlag(HAG_HagAmbush_Brother_001_Quest_FoundDead_0f120e4b-2f9b-4d19-b5a5-a0bbaaf8f4bd, _, _, _, _)
AND
DB_GlobalFlag(HAG_HagAmbush_Brother_002_Quest_FoundDead_443e8283-1ebd-41a7-8970-1a870d31c46e, _, _, _, _)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "SpokeToBrothers", 1, _Var1)
AND
QuestIsAccepted(_Var1, "HAG_HagSpawn", 1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "BrothersDied");

IF
DB_GlobalFlag(HAG_HagAmbush_Brother_001_Quest_FoundDead_0f120e4b-2f9b-4d19-b5a5-a0bbaaf8f4bd, _, _, _, _)
AND
DB_GlobalFlag(HAG_HagAmbush_Brother_002_Quest_FoundDead_443e8283-1ebd-41a7-8970-1a870d31c46e, _, _, _, _)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "RefusedHelpBrothers1", 1, _Var1)
AND
QuestIsAccepted(_Var1, "HAG_HagSpawn", 1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "BrothersDied");

IF
DB_Sees(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers_DiedAfterLongRest(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
CanSee(_Var1, _Var2, 1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "HAG_HagAmush_VB_FoundBrothersAfterLongRest", _Var1, _Var1, _Var1)
THEN
StartVoiceBark(HAG_HagAmush_VB_FoundBrothersAfterLongRest_552b52d4-9305-b603-ef6f-37c4b90847fd, _Var1);

IF
DB_GlobalFlag(HAG_HagAmbush_Brother_002_Quest_FoundDead_443e8283-1ebd-41a7-8970-1a870d31c46e, _, _, _, _)
THEN
NOT DB_SeenDeadNPCGlobalFlag(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, HAG_HagAmbush_Brother_002_Quest_FoundDead_443e8283-1ebd-41a7-8970-1a870d31c46e);

IF
DB_GlobalFlag(HAG_HagAmbush_Brother_001_Quest_FoundDead_0f120e4b-2f9b-4d19-b5a5-a0bbaaf8f4bd, _, _, _, _)
THEN
NOT DB_SeenDeadNPCGlobalFlag(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, HAG_HagAmbush_Brother_001_Quest_FoundDead_0f120e4b-2f9b-4d19-b5a5-a0bbaaf8f4bd);

IF
FlagSet(HAG_Hagspawn_Knows_SurrogateMotherHusbandDead_7ae89d99-c5b4-475c-86d4-88ad80265270, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "DealInterrupted", 1, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "KilledHusband");

IF
FlagSet(HAG_Hagspawn_Knows_SurrogateMotherDead_8f4738c9-7877-86e4-316a-2447a949e136, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "KilledMayrina", 0, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "MayrinaDead");

IF
StatusApplied(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "KNOCKED_OUT", (CHARACTER)_Var1, _, (CHARACTER)_Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "MayrinaKnockedOut");

IF
FlagSet(HAG_Hagspawn_Event_HasSummoningWand_ff5a4aae-85e1-4982-9f52-2947fd75e6e3, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "SavedMayrina", 1, _Var1)
AND
QuestIsClosed("HAG_HagSpawn", 0, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "FoundWand");

IF
QuestUpdateUnlocked((CHARACTER)_Var1, "HAG_HagSpawn", "SavedMayrina", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(HAG_Hagspawn_Event_HasSummoningWand_ff5a4aae-85e1-4982-9f52-2947fd75e6e3, _Var1, 1, _Var1, _Var1)
AND
QuestIsClosed("HAG_HagSpawn", 0, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "HAG_HagSpawn", "FoundWand");

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HAG_HagAmbush_Confrontation_PlayerSidedNone_ClearFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedNone_85a61d34-b0a6-c310-7042-8ebc3d478223, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedNone_85a61d34-b0a6-c310-7042-8ebc3d478223, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "LeaveViaPoof");
SetFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT1_HAG_Brothers_21a1003e-c806-e4ae-7f0e-b1e6422d39dc, 0);

IF
DialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT1_HAG_Brothers_21a1003e-c806-e4ae-7f0e-b1e6422d39dc, 100);
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "LeaveViaPoof");
PROC_SetRelationToPlayers(ACT1_HAG_Ettercaps_2bb298f0-d9e4-4858-46ed-e6b018866d11, 0);
PROC_HAG_HagAmbush_BrothersState_WaitingForOrders();

IF
FlagSet(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_Activated_85f67c35-6bbf-8983-f670-6a0260edbe3e, _, _, _, _)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_HAG_HagAmbush_HagDisappear(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "LeaveViaPoof");

IF
DialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_RemoveDialog(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);

PROC
PROC_StateSet_Defeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var2, _Var1, 1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedNone_85a61d34-b0a6-c310-7042-8ebc3d478223, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedNone_85a61d34-b0a6-c310-7042-8ebc3d478223, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_Activated_85f67c35-6bbf-8983-f670-6a0260edbe3e, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedNone_85a61d34-b0a6-c310-7042-8ebc3d478223, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_Activated_85f67c35-6bbf-8983-f670-6a0260edbe3e, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "DoAD");

IF
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogNPCs(_Var2, _Var1, _, _Var1, _Var1)
AND
DB_AutomatedDialog(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);

IF
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogNPCs(_, _Var1, _, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PlayEffect(_Var1, VFX_Script_HAG_HagAmbush_Confrontation_BrothersDeath_01_4bc5550a-8878-b525-99cf-f4485acc32db, "", 1);
Die(_Var1, 0, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0, 0);

IF
FlagSet(HAG_HagAmbush_Confrontation_Event_KillingBrother_21ece550-a0fa-406b-8128-d9a678d60c1a, (GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DialogRemoveActorFromDialog(_Var2, _Var1, _, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_HAG_HagAmbush_BrothersState_WaitingForOrders()
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);
SetHasDialog(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, 1);
SetHasDialog(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, 1);

IF
FlagSet(HAG_Hag_Brother_001_State_IsDead_a1e1e9cc-4a79-fe57-2df9-0e0e7399350c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);
SetHasDialog(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, 1);
PROC_HAG_Brother_CleanUp(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);

IF
FlagSet(HAG_Hag_Brother_002_State_IsDead_0aece58b-c166-1182-7d76-f6dbb44bac0a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);
SetHasDialog(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, 1);
PROC_HAG_Brother_CleanUp(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);

PROC
PROC_HAG_Brother_CleanUp((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAG_GreaterHagAreaTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(_Var2, _Var1);

PROC
PROC_HAG_Brother_CleanUp((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAG_InnerHagAreaTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(_Var2, _Var1);

PROC
PROC_HAG_Brother_CleanUp((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
TriggerUnregisterForCharacter(S_HAG_HagHouse_fae45ba1-2da5-4ab7-b24b-8bf7539a3c64, _Var1);
TriggerUnregisterForCharacter(TRIGGERGUID_S_HAG_HagAmbush_BrothersUnjoinTrigger_9eca89e1-8508-4a5d-a890-ca72c6fcbc4b, _Var1);

IF
CombatStarted((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var2, _Var3, 1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT1_HAG_Brothers_21a1003e-c806-e4ae-7f0e-b1e6422d39dc, 0);

IF
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _, _, _, _)
THEN
DB_SpotPlayers(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, "HAG_HagAmbush_Brothers_RecruitDialog", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, "HAG_HagAmbush_Brothers_RecruitDialog", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted((GUIDSTRING)_Var1, "HAG_HagAmbush_Brothers_RecruitDialog", (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_SelectAndStartDialog(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_DialogFlagSetup(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, _, _, _, (GUIDSTRING)_)
THEN
PROC_SpotPlayers_StopSpotting(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, "HAG_HagAmbush_Brothers_RecruitDialog");
PROC_SpotPlayers_StopSpotting(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, "HAG_HagAmbush_Brothers_RecruitDialog");

QRY
QRY_SelectCustomDialog((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_HAG_HagAmbush_SelectDialogForBrother(_Var1, _Var2);

PROC
PROC_HAG_HagAmbush_SelectDialogForBrother((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DialogName(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, _, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers_FallbackAD(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(_Var4, _Var1);

PROC
PROC_HAG_HagAmbush_SelectDialogForBrother(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_DialogName(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, _, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _Var1, _Var1)
THEN
PROC_TryStartAD(DIALOGRESOURCEGUID_HAG_HagAmbush_Brother_001_AD_Fallback_829850f5-0733-d0c0-d823-c722c7662521, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);

PROC
PROC_HAG_HagAmbush_SelectDialogForBrother(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_DialogName(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, _, _Var1, _Var1, _Var1)
AND NOT
QRY_SpeakerIsAvailableAndInDialogRange(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(DIALOGRESOURCEGUID_HAG_HagAmbush_Brother_001_AD_Fallback_829850f5-0733-d0c0-d823-c722c7662521, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);

PROC
PROC_HAG_HagAmbush_SelectDialogForBrother(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_DialogName(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, _, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _Var1, _Var1)
THEN
PROC_TryStartAD(DIALOGRESOURCEGUID_HAG_HagAmbush_Brother_002_AD_Fallback_c848b0c6-a07c-c1cc-c542-e55d10ca4f44, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);

PROC
PROC_HAG_HagAmbush_SelectDialogForBrother(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_DialogName(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, _, _Var1, _Var1, _Var1)
AND NOT
QRY_SpeakerIsAvailableAndInDialogRange(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(DIALOGRESOURCEGUID_HAG_HagAmbush_Brother_002_AD_Fallback_c848b0c6-a07c-c1cc-c542-e55d10ca4f44, S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "HAG_HagAmbush_Confrontation", (STRING)_Var3, _)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _, _, _, _)
THEN
PROC_HAG_HagAmbush_HagDisappear(_Var2, "DoAD");

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "HAG_HagAmbush_Confrontation2", (STRING)_Var3, _)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _, _, _, _)
THEN
PROC_HAG_HagAmbush_HagDisappear(_Var2, "LeaveViaPoof");

PROC
PROC_HAG_HagAmbush_HagDisappear(_, _, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
PROC_SceneOver("HAG_HagAmbush_Confrontation");

PROC
PROC_HAG_HagAmbush_HagDisappear(_, _, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
RemoveHarmfulStatuses(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);
SetDetached(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, 1);
PROC_SetInvulnerable(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, 1);
PROC_RemoveDialog(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);
PROC_RemoveDialog(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);
PROC_RemoveDialog(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);

PROC
PROC_HAG_HagAmbush_HagDisappear((CHARACTER)_Var1, "DoAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_ForceStopDialog(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);

PROC
PROC_HAG_HagAmbush_HagDisappear((CHARACTER)_Var1, "DoAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogNPCs(_Var3, _Var2, _, _Var1, _Var1)
AND
DB_AutomatedDialog(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var2);

PROC
PROC_HAG_HagAmbush_HagDisappear(_, _, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
PROC_SceneOver("HAG_HagAmbush_Confrontation2");

PROC
PROC_HAG_HagAmbush_HagDisappear((CHARACTER)_Var1, "DoAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_StartDialog(DIALOGRESOURCEGUID_HAG_HagAmbush_AD_HagDisappear_62660820-8a16-d3cd-cee2-1625a5fda55a, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, _Var1, _Var1, _Var1)
THEN
TimerLaunch("HAG_HagAmbush_HagDisappear_SpawnEttercaps", 1200);
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "LeaveViaPoof");

IF
AutomatedDialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_AD_HagDisappear_62660820-8a16-d3cd-cee2-1625a5fda55a, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
TimerLaunch("HAG_HagAmbush_HagDisappear_SpawnEttercaps", 1200);
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "LeaveViaPoof");

IF
TimerFinished("HAG_HagAmbush_HagDisappear_SpawnEttercaps", _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _, _, _, _)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_KillBrothers_c69703b1-eb8f-a8c8-8f77-3ef90d267726, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
AutomatedDialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_AD_HagDisappear_62660820-8a16-d3cd-cee2-1625a5fda55a, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "LeaveViaPoof");

PROC
PROC_HAG_HagAmbush_HagDisappear((CHARACTER)_Var1, "LeaveViaPoof", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("HAG_HagAmbush_HagDisappear", _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_RemoveDouble");

IF
EntityEvent((GUIDSTRING)_Var1, "HAG_HagAmbush_PoofEvent", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_Poof(_Var1);

IF
DB_Defeated(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND
DB_Defeated(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND NOT
DB_OnlyOnce("HAG_HagAmbush_HagDisappear", _, _, _, _)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _, _, _, _)
THEN
DB_SpotPlayers(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer", NULL_00000000-0000-0000-0000-000000000000, HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4);
DB_SpotPlayers_CustomRadius(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer", 10);
DB_SpotPlayers_TargetIgnoreCantTalk(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");
DB_SpotPlayers_IncludeWildshapedPlayers(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");
DB_SpotPlayers_IncludeFollowers(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");
DB_SpotPlayers_IncludeSummons(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");

PROC
PROC_SpotPlayers_Spotted(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("HAG_HagAmbush_HagDisappear", _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustomWithAvailableSpeakerInRange(HAG_HagAmbush_ThankPlayer_2801dab9-3fbf-906a-e62b-add4654a5368, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, _Var1, 10, 0, 1, 1, 0, _Var1, _Var1)
THEN
DB_HAG_HagAmbush_HagThanksDialogStartedOnce(1);

PROC
PROC_SpotPlayers_Spotted(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("HAG_HagAmbush_HagDisappear", _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HAG_HagAmbush_HagThanksDialogStartedOnce(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("HAG_HagAmbush_AD_HagThankPlayer", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(HAG_HagAmbush_AD_HagThankPlayer_28f6ec9f-9e2f-2aa8-a74c-ee2aa7c55134, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);
NOT DB_SpotPlayers_TargetIgnoreCantTalk(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");
NOT DB_SpotPlayers_IncludeFollowers(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");
NOT DB_SpotPlayers_IncludeWildshapedPlayers(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");
NOT DB_SpotPlayers_IncludeSummons(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");
PROC_SpotPlayers_RestartSpotting(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");

IF
DialogRequestFailed(DIALOGRESOURCEGUID_HAG_HagAmbush_ThankPlayer_2801dab9-3fbf-906a-e62b-add4654a5368, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_HagThanksDialogStartedOnce(1, _, _, _, _)
THEN
PROC_SpotPlayers_RestartSpotting(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, "HAG_HagAmbush_HagThankPlayer");

IF
DialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_ThankPlayer_2801dab9-3fbf-906a-e62b-add4654a5368, _, _, _, _)
AND NOT
DB_DialogRequestFailed(DIALOGRESOURCEGUID_HAG_HagAmbush_ThankPlayer_2801dab9-3fbf-906a-e62b-add4654a5368, _, _, _, _)
THEN
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "LeaveViaPoof");

IF
DialogEnded(DIALOGRESOURCEGUID_HAG_HagAmbush_ThankPlayer_2801dab9-3fbf-906a-e62b-add4654a5368, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
StartVoiceBark(HAG_HagAmbush_VB_SidedHag_40b8e336-9ee5-3ceb-7a1e-6d8facd6e4a4, _Var2);

IF
DB_Defeated(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND
DB_Defeated(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND NOT
DB_OnlyOnce("HAG_HagAmbush_HagDisappear", _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _, _, _, _)
AND NOT
DB_InteractiveDialogSpeaker(_, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, _, _, _)
THEN
PROC_HAG_HagAmbush_HagDisappear(NULL_00000000-0000-0000-0000-000000000000, "LeaveViaPoof");

IF
FlagSet(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogEnded(HAG_HagAmbush_Brothers_Recruitment_b2c0af20-18e7-956e-67f4-ce674d7c89f6, _, _, _, _)
AND
DB_HAG_HagAmbush_Brothers(_Var2, _, _, _, _)
THEN
SetHasDialog(_Var2, 0);
DB_HagAmbush_Brothers_ReadyToLeave(1);

IF
DB_HagAmbush_Brothers_ReadyToLeave(1, _, _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
THEN
PROC_DisappearOutOfSightTo(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, S_HAG_HagAmbush_LeaveTrigger_07aecf6f-e842-466f-92ab-90f179384e7c, "Run", 0, "HAG_HagAmbush_BrotherDisappearedAfterRefuse");

IF
DB_HagAmbush_Brothers_ReadyToLeave(1, _, _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
THEN
Follow(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e);

IF
DB_HagAmbush_Brothers_ReadyToLeave(1, _, _, _, _)
AND
DB_CantMove(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
THEN
PROC_DisappearOutOfSightTo(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagAmbush_LeaveTrigger_07aecf6f-e842-466f-92ab-90f179384e7c, "Run", 0, "HAG_HagAmbush_BrotherDisappearedAfterRefuse");

IF
DB_HagAmbush_Brothers_ReadyToLeave(1, _, _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
THEN
PROC_DisappearOutOfSightTo(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagAmbush_LeaveTrigger_07aecf6f-e842-466f-92ab-90f179384e7c, "Run", 0, "HAG_HagAmbush_BrotherDisappearedAfterRefuse");

IF
EntityEvent(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, "HAG_HagAmbush_BrotherDisappearedAfterRefuse", _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND
GetDistanceTo(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _Var1, _Var1, _Var1)
AND
_Var1 <= 5
THEN
StopFollow(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);
SetOnStage(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, 0);
SetEntityEvent(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, "HAG_HagAmbush_BrotherDisappearedAfterRefuse");

IF
EntityEvent(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, "HAG_HagAmbush_BrotherDisappearedAfterRefuse", _, _, _)
AND NOT
DB_CantMove(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND NOT
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND
GetDistanceTo(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _Var1, _Var1, _Var1)
AND
_Var1 > 5
THEN
StopFollow(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b);
PROC_DisappearOutOfSightTo(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, S_HAG_HagHouse_fae45ba1-2da5-4ab7-b24b-8bf7539a3c64, "Run", 0, "HAG_HagAmbush_BrotherDisappearedAfterRefuse");

IF
EntityEvent((GUIDSTRING)_Var1, "HAG_HagAmbush_BrotherDisappearedAfterRefuse", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(_Var1);

IF
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND
DB_HAG_HagAmbush_BrotherDisappearedAfterRefuse(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
THEN
PROC_Hag_BrothersDieAfterLongRest();

QRY
QRY_HAG_HagAmbush_NotBothBrothersGone()
AND NOT
DB_Defeated(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND
IsOnStage(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, 1, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_HAG_HagAmbush_NotBothBrothersGone()
AND NOT
DB_Defeated(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
AND
IsOnStage(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, 1, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_Hag_State_IsDead_781391e2-7d33-642d-28c0-e9b06cde32bb, _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagGivenMercy_a3c0a36a-ccce-4f35-7b54-9ab22d6ac534, _, _, _, _)
AND
QRY_HAG_HagAmbush_NotBothBrothersGone()
THEN
PROC_Hag_BrothersDieAfterLongRest();

PROC
PROC_LongRest()
AND
DB_GlobalFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_Hag_State_IsDead_781391e2-7d33-642d-28c0-e9b06cde32bb, _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagGivenMercy_a3c0a36a-ccce-4f35-7b54-9ab22d6ac534, _, _, _, _)
AND
QRY_HAG_HagAmbush_NotBothBrothersGone()
THEN
PROC_Hag_BrothersDieAfterLongRest();

QRY
QRY_HAG_HagAmbush_RefusedHelpBrothers()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "RefusedHelpBrothers1", 1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_HAG_HagAmbush_RefusedHelpBrothers()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "HAG_HagSpawn", "RefusedHelpBrothers2", 1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_Hag_BrothersDieAfterLongRest()
AND
QRY_HAG_HagAmbush_RefusedHelpBrothers()
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);

PROC
PROC_Hag_BrothersDieAfterLongRest()
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var1, 1, _Var1, _Var1, _Var1)
AND
QRY_HAG_HagAmbush_GetBrothersDeathTrigger(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_HagAmbush_GetBrothersDeathTrigger(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HAG_HagAmbush_Brothers_DiedAfterLongRest(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var1, _Var2, "HAG_HagAmbush_Brothers_TeleportToDeathSpot");
PlayEffect(_Var1, VFX_Script_HAG_HagAmbush_Confrontation_BrothersDeath_01_4bc5550a-8878-b525-99cf-f4485acc32db, "", 1);
Die(_Var1, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
EntityEvent((GUIDSTRING)_Var1, "HAG_HagAmbush_Brothers_TeleportToDeathSpot", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_HAG_HagAmbush_Brothers_DiedAfterLongRest(_Var1);

QRY
QRY_HAG_HagAmbush_GetBrothersDeathTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_QRYRTN_HagAmbush_GetBrothersDeathTrigger(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_QRYRTN_HagAmbush_GetBrothersDeathTrigger(_Var2);

QRY
QRY_HAG_HagAmbush_GetBrothersDeathTrigger((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAG_HagAmbush_BrothersDeathTrigger(_Var2, _Var1, _Var3, _Var1, _Var1)
AND NOT
DB_QRYRTN_HagAmbush_GetBrothersDeathTrigger(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_HagAmbush_GetBrothersDeathTrigger(_Var3);

QRY
QRY_HAG_HagAmbush_GetBrothersDeathTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_QRYRTN_HagAmbush_GetBrothersDeathTrigger(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_BrothersDeathTrigger(NULL_00000000-0000-0000-0000-000000000000, _Var1, _Var3, _Var1, _Var1)
THEN
DB_QRYRTN_HagAmbush_GetBrothersDeathTrigger(_Var3);

IF
DB_HAG_HagAmbush_Brothers_DiedAfterLongRest(S_HAG_HagAmbush_Brother_001_767e2e80-b340-4e0f-9a6c-fd7df92d6e9e, _, _, _, _)
AND
DB_HAG_HagAmbush_Brothers_DiedAfterLongRest(S_HAG_HagAmbush_Brother_002_24c7e849-2ad6-414e-bc38-6ea3f358a80b, _, _, _, _)
THEN
SetFlag(HAG_HagAmbush_State_BothBrothersDiedAfterLongRest_b018c5bf-2810-449e-914a-a92808d20813, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Sees(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_State_FoundDeadBrother_b716ecca-3bdd-4192-9b62-b6a93890aada, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_State_FoundDeadBrother_b716ecca-3bdd-4192-9b62-b6a93890aada, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
KilledBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_State_FoundDeadBrother_b716ecca-3bdd-4192-9b62-b6a93890aada, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Sees(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_KnockedOut(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_State_FoundUnconsciousBrother_dbb6c79d-f56b-47c8-86fb-cddcb6df3016, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_KnockedOut(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_State_FoundUnconsciousBrother_dbb6c79d-f56b-47c8-86fb-cddcb6df3016, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
StatusApplied((CHARACTER)_Var1, "KNOCKED_OUT", (CHARACTER)_Var2, _, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAG_HagAmbush_Brothers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(HAG_HagAmbush_State_FoundUnconsciousBrother_dbb6c79d-f56b-47c8-86fb-cddcb6df3016, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
TextEvent("HagAmbush_SidedNone", _, _, _, _)
AND
QRY_StartDialog(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, _, _, _)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedNone_85a61d34-b0a6-c310-7042-8ebc3d478223, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_ForceStopDialog(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);

IF
TextEvent("HagAmbush_SidedHag", _, _, _, _)
AND
QRY_StartDialog(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, _, _, _)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedHag_e2d74cb8-45e7-e7b6-638e-5d3d27060a78, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_ForceStopDialog(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);

IF
TextEvent("HagAmbush_SidedBrothers", _, _, _, _)
AND
QRY_StartDialog(DIALOGRESOURCEGUID_HAG_HagAmbush_Confrontation_c5156f64-68bd-9385-aa19-107d32955130, S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055, _, _, _)
THEN
SetFlag(HAG_HagAmbush_Quest_Confrontation_PlayerSidedBrothers_130b6712-6f14-8e62-df19-1b4f33ed07b0, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_ForceStopDialog(S_HAG_HagAmbush_Hag_fb9cc235-398e-418d-a4a2-5da058fe7055);

IF
TextEvent("HagAmbush_Skip", _, _, _, _)
THEN
SetFlag(HAG_HagAmbush_Event_Confrontation_Cancelled_08699840-957d-48da-8f59-c3c4ae4225a4, NULL_00000000-0000-0000-0000-000000000000, 0);
SetFlag(HAG_HagAmbush_Quest_Confrontation_EventSkipped_a673a247-3884-42ce-b6f5-298340e5a092, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_CurrentLevel("CTY_Main_A", _, _, _, _)
THEN
GoalCompleted;


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
