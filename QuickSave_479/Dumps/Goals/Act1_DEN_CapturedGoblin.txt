Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, DEN_CapturedGoblin_GuardsGrieve_1a4367a3-5c1a-e5cc-58ea-0e0745597d2a);
DB_Dialogs(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, DEN_CapturedGoblin_Caged_d2bf28d1-209b-154d-6fc8-98ceba56231f);
DB_Dialogs(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, DEN_CapturedGoblin_Friend_0d1a1c4f-2b80-1fb5-1a7d-f7073e6ab025);
DB_GLO_CharacterCorpseDialog(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, DEN_CapturedGoblin_Dead_eaf24c8e-4b0e-cfc0-b913-dc35911c04cd);
DB_DialogBlockTradeButton(DEN_CapturedGoblin_GuardsGrieve_1a4367a3-5c1a-e5cc-58ea-0e0745597d2a);
DB_DialogBlockTradeButton(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9);
DB_DoNotFace(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
PROC_TriggerRegisterForParty(S_DEN_GrieflingGoblitterateSphere_fde02590-d754-4efc-ab60-8ac44205f94a);
PROC_TriggerRegisterForPlayers(S_DEN_GriefSphere_451f6ff2-2c58-4a6e-8077-ef1347019919);
PROC_TriggerRegisterForPlayers(S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a);
TriggerRegisterForCharacter(S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
TriggerRegisterForCharacter(S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);
TriggerRegisterForCharacter(S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
TriggerRegisterForCharacter(S_DEN_MidAvengePoint_001_b6a8ac6f-92d6-4641-9b1f-d43736ba656a, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
TriggerRegisterForCharacter(S_DEN_GoblinCageBox_8a92511e-1ff0-4c89-af3a-02600e6087c6, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_PreGateAttack");
DB_State_Priority(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_PreGateAttack", 1000);
DB_State_Priority(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Grieve", 2000);
DB_State_Priority(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Transit", 3000);
DB_State_Priority(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", 4000);
DB_State_Priority(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Resolution", 5000);
DB_State_Priority(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_LeftDEN", 6000);
DB_State_Priority(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Permadefeated", 7000);
DB_DEN_CapturedGoblin_EscapeDenTriggers(S_DEN_GateOpenArea_de98af21-31c2-4560-a3bf-4956d8ca0618);
DB_DEN_CapturedGoblin_EscapeDenTriggers(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211);
DB_DEN_CapturedGoblin_EscapeDenTriggers(S_DEN_Hideout_SUB_8016de65-4be3-4083-960f-4d14a7455d4b);
DB_DEN_CapturedGoblin_EscapeDenTriggers(S_DEN_Tunnel_SUB_6d2ed20e-f315-463a-9783-d02b173cb35a);
DB_DEN_CapturedGoblin_EscapeDenTriggers(S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29);
DB_DEN_CapturedGoblin_EscapeDenTriggers(S_DEN_DruidVault_SUB_f4c22466-5963-4192-b939-f1056f4f806a);
DB_DEN_CapturedGoblin_EscapeDenTriggers(S_DEN_TieflingLeader_SUB_f667e6fe-2b30-4509-9bba-7918bb71a2a7);
DB_DEN_CapturedGoblin_Dialog(DEN_CapturedGoblin_GuardsGrieve_1a4367a3-5c1a-e5cc-58ea-0e0745597d2a);
DB_DEN_CapturedGoblin_Dialog(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9);
DB_DEN_CapturedGoblin_Dialog(DEN_CapturedGoblin_GuardsIdle_30faee78-a303-77eb-f936-6f0b4b4f0a46);
DB_DEN_CapturedGoblin_NPC(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
DB_DEN_CapturedGoblin_NPC(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);
SetCanJoinCombat(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, 0);
PROC_SetCorpseOwner(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
DB_PermaDefeatedEvent(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, DEN_CapturedGoblin_State_GrieflingPermaDefeated_6da41bce-907e-413d-d429-b6509d8914e8);
DB_PermaDefeatedEvent(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, DEN_CapturedGoblin_State_FriendPermaDefeated_b8c7b150-7c57-81d5-d452-a40237a90648);
DB_DEN_CapturedGoblin_ResolvedFlags(DEN_CapturedGoblin_Event_Foiled_99ff0e4d-0ce5-7164-4d81-b00edd7906a8);
DB_DEN_CapturedGoblin_ResolvedFlags(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c);
DB_DEN_CapturedGoblin_ResolvedFlags(DEN_CapturedGoblin_State_PlayerRescuedGoblin_2030e459-3a80-1172-8bbd-1d90395deace);
DB_DEN_CapturedGoblin_GrieflingLeaveFlags(DEN_CapturedGoblin_Event_Foiled_99ff0e4d-0ce5-7164-4d81-b00edd7906a8);
DB_DEN_CapturedGoblin_GrieflingLeaveFlags(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c);
DB_DEN_CapturedGoblin_GrieflingLeaveFlags(DEN_CapturedGoblin_State_FriendPermaDefeated_b8c7b150-7c57-81d5-d452-a40237a90648);
DB_GlobalFlagReactionAfterDialog(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899, DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9);
PROC_CharacterDisableCrime(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "WLD_DEN_PrisonEscape_AD");
DB_DEN_CapturedGoblin_GrieflingScenes("DEN_CapturedGoblin_GrieflingGrieve");
DB_DEN_CapturedGoblin_GrieflingScenes("DEN_CapturedGoblin_GrieflingAvenge");

KBSECTION
IF
DB_Sees(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _Var1, _Var1, _Var1, _Var1)
AND
QuestIsAccepted(_Var1, "DEN_CapturedGoblin", 1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "DEN_CapturedGoblin", "Released");

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_Lockdown", _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND
DB_QuestIsAccepted("DEN_CapturedGoblin", _, _, _, _)
THEN
QuestUpdate("DEN_CapturedGoblin", "NotReleased");

IF
FlagSet(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND
QuestIsAccepted(_Var3, "DEN_CapturedGoblin", 1, _, _)
THEN
QuestUpdate(_Var3, "DEN_CapturedGoblin", "Escaped");

PROC
PROC_GOB_Checkpoint_StartThreewayDialogWithCapturedGoblin((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
QuestUpdate(_Var1, "DEN_CapturedGoblin", "FoundCheckpoint");

IF
DialogStarted(GOB_DrowAndCaptured_ThreeWayDialog_46a73870-54c1-902c-fc27-c967c2093ac5, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
QuestUpdate(_Var2, "DEN_CapturedGoblin", "FoundNearDrow");

IF
DB_Sees(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
AND
DB_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestIsAccepted(_Var1, "DEN_CapturedGoblin", 1, _Var1, _Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_UpdateDead(_Var1);

PROC
PROC_DEN_CapturedGoblin_UpdateDead((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _Var1, _Var1, _Var1, _Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "DEN_CapturedGoblin", "DiedEscape");

PROC
PROC_DEN_CapturedGoblin_UpdateDead((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "DEN_CapturedGoblin", "MetGoblin", 0, _Var1)
THEN
QuestClose("DEN_CapturedGoblin");

PROC
PROC_DEN_CapturedGoblin_UpdateDead((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "DEN_CapturedGoblin", "GoblinDead");

PROC
PROC_LevelUnloading("WLD_Main_A", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QuestIsAccepted(_Var1, "DEN_CapturedGoblin", 1, _Var1, _Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_UpdateLeft(_Var1);

PROC
PROC_DEN_CapturedGoblin_UpdateLeft((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _Var1, _Var1, _Var1, _Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "DEN_CapturedGoblin", "NotReleased");

PROC
PROC_DEN_CapturedGoblin_UpdateLeft((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "DEN_CapturedGoblin", "FoundCheckpoint", 0, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "DEN_CapturedGoblin", "EnteredGoblins", 0, _Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "DEN_CapturedGoblin", "NotFoundCheckpoint");

PROC
PROC_DEN_CapturedGoblin_UpdateLeft((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestIsClosed("DEN_CapturedGoblin", 0, _Var1, _Var1, _Var1)
AND
QuestUpdateIsUnlocked(_Var1, "DEN_CapturedGoblin", "Rewarded", 0, _Var1)
THEN
QuestUpdate(_Var1, "DEN_CapturedGoblin", "NotRewarded");

PROC
PROC_DEN_CapturedGoblin_GoblinReleased()
AND
DB_DEN_CapturedGoblin_EscapeDenTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

IF
LeftTrigger(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CapturedGoblin_EscapeDenTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_DEN_CapturedGoblin_IsInDen()
AND NOT
DB_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3);
PROC_DEN_CapturedGoblin_LeftDen();

QRY
QRY_DEN_CapturedGoblin_IsInDen()
AND
DB_DEN_CapturedGoblin_EscapeDenTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_StateSet_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CapturedGoblin_Follow(_Var1, _, _Var1, _Var1, _Var1)
THEN
ClearFlag(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, _Var1);

PROC
PROC_DEN_CapturedGoblin_LeftDen()
AND
DB_DEN_CapturedGoblin_Follow(_Var1, _, _Var1, _Var1, _Var1)
THEN
ClearFlag(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, _Var1);

PROC
PROC_DEN_CapturedGoblin_LeftDen()
AND
DB_DEN_CapturedGoblin_Follow(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_CapturedGoblin_db2b1587-8297-6a2c-4355-86664ddb3264, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("DEN_CapturedGoblin_LeftDenThank");

PROC
PROC_DEN_CapturedGoblin_LeftDen()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_CapturedGoblin_Follow(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_CapturedGoblin_LeftDenThank", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_CapturedGoblin_db2b1587-8297-6a2c-4355-86664ddb3264, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("DEN_CapturedGoblin_LeftDenThank");

PROC
PROC_DEN_CapturedGoblin_LeftDen()
AND NOT
DB_OnlyOnce("DEN_CapturedGoblin_LeftDenThank", _, _, _, _)
THEN
PROC_TryStartAD(DEN_CapturedGoblin_AD_b1b82bdf-7608-d578-e71d-80e1ae6e0924, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

IF
AutomatedDialogEnded(DEN_CapturedGoblin_AD_b1b82bdf-7608-d578-e71d-80e1ae6e0924, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df);

IF
AutomatedDialogRequestFailed(DEN_CapturedGoblin_AD_b1b82bdf-7608-d578-e71d-80e1ae6e0924, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df);

IF
DialogEnded(DEN_CapturedGoblin_db2b1587-8297-6a2c-4355-86664ddb3264, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df);

IF
AttackedBy(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _, _, _, _, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df);

IF
FlagSet(DEN_CapturedGoblin_Event_GoblinEscaped_cbb09299-e736-437b-d93b-5f18f1a9f9df, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_NotifyWhenReadyToMoveOn(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "DEN_CapturedGoblin_ReadyToEscape");

PROC
PROC_ReadyToMoveOn(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "DEN_CapturedGoblin_ReadyToEscape", _, _, _)
THEN
SetHasDialog(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, 0);
PROC_DisappearOutOfSightTo(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, S_DEN_GoblinFleePoint_f96a501e-210c-4fc0-9d2f-1e6311872e25, "Run", 0, "DEN_CapturedGoblin_GoblinEscaped");
ClearFlag(GLO_State_NoCower_8180293e-4d0d-4e9b-9dfc-b195d4c67ddb, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

IF
FlagSet(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, _, _, _, _)
AND
DB_DEN_CapturedGoblin_Follow(_Var3, _, _, _, _)
THEN
ClearFlag(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, _Var3);

IF
FlagSet(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, (CHARACTER)_Var1, (INTEGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_DEN_CapturedGoblin_Follow(_Var1, _Var2);

IF
FlagCleared(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CapturedGoblin_Follow(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_CapturedGoblin_Follow(_Var1, _Var3);
RemovePartyFollower(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1);

IF
LeftLevel((GUIDSTRING)_Var1, "WLD_Main_A", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, _Var1, 1, _Var1, _Var1)
THEN
ClearFlag(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, _Var1);

QRY
QRY_REALLY_BlockFastTravel(NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CapturedGoblin_Follow(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Range_1e967693-8ef9-13c6-4238-12448dc965fd, _Var1, _Var1, _Var1, _Var1)
AND
QRY_DEN_CapturedGoblin_WaypointDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_REALLY_BlockFastTravel((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var1 != NULL_00000000-0000-0000-0000-000000000000
AND
DB_DEN_CapturedGoblin_Follow(_Var2, _, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Range_1e967693-8ef9-13c6-4238-12448dc965fd, _Var1, _Var1, _Var1, _Var1)
AND
InSamePartyGroup(_Var2, _Var1, 1, _Var1, _Var1)
AND
QRY_DEN_CapturedGoblin_WaypointDialog(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_DEN_CapturedGoblin_WaypointDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_CapturedGoblin_db2b1587-8297-6a2c-4355-86664ddb3264, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_Event_Waypoint_bfdebd10-f49f-42c8-9a37-7df72bf55bc8, NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_DEN_CapturedGoblin_WaypointDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(DEN_CapturedGoblin_Event_Waypoint_bfdebd10-f49f-42c8-9a37-7df72bf55bc8, NULL_00000000-0000-0000-0000-000000000000, 0, _Var1, _Var1)
AND NOT
QRY_SetConditionalGlobalFlag(DEN_CapturedGoblin_Range_1e967693-8ef9-13c6-4238-12448dc965fd, 1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DialogEnded((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_CapturedGoblin_Follow(_Var3, _Var2, _Var1, _Var1, _Var1)
THEN
AddPartyFollower(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var3);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsLocked(S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588, 0, _Var1, _Var1, _Var1)
THEN
Open(S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588);
DB_CustomUseItemResponse(_Var1, S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588, 0);

IF
Opened(S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DestroyedBy(S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588, (CHARACTER)_Var1, _, _, (CHARACTER)_Var1)
THEN
SetFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
LeftTrigger(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, S_DEN_GoblinCageBox_8a92511e-1ff0-4c89-af3a-02600e6087c6, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_DEN_CapturedGoblin_GoblinReleased();

PROC
PROC_DEN_CapturedGoblin_GoblinReleased()
THEN
SetCanJoinCombat(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, 1);
SetFlag(GLO_State_NoCower_8180293e-4d0d-4e9b-9dfc-b195d4c67ddb, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
PROC_SetRelationToPlayers(ACT1_DEN_CapturedGoblin_40d6a49e-806c-4bce-8214-6228cc0ded72, 50);
DB_CRIME_Guards_NoSummonBy(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
DB_Dialogs(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, DEN_CapturedGoblin_db2b1587-8297-6a2c-4355-86664ddb3264);

IF
EntityEvent(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "DEN_CapturedGoblin_Event_LeftCage", _, _, _)
THEN
DB_OnlyOnce("DEN_CapturedGoblin_AfterCage");

IF
DialogStarted(DEN_CapturedGoblin_db2b1587-8297-6a2c-4355-86664ddb3264, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
NOT DB_OnlyOnce("DEN_CapturedGoblin_AfterCage");

IF
DB_OnlyOnce("DEN_CapturedGoblin_AfterCage", _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_IsArrested(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1, _Var1)
AND
DB_OnlyOnce("DEN_CapturedGoblin_AfterCage", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_CapturedGoblin_db2b1587-8297-6a2c-4355-86664ddb3264, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1)
THEN
NOT DB_OnlyOnce("DEN_CapturedGoblin_AfterCage");

PROC
PROC_LevelUnloading("WLD_Main_A", _, _, _, _)
AND NOT
DB_GlobalFlag(GOB_CapturedGoblin_State_Spared_28a0e5c2-ee4a-3b33-a7cc-467adb5bdb88, _, _, _, _)
THEN
PROC_SetOnStage(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, 0);

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Transit", _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
DB_Dialogs(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, DEN_CapturedGoblin_Transit_ef8ecc8d-e11a-9640-c19e-baa9024c235c);

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
DB_Dialogs(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9);

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Resolution", _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
DB_Dialogs(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, DEN_CapturedGoblin_GuardsIdle_30faee78-a303-77eb-f936-6f0b4b4f0a46);

IF
FlagSet(DEN_CapturedGoblin_HasMet_2bfbef89-969b-3334-034d-c7e2ba377ed7, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFlag(DEN_CapturedGoblin_State_UserMet_974ef894-b00c-dcac-ee6d-f7fc43bfad2e, _Var1);

IF
EnteredTrigger(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_InRegion(_Var1, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_State_EnteredFirst_0607e870-f42c-0a9b-80ae-03caaf750259, _Var1);

IF
LeftTrigger((CHARACTER)_Var1, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(DEN_CapturedGoblin_State_EnteredFirst_0607e870-f42c-0a9b-80ae-03caaf750259, _Var1, 1, _Var1, _Var1)
THEN
ClearFlag(DEN_CapturedGoblin_State_EnteredFirst_0607e870-f42c-0a9b-80ae-03caaf750259, _Var1);

PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_CapturedGoblin_Dialog(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var2, _Var3, _, _Var1, _Var1)
THEN
DialogAddActorAtReservedSlot(_Var2, _Var3, 1, 0, 1);

QRY
QRY_SelectCustomDialog(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Resolution", _Var1, _Var1)
AND
DB_DEN_CapturedGoblin_NPC(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_Event_FriendStarted_129cd28e-5481-27dd-43bb-53d0d67fbc64);
SetFlag(DEN_CapturedGoblin_FriendHasMet_79e7f911-c30a-287a-6788-7080fda41346, _Var1);
PROC_CapturedGoblin_SelectGrieflingDialog(_Var1);

QRY
QRY_SelectCustomDialog(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Resolution", _Var1, _Var1)
THEN
PROC_CapturedGoblin_SelectGrieflingDialog(_Var1);

PROC
PROC_CapturedGoblin_SelectGrieflingDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Dialogs(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var2, _Var1, _Var1, _Var1)
AND
DB_DEN_CapturedGoblin_Dialog(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9
THEN
DB_SelectedDialog(_Var2, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, NULL_00000000-0000-0000-0000-000000000000, _Var1);

PROC
PROC_CapturedGoblin_SelectGrieflingDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Dialogs(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var1);

IF
DialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_CapturedGoblin_Dialog(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_FriendStarted_129cd28e-5481-27dd-43bb-53d0d67fbc64, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(DEN_CapturedGoblin_Event_FriendStarted_129cd28e-5481-27dd-43bb-53d0d67fbc64);

IF
FlagSet(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND
GetClosestAlivePlayer(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var3, 20, _, _)
THEN
StartVoiceBark(DEN_CapturedGoblin_VB_Freed_07678a76-7d55-49a9-f4fb-1037b42ca76a, _Var3);

IF
FlagSet(DEN_CapturedGoblin_Knows_Priestess_2ac20f1d-b8a0-4f06-a1e6-50e428a3b487, _, _, _, _)
AND
GetClosestAlivePlayer(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var3, 20, _, _)
THEN
StartVoiceBark(DEN_CapturedGoblin_VB_Healer_486ae68f-03a3-923e-2376-d33621108cf0, _Var3);

IF
FlagSet(DEN_CapturedGoblin_State_PlayerWatchedGoblinExecution_cccd8084-dc8f-88c2-c145-482c34ab094f, _, _, _, _)
AND
GetClosestAlivePlayer(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var3, 20, _, _)
THEN
StartVoiceBark(DEN_CapturedGoblin_VB_Shot_321d9d77-6a0f-18cd-5061-53ffd6664240, _Var3);

PROC
PROC_StartDialog_AddExtraSpeakers(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DEN_CapturedGoblin_NPC(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, _Var2);

PROC
PROC_StartDialog_AddExtraSpeakers((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_CapturedGoblin_Dialog(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CapturedGoblin_NPC(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var3, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var2, _Var3);

IF
UseFinished((CHARACTER)_Var1, S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588, 0, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsLocked(S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588, 1, _Var1, _Var1, _Var1)
AND
QRY_SelectAndStartDialog(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_Tamper_270e7bc6-aa68-f106-73af-21184b8f7f68, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_Event_Tamper_270e7bc6-aa68-f106-73af-21184b8f7f68, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(DEN_CapturedGoblin_State_Grieve_93f4f48a-6edd-93a1-2704-b13691df0bb4, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Grieve");

IF
FlagSet(DEN_CapturedGoblin_State_InTransit_94643524-4461-c684-049c-b38cc2f5670a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Transit");

IF
FlagSet(DEN_CapturedGoblin_State_Avenge_0b50db9b-3055-a749-a58b-472d904faa72, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearFlag(DEN_CapturedGoblin_State_InTransit_94643524-4461-c684-049c-b38cc2f5670a);
PROC_State_Progress(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge");

IF
FlagSet(DEN_CapturedGoblin_State_Resolved_df392d3d-95e0-7009-2942-d0418a3e344b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Resolution");

IF
FlagSet(DEN_CapturedGoblin_Event_GuardsLeft_b79734e0-8efc-228f-9a44-50641da7c55a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_LeftDEN");

PROC
PROC_StateSet_PermaDefeated(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _, _, _, _)
THEN
PROC_State_Progress(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Permadefeated");

IF
LeftTrigger((GUIDSTRING)_Var1, S_DEN_General_KanonCorpseScene_aa74c57d-1fa3-4dec-993b-37c6c135c2f4, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Transit", _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_LeftToGrief_7aa6f9bf-c2c1-fb1b-41de-3903c6b861ec, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_Event_LeftToGrief_7aa6f9bf-c2c1-fb1b-41de-3903c6b861ec, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DEN_TryAddGrave(S_DEN_DeadLover_0126a6b5-3452-47db-a3e5-525b7deca82f, _, _, _, _)
AND
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Transit", _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_LeftToGrief_7aa6f9bf-c2c1-fb1b-41de-3903c6b861ec, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_Event_LeftToGrief_7aa6f9bf-c2c1-fb1b-41de-3903c6b861ec, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(DEN_CapturedGoblin_Event_LeftToGrief_7aa6f9bf-c2c1-fb1b-41de-3903c6b861ec, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
TimerLaunch("DEN_CapturedGoblin_LeftToGrief", 18000);

IF
DB_GlobalFlag(DEN_CapturedGoblin_Event_LeftToGrief_7aa6f9bf-c2c1-fb1b-41de-3903c6b861ec, _, _, _, _)
AND NOT
DB_InRegion(_, S_DEN_General_KanonCorpseScene_aa74c57d-1fa3-4dec-993b-37c6c135c2f4, _, _, _)
AND
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _, _)
AND
QRY_DEN_CheckPeaceState()
THEN
SetFlag(DEN_CapturedGoblin_State_InTransit_94643524-4461-c684-049c-b38cc2f5670a, NULL_00000000-0000-0000-0000-000000000000);
TeleportTo(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_GrieflingMidPoint_010cd3ee-dc17-4030-b3ce-339516aba443);
TeleportTo(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, S_DEN_MidFriendPoint_eb3c8062-4763-4f05-8838-aa8701645477);

IF
TimerFinished("DEN_CapturedGoblin_LeftToGrief", _, _, _, _)
AND
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Grieve", _, _)
AND
QRY_DEN_CheckPeaceState()
THEN
SetFlag(DEN_CapturedGoblin_State_InTransit_94643524-4461-c684-049c-b38cc2f5670a, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Transit", _, _)
AND NOT
DB_Defeated(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, _, _, _, _)
THEN
PROC_Follow(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _Var1, _Var1)
THEN
PROC_StopFollow(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);

IF
DB_Defeated(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _, _, _, _)
THEN
PROC_StopFollow(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);

IF
DB_Defeated(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, _, _, _, _)
THEN
PROC_StopFollow(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);

IF
EnteredTrigger(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_MidAvengePoint_001_b6a8ac6f-92d6-4641-9b1f-d43736ba656a, _, _, _)
AND
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _, _)
THEN
DialogRequestStopForDialog(DEN_CapturedGoblin_AD_Guards_cfa86226-091b-06e1-dbeb-61af5caacc53, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
PROC_TryStartAD(DEN_CapturedGoblin_AD_Guards_cfa86226-091b-06e1-dbeb-61af5caacc53, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);

IF
EnteredTrigger(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_Avenge_0b50db9b-3055-a749-a58b-472d904faa72, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_State_Avenge_0b50db9b-3055-a749-a58b-472d904faa72);

IF
DB_InRegion(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_AvengeReady_236cb4d5-3df3-44f9-98ae-f7bac01b667a, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_State_AvengeReady_236cb4d5-3df3-44f9-98ae-f7bac01b667a);

IF
FlagSet(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SetRelationMutual(ACT1_DEN_Griefling_b30628c0-87aa-aa8a-4bc6-84740eb6ef92, ACT1_DEN_CapturedGoblin_40d6a49e-806c-4bce-8214-6228cc0ded72, 0);

IF
FlagSet(DEN_CapturedGoblin_State_AvengeReady_236cb4d5-3df3-44f9-98ae-f7bac01b667a, _, _, _, _)
AND NOT
DB_OnlyOnce("DEN_CapturedGoblin_GuardsDialog_Interrupt", _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _, _, _, _)
THEN
DB_SpotPlayers(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_GrieflingAvengeSpotter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_GrieflingAvengeSpotter", S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a);

PROC
PROC_InternSpotPlayers_Spotted(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_GrieflingAvengeSpotter", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
HasActiveStatus(_Var1, "GB_FUGITIVE_DEN", 0, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_CapturedGoblin_GuardsDialog", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_TryAvenge(_Var1);

PROC
PROC_InternSpotPlayers_Spotted(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_GrieflingAvengeSpotter", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
HasActiveStatus(_Var1, "GB_FUGITIVE_DEN", 1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_PrisonEscapeeReact(_Var1);

PROC
PROC_DEN_CapturedGoblin_PrisonEscapeeReact((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_ForceStopDialog(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
PROC_SetRelationMutual(ACT1_DEN_Griefling_b30628c0-87aa-aa8a-4bc6-84740eb6ef92, ACT1_DEN_CapturedGoblin_40d6a49e-806c-4bce-8214-6228cc0ded72, 0);
SetFlag(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899);
PROC_SetRelationTemporaryHostile(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var1);
PROC_DEN_CapturedGoblin_EndScene("DEN_CapturedGoblin_GrieflingAvenge");

IF
DB_InRegion(_Var1, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _Var1, _Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_AvengeReady_236cb4d5-3df3-44f9-98ae-f7bac01b667a, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "GB_FUGITIVE_DEN", 0, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_TryAvenge(_Var1);

IF
DB_InRegion(_Var1, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _Var1, _Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_AvengeReady_236cb4d5-3df3-44f9-98ae-f7bac01b667a, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "GB_FUGITIVE_DEN", 1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_PrisonEscapeeReact(_Var1);

PROC
PROC_DEN_CapturedGoblin_TryAvenge((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DEN_CapturedGoblin_GuardsDialog(_Var1);

PROC
PROC_DEN_CapturedGoblin_TryAvenge((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GetClosestAvailableCharacterTo(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, 0, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo(_Var2, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_CapturedGoblin_GuardsDialog", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_GuardsDialog(_Var2);

PROC
PROC_DEN_CapturedGoblin_TryAvenge(_, _, _, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND
DB_InRegion(_Var2, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _, _, _)
AND NOT
DB_OnlyOnce("DEN_CapturedGoblin_GuardsDialog", _, _, _, _)
THEN
PROC_DEN_CapturedGoblin_GuardsDialog(_Var2);

PROC
PROC_DEN_CapturedGoblin_TryAvenge((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("DEN_CapturedGoblin_GuardsDialog", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_RestartSpotting(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_GrieflingAvengeSpotter");

PROC
PROC_DEN_CapturedGoblin_GuardsDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var1 != NULL_00000000-0000-0000-0000-000000000000
AND
DB_InRegion(_Var1, S_DEN_GoblinAndGrieflingBox_52ca1804-f4bd-492c-b9f3-a166da51437a, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _Var1, _Var1)
AND NOT
DB_IsArrested(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_DEN_CapturedGoblin_InterruptDialog()
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var1)
THEN
DB_OnlyOnce("DEN_CapturedGoblin_GuardsDialog");

QRY
QRY_DEN_CapturedGoblin_InterruptDialog()
AND
DB_DialogSpeakers(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _Var1, _Var1)
AND
DB_DialogName(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
_Var3 != DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9
AND
DialogIsAutomated(_Var3, 0, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

IF
AttackedBy(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _, _, _, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c, _, _, _, _)
THEN
Die(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, 0, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, 1, 0);

PROC
PROC_GlobalFlagReactionAfterDialog(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899, DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogName(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
THEN
PROC_SetRelationTemporaryHostile(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var2);

PROC
PROC_GlobalFlagReactionAfterDialog(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899, DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, _, _, _)
THEN
PROC_SetRelationMutual(ACT1_DEN_Griefling_b30628c0-87aa-aa8a-4bc6-84740eb6ef92, ACT1_DEN_CapturedGoblin_40d6a49e-806c-4bce-8214-6228cc0ded72, 0);
SetFlag(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899);

IF
DialogActorLeft(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, _, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _, _)
AND
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c);

IF
DB_GlobalFlag(DEN_CapturedGoblin_State_PlayerRescuedGoblin_2030e459-3a80-1172-8bbd-1d90395deace, _, _, _, _)
AND NOT
QRY_DEN_CapturedGoblin_GrieflingIsLeaving()
THEN
SetFlag(DEN_CapturedGoblin_Event_GuardsStayed_288ac3b0-3f5b-5c15-b0fb-def5c4f0b308);

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_CapturedGoblin_ResolvedFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_Resolved_df392d3d-95e0-7009-2942-d0418a3e344b, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_State_Resolved_df392d3d-95e0-7009-2942-d0418a3e344b);

IF
LeftTrigger((GUIDSTRING)_Var1, S_DEN_Cave_SUB_adecafa4-27c6-4b2f-bf9e-6ffd7c81a766, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_Resolved_df392d3d-95e0-7009-2942-d0418a3e344b, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_DEN_Cave_SUB_adecafa4-27c6-4b2f-bf9e-6ffd7c81a766, _Var1, _Var1, _Var1, _Var1)
AND
QRY_DEN_CapturedGoblin_GrieflingIsLeaving()
THEN
DB_NOOP(1);

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
DB_DEN_DefaultStates(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Resolution", _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_ForceConcludeGriefling();

PROC
PROC_DEN_CapturedGoblin_ForceConcludeGriefling()
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GuardsLeft_b79734e0-8efc-228f-9a44-50641da7c55a, _, _, _, _)
AND
QRY_DEN_CapturedGoblin_GrieflingIsLeaving()
THEN
SetFlag(DEN_CapturedGoblin_Event_GuardsLeft_b79734e0-8efc-228f-9a44-50641da7c55a);

PROC
PROC_DEN_CapturedGoblin_ForceConcludeGriefling()
AND NOT
QRY_DEN_CapturedGoblin_GrieflingIsLeaving()
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _, _, _, _)
THEN
SetFlag(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c);
Die(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, 0, 1);
SetFlag(DEN_CapturedGoblin_Event_GuardsLeft_b79734e0-8efc-228f-9a44-50641da7c55a);

QRY
QRY_DEN_CapturedGoblin_GrieflingIsLeaving()
AND
DB_DEN_CapturedGoblin_GrieflingLeaveFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_LeftDEN", _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_GuardsStayed_288ac3b0-3f5b-5c15-b0fb-def5c4f0b308, _, _, _, _)
THEN
ClearFlag(DEN_CapturedGoblin_Event_GuardsStayed_288ac3b0-3f5b-5c15-b0fb-def5c4f0b308);

IF
DB_State_Current(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_LeftDEN", _, _)
AND NOT
DB_DialogNPCs(_, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _, _, _)
AND NOT
DB_DialogNPCs(_, S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, _, _, _)
THEN
PROC_NotifyWhenReadyToMoveOn(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingLeaving");

PROC
PROC_ReadyToMoveOn(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingLeaving", _, _, _)
THEN
PROC_CharacterMoveTo(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_OpenGateOutsidePos_768e43ba-7bda-4162-be4a-710775ecbf1f, "Walk", "DEN_CapturedGoblin_ReadytoLeave");

PROC
PROC_ReadyToMoveOn(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingLeaving", _, _, _)
THEN
Follow(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);

IF
EntityEvent(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_ReadytoLeave", _, _, _)
THEN
PROC_DisappearOutOfSight(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "Walk", 0, "DEN_CapturedGoblin_GrieflingGone");
StopFollow(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52);
PROC_DisappearOutOfSight(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, "Walk", 0, "DEN_CapturedGoblin_FriendGone");

IF
EntityEvent(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingGone", _, _, _)
THEN
DB_DEN_CapturedGoblin_DeadGrieflingSetReady(1);

IF
DB_DEN_CapturedGoblin_DeadGrieflingSetReady(1, _, _, _, _)
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_DEN_GrieflingGoblitterateSphere_fde02590-d754-4efc-ab60-8ac44205f94a, _, _, _, _)
THEN
NOT DB_DEN_CapturedGoblin_DeadGrieflingSetReady(1);
AppearAt(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_GrieflingGoblitteratePoint_944ec5c4-b64d-48e0-a67d-6e9b18dface9, 0, NULL_00000000-0000-0000-0000-000000000000, "DEN_CapturedGoblin_GrieflingDeath");

IF
LeftTrigger((CHARACTER)_Var1, S_DEN_GrieflingGoblitterateSphere_fde02590-d754-4efc-ab60-8ac44205f94a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_CapturedGoblin_DeadGrieflingSetReady(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_DEN_GrieflingGoblitterateSphere_fde02590-d754-4efc-ab60-8ac44205f94a, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_CapturedGoblin_DeadGrieflingSetReady(1);
AppearAt(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, S_DEN_GrieflingGoblitteratePoint_944ec5c4-b64d-48e0-a67d-6e9b18dface9, 0, NULL_00000000-0000-0000-0000-000000000000, "DEN_CapturedGoblin_GrieflingDeath");

IF
EntityEvent(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingDeath", _, _, _)
THEN
Die(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
FlagSet(DEN_RaidingParty_Quest_GoblinRaidOver_98712d90-c46b-20c4-c4df-02c0117e85a5, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(DEN_CapturedGoblin_State_Grieve_93f4f48a-6edd-93a1-2704-b13691df0bb4, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_StateSet_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Is_InCombat(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GLO_IsOrWasInCombat(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Grieve", _, _)
AND
DB_DEN_CapturedGoblin_GrieflingScenes("DEN_CapturedGoblin_GrieflingGrieve", _, _, _, _)
THEN
DB_SceneManager(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingGrieve");
DB_SceneManager(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, "DEN_CapturedGoblin_GrieflingGrieve");

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Avenge", _, _)
AND
DB_DEN_CapturedGoblin_GrieflingScenes("DEN_CapturedGoblin_GrieflingAvenge", _, _, _, _)
THEN
DB_SceneManager(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_CapturedGoblin_GrieflingAvenge");
DB_SceneManager(S_DEN_GrieflingFriend_c3334ee5-38dc-4197-aacc-4aa55803ff52, "DEN_CapturedGoblin_GrieflingAvenge");

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Resolution", _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_GrieflingAvengeSpotter");
PROC_DEN_CapturedGoblin_EndScene("DEN_CapturedGoblin_GrieflingAvenge");

PROC
PROC_State_Changed(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
QRY_State_IsBeforeState(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, "DEN_Griefling_CapturedGoblin", "DEN_Griefling_State_Transit", _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_EndScene("DEN_CapturedGoblin_GrieflingGrieve");

IF
FlagSet(DEN_CapturedGoblin_State_SteppedInfrontOfCrossbow_dff39def-ac63-8851-1330-239b310f090f, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_DEN_StandBetweenPoint_75d5a7d4-fdc7-4de3-b8d2-3ce5b6ce4e1c, "Walk", "");

IF
FlagSet(DEN_CapturedGoblin_Event_SteppedBackFromGoblin_8b55ccb8-ab1a-40ea-88d2-fe40ae6994e2, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_DEN_GrieflingPlayerStandPoint_b83b94f6-8982-4399-ba29-89744e9daf54, "Walk", "");

PROC
PROC_StateSet_Defeated(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_DEN_CapturedGoblin_GrieflingScenes(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_EndScene(_Var1);

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
DB_DEN_DefaultStates(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CapturedGoblin_GrieflingScenes(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_CapturedGoblin_EndScene(_Var2);

PROC
PROC_SceneInterrupted((CHARACTER)_Var1, (CHARACTER)_Var2, "DEN_CapturedGoblin_GrieflingGrieve", (STRING)_Var3, (CHARACTER)_Var1)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);
PROC_SetRelationTemporaryHostile(_Var1, _Var2);
PROC_DEN_CapturedGoblin_EndScene("DEN_CapturedGoblin_GrieflingGrieve");

PROC
PROC_SceneInterrupted((CHARACTER)_Var1, (CHARACTER)_Var2, "DEN_CapturedGoblin_GrieflingAvenge", (STRING)_Var3, (CHARACTER)_Var1)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8);
PROC_SetRelationMutual(ACT1_DEN_Griefling_b30628c0-87aa-aa8a-4bc6-84740eb6ef92, ACT1_DEN_CapturedGoblin_40d6a49e-806c-4bce-8214-6228cc0ded72, 0);
SetFlag(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899);
PROC_SetRelationTemporaryHostile(_Var1, _Var2);
PROC_DEN_CapturedGoblin_EndScene("DEN_CapturedGoblin_GrieflingAvenge");

PROC
PROC_OnDialogAttack_GoingHostile(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DialogName(DEN_CapturedGoblin_GuardsAvenge_4bedcdef-dad2-b1b2-5b1a-85ffb783e1c9, _Var2, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var2, _Var1, _, _Var1, _Var1)
THEN
PROC_SetRelationMutual(ACT1_DEN_Griefling_b30628c0-87aa-aa8a-4bc6-84740eb6ef92, ACT1_DEN_CapturedGoblin_40d6a49e-806c-4bce-8214-6228cc0ded72, 0);
SetFlag(DEN_CapturedGoblin_Event_GuardCombat_e19c82e5-5463-fe2a-5511-fb5d08a93899);

PROC
PROC_DEN_CapturedGoblin_EndScene((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_DEN_CapturedGoblin_GrieflingScenes(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SceneOver(_Var1);
NOT DB_DEN_CapturedGoblin_GrieflingScenes(_Var1);

IF
FlagSet(DEN_CapturedGoblin_Event_Foiled_99ff0e4d-0ce5-7164-4d81-b00edd7906a8, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c, _, _, _, _)
THEN
ClearFlag(DEN_CapturedGoblin_Event_GoblinShot_1ccc6b3f-7255-de5f-75ee-296962b85e5c);

IF
DB_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _, _, _)
THEN
ClearOwnership(S_DEN_GoblinCageDoor_208e7554-1199-4737-b107-b3c1ccddd588);

QRY
QRY_CRIME_Guards_GuardKillerExcludeWitness(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_CharacterRegisterCrime_Success((GUIDSTRING)_Var1, (STRING)_Var2, (INTEGER)_Var3, (GUIDSTRING)_Var4, (GUIDSTRING)_Var5, (INTEGER)_Var6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_WasInDen(_Var5, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _Var1, _Var1, _Var1, _Var1)
AND
_Var5 != S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb
THEN
CrimeIgnoreCrime(_Var6, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

IF
FlagSet(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _, _, _)
THEN
PROC_TryStopDialogFor(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
PROC_CharacterRegisterCrime(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "DEN_CapturedGoblinFree", S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _, _, _)
THEN
CharacterStopCrime(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "DEN_CapturedGoblinFree", S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

PROC
PROC_StateSet_PermaDefeated(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_State_Released_63535870-e8f0-6b53-4194-0ca66bc2416e, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_State_LeftDen_2a64c50f-45b6-8bd2-e980-77fb4b11fce3, _, _, _, _)
THEN
CharacterStopCrime(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, "DEN_CapturedGoblinFree", S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
NOT DB_CRIME_Guards_NoSummonBy(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

QRY
QRY_CrimeGetCustomWarning((CHARACTER)_Var1, "DEN_CapturedGoblinFree", (DIALOGRESOURCE)_Var2, _, (CHARACTER)_Var1)
THEN
DB_CrimeWarning_Block(_Var1, "DEN_CapturedGoblinFree", _Var2, 1);

PROC
PROC_CrimeSelectWarning(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _, (INTEGER)_Var2, "DEN_CapturedGoblinFree", (DIALOGRESOURCE)_Var3, (CHARACTER)_Var4, _, _, _, (STRING)_)
THEN
PROC_SetRelationTemporaryHostile(S_DEN_Griefling_7ce0afc2-e8f2-4f2e-82d8-27df98acc3d8, _Var4);

PROC
PROC_CrimeSelectWarning((CHARACTER)_Var1, (STRING)_Var2, (INTEGER)_Var3, "DEN_CapturedGoblinFree", (DIALOGRESOURCE)_Var4, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, (CHARACTER)_Var5, (CHARACTER)_Var6, (CHARACTER)_Var7, (CHARACTER)_Var1)
AND
DB_CrimeWarning_Block(_Var1, "DEN_CapturedGoblinFree", _Var4, 1, _Var1)
AND
QRY_GetClosestAvailableCharacterTo(_Var1, 1, 0, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, 1, 1, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo(_Var8, _Var1, _Var9, _Var1, _Var1)
AND
_Var9 < 20
THEN
NOT DB_CrimeWarning_Block(_Var1, "DEN_CapturedGoblinFree", _Var4, 1);
PROC_CrimeSelectWarning(_Var1, _Var2, _Var3, "DEN_CapturedGoblinFree", GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, _Var8, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var6, _Var7);

PROC
PROC_CrimeSelectWarning((CHARACTER)_Var1, _, (INTEGER)_Var3, "DEN_CapturedGoblinFree", (DIALOGRESOURCE)_Var4, _, _, _, _, (CHARACTER)_Var1)
AND
DB_CrimeWarning_Block(_Var1, "DEN_CapturedGoblinFree", _Var4, 1, _Var1)
THEN
PROC_TryStartAD(DEN_CapturedGoblin_AD_Crime_77292cca-f95d-686c-c3b0-3e63ef2ff7a0, _Var1);

PROC
PROC_CrimeSelectWarning((CHARACTER)_Var1, _, _, "DEN_CapturedGoblinFree", (DIALOGRESOURCE)_Var4, (CHARACTER)_Var5, _, _, _, (CHARACTER)_Var1)
AND
DB_DialogPlayers(_Var9, _Var5, _, _Var1, _Var1)
AND
DB_DialogName(GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, _Var9, _Var1, _Var1, _Var1)
THEN
NOT DB_CrimeWarning_Block(_Var1, "DEN_CapturedGoblinFree", _Var4, 1);

PROC
PROC_CrimeSelectWarning((CHARACTER)_Var1, _, (INTEGER)_Var3, "DEN_CapturedGoblinFree", (DIALOGRESOURCE)_Var4, _, _, _, _, (CHARACTER)_Var1)
AND
DB_CrimeWarning_Block(_Var1, "DEN_CapturedGoblinFree", _Var4, 1, _Var1)
THEN
PROC_SetRelationTemporaryHostile(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);

PROC
PROC_CrimeFailedToInterruptStoryDialog((INTEGER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var3, (CHARACTER)_Var4, (CHARACTER)_Var5, (CHARACTER)_Var6, GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
CharacterGetCrimeRegion(_Var2, _Var7, _Var1, _Var1, _Var1)
THEN
DB_CrimeWarning_Block(_Var2, "DEN_CapturedGoblinFree", GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, 1);
PROC_CrimeSelectWarning(_Var2, _Var7, _Var1, "DEN_CapturedGoblinFree", GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, _Var3, _Var4, _Var5, _Var6);

IF
OnCrimeConfrontationDone((INTEGER)_Var1, _, _, _, _, _, _, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
CrimeGetType(_Var1, "DEN_CapturedGoblinFree", _Var1, _Var1, _Var1)
THEN
IgnoreCrimeInRadiusWithTags(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _Var1, 15, "");

IF
FlagSet(DEN_CapturedGoblin_Event_GoblinBetrayed_991fd91a-c2bd-3382-b77f-9a930e1ba46a, _, _, _, _)
AND
DB_DEN_CapturedGoblin_Follow(_Var3, _, _, _, _)
THEN
ClearFlag(DEN_CapturedGoblin_Follow_8df7d87d-1b18-7be5-1003-f4ce70ff1f25, _Var3);

IF
DialogEnded(GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinBetrayed_991fd91a-c2bd-3382-b77f-9a930e1ba46a, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogNPCs(_Var1, _Var2, 1, _Var1, _Var1)
THEN
DB_DEN_CapturedGoblin_Betrayers(_Var2);

IF
DialogEnded(GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinBetrayed_991fd91a-c2bd-3382-b77f-9a930e1ba46a, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_CapturedGoblin_Event_LeftGoblin_9c5c270b-ba7d-4a4f-5347-96dd1f47b53e, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
DB_DEN_CapturedGoblin_Betrayers(_Var2);

IF
FlagSet(TemporaryHostilityAfterDialog_ca0cbe39-d121-069e-b408-c02954b32cf7, _, (INTEGER)_Var2, _, _)
AND
DB_DialogName(GEB_DEN_CapturedGoblin_Crime_74ca3628-bc97-63c8-e1c3-944ea78600ec, _Var2, _, _, _)
AND
DB_DialogNPCs(_Var2, _Var3, 1, _, _)
THEN
DB_DEN_CapturedGoblin_Betrayers(_Var3);

IF
CharacterLeftParty(S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb, _, _, _, _)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinBetrayed_991fd91a-c2bd-3382-b77f-9a930e1ba46a, _, _, _, _)
THEN
DB_DEN_CapturedGoblin_LeftBetrayed(1);

IF
DB_DEN_CapturedGoblin_LeftBetrayed(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_CapturedGoblin_Betrayers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationTemporaryHostile(_Var1, S_DEN_CapturedGoblin_783d7572-a846-455f-b686-247a95263ebb);
NOT DB_DEN_CapturedGoblin_Betrayers(_Var1);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(DEN_CapturedGoblin_Event_GoblinBetrayed_991fd91a-c2bd-3382-b77f-9a930e1ba46a, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(DEN_CapturedGoblin_Event_GoblinBetrayed_991fd91a-c2bd-3382-b77f-9a930e1ba46a, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag(DEN_CapturedGoblin_Event_LeftGoblin_9c5c270b-ba7d-4a4f-5347-96dd1f47b53e, NULL_00000000-0000-0000-0000-000000000000, 0);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
