Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_BridgeEntrance_4f9172c0-cf44-4476-853e-f48baadcd43d, S_GOB_Orpheus_BridgeEntrance_AddToDialogArea_ac143b80-368c-46e2-bed3-c1d84b1fa3ba, S_GOB_Orpheus_BridgeEntrance_SHPos_114d3b5d-c358-4c22-a2c0-9115ad48ec87, S_GOB_Orpheus_BridgeEntrance_SHEndPos_998c9884-b247-4d79-a7d5-dd6bcd0fb8fb);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_PlainsEntrance_14864342-8a4f-47f0-aae4-466494695f76, S_GOB_Orpheus_PlainsEntrance_AddToDialogArea_fc5a15cd-c698-4707-ad85-390914145b10, S_GOB_Orpheus_PlainsEntrance_SHPos_be24aea9-965e-4f94-9b68-25f97e57391b, S_GOB_Orpheus_PlainsEntrance_SHEndPos_fca0c0d4-4c5e-452d-8d99-c05843efe550);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_SecludedGoblinEntrance_96946abd-9b25-42f7-858d-1b8870bfe9cb, S_GOB_Orpheus_SecludedGoblinEntrance_AddToDialogArea_89cea0f0-0bcd-4253-bb3e-10f9af9dfc2f, S_GOB_Orpheus_SecludedGoblinEntrance_SHPos_bca5773d-3ed7-4d1a-899a-d1886ab17f12, S_GOB_Orpheus_SecludedGoblinEntrance_SHEndPos_f09855c4-c8ee-47a5-b71f-c24c54dbb3e9);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_WindmillEntrance_e03d7047-1ca3-419e-a28b-83de255de924, S_GOB_Orpheus_WindmillEntrance_AddToDialogArea_603c4d49-7ca8-4b26-9dd6-7a51d00837f7, S_GOB_Orpheus_WindmillEntrance_SHPos_d64cb4fc-bb2d-4c64-ac8b-4efa0af2129d, S_GOB_Orpheus_WindmillEntrance_SHEndPos_a67bbed3-751b-4d86-b838-1a4ac3e6e232);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_RisingRoad_71c69f61-ee70-4bfc-8a87-4d4ed54e923f, S_GOB_Orpheus_RisingRoad_AddToDialogArea_37575969-7e17-4dc7-8f7e-77c0cb7e960f, S_GOB_Orpheus_RisingRoad_SHPos_ff536b30-4509-4b78-a3ef-8444f1264f53, S_GOB_Orpheus_RisingRoad_SHEndPos_a249f1ef-7c12-4b98-9a30-654a43c8f691);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_MountainPass_e2980e60-973a-4844-a825-b0dfeae0f630, S_GOB_Orpheus_MountainPass_AddToDialogArea_e94c5cc9-c9d3-4db7-9714-b3f499f0dcba, S_GOB_Orpheus_MountainPass_SHPos_524a8dde-1617-438e-8479-decac9d7c0e7, S_GOB_Orpheus_MountainPass_SHEndPos_ad47fbd9-4276-4c98-9c36-7a8c43c86bff);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_KethericCity_e9f8b6bb-fa09-4d35-93bf-1ee96ea3a322, S_GOB_Orpheus_KethericCity_AddToDialogArea_5887df5b-4c46-47e6-8065-2e99900b2901, S_GOB_Orpheus_KethericCity_SHPos_6221cb03-1cba-419b-ab3c-1bdb9392b1c9, S_GOB_Orpheus_KethericCity_SHEndPos_66acf44b-c1f3-42fb-8ed4-c18dd6a17eab);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_TempleFallbackA_05f36c7a-a9b9-4529-a97c-8b4021d61a0b, S_GOB_Orpheus_TempleFallbackA_AddToDialogArea_5b10adf9-25c0-45b2-a5c7-6c3288705e9d, S_GOB_Orpheus_TempleFallbackA_SHPos_27e591aa-4834-4883-b6d8-fad4ada31079, S_GOB_Orpheus_TempleFallbackA_SHEndPos_ac9861b4-e5e2-4258-9925-fcbafe3e6e7d);
DB_GOB_Orpheus_ProtectionTriggers(S_GOB_Orpheus_TempleFallbackB_1f74d835-d58b-4ef4-95f5-f36349d5617e, S_GOB_Orpheus_TempleFallbackB_AddToDialogArea_f0f924fc-d0ea-4d94-805d-4374d1227f58, S_GOB_Orpheus_TempleFallbackB_SHPos_2f1a537d-5b45-484a-9539-c8efaf610734, S_GOB_Orpheus_TempleFallbackB_SHEndPos_2ff55e93-3fa0-45dd-a003-d962487c8308);
DB_GOB_Orpheus_Teleporters(S_PLA_TeleporterToCrecheFromPlains_016525f4-0ddd-4cf1-85ab-3feaa6f6292a);
DB_GOB_Orpheus_Teleporters(S_GOB_TeleporterToCrecheFromGoblinCamp_a81232d7-af15-4c77-b0e1-d7e791fd463b);
DB_GOB_Orpheus_Teleporters(S_UND_Elevator_Fort_ToShadowlands_e48a9110-dabc-4471-bcae-3cc8aa57b8c5);
DB_GOB_Orpheus_Teleporters(S_GOB_ThroneRoom_Door_Entrance_bf8a7b29-383d-4344-bbe6-b72f10c1ba50);
DB_GOB_Orpheus_Teleporters(S_GOB_Festivities_SecretEntrance_Door_ddbb3184-e682-47b7-ac0f-94d631b3f3ed);
DB_GOB_Orpheus_VoiceDialogs(GOB_Orpheus_VoiceOfAbsolute_ShadowheartHasBox_8996ac21-4624-8bd4-02f2-24c92219d8cd);
DB_GOB_Orpheus_VoiceDialogs(GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b);

KBSECTION
IF
DB_GOB_Orpheus_VoiceDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DropMutingStatussesDialog(_Var1);
DB_DialogBlockTradeButton(_Var1);
DB_DialogBlockAttackButton(_Var1);

IF
DB_GOB_Orpheus_ProtectionTriggers(_Var1, _, _, _, _Var1)
THEN
PROC_TriggerRegisterForPlayers(_Var1);

IF
EnteredTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _, _, _, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_InteractiveDialogSpeaker(_, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_StartVoiceDialog(_Var1, _Var2);

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _, _, _, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Orpheus_PostponeEventStart(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_Orpheus_PostponeEventStart(_Var1);

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _, _, _, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_InteractiveDialogSpeaker(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Orpheus_PostponeEventStart(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_Orpheus_PostponeEventStart(_Var1);

IF
DB_GOB_Orpheus_PostponeEventStart(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_PostponeEventStart(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
THEN
NOT DB_GOB_Orpheus_PostponeEventStart(_Var2);

IF
DB_GOB_Orpheus_PostponeEventStart(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_InteractiveDialogSpeaker(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_PartyWasFaintedByVoice_4c7a0307-eb7d-4933-899c-80272dc5bcb2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_InCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_Orpheus_PostponeEventStart(_Var1);
PROC_GOB_Orpheus_StartVoiceDialog(_Var1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_Orpheus_Teleporters(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, _Var2, 0);
PROC_GOB_Orpheus_StartVoiceDialog(_Var1);

QRY
QRY_GOB_Orpheus_AnyPlayerInPreparedOrpheus()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_PostponeEventStart(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_GOB_Orpheus_SomeoneInsideDialog()
AND
DB_GOB_Orpheus_VoiceDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogName(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_GOB_Orpheus_PrepareAddToDialogTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_, _Var1, _, _, _Var1)
AND NOT
DB_AddCharactersInTriggerToDialog(_, _Var1, _, _, _, _, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(_Var1);
DB_AddCharactersInTriggerToDialog(_Var2, _Var1, 1, 0);

QRY
QRY_GOB_Orpheus_PrepareAddToDialogTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_NOOP(1);

PROC
PROC_GOB_Orpheus_StartVoiceDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var3, _Var4, _, _, _Var1)
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, _Var4, 1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_StartVoiceDialog(_Var2, _Var3);

PROC
PROC_GOB_Orpheus_StartVoiceDialog(_, (TRIGGER)_Var2, _, _, _)
AND
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
AND
GetFlag(GLO_InfernalBox_State_BoxBoundedTo_f4d2be66-0443-4069-8ca2-570143f17e27, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, _, _)
AND NOT
DB_Avatars(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var3, _, _, _)
AND
IsInTrigger(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var3, 1, _, _)
AND
QRY_GetBestAvatarForCompanion(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, 1, _, _)
AND
DB_QRYRTN_GetBestAvatarForCompanion(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var6, _, _, _)
AND
QRY_SpeakerIsAvailable(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
QRY_GOB_Orpheus_PrepareAddToDialogTrigger(_Var3, GOB_Orpheus_VoiceOfAbsolute_ShadowheartHasBox_8996ac21-4624-8bd4-02f2-24c92219d8cd, _, _, _)
AND
QRY_GOB_Orpheus_StartDialog(GOB_Orpheus_VoiceOfAbsolute_ShadowheartHasBox_8996ac21-4624-8bd4-02f2-24c92219d8cd, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_GOB_Orpheus_VoiceOfAbsoluteHelper_696b6670-c31c-4cfe-a1dd-fa80c3b59dad, _Var6, _)
THEN
DB_NOOP(1);

PROC
PROC_GOB_Orpheus_StartVoiceDialog(_, (TRIGGER)_Var2, _, _, _)
AND
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
AND
GetFlag(GLO_InfernalBox_State_BoxBoundedTo_f4d2be66-0443-4069-8ca2-570143f17e27, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 0, _, _)
AND
DB_GLO_InfernalBox_CharacterWithBox(_Var3, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND NOT
DB_Avatars(_Var3, _, _, _, _)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var4, _, _, _)
AND
IsInTrigger(_Var3, _Var4, 1, _, _)
AND
QRY_GetClosestAvailableCharacterTo(_Var3, 0, _, _, _)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var7, _Var3, _, 1, _)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var3, _Var7, 0, 1, _)
AND
QRY_GOB_Orpheus_PrepareAddToDialogTrigger(_Var4, GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, _, _, _)
AND
QRY_GOB_Orpheus_StartDialog(GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, S_GOB_Orpheus_VoiceOfAbsoluteHelper_696b6670-c31c-4cfe-a1dd-fa80c3b59dad, _Var7, _, _)
THEN
DB_NOOP(1);

PROC
PROC_GOB_Orpheus_StartVoiceDialog(_, (GUIDSTRING)_Var2, _, _, _)
AND
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
AND
DB_GLO_InfernalBox_CharacterWithBox(_Var3, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var4, _, _, _)
AND
IsInTrigger(_Var3, _Var4, 1, _, _)
AND
QRY_SpeakerIsAvailable(_Var3, _, _, _, _)
AND
QRY_GOB_Orpheus_PrepareAddToDialogTrigger(_Var4, GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, _, _, _)
AND
QRY_GOB_Orpheus_StartDialog(GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, S_GOB_Orpheus_VoiceOfAbsoluteHelper_696b6670-c31c-4cfe-a1dd-fa80c3b59dad, _Var3, _, _)
THEN
DB_NOOP(1);

PROC
PROC_GOB_Orpheus_StartVoiceDialog((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var3, _, _, _Var1)
AND NOT
DB_GlobalFlag(GLO_InfernalBox_State_TeamHasBox_d8b25e35-ec84-45e5-8395-5ce6faa36fbd, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GLO_InfernalBox_State_BoxBoundedTo_f4d2be66-0443-4069-8ca2-570143f17e27, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, _Var1, _Var1)
AND NOT
DB_Defeated(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PartOfTheTeam(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_StartVoiceDialog_WithShadowheartRecruitment(_Var1, _Var2);

PROC
PROC_GOB_Orpheus_StartVoiceDialog((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
AND
QRY_GetClosestAvailableCharacterTo(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var3, _Var1, _Var4, 1, _Var1)
AND
_Var4 < 25
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var5, _, _, _Var1)
AND
IsInTrigger(_Var3, _Var5, 1, _Var1, _Var1)
AND
QRY_GOB_Orpheus_PrepareAddToDialogTrigger(_Var5, GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, _Var1, _Var1, _Var1)
AND
QRY_GOB_Orpheus_StartDialog(GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, S_GOB_Orpheus_VoiceOfAbsoluteHelper_696b6670-c31c-4cfe-a1dd-fa80c3b59dad, _Var3, _Var1, _Var1)
THEN
SetFlag(GOB_Orpheus_Event_TransferBoxToCharacter_1dfabd27-de06-44f3-98df-3c492d550933, _Var3);

PROC
PROC_GOB_Orpheus_StartVoiceDialog((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var3, _, _, _Var1)
AND
IsInTrigger(_Var1, _Var3, 1, _Var1, _Var1)
AND
QRY_GOB_Orpheus_PrepareAddToDialogTrigger(_Var3, GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, _Var1, _Var1, _Var1)
AND
QRY_GOB_Orpheus_StartDialog(GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b, S_GOB_Orpheus_VoiceOfAbsoluteHelper_696b6670-c31c-4cfe-a1dd-fa80c3b59dad, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_Orpheus_Event_TransferBoxToCharacter_1dfabd27-de06-44f3-98df-3c492d550933, _Var1);

PROC
PROC_GOB_Orpheus_StartVoiceDialog((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
THEN
PROC_GOB_Orpheus_OnVoiceDialogFailed(GOB_Orpheus_VoiceOfAbsolute_7f6edcc6-8f3e-9082-5cfc-c72aeced596b);

QRY
QRY_GOB_Orpheus_VoiceDialogStartUnblocked()
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _, _, _, _)
AND NOT
DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_GOB_Orpheus_StartVoiceDialog_WithShadowheartRecruitment((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_Orpheus_SelectCharacterForVoiceDialog_PreferAvatar(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var3, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_PrepShadowheartRecruitment(_Var3, _Var4);

PROC
PROC_GOB_Orpheus_PrepShadowheartRecruitment((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_State_Current(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "GOB", _Var1, _Var1)
THEN
DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1);
PROC_CancelDisappearOutOfSight(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
PROC_ForceStopDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
PROC_ClearStoryMove(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
RemoveHarmfulStatuses(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
ApplyStatus(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "INVISIBLE", 1, 1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
TeleportTo(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var2, "GOB_Orpheus_ShadowheartTeleported");

PROC
PROC_GOB_Orpheus_PrepShadowheartRecruitment((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "GOB", _Var1, _Var1)
THEN
PROC_GOB_Orpheus_OnShadowheartReady();

IF
EntityEvent(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "GOB_Orpheus_ShadowheartTeleported", _, _, _)
AND NOT
DB_OffStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
THEN
PROC_GOB_Orpheus_OnShadowheartAppeared();

IF
EntityEvent(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "GOB_Orpheus_ShadowheartTeleported", _, _, _)
AND
DB_OffStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND NOT
DB_GOB_Orpheus_WaitingToWentOnStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
THEN
DB_GOB_Orpheus_WaitingToWentOnStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
SetOnStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1);

IF
WentOnStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, _, _, _)
AND
DB_GOB_Orpheus_WaitingToWentOnStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
THEN
NOT DB_GOB_Orpheus_WaitingToWentOnStage(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679);
PROC_GOB_Orpheus_OnShadowheartAppeared();

PROC
PROC_GOB_Orpheus_OnShadowheartAppeared()
AND
DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1, _, _, _, _)
AND
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_, _, _Var2, _Var5, _Var1)
THEN
RemoveStatus(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "INVISIBLE");
PROC_State_Progress(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "GOB");
PROC_GLO_Origins_SetRecruitmentDialog(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, ShadowHeart_Recruitment_Gob_cd0dd81e-a7b4-1cae-6d4c-750a7a65ff59);
PROC_CharacterMoveTo(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var5, "Sprint", "GOB_Orpheus_ShadowheartArrived");
PROC_GOB_Orpheus_OnShadowheartReady();

PROC
PROC_GOB_Orpheus_OnShadowheartReady()
AND
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_, _Var4, _Var2, _, _Var1)
AND
QRY_GOB_Orpheus_PrepareAddToDialogTrigger(_Var4, GOB_Orpheus_VoiceOfAbsolute_ShadowheartHasBox_8996ac21-4624-8bd4-02f2-24c92219d8cd, _Var1, _Var1, _Var1)
AND
QRY_GOB_Orpheus_StartDialog(GOB_Orpheus_VoiceOfAbsolute_ShadowheartHasBox_8996ac21-4624-8bd4-02f2-24c92219d8cd, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, S_GOB_Orpheus_VoiceOfAbsoluteHelper_696b6670-c31c-4cfe-a1dd-fa80c3b59dad, _Var1, _Var1)
THEN
DB_Dialogs_DialogBlockRestoreMutingStatuses(GOB_Orpheus_VoiceOfAbsolute_ShadowheartHasBox_8996ac21-4624-8bd4-02f2-24c92219d8cd, _Var1);

QRY
QRY_GOB_Orpheus_SelectCharacterForVoiceDialog_PreferAvatar((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_, _, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var5, _Var6, _, _Var1)
AND
QRY_GetClosestAvailableCharacterTo(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var8, _Var1, _, _, _Var1)
AND
IsInTrigger(_Var8, _Var5, 1, _Var1, _Var1)
THEN
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var8, _Var6);

QRY
QRY_GOB_Orpheus_SelectCharacterForVoiceDialog_PreferAvatar((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_, _, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, 0, 1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var5, _Var6, _, _Var1)
THEN
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var1, _Var6);

QRY
QRY_GOB_Orpheus_SelectCharacterForVoiceDialog_PreferAvatar(_, (TRIGGER)_Var2, _, _, _)
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var2, _Var3, _Var4, _, _)
AND
DB_Players(_Var6, _, _, _, _)
AND NOT
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_, _, _, _, _)
AND
IsInTrigger(_Var6, _Var3, 1, _, _)
AND
QRY_SpeakerIsAvailable(_Var6, 0, 1, _, _)
THEN
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var6, _Var4);

QRY
QRY_GOB_Orpheus_StartDialog((DIALOGRESOURCE)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var3, (CHARACTER)_Var4, (DIALOGRESOURCE)_Var1)
AND
QRY_StartDialog(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
PROC_GOB_Orpheus_OnVoiceDialogStarted();

QRY
QRY_GOB_Orpheus_StartDialog((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_StartDialog(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_OnVoiceDialogStarted();

QRY
QRY_GOB_Orpheus_StartDialog((DIALOGRESOURCE)_Var1, _, _, _, (DIALOGRESOURCE)_Var1)
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_OnVoiceDialogFailed(_Var1);

QRY
QRY_GOB_Orpheus_StartDialog((DIALOGRESOURCE)_Var1, _, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_OnVoiceDialogFailed(_Var1);

IF
DialogRequestFailed((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GOB_Orpheus_VoiceDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_OnVoiceDialogFailed(_Var1);

IF
DialogEnded((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_Orpheus_VoiceDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_OnVoiceDialogEnded(_Var1);

IF
FlagSet(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _, _, _, _)
AND
DB_PartyMembers(_Var3, _, _, _, _)
AND NOT
DB_PermaDefeated(_Var3, _, _, _, _)
AND
IsTagged(_Var3, ILLITHID_1eec74e8-3673-4500-abec-57b7ed8469ed, 1, _, _)
AND
HasAppliedStatus(_Var3, "GLO_ORPHEUS_PROTECTED", 0, _, _)
THEN
ApplyStatus(_Var3, "GLO_ORPHEUS_PROTECTED", -1, 1, S_GLO_PuzzleBox_326324f9-0920-8f0f-3e85-3781fbf48282);

IF
FlagSet(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _, _, _, _)
AND
DB_State_Current(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "Recruitment", "GOB", _, _)
AND NOT
DB_PartOfTheTeam(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND NOT
DB_Defeated(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
THEN
ApplyStatus(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, "GLO_ORPHEUS_PROTECTED", -1, 1, S_GLO_PuzzleBox_326324f9-0920-8f0f-3e85-3781fbf48282);

PROC
PROC_GOB_Orpheus_OnVoiceDialogStarted()
AND NOT
DB_GOB_Orpheus_VoiceDialogStarted(1, _, _, _, _)
THEN
DB_GOB_Orpheus_VoiceDialogStarted(1);

PROC
PROC_GOB_Orpheus_OnVoiceDialogFailed((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
THEN
PROC_GOB_Orpheus_ClearVoiceDialogData(_Var1);

PROC
PROC_GOB_Orpheus_OnVoiceDialogEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_GOB_Orpheus_ClearVoiceDialogData(_Var1);

PROC
PROC_GOB_Orpheus_ClearVoiceDialogData((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_Orpheus_ShadowheartRecruitment_ChainingInProgress(1);

PROC
PROC_GOB_Orpheus_ClearVoiceDialogData((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_Dialogs_DialogBlockRestoreMutingStatuses(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_Dialogs_DialogBlockRestoreMutingStatuses(_Var1, _Var2);

PROC
PROC_GOB_Orpheus_ClearVoiceDialogData((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_Orpheus_ShadowheartRecruitment_SelectedPlayer(_Var2, _Var3);

PROC
PROC_GOB_Orpheus_ClearVoiceDialogData((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_AddCharactersInTriggerToDialog(_Var1, _Var2, _, _, _Var1)
THEN
PROC_AddCharactersInTriggerToDialog_Clear(_Var1, _Var2);

PROC
PROC_GOB_Orpheus_ClearVoiceDialogData((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_Orpheus_VoiceDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_Orpheus_VoiceDialogStarted(1);

IF
FlagSet(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GOB_Orpheus_UnregisterVoiceTriggers();

PROC
PROC_GOB_Orpheus_UnregisterVoiceTriggers()
AND
DB_GOB_Orpheus_ProtectionTriggers(_Var1, _, _, _, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(_Var1);

PROC
PROC_GOB_Orpheus_UnregisterVoiceTriggers()
AND
DB_GOB_Orpheus_ProtectionTriggers(_, _Var2, _, _, _)
THEN
PROC_TriggerUnregisterForPlayers(_Var2);

PROC
PROC_GOB_Orpheus_OnVoiceDialogFailed((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GOB_Orpheus_RetriedToStart(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(GOB_Orpheus_State_PartyWasFaintedByVoice_4c7a0307-eb7d-4933-899c-80272dc5bcb2);
PROC_GOB_Orpheus_StartFainting();

PROC
PROC_GOB_Orpheus_OnVoiceDialogEnded((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GOB_Orpheus_RetriedToStart(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(GOB_Orpheus_State_PartyWasFaintedByVoice_4c7a0307-eb7d-4933-899c-80272dc5bcb2);

PROC
PROC_GOB_Orpheus_OnVoiceDialogEnded((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GlobalFlag(GOB_Orpheus_State_PartyWasFaintedByVoice_4c7a0307-eb7d-4933-899c-80272dc5bcb2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogName(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Orpheus_WaitForDialogToClear(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_GOB_Orpheus_WaitForDialogToClear(_Var1, _Var2);

IF
DB_GOB_Orpheus_WaitForDialogToClear(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_DialogPlayers(_Var2, _, _, _Var1, _Var1)
AND NOT
DB_InteractiveDialogSpeaker(_Var2, _, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_Orpheus_WaitForDialogToClear(_Var1, _Var2);
PROC_GOB_Orpheus_StartFainting();

PROC
PROC_GOB_Orpheus_StartFainting()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Orpheus_EnteredNightMode(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_Orpheus_ProtectionTriggers(_, _Var3, _, _, _Var1)
AND
IsInTrigger(_Var1, _Var3, 1, _Var1, _Var1)
THEN
DB_GOB_Orpheus_EnteredNightMode(1);
PROC_Camp_ForceEndTheDay(_Var1, "");

PROC
PROC_GOB_Orpheus_OnVoiceDialogFailed((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
DB_GOB_Orpheus_RetriedToStart(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_RetryVoiceDialog(_Var1);

PROC
PROC_GOB_Orpheus_OnVoiceDialogEnded((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_PartyWasFaintedByVoice_4c7a0307-eb7d-4933-899c-80272dc5bcb2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_Orpheus_RetriedToStart(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_Orpheus_RetryVoiceDialog(_Var1);

PROC
PROC_GOB_Orpheus_RetryVoiceDialog(_, _, _, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND NOT
DB_GOB_Orpheus_RetriedToStart(1, _, _, _, _)
AND
DB_GOB_Orpheus_ProtectionTriggers(_, _Var4, _, _, _)
AND
IsInTrigger(_Var2, _Var4, 1, _, _)
AND
QRY_SpeakerIsAvailable(_Var2, 0, 1, _, _)
THEN
DB_GOB_Orpheus_RetriedToStart(1);
PROC_GOB_Orpheus_StartVoiceDialog(_Var2);

PROC
PROC_GOB_Orpheus_RetryVoiceDialog((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
DB_GOB_Orpheus_RetriedToStart(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_Orpheus_RetriedToStart(1);
PROC_GOB_Orpheus_OnVoiceDialogFailed(_Var1);

PROC
PROC_Camp_EnterNight_PreFadeout_Hook()
AND NOT
DB_PartOfTheTeam(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
QRY_GOB_Orpheus_ShouldKillShadowheartOnRest()
THEN
DB_GLO_InfernalBox_BlockTakingBoxDialog(1);
PROC_GOB_Orpheus_KillShadowheart();

QRY
QRY_GOB_Orpheus_ShouldKillShadowheartOnRest()
AND
DB_GlobalFlag(GOB_Orpheus_State_PartyWasFaintedByVoice_4c7a0307-eb7d-4933-899c-80272dc5bcb2, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_GOB_Orpheus_ShouldKillShadowheartOnRest()
AND
DB_GlobalFlag(GOB_Shadowheart_State_HostileAfterRecruitment_1e3517cc-7795-7183-eca3-8e0894bb71ef, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_LevelUnloading("WLD_Main_A", _, _, _, _)
AND NOT
DB_PartOfTheTeam(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND
DB_GlobalFlag(GOB_Orpheus_State_PartyWasFaintedByVoice_4c7a0307-eb7d-4933-899c-80272dc5bcb2, _, _, _, _)
THEN
PROC_GOB_Orpheus_KillShadowheart();

PROC
PROC_GOB_Orpheus_KillShadowheart()
AND NOT
DB_PermaDefeated(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
THEN
SetTag(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, BLOCK_RESURRECTION_22a75dbb-1588-407e-b559-5aa4e6d4e6a6);
Die(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 0);
PROC_GlobalSetFlagAndCache(ORI_Shadowheart_State_DiedNoGobRecruitment_b3f2edb8-2b9f-4258-a258-818a65767d35);
DB_SeenDeadNPCGlobalFlag(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, GOB_Orpheus_State_SeenDeadShadowheart_5bfacbd0-4cc0-4a35-bc7a-e4ac9185f164);

IF
DB_Dead(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Shadowheart_State_KilledByParty_a35bdc79-95b4-4ddd-8a2a-344d372998e8, _, _, _, _)
AND
DB_Sees(_Var1, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(ORI_Shadowheart_State_DiedNoGobRecruitment_b3f2edb8-2b9f-4258-a258-818a65767d35, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Camp_Faded(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("RecruitedFirstTime_ShadowHeart", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_OncePerUserAndNearbyPlayers_IsSet(_Var1, "GOB_Orpheus_PAD_SawDeadShadowheart", _Var1, _Var1, _Var1)
AND
QRY_StartDialog(GOB_Orpheus_PAD_SawDeadShadowheart_82d91b94-9864-162e-173b-2ec350850fe8, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "GOB_Orpheus_PAD_SawDeadShadowheart", _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(GLO_InfernalBox_Event_ForceGiveBox_7addbb64-502f-48aa-9b71-da1b8d6c28eb, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 != S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679
AND
DB_PartOfTheTeam(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GLO_InfernalBox_State_BoxBoundedTo_f4d2be66-0443-4069-8ca2-570143f17e27, S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, 1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(GOB_Orpheus_State_ShadowheartLostBox_97d91025-211f-4a6e-960a-0dc6de3de4ab);

PROC
PROC_GOB_Orpheus_OnVoiceDialogEnded((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogName(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var2, _Var3, _, _Var1, _Var1)
AND
GetFlag(GOB_Orpheus_Event_TransferBoxToCharacter_1dfabd27-de06-44f3-98df-3c492d550933, _Var3, 1, _Var1, _Var1)
THEN
SetFlag(GLO_InfernalBox_Event_ForceGiveBox_7addbb64-502f-48aa-9b71-da1b8d6c28eb, _Var3, _Var2);

PROC
PROC_GOB_Orpheus_ClearVoiceDialogData((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
DB_GlobalFlag(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogName(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var2, _Var3, _, _Var1, _Var1)
AND
GetFlag(GOB_Orpheus_Event_TransferBoxToCharacter_1dfabd27-de06-44f3-98df-3c492d550933, _Var3, 1, _Var1, _Var1)
THEN
ClearFlag(GOB_Orpheus_Event_TransferBoxToCharacter_1dfabd27-de06-44f3-98df-3c492d550933, _Var3, _Var2);

IF
TextEvent("GOB_Orpheus_State_HadVoiceOfAbsoluteEvent", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(GOB_Orpheus_State_HadVoiceOfAbsoluteEvent_9546407d-19e3-4f26-88af-5970896997d7);

IF
TextEvent("GOB_Orpheus_State_HadVoiceOfAbsoluteEvent", _, _, _, _)
AND NOT
DB_GlobalFlag(GLO_InfernalBox_State_TeamHasBox_d8b25e35-ec84-45e5-8395-5ce6faa36fbd, _, _, _, _)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GLO_InfernalBox_Event_ForceGiveBox_7addbb64-502f-48aa-9b71-da1b8d6c28eb, _Var1);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
