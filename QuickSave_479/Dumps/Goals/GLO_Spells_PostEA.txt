Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_GLO_Spells_WildMagic_FlumphTemplate(Flumph_Wildmagic_0e40a847-a275-4eea-95d7-dd6bad6643ca);
DB_GLO_Spells_Portent_Statuses("PORTENT_1");
DB_GLO_Spells_Portent_Statuses("PORTENT_2");
DB_GLO_Spells_Portent_Statuses("PORTENT_3");
DB_GLO_Spells_Portent_Statuses("PORTENT_4");
DB_GLO_Spells_Portent_Statuses("PORTENT_5");
DB_GLO_Spells_Portent_Statuses("PORTENT_6");
DB_GLO_Spells_Portent_Statuses("PORTENT_7");
DB_GLO_Spells_Portent_Statuses("PORTENT_8");
DB_GLO_Spells_Portent_Statuses("PORTENT_9");
DB_GLO_Spells_Portent_Statuses("PORTENT_10");
DB_GLO_Spells_Portent_Statuses("PORTENT_11");
DB_GLO_Spells_Portent_Statuses("PORTENT_12");
DB_GLO_Spells_Portent_Statuses("PORTENT_13");
DB_GLO_Spells_Portent_Statuses("PORTENT_14");
DB_GLO_Spells_Portent_Statuses("PORTENT_15");
DB_GLO_Spells_Portent_Statuses("PORTENT_16");
DB_GLO_Spells_Portent_Statuses("PORTENT_17");
DB_GLO_Spells_Portent_Statuses("PORTENT_18");
DB_GLO_Spells_Portent_Statuses("PORTENT_19");
DB_GLO_Spells_Portent_Statuses("PORTENT_20");
DB_GLO_Spells_Portent_Statuses_PickCandidate("");
NOT DB_GLO_Spells_Portent_Statuses_PickCandidate("");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_ACID");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_BLUDGEONING");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_COLD");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_FIRE");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_FORCE");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_LIGHTNING");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_NECROTIC");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_PIERCING");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_POISON");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_PSYCHIC");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_RADIANT");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_SLASHING");
DB_GLO_Spells_Portent_Challenges("DIVINATION_DAMAGE_THUNDER");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_ABJURATION");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_CONJURATION");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_DIVINATION");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_ENCHANTMENT");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_EVOCATION");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_ILLUSION");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_NECROMANCY");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCHOOL_TRANSMUTATION");
DB_GLO_Spells_Portent_Challenges("DIVINATION_SCROLL_LEARN");
DB_GLO_Spells_Portent_Challenges("DIVINATION_ALLY_HELP");
DB_GLO_Spells_Portent_Challenges("DIVINATION_ENEMY_KILLED");
DB_GLO_Spells_Portent_Challenges_PickCandidate("");
NOT DB_GLO_Spells_Portent_Challenges_PickCandidate("");
DB_GLO_Spells_Portent_Statuses_Characters(00000000-0000-0000-0000-000000000000, 0, 0);
NOT DB_GLO_Spells_Portent_Statuses_Characters(00000000-0000-0000-0000-000000000000, 0, 0);
DB_GLO_Spells_Portent_Challenges_Characters(00000000-0000-0000-0000-000000000000, 0);
NOT DB_GLO_Spells_Portent_Challenges_Characters(00000000-0000-0000-0000-000000000000, 0);
DB_GLO_Spells_AnimateDead_Triggers("SCL_Main_A", S_COL_AnimateDeadTrigger_01_45066fbf-e06a-4d26-99e2-42283d528db2, "ANIMATEDEAD_ZONE");
DB_GLO_Spells_AnimateDead_Triggers("SCL_Main_A", S_COL_AnimateDeadTrigger_02_e57dccfc-fd81-4122-88f1-966848f324c9, "ANIMATEDEAD_ZONE");
DB_GLO_Spells_AnimateDead_Triggers("SCL_Main_A", S_SHA_AnimateDeadTrigger_01_3975a31c-7d3d-4ad4-8d47-37cae3cf9de3, "BONE_ZONE");
DB_GLO_Spells_TimedExplosives(LOOT_Throwable_Spell_FrozenOrb_e4478067-bd82-4586-a68f-e03a087a494c, "FREEZING_ORB_TIMER", 60, 1);
NOT DB_GLO_Spells_TimedExplosives_Delayed("", 0);
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_CIRCLET_OF_MYRKUL_MAGIC_ITEM", "MAG_CIRCLET_OF_MYRKUL_SUMMON");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_SPIRITUAL_WEAPON_MAGIC_ITEM", "MAG_SPIRITUAL_WEAPON");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_SPIRITUAL_WEAPON_MAGIC_ITEM", "MAG_SPIRITUAL_WEAPON_4");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_SPIRITUAL_WEAPON_MAGIC_ITEM", "MAG_SPIRITUAL_WEAPON_6");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_CREATE_UNDEAD_MAGIC_ITEM", "MAG_CREATE_UNDEAD");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_SHADOW_SUMMON_MAGIC_ITEM", "MAG_SHADOW_SUMMON");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_CAMBION_SUMMON_MAGIC_ITEM", "MAG_CAMBION_SUMMON");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_DJINNI_MAGE_HAND_MAGIC_ITEM", "MAG_DJINNI_MAGE_HAND");
DB_GLO_GlobalItems_SummoningMagicItems_Statuses("MAG_FIND_FAMILIAR_RAVEN_MAGIC_ITEM", "MAG_FIND_FAMILIAR_RAVEN");
DB_GLO_BlockGameOver_Statuses("DEATH_WARD_DOWNED");
DB_GLO_BlockGameOver_Statuses("RELENTLESS_ENDURANCE_DOWNED");
DB_GLO_BlockGameOver_Statuses("RELENTLESS_RAGE_DOWNED");
DB_GLO_BlockGameOver_Statuses("SURVIVAL_INSTINCT_DOWNED");
DB_GLO_BlockGameOver_Statuses("MAG_1HP");
DB_GLO_BlockGameOver_Statuses("POTION_OF_UNDYING_DOWNED");
DB_GLO_BlockGameOver_Statuses("MAG_DEATH_DO_SHADOW_POSSESION_DOWNED");
DB_GLO_BlockGameOver_Statuses("MAG_LATHANDERS_BLESSING_RESURRECT_RESOURCE");
DB_GLO_BlockGameOver_Statuses("MAG_LATHANDERS_BLESSING_RESURRECT_TECHNICAL");

KBSECTION
IF
StatusApplied((CHARACTER)_Var1, "DOMINATE_BEAST", (CHARACTER)_Var2, _, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsPartyFollower(_Var2, 1, _Var1, _Var1, _Var1)
AND
CharacterGetOwner(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_Spell_DominateBeast_AddToParty(_Var1, _Var4, _Var2);

IF
StatusApplied((CHARACTER)_Var1, "DOMINATE_BEAST", (CHARACTER)_Var2, _, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsPartyFollower(_Var2, 0, _Var1, _Var1, _Var1)
THEN
PROC_Spell_DominateBeast_AddToParty(_Var1, _Var2, _Var2);

PROC
PROC_Spell_DominateBeast_AddToParty((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Spell_DominateBeastFollower(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
DB_Spell_DominateBeastFollower(_Var1, _Var2, _Var3);
AddPartyFollower(_Var1, _Var2);
SetEntityEvent(_Var1, "SetPeaceReturnFromStory");

IF
StatusRemoved((CHARACTER)_Var1, "DOMINATE_BEAST", _, _, (CHARACTER)_Var1)
AND
DB_Spell_DominateBeastFollower(_Var1, _Var4, _Var5, _Var1, _Var1)
THEN
NOT DB_Spell_DominateBeastFollower(_Var1, _Var4, _Var5);
RemovePartyFollower(_Var1, _Var4);

IF
CharacterLeftParty((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Spell_DominateBeastFollower(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
RemovePartyFollower(_Var2, _Var3);

IF
CharacterJoinedParty((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Spell_DominateBeastFollower(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
AddPartyFollower(_Var2, _Var3);

IF
StatusApplied((CHARACTER)_Var1, "BLINK_VANISH", _, _, (CHARACTER)_Var1)
AND
IsCharacter(_Var1, 1, _Var1, _Var1, _Var1)
THEN
SetDetached(_Var1, 1);

IF
StatusRemoved((CHARACTER)_Var1, "BLINK_VANISH", _, _, (CHARACTER)_Var1)
AND
IsCharacter(_Var1, 1, _Var1, _Var1, _Var1)
THEN
SetDetached(_Var1, 0);

IF
StatusAttempt((CHARACTER)_Var1, "FLUMPH_EXPLODE", (GUIDSTRING)_Var2, _, (CHARACTER)_Var1)
AND
GetTemplate(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_WildMagic_FlumphTemplate(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_Spells_WildMagic_Flumph(_Var1);

IF
UsingSpellOnTarget(_, (CHARACTER)_Var2, _, _, _, _, _, _, _, _)
AND
DB_GLO_Spells_WildMagic_Flumph(_Var2, _, _, _, _)
THEN
RemoveStatus(_Var2, "FLUMPH_EXPLODE", _Var2);

IF
StatusRemoved((CHARACTER)_Var1, "FLUMPH_EXPLODE", _, _, (CHARACTER)_Var1)
AND
DB_GLO_Spells_WildMagic_Flumph(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, _Var1, 0, 0, 0);

PROC
PROC_StateSet_PermaDefeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_WildMagic_Flumph(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);
NOT DB_GLO_Spells_WildMagic_Flumph(_Var1);

IF
TemplateAddedTo((ROOT)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, _, (ROOT)_Var1)
AND
DB_GLO_Spells_TimedExplosives(_Var1, _Var5, _Var6, 1, _Var1)
AND
HasActiveStatus(_Var2, _Var5, 0, _Var1, _Var1)
THEN
ApplyStatus(_Var2, _Var5, _Var6, 1, _Var3);

IF
StatusApplied((ITEM)_Var1, (STRING)_Var2, (GUIDSTRING)_Var3, _, (ITEM)_Var1)
AND NOT
DB_GLO_Spells_TimedExplosives_Explosive(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_TimedExplosives(_, _Var2, _, _, _Var1)
THEN
DB_GLO_Spells_TimedExplosives_Explosive(_Var1, _Var3);

IF
DB_GLO_Spells_TimedExplosives_Explosive(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var2, _Var1, "SetGrenadeCaster", 1);

IF
DestroyingBy((ITEM)_Var1, _, _, _, (ITEM)_Var1)
AND
DB_GLO_Spells_TimedExplosives_Explosive(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Spells_TriggerTimedExplosive(_Var1, "");

IF
StatusRemoved((ITEM)_Var1, (STRING)_Var2, (GUIDSTRING)_Var3, _, (ITEM)_Var1)
AND
DB_GLO_Spells_TimedExplosives(_, _Var2, _, _, _Var1)
THEN
PROC_GLO_Spells_TriggerTimedExplosive(_Var1, _Var2);

PROC
PROC_GLO_Spells_TriggerTimedExplosive((ITEM)_Var1, (STRING)_Var2, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_GLO_Spells_TimedExplosives_Delayed(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(_Var1, _Var3, 1, _Var1, _Var1)
THEN
RealtimeObjectTimerLaunch(_Var1, "TriggerExplosive", _Var4);

IF
ObjectTimerFinished((ITEM)_Var1, "TriggerExplosive", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
THEN
PROC_GLO_Spells_TriggerTimedExplosive_Internal(_Var1);

PROC
PROC_GLO_Spells_TriggerTimedExplosive((ITEM)_Var1, (STRING)_Var2, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND NOT
QRY_GLO_Spells_TimedExplosiveHasDelayStatus(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Spells_TriggerTimedExplosive_Internal(_Var1);

QRY
QRY_GLO_Spells_TimedExplosiveHasDelayStatus((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_GLO_Spells_TimedExplosives_Delayed(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(_Var1, _Var2, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_GLO_Spells_TriggerTimedExplosive_Internal((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_GLO_Spells_TimedExplosives_Explosive(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_TimedExplosives_Explosive(_Var1, _Var2);

PROC
PROC_GLO_Spells_TriggerTimedExplosive_Internal((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
IsInInventory(_Var1, 0, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(NULL_00000000-0000-0000-0000-000000000000, _Var1, "ExplodeGrenade", 1);

PROC
PROC_GLO_Spells_TriggerTimedExplosive_Internal((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
IsInInventory(_Var1, 1, _Var1, _Var1, _Var1)
AND
GetInventoryOwner(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var2, _Var1, "ExplodeGrenade", 1);

IF
UseFinished((CHARACTER)_Var1, (ITEM)_Var2, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var2, "SCRATCH_AURA", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var2, "SCRATCH_AURA");

IF
StatusApplied((GUIDSTRING)_Var1, "CRAWLING_GNAW_SWITCH", (GUIDSTRING)_Var2, _, (GUIDSTRING)_Var1)
AND
QRY_GetSummonOwner(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_GetSummonOwner(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_Spells_AnimateDead_Infected(_Var1, _Var4);

IF
StatusApplied((GUIDSTRING)_Var1, "CRAWLING_GNAW_TECHNICAL", _, _, (GUIDSTRING)_Var1)
AND
DB_GLO_Spells_AnimateDead_Infected(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
GetPosition(_Var1, _Var5, _Var6, _Var7, _Var1)
AND NOT
DB_GLO_Spells_AnimateDead(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
CreateAt(Undead_Zombie_Melee_AnimateDead_Swarm_82d6ff04-db9d-4b02-82aa-fd4db21f5b7d, _Var5, _Var6, _Var7, 1, 1, "GLO_Spells_AnimateDead_Summon", _Var8, _Var1, _Var1)
THEN
DB_GLO_Spells_AnimateDead(_Var8, _Var4);
NOT DB_GLO_Spells_AnimateDead_Infected(_Var1, _Var4);

IF
EntityEvent((CHARACTER)_Var1, "GLO_Spells_AnimateDead_Summon", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_AnimateDead(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetFaction(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
AddPartyFollower(_Var1, _Var2);
SetFaction(_Var1, _Var3);

IF
Dying((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyFollowers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_AnimateDead(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
RemovePartyFollower(_Var1, _Var2);

IF
Died((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_AnimateDead(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_AnimateDead(_Var1, _Var2);
RequestDeleteTemporary(_Var1);

QRY
QRY_CrimeCharacterBlockCreateMurder((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_AnimateDead(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TemplateUseStarted((CHARACTER)_Var1, _, (ITEM)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsTagged(_Var3, SCROLL_dd86c045-0370-4ec9-b7c5-b0b160706f09, 1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "DIVINATION_SCROLL_LEARN", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "DIVINATION_SCROLL_LEARN", _Var1);
ApplyStatus(_Var1, "PORTENT", 6, 1, _Var1);

PROC
PROC_GLO_Spells_Portent_Statuses_Pick((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_DoNTimes(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRY_RTN_DoNTimes(_, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GetRandom("DB_GLO_Spells_Portent_Statuses", 1, "DB_GLO_Spells_Portent_Statuses_PickCandidate", _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Statuses_PickCandidate(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_Spells_Portent_Statuses_Picked(_Var3);
NOT DB_GLO_Spells_Portent_Statuses_PickCandidate(_Var3);
NOT DB_GLO_Spells_Portent_Statuses(_Var3);

PROC
PROC_GLO_Spells_Portent_Statuses_Apply((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses_Picked(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, _Var2, -1, 1, _Var1);
DB_GLO_Spells_Portent_Statuses(_Var2);
NOT DB_GLO_Spells_Portent_Statuses_Picked(_Var2);

PROC
PROC_GLO_Spells_Portent_FillPortent((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
IntegerSubtract(_Var2, _Var3, _Var4, _Var1, _Var1)
THEN
PROC_GLO_Spells_Portent_Statuses_Pick(_Var4);
PROC_GLO_Spells_Portent_Statuses_Apply(_Var1);

PROC
PROC_GLO_Spells_Portent_Clear((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, _Var2, _Var1);

IF
LongRestFinished()
AND
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var2);
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, 0);

IF
LongRestFinished()
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var2, _Var3);
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var2, 0);
PROC_GLO_Spells_Portent_FillPortent(_Var1);

IF
LeveledUp((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ObjectTimerLaunch(_Var1, "Portent_Timer", 200, 0);

IF
ObjectTimerFinished((CHARACTER)_Var1, "Portent_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
HasPassive(_Var1, "Portent", 0, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var2, _Var3);
PROC_GLO_Spells_Portent_Clear(_Var1);

IF
ObjectTimerFinished((CHARACTER)_Var1, "Portent_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _, _, _Var1, _Var1)
AND
HasPassive(_Var1, "Portent", 1, _Var1, _Var1)
AND
HasPassive(_Var1, "ExpertDivination", 0, _Var1, _Var1)
THEN
PROC_GLO_Spells_Portent_Clear(_Var1);
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, 2, 0);
PROC_GLO_Spells_Portent_FillPortent(_Var1);

IF
ObjectTimerFinished((CHARACTER)_Var1, "Portent_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, 2, _Var2, _Var1, _Var1)
AND
HasPassive(_Var1, "Portent", 1, _Var1, _Var1)
AND
HasPassive(_Var1, "ExpertDivination", 1, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Statuses_Characters(_Var1, 2, _Var2);
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, 3, _Var2);
PROC_GLO_Spells_Portent_Statuses_Pick(1);
PROC_GLO_Spells_Portent_Statuses_Apply(_Var1);

IF
ObjectTimerFinished((CHARACTER)_Var1, "Portent_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _, _, _Var1, _Var1)
AND
HasPassive(_Var1, "Portent", 1, _Var1, _Var1)
AND
HasPassive(_Var1, "ExpertDivination", 1, _Var1, _Var1)
THEN
PROC_GLO_Spells_Portent_Clear(_Var1);
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, 3, 0);
PROC_GLO_Spells_Portent_FillPortent(_Var1);

IF
StatusApplied((CHARACTER)_Var1, "PORTENT", _, _, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var4, _Var5, _Var1, _Var1)
AND
_Var4 != _Var5
THEN
PROC_GLO_Spells_Portent_Statuses_Pick(1);
PROC_GLO_Spells_Portent_Statuses_Apply(_Var1);

IF
StatusApplied((CHARACTER)_Var1, (STRING)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var5, _Var6, _Var1, _Var1)
AND
IntegerSum(_Var6, 1, _Var7, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var5, _Var6);
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var5, _Var7);

IF
StatusRemoved((CHARACTER)_Var1, (STRING)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Statuses(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var5, _Var6, _Var1, _Var1)
AND
IntegerSubtract(_Var6, 1, _Var7, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var5, _Var6);
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var5, _Var7);

IF
StatusApplied((CHARACTER)_Var1, (STRING)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Challenges(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var5, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var5, 1, _Var6, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var5);
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var6);

IF
StatusApplied((CHARACTER)_Var1, (STRING)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Challenges(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, 1);

IF
StatusRemoved((CHARACTER)_Var1, (STRING)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Challenges(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var5, _Var1, _Var1, _Var1)
AND
IntegerSubtract(_Var5, 1, _Var6, _Var1, _Var1)
THEN
NOT DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var5);
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var6);

PROC
PROC_GLO_Spells_Portent_Challenges_Pick((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_DoNTimes(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRY_RTN_DoNTimes(_, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GetRandom("DB_GLO_Spells_Portent_Challenges", 1, "DB_GLO_Spells_Portent_Challenges_PickCandidate", _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Challenges_PickCandidate(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_Spells_Portent_Challenges_Picked(_Var3);
NOT DB_GLO_Spells_Portent_Challenges_PickCandidate(_Var3);
NOT DB_GLO_Spells_Portent_Challenges(_Var3);

PROC
PROC_GLO_Spells_Portent_Challenges_Apply((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Spells_Portent_Challenges_Picked(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, _Var2, -1, 1, _Var1);
DB_GLO_Spells_Portent_Challenges(_Var2);
NOT DB_GLO_Spells_Portent_Challenges_Picked(_Var2);

IF
ShortRested((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
HasPassive(_Var1, "ExpertDivination", 1, _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var3, _Var4, _Var1, _Var1)
AND
IntegerSubtract(_Var3, _Var4, _Var5, _Var1, _Var1)
AND
IntegerSubtract(_Var5, _Var2, _Var6, _Var1, _Var1)
THEN
PROC_GLO_Spells_Portent_Challenges_Pick(_Var6);
PROC_GLO_Spells_Portent_Challenges_Apply(_Var1);

IF
ShortRested((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
HasPassive(_Var1, "ExpertDivination", 1, _Var1, _Var1)
AND NOT
DB_GLO_Spells_Portent_Challenges_Characters(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_Portent_Statuses_Characters(_Var1, _Var3, _Var4, _Var1, _Var1)
AND
IntegerSubtract(_Var3, _Var4, _Var5, _Var1, _Var1)
THEN
PROC_GLO_Spells_Portent_Challenges_Pick(_Var5);
PROC_GLO_Spells_Portent_Challenges_Apply(_Var1);

PROC
PROC_LevelLoadedOnce((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_GLO_Spells_AnimateDead_Triggers(_Var1, _Var2, _, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(_Var2);

IF
EnteredTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Spells_AnimateDead_Triggers(_, _Var2, _Var4, _Var1, _Var1)
THEN
ApplyStatus(_Var1, _Var4, -1);

IF
LeftTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Spells_AnimateDead_Triggers(_, _Var2, _Var4, _Var1, _Var1)
THEN
RemoveStatus(_Var1, _Var4);

IF
EnteredLevel((GUIDSTRING)_Var1, PUZ_ArcaneGate_721dcc51-9733-463b-87c5-6afcda6fef65, (STRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_CurrentLevel(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
RealtimeObjectTimerLaunch(_Var1, "GLO_Spells_ArcaneGate_WaitForOwnerToGetSet", 0);

IF
ObjectTimerFinished((ITEM)_Var1, "GLO_Spells_ArcaneGate_WaitForOwnerToGetSet", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
GetOwner(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
DB_GLO_Spells_SpawningArcaneGate(_Var1, _Var2);

IF
DB_GLO_Spells_SpawningArcaneGate(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GLO_Spells_SpawningArcaneGate(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
_Var1 != _Var3
AND
GetPosition(_Var1, _Var4, _Var5, _Var6, _Var1)
AND
GetPosition(_Var3, _Var7, _Var8, _Var9, _Var1)
AND
GetAngleXToDirection(_Var4, _Var6, _Var7, _Var9, _Var10)
AND
GetAngleXToDirection(_Var7, _Var9, _Var4, _Var6, _Var11)
AND
IntegerSubtract(270, _Var10, _Var12, _Var1, _Var1)
AND
IntegerSubtract(270, _Var11, _Var13, _Var1, _Var1)
AND
IntegerModulo(_Var12, 360, _Var14, _Var1, _Var1)
AND
IntegerModulo(_Var13, 360, _Var15, _Var1, _Var1)
AND
IntegerToReal(_Var14, _Var16, _Var1, _Var1, _Var1)
AND
IntegerToReal(_Var15, _Var17, _Var1, _Var1, _Var1)
THEN
SetTeleportTargetOverride(_Var1, _Var3);
SetTeleportTargetOverride(_Var3, _Var1);
ItemRotateYToAngle(_Var1, _Var16, 100000);
ItemRotateYToAngle(_Var3, _Var17, 100000);
NOT DB_GLO_Spells_SpawningArcaneGate(_Var1, _Var2);
NOT DB_GLO_Spells_SpawningArcaneGate(_Var3, _Var2);

IF
Unequipped((ITEM)_Var1, (CHARACTER)_Var2, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_GLO_GlobalItems_SummoningMagicItems_Statuses(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, _Var3, 1, _Var1, _Var1)
AND
DB_PlayerSummons(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var5, _Var4, 1, _Var1, _Var1)
AND
CharacterGetOwner(_Var5, _Var2, _Var1, _Var1, _Var1)
THEN
Die(_Var5, 0, _Var5, 0, 0);

QRY
QRY_GameOver_BlockGameOver()
AND
DB_Downed(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_BlockGameOver_Statuses(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, _Var2, 1, _Var1, _Var1)
THEN
DB_NOOP(1);


EXITSECTION
ENDEXITSECTION

