Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_ItemOwnershipTriggers("CTY_Main_A", S_LOW_OwnershipTolnaTrigger_65e883e0-57c8-4121-9735-bb17beedb48a, S_LOW_Tolna_46aa02d8-28e9-4ebb-876c-82fe29262d35);
DB_ItemShopTrigger(S_LOW_OwnershipTolnaTrigger_65e883e0-57c8-4121-9735-bb17beedb48a, S_LOW_Tolna_46aa02d8-28e9-4ebb-876c-82fe29262d35);
DB_GLO_DefeatCounter(S_LOW_CurriculumStrategy_Fake_4644d414-71bc-4929-9072-dcf641b68694, "LOW_SorcerousSundries_ReplacedTolnaBooks");
DB_GLO_DefeatCounter(S_LOW_SightOfTheSeelie_Fake_302c13d4-f07f-45a3-a20a-fcfcb7d0aa8b, "LOW_SorcerousSundries_ReplacedTolnaBooks");
DB_GLO_DefeatCounter(S_UNI_TharchiateCypher_Fake_fc410088-46a8-4c47-93d8-4aa28736a063, "LOW_SorcerousSundries_ReplacedTolnaBooks");
DB_GLO_DefeatCounter_AllPermaDefeatedGlobalFlag("LOW_SorcerousSundries_ReplacedTolnaBooks", LOW_Tolna_State_AllCursedBooksRemoved_8cdfb6db-47f4-409d-b4bb-36974f861ddd);
DB_DialogBlockAttackButton(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c);
PROC_LOW_SorcerousSundries_AradinSetup(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
PROC_LOW_SorcerousSundries_NightsongSetup(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_LOW_SorcerousSundries_RolanSetup(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_DangerZone(S_FOR_DangerousBook_SorcSundriesBasementTrigger_a4fc3ecc-3e6e-4a02-b0e8-2b629911122e, "LOW_SorcerousSundries_Basement");
DB_DoNotRemoveKnockedOutCharacterOnLongRest(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9);
DB_LOW_SorcerousSundries_ClerkCheckpointWarningDialogues(LOW_SorcerousSundries_RolanWarning_d8fcff57-2afa-06c0-5e21-36c77107c6be, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_LOW_SorcerousSundries_ClerkCheckpointWarningDialogues(LOW_SorcerousSundries_RolanProjectionWarning_859aa6d4-4fc1-398d-0131-91a63940345d, S_LOW_RolanProjection_c6a47d05-5051-42de-86b0-776fe0285cd1);
DB_LOW_SorcerousSundries_ClerkCheckpointWarningDialogues(LOW_SorcerousSundries_LorroakanProjectionWarning_91430540-4848-ce3d-61a7-a0c8c3dbaa6c, S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
DB_LOW_SorcerousSundries_TolnaExplosionLocations(S_LOW_SorcerousSundries_BookExplosionTrigger_001_d88bf575-db3c-4fae-bc77-76b60595a500);
DB_LOW_SorcerousSundries_TolnaExplosionLocations(S_LOW_SorcerousSundries_BookExplosionTrigger_000_bc275e0f-447a-4bc9-b46e-92870d4bee97);
DB_GlobalFlagReactionAfterDialog(LOW_Nightsong_Event_GoToRamazithTower_59fab159-060f-424c-9fd9-43cc00a88db9, CAMP_Nightsong_60070e0f-0ab6-f653-7962-c2fff93b5a2d);
DB_GlobalFlagReactionAfterDialog(LOW_Nightsong_Event_GoToRamazithTower_59fab159-060f-424c-9fd9-43cc00a88db9, LOW_SorcerousSundries_NightsongPostAttack_42a7f9de-9883-9a29-20c0-721271188f18);
DB_GlobalFlagReactionAfterDialog(LOW_Nightsong_Event_GoToRamazithTower_59fab159-060f-424c-9fd9-43cc00a88db9, LOW_SorcerousSundries_NightsongCamp_8a4dce9f-f256-fdfc-7ce4-28ece903328d);
DB_GlobalFlagReactionAfterDialog(LOW_Aradin_Event_LeaveSorcerousSundries_9b859898-5d65-4cfb-8b0b-fa3c93f9c752, LOW_SorcerousSundries_Aradin_f25cbd18-f09a-4dc2-414c-6762d60a3a86);
DB_LOW_SorcerousSundries_ShopArmors(S_LOW_ShopAnimatedArmor_005_d42295ab-7169-4bba-9a7c-8124196caea7);
DB_LOW_SorcerousSundries_ShopArmors(S_LOW_ShopAnimatedArmor_002_4b741aa9-c2af-4196-a8fd-7bc9a8f5cd5d);
DB_LOW_SorcerousSundries_ShopArmors(S_LOW_ShopAnimatedArmor_004_9752ca37-cc97-42fc-b7d0-a0f0a8b1dfd3);
DB_LOW_SorcerousSundries_ShopArmors(S_LOW_ShopAnimatedArmor_003_e57cc258-8f98-45d0-b6dc-063e945ce086);
DB_LOW_SorcerousSundries_ShopArmors(S_LOW_ShopAnimatedArmor_001_50e39747-fa44-4d2a-8427-186d2f9a5d1c);
DB_PreventPermaDefeated(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7);
PROC_CharacterDisableAllCrimes(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
PROC_TriggerRegisterForPlayers(S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3);
DB_AddCharactersInTriggerToDialog(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, 1, 1, 1, 1);
DB_Dialogs(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, S_LOW_LorroakanButler_637bb24f-66b7-4447-807b-556bd1c00ed6, S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db, LOW_SorcerousSundries_Lorroakan_b206fd7c-7992-6d5f-51f4-0943a92f3d48);
DB_GLO_CharacterCorpseDialog(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, LOW_SorcerousSundries_Lorroakan_Dead_7b5595c0-aa22-93a1-6ff9-e386dbaadacc);
DB_DropMutingStatussesDialog(LOW_SorcerousSundries_Lorroakan_b206fd7c-7992-6d5f-51f4-0943a92f3d48);
DB_DropMutingStatussesDialog(LOW_SorcerousSundries_NightsongSmash_ca824374-abdf-7094-9b35-2578466eb7b8);
Open(S_LOW_SorcerousSundries_Door_599e0543-c81b-461b-8807-8213b88c6c1c);
PROC_SetOnStage(LOW_SorcerousSundries_LorroakanSoulCage_33fab5d8-f1e3-45ad-8f62-1247f7eadd37, 0);
PROC_SetOnStage(S_LOW_SorcerousSundries_IsobelThreat_807ee341-d395-43a8-9cbd-8d2eef9026da, 0);
ApplyStatus(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, "LOW_SORCEROUSSUNDRIES_ANIMATEDARMOR_KLANK", -1);
ApplyStatus(S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db, "LOW_SORCEROUSSUNDRIES_ANIMATEDARMOR_KLANK", -1);
TriggerRegisterForCharacter(S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
TriggerRegisterForCharacter(S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9);
TriggerRegisterForCharacter(S_LOW_AradinStayAreaTrigger_ddc16aed-a2d2-473b-aa9f-fafb647bf4a4, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_NoLowAttitudeDialog(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7);
PROC_TriggerRegisterForPlayers(S_LOW_EnterSorcerousTrigger_7c408b4f-8d02-43d5-9f7b-a3898afe2bf0);
PROC_TriggerRegisterForPlayers(S_LOW_IllusionTrigger_27b7a6e4-9869-4aab-b28a-0d007d987a66);
DB_LOW_KarsusTomeADGaleTriggerSetup(1);
PROC_TriggerRegisterForPlayers(S_LOW_SorcerousCheckpoint_ClerkSpotTrigger_21b5350e-7827-4894-a2d2-0d71849d2a4e);
PROC_TriggerRegisterForPlayers(S_LOW_SorcerousCheckpoint_PrimaryTrigger_1181722d-3b04-4ebc-be3c-9e9059ba451c);
DB_DeadEvent(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, LOW_Rolan_State_IsDead_47b8a371-e4a9-40e6-bc0f-18ac582142b9);
DB_DeadEvent(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, LOW_Lorroakan_State_IsDead_7bc03119-8aaa-458d-b795-fd2e2523d3b8);
DB_PermaDefeatedEvent(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098);
DB_GLO_CharacterCorpseDialog(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, LOW_SorcerousSundries_Lorroakan_Dead_7b5595c0-aa22-93a1-6ff9-e386dbaadacc);
DB_CrimeAttitudeChange("LOW_SorcerousSundries_DispelArmor", -15);
DB_Dialogs(S_LOW_LavaElemental_1dea794e-2657-4c54-916b-edc639c4ff8c, LOW_SorcerousSundries_Elemental_df026427-841d-a340-8082-05df7840bb9c);
DB_Dialogs(S_LOW_WaterElemental_4cb61416-f095-4fbb-aece-51f37b6bb4d6, LOW_SorcerousSundries_WaterElemental_1ba0373b-da31-afff-f6f6-f99791bffc0a);
DB_LOW_SorcerousSundries_NSAndIsobelLeaveCampPos("SLUMS", S_LOW_SlumsPosition_NightsongLeave_0d373811-b182-40da-9763-defdf9a1997c);
DB_LOW_SorcerousSundries_NSAndIsobelLeaveCampPos("ELFSONG", S_LOW_NightsongLeaveCampPos_385051cc-92b6-4dcf-af63-3f0d84906849);
DB_LOW_SorcerousSundries_NSAndIsobelLeaveCampPos("FARM", S_LOW_SorcerousSundries_Farm_NightsongLeaveCampPos_7099c20c-2710-4575-9f32-d4780dfe5965);
DB_GlobalFlagReactionAfterDialog(LOW_SorcerousSundries_Event_NSAndIsobelLeaveCamp_64a6e5df-b6a0-42ab-93b6-818bc4e2859a, LOW_SorcerousSundries_NightsongAndIsobelCampAfterFight_5c788540-1b65-2b31-8814-450e72458314);
DB_GlobalFlagReactionAfterDialog(LOW_SorcerousSundries_Event_NSAndIsobelLeaveCamp_64a6e5df-b6a0-42ab-93b6-818bc4e2859a, CAMP_Nightsong_60070e0f-0ab6-f653-7962-c2fff93b5a2d);
DB_LOW_SorcerousSundris_NSAndIsobel(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_LOW_SorcerousSundris_NSAndIsobel(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_Dialogs(S_LOW_Client_000_7d85aa52-0d27-4389-a5c9-9bc329fd7376, LOW_SorcerousSundries_Client000_b9f1a9fa-debf-ae31-e8cd-1eec5ee3f12b);
DB_Dialogs(S_LOW_Client_001_9504e91f-b535-411b-ac3b-b4047150f93f, LOW_SorcerousSundries_Client001_ae46d6fb-6fd3-8844-1fa3-74ba9eccff28);
DB_Dialogs(S_LOW_Client_002_91a348f4-a6a4-423d-8f3c-c48ceeb7383d, LOW_SorcerousSundries_Client002_093122d8-1465-1faa-37fc-00cb34a13eb1);
DB_Dialogs(S_LOW_Client_003_8d2f44b7-7fa1-4586-a2c8-c49f730a3f2b, LOW_SorcerousSundries_Client003_04f5fcd5-1f40-5cd3-691b-525a7817f789);
DB_Dialogs(S_LOW_Client_007_9e4e8404-4f2e-43ed-8bc5-f83c40127900, LOW_SorcerousSundries_Client007_18590482-3a04-dd8d-2341-13ca54939c0a);
DB_Dialogs(S_LOW_Client_004_e3fa81d4-53f3-49ad-8497-18673d399a37, LOW_SorcerousSundries_Client004_e98d8904-03d9-8acb-9729-98b0ea5a983c);
DB_Dialogs(S_LOW_Client_005_bf5f19cd-638f-4011-ae3d-45007163c637, LOW_SorcerousSundries_Client005_d2bdcee8-b9d5-ca2a-d8bf-700d37381bdb);
DB_Dialogs(S_LOW_Client_006_d3239308-d0d6-49dd-a3b9-39605f5b57e9, LOW_SorcerousSundries_Client006_798f365d-a7dc-3765-b4ab-21ce1702a55f);
DB_Dialogs(S_LOW_SorcerousSundries_Necromancer_ba40224c-9113-4a18-b30b-a1a77e88f9d2, LOW_SorcerousSundries_NecromancerVendor_e1d83981-a4d1-53c8-98cb-0db6a8154328);
DB_Dialogs(S_LOW_NecromancyBuyer_d33d47b9-299e-4be3-8867-eaf53b200b46, LOW_SorcerousSundries_NecromancyBuyer_d05f0780-38a6-642e-5743-15289461b407);
DB_OneShotPlayerTrigger(S_LOW_GaleCheckTrigger_41cf8357-fd36-4cd6-b28f-0bd321d27c3f);
PROC_TriggerRegisterForParty(S_LOW_EntryRamazithTrigger_b3f97f64-d3d7-4f2b-9df8-87fd3767e532);
PROC_TriggerRegisterForParty(S_LOW_NecromanticVendorTrigger_9ea2b581-5104-4848-933d-7bff203e81a2);
DB_LOW_SorcerousSundries_NSNotices(S_LOW_NightsongPamphlet_000_40ad72cb-ae54-4b45-a4ce-d9c85d61611d);
DB_LOW_SorcerousSundries_NSNotices(S_LOW_NightsongPamphlet_001_ff7fa76b-a555-4c37-a32a-e4834153a6cf);
DB_LOW_SorcerousSundries_NSNotices(S_LOW_NightsongPamphlet_002_8202b31a-1b30-4b4d-a457-fe47f1201a15);
DB_CampNight(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, 1050);
DB_CampNight_Requirement(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, LOW_Aradin_State_AttackingCamp_81f0d1a8-6f8e-4872-ad70-b657ff2c60fd);
DB_CampNight_SCO(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, CAMP_SCO_AradinAttack_cdc441b1-9530-da70-d479-6c572b0fc5ee);
DB_CampNight_Camp(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, "SLUMS");
DB_CampNight_Camp(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, "ELFSONG");
DB_CampNight_CancelledBy(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, LOW_SorcerousSundries_Event_CampAttackAverted_f3441499-0574-48b0-bf5c-56615ee2d07e);
DB_LOW_SorcerousSundries_AradinThugPositions(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_LOW_ElfsongPosition_AradinTeleportTo_eb99615a-7a9f-4a43-bdb1-7c36d057d989, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_LOW_SlumsPosition_AradinTeleportTo_74070c7e-a6ce-480e-b613-e92ad4798586, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug1_19a10473-cacd-47fe-a21d-0d9b1664b66a, S_LOW_ElfsongPosition_AradinThug1_e3620554-8907-4357-a890-e6ef23b0ae11, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug2_19a10473-cacd-47fe-a21d-0d9b1664b66a, S_LOW_ElfsongPosition_AradinThug2_e3620554-8907-4357-a890-e6ef23b0ae11, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug3_e16eb8e3-04e8-49ec-9400-b4868c587890, S_LOW_ElfsongPosition_AradinThug3_f568e8b9-94cc-4266-98d3-e47f36dd3092, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug4_d69d546c-a737-4f43-a940-d176e213b343, S_LOW_ElfsongPosition_AradinThug4_233a57c9-7d53-488e-804f-8c52b3385729, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug5_acb140f5-54bc-4e0a-b902-eaf4de39ec94, S_LOW_ElfsongPosition_AradinThug5_e8939e15-95a5-4a3d-bf33-265acd8bb812, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug6_9909dc5b-bf27-441d-a75d-b7099e1edf30, S_LOW_ElfsongPosition_AradinThug6_7c0cb8aa-6246-442a-92cb-42ca778efe10, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug7_5c9d1b7f-7c8a-4917-b5bc-26b3b07f5f0c, S_LOW_ElfsongPosition_AradinThug7_0e80561f-75c1-4955-923d-ad0d7acb3917, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug8_a91d7090-4d49-44c7-89da-f72ec29c8bf2, S_LOW_ElfsongPosition_AradinThug8_1675b8fa-3e86-4523-89ad-e4ef272a47b5, "ELFSONG");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug1_19a10473-cacd-47fe-a21d-0d9b1664b66a, S_LOW_SlumsPosition_AradinThug1_64e8bf81-1cb5-4c78-9465-8457d10a19e6, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug2_19a10473-cacd-47fe-a21d-0d9b1664b66a, S_LOW_SlumsPosition_AradinThug2_64e8bf81-1cb5-4c78-9465-8457d10a19e6, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug3_e16eb8e3-04e8-49ec-9400-b4868c587890, S_LOW_SlumsPosition_AradinThug3_eef8315f-9790-445a-b6a8-4ec114f326f4, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug4_d69d546c-a737-4f43-a940-d176e213b343, S_LOW_SlumsPosition_AradinThug4_db9bdac0-21e9-48f5-81e3-59037cce89e9, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug5_acb140f5-54bc-4e0a-b902-eaf4de39ec94, S_LOW_SlumsPosition_AradinThug5_5bc36b69-6c45-4e8a-a311-90ec043a1173, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug6_9909dc5b-bf27-441d-a75d-b7099e1edf30, S_LOW_SlumsPosition_AradinThug6_a9a4001f-4ff4-47dd-9569-fb51a95723b8, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug7_5c9d1b7f-7c8a-4917-b5bc-26b3b07f5f0c, S_LOW_SlumsPosition_AradinThug7_cad02f33-15c2-4b51-a001-4e6ca6fa0deb, "SLUMS");
DB_LOW_SorcerousSundries_AradinThugPositions(S_LOW_AradinThug8_a91d7090-4d49-44c7-89da-f72ec29c8bf2, S_LOW_SlumsPosition_AradinThug8_3530def3-c3f2-46d8-a0d7-b144a65426d4, "SLUMS");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_ElfsongPosition_AradinAttackPlayerPosition_002_23ef09a4-fd1a-477a-b664-9f161a269334, 2, "ELFSONG");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_ElfsongPosition_AradinAttackPlayerPosition_003_b14f5f26-24ea-4ca6-9a81-b4f81e63019d, 3, "ELFSONG");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_ElfsongPosition_AradinAttackPlayerPosition_004_e41f2227-6b35-46dd-ab40-fc93c385af83, 4, "ELFSONG");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_SlumsPosition_AradinAttackPlayerPosition_002_a35b08af-fca8-4c60-b19b-cf86256af17b, 2, "SLUMS");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_SlumsPosition_AradinAttackPlayerPosition_003_b45d903e-0d69-492e-97b7-4fc8c42bb189, 3, "SLUMS");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_SlumsPosition_AradinAttackPlayerPosition_004_38c1ca0b-b56b-4497-9b62-fd4d30ca8d77, 4, "SLUMS");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_SlumsPosition_AradinAttackPlayerPosition_001_e0aa298e-eb8c-4fac-aa64-735551fb3003, 1, "SLUMS");
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(S_LOW_ElfsongPosition_AradinAttackPlayerPosition_001_72fa3857-d560-4b40-82f3-e2afaa75ca81, 1, "ELFSONG");
DB_LOW_SorcerousSundries_AradinAttackNSPositions(S_LOW_ElfsongPosition_NightsongAttackPosition_f6f04024-371c-4cd2-8f1b-d0fd4c9cb0a3, "ELFSONG");
DB_LOW_SorcerousSundries_AradinAttackNSPositions(S_LOW_SlumsPosition_NightsongAttackPosition_e92e2591-a5c2-4871-879a-2e56357bb96e, "SLUMS");
DB_GLO_DefeatCounter(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "LOW_SorcerousSundries_AradinAttackers");
DB_GLO_DefeatCounter_AllPermaDefeatedGlobalFlag("LOW_SorcerousSundries_AradinAttackers", LOW_SorcerousSundries_CampAttackEnded_d7c61ab3-c0c3-4b78-95c6-0144209f40a4);
PROC_LOW_SorcerousSundries_InitThugs();
DB_LOW_SorcerousSundries_PuzzlePlaques(S_LOW_PlaqueArmy_32f301b2-9ed6-4ce2-9a66-7fb2b9bf146a);
DB_LOW_SorcerousSundries_PuzzlePlaques(S_LOW_PlaqueLove_4a1e7dfa-c915-4992-a70d-19faa93ac82d);
DB_LOW_SorcerousSundries_PuzzlePlaques(S_LOW_PlaqueWealth_5d9cfef0-6502-4653-8d77-94db60893ea9);
DB_LOW_SorcerousSundries_PuzzlePlaques(S_LOW_PlaqueImmortality_c606ff71-77c3-4131-8333-e16505f2e58d);
PROC_SetOnStage(S_LOW_LorroakanProjection_PuzzleGuardian_c65a2e91-34f1-4dd9-a784-2aca5a4d9cd2, 0);
PROC_SetOnStage(S_LOW_LorroakanProjection_PuzzleGuardian_Punisher_ae4c07db-c5c3-4b83-9fb4-23854dda14c5, 0);
PROC_TriggerRegisterForPlayers(S_LOW_PuzzleEntranceTrigger_63ded352-7943-43c9-844e-aa1673eb1388);
DB_Dialogs(S_LOW_LorroakanProjection_PuzzleGuardian_c65a2e91-34f1-4dd9-a784-2aca5a4d9cd2, LOW_SorcerousSundries_PuzzleGuardian_5423a690-96fd-9057-4068-0b51ba9c14c0);
DB_LOW_SorcerousSundriesPuzzlePortals(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "PUZ_CASTEDPORTAL_BLUE");
DB_LOW_SorcerousSundriesPuzzlePortals(LOW_PuzzlePortal_002_6fa1aa19-67e3-45c7-b633-8c873637bcca, "PUZ_CASTEDPORTAL_RED");
DB_LOW_SorcerousSundriesPuzzlePortals(LOW_PuzzlePortal_003_f6806383-5661-4b49-8280-86e432188240, "PUZ_CASTEDPORTAL_GREEN");
DB_LOW_SorcerousSundriesPuzzlePortals(LOW_PuzzlePortal_004_a5bc28c0-6a80-42ed-a63a-633abf3f256d, "PUZ_CASTEDPORTAL_PURPLE");
ApplyStatus(S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, "PUZ_CASTEDPORTAL_BLUE", -1);
DB_LOW_SorcerousSundriesPuzzlePlaques(S_LOW_PlaqueImmortality_c606ff71-77c3-4131-8333-e16505f2e58d, LOW_SorcerousSundries_AD_PuzzlePortalImmortality_5b02e5a5-39cf-386f-0564-d02882a23080);
DB_LOW_SorcerousSundriesPuzzlePlaques(S_LOW_PlaqueWealth_5d9cfef0-6502-4653-8d77-94db60893ea9, LOW_SorcerousSundries_AD_PuzzlePortalWealth_4797dba7-cb01-6283-b8ca-41f8426acb3b);
DB_LOW_SorcerousSundriesPuzzlePlaques(S_LOW_PlaqueArmy_32f301b2-9ed6-4ce2-9a66-7fb2b9bf146a, LOW_SorcerousSundries_AD_PuzzlePortalArmy_d1f240ed-43de-a8b6-e5c3-3ded2be93193);
DB_LOW_SorcerousSundriesPuzzlePlaques(S_LOW_PlaqueLove_4a1e7dfa-c915-4992-a70d-19faa93ac82d, LOW_SorcerousSundries_AD_PuzzlePortalPotion_5833d375-70d2-811f-bf36-ac7d12791138);
DB_OneShotPlayerTrigger(S_LOW_PuzzleEntranceTrigger_63ded352-7943-43c9-844e-aa1673eb1388);
DB_LOW_SorcerousSundries_TomesWithScroll(S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, "LOW_SorcerousSundries_KarsusBook");
DB_LOW_SorcerousSundries_TomesWithScroll(S_LOW_SightOfTheSeelie_5dc89036-5313-45ef-816c-38bbd0a46ce9, "LOW_SorcerousSundries_SeelieBook");
DB_LOW_SorcerousSundries_TomesWithScroll(S_LOW_CurriculumStrategy_6a87c342-a1e1-4854-8f44-96eab8813fe7, "LOW_SorcerousSundries_StrategyBook");
DB_DialogMoneyTransfer(1, LOW_SorcerousSundries_Tolna_6a5d58cc-6d82-4a9e-e8b2-5c4c09c67e14, 2000, 2, 1);
DB_DialogMoneyTransfer(2, LOW_SorcerousSundries_Tolna_6a5d58cc-6d82-4a9e-e8b2-5c4c09c67e14, 400, 2, 1);
DB_GiveItemToEvent(S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, LOW_SorcerousSundries_Event_GiveKarsus_1621c341-419a-4540-b5dc-476500af3053);
DB_HasItemEvent(S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, LOW_SorcerousSundries_Event_HasKarsusBook_c7019855-fcac-4bc5-bacf-9fad0213ab28);
DB_HasItemEvent(S_LOW_CurriculumStrategy_6a87c342-a1e1-4854-8f44-96eab8813fe7, LOW_SorcerousSundries_State_HasStrategyBook_d5bcfafa-39e4-4fa7-845d-b85bb0a2652d);
DB_LOW_SorcerousSundries_SensitiveBooks(S_LOW_SensitiveBooks_002_93cbbe6b-51ba-421c-ae49-85a1dacb1b9c);
DB_LOW_SorcerousSundries_SensitiveBooks(S_LOW_SensitiveBooks_003_8a523a6a-a09b-4d80-a26e-5f1510be87dd);
DB_LOW_SorcerousSundries_SensitiveBooks(S_LOW_SensitiveBooks_001_b92167a0-40fa-4cb0-8cb0-4441f1cc0c16);
DB_LOW_SorcerousSundries_SensitiveBooks(S_LOW_SensitiveBooks_004_3ddb4d00-ad47-453d-b3ac-afe4fc44b664);
DB_GlobalFlagReactionAfterDialog(LOW_SorcerousSundries_Event_BlowUpBooks_9b3aa100-dc49-413b-9b03-e9ff967d9220, LOW_SorcerousSundries_Tolna_6a5d58cc-6d82-4a9e-e8b2-5c4c09c67e14);
SetOnStage(S_LOW_LastPageNecromancy_45f16b38-3418-497a-ba6e-3c9ee523388f, 0);
DB_LOW_SorcerousSundries_Projections(S_LOW_LorroakanProjection_PuzzleGuardian_Punisher_ae4c07db-c5c3-4b83-9fb4-23854dda14c5);
DB_LOW_SorcerousSundries_Projections(S_LOW_LorroakanProjection_PuzzleGuardian_c65a2e91-34f1-4dd9-a784-2aca5a4d9cd2);
DB_LOW_SorcerousSundries_Projections(S_LOW_RolanProjection_c6a47d05-5051-42de-86b0-776fe0285cd1);
DB_LOW_SorcerousSundries_Projections(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
DB_SeenDeadNPCGlobalFlag(S_LOW_Tolna_46aa02d8-28e9-4ebb-876c-82fe29262d35, LOW_Tolna_Knows_PermaDefeated_629cbe29-01fb-4fb6-81c3-23748fb4c03d);
SetHasDialog(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, 1);
SetHasDialog(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, 1);
SetOnStage(S_LOW_UNI_ElfsongDoorKey_2f1b990a-2d23-49fb-b1e0-dd06a6ea8739, 0);
SetOnStage(S_LOW_RolanProjection_c6a47d05-5051-42de-86b0-776fe0285cd1, 0);
SetOnStage(S_LOW_NightsongThreat_d9df0940-238f-4451-a312-d2847ee04f9a, 0);
DB_Dialogs(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, LOW_SorcerousSundries_LorroakanProjection_b90d7005-f9c9-350d-2dc0-d821f756455f);
DB_Dialogs(S_LOW_Tolna_46aa02d8-28e9-4ebb-876c-82fe29262d35, LOW_SorcerousSundries_Tolna_6a5d58cc-6d82-4a9e-e8b2-5c4c09c67e14);
DB_Dialogs(S_LOW_RolanProjection_c6a47d05-5051-42de-86b0-776fe0285cd1, LOW_SorcerousSundries_RolanProjection_4e70211d-ec10-a709-3781-b1cb47b5277c);
DB_Dialogs(S_LOW_Miklaur_637bb24f-66b7-4447-807b-556bd1c00ed6, LOW_SorcerousSundries_Miklaur_4baaa8ff-a1b0-8d4a-a495-8792e3a9bafb);
DB_Dialogs(S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db, LOW_SorcerousSundries_Krank_cbbb03ec-145b-2583-a21c-cb235036d67e);
DB_PreventKnockedOutPermaDefeated(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7);
AddGold(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, 100);
DB_DialogMoneyTransfer(1, LOW_SorcerousSundries_LorroakanProjection_b90d7005-f9c9-350d-2dc0-d821f756455f, 100, 2);
DB_DialogMoneyTransfer(1, LOW_SorcerousSundries_LorroakanConclusion_b6642d43-ba6f-b22b-9527-3a4a909e048a, 400, 2);
DB_GiveItemToEvent(S_LOW_UNI_ElfsongDoorKey_2f1b990a-2d23-49fb-b1e0-dd06a6ea8739, LOW_Aradin_Event_GetElfsongKey_477feac9-1e8f-4711-8dbb-b2086e11a529);
Transform(S_LOW_RolanProjection_c6a47d05-5051-42de-86b0-776fe0285cd1, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, PHYSICAL_4acc6277-6dcd-4110-9450-b9379beaedac);
DB_BlockedWaypointZone(S_LOW_RamaitzhsTower_RegionTrigger_8d737a4c-9b13-4935-9ce0-34520a2de266);
DB_LOW_SorcerousSundries_BannedIFFoughtFactions(ACT3_LOW_SorcerousSundries_Buyers_b16faa54-f60e-4e43-82f7-5b57cadc4da3);
DB_LOW_SorcerousSundries_BannedIFFoughtFactions(ACT3_LOW_SorcerousSundries_Shop_0a2e84ee-30af-49a7-9216-935318f1eae1);
DB_LOW_SorcerousSundries_BannedIFFoughtFactions(ACT3_LOW_SorcerousSundries_AnimatedArmors_2eac0e71-1ba1-4af2-85c7-e9fdbb9ad938);
DB_LOW_SorcerousSundries_GaleQuestUpdates("FindBook2");
DB_LOW_SorcerousSundries_GaleQuestUpdates("FindBook_Book");
PROC_TriggerRegisterForPlayers(S_LOW_SorcerousSundries_MystraVaultTrigger_473bf62c-5f9a-40e4-bf9e-e6eb7439ad57);
DB_OneShotPartyTrigger(S_LOW_SorcerousSundries_NearSorcerousSundries_deb2beec-f1fd-4ca3-b515-9a65011938bd);
DB_KnowledgeCheckTrigger_AD("LOW_SorcerousSundries_MystraVaultCheck", S_LOW_SorcerousSundries_MystraVaultTrigger_473bf62c-5f9a-40e4-bf9e-e6eb7439ad57, "Arcana", Act3_Medium_77cee1c4-384a-4217-b670-67db3c7add57, LOW_SorcerousSundries_PAD_MystraVaultEntered_f18ccb6a-393f-d372-075f-765960372335, LOW_SorcerousSundries_State_MystraVaultCheckSuccess_b7f69e3d-da44-4d4e-b565-9bf68fadad93);
DB_TrespassTrigger(S_LOW_SorcerousSundries_ClerkRoomTrespassingTrigger_458880c6-2789-450f-8506-0e1c52c1af6a, LOW_SorcerousSundries_ClerkRoomBacktrackTrigger_0b33feb0-a2b1-4149-bddf-ef0f2783d2a7);
DB_TrespassTrigger(S_LOW_SorcerousSundries_BasementEntranceRestrictedArea_860973ae-bf8b-4cb3-917a-3743bfb766df, LOW_SorcerousSundries_BasementEntranceBacktrackTrigger_5f522e3e-cbfd-4bc6-9452-e745ec2f32ec);
DB_DangerZone(S_LOW_SorcerousSundries_Cellar_SUB_a3ad0aa6-0b85-495d-9378-ad495d90b8e7, "LOW_SorcerousSundries_Basement");
DB_LOW_SorcerousSundries_ForbiddenDoors(S_Door_SorcererSundriesTop_B_a4db08f9-e6cc-46e4-b89c-ddb4496283bf);
DB_LOW_SorcerousSundries_ForbiddenDoors(S_Door_SorcererSundriesTop_A_07f823ca-2e2f-412d-91e5-7895aef2d11a);
DB_ItemOwnerShipTriggers("CTY_Main_A", S_LOW_SorcerousSundries_RamazithOwnershipTrigger_af5a1002-68b2-4b3e-8399-e077af9f1dd5, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9);

KBSECTION
PROC
PROC_LOW_SorcerousSundries_NightsongSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(_Var1, "SHA_NIGHTSONG_SOULCAGE", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "SHA_NIGHTSONG_SOULCAGE", _Var1);

PROC
PROC_LOW_SorcerousSundries_AradinSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(GLO_AdventurersQuest_Knows_AboutBounty_93fcf273-334d-7aa8-d5c1-a4d154f0fe23, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_Knows_AboutLorroakanGoingAfterNightsong_06fc1554-756a-4d3f-8560-5848313210fa);

PROC
PROC_LOW_SorcerousSundries_AradinSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(S_LOW_Aradin_ADTrigger_8329c11b-843d-4a16-9fd6-600e59972dce);
TeleportTo(_Var1, S_LOW_AradinTeleportTo_b949ec95-fed4-4791-86dc-4d849b0c9e9d);
PROC_SetOnStage(_Var1, 1);
SetHasDialog(_Var1, 1);
SetFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92);
SetFlag(LOW_Aradin_State_HasBeenAtSorcerousSundries_1255ce1e-d0a1-4b41-9a30-3e62063648ce);
PROC_SetInvulnerable(_Var1, 0);
SetImmortal(_Var1, 0);
PROC_SceneOver("DEN_RaidingParty_PleaAtGate");
PROC_CharacterEnableAllCrimes(_Var1);
DB_SceneManager(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, "LOW_SorcerousSundries_AradinYellingAtKlankScene");

PROC
PROC_LOW_SorcerousSundries_AradinSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_Aradin_State_IsPermaDefeated_f9fb4d8e-dfda-4457-a3de-1716cdb8d343);
ClearFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92);
PROC_TriggerUnregisterForPlayers(S_LOW_Aradin_ADTrigger_7456d3db-aad6-4411-8c82-6266f81b29ef);

PROC
PROC_LOW_SorcerousSundries_RolanSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetLevel(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
IntegerSubtract(7, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 > 0
THEN
PROC_LevelUpBy(_Var1, _Var3);

PROC
PROC_LOW_SorcerousSundries_RolanSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(HAV_ProdigyLament_State_InShadowlands_68d204cb-3017-455e-9d80-c02abbc9f477, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 0);

PROC
PROC_LOW_SorcerousSundries_RolanSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(HAV_ProdigyLament_State_InShadowlands_68d204cb-3017-455e-9d80-c02abbc9f477, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_SendRolanToLOW(_Var1);

IF
TextEvent("LOW_SorcerousSundries_SendRolan", _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_SendRolanToLOW(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

PROC
PROC_LOW_SorcerousSundries_SendRolanToLOW((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_RolanMovesIn", _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var1, S_LOW_RolanTeleportTo_c76eb1ca-e97e-4b27-ad8d-51e4cc4fd381);
SetOnStage(_Var1, 1);
SetOnStage(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, 0);
SetFaction(_Var1, ACT3_LOW_SorcerousSundries_Shop_0a2e84ee-30af-49a7-9216-935318f1eae1);
PROC_RemoveAllDialogEntriesForSpeaker(_Var1);
DB_Dialogs(_Var1, LOW_SorcerousSundries_Rolan_c6d83bfb-ed34-af42-dbff-506114212e96);
SetFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
SetTag(_Var1, ACT3_LOW_SORCEROUSSUNDRIES_VENDOR_9f66044c-876d-48cb-94c4-5b8c7a5f5d9e);
SetTag(_Var1, TRADER_91d5ebc6-91ea-44db-8a51-216860d69b5b);
SetTag(_Var1, AI_UNPREFERRED_TARGET_9787450d-f34d-43bd-be88-d2bac00bb8ee);
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var1);
PROC_SetCustomTradeTreasure(_Var1, "LOW_SorcerousSundries_Trade");
DB_GLO_DefeatCounter(_Var1, "LOW_SorcerousSundries_ShopCombatant");
PROC_LOW_SorcerousSundries_InitShop(_Var1);
DB_NoLowAttitudeDialog(_Var1);
PROC_LOW_SorcerousSundries_PlaceRolanJournal();

PROC
PROC_LOW_SorcerousSundries_PlaceRolanJournal()
AND
QRY_LOW_SorcerousSundries_SiblingsDead()
AND
QRY_OnlyOnce("LOW_SorcerousSundries_PlaceJournals", _, _, _, _)
THEN
TemplateAddTo(BOOK_LOW_SorcerousSundries_RolanJournalSiblingsFailed_7e91fa6a-dee7-4ed2-876f-a0081b8e5c33, S_LOW_SorcerousSundries_ClerkCabinet_4d99e79a-9669-4b9c-a74f-d21f75dd492c, 1, 0);

PROC
PROC_LOW_SorcerousSundries_PlaceRolanJournal()
AND NOT
QRY_LOW_SorcerousSundries_SiblingsDead()
AND
QRY_OnlyOnce("LOW_SorcerousSundries_PlaceJournals", _, _, _, _)
THEN
TemplateAddTo(BOOK_LOW_SorcerousSundries_RolanJournalSiblingsSaved_fe8c0c14-7484-4562-94b9-e99b0301867e, S_LOW_SorcerousSundries_ClerkCabinet_4d99e79a-9669-4b9c-a74f-d21f75dd492c, 1, 0);

QRY
QRY_LOW_SorcerousSundries_SiblingsDead()
AND
DB_PermaDefeated(S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b, _, _, _, _)
AND
DB_PermaDefeated(S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_LOW_SorcerousSundries_RolanSetup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640);
TeleportTo(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, S_LOW_ProjectionTeleportTo_a84efcfe-3145-48fc-bc89-29e69e2036c3);
PROC_Foop(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
DB_LOW_SorcerousSundries_CurrentMainClerk(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
PROC_LOW_SorcerousSundries_InitShop(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);

IF
TextEvent("LOW_SorcerousSundries_NightsongMove", _, _, _, _)
THEN
SetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302);
PROC_TryStartAD(LOW_SorcerousSundries_AD_NightsongCallsLorroakan_83276954-fdb0-6013-e71e-d074315edf1f, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_CharacterMoveTo(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, S_LOW_LorroakanTeleportTo_0063de25-d5c9-4c10-b907-a9abbe246114, "Run", "LOW_SorcerousSundries_FinalConfronationReached");
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_NightsongLorrokananTeleportTo_5c68bfc2-7e9b-4856-8f69-81f75f65feae, "Run", "LOW_SorcerousSundries_FinalConfronationReached");

IF
FlagSet(LOW_SorcerousSundries_Event_DebugBlacklist_0176e04c-d587-443f-9127-4b0a5e3759af, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, _Var3, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_ToggleBlacklisted(_Var1, _Var3);

PROC
PROC_LOW_SorcerousSundries_ToggleBlacklisted((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var2 == 1
THEN
ClearFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1);

PROC
PROC_LOW_SorcerousSundries_ToggleBlacklisted((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var2 == 0
THEN
SetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 1);

IF
DB_GlobalFlag(LOW_Aradin_Event_DebugLeaveSorcerousSundries_a68c3a15-0556-467e-b3ca-769789a8f9c9, _, _, _, _)
THEN
ClearFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92);
PROC_DisappearOutOfSightTo(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_LOW_AlarinLeaveTo_88109786-792a-4ac9-b565-6014e50e8ea4, "Run", 0, "LOW_SorcerousSundries_AradinLeft");

IF
DB_GlobalFlag(LOW_Nightsong_Event_DebugGoToRamazithTower_8303d93c-b8e9-4839-b4d3-69547553dfc5, _, _, _, _)
THEN
SetFlag(LOW_Nightsong_Event_GoToRamazithTower_59fab159-060f-424c-9fd9-43cc00a88db9);
ClearFlag(LOW_Lorroakan_Quest_WaitingForCampNightsongDialog_ce238f16-8215-48f8-90b4-a503a4426efd);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_SetRelationToPlayers(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 100);
SetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_RamazithsJump_Start_12ca715e-872c-49be-93e1-65e17eacc8be, "LOW_SorcerousSundries_NightsongReadyToEnterRamazith", 0, 0, 0, 1, 1);

IF
TextEvent("LOW_SorcerousSundries_NightsongTeleport", _, _, _, _)
THEN
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1);
SetFlag(LOW_Nightsong_Event_GoToRamazithTower_59fab159-060f-424c-9fd9-43cc00a88db9);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_SetRelationToPlayers(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 100);
ClearFlag(LOW_Lorroakan_Quest_WaitingForCampNightsongDialog_ce238f16-8215-48f8-90b4-a503a4426efd);
SetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_RamazithsJump_Start_12ca715e-872c-49be-93e1-65e17eacc8be, "LOW_SorcerousSundries_NightsongReadyToEnterRamazith", 0, 0, 0, 1, 1);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_Dialogs(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, LOW_SorcerousSundries_IsobelCamp_f7674ec5-775e-1a91-5faa-cb3e0532aa67);

IF
TextEvent("LOW_SorcerousSundries_GetTomes", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_TomesWithScroll(_Var2, _, _Var1, _Var1, _Var1)
THEN
ToInventory(_Var2, _Var1, 1, 1, 1);

IF
TextEvent("LOW_SorcerousSundries_GetTomes", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_UNI_TharchiateCypher_0addb171-6e14-4b4c-8d97-c9af9ba1dcb8, _Var1, 1, 1, 1);

IF
TextEvent("LOW_SorcerousSundries_RemoveSpellsRolan", _, _, _, _)
THEN
RemoveSpell(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Projectile_MagicMissile", 0);
RemoveSpell(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Zone_ColorSpray", 0);
RemoveSpell(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Zone_Thunderwave", 0);
RemoveSpell(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Target_MageArmor", 0);

IF
TextEvent("LOW_SorcerousSundries_ZombieSpell", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
AddSpell(_Var1, "Shout_LOW_SorcerousSundries_WakeOfTheDead", 1, 0);

IF
TextEvent("LOW_SorcerousSundries_OwnershipDoors", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_LOW_SorcerousSundries_ForbiddenDoors(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearOwnership(_Var1);
SetOwner(_Var1, S_LOW_LorroakanProjection_PuzzleGuardian_c65a2e91-34f1-4dd9-a784-2aca5a4d9cd2);

IF
TextEvent("LOW_SorcerousSundries_MakeRolanInCharge", _, _, _, _)
THEN
SetFlag(LOW_Rolan_State_RolanInChargeOfShop_d76ad357-97d9-49cc-bdb5-620e9a8242a5);
TeleportTo(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, S_LOW_RolanLorroakanTeleportTo_13708935-bd6f-4053-98e1-bd07a2aeab78);

IF
TextEvent("LOW_SorcerousSundries_AradinLeaveAndAttack", _, _, _, _)
THEN
SetFlag(LOW_Aradin_Knows_BelievesNightsongIsAtCamp_aa7cc65a-3fb6-4bf7-aa65-c14b5c38df70);
ClearFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92);
SetFlag(LOW_Aradin_Event_DebugLeaveSorcerousSundries_a68c3a15-0556-467e-b3ca-769789a8f9c9);

IF
TextEvent("LOW_portal", _, _, _, _)
THEN
SetOnStage(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, 1);
SetOnStage(S_LOW_PortalToShop_824362a7-c028-484f-9ed1-2fb0a915551a, 1);
ApplyStatus(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "PUZ_CASTEDPORTAL_BLUE", 999, 1);
ApplyStatus(S_LOW_PortalToShop_824362a7-c028-484f-9ed1-2fb0a915551a, "PUZ_CASTEDPORTAL_BLUE", 999, 1);
SetCanInteract(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, 1);
SetCanInteract(S_LOW_PortalToShop_824362a7-c028-484f-9ed1-2fb0a915551a, 1);

IF
TextEvent("LOW_portalOff", _, _, _, _)
THEN
RemoveStatus(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "PUZ_CASTEDPORTAL_BLUE", LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5);
RemoveStatus(S_LOW_PortalToShop_824362a7-c028-484f-9ed1-2fb0a915551a, "PUZ_CASTEDPORTAL_BLUE", S_LOW_PortalToShop_824362a7-c028-484f-9ed1-2fb0a915551a);
SetCanInteract(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, 0);
ObjectTimerLaunch(S_LOW_PortalToShop_824362a7-c028-484f-9ed1-2fb0a915551a, "LOW_SorcerousSundries_SetOffStageDelayed", 2500);
ObjectTimerLaunch(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "LOW_SorcerousSundries_SetOffStageDelayed", 2500);

IF
TextEvent("LOW_SorcerousSundries_SetNightsongAtCamp", _, _, _, _)
THEN
SetFlag(CAMP_SharTempleEpilogue_State_NightsongInCamp_1e3475b8-ab7b-4a53-a079-0ac3f86899ed);
ClearFlag(SHA_Nightsong_State_PermaDefeated_d02e8ea4-dec7-4824-8117-efc075dee4ba, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
TextEvent("LOW_SorcerousSundries_AradinGoAttackCamp", _, _, _, _)
THEN
SetFlag(LOW_Aradin_Knows_BelievesNightsongIsAtCamp_aa7cc65a-3fb6-4bf7-aa65-c14b5c38df70);
SetFlag(LOW_Aradin_Event_LeaveSorcerousSundries_9b859898-5d65-4cfb-8b0b-fa3c93f9c752, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0);
ClearFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
TextEvent("LOW_SendNightsongToCamp", _, _, _, _)
THEN
SetEntityEvent(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "DebugTeleportedToCamp");

IF
TextEvent("LOW_SorcerousSundries_HaveNecromancyBookReady", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetClosestAlivePlayer(S_UNI_TharchiateCypher_0addb171-6e14-4b4c-8d97-c9af9ba1dcb8, _Var1, _, _Var1, _Var1)
THEN
ToInventory(S_FOR_DangerousBook_Tome_73ea8888-ed82-4ca5-b9f9-0c9119873507, _Var1, 1, 1, 1);
SetFlag(FOR_DangerousBook_State_BookUnlocked_fd215551-a14c-8cfa-ba34-7ac32d1ada28);
SetFlag(FOR_DangerousBook_State_BookOwner_06022678-24ed-35af-de93-bd91abc02452, _Var1);
SetFlag(FOR_DangerousBook_State_Bound_5e16d6fc-ae5c-cb6f-3a0f-4237593ee05e);
SetFlag(FOR_DangerousBook_State_BookFinished_489a23a0-758a-97bd-bd0c-d6b417c20af3);

IF
TextEvent("LOW_SorcerousSundries_GetNecromancyOfThay", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_FOR_DangerousBook_Key_000_123c268d-ad0c-4df5-905b-a78dacbed80b, _Var1, 1, 1, 1);
ToInventory(S_FOR_DangerousBook_Tome_73ea8888-ed82-4ca5-b9f9-0c9119873507, _Var1, 1, 1, 1);

IF
TextEvent("LOW_RolanBrotherSaved", _, _, _, _)
THEN
SetFlag(HAV_SavingPrisoners_State_BrotherReturned_2b696962-1d09-4cb6-b034-34d86d73dba0);

IF
TextEvent("LOW_RolanSisterSaved", _, _, _, _)
THEN
SetFlag(HAV_SavingPrisoners_State_SisterReturned_54cbf85c-163b-d0f7-2519-93ff58c843aa);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_SelectedDialog(LOW_SorcerousSundries_LorroakanProjection_b90d7005-f9c9-350d-2dc0-d821f756455f, S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, _Var1);

IF
DB_LOW_SorcerousSundries_Projections(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetInvulnerable(_Var1, 1);
PROC_CharacterDisableAllCrimes(_Var1);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_SorcerousSundries_Event_BlowUpBooks_9b3aa100-dc49-413b-9b03-e9ff967d9220, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_LOW_SorcerousSundries_SensitiveBooks(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Poof(_Var1);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_SorcerousSundries_Event_BlowUpBooks_9b3aa100-dc49-413b-9b03-e9ff967d9220, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_LOW_SorcerousSundries_TolnaExplosionLocations(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
CreateExplosion(_Var1, "Projectile_LOW_SorcerousSundries_BookExplosion", 1);

PROC
PROC_LOW_SorcerousSundries_InitShop((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_ItemOwnershipTriggers("CTY_Main_A", S_LOW_OwnershipMainClerkTrigger_c878a73d-b8d8-4b31-86b5-04182b134e1c, _Var1);
DB_ItemOwnershipTriggers("CTY_Main_A", S_LOW_OwnershipRestOfTheShopTrigger_82898b18-a3e7-474e-8a28-4ea9d370d4f5, _Var1);
DB_ItemShopTrigger(S_LOW_OwnershipMainClerkTrigger_c878a73d-b8d8-4b31-86b5-04182b134e1c, _Var1);

PROC
PROC_LOW_SorcerousSundries_InitShop((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_SetSpottingAndCombatants", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_SetSpottingAndCombatants(_Var1);

PROC
PROC_LOW_SorcerousSundries_SetSpottingAndCombatants((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_GLO_DefeatCounter(S_LOW_LavaElemental_1dea794e-2657-4c54-916b-edc639c4ff8c, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_WaterElemental_4cb61416-f095-4fbb-aece-51f37b6bb4d6, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_Tolna_46aa02d8-28e9-4ebb-876c-82fe29262d35, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_ShopAnimatedArmor_004_9752ca37-cc97-42fc-b7d0-a0f0a8b1dfd3, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_ShopAnimatedArmor_005_d42295ab-7169-4bba-9a7c-8124196caea7, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_ShopAnimatedArmor_003_e57cc258-8f98-45d0-b6dc-063e945ce086, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_ShopAnimatedArmor_002_4b741aa9-c2af-4196-a8fd-7bc9a8f5cd5d, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_ShopAnimatedArmor_001_50e39747-fa44-4d2a-8427-186d2f9a5d1c, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_LOW_SorcerousSundries_Necromancer_ba40224c-9113-4a18-b30b-a1a77e88f9d2, "LOW_SorcerousSundries_ShopCombatant");
PROC_LOW_SorcerousSundries_SetMainClerkSpotting(_Var1);
DB_SpotPlayers(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, "LOW_SorcerousSundries_KlankBannedSpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, "LOW_SorcerousSundries_KlankBannedSpotting");
DB_SpotPlayers_IncludeWildshapedPlayers(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, "LOW_SorcerousSundries_KlankBannedSpotting");
DB_SpotPlayers_SpotTrigger(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, "LOW_SorcerousSundries_KlankBannedSpotting", S_LOW_SorcerousCheckpoint_PrimaryTrigger_1181722d-3b04-4ebc-be3c-9e9059ba451c);

PROC
PROC_LOW_SorcerousSundries_ChangeOwnershipClerk((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_ItemShopTrigger(S_LOW_OwnershipMainClerkTrigger_c878a73d-b8d8-4b31-86b5-04182b134e1c, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_ItemShopTrigger(S_LOW_OwnershipMainClerkTrigger_5a2b00ee-3f6d-471c-9888-1a55f4a729e5, _Var2);
DB_ItemShopTrigger(S_LOW_OwnershipMainClerkTrigger_5a2b00ee-3f6d-471c-9888-1a55f4a729e5, _Var1);

IF
DB_GlobalFlag(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640, _, _, _, _)
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_ReplaceMainClerk(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);

IF
LongRestFinished()
AND
DB_GlobalFlag(LOW_Rolan_State_RolanInChargeOfShop_d76ad357-97d9-49cc-bdb5-620e9a8242a5, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640, _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_ReplaceMainClerk(S_LOW_RolanProjection_c6a47d05-5051-42de-86b0-776fe0285cd1);

IF
FlagSet(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640, _, _, _, _)
AND
DB_GlobalFlag(LOW_Rolan_State_RolanInChargeOfShop_d76ad357-97d9-49cc-bdb5-620e9a8242a5, _, _, _, _)
THEN
ClearFlag(LOW_Rolan_State_RolanInChargeOfShop_d76ad357-97d9-49cc-bdb5-620e9a8242a5);

PROC
PROC_LOW_SorcerousSundries_ReplaceMainClerk((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_LOW_SorcerousSundries_NoCombatantLeftAndLorroProjection(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_ProceedWithClerkReplacement(_Var1);

PROC
PROC_LOW_SorcerousSundries_ProceedWithClerkReplacement((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var2, 1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Poof(_Var2);

PROC
PROC_LOW_SorcerousSundries_ProceedWithClerkReplacement((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_ChangeOwnershipClerk(_Var1);
NOT DB_LOW_SorcerousSundries_CurrentMainClerk(_Var2);
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var1);
TeleportTo(_Var1, S_LOW_ProjectionTeleportTo_a84efcfe-3145-48fc-bc89-29e69e2036c3, "LOW_SorcerousSundries_NewClerkTeleported");
PROC_SpotPlayers_StopSpotting(_Var2, "LOW_SorcerousSundries_BannedSpotting");
PROC_LOW_SorcerousSundries_SetMainClerkSpotting(_Var1);

PROC
PROC_LOW_SorcerousSundries_ProceedWithClerkReplacement((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsOnStage(_Var1, 1, _Var1, _Var1, _Var1)
THEN
PROC_Poof(_Var1);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_NewClerkTeleported", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_Foop(_Var1);

QRY
QRY_LOW_SorcerousSundries_NoCombatantLeftAndLorroProjection((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var1 == S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2
AND
DB_LOW_SorcerousSundries_AllCombatantsDead(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EnteredTrigger(_, S_LOW_NecromanticVendorTrigger_9ea2b581-5104-4848-933d-7bff203e81a2, _, _, _)
AND
HasActiveStatus(S_LOW_SorcerousSundries_Necromancer_ba40224c-9113-4a18-b30b-a1a77e88f9d2, "SILENCED", 0, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_ReanimateBody", _, _, _, _)
THEN
UseSpell(S_LOW_SorcerousSundries_Necromancer_ba40224c-9113-4a18-b30b-a1a77e88f9d2, "Target_AnimateDead_Zombie", S_LOW_BodyToResurrect_85591bc4-05f2-40b3-8498-a8747671c8e3);

IF
CastSpellFailed(S_LOW_SorcerousSundries_Necromancer_ba40224c-9113-4a18-b30b-a1a77e88f9d2, "Target_AnimateDead_Zombie", _, _, _)
AND
DB_OnlyOnce("LOW_SorcerousSundries_ReanimateBody", _, _, _, _)
THEN
NOT DB_OnlyOnce("LOW_SorcerousSundries_ReanimateBody");

IF
CastedSpell(S_LOW_SorcerousSundries_Necromancer_ba40224c-9113-4a18-b30b-a1a77e88f9d2, "Target_AnimateDead_Zombie", _, _, _)
THEN
PROC_TriggerUnregisterForParty(S_LOW_NecromanticVendorTrigger_9ea2b581-5104-4848-933d-7bff203e81a2);

IF
BaseFactionChanged((CHARACTER)_Var1, _, ACT3_LOW_SorcerousSundries_Shop_0a2e84ee-30af-49a7-9216-935318f1eae1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
CharacterGetOwner(_Var1, S_LOW_SorcerousSundries_Necromancer_ba40224c-9113-4a18-b30b-a1a77e88f9d2, _Var1, _Var1, _Var1)
THEN
DB_Dialogs(_Var1, LOW_SorcerousSundries_ZombieNecromancy_55693fbb-3274-3519-3947-070422f07cf3);
PROC_CharacterDisableAllCrimes(_Var1);
SetFlag(LOW_SorcerousSundries_State_RaisedZombie_6df57400-b395-4391-be33-5bb0b8750335);

IF
DB_LOW_SorcerousSundries_ShopArmors(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Dialogs(_Var1, LOW_SorcerousSundries_AnimatedArmor_6195a66d-38b3-488a-b65e-1c597ef8c606);

IF
Died(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _, _, _, _)
THEN
PROC_SetRelationToPlayers(Act3_LOW_SorcerousSundries_Klank_f20b4417-45a0-49c0-bcc4-cd3437909f35, 50);
PROC_SetRelationMutual(Act3_LOW_SorcerousSundries_Klank_f20b4417-45a0-49c0-bcc4-cd3437909f35, ACT1_DEN_AdventurerLeader_8276868b-adf0-4b7e-fc32-2f268e43f51e, 50);

PROC
PROC_LongRest()
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SorcerousSundries_AnimatedArmors_2eac0e71-1ba1-4af2-85c7-e9fdbb9ad938, 50);

IF
DB_LOW_SorcerousSundries_CustomerADs(_Var1, _, _, _, _)
THEN
DB_OneShotPlayerTrigger(_Var1);

PROC
PROC_OneShotTriggerEntered(_, (TRIGGER)_Var2, _, _, _)
AND
DB_LOW_SorcerousSundries_CustomerADs(_Var2, _, _, _Var5, _)
THEN
PROC_LOW_SorcerousSundries_StartRepeatedAD(_Var5);

PROC
PROC_LOW_SorcerousSundries_StartRepeatedAD((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_SorcerousSundries_CustomerADs(_Var2, _Var3, _Var4, _Var1, 1)
AND NOT
DB_DialogNPCs(_, _Var3, _, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(_Var1, _Var3);

PROC
PROC_LOW_SorcerousSundries_StartRepeatedAD((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_SorcerousSundries_CustomerADs(_Var2, _Var3, _Var4, _Var1, 2)
AND NOT
DB_DialogNPCs(_, _Var3, _, _Var1, _Var1)
AND NOT
DB_DialogNPCs(_, _Var4, _, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(_Var1, _Var3, _Var4);

IF
AutomatedDialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_SorcerousSundries_CustomerADs(_, _Var4, _, _Var1, _)
THEN
ObjectTimerLaunch(_Var4, "LOW_SorcerousSundries_StartRepeatedDialog", 5000);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "LOW_SorcerousSundries_StartRepeatedDialog", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_CustomerADs(_, _Var1, _, _Var4, _)
THEN
PROC_LOW_SorcerousSundries_StartRepeatedAD(_Var4);

IF
DB_Is_InCombat(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
IsEnemy(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var2, 1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_CombatPlayerKlank(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_CombatPlayerKlank(_Var1, _Var2);
PROC_LOW_SorcerousSundries_KlankAttackedByPlayer(_Var2);

IF
SwitchedCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_CombatPlayerKlank(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SorcerousSundries_CombatPlayerKlank(_Var2, _Var1);
DB_LOW_SorcerousSundries_CombatPlayerKlank(_Var3, _Var1);

PROC
PROC_LOW_SorcerousSundries_KlankAttackedByPlayer((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_LOW_SorcerousSundries_CheckIfWarned(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_LOW_SorcerousSundries_CheckIfWarned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(LOW_SorcerousSundries_State_Warned_591a4170-a732-44a1-aa36-a1be35bf8a28, _Var1, 1, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 0, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_ProdigyHasStayedAtRamazith_524ab56a-8169-4926-9105-8bcaf8c87499, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1);

QRY
QRY_LOW_SorcerousSundries_CheckIfWarned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_LOW_SorcerousSundries_KilledKlank(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_KilledKlank(_Var1);
SetFlag(LOW_SorcerousSundries_State_WaitingToBeWarned_11c39e25-12a2-4c8d-8658-69ca6f4bee1c, _Var1);

IF
FlagSet(LOW_Aradin_Event_LeaveSorcerousSundries_9b859898-5d65-4cfb-8b0b-fa3c93f9c752, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_Dialogs(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, LOW_SorcerousSundries_Klank_04e461be-8cd3-f261-3f12-3c70eb4cd0f6);
PROC_CharacterMoveTo(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, S_LOW_SideKlankPositionTrigger_3df99565-8ef6-43cb-941d-0cc8836db185, "Walk", "");

IF
DB_GlobalFlag(LOW_Aradin_State_IsPermaDefeated_f9fb4d8e-dfda-4457-a3de-1716cdb8d343, _, _, _, _)
THEN
DB_Dialogs(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, LOW_SorcerousSundries_Klank_04e461be-8cd3-f261-3f12-3c70eb4cd0f6);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_SorcerousSundries_Klank_04e461be-8cd3-f261-3f12-3c70eb4cd0f6, S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1);

PROC
PROC_LongRest()
AND
QRY_LOW_SorcerousSundries_CheckIfThereIsOwner()
THEN
SetOnStage(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, 0);
Resurrect(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7);
PROC_SetOnStage(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, 1);
PROC_SetRelationToPlayers(Act3_LOW_SorcerousSundries_Klank_f20b4417-45a0-49c0-bcc4-cd3437909f35, 50);

QRY
QRY_LOW_SorcerousSundries_CheckIfThereIsOwner()
AND NOT
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_LOW_SorcerousSundries_CheckIfThereIsOwner()
AND NOT
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
THEN
DB_NOOP(1);

IF
KilledBy(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, (CHARACTER)_Var1, _, _, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_KlankAttackedByPlayer(_Var1);

IF
KilledBy(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, (GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, 0, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_AradinApproachesPlayer", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveToAndTalk(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, LOW_SorcerousSundries_Aradin_f25cbd18-f09a-4dc2-414c-6762d60a3a86, "LOW_SorcerousSundries_AradinGoTalkAfterCombat", "Run", 15);

IF
CharacterMoveToAndTalkFailed(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, (GUIDSTRING)_Var1, "LOW_SorcerousSundries_AradinGoTalkAfterCombat", _, (GUIDSTRING)_Var1)
THEN
PROC_LOW_SorcerousSundries_AradinLeaveShop();

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_Aradin_Event_LeaveSorcerousSundries_9b859898-5d65-4cfb-8b0b-fa3c93f9c752, _, _, _, _)
THEN
SetHasDialog(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);
PROC_LOW_SorcerousSundries_AradinLeaveShop();

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_Aradin_Event_LeaveSorcerousSundries_9b859898-5d65-4cfb-8b0b-fa3c93f9c752, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Aradin_Knows_BelievesNightsongIsAtCamp_aa7cc65a-3fb6-4bf7-aa65-c14b5c38df70, _, _, _, _)
AND
DB_GLO_DefeatCounter(_Var1, "LOW_SorcerousSundries_AradinAttackers", _Var1, _Var1, _Var1)
THEN
PROC_PeacefulResolve(_Var1);

PROC
PROC_LOW_SorcerousSundries_AradinLeaveShop()
THEN
SetFlag(LOW_Lorroakan_Quest_WaitingForCampNightsongDialog_ce238f16-8215-48f8-90b4-a503a4426efd);
ClearFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92);
PROC_DisappearOutOfSightTo(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_LOW_AlarinLeaveTo_88109786-792a-4ac9-b565-6014e50e8ea4, "Run", 0, "LOW_SorcerousSundries_AradinLeft");
TriggerUnregisterForCharacter(S_LOW_AradinStayAreaTrigger_ddc16aed-a2d2-473b-aa9f-fafb647bf4a4, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_SorcerousSundries_Aradin_f25cbd18-f09a-4dc2-414c-6762d60a3a86, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PermaDefeated(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_SorcerousSundries_Aradin_f25cbd18-f09a-4dc2-414c-6762d60a3a86, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7);

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "LOW_SorcerousSundries_AradinYellingAtKlankScene", "DisturbanceRegistering", (GUIDSTRING)_)
THEN
DB_LOW_SorcerousSundries_PlayerToMakeHostileToKlank(_Var2);
PROC_SceneOver("LOW_SorcerousSundries_AradinYellingAtKlankScene");

PROC
PROC_SceneOver("LOW_SorcerousSundries_AradinYellingAtKlankScene", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_PlayerToMakeHostileToKlank(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationTemporaryHostile(_Var1, S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7);
SetFlag(LOW_SorcerousSundries_State_KlankAttackedAradinSaw_f57b0854-44fd-4b8e-a888-a5514e794699);
PROC_SetRelationMutual(Act3_LOW_SorcerousSundries_Klank_f20b4417-45a0-49c0-bcc4-cd3437909f35, ACT1_DEN_AdventurerLeader_8276868b-adf0-4b7e-fc32-2f268e43f51e, 0);

IF
DB_Is_InCombat(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_AradinAttacksKlank", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_State_KlankAttackedAradinSaw_f57b0854-44fd-4b8e-a888-a5514e794699);
PROC_SetRelationMutual(Act3_LOW_SorcerousSundries_Klank_f20b4417-45a0-49c0-bcc4-cd3437909f35, ACT1_DEN_AdventurerLeader_8276868b-adf0-4b7e-fc32-2f268e43f51e, 0);

IF
DB_Is_InCombat(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_AradinAndKlankCombatID(_Var1);
PROC_ForceStopDialog(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
DB_CombatReact_AD_OnTurn(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, LOW_SorcerousSundries_AD_AradinSeesKlankAttacked_d045107c-75df-8031-ce60-3c6b15ba74f6, 1);

IF
SwitchedCombat(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, (GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_AradinAndKlankCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SorcerousSundries_AradinAndKlankCombatID(_Var1);
DB_LOW_SorcerousSundries_AradinAndKlankCombatID(_Var2);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_AradinAndKlankCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_Aradin_State_IsPermaDefeated_f9fb4d8e-dfda-4457-a3de-1716cdb8d343, _Var1, _Var1, _Var1, _Var1)
AND
GetClosestAlivePlayer(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var2, _Var3, _Var1, _Var1)
THEN
PROC_CharacterMoveToAndTalk(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var2, LOW_SorcerousSundries_Aradin_f25cbd18-f09a-4dc2-414c-6762d60a3a86, "LOW_SorcerousSundries_AradinGoTalkAfterCombat", "Run", 15);

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_EnterSorcerousTrigger_7c408b4f-8d02-43d5-9f7b-a3898afe2bf0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogNPCs(_, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _Var1, _Var1)
THEN
PROC_ForceStopDialog(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
SetEntityEvent(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "LOW_SorcerousSundries_InterruptAradinYelling");
PROC_TryStartAD(LOW_SorcerousSundries_AD_AradinReactEnterWhileYelling_589f55c3-5364-8fea-714c-0e0e92b8d187, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
PROC_TriggerUnregisterForPlayers(S_LOW_EnterSorcerousTrigger_7c408b4f-8d02-43d5-9f7b-a3898afe2bf0);

IF
AutomatedDialogEnded(LOW_SorcerousSundries_AD_AradinReactEnterWhileYelling_589f55c3-5364-8fea-714c-0e0e92b8d187, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetEntityEvent(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "LOW_SorcerousSundries_ResumeAradinYelling");

IF
LeftTrigger((CHARACTER)_Var1, S_LOW_AradinStayAreaTrigger_ddc16aed-a2d2-473b-aa9f-fafb647bf4a4, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_LOW_AradinTeleportTo_b949ec95-fed4-4791-86dc-4d849b0c9e9d, "Run", "");

IF
FlagSet(LOW_Rolan_Event_GoBackToSorcerousSundries_234e30c0-103c-4117-a137-968a6a3f3cef, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
TeleportTo(_Var1, S_LOW_RolanTeleportTo_c76eb1ca-e97e-4b27-ad8d-51e4cc4fd381);
SetOnStage(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, 0);
SetFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_Dialogs(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, LOW_SorcerousSundries_Rolan_c6d83bfb-ed34-af42-dbff-506114212e96);

IF
DB_PermaDefeated(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
THEN
SetFlag(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640);
ClearFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

IF
FlagSet(LOW_SorcerousSundries_Event_BlacklistedPlayerTeleported_e4a4d044-123f-4499-8714-9a8dca72a583, (GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
TeleportTo(_Var1, S_LOW_SorcerousSundriesTeleportTo_769fa8ca-63f8-4364-b903-1f0190588db2, "", 1, 1, 1, 1, 1);
ClearFlag(LOW_SorcerousSundries_Event_BlacklistedPlayerTeleported_e4a4d044-123f-4499-8714-9a8dca72a583, _Var1, _Var2);

PROC
PROC_LOW_SorcerousSundries_SetMainClerkSpotting((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_SpotPlayers(_Var1, "LOW_SorcerousSundries_BannedSpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(_Var1, "LOW_SorcerousSundries_BannedSpotting");
DB_SpotPlayers_IncludeWildshapedPlayers(_Var1, "LOW_SorcerousSundries_BannedSpotting");
DB_SpotPlayers_SpotTrigger(_Var1, "LOW_SorcerousSundries_BannedSpotting", S_LOW_SorcerousCheckpoint_ClerkSpotTrigger_21b5350e-7827-4894-a2d2-0d71849d2a4e);

PROC
PROC_GLO_DefeatCounter_AllPermaDefeated("LOW_SorcerousSundries_ShopCombatant", _, _, _, _)
THEN
DB_LOW_SorcerousSundries_AllCombatantsDead(1);

IF
DB_LOW_SorcerousSundries_AllCombatantsDead(1, _, _, _, _)
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, _, _, _, _)
THEN
PROC_Poof(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2, VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "LOW_SorcerousSundries_BannedSpotting", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_LOW_SorcerousSundries_ClerkWarnsBannedPlayers(_Var1, _Var2);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "LOW_SorcerousSundries_KlankBannedSpotting", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var2, 1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_KlankCheckpoint_275b16c1-85d5-90ea-ccba-0f1441a6b298, _Var1, _Var2, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
ShapeshiftChanged((CHARACTER)_Var1, _, _, _, (CHARACTER)_Var1)
AND
DB_InRegion(_Var1, S_LOW_SorcerousCheckpoint_ClerkSpotTrigger_21b5350e-7827-4894-a2d2-0d71849d2a4e, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_ClerkWarnsBannedPlayers(_Var5, _Var1);

IF
ShapeshiftChanged((CHARACTER)_Var1, _, _, _, (CHARACTER)_Var1)
AND
DB_InRegion(_Var1, S_LOW_SorcerousCheckpoint_PrimaryTrigger_1181722d-3b04-4ebc-be3c-9e9059ba451c, _Var1, _Var1, _Var1)
AND
DB_Sees(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_KlankCheckpoint_275b16c1-85d5-90ea-ccba-0f1441a6b298, S_LOW_Klank_73ce2a17-b63d-41a1-a3a6-007b88ed95d7, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_LOW_SorcerousSundries_ClerkWarnsBannedPlayers((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_ClerkCheckpointWarningDialogues(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_LOW_SorcerousSundries_ClerkWantsToWarn(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var3, _Var1, _Var2, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_LOW_SorcerousSundries_ClerkWantsToWarn((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_LOW_SorcerousSundries_ClerkWantsToWarn((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(LOW_SorcerousSundries_State_WaitingToBeWarned_11c39e25-12a2-4c8d-8658-69ca6f4bee1c, _Var1, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
GetFaction(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_BannedIFFoughtFactions(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_CharacterGetOwnerOrSelf(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_CharacterGetOwnerOrSelf(_Var5, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_ProdigyHasStayedAtRamazith_524ab56a-8169-4926-9105-8bcaf8c87499, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var5, 0, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var5);

IF
DB_LOW_SorcerousSundriesPuzzlePortals(_Var1, _, _Var1, _Var1, _Var1)
THEN
SetCanInteract(_Var1, 0);

IF
UseFinished((CHARACTER)_Var1, S_LOW_SorcerousSundries_BasementLever_8f45c625-cd2e-4de3-8b2b-e3e583209b9d, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_ActivateBasementRoute", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_ActivateBasementRoute();

IF
UseFinished((CHARACTER)_Var1, S_SorcSundries_BasementTeleport_002_3d37e42e-52de-4f0b-8f33-19c66df5cb17, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_ActivateBasementRoute", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_ActivateBasementRoute();

PROC
PROC_LOW_SorcerousSundries_ActivateBasementRoute()
THEN
SetCanInteract(S_LOW_SorcerousSundries_BasementLever_8f45c625-cd2e-4de3-8b2b-e3e583209b9d, 0);
SetCanInteract(S_SorcSundries_BasementTeleport_001_e3a08981-e43d-4a41-94dc-7af1aa378ece, 1);
ApplyStatus(S_SorcSundries_BasementTeleport_001_e3a08981-e43d-4a41-94dc-7af1aa378ece, "PUZ_CASTEDPORTAL_PURPLE", -1);
PROC_TryStartAD(GLO_AD_MechanicalClick_fc8d3dc5-b947-6354-3aa9-d1f02fd51af4, S_LOW_SorcerousSundries_BasementLever_8f45c625-cd2e-4de3-8b2b-e3e583209b9d);

IF
DialogEnded(LOW_SorcerousSundries_PuzzleGuardian_5423a690-96fd-9057-4068-0b51ba9c14c0, _, _, _, _)
AND
QRY_OnlyOnce("LOW_OskarsBeloved_RevealPortals", _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_ActivatePuzzlePortals();

PROC
PROC_LOW_SorcerousSundries_ActivatePuzzlePortals()
AND
DB_LOW_SorcerousSundriesPuzzlePortals(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, _Var2, -1);
SetCanInteract(_Var1, 1);

PROC
PROC_LOW_SorcerousSundries_ActivatePuzzlePortals()
AND
DB_LOW_SorcerousSundries_PuzzlePlaques(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(_Var1, "LIGHT", 0, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "LIGHT", -1);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Var1, S_LOW_PuzzleEntranceTrigger_63ded352-7943-43c9-844e-aa1673eb1388, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_Foop(S_LOW_LorroakanProjection_PuzzleGuardian_c65a2e91-34f1-4dd9-a784-2aca5a4d9cd2, VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);
PROC_TryStartAD(LOW_SorcerousSundries_AD_LorroakanProjectionPuzzle_05f9abef-2c51-5195-2496-494531b87c9c, S_LOW_LorroakanProjection_PuzzleGuardian_c65a2e91-34f1-4dd9-a784-2aca5a4d9cd2);
DB_SpotPlayers(S_LOW_LorroakanProjection_PuzzleGuardian_c65a2e91-34f1-4dd9-a784-2aca5a4d9cd2, "LOW_SorcerousSundries_PuzzleGuardian", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "LOW_SorcerousSundries_PuzzleGuardian", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_PuzzleGuardian_5423a690-96fd-9057-4068-0b51ba9c14c0, _Var1, _Var2, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EntityEvent((CHARACTER)_Var1, "LOW_PortalTeleported", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PlayEffect(_Var1, VFX_Script_Waypoint_Teleport_In_aaf7e739-11f9-7e5d-c453-fba37e542750, "", 1);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundriesPuzzlePortals(_Var2, _, _Var1, _Var1, _Var1)
AND
_Var2 != S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5
AND
GetPosition(S_LOW_SorcerousSundriesTeleportTo_769fa8ca-63f8-4364-b903-1f0190588db2, _Var4, _Var5, _Var6, _Var1)
AND
FindValidPosition(_Var4, _Var5, _Var6, 10, _Var1, 1, _Var7, _Var8, _Var9, _Var1)
THEN
PlayEffect(_Var1, VFX_Script_Waypoint_Teleport_In_aaf7e739-11f9-7e5d-c453-fba37e542750, "", 1);
PROC_Poof(_Var1);
TeleportToPosition(_Var1, _Var7, _Var8, _Var9, "LOW_SorcerousSundries_TeleportedOutside", 0, 0, 0, 0, 1);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_TeleportedOutside", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetHitpoints(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_Foop(_Var1, VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);
ApplyDamage(_Var1, _Var2, "Radiant", NULL_00000000-0000-0000-0000-000000000000);
DB_LOW_SorcerousSundries_Punishing(1);
TimerLaunch("LOW_SorcerousSundries_WaitToSpawnPunisher", 1000);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 0, _Var1, _Var1)
AND
DB_LOW_SorcerousSundriesPuzzlePortals(_Var2, _, _Var1, _Var1, _Var1)
AND
_Var2 != S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5
THEN
SetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundriesPuzzlePortals(_Var2, _, _Var1, _Var1, _Var1)
AND
_Var2 != S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5
AND NOT
DB_LOW_SorcerousSundries_Punishing(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_Punishing(1);

IF
TimerFinished("LOW_SorcerousSundries_WaitToSpawnPunisher", _, _, _, _)
THEN
TeleportTo(S_LOW_PuzzleGuardianTrigger_Punishment_2fd46708-ee60-4928-a6cc-4b8e38a0b733, S_LOW_LorroakanProjection_PuzzleGuardian_Punisher_ae4c07db-c5c3-4b83-9fb4-23854dda14c5);
PROC_Foop(S_LOW_LorroakanProjection_PuzzleGuardian_Punisher_ae4c07db-c5c3-4b83-9fb4-23854dda14c5, VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);
PROC_TryStartAD(LOW_SorcerousSundries_AD_GuardianWrongPortal_d4aaa2de-dcfc-14f5-6d26-4bcfdc9d96d7, S_LOW_LorroakanProjection_PuzzleGuardian_Punisher_ae4c07db-c5c3-4b83-9fb4-23854dda14c5);

IF
AutomatedDialogEnded(LOW_SorcerousSundries_AD_GuardianWrongPortal_d4aaa2de-dcfc-14f5-6d26-4bcfdc9d96d7, _, _, _, _)
AND
DB_LOW_SorcerousSundries_Punishing(1, _, _, _, _)
THEN
NOT DB_LOW_SorcerousSundries_Punishing(1);
PROC_Poof(S_LOW_LorroakanProjection_PuzzleGuardian_Punisher_ae4c07db-c5c3-4b83-9fb4-23854dda14c5, VFX_Spells_Cast_Intent_Summon_TargetSummon_Spawn_01_5ce52ddd-4c81-26d9-8b85-aa4ac4eb07be);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundriesPuzzlePlaques(_Var2, _Var3, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_PlaqueDescriptionBeingPlayed(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_PlaqueDescriptionBeingPlayed(1);
PROC_TryStartAD(_Var3, _Var1);

IF
AutomatedDialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_SorcerousSundriesPuzzlePlaques(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_PlaqueDescriptionBeingPlayed(1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_PlaqueDescriptionBeingPlayed(1);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_PortalTeleportedToRamazith", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_LorroakanIntroduction", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_StartedConfrontation(1, _Var1, _Var1, _Var1, _Var1)
THEN
ObjectTimerLaunch(_Var1, "LOW_SorcerousSundries_WaitPlayersTeleporting", 500);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "LOW_SorcerousSundries_WaitPlayersTeleporting", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_Lorroakan_b206fd7c-7992-6d5f-51f4-0943a92f3d48, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, S_LOW_LorroakanButler_637bb24f-66b7-4447-807b-556bd1c00ed6, S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db, _Var2)
THEN
DB_NOOP(1);

QRY
QRY_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, S_LOW_EntryRamazithTrigger_b3f97f64-d3d7-4f2b-9df8-87fd3767e532, 1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

QRY
QRY_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var3, S_LOW_EntryRamazithTrigger_b3f97f64-d3d7-4f2b-9df8-87fd3767e532, 1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(_Var3);

QRY
QRY_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(_, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, S_LOW_EntryRamazithTrigger_b3f97f64-d3d7-4f2b-9df8-87fd3767e532, 1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

QRY
QRY_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
_Var3 != _Var1
AND
IsInTrigger(_Var3, S_LOW_EntryRamazithTrigger_b3f97f64-d3d7-4f2b-9df8-87fd3767e532, 1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_SorcerousSundries_GetSpeakerForLorroakanInteraction(_Var3);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Var1, S_LOW_GaleCheckTrigger_41cf8357-fd36-4cd6-b28f-0bd321d27c3f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsPartyMember(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, 1, 0, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SorcerousSundries_AD_RamazithTowerNoGale_1d74c3c5-d3fb-0160-7bde-5d6cfd72098d, _Var1);

IF
DB_PermaDefeated(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
THEN
ClearFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92);
SetFlag(LOW_Aradin_State_IsPermaDefeated_f9fb4d8e-dfda-4457-a3de-1716cdb8d343);
PROC_TriggerUnregisterForPlayers(S_LOW_Aradin_ADTrigger_8329c11b-843d-4a16-9fd6-600e59972dce);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundries_NSNotices(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_Knows_AboutLorroakanGoingAfterNightsong_06fc1554-756a-4d3f-8560-5848313210fa, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_Knows_AboutLorroakanGoingAfterNightsong_06fc1554-756a-4d3f-8560-5848313210fa);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_LOW_SorcerousSundries_NightsongCampDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_Lorroakan_State_WaitingForCampNightsongDialog_ce238f16-8215-48f8-90b4-a503a4426efd, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartOfTheTeam(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_Nightsong_Knows_LorroakansPlan_00d4715e-55c1-483e-9d70-9abb2c9c1d81, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_SorcerousSundries_NightsongCamp_8a4dce9f-f256-fdfc-7ce4-28ece903328d, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _Var1);

IF
DialogStarted(LOW_SorcerousSundries_NightsongCamp_8a4dce9f-f256-fdfc-7ce4-28ece903328d, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_NightsongCampDialog", _, _, _, _)
THEN
DB_LOW_SorcerousSundries_NightsongCampDialogStarted(1);

IF
FlagSet(LOW_Lorroakan_Quest_WaitingForCampNightsongDialog_ce238f16-8215-48f8-90b4-a503a4426efd, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetHasDialog(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);
SetFlag(LOW_SorcerousSundries_Knows_AboutLorroakanGoingAfterNightsong_06fc1554-756a-4d3f-8560-5848313210fa);

IF
DB_GlobalFlag(LOW_SorcerousSundries_State_IsobelTalkedAfterNSReturns_89cd0844-d851-4b87-9ed6-6ef2570c5f0b, _, _, _, _)
THEN
PROC_RemoveDialogEntryForSpeaker(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, LOW_SorcerousSundries_IsobelCamp_f7674ec5-775e-1a91-5faa-cb3e0532aa67);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_Nightsong_Event_GoToRamazithTower_59fab159-060f-424c-9fd9-43cc00a88db9, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1, _, _, _, _)
THEN
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_Dialogs(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, LOW_SorcerousSundries_IsobelCamp_f7674ec5-775e-1a91-5faa-cb3e0532aa67);
ClearFlag(LOW_Aradin_State_AttackingCamp_81f0d1a8-6f8e-4872-ad70-b657ff2c60fd);
SetFlag(LOW_SorcerousSundries_Event_CampAttackAverted_f3441499-0574-48b0-bf5c-56615ee2d07e);
PROC_SorcerousSundries_NSLeaveToRamazith();

PROC
PROC_SorcerousSundries_NSLeaveToRamazith()
AND
DB_ActiveCamp("FARM", _, _, _, _)
THEN
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_SorcerousSundries_Farm_NightsongLeaveCampPos_7099c20c-2710-4575-9f32-d4780dfe5965, "Run", "LOW_NightsongMoveToEntryCamp");

PROC
PROC_SorcerousSundries_NSLeaveToRamazith()
AND
DB_ActiveCamp("ELFSONG", _, _, _, _)
THEN
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_NightsongLeaveCampPos_385051cc-92b6-4dcf-af63-3f0d84906849, "Run", "LOW_NightsongMoveToEntryCamp");

PROC
PROC_SorcerousSundries_NSLeaveToRamazith()
AND
DB_ActiveCamp("SLUMS", _, _, _, _)
THEN
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_SlumsPosition_NightsongLeave_0d373811-b182-40da-9763-defdf9a1997c, "Run", "LOW_NightsongMoveToEntryCamp");

IF
EntityEvent(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "LOW_NightsongMoveToEntryCamp", _, _, _)
AND NOT
DB_CurrentLevel("CTY_Main_A", _, _, _, _)
THEN
PROC_SetOnStage(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0);
PROC_SetRelationToPlayers(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 100);
DB_LOW_SorcerousSundries_NightsongWillGoToRamazith(1);

IF
DB_CurrentLevel("CTY_Main_A", _, _, _, _)
AND
DB_LOW_SorcerousSundries_NightsongWillGoToRamazith(1, _, _, _, _)
THEN
NOT DB_LOW_SorcerousSundries_NightsongWillGoToRamazith(1);
TimerLaunch("LOW_SorcerousSundries_NightsongFlying", 2000);

IF
EntityEvent(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "LOW_NightsongMoveToEntryCamp", _, _, _)
AND
DB_CurrentLevel("CTY_Main_A", _, _, _, _)
THEN
PROC_SetOnStage(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0);
PROC_SetRelationToPlayers(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 100);
TimerLaunch("LOW_SorcerousSundries_NightsongFlying", 7000);

IF
TimerFinished("LOW_SorcerousSundries_NightsongFlying", _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_SetRelationToPlayers(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 100);
ClearFlag(LOW_Lorroakan_Quest_WaitingForCampNightsongDialog_ce238f16-8215-48f8-90b4-a503a4426efd);
SetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_RamazithsJump_Start_12ca715e-872c-49be-93e1-65e17eacc8be, "LOW_SorcerousSundries_NightsongReadyToEnterRamazith", 0, 0, 0, 1, 1);

IF
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1, _, _, _, _)
AND NOT
DB_PermaDefeated(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _, _, _, _)
AND
DB_GlobalFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92, _, _, _, _)
THEN
PROC_NotifyWhenReadyToMoveOn(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, "LOW_SorcerousSundries_DisableAradin");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_SorcerousSundries_DisableAradin", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
ClearFlag(LOW_Aradin_State_IsAtSorcerousSundriesYelling_bdd65a61-c0fc-45d7-bf58-23ad26ea9d92);
SetFlag(LOW_Aradin_Event_LeaveSorcerousSundries_9b859898-5d65-4cfb-8b0b-fa3c93f9c752, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);
PROC_DisappearOutOfSightTo(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, S_LOW_AlarinLeaveTo_88109786-792a-4ac9-b565-6014e50e8ea4, "Run", 0, "");

IF
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
THEN
SetFlag(LOW_SorcerousSundries_Event_CampAttackAverted_f3441499-0574-48b0-bf5c-56615ee2d07e);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_AradinLeft", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(LOW_Aradin_Knows_BelievesNightsongIsAtCamp_aa7cc65a-3fb6-4bf7-aa65-c14b5c38df70, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0, _Var1, _Var1)
THEN
SetFlag(LOW_Aradin_State_AttackingCamp_81f0d1a8-6f8e-4872-ad70-b657ff2c60fd);

PROC
PROC_LOW_SorcerousSundries_InitThugs()
AND
DB_LOW_SorcerousSundries_AradinThugPositions(_Var1, _, _, _Var1, _Var1)
AND
_Var1 != S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c
THEN
DB_GLO_DefeatCounter(_Var1, "LOW_SorcerousSundries_AradinAttackers");
SetOnStage(_Var1, 0);

IF
DialogEnded(CAMP_SCO_AradinAttack_cdc441b1-9530-da70-d479-6c572b0fc5ee, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_SetRelationToPlayers(ACT1_DEN_Adventurers_d8ebdf1b-1362-460a-f51c-30ecd9b34e6b, 0);
PROC_SetRelationMutual(ACT1_DEN_Adventurers_d8ebdf1b-1362-460a-f51c-30ecd9b34e6b, GLO_CampFollowers_4bfd476c-55f7-48e5-b078-e71adfc4624d, 0);

PROC
PROC_LOW_SorcerousSundries_SetupAradinAttack()
AND NOT
DB_PermaDefeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
AND
DB_ActiveCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_AradinAttackNSPositions(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);
SetVisible(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _Var2);

IF
DialogEnded(CAMP_SCO_AradinAttack_cdc441b1-9530-da70-d479-6c572b0fc5ee, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogSpeakers(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 < 5
AND
DB_ActiveCamp(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_AradinAttackPlayerPositions(_Var5, _Var3, _Var4, _Var1, _Var1)
THEN
TeleportTo(_Var2, _Var5, "", 0, 1, 1, 0, 1);

PROC
PROC_CampNight_StartSelected()
AND
DB_Camp_QueuedNight(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, _, _, _, _)
THEN
DB_Camp_PreventEndOfNight(1);
ClearFlag(LOW_Lorroakan_Quest_WaitingForCampNightsongDialog_ce238f16-8215-48f8-90b4-a503a4426efd);
SetFlag(LOW_SorcerousSundries_State_NightOfAradinAttack_680a27a3-c15c-4e8d-8c39-f9bc781c1feb);
SetFlag(LOW_SorcerousSundries_State_AradinAttackActive_c48ecbe3-1e99-44fa-914b-57b4c3528b7c);

PROC
PROC_StartDialog_AddExtraSpeakers(CAMP_SCO_AradinAttack_cdc441b1-9530-da70-d479-6c572b0fc5ee, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_SpeakerIsAvailable(S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, S_DEN_AdventurerLeader_82d1b843-9e8c-48a5-9d87-caddea5c193c);

PROC
PROC_StartDialog_AddExtraSpeakers(CAMP_SCO_AradinAttack_cdc441b1-9530-da70-d479-6c572b0fc5ee, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_InCamp(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _Var1, _Var1, _Var1, _Var1)
AND
DB_ActiveCamp(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetFaction(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, GLO_CampFollowers_NightsongAlly_9cdafa70-823e-439e-9a46-cb7a4837c3fe);
PROC_DialogAddListeningActor(_Var1, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);

PROC
PROC_CampNight_StartSleepMoments_PreHook()
AND
DB_Camp_QueuedNight(NIGHT_AradinAndNightsong_dcacfee4-ee39-4c30-9301-84790c969113, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_SetupAradinAttack", _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_SetupAradinAttack();

PROC
PROC_LOW_SorcerousSundries_SetupAradinAttack()
AND
DB_ActiveCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_AradinThugPositions(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var2, _Var3);
PROC_SetOnStage(_Var2, 1);

IF
DB_GlobalFlag(LOW_SorcerousSundries_CampAttackEnded_d7c61ab3-c0c3-4b78-95c6-0144209f40a4, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Nightsong_Event_GoToRamazithTower_59fab159-060f-424c-9fd9-43cc00a88db9, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
THEN
ClearFlag(LOW_SorcerousSundries_State_AradinAttackActive_c48ecbe3-1e99-44fa-914b-57b4c3528b7c);
PROC_LOW_SorcerousSundries_MovingNightsongToPlayer();

PROC
PROC_LOW_SorcerousSundries_MovingNightsongToPlayer()
AND
QRY_Camp_GetPreferredPlayerForDialogs()
AND
DB_QRYRTN_Camp_GetPreferredPlayerForDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _Var1, "Run", "LOW_SorcerousSundries_NightsongPostCampDialog");

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_NightsongPostCampDialog", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_Camp_GetPreferredPlayerForDialogs()
AND
DB_QRYRTN_Camp_GetPreferredPlayerForDialogs(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsControlled(_Var2, 0, _Var1, _Var1, _Var1)
THEN
PROC_Camp_ForceAvatarControl();
SetEntityEvent(_Var1, "LOW_SorcerousSundries_NightsongPostCampDialog");

IF
EntityEvent((CHARACTER)_Var1, "LOW_SorcerousSundries_NightsongPostCampDialog", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_Camp_GetPreferredPlayerForDialogs()
AND
DB_QRYRTN_Camp_GetPreferredPlayerForDialogs(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsControlled(_Var2, 1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_NightsongPostAttack_42a7f9de-9883-9a29-20c0-721271188f18, _Var1, _Var2, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_NightOfAradinAttack_680a27a3-c15c-4e8d-8c39-f9bc781c1feb, _, _, _, _)
THEN
ClearFlag(LOW_SorcerousSundries_State_NightOfAradinAttack_680a27a3-c15c-4e8d-8c39-f9bc781c1feb);

IF
DialogEnded(CAMP_SCO_AradinAttack_cdc441b1-9530-da70-d479-6c572b0fc5ee, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_SetRelationMutual(ACT1_DEN_Adventurers_d8ebdf1b-1362-460a-f51c-30ecd9b34e6b, GLO_CampFollowers_4bfd476c-55f7-48e5-b078-e71adfc4624d, 0);
PROC_SetRelationMutual(ACT1_DEN_Adventurers_d8ebdf1b-1362-460a-f51c-30ecd9b34e6b, GLO_CampFollowers_4bfd476c-55f7-48e5-b078-e71adfc4624d, 0);

IF
DialogEnded(LOW_SorcerousSundries_Isobel_PostNightsongCaged_56dfe04d-a000-8f46-7784-ab75c4ae592c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_NotifyWhenReadyToMoveOn(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "LOW_SorcerousSundries_IsobelLeavesCamp");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_SorcerousSundries_IsobelLeavesCamp", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_ActiveCamp("ELFSONG", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSightTo(_Var1, S_LOW_NightsongLeaveCampPos_385051cc-92b6-4dcf-af63-3f0d84906849, "Run", 0, "LOW_SorcerousSundries_IsobelLeavesCamp");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_SorcerousSundries_IsobelLeavesCamp", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_ActiveCamp("SLUMS", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSightTo(_Var1, S_LOW_SlumsPosition_NightsongLeave_0d373811-b182-40da-9763-defdf9a1997c, "Run", 0, "LOW_SorcerousSundries_IsobelLeavesCamp");

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_IsobelLeavesCamp", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_LOW_SorcerousSundries_IsobelWentToRescueNightsong(1);
SetOnStage(_Var1, 0);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_NightsongReadyToEnterRamazith", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
RemoveStatus(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "FEATHER_FALL");
TriggerUnregisterForCharacter(LOW_NightsongJumpLandingTrigger_08afc265-38eb-4c44-8b47-c65b6673fd7d, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_Poof(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_RamazithsJump_End_c08a853e-e66b-4b52-87c5-f77a32e6225d, "", 0, 0, 0, 1, 1);
PROC_Foop(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
SetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302);
TimerLaunch("LOW_SorcerousSundries_GoToCenterTower", 500);

IF
TimerFinished("LOW_SorcerousSundries_GoToCenterTower", _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_NightsongAttack", _, _, _, _)
THEN
PROC_TriggerRegisterForPlayers(S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3);
DB_AddCharactersInTriggerToDialog(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, 1, 1, 1, 1);
DB_AddCharactersInTriggerToDialog(LOW_SorcerousSundries_NightsongSmash_ca824374-abdf-7094-9b35-2578466eb7b8, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, 1, 1, 1, 1);
PROC_TryStartAD(LOW_SorcerousSundries_AD_NightsongCallsLorroakan_83276954-fdb0-6013-e71e-d074315edf1f, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_CharacterMoveTo(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, S_LOW_LorroakanTeleportTo_0063de25-d5c9-4c10-b907-a9abbe246114, "Run", "LOW_SorcerousSundries_FinalConfronationReached");
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_NightsongLorrokananTeleportTo_5c68bfc2-7e9b-4856-8f69-81f75f65feae, "Run", "LOW_SorcerousSundries_FinalConfronationReached");

IF
EntityEvent(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "LOW_SorcerousSundries_FinalConfronationReached", _, _, _)
THEN
DB_LOW_SorcerousSundries_ReadyForConfrontation("Nightsong");

IF
EntityEvent(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "LOW_SorcerousSundries_FinalConfronationReached", _, _, _)
AND
QRY_LOW_SorcerousSundries_CheckRolanAvailableForConfrontation()
THEN
SetFaction(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e);
PROC_LOW_SorcerousSundries_ReplaceMainClerk(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
ClearFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
PROC_Foop(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
TeleportTo(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, S_LOW_RolanLorroakanTeleportTo_13708935-bd6f-4053-98e1-bd07a2aeab78, "LOW_SorcerousSundries_FinalConfronationReached");

QRY
QRY_LOW_SorcerousSundries_CheckRolanAvailableForConfrontation()
AND
DB_LOW_SorcerousSundries_CurrentMainClerk(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
AND
QRY_SpeakerIsAvailable(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime(_, (STRING)_Var2, _, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _)
AND
QRY_CRIME_IsAssaultOrMurder(_Var2, _, _, _, _)
AND
DB_InRegion(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, _, _, _)
AND
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationDialogStarted(1, _, _, _, _)
THEN
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1);
PROC_SetRelationMutual(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 0);
SetFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425);
PROC_LOW_SorcerousSundries_SetNightsongEnemy();

IF
RelationChanged(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, _, _)
AND
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationDialogStarted(1, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1, _, _, _, _)
THEN
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1);
PROC_SetRelationMutual(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 0);
SetFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);
PROC_LOW_SorcerousSundries_SetLorroakanEnemy();

IF
RelationChanged(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, _, _)
AND
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationDialogStarted(1, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1, _, _, _, _)
THEN
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1);
PROC_SetRelationMutual(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 0);
SetFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425);
PROC_LOW_SorcerousSundries_SetNightsongEnemy();

IF
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
THEN
SetFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);

IF
EntityEvent(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "LOW_SorcerousSundries_FinalConfronationReached", _, _, _)
THEN
SetFlag(LOW_Rolan_State_TeamLorroakan_757b39f2-7a4f-4465-b03c-46225e3bb37b, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_LOW_SorcerousSundries_RolanReachedRamaziths(1);
PROC_SetCustomTradeTreasure(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Empty");
ClearTag(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, ACT3_LOW_SORCEROUSSUNDRIES_VENDOR_9f66044c-876d-48cb-94c4-5b8c7a5f5d9e);
ClearTag(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, TRADER_91d5ebc6-91ea-44db-8a51-216860d69b5b);

IF
EntityEvent(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, "LOW_SorcerousSundries_FinalConfronationReached", _, _, _)
THEN
DB_LOW_SorcerousSundries_ReadyForConfrontation("Lorroakan");

IF
DB_LOW_SorcerousSundries_ReadyForConfrontation("Lorroakan", _, _, _, _)
AND
DB_LOW_SorcerousSundries_ReadyForConfrontation("Nightsong", _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationDialogStarted(1, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_StartedConfrontation(1, _, _, _, _)
THEN
DB_LOW_SorcerousSundries_StartedConfrontation(1);
PROC_TriggerRegisterForPlayers(S_LOW_ConfrontationTrigger_4f84cc91-7e65-4419-8f49-25157cdff76f);

IF
DB_LOW_SorcerousSundries_StartedConfrontation(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogNPCs(_Var1, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _, _Var1, _Var1)
AND
SpeakerGetDialog(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, 0, LOW_SorcerousSundries_Lorroakan_b206fd7c-7992-6d5f-51f4-0943a92f3d48, _Var3, _Var1)
AND
DB_DialogSpeakers(_Var3, _Var4, 4, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_InterruptedLorroakan(_Var4);
PROC_ForceStopDialog(_Var4);

IF
DialogEnded(LOW_SorcerousSundries_Lorroakan_b206fd7c-7992-6d5f-51f4-0943a92f3d48, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_SorcerousSundries_InterruptedLorroakan(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SorcerousSundries_InterruptedLorroakan(_Var2);
PROC_LOW_SorcerousSundries_StartDialogConfrontation(_Var2);

PROC
PROC_LOW_SorcerousSundries_StartDialogConfrontation((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_RolanReachedRamaziths(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, NULL_00000000-0000-0000-0000-000000000000, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var1)
THEN
DB_NOOP(1);

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_ConfrontationTrigger_4f84cc91-7e65-4419-8f49-25157cdff76f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_LOW_SorcerousSundries_StartDialogConfrontation(_Var1);

PROC
PROC_LOW_SorcerousSundries_StartDialogConfrontation((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationCanceled(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_FinalConfrontationDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_RolanReachedRamaziths(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var1)
THEN
DB_NOOP(1);

IF
DialogStarted(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
DB_LOW_SorcerousSundries_FinalConfrontationDialogStarted(1);
PROC_TriggerUnregisterForPlayers(S_LOW_ConfrontationTrigger_4f84cc91-7e65-4419-8f49-25157cdff76f);

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_PermaDefeated(S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db);

IF
DialogEnded(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_SetRelationMutual(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 0);

IF
DialogEnded(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425, _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_SetNightsongEnemy();

PROC
PROC_LOW_SorcerousSundries_SetNightsongEnemy()
THEN
PROC_SetRelationToPlayers(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 0);
PROC_SetRelationToPlayers(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, 100);
DB_GLO_DefeatCounter(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "LOW_SorcerousSundries_FinalConfrontationEnemies");

IF
DialogEnded(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b, _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_SetLorroakanEnemy();

PROC
PROC_LOW_SorcerousSundries_SetLorroakanEnemy()
THEN
PROC_SetRelationToPlayers(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, 0);
PROC_SetRelationToPlayers(ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 100);
DB_GLO_DefeatCounter(S_LOW_LorroakanFireMyrmidon_4f9f5fc9-45a7-412d-b388-f8e31a2d1c6b, "LOW_SorcerousSundries_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_LorroakanWaterMyrmidon_b9ed09f3-e67e-4498-aa24-5fecec718c07, "LOW_SorcerousSundries_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_LorroakanEarthMyrmidon_fb67df58-9801-4661-bfa7-460c5f02b0bc, "LOW_SorcerousSundries_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_LorroakanAirMyrmidon_fe3ad530-4bc1-436b-bffa-0e3d83a75782, "LOW_SorcerousSundries_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db, "LOW_SorcerousSundries_FinalConfrontationEnemies");
DB_GLO_DefeatCounter(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, "LOW_SorcerousSundries_FinalConfrontationEnemies");

PROC
PROC_LOW_SorcerousSundries_SetLorroakanEnemy()
AND NOT
DB_LOW_SorcerousSundries_RolanReachedRamaziths(1, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
AND
DB_GlobalFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, _, _, _, _)
THEN
PROC_ForceStopDialog(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
ClearFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_Dialogs(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, LOW_SorcerousSundries_RolanConclusion_7c012f1d-28c3-e97c-e127-f871c2e33aa7);
PROC_Poof(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
PROC_LOW_SorcerousSundries_ReplaceMainClerk(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
TeleportTo(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, "LOW_SorcerousSundries_FinalConfronationReached", 0, 0, 1, 0, 1);
PROC_Foop(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
SetFaction(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e);
NOT DB_GLO_DefeatCounter(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "LOW_SorcerousSundries_ShopCombatant");
DB_GLO_DefeatCounter(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "LOW_SorcerousSundries_FinalConfrontationEnemies");
PROC_SetRelationMutual(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, 100);
PROC_SetRelationMutual(ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 0);

IF
DialogEnded(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, _, _, _, _)
AND
DB_LOW_SorcerousSundries_RolanReachedRamaziths(1, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b, _, _, _, _)
AND
GetFlag(LOW_Rolan_State_TeamLorroakan_757b39f2-7a4f-4465-b03c-46225e3bb37b, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 1, _, _)
THEN
DB_GLO_DefeatCounter(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "LOW_SorcerousSundries_FinalConfrontationEnemies");

IF
DialogEnded(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, _, _, _, _)
AND
GetFlag(LOW_Rolan_State_TeamLorroakan_757b39f2-7a4f-4465-b03c-46225e3bb37b, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 0, _, _)
THEN
PROC_SetRelationMutual(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, 0);
PROC_SetRelationMutual(ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 100);
PROC_SetRelationToPlayers(ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, 100);

IF
DialogEnded(LOW_SorcerousSundries_FinalConfrontation_1262c57a-9370-245b-dd1c-ce7f9b3a360c, _, _, _, _)
AND
GetFlag(LOW_Rolan_State_TeamLorroakan_757b39f2-7a4f-4465-b03c-46225e3bb37b, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 1, _, _)
THEN
PROC_SetRelationMutual(ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, ACT1_SHA_Nightsong_89d54194-f9fd-4a99-879a-e11971bfe3e4, 0);
PROC_SetRelationMutual(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, 100);

IF
DB_PermaDefeated(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1, _, _, _, _)
AND
GetFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, 1, _, _)
THEN
TimerLaunch("LOW_SorcerousSundries_DelayBeforeRolanInvestigates", 3000);

IF
TimerFinished("LOW_SorcerousSundries_DelayBeforeRolanInvestigates", _, _, _, _)
AND NOT
DB_LorroakanCombatClosePortalID(_, _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_RolanTryTeleportToRamazith(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

IF
TimerFinished("LOW_SorcerousSundries_DelayBeforeRolanInvestigates", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LorroakanCombatClosePortalID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var1);

IF
DB_Is_InCombat(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0, _Var1, _Var1)
AND NOT
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var1);

IF
SwitchedCombat(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, (GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var1);
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var2);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Defeated(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_BlockedWaypointZone(S_LOW_RamaitzhsTower_RegionTrigger_8d737a4c-9b13-4935-9ce0-34520a2de266);
PROC_LOW_SorcerousSundries_RolanTryTeleportToRamazith(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

IF
DB_PermaDefeated(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Rolan_State_IsDead_47b8a371-e4a9-40e6-bc0f-18ac582142b9, _, _, _, _)
THEN
SetFlag(LOW_Rolan_State_RolanInChargeOfShop_d76ad357-97d9-49cc-bdb5-620e9a8242a5);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SorcerousSundries_LorroakanCombatBeforeNightsong(_Var1);

IF
LongRestFinished()
AND NOT
DB_PermaDefeated(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
AND
DB_LOW_SorcerousSundries_RolanWillTeleportToRamaziths(1, _, _, _, _)
THEN
NOT DB_LOW_SorcerousSundries_RolanWillTeleportToRamaziths(1);
PROC_LOW_SorcerousSundries_RolanTeleportToRamazith(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

PROC
PROC_LOW_SorcerousSundries_RolanTryTeleportToRamazith((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_LOW_SorcerousSundries_RolanWillTeleportToRamaziths(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SorcerousSundries_RolanWillTeleportToRamaziths(1);

PROC
PROC_LOW_SorcerousSundries_RolanTryTeleportToRamazith((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_LOW_SorcerousSundries_RolanWillTeleportToRamaziths(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "LOW_SorcerousSundries_RolanWillTeleportWhenAvailalble");

PROC
PROC_ReadyToMoveOn_Failed((CHARACTER)_Var1, "LOW_SorcerousSundries_RolanWillTeleportWhenAvailalble", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_LOW_SorcerousSundries_RolanWillTeleportToRamaziths(1);

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_SorcerousSundries_RolanWillTeleportWhenAvailalble", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_LOW_SorcerousSundries_RolanTeleportToRamazith(_Var1);

PROC
PROC_LOW_SorcerousSundries_RolanTryTeleportToRamazith((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_RolanTeleportToRamazith(_Var1);

PROC
PROC_LOW_SorcerousSundries_RolanTeleportToRamazith((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_RolanChecksInOnLorroakan", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSudries_State_RolanWantsToInterrogate_0b3c14e8-628a-42e7-9886-691958d671d1);
ClearFlag(LOW_Rolan_State_RolanAtTheShop_cd1aa0f6-c061-48e3-8222-ac648a66d3ca, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
PROC_RemoveAllDialogEntriesForSpeaker(_Var1);
DB_Dialogs(_Var1, LOW_SorcerousSundries_RolanConclusion_7c012f1d-28c3-e97c-e127-f871c2e33aa7);
PROC_Poof(_Var1);
PROC_LOW_SorcerousSundries_ReplaceMainClerk(S_LOW_LorroakanProjection_7929fdf5-73f4-43e4-9375-13c965685af2);
TeleportTo(_Var1, S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, "LOW_SorcerousSundries_RolanTeleportedToRamazith", 0, 0, 1, 0, 1);
PROC_Foop(_Var1);
SetFaction(_Var1, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e);
PROC_TryStartAD(LOW_SorcerousSundries_AD_RolanReactLorroakanDeath_cf7320b0-8c28-e146-4c36-d0a06648fe9e, _Var1);
NOT DB_GLO_DefeatCounter(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "LOW_SorcerousSundries_ShopCombatant");

IF
EntityEvent((CHARACTER)_Var1, "LOW_SorcerousSundries_RolanTeleportedToRamazith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_SpotPlayers(_Var1, "LOW_SorcerousSundries_RolanSpotsPlayers", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(_Var1, "LOW_SorcerousSundries_RolanSpotsPlayers");
PROC_SetCustomTradeTreasure(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "Empty");
ClearTag(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, ACT3_LOW_SORCEROUSSUNDRIES_VENDOR_9f66044c-876d-48cb-94c4-5b8c7a5f5d9e);
ClearTag(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, TRADER_91d5ebc6-91ea-44db-8a51-216860d69b5b);

QRY
QRY_CRIME_BlockRegisterCrime(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, (STRING)_Var1, _, (CHARACTER)_Var3, (INTEGER)_Var4)
AND
GetFaction(_Var3, Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_SorcerousSudries_State_RolanWantsToInterrogate_0b3c14e8-628a-42e7-9886-691958d671d1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_Nightsong_Quest_HasGoneToConfrontLorroakan_ed98ef99-f229-44d4-b020-62c415dba302, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "LOW_SorcerousSundries_RolanSpotsPlayers", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PurgeOsirisQueue(_Var1);
PROC_CharacterMoveToAndTalk(_Var1, _Var2, LOW_SorcerousSundries_RolanConclusion_7c012f1d-28c3-e97c-e127-f871c2e33aa7, "LOW_SorcerousSundries_RolanGoesToInterrogate", "Run", 20);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_RolanGoesToInterrogate", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_SpotPlayers_StopSpotting("LOW_SorcerousSundries_RolanSpotsPlayers");

IF
EntityEvent((CHARACTER)_Var1, "LOW_SorcerousSundries_RolanTeleportedToRamazith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PurgeOsirisQueue(_Var1);
PROC_CharacterMoveTo(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, "Run", "LOW_SorcerousSundries_RolanRunToLorroakan");

IF
RelationChanged(Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, (FACTION)_Var1, 0, 0, (FACTION)_Var1)
AND
FactionGetParentFaction(_Var1, 1, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var1, _Var1)
THEN
PROC_SetRelationMutual(Hero_a1542c81-6895-929e-4522-10ce218bb360, Act3_LOW_Lorroakan_d6228e4a-48c0-4f03-869c-606b13558f2e, 0);

IF
RelationChanged(ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, (FACTION)_Var1, 0, 0, (FACTION)_Var1)
AND
FactionGetParentFaction(_Var1, 1, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var1, _Var1)
THEN
PROC_SetRelationMutual(Hero_a1542c81-6895-929e-4522-10ce218bb360, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e, 0);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_LOW_RamaitzhsTower_RegionTrigger_8d737a4c-9b13-4935-9ce0-34520a2de266, _Var1, _Var1, _Var1)
AND NOT
DB_LorroakanCombatClosePortalID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LorroakanCombatClosePortalID(_Var2);

IF
DB_LorroakanCombatClosePortalID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "PUZ_CASTEDPORTAL_BLUE", 1, _Var1, _Var1)
THEN
RemoveStatus(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "PUZ_CASTEDPORTAL_BLUE");
SetCanInteract(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, 0);

IF
DB_LorroakanCombatClosePortalID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, "PUZ_CASTEDPORTAL_BLUE", 1, _Var1, _Var1)
THEN
RemoveStatus(S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, "PUZ_CASTEDPORTAL_BLUE");
SetCanInteract(S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, 0);

IF
SwitchedCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LorroakanCombatClosePortalID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LorroakanCombatClosePortalID(_Var2);
DB_LorroakanCombatClosePortalID(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LorroakanCombatClosePortalID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Defeated(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_LOW_Miklaur_637bb24f-66b7-4447-807b-556bd1c00ed6, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSightTo(S_LOW_Miklaur_637bb24f-66b7-4447-807b-556bd1c00ed6, S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "Run", 1, "");

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LorroakanCombatClosePortalID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, "PUZ_CASTEDPORTAL_BLUE", 0, _Var1, _Var1)
THEN
ApplyStatus(S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, "PUZ_CASTEDPORTAL_BLUE", -1);
SetCanInteract(S_LOW_PortalToShop_46d33205-1dc4-43a8-8153-3bb95bc1e3ec, 1);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LorroakanCombatClosePortalID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasAppliedStatus(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "PUZ_CASTEDPORTAL_BLUE", 0, _Var1, _Var1)
THEN
ApplyStatus(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, "PUZ_CASTEDPORTAL_BLUE", -1);
SetCanInteract(S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5, 1);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LorroakanCombatClosePortalID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LorroakanCombatClosePortalID(_Var1);

IF
DB_Is_InCombat(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_StartFinalConfrontationCombat", _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "GLO_NIGHTSONG_RESURRECTION");
DB_LOW_SorcerousSundries_LorroakanNighsongCombatID(_Var1);
DB_LOW_SorcerousSundries_NightsongImpededByLorroakan(1);
DB_KeepDialogsOnDeath(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);

IF
SwitchedCombat(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, (GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_LorroakanNighsongCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SorcerousSundries_LorroakanNighsongCombatID(_Var1);
DB_LOW_SorcerousSundries_LorroakanNighsongCombatID(_Var2);

IF
DB_Defeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
AND NOT
DB_PermaDefeated(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _, _, _, _)
THEN
PurgeOsirisQueue(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9);
PROC_NotifyWhenReadyToMoveOn(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, "LOW_SorcerousSundries_ReadyToMoveToNightsongsCorpse");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_SorcerousSundries_ReadyToMoveToNightsongsCorpse", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInTrigger(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, 1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "Run", "LOW_SorcerousSundries_ReachedNightsongsCorpse");

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_ReachedNightsongsCorpse", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_TryStartAD(LOW_SorcerousSundries_AD_LorroakanPostConfrontation_2d02afae-1f6e-4884-5025-03d5c83f2a00, _Var1);

IF
DB_LOW_SorcerousSundries_FinalConfrontationCombatEnded(1, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425, _, _, _, _)
AND
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND
DB_LOW_SorcerousSundries_NightsongImpededByLorroakan(1, _, _, _, _)
THEN
NOT DB_LOW_SorcerousSundries_NightsongImpededByLorroakan(1);
PROC_LOW_SorcerousSundries_HandleNightsongVictory();

PROC
PROC_LOW_SorcerousSundries_HandleNightsongVictory()
AND
QRY_SorcerousSundries_NightsongCanSmashLorro()
AND NOT
DB_Defeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
THEN
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, "Run", "LOW_SorcerousSundries_ReadyToSmashLorroakan");

IF
DB_LOW_SorcerousSundries_FinalConfrontationCombatEnded(1, _, _, _, _)
AND
DB_Defeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
AND
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_NightsongGetsUpAfterCombat", _, _, _, _)
THEN
ClearFlag(LOW_SorcerousSundries_State_ReadyToCageNightsong_2ce45480-d094-471a-b7eb-77d9f5150662);
PROC_CharacterFullRestore(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
TimerLaunch("LOW_SorcerousSundries_NightsongRecovering", 2000);

IF
TimerFinished("LOW_SorcerousSundries_NightsongRecovering", _, _, _, _)
THEN
PROC_NotifyWhenReadyToMoveOn(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "LOW_SorcerousSundries_SmashAfterRecover");

PROC
PROC_ReadyToMoveOn(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "LOW_SorcerousSundries_SmashAfterRecover", _, _, _)
AND
QRY_SorcerousSundries_NightsongCanSmashLorro()
AND
QRY_OnlyOnce_Reset("LOW_SorcerousSundries_NightsongSmash", _, _, _, _)
THEN
PROC_CharacterMoveTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, "Run", "LOW_SorcerousSundries_ReadyToSmashLorroakan");

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_ReadyToSmashLorroakan", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_NightsongSmash", _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_NightsongSmash_ca824374-abdf-7094-9b35-2578466eb7b8, _Var1, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var2, _Var1)
THEN
DB_AddCharactersInTriggerToDialog(LOW_SorcerousSundries_NightsongSmash_ca824374-abdf-7094-9b35-2578466eb7b8, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, 1, 1, 1, 1);
SetFlag(LOW_SorcerousSundries_Event_LorroakanSmash_2bd7d7ea-709f-4e9d-974d-917c2911d5cd);

IF
DialogEnded(LOW_SorcerousSundries_NightsongSmash_ca824374-abdf-7094-9b35-2578466eb7b8, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Lorroakan_State_IsDead_7bc03119-8aaa-458d-b795-fd2e2523d3b8, _, _, _, _)
THEN
Die(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, 0, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0, 1, 1);

QRY
QRY_SorcerousSundries_NightsongCanSmashLorro()
AND
DB_Defeated(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _, _, _, _)
AND
QRY_SorcerousSundries_LorroakanBodySmashable()
AND
IsInTrigger(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, 1, _, _)
AND
IsInTrigger(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, 1, _, _)
THEN
DB_NOOP(1);

QRY
QRY_SorcerousSundries_LorroakanBodySmashable()
AND
DB_Defeated(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _, _, _, _)
AND NOT
DB_Dead(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_SorcerousSundries_LorroakanBodySmashable()
AND
IsFreshCorpse(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, 1, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_SorcerousSundries_LorroakanBodySmashable()
AND
GetDeathType(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_HeadRemoval_NotFreshButFineDeathType(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_GLO_DefeatCounter_AllDefeated("LOW_SorcerousSundries_FinalConfrontationEnemies", _, _, _, _)
AND
DB_GlobalFlag(LOW_Lorroakan_State_IsDead_7bc03119-8aaa-458d-b795-fd2e2523d3b8, _, _, _, _)
AND
QRY_SpeakerIsAvailable(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_RolanReactToLorroakanDeath", _, _, _, _)
THEN
PROC_TryStartAD(LOW_SorcerousSundries_AD_RolanWithoutLorroakanAfterCombat_ee2f41e3-455d-63d7-d53a-b07d82cf0be3, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);

IF
DB_LOW_SorcerousSundries_IsobelPermaDefeatedAtCamp(1, _, _, _, _)
AND
DB_LOW_SorcerousSundries_FinalConfrontationCombatEnded(1, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b, _, _, _, _)
THEN
ClearFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);

PROC
PROC_GLO_DefeatCounter_AllDefeated("LOW_SorcerousSundries_FinalConfrontationEnemies", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_LorroakanNighsongCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_SetupConclusion(_Var1);

PROC
PROC_LOW_SorcerousSundries_SetupConclusion((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_Conclude", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_Event_CampAttackAverted_f3441499-0574-48b0-bf5c-56615ee2d07e);
ClearFlag(LOW_Aradin_State_AttackingCamp_81f0d1a8-6f8e-4872-ad70-b657ff2c60fd);
DB_LOW_SorcerousSundries_FinalConfrontationCombatEnded(1);
NOT DB_LOW_SorcerousSundries_LorroakanNighsongCombatID(_Var1);
NOT DB_BlockedWaypointZone(S_LOW_RamaitzhsTower_RegionTrigger_8d737a4c-9b13-4935-9ce0-34520a2de266);
PROC_LOW_SorcerousSundries_AssignConclusionDialogs();
TriggerUnregisterForCharacter(S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
TriggerUnregisterForCharacter(S_LOW_UpperFloorRamazithTrigger_a7f7011a-b019-4cb1-b1c8-78308a9758a3, S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9);

PROC
PROC_LOW_SorcerousSundries_AssignConclusionDialogs()
THEN
NOT DB_BlockedWaypointZone(S_LOW_RamaitzhsTower_RegionTrigger_8d737a4c-9b13-4935-9ce0-34520a2de266);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_Dialogs(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, LOW_SorcerousSundries_RolanConclusion_7c012f1d-28c3-e97c-e127-f871c2e33aa7);
PROC_RemoveAllDialogEntriesForSpeaker(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9);
DB_Dialogs(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, LOW_SorcerousSundries_LorroakanConclusion_b6642d43-ba6f-b22b-9527-3a4a909e048a);

PROC
PROC_LOW_SorcerousSundries_AssignConclusionDialogs()
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_Dialogs(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, LOW_SorcerousSundries_NightsongConclusion_8d310f9d-4608-5947-811b-40ef291db5a9);

PROC
PROC_LOW_SorcerousSundries_AssignConclusionDialogs()
AND
DB_Defeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425, _, _, _, _)
THEN
DB_DoNotRemoveKnockedOutCharacterOnLongRest(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
SetFlag(LOW_SorcerousSundries_State_ReadyToCageNightsong_2ce45480-d094-471a-b7eb-77d9f5150662);

PROC
PROC_Camp_EnterNightMode()
AND
DB_OnlyOnce("LOW_SorcerousSundries_Conclude", _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_HandleDayAfterConfrontation", _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_LongRestAfterConfrontation();

PROC
PROC_Camp_EnterNightMode()
AND
DB_LOW_SorcerousSundries_LorroakanNighsongCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_HandlingConfrontationNotFinished", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_SorcerousSundries_SetupConclusion(_Var1);
PROC_LOW_SorcerousSundries_LongRestAfterConfrontation();

PROC
PROC_LOW_SorcerousSundries_LongRestAfterConfrontation()
AND NOT
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND
DB_Defeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
THEN
DB_LOW_SorcerousSundries_NightsongCaged(1);
SetFaction(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, ACT3_LOW_SorcerousSundries_CagedNightsong_35fa7174-c563-4226-9c3d-50779c0405b6);
PROC_SetCanFight(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0);
SetCanJoinCombat(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0);
PROC_CharacterFullRestore(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_Dialogs(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, LOW_SorcerousSundries_NightsongCaged_ad21d48e-2793-6ac6-eba7-c94f4da2ab29);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_LorroakanSoulCagePosition_e1e9ccf3-831a-490e-919d-1e9e7c90cfd8);
ApplyStatus(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "SHA_NIGHTSONG_SOULCAGE", -1, 1);
SetFlag(LOW_SorcerousSundries_State_NightsongCaged_d9739530-c72a-4ad8-96f0-7ec71bbcfd98);
PROC_SetOnStage(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);
PROC_SetOnStage(LOW_SorcerousSundries_LorroakanSoulCage_33fab5d8-f1e3-45ad-8f62-1247f7eadd37, 1);
PROC_SetOnStage(LOW_SorcerousSundries_LorroakanSoulCage_Unfinished_26101e55-e8dd-498a-b2b5-d1d26c9b9a99, 0);
ApplyStatus(S_LOW_Lorroakan_a9d4b71d-b0ef-429e-8210-6dc8be986ee9, "LOW_SORRCEROUSSUNDRIES_INVULNERABLE", -1, 1);
DB_NoLowAttitudeDialog(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_Dialogs(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, LOW_SorcerousSundries_NightsongCaged_ad21d48e-2793-6ac6-eba7-c94f4da2ab29);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_Dialogs(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, LOW_SorcerousSundries_Isobel_PostNightsongCaged_56dfe04d-a000-8f46-7784-ab75c4ae592c);

IF
DB_PermaDefeated(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_IsobelWentToRescueNightsong(1, _, _, _, _)
THEN
DB_LOW_SorcerousSundries_IsobelPermaDefeatedAtCamp(1);

PROC
PROC_Camp_EnterNightMode()
AND NOT
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithLorroakan_24c45d86-9027-48cc-afdd-3e6bac7d5425, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b, _, _, _, _)
AND
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_IsobelPermaDefeatedAtCamp(1, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_BringBackNSFromRamazith", _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_BringNightsongBack();
SetFlag(LOW_SorcerousSundries_State_NSReturnedFromRamazith_b7cbc725-249c-48ba-9146-6cf9292c4c0c);

PROC
PROC_Camp_EnterNightMode()
AND
DB_LOW_SorcerousSundries_NightsongGoToRamaziths(1, _, _, _, _)
AND
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND
DB_LOW_SorcerousSundries_IsobelPermaDefeatedAtCamp(1, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_BringBackNSFromRamazith", _, _, _, _)
THEN
PROC_SetOnStage(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0);
PROC_SetOnStage(S_LOW_NightsongThreat_d9df0940-238f-4451-a312-d2847ee04f9a, 1);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_SorcerousSundries_AngryNightsongAsylum_a76e7ee2-4d88-4977-977e-0dafb5f9662d);
ClearFlag(LOW_SorcerousSundries_State_PlayersSideWithNightsong_992ec758-9536-40ce-9a45-72193c81ec1b);

PROC
PROC_LOW_SorcerousSundries_BringNightsongBack()
AND
QRY_LOW_SorcerousSundries_IsobelInCampAndWell()
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_Dialogs(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, LOW_SorcerousSundries_NightsongAndIsobelCampAfterFight_5c788540-1b65-2b31-8814-450e72458314);

PROC
PROC_LOW_SorcerousSundries_BringNightsongBack()
AND NOT
QRY_LOW_SorcerousSundries_IsobelInCampAndWell()
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
DB_Dialogs(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, CAMP_Nightsong_60070e0f-0ab6-f653-7962-c2fff93b5a2d);

QRY
QRY_LOW_SorcerousSundries_IsobelInCampAndWell()
AND
DB_InCamp(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_LOW_SorcerousSundries_BringNightsongBack()
AND
DB_ActiveCamp("ELFSONG", _, _, _, _)
THEN
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_CAMP_ELFSONG_Nightsong_c3d038d1-6ee8-48fa-af62-8fff2c05e7e7);

PROC
PROC_LOW_SorcerousSundries_BringNightsongBack()
AND
DB_ActiveCamp("SLUMS", _, _, _, _)
THEN
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_CAMP_SLUMS_Nightsong_40a64565-aabf-4b4f-b223-04c7bf0e3a40);

PROC
PROC_LOW_SorcerousSundries_BringNightsongBack()
AND
DB_ActiveCamp("FARM", _, _, _, _)
THEN
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_CAMP_FARM_Nightsong_e91d0544-ffe7-4daf-9d12-49a554ca9d18);

PROC
PROC_LongRest()
AND
DB_LOW_SorcerousSundries_IsobelWentToRescueNightsong(1, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_IsobelGoesToRamazith", _, _, _, _)
THEN
NOT DB_LOW_SorcerousSundries_IsobelWentToRescueNightsong(1);
TeleportTo(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, LOW_IsobelDeathTriggerPosition_f7133aaf-4b01-440e-90d3-a0f9476be56f, "", 0, 0, 1);
PROC_SetOnStage(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 1);
Die(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_CorpseCleanup_Ignore(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
SetFlag(LOW_Isobel_State_GotKilledInRamazith_a9139bad-5d46-40ef-824d-fc3a3e09a1ef);

PROC
PROC_Camp_EnterNightMode()
AND
QRY_LOW_SorcerousSundries_IsobelWaitsForNSNews()
AND
DB_LOW_SorcerousSundries_DaysPostCaging(1, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_SecondDayPostCaging", _, _, _, _)
THEN
NOT DB_PartOfTheTeam(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
TeleportTo(S_LOW_SorcerousSundries_IsobelThreat_807ee341-d395-43a8-9cbd-8d2eef9026da, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "", 0, 0, 0, 0, 1);
PROC_SetOnStage(S_LOW_SorcerousSundries_IsobelThreat_807ee341-d395-43a8-9cbd-8d2eef9026da, 1);
PROC_SetOnStage(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 0);

PROC
PROC_LongRest()
AND
QRY_LOW_SorcerousSundries_IsobelWaitsForNSNews()
AND
QRY_OnlyOnce("LOW_SorcerousSundries_FirstDayPostCaging", _, _, _, _)
THEN
DB_LOW_SorcerousSundries_DaysPostCaging(1);

QRY
QRY_LOW_SorcerousSundries_IsobelWaitsForNSNews()
AND NOT
DB_PermaDefeated(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, _, _, _)
AND
DB_PartOfTheTeam(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, _, _, _)
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_NightsongCaged_d9739530-c72a-4ad8-96f0-7ec71bbcfd98, _, _, _, _)
AND NOT
DB_LOW_SorcerousSundries_PlayerTalkedToIsobelPostCaging(1, _, _, _, _)
THEN
DB_NOOP(1);

IF
DialogStarted(LOW_SorcerousSundries_Isobel_PostNightsongCaged_56dfe04d-a000-8f46-7784-ab75c4ae592c, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_IsobelGetsNewsPostCaging", _, _, _, _)
THEN
DB_LOW_SorcerousSundries_PlayerTalkedToIsobelPostCaging(1);

PROC
PROC_LongRest()
AND
DB_LOW_SorcerousSundries_NightsongCaged(1, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_RolanBackToShop", _, _, _, _)
THEN
DB_GLO_DefeatCounter(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "LOW_SorcerousSundries_ShopCombatant");
PROC_Poof(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
SetFaction(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, ACT3_LOW_SorcerousSundries_Shop_0a2e84ee-30af-49a7-9216-935318f1eae1);
TeleportTo(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, S_LOW_RolanTeleportTo_c76eb1ca-e97e-4b27-ad8d-51e4cc4fd381);
PROC_LOW_SorcerousSundries_ReplaceMainClerk(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_Dialogs(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, LOW_SorcerousSundries_Rolan_c6d83bfb-ed34-af42-dbff-506114212e96);
PROC_SetCustomTradeTreasure(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, "LOW_SorcerousSundries_Trade");
SetTag(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, ACT3_LOW_SORCEROUSSUNDRIES_VENDOR_9f66044c-876d-48cb-94c4-5b8c7a5f5d9e);
SetTag(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b, TRADER_91d5ebc6-91ea-44db-8a51-216860d69b5b);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_Rolan_State_RolanInChargeOfShop_d76ad357-97d9-49cc-bdb5-620e9a8242a5, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_RolanTakeover", _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_RolanTakeover();

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_SorcerousSundries_State_ReadyToCageNightsong_2ce45480-d094-471a-b7eb-77d9f5150662, _, _, _, _)
AND
DB_GlobalFlag(LOW_Lorroakan_State_IsPermadefeated_2c446081-2f24-49c4-84d9-b8f64a3d3098, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_FreeNightsong", _, _, _, _)
THEN
PROC_LOW_SorcerousSundries_FreeNightsong();

PROC
PROC_LOW_SorcerousSundries_FreeNightsong()
THEN
PROC_SetOnStage(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 0);
PROC_SetOnStage(LOW_SorcerousSundries_LorroakanSoulCage_33fab5d8-f1e3-45ad-8f62-1247f7eadd37, 0);
PROC_SetOnStage(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 0);
PROC_SetOnStage(S_LOW_NightsongThreat_d9df0940-238f-4451-a312-d2847ee04f9a, 1);
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_LOW_SorcerousSundries_AngryNightsongAsylum_a76e7ee2-4d88-4977-977e-0dafb5f9662d);
TeleportTo(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_LOW_SorcerousSundries_AngryNightsongAsylum_a76e7ee2-4d88-4977-977e-0dafb5f9662d);
NOT DB_PartOfTheTeam(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
NOT DB_PartOfTheTeam(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b);
Die(S_LOW_LorroakanFireMyrmidon_4f9f5fc9-45a7-412d-b388-f8e31a2d1c6b);
Die(S_LOW_LorroakanWaterMyrmidon_b9ed09f3-e67e-4498-aa24-5fecec718c07);
Die(S_LOW_LorroakanEarthMyrmidon_fb67df58-9801-4661-bfa7-460c5f02b0bc);
Die(S_LOW_LorroakanAirMyrmidon_fe3ad530-4bc1-436b-bffa-0e3d83a75782);
Die(S_LOW_Krank_47a3de7a-049b-462d-b526-60a178a649db);
Die(S_LOW_Miklaur_637bb24f-66b7-4447-807b-556bd1c00ed6);

PROC
PROC_LOW_SorcerousSundries_FreeNightsong()
AND NOT
DB_GlobalFlag(LOW_Rolan_State_IsPermadefeated_86a666c2-6453-4aa2-b9d9-9e4c0a432640, _, _, _, _)
THEN
Die(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
Die(S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b);
Die(S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d);
ToInventory(S_LOW_NightsongThreat_d9df0940-238f-4451-a312-d2847ee04f9a, S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_CorpseCleanup_Ignore(S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b);
DB_CorpseCleanup_Ignore(S_GLO_Prodigy_b6a3a9e9-b6eb-4c19-ab3f-4c431178fe1b);
DB_CorpseCleanup_Ignore(S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d);

PROC
PROC_LOW_SorcerousSundries_RolanTakeover()
THEN
NOT DB_LOW_SorcerousSundries_CustomerADs(S_LOW_ClientsDiscussionTrigger_09e59061-fef3-4443-a95c-f20bd38778e6, S_LOW_Client_004_e3fa81d4-53f3-49ad-8497-18673d399a37, S_LOW_Client_005_bf5f19cd-638f-4011-ae3d-45007163c637, LOW_SorcerousSundries_AD_ClientsDiscussion_076f1b44-cd4f-9dd6-a046-274ad99b18d5, 2);
PROC_TriggerUnregisterForPlayers(S_LOW_ClientsDiscussionTrigger_09e59061-fef3-4443-a95c-f20bd38778e6);
SetOnStage(S_LOW_Client_005_bf5f19cd-638f-4011-ae3d-45007163c637, 0);
SetFlag(LOW_SorcerousSundries_State_ProdigyHasStayedAtRamazith_524ab56a-8169-4926-9105-8bcaf8c87499);
PROC_LOW_SorcerousSundries_CheckSibling(S_GLO_ProdigyBrother_d0187724-c0e2-4019-a01d-a03ee8153f1b, S_LOW_CalTeleportTo_7ae1542c-49a8-4ea5-8367-d6bf447ca6be, LOW_SorcerousSundries_Cal_a7b72e87-7538-6a81-e7f5-3cc0710b133d);
PROC_LOW_SorcerousSundries_CheckSibling(S_GLO_ProdigySister_44d09b0b-0568-456c-b18d-559a0a3f981d, S_LOW_LiaTeleportTo_12dd3da1-208a-4e74-a1de-43df549c3bcc, LOW_SorcerousSundries_Lia_545cfc32-f63a-7e90-5965-008457f14daa);

PROC
PROC_LOW_SorcerousSundries_RolanTakeover()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 1, _Var1, _Var1)
THEN
ClearFlag(LOW_SorcerousSundries_BannedPlayer_2cea88b0-bc13-4537-a70a-d3f122ed9699, _Var1, 1);

PROC
PROC_LOW_SorcerousSundries_RolanTakeover()
AND
DB_LOW_SorcerousSundriesPuzzlePortals(_Var1, _, _Var1, _Var1, _Var1)
AND
_Var1 != S_LOW_PortalToRamazith_74a258c4-774f-49d2-a673-1389bca439b5
THEN
PROC_SetOnStage(_Var1, 0);

PROC
PROC_LOW_SorcerousSundries_RolanTakeover()
AND
DB_LOW_SorcerousSundriesPuzzlePlaques(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_SorcerousSundries_Event_NSAndIsobelLeaveCamp_64a6e5df-b6a0-42ab-93b6-818bc4e2859a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundris_NSAndIsobel(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartOfTheTeam(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "LOW_SorcerousSundries_ReadyToLeaveCamp");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_SorcerousSundries_ReadyToLeaveCamp", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SorcerousSundris_NSAndIsobel(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_ActiveCamp(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SorcerousSundries_NSAndIsobelLeaveCampPos(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
NOT DB_PartOfTheTeam(_Var1);
PROC_DisappearOutOfSightTo(_Var1, _Var3, "Walk", 0, "LOW_SorcerousSundries_AllyLeaves");

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_SorcerousSundries_AllyLeaves", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_SetOnStage(_Var1, 0);

PROC
PROC_LOW_SorcerousSundries_CheckSibling((CHARACTER)_Var1, (GUIDSTRING)_Var2, (DIALOGRESOURCE)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterFullRestore(_Var1);
SetTag(_Var1, BADASSCIVILIAN_91f4b379-63a2-40e9-a509-7b9b2f90e4c8);
SetFaction(_Var1, ACT3_LOW_SorcerousSundries_RolanInRamazith_396849f7-d04f-4f49-85e1-8e97ef614f3e);
TeleportTo(_Var1, _Var2);
PROC_SetOnStage(_Var1, 1);
PROC_RemoveAllDialogEntriesForSpeaker(_Var1);
DB_Dialogs(_Var1, _Var3);

IF
FlagSet(LOW_SorcerousSundries_Event_CursedTomeEffect_Necromancy_f1ff24df-f882-40d0-b8c5-6d0c88178cd3, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
AddSpell(_Var1, "Target_CursedTome_WakeTheDead", 1, 0);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_FOR_DangerousBook_Tome_73ea8888-ed82-4ca5-b9f9-0c9119873507, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(FOR_DangerousBook_Tome_696a8379-fa91-d800-7cb6-2f27e04dc100, S_FOR_DangerousBook_Tome_73ea8888-ed82-4ca5-b9f9-0c9119873507, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
GameBookInterfaceClosed(S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(ORI_Gale_Knows_ReadKarsusNotes_2b0e541f-f49e-7e82-27d6-15fccd6ff1ff, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var1, REALLY_GALE_9b0354c0-56d9-4723-8034-918ac9abab19, 1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SorcerousSundries_CursedTomeKarsus_be3af88b-857e-24fe-4da8-3588e27aab75, S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
GameBookInterfaceClosed((ITEM)_Var1, (CHARACTER)_Var2, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_LOW_SorcerousSundries_TomesWithScroll(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate("HIDDEN_CTY_Boosters", _Var3);

IF
GameBookInterfaceClosed(S_UNI_TharchiateCypher_0addb171-6e14-4b4c-8d97-c9af9ba1dcb8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(LOW_SorcerousSundries_Event_CypherRead_236b6a38-319c-448c-aef4-239f1842b622, _Var1, 0, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_Event_CypherRead_236b6a38-319c-448c-aef4-239f1842b622, _Var1);
DB_LOW_SorcerousSundries_ReadyToReadLastPage(_Var1);

IF
GameBookInterfaceClosed(S_UNI_TharchiateCypher_0addb171-6e14-4b4c-8d97-c9af9ba1dcb8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_ApplyTharchiateCurse", _Var1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "CURSEDTOME_THARCHIATE_CODEX", -1);

IF
GameBookInterfaceClosed(S_UNI_TharchiateCypher_0addb171-6e14-4b4c-8d97-c9af9ba1dcb8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_ReactionToTomeRead", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SorcerousSundries_PAD_ReactionToTomeRead_27bb277e-ec90-6757-7c2c-92fa51bb70fe, _Var1);

IF
GameBookInterfaceClosed((ITEM)_Var1, (CHARACTER)_Var2, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_LOW_SorcerousSundries_TomesWithScroll(_Var1, _, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_ReactionToTomeRead", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SorcerousSundries_PAD_ReactionToTomeRead_27bb277e-ec90-6757-7c2c-92fa51bb70fe, _Var2);

IF
DB_DialogPlayers(_Var1, _, _, _Var1, _Var1)
AND
DB_DialogSpeakers(_Var1, S_LOW_Tolna_46aa02d8-28e9-4ebb-876c-82fe29262d35, _, _Var1, _Var1)
THEN
NOT DB_LOW_KarsusTomeADGaleTriggerSetup(1);

IF
DB_LOW_KarsusTomeADGaleTriggerSetup(1, _, _, _, _)
AND
DB_GlobalFlag(ORI_Gale_State_SentToFindBook_223470bc-af59-c833-500a-ace86e5cc1df, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Gale_State_PartyHadKarsusNotes_9e26ca1b-0ae3-472b-a6a3-385846bc8ff5, _, _, _, _)
THEN
NOT DB_LOW_KarsusTomeADGaleTriggerSetup(1);
TriggerRegisterForCharacter(S_LOW_KarsusTomeADGaleTrigger_c85f1787-ce07-490a-8102-bbf6eb2697b7, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

IF
DialogStarted(LOW_SorcerousSundries_Lorroakan_b206fd7c-7992-6d5f-51f4-0943a92f3d48, _, _, _, _)
AND
DB_Is_Polymorphed(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
SetFlag(LOW_SorcerousSundries_State_GaleIsDisguisedWithLorro_2dff8222-5064-4ce5-9862-9b5aedd43a90);

IF
DialogStarted(LOW_SorcerousSundries_Lorroakan_b206fd7c-7992-6d5f-51f4-0943a92f3d48, _, _, _, _)
AND NOT
DB_Is_Polymorphed(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _, _)
THEN
ClearFlag(LOW_SorcerousSundries_State_GaleIsDisguisedWithLorro_2dff8222-5064-4ce5-9862-9b5aedd43a90);

IF
AddedTo(S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, (STRING)_, (STRING)_)
THEN
SetFlag(ORI_Gale_State_HasKarsusBookInInventory_7061de65-b651-4623-9901-e912d2421658);

IF
RemovedFrom(S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _, _, _)
THEN
ClearFlag(ORI_Gale_State_HasKarsusBookInInventory_7061de65-b651-4623-9901-e912d2421658);

IF
EnteredTrigger(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, S_LOW_KarsusTomeADGaleTrigger_c85f1787-ce07-490a-8102-bbf6eb2697b7, _, _, _)
THEN
TriggerUnregisterForCharacter(S_LOW_KarsusTomeADGaleTrigger_c85f1787-ce07-490a-8102-bbf6eb2697b7, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);
PROC_TryStartAD(LOW_SorcerousSundries_AD_GaleSensesKarsusTome_985270c9-136b-0da3-3981-ba6ea519829f, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604);

QRY
QRY_ORI_Gale_FindAvatarForKarsusNotes((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_QRYRTN_ORI_Gale_FindAvatarForKarsusNotes(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_QRYRTN_ORI_Gale_FindAvatarForKarsusNotes(_Var2);

QRY
QRY_ORI_Gale_FindAvatarForKarsusNotes((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SameUser(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604
AND NOT
DB_QRYRTN_ORI_Gale_FindAvatarForKarsusNotes(_, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_ORI_Gale_FindAvatarForKarsusNotes(_Var2);

IF
DialogEnded(LOW_SorcerousSundries_Tolna_6a5d58cc-6d82-4a9e-e8b2-5c4c09c67e14, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(ORI_Gale_Knows_ReadKarsusNotes_2b0e541f-f49e-7e82-27d6-15fccd6ff1ff, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogSpeakers(_Var1, _Var2, 2, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_Event_HasKarsusBook_c7019855-fcac-4bc5-bacf-9fad0213ab28, _Var2, 1, _Var1, _Var1)
AND
QRY_LOW_SorcerousSundries_StartDialogAfterAcquiredKarsusBook(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_GaleTalkToPlayersAboutBook", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
AddedTo(S_LOW_KarsusNotes_0bf067e2-6b9e-4a5e-9c04-e732db3fcc02, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogPlayers(_, _Var1, _, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ORI_Gale_Knows_ReadKarsusNotes_2b0e541f-f49e-7e82-27d6-15fccd6ff1ff, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_KarsusADSaid", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SorcerousSundries_PAD_BoughtKarsusBook_5e520283-5074-e62b-3628-d3950b6facd4, _Var1);

IF
DialogEnded(LOW_SorcerousSundries_Tolna_6a5d58cc-6d82-4a9e-e8b2-5c4c09c67e14, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogSpeakers(_Var1, _Var2, 2, _Var1, _Var1)
AND NOT
DB_GlobalFlag(ORI_Gale_Knows_ReadKarsusNotes_2b0e541f-f49e-7e82-27d6-15fccd6ff1ff, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(LOW_SorcerousSundries_Event_HasKarsusBook_c7019855-fcac-4bc5-bacf-9fad0213ab28, _Var2, 1, _Var1, _Var1)
AND NOT
QRY_LOW_SorcerousSundries_StartDialogAfterAcquiredKarsusBook(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SorcerousSundries_KarsusADSaid", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SorcerousSundries_PAD_BoughtKarsusBook_5e520283-5074-e62b-3628-d3950b6facd4, _Var2);

QRY
QRY_LOW_SorcerousSundries_StartDialogAfterAcquiredKarsusBook((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_ORI_Gale_FindAvatarForKarsusNotes(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_ORI_Gale_FindAvatarForKarsusNotes(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(Gale_InParty2_6beb1b10-845f-49fa-6d6d-f425eaa42574, S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, _Var2, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_DialogFlagSetup(LOW_SorcerousSundries_PAD_MystraVaultEntered_f18ccb6a-393f-d372-075f-765960372335, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_SorcerousSundries_GaleQuestUpdates(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_QuestUpdateIsUnlockedForAny("ORI_COM_Gale", _Var2, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SorcerousSundries_State_IsLookingForBook_096d1be3-1da7-46c7-934f-5a0691464e34);

PROC
PROC_OneShotTriggerEntered(_, S_LOW_SorcerousSundries_NearSorcerousSundries_deb2beec-f1fd-4ca3-b515-9a65011938bd, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
SetFlag(LOW_SorcerousSundries_State_Visited_c1f40149-32b0-402f-b2ae-ffff7eb039b9);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3b"
