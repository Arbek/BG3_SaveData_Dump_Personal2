Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_GLO_CharacterCorpseDialog(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, WYR_MerchantsHouse_Merchant_Dead_99670fe2-39ba-fe87-0b99-46ffbe00a75e);
DB_DefeatedEvent(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, WYR_MerchantsHouse_Merchant_State_Defeated_6c49ac2a-8e88-0c3d-588a-0fa3a82ae071);
SetCanTrade(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, 0);
AddGold(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, 550);
DB_CRIME_Guards_NoSummonBy(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Conflict", 0);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ChoiceMade", 1000);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Hostility", 2000);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ThugsChasingOut", 2500);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ThugsGone", 3000);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "RefugeesGone", 4000);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantRewarded", 5000);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantGone", 6000);
DB_State_Priority(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "RefugeesHoused", 7000);
DB_State_Current(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Conflict");
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_Event_RunAfterPushed_a05ed7d5-c109-6ff9-2b19-0ace8d409bac, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_State_Intimidated_74338e62-6273-1d74-5609-90c9eccdabcc, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_State_Intimidated_74338e62-6273-1d74-5609-90c9eccdabcc, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_Event_KnockOut_d268e780-32e4-5673-cc06-73c390875482, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_Event_Die_592fd890-c8a8-0263-3ed1-ea9d087d9a7d, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb);
DB_WYR_MerchantsHouse_LeaveTriggers(S_WYR_MerchantsHouse_Merchant_HouseLeavePos_91526655-9762-45eb-bf77-b008cd29fb37);
DB_Dialogs(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55);
DB_DialogMoneyTransfer(1, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, 1000, 4);
DB_DialogMoneyTransfer(2, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, 300, 1, 2);
DB_WYR_MerchantsHouse_Conflict_SceneCharacters(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);
DB_WYR_MerchantsHouse_Conflict_SceneCharacters(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8);
DB_WYR_MerchantsHouse_Conflict_SceneCharacters(S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055);
DB_WYR_MerchantsHouse_Conflict_MadeChoiceFlags(WYR_MerchantsHouse_State_ChasingOutAgreedFree_60765fb3-581e-8de5-1d15-e7916aa9bb75);
DB_WYR_MerchantsHouse_Conflict_MadeChoiceFlags(WYR_MerchantsHouse_State_ChasingOutAgreedHalfPrice_7705e5c3-cec8-8a8b-c666-c324f107f603);
DB_WYR_MerchantsHouse_Conflict_MadeChoiceFlags(WYR_MerchantsHouse_Merchant_State_Intimidated_74338e62-6273-1d74-5609-90c9eccdabcc);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_ThugsStartChasingOut_af4cbaf1-20ae-4484-ba3a-7b6535674d05, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55);
PROC_WYR_MerchantsHouse_SetupConflictScene();
Open(DOOR_Double_Slim_City_House_I_Frameless_Top_A_004_0e5f574c-252c-448e-9d08-2eeff7b26058);
DB_Dialogs(S_WYR_MerchantsHouse_Thug_001_2c1b28c2-279f-4a85-951b-96d4d5256634, WYR_MerchantsHouse_Thug_001_2ee07a8c-40d9-32d1-89d2-88e2b34ef184);
DB_Dialogs(S_WYR_MerchantsHouse_Thug_002_e7fc87a2-2320-43fc-83b3-5c9bc2076efe, WYR_MerchantsHouse_Thug_002_27ddf983-ea55-2ec6-25d8-dc45053e0a78);
DB_Dialogs(S_WYR_MerchantsHouse_Thug_003_b66597d0-fb21-4a95-87cd-c42cc2498ed9, WYR_MerchantsHouse_Thug_003_bd785307-f49f-31de-5685-36be55eb2639);
DB_Dialogs(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, WYR_MerchantsHouse_ThugLeader_90cba9e2-0167-34c0-dfc1-99065de4cff7);
DB_WYR_MerchantsHouse_Thugs(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8);
DB_WYR_MerchantsHouse_Thugs(S_WYR_MerchantsHouse_Thug_001_2c1b28c2-279f-4a85-951b-96d4d5256634);
DB_WYR_MerchantsHouse_Thugs(S_WYR_MerchantsHouse_Thug_002_e7fc87a2-2320-43fc-83b3-5c9bc2076efe);
DB_WYR_MerchantsHouse_Thugs(S_WYR_MerchantsHouse_Thug_003_b66597d0-fb21-4a95-87cd-c42cc2498ed9);
DB_DialogMoneyTransfer(1, WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, 500);
DB_DialogMoneyTransfer(2, WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, 1000);
DB_DialogMoneyTransfer(3, WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, 250);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_ThugsLeave_d518e87e-3514-1f96-a96a-3ce6b1d0be64, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_ThugsLeave_d518e87e-3514-1f96-a96a-3ce6b1d0be64, WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208);
DB_DeadEvent(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, WYR_MerchantsHouse_ThugLeader_State_Killed_52c51e79-5d48-4b56-b649-d21387abfd3b);
DB_Dialogs(S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055, WYR_MerchantsHouse_RefugeeLeader_2e0bb1ac-8d53-3f4c-f306-f788b29f9f11);
DB_Dialogs(S_WYR_MerchantsHouse_RefugeeDaughter_a31e1798-ab61-4b2c-9e06-c66c56d2edb5, WYR_MerchantsHouse_RefugeeDaughter_e2dff08d-4a42-c6c3-4ef1-b7dd6ff0be52);
DB_Dialogs(S_WYR_MerchantsHouse_RefugeeWife_0d9c9a7c-3f15-4b86-990f-2b5dd65b4dc7, WYR_MerchantsHouse_RefugeeWife_4852a8e6-7c6d-230a-1b4a-be90dc499e1b);
DB_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_RefugeesLeave_9b71e835-73a7-4c00-8c3d-31f64370f726, WYR_MerchantsHouse_RefugeeLeader_2e0bb1ac-8d53-3f4c-f306-f788b29f9f11);
DB_WYR_MerchantsHouse_Refugees(S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055);
DB_WYR_MerchantsHouse_Refugees(S_WYR_MerchantsHouse_RefugeeDaughter_a31e1798-ab61-4b2c-9e06-c66c56d2edb5);
DB_WYR_MerchantsHouse_Refugees(S_WYR_MerchantsHouse_RefugeeWife_0d9c9a7c-3f15-4b86-990f-2b5dd65b4dc7);
DB_DialogMoneyTransfer(1, WYR_MerchantsHouse_RefugeeLeader_2e0bb1ac-8d53-3f4c-f306-f788b29f9f11, 100);
DB_Children(S_WYR_MerchantsHouse_RefugeeDaughter_a31e1798-ab61-4b2c-9e06-c66c56d2edb5);
DB_ForceRemoveKnockedOutCharacterOnLongRest(S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055);
DB_Dialogs(S_WYR_MerchantsHouse_CaravanOx_8678cc96-25e6-42f4-b4fe-0fd40c4a2de2, WYR_MerchantsHouse_CaravanOx_57873ca6-a02e-b208-5967-4f15a3935fa5);
DB_OneShot_VoiceBarkTrigger(Stats_WYR_MerchantHouseBasement_12607cb7-2772-47dc-b470-0434087ededa, WYR_MerchantsHouse_VB_EnteredBasement_f396c9e6-ef9c-cd41-9862-73280b9cd984);
DB_BookFlags(S_WYR_MerchantsHouse_OrinLetter_de06faf4-6d56-426b-abbc-e64f86de3951, WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3);
DB_WYR_MerchantsHouse_BasementToyRoots(LOOT_GEN_Toy_TeddyBear_Worn_A_3762d9ce-3506-4d2c-8b36-454d9fef979f);
DB_WYR_MerchantsHouse_BasementToyRoots(UNI_WYR_ExplosiveToy_Broken_1b7e91d0-5de8-46fa-87c0-b3a9d35939e6);
DB_QuestDef_State_ConditionalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, "WYR_Donations", "FoundBlackmail_Before", 0, WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712);
DB_QuestDef_State_ConditionalFlag(WYR_RefugeeCamp_State_ManipAgreedInvestigate_ae6869c2-8b25-6b6e-ed00-87ce770cf5fd, "WYR_Donations", "ManipAgreedInvestigate", 0, WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712);
DB_QuestDef_State_ConditionalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, "WYR_Donations", "FoundToys_DoesntKnow", 0, WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3);
DB_QuestDef_State(LOW_FireworksHouse_Event_UsedPassword_a1db6ba2-5535-4c96-aa27-b7736625fa6c, "WYR_Donations", "UsedPassword");
DB_QuestDef_State(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, "WYR_Donations", "ReachedEND");
DB_WYR_MerchantsHouse_FindObjectiveSteps("FoundToys_Knows_SC");
DB_WYR_MerchantsHouse_FindObjectiveSteps("FoundBlackmail_After_SC");
DB_WYR_MerchantsHouse_FindObjectiveSteps("Confront_WentToSC");
DB_WYR_MerchantsHouse_InvestigateObjectiveSteps("LearnedPassword_ArfurConfessed");
DB_WYR_MerchantsHouse_InvestigateObjectiveSteps("LearnedPassword");
DB_WYR_MerchantsHouse_InvestigateObjectiveSteps("ArfurUnreachable");
DB_WYR_MerchantsHouse_InvestigateObjectiveSteps("UsedPassword");
DB_GlobalFlagReactionAfterDialog(LOW_FireworksHouse_Knows_Password_dcf4bb90-caf1-079f-d9bb-c51c3463b79e, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb);
DB_GlobalFlagReactionAfterDialog(LOW_FireworksHouse_Knows_Password_dcf4bb90-caf1-079f-d9bb-c51c3463b79e, WYR_MerchantsHouse_Merchant_Dead_99670fe2-39ba-fe87-0b99-46ffbe00a75e);
DB_ItemOwnerShipTriggers("BGO_Main_A", S_WYR_MerchantsHouse_Ownership_167ae202-cb27-4028-86d2-3c5f17fa6da2, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);
DB_ItemOwnerShipTriggers("BGO_Main_A", S_WYR_MerchantsHouse_Basement_Ownership_c42a93d5-1570-484b-90cd-ae7c7de6a219, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);

KBSECTION
PROC
PROC_LongRest()
THEN
PROC_WYR_MerchantsHouse_Progress();

PROC
PROC_LevelUnloading("BGO_Main_A", _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_Progress();

PROC
PROC_WYR_MerchantsHouse_SetupConflictScene()
AND
DB_WYR_MerchantsHouse_Conflict_SceneCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SceneManager(_Var1, "WYR_MerchantsHouse_ConflictScene");
DB_SpotPlayers(_Var1, "WYR_MerchantsHouse_ConflictScene", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger(_Var1, "WYR_MerchantsHouse_ConflictScene", S_WYR_MerchantsHouse_ConflictSpotArea_49dc5ed8-940a-49ec-9919-66e0ea6ac3da);

PROC
PROC_WYR_MerchantsHouse_SetupConflictScene()
THEN
DB_SceneTriggerManager("WYR_MerchantsHouse_ConflictScene", S_WYR_MerchantsHouse_ConflictSpotArea_49dc5ed8-940a-49ec-9919-66e0ea6ac3da);

IF
DB_WYR_MerchantsHouse_Conflict_MadeChoiceFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GlobalFlagReactionAfterDialog(_Var1, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55);

PROC
PROC_SpotPlayers_Spotted(_, "WYR_MerchantsHouse_ConflictScene", (GUIDSTRING)_Var2, _, _)
AND
QRY_StartDialog(WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055, _Var2)
THEN
DB_NOOP(1);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_Conflict_SceneCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Conflict", _Var1, _Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055, _Var2);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_State_Current(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Conflict", _Var1, _Var1)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalClearFlagAndCache(WYR_MerchantsHouse_Event_ThugLeaderGreeting_2d0fe767-f0fb-d207-3e9f-fa8640e9427e);
DB_SelectedDialog(WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, NULL_00000000-0000-0000-0000-000000000000, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_State_Current(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Conflict", _Var1, _Var1)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Event_ThugLeaderGreeting_2d0fe767-f0fb-d207-3e9f-fa8640e9427e);
DB_SelectedDialog(WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, NULL_00000000-0000-0000-0000-000000000000, _Var1);

IF
DialogStarted(WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, _, _, _, _)
AND
DB_WYR_MerchantsHouse_Conflict_SceneCharacters(_Var2, _, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(_Var2, "WYR_MerchantsHouse_ConflictScene");

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)_Var1, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, (INTEGER)_Var2, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_WYR_MerchantsHouse_Conflict_MadeChoiceFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_Conflict_DialogEndedWithChoice(_Var2);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, (CHARACTER)_Var2, "WYR_MerchantsHouse_ConflictScene", (STRING)_Var3, (GUIDSTRING)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055
THEN
PROC_WYR_MerchantsHouse_EndConflictScene();
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_Event_Hostility_6d08b67a-cb24-8d83-afbb-dff50da31dae);

PROC
PROC_SceneInterrupted(S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055, (CHARACTER)_Var1, "WYR_MerchantsHouse_ConflictScene", (STRING)_Var2, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Event_ThugsStartChasingOut_af4cbaf1-20ae-4484-ba3a-7b6535674d05, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_RefugeesRunScared();
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting(_Var1);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, (CHARACTER)_Var2, "WYR_MerchantsHouse_ConflictScene", (STRING)_Var3, (GUIDSTRING)_Var1)
AND NOT
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_WYR_MerchantsHouse_Thugs(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Event_ThugsStartChasingOut_af4cbaf1-20ae-4484-ba3a-7b6535674d05, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_RefugeesRunScared();
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting(NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_WYR_MerchantsHouse_Conflict_DialogEndedWithChoice(_, (INTEGER)_, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ChoiceMade");

PROC
PROC_State_Changed(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Conflict", _, (STRING)_)
THEN
PROC_WYR_MerchantsHouse_EndConflictScene();

PROC
PROC_WYR_MerchantsHouse_EndConflictScene()
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ConflictSceneEnded_5e51e192-d106-4bbb-9e97-ea77d8594b0b, _, _, _, _)
THEN
PROC_SceneOver("WYR_MerchantsHouse_ConflictScene");

PROC
PROC_WYR_MerchantsHouse_EndConflictScene()
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ConflictSceneEnded_5e51e192-d106-4bbb-9e97-ea77d8594b0b, _, _, _, _)
AND
DB_WYR_MerchantsHouse_Conflict_SceneCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting(_Var1, "WYR_MerchantsHouse_ConflictScene");

PROC
PROC_WYR_MerchantsHouse_EndConflictScene()
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ConflictSceneEnded_5e51e192-d106-4bbb-9e97-ea77d8594b0b, _, _, _, _)
AND NOT
DB_PermaDefeated(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);
DB_Dialogs(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb);

PROC
PROC_WYR_MerchantsHouse_EndConflictScene()
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ConflictSceneEnded_5e51e192-d106-4bbb-9e97-ea77d8594b0b);

IF
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "WYR_MerchantsHouse_Thugs");

IF
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_CRIME_Guards_NoSummonBy(_Var1);

IF
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_MerchantsHouse_Refugees(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_AssaultFamilyIgnoreFor(_Var1, _Var2);
DB_AssaultFamilyIgnoreFor(_Var2, _Var1);
DB_MurderIgnoreFor(_Var1, _Var2);
DB_MurderIgnoreFor(_Var2, _Var1);

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_ThugsLeave_d518e87e-3514-1f96-a96a-3ce6b1d0be64, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_ThugsLeave();

PROC
PROC_WYR_MerchantsHouse_ThugsLeave()
AND
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "WYR_MerchantsHouse_Event_ThugLeave_Notify");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "WYR_MerchantsHouse_Event_ThugLeave_Notify", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DisappearOutOfSightTo(_Var1, S_WYR_MerchantsHouse_Merchant_LeavePos_91526655-9762-45eb-bf77-b008cd29fb37, "Walk", 0, "WYR_MerchantsHouse_Event_ThugLeft");

PROC
PROC_WYR_MerchantsHouse_ThugsLeave()
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541);

PROC
PROC_WYR_MerchantsHouse_ThugsLeaveImmediately()
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
AND
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeatedOrOffstage(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CancelDisappearOutOfSight(_Var1);
PROC_SetOnStage(_Var1, 0);

PROC
PROC_WYR_MerchantsHouse_ThugsLeaveImmediately()
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541);

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_ThugsLeave_d518e87e-3514-1f96-a96a-3ce6b1d0be64, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PeacefulResolve(_Var1);

PROC
PROC_GLO_DefeatCounter_AllDefeated("WYR_MerchantsHouse_Thugs", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsDefeated_cc82b4e7-f0f5-4cd3-8fb2-b5de9a3a9aed);

IF
FlagSet(WYR_MerchantsHouse_State_ThugsDefeated_cc82b4e7-f0f5-4cd3-8fb2-b5de9a3a9aed, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541);

IF
FlagSet(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ThugsGone");

IF
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsDefeated_cc82b4e7-f0f5-4cd3-8fb2-b5de9a3a9aed, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ClearCorpseOwner(_Var1);

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsDefeated_cc82b4e7-f0f5-4cd3-8fb2-b5de9a3a9aed, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_WYR_MerchantsHouse_Conflict_DialogEndedWithChoice((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Event_ThugsLeave_d518e87e-3514-1f96-a96a-3ce6b1d0be64, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND NOT
QRY_IsEnemy(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting(_Var2);

PROC
PROC_State_Changed(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantRewarded", _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
AND
DB_DialogName(WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND NOT
QRY_IsEnemy(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting(_Var2);

PROC
PROC_State_Changed(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantRewarded", _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
AND NOT
DB_DialogName(WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting(NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var1 != NULL_00000000-0000-0000-0000-000000000000
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting_Internal(_Var1);

PROC
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting(NULL_00000000-0000-0000-0000-000000000000, _, _, _, _)
AND NOT
DB_Defeated(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _, _, _, _)
AND
QRY_GetClosestAvailableCharacterTo(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, 1, _, _, _)
AND
DB_ClosestAvailableCharacterTo(_Var1, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting_Internal(_Var1);

PROC
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting_Internal((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("WYR_MerchantsHouse_ThugLeader_StartThugsConfrontationSpotting", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8);
DB_Dialogs(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208);
DB_SpotPlayers(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, "WYR_MerchantsHouse_ThugLeader_ConfrontationSpot", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_WYR_MerchantsHouse_StartThugsConfrontationSpotting_Internal((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_SpeakerIsAvailableAndInDialogRange(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("WYR_MerchantsHouse_ThugLeader_StartThugsConfrontationSpotting", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8);
DB_Dialogs(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208);
DB_SpotPlayers(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, "WYR_MerchantsHouse_ThugLeader_ConfrontationSpot", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted(_, "WYR_MerchantsHouse_ThugLeader_ConfrontationSpot", (CHARACTER)_Var2, _, _)
AND NOT
QRY_StartDialog(WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var2, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsHostile_98c2a7bc-56b0-46b3-8136-7e4e89cec6c3);
PROC_SetRelationToPlayers(ACT3_WYR_MerchantsHouse_Thugs_5b97f222-6ea5-487a-9354-8669c8e481fa, 0);

IF
DialogRequestFailed(WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsHostile_98c2a7bc-56b0-46b3-8136-7e4e89cec6c3);
PROC_SetRelationToPlayers(ACT3_WYR_MerchantsHouse_Thugs_5b97f222-6ea5-487a-9354-8669c8e481fa, 0);

IF
DialogEnded(WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Event_ThugsLeave_d518e87e-3514-1f96-a96a-3ce6b1d0be64, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND NOT
QRY_IsEnemy(_Var2, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsHostile_98c2a7bc-56b0-46b3-8136-7e4e89cec6c3);
PROC_SetRelationToPlayers(ACT3_WYR_MerchantsHouse_Thugs_5b97f222-6ea5-487a-9354-8669c8e481fa, 0);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var1);

IF
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_DialogName(WYR_MerchantsHouse_ThugLeader_Confrontation_35e9d512-a517-e5ba-f967-779ffe153208, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(WYR_MerchantsHouse_Merchant_Knows_ConfrontedThugs_d057e220-d443-48de-b68b-813c18a8a7b2, _Var2, 0, _Var1, _Var1)
THEN
SetFlag(WYR_MerchantsHouse_Merchant_Knows_ConfrontedThugs_d057e220-d443-48de-b68b-813c18a8a7b2, _Var2, _Var1);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_WYR_MerchantsHouse_ThugLeader_bed33e19-1620-4845-aaa6-52de87f7e2e8, _Var2, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(WYR_MerchantsHouse_Merchant_Knows_ConfrontedThugs_d057e220-d443-48de-b68b-813c18a8a7b2, _Var1, 0, _Var1, _Var1)
THEN
SetFlag(WYR_MerchantsHouse_Merchant_Knows_ConfrontedThugs_d057e220-d443-48de-b68b-813c18a8a7b2, _Var1, 0);

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_ThugsStartChasingOut_af4cbaf1-20ae-4484-ba3a-7b6535674d05, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ThugsChasingOut");

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_ThugsStartChasingOut_af4cbaf1-20ae-4484-ba3a-7b6535674d05, _, _, _, _)
AND
QRY_SpeakerIsAvailable(S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055, _, _, _, _)
AND
QRY_OnlyOnce("WYR_MerchantsHouse_AD_RefugeeLeader_ChasedOut_OnlyOnce", _, _, _, _)
THEN
PROC_TryStartAD(WYR_MerchantsHouse_AD_RefugeeLeader_ChasedOut_d50a7ec4-f38e-08b4-e3f1-c058c14b33cd, S_WYR_MerchantsHouse_RefugeeLeader_7ef493d6-4e5f-490a-96dd-e5bb10446055);

PROC
PROC_State_Changed(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ThugsChasingOut", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_Thugs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_WYR_MerchantsHouse_ThugNonLethal(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_WYR_MerchantsHouse_ThugNonLethal(_Var1);
AddPassive(_Var1, "WYR_MerchantsHouse_ThugsNonLethal_Passive");

PROC
PROC_State_Changed(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ThugsChasingOut", _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f);

IF
FlagSet(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND
DB_WYR_MerchantsHouse_ThugNonLethal(_Var3, _, _, _, _)
THEN
RemovePassive(_Var3, "WYR_MerchantsHouse_ThugsNonLethal_Passive");

IF
EnteredCombat((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_ThugNonLethal(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
RemovePassive(_Var1, "WYR_MerchantsHouse_ThugsNonLethal_Passive");

PROC
PROC_DialogFlagSetup(WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_ThugsLeave();

IF
AutomatedDialogEnded(WYR_MerchantsHouse_AD_DoneChasingOut_7d240c62-28b8-4cd9-a166-e44b27015c13, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_ThugsLeave();

PROC
PROC_LongRest()
AND
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_ThugsLeaveImmediately();

PROC
PROC_LevelUnloading("BGO_Main_A", _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_ThugsLeaveImmediately();

PROC
PROC_WYR_MerchantsHouse_Progress()
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_Event_Hostility_6d08b67a-cb24-8d83-afbb-dff50da31dae, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f);
PROC_WYR_MerhcantsHouse_ChaseOutImmediately();

PROC
PROC_WYR_MerchantsHouse_Progress()
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_Event_Hostility_6d08b67a-cb24-8d83-afbb-dff50da31dae, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_ThugsLeaveImmediately();
PROC_WYR_MerhcantsHouse_ChaseOutImmediately();

IF
DB_WYR_MerchantsHouse_Refugees(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_AssaultFamilyIgnoreFor(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var1);
DB_AssaultFamilyIgnoreFor(_Var1, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);
DB_MurderIgnoreFor(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var1);
DB_MurderIgnoreFor(_Var1, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);

PROC
PROC_WYR_MerhcantsHouse_ChaseOutImmediately()
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8);

PROC
PROC_WYR_MerhcantsHouse_ChaseOutImmediately()
AND
DB_WYR_MerchantsHouse_Refugees(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CancelDisappearOutOfSight(_Var1);
PROC_SetOnStage(_Var1, 0);

PROC
PROC_WYR_MerhcantsHouse_ChaseOutImmediately()
AND
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _Var2);

PROC
PROC_StateSet_Defeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_Housed_0481d093-1539-1a06-b3b2-246270b82a12, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_MerchantsHouse_Refugees(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_RefugeesRunScared();

PROC
PROC_WYR_MerchantsHouse_RefugeesRunScared()
AND
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, "Walk", _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, "Walk");
PROC_CancelDisappearOutOfSight(_Var1);

PROC
PROC_WYR_MerchantsHouse_RefugeesRunScared()
AND
DB_WYR_MerchantsHouse_Refugees(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, "Sprint");

PROC
PROC_WYR_MerchantsHouse_RefugeesRunScared()
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8);

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Event_RefugeesLeave_9b71e835-73a7-4c00-8c3d-31f64370f726, _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_RefugeesWalkChased();

PROC
PROC_WYR_MerchantsHouse_RefugeesWalkChased()
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8);

PROC
PROC_WYR_MerchantsHouse_RefugeesWalkChased()
AND
DB_WYR_MerchantsHouse_Refugees(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, "Walk");

IF
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "WYR_MerchantsHouse_Event_RefugeeLeavingNotify");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "WYR_MerchantsHouse_Event_RefugeeLeavingNotify", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_SetCanFight(_Var1, 0);
SetCanJoinCombat(_Var1, 0);
PROC_DisappearOutOfSight(_Var1, _Var2, 1, "WYR_MerchantsHouse_Event_RefugeeLeft");

IF
EntityEvent((CHARACTER)_Var1, "WYR_MerchantsHouse_Event_RefugeeLeft", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_MerchantsHouse_Refugees_AwaitingDisappearing(_Var1, _Var2);

IF
FlagSet(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "RefugeesGone");

IF
FlagSet(WYR_MerchantsHouse_Refugees_State_Housed_0481d093-1539-1a06-b3b2-246270b82a12, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "RefugeesHoused");

IF
KilledBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_Refugees(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ChasedOutKilled_24705492-064e-140d-2e4a-afecd6cdb7c9);

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_Refugees(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_Defeated_6c49ac2a-8e88-0c3d-588a-0fa3a82ae071, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantGone");

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_Thanked_fe05329b-da0e-0d0b-6c18-4f29bc03ddf5, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantRewarded");

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_Event_Die_592fd890-c8a8-0263-3ed1-ea9d087d9a7d, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, 1, _, _)
THEN
Die(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, 0, _Var3, 1, 0, 0);

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_Event_KnockOut_d268e780-32e4-5673-cc06-73c390875482, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, 1, _, _)
THEN
ApplyStatus(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "KNOCKED_OUT", -1, 1, _Var3);

PROC
PROC_State_Changed(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", _, "MerchantGone", (STRING)_)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309);

IF
RelationChanged(ACT3_WYR_MerchantsHouse_Merchant_44c05ca4-182c-4728-b143-8c417c7f2310, (FACTION)_Var1, (INTEGER)_Var2, _, (FACTION)_Var1)
AND
_Var2 < 50
AND
DB_AvatarFactions(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_Event_Hostility_6d08b67a-cb24-8d83-afbb-dff50da31dae, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_Hostile_6d08b67a-cb24-8d83-afbb-dff50da31dae);

IF
FlagSet(WYR_MerchantsHouse_Merchant_Event_Hostility_6d08b67a-cb24-8d83-afbb-dff50da31dae, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SetRelationToPlayers(ACT3_WYR_MerchantsHouse_Thugs_5b97f222-6ea5-487a-9354-8669c8e481fa, 0);
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsHostile_98c2a7bc-56b0-46b3-8136-7e4e89cec6c3);
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "Hostility");

QRY
QRY_CorpseLooting_BlockMakeOwned(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_State_Intimidated_74338e62-6273-1d74-5609-90c9eccdabcc, WYR_MerchantsHouse_Merchant_Conflict_05e817f3-88b4-9f0f-5548-c78801d51b55, _, _, _)
AND NOT
DB_Defeated(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantGone");
PROC_NotifyWhenReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantToSharessCaress_Notify");

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_State_Intimidated_74338e62-6273-1d74-5609-90c9eccdabcc, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_MerchantConfessed_b9c702f4-ed9c-4fe5-0250-8bd96d21a044, _, _, _, _)
AND NOT
DB_Defeated(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantGone");
PROC_NotifyWhenReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantToSharessCaress_Notify");

PROC
PROC_ReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantToSharessCaress_Notify", _, _, _)
THEN
PROC_DisappearOutOfSightTo(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, S_WYR_MerchantsHouse_Merchant_LeavePos_91526655-9762-45eb-bf77-b008cd29fb37, "Run", 0, "WYR_MerchantsHouse_Event_MerchantToSharessCaress");

IF
FlagSet(WYR_MerchantsHouse_Merchant_Event_ToPrison_fd34ea4a-fb0a-1f11-9bd5-ff66d0901c5f, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_NotifyWhenReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantToPrison_Notify");

PROC
PROC_ReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantToPrison_Notify", _, _, _)
THEN
PROC_DisappearOutOfSightTo(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, S_WYR_MerchantsHouse_Merchant_LeavePos_91526655-9762-45eb-bf77-b008cd29fb37, "Run", 0, "WYR_MerchantsHouse_Event_MerchantToPrison");

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_MerchantsHouse_Merchant_Event_DisappearAfterConfession_a05ed7d5-c109-6ff9-2b19-0ace8d409bac, _, _, _, _)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantGone");
PROC_NotifyWhenReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantDisappear_Notify");

IF
DialogEnded(WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_MerchantConfessed_b9c702f4-ed9c-4fe5-0250-8bd96d21a044, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_Event_DisappearAfterConfession_a05ed7d5-c109-6ff9-2b19-0ace8d409bac, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_Event_Die_592fd890-c8a8-0263-3ed1-ea9d087d9a7d, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_Event_KnockOut_d268e780-32e4-5673-cc06-73c390875482, _, _, _, _)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantGone");
PROC_NotifyWhenReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantDisappear_Notify");

PROC
PROC_ReadyToMoveOn(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse_MerchantDisappear_Notify", (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_WYR_MerchantsHouse_LeaveTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSightTo(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var1, "Sprint", 1, "WYR_MerchantsHouse_Event_MerchantLeft");

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND
DB_WYR_MerchantsHouse_LeaveTriggers(_Var3, _, _, _, _)
THEN
NOT DB_WYR_MerchantsHouse_LeaveTriggers(_Var3);
DB_WYR_MerchantsHouse_LeaveTriggers(S_WYR_MerchantsHouse_Merchant_SharessLeavePos_9fbc16cd-861f-49bb-b0e0-8fe0ccc44a0f);

IF
FlagSet(WYR_MerchantsHouse_Merchant_Event_GiveAllGold_e5c7e21e-0c67-423b-a71f-e7ed7cddb611, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetGold(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var3, _Var1, _Var1, _Var1)
AND
_Var3 > 0
AND
IntegerProduct(-1, _Var3, _Var4, _Var1, _Var1)
THEN
AddGold(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var4);
AddGold(_Var1, _Var3);

IF
FlagSet(WYR_MerchantsHouse_Merchant_Event_GiveAccessPass_578361b0-57da-d41e-1bd4-8eebb5222440, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
IsInInventoryOf(S_WYR_MerchantsHouse_CoronationAccessPass_b41b4a1c-f740-4798-9a00-170a9db4f034, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, 1, _Var1, _Var1)
THEN
ToInventory(S_WYR_MerchantsHouse_CoronationAccessPass_b41b4a1c-f740-4798-9a00-170a9db4f034, _Var1, 1, 1, 1);

IF
EntityEvent(_, "WYR_MerchantsHouse_Event_MerchantToSharessCaress", _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InPrison_e96b73b9-1e15-75f1-e61d-af9b713d6b25, _, _, _, _)
AND NOT
DB_WYR_MerchantsHouse_MerchantDestinationEvent(_, _, _, _, _)
THEN
DB_WYR_MerchantsHouse_MerchantDestinationEvent(S_WYR_SharessCaress_MerchantPos_d2547b3d-9525-4b66-9404-7d984704f4ef, WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, S_WYR_SharessCaress_SUB_07597ced-f3fe-45f8-bab6-13f0064b75bb, S_WYR_Rivington_SUB_40c3661e-99a1-4189-aa69-c006e77e3db8);

IF
EntityEvent(_, "WYR_MerchantsHouse_Event_MerchantToPrison", _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InPrison_e96b73b9-1e15-75f1-e61d-af9b713d6b25, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND NOT
DB_WYR_MerchantsHouse_MerchantDestinationEvent(_, _, _, _, _)
THEN
DB_WYR_MerchantsHouse_MerchantDestinationEvent(S_WYR_WyrmRockPrison_MerchantPos_cb54085d-6f26-4bcb-8907-e3dc32b03970, WYR_MerchantsHouse_Merchant_State_InPrison_e96b73b9-1e15-75f1-e61d-af9b713d6b25, S_WYR_Prison_SUB_cd67276d-52e4-44b9-a237-0e2cd45106d8, S_WYR_Rivington_SUB_40c3661e-99a1-4189-aa69-c006e77e3db8);

IF
DB_WYR_MerchantsHouse_MerchantDestinationEvent(_Var1, _, _Var3, _Var4, _Var1)
THEN
PROC_WYR_MerchantsHouse_TryMoveMerchantToDestination(_Var1);

IF
LeftTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_MerchantsHouse_MerchantDestinationEvent(_Var3, _, _Var2, _Var5, _Var1)
THEN
PROC_WYR_MerchantsHouse_TryMoveMerchantToDestination(_Var3);

PROC
PROC_WYR_MerchantsHouse_TryMoveMerchantToDestination((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_WYR_MerchantsHouse_MerchantDestinationEvent(_Var1, _, _Var3, _Var4, _Var1)
AND NOT
QRY_TriggerEvents_AnyPartyMemberInTrigger(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_MerchantsHouse_MoveMerchantToDestination(_Var1);

PROC
PROC_WYR_MerchantsHouse_MoveMerchantToDestination((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_WYR_MerchantsHouse_MerchantDestinationEvent(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
NOT DB_WYR_MerchantsHouse_MerchantDestinationEvent(_Var1, _Var2, _Var3, _Var4);
PROC_GlobalSetFlagAndCache(_Var2);
PROC_CancelDisappearOutOfSight(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);
TeleportTo(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var1);
SetOnStage(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, 1);

PROC
PROC_WYR_MerchantsHouse_MoveMerchantToDestination(_, (TRIGGER)_, (TRIGGER)_, (TRIGGER)_, (TRIGGER)_)
THEN
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "MerchantGone");

PROC
PROC_WYR_MerchantsHouse_MoveMerchantToDestination(S_WYR_WyrmRockPrison_MerchantPos_cb54085d-6f26-4bcb-8907-e3dc32b03970, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
GetEquippedWeapon(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var1, _Var1, _Var1, _Var1)
THEN
Unequip(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var1);
RequestDelete(_Var1);

PROC
PROC_WYR_MerchantsHouse_MoveMerchantToDestination(S_WYR_WyrmRockPrison_MerchantPos_cb54085d-6f26-4bcb-8907-e3dc32b03970, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetGold(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSubtract(0, _Var1, _Var2, _Var1, _Var1)
THEN
AddGold(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var2);

PROC
PROC_WYR_MerchantsHouse_MoveMerchantToDestination(S_WYR_WyrmRockPrison_MerchantPos_cb54085d-6f26-4bcb-8907-e3dc32b03970, _, _, _, _)
THEN
Die(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, 0, 0);

IF
DB_WYR_MerchantsHouse_MerchantDestinationEvent(S_WYR_WyrmRockPrison_MerchantPos_cb54085d-6f26-4bcb-8907-e3dc32b03970, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_Housed_0481d093-1539-1a06-b3b2-246270b82a12, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND NOT
DB_InRegion(_, S_WYR_Rivington_SUB_40c3661e-99a1-4189-aa69-c006e77e3db8, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Refugees_State_Housed_0481d093-1539-1a06-b3b2-246270b82a12);

IF
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_Intimidated_74338e62-6273-1d74-5609-90c9eccdabcc, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_Housed_0481d093-1539-1a06-b3b2-246270b82a12, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND NOT
DB_InRegion(_, S_WYR_Rivington_SUB_40c3661e-99a1-4189-aa69-c006e77e3db8, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Refugees_State_Housed_0481d093-1539-1a06-b3b2-246270b82a12);

IF
DB_WYR_MerchantsHouse_MerchantDestinationEvent(S_WYR_WyrmRockPrison_MerchantPos_cb54085d-6f26-4bcb-8907-e3dc32b03970, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
AND NOT
DB_InRegion(_, S_WYR_Rivington_SUB_40c3661e-99a1-4189-aa69-c006e77e3db8, _, _, _)
THEN
PROC_WYR_MerchantsHouse_ThugsLeave();

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_Thanked_fe05329b-da0e-0d0b-6c18-4f29bc03ddf5, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14);

IF
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND NOT
DB_InRegion(_, S_WYR_Rivington_SUB_40c3661e-99a1-4189-aa69-c006e77e3db8, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14);

IF
FlagSet(WYR_MerchantsHouse_State_ThugsGone_eb05b8a4-44a1-4a0a-98aa-f70cea57b541, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14, _, _, _, _)
THEN
TimerLaunch("WYR_MerchantsHouse_Merchant_BackInHouseAfterChasing_Timer", 3000);

IF
TimerFinished("WYR_MerchantsHouse_Merchant_BackInHouseAfterChasing_Timer", _, _, _, _)
AND NOT
DB_Defeated(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14);

IF
FlagSet(WYR_MerchantsHouse_Refugees_State_ChasedOut_9aaac7f5-98b3-4b07-948c-eeb3159bcae8, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Knows_Refugees_8e235664-43aa-304d-1a1f-839214b598d6, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14);

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14);

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_ItemOwnerShipTriggers("BGO_Main_A", S_WYR_MerchantsHouse_UpstairsOwnershipTrigger_021c995f-ec1a-481c-847e-cad8ba7240ff, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);
DB_ItemOwnerShipTriggers("BGO_Main_A", S_WYR_MerchantsHouse_WorkshopOwnershipTrigger_8bb58550-e844-45d1-ae98-6cc7ac8e4b13, S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977);

IF
FlagCleared(WYR_MerchantsHouse_Merchant_State_BackInHouse_15afb6fd-c114-408b-bca9-521f32454c14, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
TriggerClearItemsOwner(S_WYR_MerchantsHouse_UpstairsOwnershipTrigger_021c995f-ec1a-481c-847e-cad8ba7240ff);
TriggerClearItemsOwner(S_WYR_MerchantsHouse_WorkshopOwnershipTrigger_8bb58550-e844-45d1-ae98-6cc7ac8e4b13);

IF
FlagSet(WYR_MerchantsHouse_Merchant_Event_DisappearAfterConfession_a05ed7d5-c109-6ff9-2b19-0ace8d409bac, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GlobalSetFlagAndCache(WYR_RefugeeCamp_State_BigBarnSolved_9dc06a8d-c8d6-3086-615a-6b77d2cf3fdb);

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_InPrison_e96b73b9-1e15-75f1-e61d-af9b713d6b25, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GlobalSetFlagAndCache(WYR_RefugeeCamp_State_BigBarnSolved_9dc06a8d-c8d6-3086-615a-6b77d2cf3fdb);

PROC
PROC_BookFlags_FlagSet(S_WYR_MerchantsHouse_BlackmailLetter_de06faf4-6d56-426b-abbc-e64f86de3951, WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
StartVoiceBark(WYR_MerchantsHouse_VB_FoundEvidence_124b15da-d26e-6f33-5532-97379ac0d78e, _Var1);

IF
TemplateAddedTo((ROOT)_Var1, _, (CHARACTER)_Var3, _, (ROOT)_Var1)
AND
DB_WYR_MerchantsHouse_BasementToyRoots(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var3, S_WYR_MerchantsHouse_Basement_SUB_61d236cb-269a-41b6-b381-1e4a7582bf23, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var3, "WYR_MerchantsHouse_PickedToyVoiceBark", _Var1, _Var1, _Var1)
THEN
StartVoiceBark(WYR_MerchantsHouse_VB_PickedBasementToy_fcededb8-0fe7-4dd8-1742-8daf56530f05, _Var3);

IF
TextEvent("WYR_MerchantsHouse_StealGold", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetGold(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 > 0
AND
IntegerSubtract(0, _Var2, _Var3, _Var1, _Var1)
THEN
AddGold(_Var1, _Var2);
AddGold(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, _Var3);

IF
TextEvent("WYR_MerchantsHouse_ChaseOut", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51);
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Knows_Refugees_8e235664-43aa-304d-1a1f-839214b598d6);
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ChasingOutSuggested_0b5bffb8-4204-98e5-f27f-429c065c9d37);
PROC_WYR_MerchantsHouse_RefugeesWalkChased();

IF
TextEvent("WYR_MerchantsHouse_ThugsChasingOut", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51);
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Knows_Refugees_8e235664-43aa-304d-1a1f-839214b598d6);
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_State_ThugsChasedOutRefuges_caec5b7a-b2a9-3cc6-595d-fc1bcf74521f);
PROC_State_Progress(S_WYR_MerchantsHouse_Merchant_b2a50d09-709a-483c-9818-acebcff2b977, "WYR_MerchantsHouse", "ThugsChasingOut");

IF
TextEvent("WYR_MerchantsHouse_KnowsBasement", _, _, _, _)
THEN
PROC_WYR_MerchantsHouse_DebugKnowsBasement();

PROC
PROC_WYR_MerchantsHouse_DebugKnowsBasement()
THEN
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51);
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Knows_Refugees_8e235664-43aa-304d-1a1f-839214b598d6);
PROC_GlobalSetFlagAndCache(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3);

IF
FlagSet(WYR_RefugeeCamp_Knows_Donations_c0d6097c-eec0-c30d-05c0-a669c53aaa52, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "LearnedDonations");

IF
FlagSet(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundBlackmail_After");

IF
FlagSet(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_InSharessCaress_e7b92dab-47c2-f78a-1121-f18f3e6a534d, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundBlackmail_After");

IF
FlagSet(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Knows_InSharessCaress_e7b92dab-47c2-f78a-1121-f18f3e6a534d, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundBlackmail_After_SC");

IF
FlagSet(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Knows_InSharessCaress_e7b92dab-47c2-f78a-1121-f18f3e6a534d, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundBlackmail_After_DoesntKnow");

IF
FlagSet(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundToys_DoesntKnow");

IF
FlagSet(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_ConflictHasMet_b4d61811-09bf-c6dd-9841-5d77a3164e51, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_GoneFromHouse_5e40419b-d67c-4bde-8b91-bdace8bad309, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundToys_Knows");

IF
FlagSet(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_InSharessCaress_e7b92dab-47c2-f78a-1121-f18f3e6a534d, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundToys_Knows");

IF
FlagSet(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Knows_InSharessCaress_e7b92dab-47c2-f78a-1121-f18f3e6a534d, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundToys_Knows_SC");

IF
FlagSet(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "Confront_WentToSC");

IF
GameBookInterfaceClosed(S_WYR_MerchantsHouse_LetterToMamzell_24b5fe9a-e5fb-4d61-96d0-ee4af43b4c96, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_WYR_MerchantsHouse_ReadMamzellLetter(1);

IF
DB_WYR_MerchantsHouse_ReadMamzellLetter(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_MerchantsHouse_FindObjectiveSteps(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_QuestUpdateIsUnlockedForAny("WYR_Donations", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate("WYR_Donations", "KnowsLikesSC");

IF
QuestUpdateUnlocked(_, "WYR_Donations", (STRING)_Var2, _, _)
AND
DB_WYR_MerchantsHouse_FindObjectiveSteps(_Var2, _, _, _, _)
AND
DB_WYR_MerchantsHouse_ReadMamzellLetter(1, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "KnowsLikesSC");

IF
FlagSet(WYR_MerchantsHouse_Knows_InSharessCaress_e7b92dab-47c2-f78a-1121-f18f3e6a534d, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_InSharessCaress_0705f4a6-48c2-afbd-8e4c-a4cf1d2c09e6, _, _, _, _)
AND
DB_WYR_MerchantsHouse_FindObjectiveSteps(_Var3, _, _, _, _)
AND
QRY_QuestUpdateIsUnlockedForAny("WYR_Donations", _Var3, _, _, _)
THEN
QuestUpdate("WYR_Donations", "FoundInSC");

IF
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_RefugeeCamp_State_BigBarnSolved_9dc06a8d-c8d6-3086-615a-6b77d2cf3fdb, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_FireworksHouse_Knows_Password_dcf4bb90-caf1-079f-d9bb-c51c3463b79e, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "ArfurUnreachable");

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_FireworksHouse_Knows_Password_dcf4bb90-caf1-079f-d9bb-c51c3463b79e, WYR_MerchantsHouse_Merchant_90252ba6-d583-c79d-f60d-211a72e496bb, _, _, _)
THEN
QuestUpdate("WYR_Donations", "LearnedPassword_ArfurConfessed");

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_FireworksHouse_Knows_Password_dcf4bb90-caf1-079f-d9bb-c51c3463b79e, WYR_MerchantsHouse_Merchant_Dead_99670fe2-39ba-fe87-0b99-46ffbe00a75e, _, _, _)
THEN
QuestUpdate("WYR_Donations", "LearnedPassword");

IF
FlagSet(LOW_FireworksHouse_Knows_GortashBehind_2aece2e5-2a24-4e5b-a67f-670fb4173c76, _, _, _, _)
AND
DB_WYR_MerchantsHouse_InvestigateObjectiveSteps(_Var3, _, _, _, _)
AND
QRY_QuestUpdateIsUnlockedForAny("WYR_Donations", _Var3, _, _, _)
THEN
QuestUpdate("WYR_Donations", "LearnedGortashBehind");

IF
RelationChanged(Hero_a1542c81-6895-929e-4522-10ce218bb360, ACT3_LOW_FireworksHouse_Banites_f1aedb53-13e0-4a04-a037-1be782d39392, 0, 1, (STRING)_Var1)
AND
DB_WYR_MerchantsHouse_InvestigateObjectiveSteps(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_QuestUpdateIsUnlockedForAny("WYR_Donations", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate("WYR_Donations", "BanitesAttacked");

IF
DB_LOW_FireworksHouse_BanitesPermaDefeated(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_MerchantsHouse_InvestigateObjectiveSteps(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_QuestUpdateIsUnlockedForAny("WYR_Donations", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate("WYR_Donations", "BanitesDefeated");

IF
DB_GlobalFlag(WYR_MerchantsHouse_Merchant_State_PermaDefeated_9c5cdc84-7fa5-8499-dc3b-63df44288d3c, _, _, _, _)
AND
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_LOW_FireworksHouse_BanitesPermaDefeated(1, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "BanitesDefeated_BeforeArfur");
QuestUpdate("WYR_Donations", "DealtArfur_AfterFireworks_NoConfession");

IF
DB_GlobalFlag(WYR_MerchantsHouse_State_MerchantConfessed_b9c702f4-ed9c-4fe5-0250-8bd96d21a044, _, _, _, _)
AND
DB_GlobalFlag(WYR_RefugeeCamp_State_FoundTrappedToys_c132806f-00ab-955d-9338-348663af1712, _, _, _, _)
AND
DB_GlobalFlag(WYR_MerchantsHouse_Knows_SecretInBasement_8f53ab96-0dff-ec9e-d9e8-30620e8733d3, _, _, _, _)
AND
DB_LOW_FireworksHouse_BanitesPermaDefeated(1, _, _, _, _)
THEN
QuestUpdate("WYR_Donations", "BanitesDefeated_BeforeArfur");
QuestUpdate("WYR_Donations", "ArfurConfessed_AfterFireworks");

IF
FlagSet(WYR_MerchantsHouse_Merchant_Event_GiveReward_0b156e28-688b-98a1-f63f-03c8f79a0ae7, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
QuestUpdate(_Var1, "HIDDEN_BGO_Boosters", "WYR_MerchantsHouse_ChasingOut");


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3"
