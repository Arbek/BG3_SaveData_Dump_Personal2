Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_Leader_44569c62-70e8-28bc-7cec-fdf051daa339);
DB_Dialogs(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, DEN_ShadowDruid_Opposed_86e153fa-7a4a-7494-ff78-944beec2d4e0);
DB_Dialogs(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, DEN_ShadowDruid_KidFreed_5c74f12a-1806-ba6b-8fa1-66d4f6b85281);
DB_Inclusion_Object(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, DEN_PetWolf_StartInclusion_492f083e-44ee-751c-2f20-01ed9084ac66, DEN_PetWolf_EndInclusion_9a8cbc05-646d-3c69-86d0-a46b5ebb2403);
DB_Dialogs(S_DEN_ShadowDruid_001_0cb92c37-fb4d-4547-8702-1fb1dd52d0b6, DEN_ShadowDruid_001_a40bb913-19c6-6feb-2fe7-0af38b106584);
DB_Dialogs(S_DEN_ShadowDruid_002_0820c093-f400-4efc-95b9-a6d08a58cac9, DEN_ShadowDruid_002_aabb5613-528f-d50b-5992-a1fd2b5c3b45);
DB_Dialogs(S_DEN_ShadowDruid_003_53b08334-9f79-4bb5-b580-2662355d54ad, DEN_ShadowDruid_003_ae9b341f-faa6-436f-30f1-273be7ca40ac);
DB_DropMutingStatussesDialog(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7);
DB_IgnoreMutingStatussesDialog(DEN_ShadowDruid_001_a40bb913-19c6-6feb-2fe7-0af38b106584);
DB_IgnoreMutingStatussesDialog(DEN_ShadowDruid_002_aabb5613-528f-d50b-5992-a1fd2b5c3b45);
DB_IgnoreMutingStatussesDialog(DEN_ShadowDruid_003_ae9b341f-faa6-436f-30f1-273be7ca40ac);
DB_GLO_CharacterCorpseDialog(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_DruidLeader_Dead_cdc78613-34d7-a652-db0b-127c98f11526);
DB_DialogBlockAttackButton(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7);
DB_AddCharactersInTriggerToDialog(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, S_DEN_SnakesCourtProxSphere_8456dca4-15a1-44b6-93e6-63a7a8a75f06, 1);
PROC_TriggerRegisterForPlayers(S_DEN_SnakesCourtStartBox_01d25948-1be8-4cbe-83de-b75b9cb10fed);
PROC_TriggerRegisterForPlayers(S_DEN_SnakesCourtProxSphere_8456dca4-15a1-44b6-93e6-63a7a8a75f06);
DB_SceneManager(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_Snake_001_af2ff867-467e-4765-a66c-fed091af4a09, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_ShadowDruid_001_0cb92c37-fb4d-4547-8702-1fb1dd52d0b6, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_ShadowDruid_003_53b08334-9f79-4bb5-b580-2662355d54ad, "DEN_SnakeCourt");
DB_SceneManager(S_DEN_ShadowDruid_002_0820c093-f400-4efc-95b9-a6d08a58cac9, "DEN_SnakeCourt");
DB_DEN_ShadowDruid_SnakeCourtReactors(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d);
DB_DEN_ShadowDruid_SnakeCourtReactors(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);
DB_State_Current(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "Exposition");
DB_State_Priority(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "Exposition", 0);
DB_State_Priority(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "CourtDialog", 100);
DB_State_Priority(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "SnakeBite", 200);
DB_State_Priority(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "KidFreed", 300);
DB_State_Priority(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "Finished", 500);
DB_DEN_ShadowDruid_Snakes(S_DEN_Snake_001_af2ff867-467e-4765-a66c-fed091af4a09);
DB_DEN_ShadowDruid_KidDied_Internal(1);
DB_DEN_ShadowDruid_Originals(S_DEN_ShadowDruid_001_0cb92c37-fb4d-4547-8702-1fb1dd52d0b6);
DB_DEN_ShadowDruid_Originals(S_DEN_ShadowDruid_002_0820c093-f400-4efc-95b9-a6d08a58cac9);
DB_DEN_ShadowDruid_Originals(S_DEN_ShadowDruid_003_53b08334-9f79-4bb5-b580-2662355d54ad);
DB_DEN_ShadowDruids(S_DEN_ShadowDruid_001_0cb92c37-fb4d-4547-8702-1fb1dd52d0b6);
DB_DEN_ShadowDruids(S_DEN_ShadowDruid_003_53b08334-9f79-4bb5-b580-2662355d54ad);
DB_DEN_ShadowDruids(S_DEN_ShadowDruid_002_0820c093-f400-4efc-95b9-a6d08a58cac9);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_ShadowDruid_001_0cb92c37-fb4d-4547-8702-1fb1dd52d0b6);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_ShadowDruid_003_53b08334-9f79-4bb5-b580-2662355d54ad);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_ShadowDruid_002_0820c093-f400-4efc-95b9-a6d08a58cac9);
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753);
DB_HasItemEvent(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, DEN_ShadowDruid_State_HasRecruitmentLetter_75c42284-4caa-4193-84a6-951fdff58357);
DB_GiveItemToEventWithClear(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, DEN_ShadowDruid_Event_GiveRecruitmentLetter_7ee8c1f8-4b82-4abf-880a-5cd7abda7475);
DB_BookFlags(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, DEN_ShadowDruid_Knows_RecruitmentLetter_587f1e08-f890-4740-a588-e76778143fec);
DB_BookFlags(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, DEN_ShadowDruid_Knows_MeetingLocation_a8b8b540-e0d5-4c21-9de1-949de855f094);
DB_BookFlags(S_DEN_ShadowMeetingNote_fbe59587-8dec-440c-94d2-2748727c4cf5, DEN_ShadowDruid_Knows_MeetingLocation_a8b8b540-e0d5-4c21-9de1-949de855f094);
SetOnStage(S_DEN_FaithwardenStaff_5de75000-9141-466b-9019-70df488b2958, 0);
DB_FlagReactionAfterDialog(DEN_ShadowDruid_State_CourtHostile_b79f3102-f47e-339c-23f2-1de2c38d4e6e, DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7);
DB_FlagReactionAfterDialog(DEN_ShadowDruid_State_CourtHostile_b79f3102-f47e-339c-23f2-1de2c38d4e6e, DEN_ShadowDruid_Leader_44569c62-70e8-28bc-7cec-fdf051daa339);
PROC_TriggerRegisterForPlayers(S_HAG_ShadowTreeSphere_692f6baa-8e34-4474-9afa-96421fb6c294);
SetCanInteract(S_HAG_ShadowTree_30fe7685-0a91-45af-bcfc-9e68a985927a, 0);
DB_PermaDefeatedEvent(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_State_KaghaIsDead_d7db3ef4-acf7-d0e3-dcd1-1c4b8ca6ba46);
DB_PermaDefeatedEvent(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, DEN_ShadowDruid_State_RathIsPermaDefeated_439d7789-34eb-a928-7881-b557a5f53150);
DB_ReportKiller(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_State_PlayerKilledKagha_361be740-5c39-49c1-9d3a-ec6a46e3e134);
DB_QuestDef_BookReadState("DEN_Conflict", "ReflectedKagha", S_DEN_DruidRite_466a08de-7143-409f-b12e-6f5440e19793);
DB_DEN_ShadowDruid_KaghaCombatADCount(1);

KBSECTION
IF
FlagSet(DEN_ShadowDruid_Debug_ResolveKidDie_76076244-4ddf-f7e1-c288-6572d72bf3c1, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_DEN_ShadowDruid_CourtOutcome(0);

IF
FlagSet(DEN_ShadowDruid_Debug_ResolveKidAlive_dfcf720f-16ce-b7e6-bfeb-d111b90b2f0f, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(DEN_ShadowDruid_State_KidFreed_8d9e9065-7bb5-a516-15c3-c9d8c1f4f5e2, NULL_00000000-0000-0000-0000-000000000000);
PROC_DEN_ShadowDruid_CourtOutcome(1);

IF
TextEvent("snakecourtdone", _, _, _, _)
THEN
PROC_State_Progress(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "CourtDialog");

IF
TextEvent("snakecourtdone", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_SceneManager(_Var1, "DEN_SnakeCourt", _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);

IF
TextEvent("snakecourtdone", _, _, _, _)
AND
GetTextEventParamInteger(1, 1, _, _, _)
THEN
NOT DB_DEN_ShadowDruid_KidDied_Internal(1);
SetFlag(DEN_ShadowDruid_State_KidFreed_8d9e9065-7bb5-a516-15c3-c9d8c1f4f5e2, NULL_00000000-0000-0000-0000-000000000000);

IF
TextEvent("snakecourtdone", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetFlag(DEN_ShadowDruid_State_KidFreed_8d9e9065-7bb5-a516-15c3-c9d8c1f4f5e2, NULL_00000000-0000-0000-0000-000000000000, _Var1, _Var1, _Var1)
THEN
PROC_DEN_ShadowDruid_CourtOutcome(_Var1);

IF
FlagSet(DEN_ShadowDruid_Debug_GiveKaghaLetter_fdf4dca6-e883-55de-98fb-855ec00491e1, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ToInventory(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, _Var1, 1, 1, 0);
ToInventory(S_DEN_ShadowMeetingNote_fbe59587-8dec-440c-94d2-2748727c4cf5, _Var1, 1, 1, 0);
ToInventory(S_DEN_ShadowTenetsBook_87cad28c-6d41-4532-9289-38ab96ee30f5, _Var1, 1, 1, 0);

IF
TextEvent("denouncingkagha", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, _Var1, 1, 1, 0);
ToInventory(S_DEN_ShadowMeetingNote_fbe59587-8dec-440c-94d2-2748727c4cf5, _Var1, 1, 1, 0);
ToInventory(S_DEN_ShadowTenetsBook_87cad28c-6d41-4532-9289-38ab96ee30f5, _Var1, 1, 1, 0);
SetFlag(DEN_ShadowDruid_Knows_RecruitmentLetter_587f1e08-f890-4740-a588-e76778143fec, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(DEN_ShadowDruid_Knows_MeetingLocation_a8b8b540-e0d5-4c21-9de1-949de855f094, NULL_00000000-0000-0000-0000-000000000000);

IF
TextEvent("denouncingkaghadone", _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);
DB_Dialogs(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_LeaderPersuaded_e66c2f8b-2c9f-35a1-6564-1aa0fc08a020);
PROC_State_Progress(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RitualStopped");

IF
TextEvent("denouncingkaghadone", _, _, _, _)
AND
GetTextEventParamInteger(1, 1, _, _, _)
THEN
SetFlag(DEN_ShadowDruid_Event_KaghaTurnedGood_f2de839d-b971-86ee-f02c-5e09174ce919, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_DEN_ShadowDruids(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);
NOT DB_DEN_ShadowDruids(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8);
NOT DB_DEN_ShadowDruids(S_DEN_ServantPatrolling_0d971a2f-5fd7-4358-8966-147ed8b106dd);

IF
TextEvent("denouncingkaghadone", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var1, DRUID_44ac4317-4d38-4d28-80e2-94024c6e42f0, 1, _Var1, _Var1)
THEN
DB_DEN_ShadowDruid_DruidDenouncer(_Var1);

IF
TextEvent("denouncingkaghadone", _, _, _, _)
THEN
PROC_DEN_ShadowDruid_DenouncingDialogEnded();

IF
TextEvent("denouncingkaghadone", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_ShadowDruids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 0);

IF
DB_DEN_ShadowDruid_Originals(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetCanFight(_Var1, 0);
SetCanJoinCombat(_Var1, 0);
PROC_CharacterDisableAllCrimes(_Var1);
PROC_SelfHealing_Disable(_Var1);

IF
FlagSet(DEN_ShadowDruid_Event_RemoveWildShape_6fe9a871-0a72-634c-e993-0c0ccad87784, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND
DB_DEN_ShadowDruid_Originals(_Var2, _, _, _, _)
THEN
RemoveStatus(_Var2, "WILDSHAPE_RAT_SECRET");

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
_Var1 != "DEN_State_RitualStopped"
AND
DB_DEN_ShadowDruid_Originals(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GEN_DisappearOutOfSightWhenAvailable_a5b0b401-a04d-6493-579b-d87cff1474cb, _Var2);

IF
AttackedBy((CHARACTER)_Var1, _, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_ShadowDruid_Originals(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RitualStopped", _Var1, _Var1)
AND
DB_DEN_ShadowDruid_Originals(_Var8, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GEN_DisappearOutOfSightWhenAvailable_a5b0b401-a04d-6493-579b-d87cff1474cb, _Var8);

IF
HitpointsChanged((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_ShadowDruid_Originals(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RitualStopped", _Var1, _Var1)
AND
GetHitpointsPercentage(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
_Var3 > 0
AND
_Var3 < 100
AND
DB_DEN_ShadowDruid_Originals(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GEN_DisappearOutOfSightWhenAvailable_a5b0b401-a04d-6493-579b-d87cff1474cb, _Var4);

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _, (STRING)_, (STRING)_)
THEN
PROC_DEN_ShadowDruid_SnakeCourtSceneEnded();

PROC
PROC_SceneInterrupted(S_DEN_Snake_001_af2ff867-467e-4765-a66c-fed091af4a09, _, "DEN_SnakeCourt", (STRING)_Var2, _)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var2, _, _, _, _)
THEN
SetFlag(DEN_ShadowDruid_State_KidFreed_8d9e9065-7bb5-a516-15c3-c9d8c1f4f5e2);

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "DEN_SnakeCourt", (STRING)_Var3, _)
AND
_Var3 != "StartedDialog"
THEN
PROC_DEN_ShadowDruid_ProcessSnakeCourtInterruption(_Var3, _Var2);

PROC
PROC_DEN_ShadowDruid_ProcessSnakeCourtInterruption((STRING)_Var1, (CHARACTER)_Var2, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_ShadowDruids_SnakeCourtInterrupted", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_ShadowDruid_SnakeCourtSceneEnded();

PROC
PROC_DEN_ShadowDruid_ProcessSnakeCourtInterruption((STRING)_Var1, (CHARACTER)_Var2, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_ShadowDruids_SnakeCourtInterrupted", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_DruidAttack_TryStart(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _Var2);

PROC
PROC_DEN_ShadowDruid_ProcessSnakeCourtInterruption((STRING)_Var1, (CHARACTER)_Var2, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
DB_GLO_GenericSceneManager_ViolenceReason(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(_, "DEN_SnakeCourt", "Exposition", _Var1, _Var1)
AND
IsSpeakerReserved(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, 0, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_ShadowDruids_SnakeCourtInterrupted", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd, _Var2, 0, 0, 1, 1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("DEN_ShadowDruids_SnakeCourtInterrupted");
PROC_State_Progress(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "CourtDialog");

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_SnakesCourtProxSphere_8456dca4-15a1-44b6-93e6-63a7a8a75f06, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(_, "DEN_SnakeCourt", "Exposition", _Var1, _Var1)
THEN
SetFlag(DEN_GuardedEntrance_Knows_KaghaHoldsChild_c842fabb-1603-ce99-df44-e284f8e79de0, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_DEN_ShadowDruid_Snakes(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetHasDialog(_Var1, 1);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_SnakesCourtStartBox_01d25948-1be8-4cbe-83de-b75b9cb10fed, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(_, "DEN_SnakeCourt", "Exposition", _Var1, _Var1)
AND
IsSpeakerReserved(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, 0, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd, _Var1, 0, 0, 1, 1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_State_Progress(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "CourtDialog");

QRY
QRY_SpeakerIsAvailableForDialogSlot((CHARACTER)_Var1, DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, 6, 0, _)
AND
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantAct(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_DialogFlagSetup(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, _, _, _, _, _, (CHARACTER)_Var6, _, _, _)
AND
DB_Is_WildShaped(_Var6, _, _, _, _)
THEN
SetFlag(DEN_SnakesCourt_State_WildShapedPlayer_fe0a86d9-37af-4746-bb2d-fb3cee9d197a);

PROC
PROC_State_Changed(_, "DEN_SnakeCourt", _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_SnakesCourtStartBox_01d25948-1be8-4cbe-83de-b75b9cb10fed);

QRY
QRY_SelectCustomDialog((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_SceneManager(_Var1, "DEN_SnakeCourt", _Var1, _Var1, _Var1)
AND
DB_State_Current(_, "DEN_SnakeCourt", "Exposition", _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var2, 0, 1, _Var1, _Var1)
THEN
DB_SelectedDialog(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd, _Var2);
PROC_State_Progress(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "CourtDialog");

PROC
PROC_State_Changed(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "CourtDialog", _, _)
THEN
SetFlag(DEN_ShadowDruid_State_SnakeCourtStarted_461195aa-0d53-44c3-bc45-3b8bbe59649d, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_StartDialog_AddExtraSpeakers(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DEN_ShadowDruid_Snakes(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, _Var2);

IF
DialogEnded(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
DB_DEN_ShadowDruid_SnakesCourtHappened(1);
PROC_DEN_ShadowDruid_SnakeCourtSceneEnded();

PROC
PROC_DEN_ShadowDruid_SnakeCourtSceneEnded()
AND
GetFlag(DEN_ShadowDruid_State_KidFreed_8d9e9065-7bb5-a516-15c3-c9d8c1f4f5e2, NULL_00000000-0000-0000-0000-000000000000, _Var1, _Var1, _Var1)
AND
DB_Negate(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_ShadowDruid_KidDied_Internal(1);
DB_DEN_ShadowDruid_KidDied_Internal(_Var2);
PROC_DEN_ShadowDruid_CourtOutcome(_Var1);

PROC
PROC_DEN_ShadowDruid_CourtOutcome(0, _, _, _, _)
THEN
PROC_State_Progress(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "SnakeBite");

PROC
PROC_State_Changed(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "SnakeBite", _, _)
THEN
PROC_DEN_ShadowDruid_KillKid();

PROC
PROC_DEN_ShadowDruid_KillKid()
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _Var1, _Var1, _Var1)
AND
_Var1 != "DEN_State_Peace"
AND
DB_QuestIsOpened("DEN_SnakeCourt", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate("DEN_SnakeCourt", "SkippedHelp");

PROC
PROC_DEN_ShadowDruid_KillKid()
THEN
PROC_DEN_SnakeKid_RemoveFromDruidAttack();
SetImmortal(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, 0);
TeleportTo(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_SnakeKidDeadPoint_1d397b23-d7e6-46ee-a2f2-9090a8274b74, "");
Die(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, 0, S_DEN_Snake_001_af2ff867-467e-4765-a66c-fed091af4a09, 1, 1);
SetFlag(DEN_ShadowDruid_State_KidDied_5b5de896-e733-47ae-81df-85a4b25ebfd1, NULL_00000000-0000-0000-0000-000000000000);
SetCharacterLootOwned(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, 1);
DB_GLO_CharacterCorpseDialog(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, DEN_General_Dead_SnakeKid_b7ad5d8d-1778-feb3-d4bc-8b2f18f14f98);

PROC
PROC_DEN_ShadowDruid_KillKid()
AND
DB_DEN_NPC(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, _Var1, _Var2, _Var1, _Var1)
THEN
NOT DB_DEN_NPC(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, _Var1, _Var2);

PROC
PROC_DEN_SnakeKid_RemoveFromDruidAttack()
THEN
DB_NOOP(1);

IF
DialogEnded(DEN_ShadowDruid_SnakesCourt_459ca406-18ce-99f7-6dbe-492ea6268bb7, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND
GetFlag(DEN_ShadowDruid_State_KidDied_5b5de896-e733-47ae-81df-85a4b25ebfd1, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
THEN
StartVoiceBark(DEN_ShadowDruid_VB_KidDied_b36bf8fe-bc57-4659-18ea-6bf2219e24fd, _Var2);

PROC
PROC_DEN_ShadowDruid_CourtOutcome(1, _, _, _, _)
THEN
PROC_State_Progress(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "KidFreed");

PROC
PROC_DEN_ShadowDruid_CourtOutcome(1, _, _, _, _)
AND
QRY_DEN_CheckPeaceState()
THEN
PROC_CharacterMoveTo(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_LairMainInPoint_195062b4-ff6c-46cc-aae1-961fcf4ecf56, "Run", "DEN_ShadowDruid_KidRanToLairDoor");

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_DruidAttack", _, _)
AND
DB_GlobalFlag(DEN_ShadowDruid_State_KidFreed_8d9e9065-7bb5-a516-15c3-c9d8c1f4f5e2, _, _, _, _)
THEN
PROC_ClearStoryMove(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f);
SetEntityEvent(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_ShadowDruid_KidRanToParent");

PROC
PROC_State_Changed(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "KidFreed", _, _)
THEN
PROC_DEN_AddOrUpdateDenNPC(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "Hideout", DEN_AttackOnDen_SnakeKid_1d800272-037e-6143-c939-07f2a1dfcc2e);

IF
EntityEvent(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_ShadowDruid_KidRanToLairDoor", _, _, _)
THEN
Use(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_LairMainInDoor_026d20eb-779c-4e49-a6f6-70b2dfe8678b, 1, 0, "DEN_ShadowDruid_KidUsedLairDoor");

IF
EntityEvent(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_ShadowDruid_KidUsedLairDoor", _, _, _)
THEN
PROC_CharacterMoveTo(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_ParentA_d6d88c8b-6ba7-4350-b3b3-d60565a44e90, "Run", "DEN_ShadowDruid_KidRanToParent");

PROC
PROC_DEN_ShadowDruid_CourtOutcome(_, (INTEGER)_, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_DEN_ShadowDruid_CourtSceneEnds();

PROC
PROC_DEN_ShadowDruid_CourtSceneEnds()
AND
QRY_OnlyOnce("DEN_ShadowDruid_SnakeCourtEnds", _, _, _, _)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_SnakesCourtStartBox_01d25948-1be8-4cbe-83de-b75b9cb10fed);
PROC_DEN_ShadowDruid_TryReactToScene();
SetFlag(DEN_ShadowDruid_State_SnakesCourtDone_cf58dd01-e058-42b8-b1f1-976250296ce6, NULL_00000000-0000-0000-0000-000000000000);
PROC_DEN_ShadowDruid_SnakesLeave();
PROC_SceneOver("DEN_SnakeCourt");
PROC_State_Progress(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, "DEN_SnakeCourt", "Finished");

PROC
PROC_DEN_ShadowDruid_SnakesLeave()
AND
QRY_OnlyOnce("DEN_ShadowDruid_SnakesLeave", _, _, _, _)
AND
DB_DEN_ShadowDruid_Snakes(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 1, "");

PROC
PROC_DEN_ShadowDruid_TryReactToScene()
AND
DB_SceneManager(_Var1, "DEN_SnakeCourt", _Var1, _Var1, _Var1)
AND NOT
DB_DEN_ShadowDruid_SnakeCourtReactors(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_ShadowDruid_Event_ReactionDone_be576fb3-ba9c-4375-8870-e0f66e6eeb4c, _Var1);

PROC
PROC_DEN_ShadowDruid_TryReactToScene()
AND NOT
QRY_DEN_ShadowDruid_ReactToDeadKid()
AND
DB_DEN_ShadowDruid_KidDied_Internal(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_ShadowDruid_KidDied_Internal(_Var1);
SetFlag(DEN_ShadowDruid_Event_ReactionDone_be576fb3-ba9c-4375-8870-e0f66e6eeb4c, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d);
SetFlag(DEN_ShadowDruid_Event_ReactionDone_be576fb3-ba9c-4375-8870-e0f66e6eeb4c, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);

QRY
QRY_DEN_ShadowDruid_ReactToDeadKid()
AND
DB_DEN_ShadowDruid_KidDied_Internal(1, _, _, _, _)
AND
DB_GlobalFlag(DEN_ShadowDruid_State_SnakeCourtStarted_461195aa-0d53-44c3-bc45-3b8bbe59649d, _, _, _, _)
AND NOT
DB_CantTalk(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, _, _, _, _)
AND NOT
DB_CantTalk(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _, _, _, _)
AND
QRY_DEN_CheckPeaceState()
AND
QRY_StartDialog(DEN_ShadowDruid_AD_ReactToDeadKid_762ebed6-3c17-a4ae-0915-39de07c2010e, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _, _)
THEN
NOT DB_DEN_ShadowDruid_KidDied_Internal(1);

IF
AutomatedDialogEnded(DEN_ShadowDruid_AD_ReactToDeadKid_762ebed6-3c17-a4ae-0915-39de07c2010e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(DEN_ShadowDruid_Event_ReactionDone_be576fb3-ba9c-4375-8870-e0f66e6eeb4c, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d);
SetFlag(DEN_ShadowDruid_Event_ReactionDone_be576fb3-ba9c-4375-8870-e0f66e6eeb4c, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);

IF
AutomatedDialogRequestFailed(DEN_ShadowDruid_AD_ReactToDeadKid_762ebed6-3c17-a4ae-0915-39de07c2010e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(DEN_ShadowDruid_Event_ReactionDone_be576fb3-ba9c-4375-8870-e0f66e6eeb4c, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d);
SetFlag(DEN_ShadowDruid_Event_ReactionDone_be576fb3-ba9c-4375-8870-e0f66e6eeb4c, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);

IF
LeftTrigger((CHARACTER)_Var1, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(DEN_ShadowDruid_State_KidDied_5b5de896-e733-47ae-81df-85a4b25ebfd1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("DEN_ShadowDruid_RemoveKid", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_CheckOtherPlayersInTrigger(NULL_00000000-0000-0000-0000-000000000000, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, 1, _Var1, _Var1)
THEN
PROC_DEN_ShadowDruid_RemoveChildCorpse();

IF
FlagSet(DEN_ShadowDruid_State_KidDied_5b5de896-e733-47ae-81df-85a4b25ebfd1, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND NOT
DB_OnlyOnce("DEN_ShadowDruid_RemoveKid", _, _, _, _)
AND NOT
QRY_CheckOtherPlayersInTrigger(NULL_00000000-0000-0000-0000-000000000000, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, _, _, _)
AND
IsInTrigger(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, 1, _, _)
THEN
PROC_DEN_ShadowDruid_RemoveChildCorpse();

PROC
PROC_DEN_ShadowDruid_KillKid()
AND NOT
DB_OnlyOnce("DEN_ShadowDruid_RemoveKid", _, _, _, _)
AND NOT
QRY_CheckOtherPlayersInTrigger(NULL_00000000-0000-0000-0000-000000000000, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, _, _, _)
THEN
PROC_DEN_ShadowDruid_RemoveChildCorpse();

IF
CharacterLootedCharacter(_, S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, _, _, _)
AND
DB_GlobalFlag(DEN_ShadowDruid_State_KidDied_5b5de896-e733-47ae-81df-85a4b25ebfd1, _, _, _, _)
AND NOT
DB_OnlyOnce("DEN_ShadowDruid_RemoveKid", _, _, _, _)
AND
IsInTrigger(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, 1, _, _)
THEN
SetEntityEvent(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, "DEN_ShadowDruid_StopMourningKid");

IF
OnThrown(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, _, (GUIDSTRING)_Var2, _, _, _, _, _, _, _)
AND
DB_GlobalFlag(DEN_ShadowDruid_State_KidDied_5b5de896-e733-47ae-81df-85a4b25ebfd1, _, _, _, _)
AND NOT
DB_OnlyOnce("DEN_ShadowDruid_RemoveKid", _, _, _, _)
AND
IsInTrigger(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, 1, _, _)
THEN
SetEntityEvent(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, "DEN_ShadowDruid_StopMourningKid");

PROC
PROC_State_Progress(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", _, _, _)
AND
DB_GlobalFlag(DEN_ShadowDruid_State_KidDied_5b5de896-e733-47ae-81df-85a4b25ebfd1, _, _, _, _)
THEN
SetEntityEvent(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, "DEN_ShadowDruid_StopMourningKid");

PROC
PROC_DEN_ShadowDruid_RemoveChildCorpse()
AND
QRY_OnlyOnce("DEN_ShadowDruid_RemoveKid", _, _, _, _)
THEN
SetCharacterLootOwned(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, 0);
SetEntityEvent(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, "DEN_ShadowDruid_StopMourningKid");
SetOnStage(S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f, 0);
CreateSurface(S_DEN_SnakeKidDeadPoint_1d397b23-d7e6-46ee-a2f2-9090a8274b74, "SurfaceNone", 2, 1);
DB_DEN_ShadowDruid_ReadyToBuryKid(1);

IF
DB_DEN_ShadowDruid_ReadyToBuryKid(1, _, _, _, _)
AND NOT
DB_DEN_PlayerInDen(_, _, _, _, _)
THEN
NOT DB_DEN_ShadowDruid_ReadyToBuryKid(1);
PROC_DEN_ShadowDruid_BuryChild();

PROC
PROC_DEN_ShadowDruid_BuryChild()
THEN
DB_NOOP(1);

PROC
PROC_ReportKiller(_, _, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, (FLAG)_Var3, (CHARACTER)_)
THEN
SetFlag(_Var3, NULL_00000000-0000-0000-0000-000000000000, 0);
NOT DB_ReportKiller(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _Var3);

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Var1, DEN_ShadowDruid_State_CourtHostile_b79f3102-f47e-339c-23f2-1de2c38d4e6e, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_DEN_Conflict_Murder_AttackedKagha(1);
PROC_DEN_DruidAttack_TryStart(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _Var1);

IF
DialogEnded(DEN_ShadowDruid_Leader_44569c62-70e8-28bc-7cec-fdf051daa339, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetFlag(DEN_ShadowDruid_Event_StartDenouncingScene_e01769d4-9ac4-17a0-584e-ceb26e4bc384, NULL_00000000-0000-0000-0000-000000000000, 0, _Var1, _Var1)
THEN
PROC_DEN_ShadowDruid_TrySelfReflection(_Var1);
PROC_DEN_ShadowDruid_ClearFade(_Var1);

IF
DialogEnded(DEN_ShadowDruid_Leader_44569c62-70e8-28bc-7cec-fdf051daa339, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetFlag(DEN_ShadowDruid_Event_StartDenouncingScene_e01769d4-9ac4-17a0-584e-ceb26e4bc384, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
THEN
PROC_DEN_ShadowDruid_CheckDenouncingSceneQueued(_Var1);

PROC
PROC_DEN_ShadowDruid_CheckDenouncingSceneQueued((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_OnlyOnce("DEN_ShadowDruid_DenouncingSceneQueued", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_ShadowDruid_ClearFade(_Var1);

PROC
PROC_DEN_ShadowDruid_CheckDenouncingSceneQueued((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_OnlyOnce("DEN_ShadowDruid_DenouncingSceneQueued", _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("DEN_ShadowDruid_DenouncingSceneQueued");

PROC
PROC_DEN_ShadowDruid_TrySelfReflection((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(DEN_ShadowDruid_State_HadSelfReflection_a630c178-dae8-ae3f-f4be-0c81587208ad, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_ShadowDruid_Knows_MeetingLocation_a8b8b540-e0d5-4c21-9de1-949de855f094, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_ShadowDruid_Knows_RecruitmentLetter_587f1e08-f890-4740-a588-e76778143fec, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_DruidAttack_State_DruidSetup_96fc1420-fa07-4235-98c3-ecb34fcb6b0a, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND NOT
DB_Defeated(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var2, DRUID_44ac4317-4d38-4d28-80e2-94024c6e42f0, 1, _Var1, _Var1)
AND
GetFlag(DEN_ShadowDruid_Knows_KaghaExplainedRite_79678e1b-2002-b357-1ebb-b3f059d1643c, _Var2, 1, _Var1, _Var1)
AND
QRY_StartDialog(DEN_ShadowDruid_SelfReflection_e5c96d60-1e7a-af4e-0e82-28165eefb9dd, _Var2, _Var1, _Var1, _Var1)
THEN
DB_DEN_ShadowDruid_ReflectingPlayer(_Var2);

PROC
PROC_DEN_ShadowDruid_ClearFade((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
AND NOT
DB_DEN_ShadowDruid_ReflectingPlayer(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ClearScreenFadeTimeline(_Var2, 0.5);

PROC
PROC_DEN_ShadowDruid_ClearFade((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DEN_ShadowDruid_ReflectingPlayer(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_ShadowDruid_ReflectingPlayer(_Var2);

IF
FlagSet(DEN_ShadowDruid_State_HadSelfReflection_a630c178-dae8-ae3f-f4be-0c81587208ad, _, _, _, _)
AND NOT
DB_DEN_ShadowDruid_FoundChest(1, _, _, _, _)
THEN
PROC_TriggerRegisterForPlayers(S_DEN_DruidChestHintBox_0fb540c7-f96b-4f14-a139-36540ddd270f);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_DruidChestHintBox_0fb540c7-f96b-4f14-a139-36540ddd270f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_KnowledgeCheck_MP(_Var1, "GLO_HiddenItemCheck", S_DEN_DruidChestHintBox_0fb540c7-f96b-4f14-a139-36540ddd270f, "Perception", DC_Legacy_10_625be976-7a67-4394-97c8-14c69715ae4b, GLO_PerceptionSuccess_48825dbe-a320-7c4c-fe3e-372b717d5bc9, DEN_ShadowDruid_Knows_SpottedChest_e3af9709-a489-480a-a76c-4c347bb1ae8a);

IF
FlagSet(DEN_ShadowDruid_Knows_SpottedChest_e3af9709-a489-480a-a76c-4c347bb1ae8a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_PlayPerceptionRevealEffect(S_DEN_DruidLeaderChest_07033dbc-6e28-4d56-8134-c6ca530cde37, "DEN_ShadowDruid_HiddenChest");
PROC_TriggerUnregisterForPlayers(S_DEN_DruidChestHintBox_0fb540c7-f96b-4f14-a139-36540ddd270f);

IF
UseStarted(_, S_DEN_DruidLeaderChest_07033dbc-6e28-4d56-8134-c6ca530cde37, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
DB_DEN_ShadowDruid_FoundChest(1);
PROC_TriggerUnregisterForPlayers(S_DEN_DruidChestHintBox_0fb540c7-f96b-4f14-a139-36540ddd270f);

IF
Moved(S_DEN_DruidLeaderChest_07033dbc-6e28-4d56-8134-c6ca530cde37, _, _, _, _)
THEN
DB_DEN_ShadowDruid_FoundChest(1);
PROC_TriggerUnregisterForPlayers(S_DEN_DruidChestHintBox_0fb540c7-f96b-4f14-a139-36540ddd270f);

IF
UsingSpellOnTarget(_, S_DEN_DruidLeaderChest_07033dbc-6e28-4d56-8134-c6ca530cde37, _, _, _, _, (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_DEN_ShadowDruid_FoundChest(1);
PROC_TriggerUnregisterForPlayers(S_DEN_DruidChestHintBox_0fb540c7-f96b-4f14-a139-36540ddd270f);

IF
DialogStarted(_, (INTEGER)_Var2, _, _, _)
AND
DB_DialogNPCs(_Var2, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _, _, _)
AND
DB_DialogPlayers(_Var2, _, 1, _, _)
THEN
SetFlag(DEN_ShadowDruid_Knows_SawKagha_0834f728-8a95-45c7-88c3-268befd20a65, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_BookFlags_FlagSet(S_DEN_ShadowMeetingNote_fbe59587-8dec-440c-94d2-2748727c4cf5, DEN_ShadowDruid_Knows_MeetingLocation_a8b8b540-e0d5-4c21-9de1-949de855f094, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DebugText(_Var1, "Map marker on the secret location");

IF
EnteredTrigger((CHARACTER)_Var1, S_HAG_ShadowTreeSphere_692f6baa-8e34-4474-9afa-96421fb6c294, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_ShadowDruid_DetectTreeFailed(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_ShadowDruid_State_DetectedTree_e198c7f7-1068-4346-9136-450e82db41a5, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(DEN_ShadowDruid_Knows_MeetingLocation_a8b8b540-e0d5-4c21-9de1-949de855f094, NULL_00000000-0000-0000-0000-000000000000, _Var2, _Var1, _Var1)
THEN
PROC_DEN_ShadowDruid_CheckSpotTree(_Var1, _Var2);

PROC
PROC_DEN_ShadowDruid_CheckSpotTree((CHARACTER)_Var1, 0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_ShadowDruid_DetectTreeFailed(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_TrySkillCheck(_Var2, S_HAG_ShadowTreeSphere_692f6baa-8e34-4474-9afa-96421fb6c294, "Perception", DC_Legacy_5_6e246ccd-6149-4ec4-a325-034309a18138, "HAG_ShadowTree_Detect");

PROC
PROC_RollResult("HAG_ShadowTree_Detect", (CHARACTER)_Var1, _, 0, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(DEN_ShadowDruid_State_DetectedTree_e198c7f7-1068-4346-9136-450e82db41a5, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_ShadowDruid_DetectTreeFailed(_Var1);

PROC
PROC_RollResult("HAG_ShadowTree_Detect", (CHARACTER)_Var1, _, 1, (CHARACTER)_Var1)
THEN
PROC_DEN_ShadowDruid_CheckSpotTree(_Var1, 1);

PROC
PROC_DEN_ShadowDruid_CheckSpotTree((CHARACTER)_Var1, 1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(DEN_ShadowDruid_State_DetectedTree_e198c7f7-1068-4346-9136-450e82db41a5, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(DEN_ShadowDruid_State_DetectedTree_e198c7f7-1068-4346-9136-450e82db41a5);
SetCanInteract(S_HAG_ShadowTree_30fe7685-0a91-45af-bcfc-9e68a985927a, 1);
PROC_TriggerUnregisterForPlayers(S_HAG_ShadowTreeSphere_692f6baa-8e34-4474-9afa-96421fb6c294);
StartVoiceBark(DEN_ShadowDruid_VB_FoundSecretLocation_9f2f4255-cc68-28a9-73da-0b23f2e33cb9, _Var1);

PROC
PROC_DEN_ShadowDruid_CheckSpotTree(_, 1, _, _, _)
AND
DB_DEN_ShadowDruid_DetectTreeFailed(_Var2, _, _, _, _)
THEN
NOT DB_DEN_ShadowDruid_DetectTreeFailed(_Var2);

IF
GameBookInterfaceClosed(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_State_Current(_, "DEN", "DEN_State_Peace", _Var1, _Var1)
AND NOT
DB_GlobalFlag(DEN_ShadowDruid_Knows_RecruitmentLetter_587f1e08-f890-4740-a588-e76778143fec, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(_Var1, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _Var3, _Var1, _Var1)
AND
_Var3 > 10
THEN
StartVoiceBark(DEN_ShadowDruid_VB_FoundRecruitmentLetter_be0a507d-5b16-a84f-2e4d-baf857c27fa4, _Var1);

PROC
PROC_BookFlags_FlagSet(S_DEN_ShadowDruidsLetter_b0da8ce3-139f-425b-bbce-ae67663b8a2c, DEN_ShadowDruid_Knows_RecruitmentLetter_587f1e08-f890-4740-a588-e76778143fec, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DebugText(_Var1, "Quest update");

IF
FlagSet(DEN_GoblinScouts_Event_Freed_f5dea723-db2a-4e0f-9082-ba9ebc5ef8aa, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
DB_DEN_ShadowDruid_DenouncingNPCs(S_DEN_ScoutCaptive_f5b5819f-1636-4f2e-82bb-709522cc399f);

IF
FlagSet(DEN_ShadowDruid_Event_StartDenouncingScene_e01769d4-9ac4-17a0-584e-ceb26e4bc384, NULL_00000000-0000-0000-0000-000000000000, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
THEN
PROC_State_Progress(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RitualStopped");

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RitualStopped", _, _)
THEN
SetFlag(DEN_ShadowDruid_State_DenouncingInProgress_3143a5ba-c508-4a32-a2f1-8091731d83e0, NULL_00000000-0000-0000-0000-000000000000);
ClearOwnership(S_DEN_DruidDormitoryDoor_e762551e-ccce-495a-9995-bb7d6b8a592b);
DB_DEN_ShadowDruid_DenouncingOutcomes(1, "LeaderPersuaded");
DB_DEN_ShadowDruid_DenouncingOutcomes(0, "LeaderHostile");
DB_DEN_ShadowDruid_PacifiedDialogs(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_LeaderPersuaded_e66c2f8b-2c9f-35a1-6564-1aa0fc08a020);
DB_DEN_ShadowDruid_DenouncingExtras(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8);
DB_DEN_ShadowDruid_DenouncingExtras(S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd);
DB_DEN_ShadowDruid_DenouncingExtras(S_DEN_ScoutCaptive_f5b5819f-1636-4f2e-82bb-709522cc399f);
DB_DEN_ShadowDruid_DenouncingExtras(S_DEN_ShadowDruid_002_0820c093-f400-4efc-95b9-a6d08a58cac9);
DB_DEN_ShadowDruid_DenouncingExtras(S_DEN_ShadowDruid_003_53b08334-9f79-4bb5-b580-2662355d54ad);
DB_DEN_ShadowDruid_OptionalDruids(S_DEN_ServantGnome_003_0d971a2f-5fd7-4358-8966-147ed8b106dd, DEN_ShadowDruid_State_DenouncingWithLoic_ab24cd39-f8aa-6044-2e4e-c5200b343028);
DB_DEN_ShadowDruid_OptionalDruids(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8, DEN_ShadowDruid_State_DenouncingWithMarcoryl_d2c1d4da-ff77-6e9c-5441-3a3d12f047ba);
DB_DEN_ShadowDruid_OptionalDruids(S_DEN_ScoutCaptive_f5b5819f-1636-4f2e-82bb-709522cc399f, DEN_ShadowDruid_State_DenouncingWithFindal_6f6ff79b-6386-e31d-9fa1-d61bd209f3b0);
DB_DEN_ShadowDruids(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);
DB_DEN_ShadowDruids(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8);
DB_DEN_ShadowDruids(S_DEN_ServantPatrolling_0d971a2f-5fd7-4358-8966-147ed8b106dd);
PROC_DEN_ShadowDruid_SetupSceneManager();
DB_State_Current(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Start");
DB_State_Priority(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Start", 0);
DB_State_Priority(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Moving", 100);
DB_State_Priority(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Confronting", 200);
DB_State_Priority(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "LeaderHostile", 300);
DB_State_Priority(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "LeaderPersuaded", 350);
DB_State_Priority(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Hostile", 400);
DB_State_Priority(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Finished", 500);

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RitualStopped", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_ShadowDruid_Originals(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetCanFight(_Var1, 1);
SetCanJoinCombat(_Var1, 1);

PROC
PROC_DEN_ShadowDruid_SetupSceneManager()
AND
DB_DEN_ShadowDruid_DenouncingNPCs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SceneManager(_Var1, "DEN_Denouncing");

IF
DialogEnded(DEN_ShadowDruid_Leader_44569c62-70e8-28bc-7cec-fdf051daa339, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetFlag(DEN_ShadowDruid_Event_StartDenouncingScene_e01769d4-9ac4-17a0-584e-ceb26e4bc384, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
AND
DB_State_Current(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Start", _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
PROC_State_Progress(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Moving");
PROC_DEN_ShadowDruid_DenouncingStarts(_Var2);

PROC
PROC_DEN_ShadowDruid_DenouncingStarts((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_StartDialogCustom(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_ShadowDruid_001_0cb92c37-fb4d-4547-8702-1fb1dd52d0b6, _Var1, 0, 0, 1, 1, _Var1)
THEN
PROC_DEN_ShadowDruid_DenouncingAutoStartFailed();

PROC
PROC_StartDialog_AddExtraSpeakers(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DEN_ShadowDruid_DenouncingExtras(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, S_DEN_DruidLair_SUB_a9794f19-187a-4d79-b739-443548411d29, 1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var2);
SetFlag(DEN_ShadowDruid_State_IsDenouncing_a9fb84af-744d-4f4f-b0bc-a3fc93ae8abb, _Var2);
PROC_DialogAddSpeakingActor(_Var1, _Var2);

IF
DialogStarted(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
SetFlag(DEN_ShadowDruid_State_DenouncingSceneInProgress_a9e1b188-80a7-4432-86b2-129c7623cb16, NULL_00000000-0000-0000-0000-000000000000);

IF
DialogStarted(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND
IsTagged(_Var2, DRUID_44ac4317-4d38-4d28-80e2-94024c6e42f0, 1, _Var1, _Var1)
THEN
DB_DEN_ShadowDruid_DruidDenouncer(_Var2);

IF
DialogActorJoined(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, (INTEGER)_Var1, (GUIDSTRING)_Var2, _, (INTEGER)_Var1)
AND
DB_DEN_ShadowDruid_OptionalDruids(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
SetFlag(_Var4, NULL_00000000-0000-0000-0000-000000000000);

IF
DialogStarted(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_State_Progress(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Confronting");

PROC
PROC_DEN_ShadowDruid_DenouncingAutoStartFailed()
THEN
PROC_DEN_ShadowDruid_DenouncingDialogEnded();

QRY
QRY_SelectCustomDialog((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_SceneManager(_Var1, "DEN_Denouncing", _Var1, _Var1, _Var1)
AND
DB_State_Current(_, "DEN_Denouncing", "Moving", _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, S_DEN_ShadowDruid_001_0cb92c37-fb4d-4547-8702-1fb1dd52d0b6, _Var2);
PROC_State_Progress(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Confronting");

IF
FlagSet(DEN_ShadowDruid_Event_KaghaTurnedGood_f2de839d-b971-86ee-f02c-5e09174ce919, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
NOT DB_DEN_ShadowDruids(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156);
NOT DB_DEN_ShadowDruids(S_DEN_ServantIntolerant_002_6f36c7a1-edfd-4e99-bd90-6d874f68c9b8);
NOT DB_DEN_ShadowDruids(S_DEN_ServantPatrolling_0d971a2f-5fd7-4358-8966-147ed8b106dd);
PROC_State_Progress(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "LeaderPersuaded");

IF
DialogEnded(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_DEN_ShadowDruid_DenouncingDialogEnded();

PROC
PROC_DEN_ShadowDruid_DenouncingDialogEnded()
AND
GetFlag(DEN_ShadowDruid_Event_KaghaTurnedGood_f2de839d-b971-86ee-f02c-5e09174ce919, NULL_00000000-0000-0000-0000-000000000000, _Var1, _Var1, _Var1)
AND
DB_DEN_ShadowDruid_DenouncingOutcomes(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetFlag(DEN_GroveConflict_State_DruidsPacified_0f747b55-d68d-436f-ac33-9fecaf30387d, NULL_00000000-0000-0000-0000-000000000000);
PROC_State_Progress(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", _Var2);
PROC_DEN_ShadowDruid_DenouncingPrepCombat();
PROC_DEN_GroveConflict_SDCombat_JournalHook(_Var1);

PROC
PROC_DEN_ShadowDruid_DenouncingPrepCombat()
AND
DB_DEN_ShadowDruids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "DEN_ShadowDruid_DenouncingDefeatCounter");

PROC
PROC_DEN_ShadowDruid_DenouncingPrepCombat()
THEN
SetTag(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, AI_UNPREFERRED_TARGET_9787450d-f34d-43bd-be88-d2bac00bb8ee);
SetTag(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, AI_UNPREFERRED_TARGET_9787450d-f34d-43bd-be88-d2bac00bb8ee);

PROC
PROC_DEN_ShadowDruid_DenouncingPrepCombat()
AND
DB_DEN_ShadowDruid_DenouncingNPCs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_ShadowDruids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFaction(_Var1, ACT1_DEN_ShadowDruid_PlayerAlly_7af438aa-13a7-4ef0-ab77-f6f9e8abaf66);

IF
DialogEnded(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, _, _, _, _)
AND
DB_DEN_ShadowDruids(_Var2, _, _, _, _)
AND NOT
DB_PermaDefeated(_Var2, _, _, _, _)
THEN
SetFaction(_Var2, ACT1_DEN_ShadowDruid_Hostile_89b57c7d-8a44-49bf-8def-1c42f5513b5a);

IF
DialogEnded(DEN_ShadowDruid_Denouncing_0e60d16a-0cdb-0704-e703-7943f3356443, _, _, _, _)
AND
DB_DEN_ShadowDruid_PacifiedDialogs(_Var2, _Var3, _, _, _)
AND NOT
DB_Defeated(_Var2, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Var2);
DB_Dialogs(_Var2, _Var3);

PROC
PROC_State_Changed(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "LeaderPersuaded", _, _)
THEN
PROC_DEN_ShadowDruid_KaghaTurnedGood_JournalHook();

PROC
PROC_DEN_ShadowDruid_KaghaTurnedGood_JournalHook()
THEN
DB_NOOP(1);

IF
AutomatedDialogStarted(DEN_ShadowDruid_AD_KaghaInCombat_45107382-8f6f-39e6-288c-aa7668ca83f2, _, _, _, _)
AND
DB_DEN_ShadowDruid_KaghaCombatADCount(_Var2, _, _, _, _)
AND
_Var2 < 3
AND
IntegerSum(_Var2, 1, _Var3, _, _)
THEN
NOT DB_DEN_ShadowDruid_KaghaCombatADCount(_Var2);
DB_DEN_ShadowDruid_KaghaCombatADCount(_Var3);
DB_CombatReact_AD_OnNextTurn(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_AD_KaghaInCombat_45107382-8f6f-39e6-288c-aa7668ca83f2);

PROC
PROC_State_Changed(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "LeaderHostile", _, _)
THEN
DB_CombatReact_AD_OnNextTurn(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_AD_KaghaInCombat_45107382-8f6f-39e6-288c-aa7668ca83f2);
DB_DEN_ShadowDruid_SetKaghaKilled(1);

IF
DB_PermaDefeated(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _, _, _, _)
AND
DB_DEN_ShadowDruid_SetKaghaKilled(1, _, _, _, _)
THEN
SetFlag(DEN_ShadowDruid_State_KaghaKilled_fbf50ed0-6ebb-4306-bc5a-0a94e0a1c593, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_ShadowDruid_DenouncingDefeatCounter", _, _, _, _)
THEN
ClearFlag(DEN_ShadowDruid_State_DenouncingSceneInProgress_a9e1b188-80a7-4432-86b2-129c7623cb16, NULL_00000000-0000-0000-0000-000000000000);
ClearTag(S_DEN_PetWolf_63471e30-7413-4496-97de-0bdf67c2f753, AI_UNPREFERRED_TARGET_9787450d-f34d-43bd-be88-d2bac00bb8ee);
ClearTag(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, AI_UNPREFERRED_TARGET_9787450d-f34d-43bd-be88-d2bac00bb8ee);
PROC_DEN_ShadowDruid_FightEnded_JournalHook();
PROC_State_Progress(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, "DEN_Denouncing", "Finished");
PROC_SceneOver("DEN_Denouncing");
PROC_DEN_ShadowDruid_InitDruidReward();

PROC
PROC_GLO_DefeatCounter_AllDefeated("DEN_ShadowDruid_DenouncingDefeatCounter", _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_Event_Start_c641da6a-b3f5-4873-bd34-c53768d30d6f, _, _, _, _)
AND
DB_DEN_ShadowDruid_DenouncingNPCs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_ShadowDruids(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFaction(_Var1, ACT1_DEN_Apprentice_4565e710-476b-6f86-1f7b-0ca50a6045c7);

PROC
PROC_DEN_ShadowDruid_FightEnded_JournalHook()
THEN
DB_NOOP(1);

PROC
PROC_DEN_ShadowDruid_InitDruidReward()
AND
DB_DEN_ShadowDruid_DruidDenouncer(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ObjectTimerLaunch(_Var1, "DEN_ShadowDruid_DruidReward", 4000);

PROC
PROC_DEN_ShadowDruid_InitDruidReward()
THEN
DB_DEN_ShadowDruid_FaithwardenRewarder(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_LeaderPersuaded_e66c2f8b-2c9f-35a1-6564-1aa0fc08a020);

IF
DB_DEN_ShadowDruid_FaithwardenRewarder(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_LeaderPersuaded_e66c2f8b-2c9f-35a1-6564-1aa0fc08a020, _, _, _)
AND
DB_Defeated(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, _, _, _, _)
THEN
NOT DB_DEN_ShadowDruid_FaithwardenRewarder(S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156, DEN_ShadowDruid_LeaderPersuaded_e66c2f8b-2c9f-35a1-6564-1aa0fc08a020);
DB_DEN_ShadowDruid_FaithwardenRewarder(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, DEN_ShadowDruid_OpposedFaithwarden_2838438c-f376-40cf-fc64-8b3dcb64c4a6);

IF
DB_DEN_ShadowDruid_FaithwardenRewarder(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, DEN_ShadowDruid_OpposedFaithwarden_2838438c-f376-40cf-fc64-8b3dcb64c4a6, _, _, _)
AND
DB_Defeated(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, _, _, _, _)
THEN
PROC_DEN_ShadowDruid_FaithwardenRewardCleanup();

IF
ObjectTimerFinished((CHARACTER)_Var1, "DEN_ShadowDruid_DruidReward", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
TriggerRegisterForCharacter(S_DEN_DruidFaithwardenSphere_e278fa41-52e8-4625-b8f4-d99f234f524d, _Var1);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_DruidFaithwardenSphere_e278fa41-52e8-4625-b8f4-d99f234f524d, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_ShadowDruid_DruidDenouncer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_ShadowDruid_FaithwardenRewarder(_, _, _Var1, _Var1, _Var1)
AND
QRY_DEN_ShadowDruid_TryGiveReward(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_DEN_ShadowDruid_TryGiveReward((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_WildShaped(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_ShadowDruid_FaithwardenRewarder(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveToAndTalk(_Var2, _Var1, _Var3, "DEN_ShadowDruid_FaithwardenReward", "Stroll", 8, 0, 0);

QRY
QRY_SelectCustomDialog(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_ShadowDruid_FaithwardenRewarder(S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, _Var2, _Var1, _Var1, _Var1)
AND
IsTagged(_Var1, DRUID_44ac4317-4d38-4d28-80e2-94024c6e42f0, 1, _Var1, _Var1)
THEN
DB_SelectedDialog(_Var2, S_DEN_DruidOpposed_322cf8d2-32ee-453f-987e-f12b32652b5d, _Var1);

PROC
PROC_DialogFlagSetup((DIALOGRESOURCE)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DEN_ShadowDruid_FaithwardenRewarder(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsTagged(_Var3, DRUID_44ac4317-4d38-4d28-80e2-94024c6e42f0, 1, _Var1, _Var1)
THEN
SetFlag(DEN_ShadowDruid_Event_DeservesFaithwardenReward_280547cc-008c-4f3e-885b-e160946f2f14, _Var3);

IF
FlagSet(DEN_ShadowDruid_Event_SetFaithwarden_d8451137-e2a7-247a-1bc2-758ad990255f, NULL_00000000-0000-0000-0000-000000000000, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
SetOnStage(S_DEN_FaithwardenStaff_5de75000-9141-466b-9019-70df488b2958, 1);
ToInventory(S_DEN_FaithwardenStaff_5de75000-9141-466b-9019-70df488b2958, _Var2, 1, 1, 1);
SetTag(_Var2, ACT1_DEN_FAITHWARDEN_cd873546-4158-4d9a-9c87-958ea63a1b08);
PROC_DEN_ShadowDruid_FaithwardenRewardCleanup();

PROC
PROC_State_Changed(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_RitualStopped", _, (STRING)_)
THEN
PROC_DEN_ShadowDruid_FaithwardenRewardCleanup();

PROC
PROC_DEN_ShadowDruid_FaithwardenRewardCleanup()
AND
DB_DEN_ShadowDruid_DruidDenouncer(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_ShadowDruid_DruidDenouncer(_Var1);
TriggerUnregisterForCharacter(S_DEN_DruidFaithwardenSphere_e278fa41-52e8-4625-b8f4-d99f234f524d, _Var1);

PROC
PROC_DEN_ShadowDruid_FaithwardenRewardCleanup()
AND
DB_DEN_ShadowDruid_FaithwardenRewarder(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_ShadowDruid_FaithwardenRewarder(_Var1, _Var2);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
