Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_LOW_DisguisedRedcaps(S_LOW_BlushingMermaid_DisguisedRedcap_01_efa9ccb1-4ba2-4467-82ef-b8ed63b867a4, "LOW_REDCAP_PATRON_01");
DB_LOW_DisguisedRedcaps(S_LOW_BlushingMermaid_DisguisedRedcap_02_ba363354-3341-41e9-ae92-c3fe8a07a9ea, "LOW_REDCAP_PATRON_02");
DB_LOW_DisguisedRedcaps(S_LOW_BlushingMermaid_DisguisedRedcap_03_76784911-9f0d-48f6-8e0d-b609345b2be2, "LOW_REDCAP_PATRON_03");
DB_LOW_DisguisedRedcaps(S_LOW_BlushingMermaid_DisguisedRedcap_04_9f218fa2-418d-46ee-b38d-1708f25314ec, "LOW_REDCAP_PATRON_04");
DB_LOW_DisguisedRedcaps(S_LOW_BlushingMermaid_DisguisedRedcap_05_357299a8-b8c2-4b99-92f8-761fd697c435, "LOW_REDCAP_PATRON_05");
DB_LOW_DisguisedRedcaps(S_LOW_BlushingMermaid_DisguisedRedcap_06_8a9a0273-3a3b-47ee-b362-5b83903458fb, "LOW_REDCAP_PATRON_06");
DB_SceneManager(S_LOW_BlushingMermaid_DisguisedRedcap_01_efa9ccb1-4ba2-4467-82ef-b8ed63b867a4, "LOW_DisguisedHag_Scene");
DB_SceneManager(S_LOW_BlushingMermaid_DisguisedRedcap_02_ba363354-3341-41e9-ae92-c3fe8a07a9ea, "LOW_DisguisedHag_Scene");
DB_SceneManager(S_LOW_BlushingMermaid_DisguisedRedcap_03_76784911-9f0d-48f6-8e0d-b609345b2be2, "LOW_DisguisedHag_Scene");
DB_SceneManager(S_LOW_BlushingMermaid_DisguisedRedcap_04_9f218fa2-418d-46ee-b38d-1708f25314ec, "LOW_DisguisedHag_Scene");
DB_SceneManager(S_LOW_BlushingMermaid_DisguisedRedcap_05_357299a8-b8c2-4b99-92f8-761fd697c435, "LOW_DisguisedHag_Scene");
DB_SceneManager(S_LOW_BlushingMermaid_DisguisedRedcap_06_8a9a0273-3a3b-47ee-b362-5b83903458fb, "LOW_DisguisedHag_Scene");
DB_Dialogs(S_LOW_BlushingMermaid_DisguisedRedcap_01_efa9ccb1-4ba2-4467-82ef-b8ed63b867a4, LOW_BlushingMermaid_DisguisedRedcap_01_eb2cc339-73ba-8f0b-25f1-081db231c01a);
DB_Dialogs(S_LOW_BlushingMermaid_DisguisedRedcap_02_ba363354-3341-41e9-ae92-c3fe8a07a9ea, LOW_BlushingMermaid_DisguisedRedcap_02_7f9acb47-ad4f-1874-ed10-5d87242a7e26);
DB_Dialogs(S_LOW_BlushingMermaid_DisguisedRedcap_03_76784911-9f0d-48f6-8e0d-b609345b2be2, LOW_BlushingMermaid_DisguisedRedcap_03_07df203a-69ef-f333-8898-8ca88a6534ed);
DB_Dialogs(S_LOW_BlushingMermaid_DisguisedRedcap_04_9f218fa2-418d-46ee-b38d-1708f25314ec, LOW_BlushingMermaid_DisguisedRedcap_04_2cade439-faa3-fb56-b9d9-ae2fb27ae390);
DB_Dialogs(S_LOW_BlushingMermaid_DisguisedRedcap_05_357299a8-b8c2-4b99-92f8-761fd697c435, LOW_BlushingMermaid_DisguisedRedcap_05_2bd6b6b2-0e7b-229f-0d46-1019e5517c74);
DB_Dialogs(S_LOW_BlushingMermaid_DisguisedRedcap_06_8a9a0273-3a3b-47ee-b362-5b83903458fb, LOW_BlushingMermaid_DisguisedRedcap_06_c7e01376-59c8-d273-80d3-b6c88d0eed19);
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_DisguisedRedcap_01_efa9ccb1-4ba2-4467-82ef-b8ed63b867a4, "LOW_BlushingMermaid_RedcapsPermaDefeated");
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_DisguisedRedcap_02_ba363354-3341-41e9-ae92-c3fe8a07a9ea, "LOW_BlushingMermaid_RedcapsPermaDefeated");
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_DisguisedRedcap_03_76784911-9f0d-48f6-8e0d-b609345b2be2, "LOW_BlushingMermaid_RedcapsPermaDefeated");
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_DisguisedRedcap_04_9f218fa2-418d-46ee-b38d-1708f25314ec, "LOW_BlushingMermaid_RedcapsPermaDefeated");
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_DisguisedRedcap_05_357299a8-b8c2-4b99-92f8-761fd697c435, "LOW_BlushingMermaid_RedcapsPermaDefeated");
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_DisguisedRedcap_06_8a9a0273-3a3b-47ee-b362-5b83903458fb, "LOW_BlushingMermaid_RedcapsPermaDefeated");
DB_Dialogs(S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9, LOW_BlushingMermaid_BosunGannet_eb3db70d-cef4-fd66-688a-48b1bfd66fe0);
DB_LOW_Ethel(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_DoNotRemoveKnockedOutCharacterOnLongRest(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_DontRemoveDialogsOnKnockedOut(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_IgnoreMutingStatussesDialog(LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3);
DB_SpotPlayers(S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9, "LOW_BosunGannetAD_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_LOW_GoldRewardForKillingLora(3000);
DB_LOW_HagDialogsWithGold(LOW_BlushingMermaid_DisguisedHag_1632da0a-d0d7-4905-1c99-75c88102f102);
DB_LOW_HagDialogsWithGold(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307);
DB_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_Event_HagTransformsInDialog_5fa54251-1a34-4218-aa5b-f0ca9cda9c82, LOW_BlushingMermaid_DisguisedHag_1632da0a-d0d7-4905-1c99-75c88102f102);
DB_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_State_PlayerBrokeDealWithHag_1e69b66d-9f46-4df5-aeb4-56382f8b1001, LOW_BlushingMermaid_Hag_AfterDeal_7bcded43-4347-a00a-f2e7-63ca14eefc9f);
DB_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_State_HagCutOpen_d1772eba-c22b-4235-a492-eb39e0926237, LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3);
DB_DropMutingStatussesDialog(LOW_BlushingMermaid_PreCellarCombat_Hag_3bd2c6d8-5638-4518-5c23-b057f70c0ede);
DB_DropMutingStatussesDialog(LOW_BlushingMermaid_HagVomitsOutDeadVanra_e3067621-8c76-c65e-8026-5dfaecc9d1de);
DB_DropMutingStatussesDialog(LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3);
DB_LOW_Quenora(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
DB_PermaDefeatedEvent(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, LOW_BlushingMermaid_State_QuenoraGrizly_PermaDefeated_b6e14bf7-b6c5-4151-91b6-69669cf6f764);
DB_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_Event_VanraWentToMom_895cda4f-6348-45c0-ba2e-bac1a7a1a0b2, LOW_BlushingMermaid_VanraSaved_63754baa-d2dd-93fe-697c-dc9106b22291);
DB_DeadEvent(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, LOW_BlushingMermaid_State_VanraIsDead_085595a2-d5d8-4379-ba50-5d92dbbbaa17);
DB_LOW_VanraSavedDialogs(LOW_BlushingMermaid_VomitsOutVanra_Hag_10f3400d-85f0-d324-5057-c0b6bdc6366c);
DB_LOW_VanraSavedDialogs(LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_01_4e7b519f-3e47-45d7-b2d1-20001a522bfe, S_LOW_BlushingMermaid_Patron_09_da46cc19-8972-478a-b063-7f7a5f61ae93, LOW_BlushingMermaid_Patron_01_Patron_09_Debate_e08d01be-f122-db6e-dccf-5e4cb59267f3);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_12_b5c8b44e-c660-4a97-bbaf-8a0853a4c6c8, S_LOW_BlushingMermaid_Patron_13_0cd108a4-a496-4e90-8ee7-d09fe6bc0e47, LOW_BlushingMermaid_Patron_12_Patron_13_Group_4f4d26ad-f1a2-692c-ecbd-bd93a093d9ac);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_02_01f6482f-3afc-496e-9d9a-cb078a2dd5b1, LOW_BlushingMermaid_Patron_02_f4f8d77e-3dbc-ec3c-bb1c-0ca4ee1773e4);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_03_6bb7045e-7cdf-4188-a9d8-6b16abd25028, LOW_BlushingMermaid_Patron_03_bcc767f7-7c30-534e-ef51-422b61eb38cc);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_04_8fec6485-b7c3-4b04-9c9c-6f94abaa4830, LOW_BlushingMermaid_Patron_04_12d41bce-decf-657a-6dc8-162b66c31bbe);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_05_6c50ccb1-1215-4e98-8dc1-70d42478e2fc, LOW_BlushingMermaid_Patron_05_4601e0f1-29e5-a75f-e419-4ead84a94387);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_06_33f7f264-5494-457b-b2f1-62ad6360db77, LOW_BlushingMermaid_Patron_06_5c686f60-babf-3eab-9020-166fb0f348a2);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_07_34aad024-a7cc-4e75-b7c8-548e14c49909, LOW_BlushingMermaid_Patron_07_2052fd73-05af-7c5c-9a37-de26898a5c8c);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_08_40dcda0b-7891-414f-8aeb-f742d842207d, LOW_BlushingMermaid_Patron_08_f3833dae-d3d3-7500-213e-933f03f28185);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_10_2a1b36c5-ff2f-4228-ba2f-2d776d5cd66e, LOW_BlushingMermaid_Patron_10_0c56c11a-deab-4e96-363c-067ab0fed7d8);
DB_Dialogs(S_LOW_BlushingMermaid_Patron_11_b1f21c2d-1553-4a7b-86b5-ee31706e6c3e, LOW_BlushingMermaid_Patron_11_15814a2e-e3c2-e7e3-62bb-83f61cd68f16);
DB_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_State_Patron_12_Left_27009b2b-39b4-4e4a-bdd8-fa518d6cfef7, LOW_BlushingMermaid_Patron_12_Patron_13_Group_4f4d26ad-f1a2-692c-ecbd-bd93a093d9ac);
DB_Dialogs(S_LOW_BlushingMermaid_MaskedVictim_01_453e3292-b7ff-4a13-873a-82da3bfc2511, LOW_BlushingMermaid_MaskedVictim_01_9a99bb91-ca54-d441-cd99-fcada33d9bfb);
DB_Dialogs(S_LOW_BlushingMermaid_MaskedVictim_02_518fab8f-2d1d-46c8-9a45-9045156d0053, LOW_BlushingMermaid_MaskedVictim_02_f5b6d56d-530a-7f76-f2ac-f2eb284d5e5c);
DB_Dialogs(S_LOW_BlushingMermaid_MaskedVictim_03_0406349d-d0fc-4bf5-8d18-5b8b8c9e6456, LOW_BlushingMermaid_MaskedVictim_03_b2b282f4-8480-28db-f150-b04601d5241d);
DB_HAG_MaskedVictims(S_LOW_BlushingMermaid_MaskedVictim_01_453e3292-b7ff-4a13-873a-82da3bfc2511, S_BlushingMermaid_MaskedVictim_01_SummonPoint_8ad3574e-b460-4b6f-9fd8-88bf156a0647, 100, LOW_BlushingMermaid_AD_MaskedVictim_01_Resist_c9e4e0d9-753e-ed79-f2b8-b0deb6678166);
DB_HAG_MaskedVictims(S_LOW_BlushingMermaid_MaskedVictim_02_518fab8f-2d1d-46c8-9a45-9045156d0053, S_BlushingMermaid_MaskedVictim_02_SummonPoint_bb42763f-1ad9-4188-837c-332bb6e179d3, 300, LOW_BlushingMermaid_AD_MaskedVictim_02_Resist_81751a2f-c222-e5ff-4dd8-0dd6616f31f7);
DB_HAG_MaskedVictims(S_LOW_BlushingMermaid_MaskedVictim_03_0406349d-d0fc-4bf5-8d18-5b8b8c9e6456, S_BlushingMermaid_MaskedVictim_03_SummonPoint_92a75e09-5204-4b65-9e2a-cee57709043b, 600, LOW_BlushingMermaid_AD_MaskedVictim_03_Resist_a551c32c-da72-a67d-09ed-41ab75196486);
DB_LOW_MaskedVictims_HagMask(S_LOW_BlushingMermaid_MaskedVictim_01_453e3292-b7ff-4a13-873a-82da3bfc2511, S_LOW_BlushingMermaid_HagMask_01_4c1dfe00-dda3-4c8d-bf27-3104373591c5, BOOK_LOW_AuntieEthelsRevenge_NoteMaskedVictim01_6c034de3-de99-46ee-b138-e0b8f47cb923);
DB_LOW_MaskedVictims_HagMask(S_LOW_BlushingMermaid_MaskedVictim_02_518fab8f-2d1d-46c8-9a45-9045156d0053, S_LOW_BlushingMermaid_HagMask_02_88327f51-cc84-4086-987a-c98a3fd2a3f9, BOOK_LOW_AuntieEthelsRevenge_NoteMaskedVictim02_73df7add-f652-4d0e-8d75-6829e7471bde);
DB_LOW_MaskedVictims_HagMask(S_LOW_BlushingMermaid_MaskedVictim_03_0406349d-d0fc-4bf5-8d18-5b8b8c9e6456, S_LOW_BlushingMermaid_HagMask_03_d7ec6309-7b22-4d01-8226-d76100d00906, BOOK_LOW_AuntieEthelsRevenge_NoteMaskedVictim03_f0c080dd-e103-4cb6-9dc1-47c41abadc80);
DB_LOW_MaskedVictims_HagMask(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, S_LOW_BlushingMermaid_QuenorasHagMask_6eb1036e-017e-4cc2-8f65-1cc0cda601ad, BOOK_LOW_AuntieEthelsRevenge_NoteMaskedCaptain_3574bf1f-3843-464e-8149-546b83189a4b);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_HagMask_01_4c1dfe00-dda3-4c8d-bf27-3104373591c5, S_LOW_BlushingMermaid_HagMask_Helper_01_862d8a74-6489-4df2-9541-708137bb2a34);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_HagMask_02_88327f51-cc84-4086-987a-c98a3fd2a3f9, S_LOW_BlushingMermaid_HagMask_Helper_02_976845a2-e54d-4f8f-a66b-cb6680029c97);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_HagMask_03_d7ec6309-7b22-4d01-8226-d76100d00906, S_LOW_BlushingMermaid_HagMask_Helper_03_e198c083-7c20-4737-b359-a042f7de7fc5);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_QuenorasHagMask_6eb1036e-017e-4cc2-8f65-1cc0cda601ad, S_LOW_BlushingMermaid_QuenorasHagMask_Helper_4269d779-ceb8-4230-a36d-29282ae4b47f);
DB_CombatReact_AD_OnEntered(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, LOW_BlushingMermaid_AD_MaskedVictims_Attack_73159625-84fb-de53-ba67-e5af69c5c9dc);
DB_Inclusion_Object(S_LOW_BlushingMermaid_MaskedVictim_01_453e3292-b7ff-4a13-873a-82da3bfc2511, LOW_BlushingMermaid_MaskedVictim_01_StartInclusion_dee67ea6-5ae3-4b41-80ba-9d8c42894b9b, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_Object(S_LOW_BlushingMermaid_MaskedVictim_02_518fab8f-2d1d-46c8-9a45-9045156d0053, LOW_BlushingMermaid_MaskedVictim_02_StartInclusion_ae5fed06-bde9-4fce-881d-a243933e0645, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_NPCDialog(LOW_BlushingMermaid_AD_MaskedVictims_Attack_73159625-84fb-de53-ba67-e5af69c5c9dc, S_LOW_BlushingMermaid_MaskedVictim_01_453e3292-b7ff-4a13-873a-82da3bfc2511);
DB_Inclusion_NPCDialog(LOW_BlushingMermaid_AD_MaskedVictims_Attack_73159625-84fb-de53-ba67-e5af69c5c9dc, S_LOW_BlushingMermaid_MaskedVictim_02_518fab8f-2d1d-46c8-9a45-9045156d0053);
DB_Inclusion_CombatInclusionDialog(LOW_BlushingMermaid_AD_MaskedVictims_Attack_73159625-84fb-de53-ba67-e5af69c5c9dc);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_HagMask_04_d6256093-4f74-4236-b4b0-be3753f7e7da, S_LOW_BlushingMermaid_HagMask_Helper_04_4cae6d53-5b4e-42ec-ae5b-a70fe55dd64f);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_HagMask_05_ec401ec6-6488-4799-b7d1-08008b1131fe, S_LOW_BlushingMermaid_HagMask_Helper_05_9c90d121-c084-489b-8f90-aef85db5a14e);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_HagMask_06_2b0adc7a-a45e-4713-a10f-d240dc8926ba, S_LOW_BlushingMermaid_HagMask_Helper_06_a58dd7a0-7c9d-440b-a3d5-b960df5b3492);
DB_HAG_Hagmasks(S_LOW_BlushingMermaid_HagMask_07_c4784b6e-8dbf-42c8-a7d8-c1bf756cab2c, S_LOW_BlushingMermaid_HagMask_Helper_07_54920138-c18a-4a72-b24e-4487cbdd9cc2);
PROC_TriggerRegisterForParty(S_LOW_BlushingMermaid_Pub_Trigger_dc4d50f8-5bee-4117-9722-ac02e7ab113f);
PROC_TriggerRegisterForParty(S_LOW_BlushingMermaid_CellarTrigger_2c889517-8252-49f0-a55c-ead662b8cb3f);
PROC_TriggerRegisterForParty(S_LOW_BlushingMermaid_VanraDialogTrigger_56469603-08e9-45cd-8412-da70896834e3);
TriggerRegisterForCharacter(S_LOW_BlushingMermaid_Pub_Trigger_dc4d50f8-5bee-4117-9722-ac02e7ab113f, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
TriggerRegisterForCharacter(S_LOW_BlushingMermaid_CellarTrigger_2c889517-8252-49f0-a55c-ead662b8cb3f, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_LOW_HagVomitTriggers(S_LOW_BlushingMermaid_Pub_Trigger_dc4d50f8-5bee-4117-9722-ac02e7ab113f);
DB_LOW_HagVomitTriggers(S_LOW_BlushingMermaid_CellarTrigger_2c889517-8252-49f0-a55c-ead662b8cb3f);
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_HagRegenShroom_01_cd00e76d-ed4b-494f-a42e-877cb79cf4f2, "LOW_HagResurrectionShrooms_PermaDefeated");
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_HagRegenShroom_02_dde4a500-970e-4866-ac0b-bbd07d61dfe2, "LOW_HagResurrectionShrooms_PermaDefeated");
DB_GLO_DefeatCounter(S_LOW_BlushingMermaid_HagRegenShroom_03_9005b647-c8c6-43b5-ab76-ac9f5636b30a, "LOW_HagResurrectionShrooms_PermaDefeated");
DB_GLO_DefeatCounter_AllDefeatedGlobalFlag("LOW_HagResurrectionShrooms_PermaDefeated", LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33);
DB_GLO_DefeatCounter_IgnoreWaitForCombatEnd("LOW_HagResurrectionShrooms_PermaDefeated");
DB_LOW_DefeatedShroomsToResurrectionHP(0, 100);
DB_LOW_DefeatedShroomsToResurrectionHP(1, 80);
DB_LOW_DefeatedShroomsToResurrectionHP(2, 60);
DB_LOW_DefeatedShroomsToCombatPhase(1, LOW_BlushingMermaid_State_HagCombatPhase_2_b9def2bd-bb1a-49e3-96af-958e853293c5);
DB_LOW_DefeatedShroomsToCombatPhase(2, LOW_BlushingMermaid_State_HagCombatPhase_3_a5e3f2dd-5294-4776-826b-60c029cb7590);
DB_LOW_DefeatedShroomsToCombatPhase(3, LOW_BlushingMermaid_State_HagCombatPhase_4_593877d7-9b40-4485-a171-0e316c6a7ea1);
DB_LOW_ShroomSupportSpells("LOW_HAG_RESURRECTING", "Target_LOW_HagShroom_Resurrect");
DB_LOW_ShroomSupportSpells("LOW_HAG_AWAKENING", "Target_LOW_HagShroom_Awaken");
DB_LOW_HagDialogsPreventingReteatWhenShroomDefeated(LOW_BlushingMermaid_HagVomitsOutDeadVanra_e3067621-8c76-c65e-8026-5dfaecc9d1de);
DB_LOW_HagDialogsPreventingReteatWhenShroomDefeated(LOW_BlushingMermaid_VomitsOutVanra_Hag_10f3400d-85f0-d324-5057-c0b6bdc6366c);
DB_LOW_HagDialogsPreventingReteatWhenShroomDefeated(LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_001_0c9b0cab-b061-4210-b8ea-53e99dfc7733);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_002_323e77e7-9f2e-44b7-b665-75aeeb8bbb80);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_003_e061d56e-c38c-4bf4-b774-57e18f0b0fd3);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_004_466e8124-43d6-4c68-8e01-563ca87b7ebd);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_005_0eaa5e37-4a37-4368-a236-e54b4326f74e);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_006_4fc852d9-8d67-426f-99f0-25bc7002fbe4);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_007_ca54dcdb-7f96-497f-a01b-0c6f7430470c);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_008_d861dd3a-a880-480c-ac0a-26dbb0282ef3);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_009_969f307b-4e65-4441-b704-327e9acfc862);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_010_38120058-8c82-4132-85f7-8132b892204e);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_011_82333eef-288f-4863-8431-4e0fa254d4c4);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_012_696772c0-544c-4a19-893d-33a88c3d2425);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_013_6030f9dc-1b71-49fd-b57f-1238f72e1128);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_014_ce06635c-c5dd-4c4a-8ad4-f914e904aa47);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_015_14bc1f7c-c611-419c-ae8b-ae878e1fe903);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_016_e68d735c-ce0c-4989-b704-599b6bc0e68e);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_017_e838e5f7-8aa7-4763-b29c-dd318a60e683);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_018_bf0822d2-3024-4f12-92f2-34aa003de412);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_019_ea575095-19ae-45db-8c48-42f186e3bcec);
DB_LOW_HagDoublesSpawnPoints(S_LOW_BlushingMermaid_DoublesSpawnPoint_020_587022c0-8870-457a-aa51-3f8384a7c1ce);
DB_OneShot_VoiceBarkTrigger(S_LOW_BlushingMermaid_HaggyCellarVB_Trigger_10db15eb-cad9-4a6c-8e60-5dfaa95c25f4, LOW_BlushingMermaid_VB_HaggyCellar_270d9d64-8ecd-3075-3d6f-5d39930df108);
DB_PartyProgress_Trigger(S_LOW_BlushingMermaid_HaggyCellar_Trigger_47b776be-f7c3-4104-b1e4-7ff53c8eea0a, LOW_BlushingMermaid_State_EnteredHagCellar_NoHagReveal_42a4b333-0d02-4397-b232-9d35aa1ccccd);
DB_LOW_BlushingMermaidBasementEntranceIllusuion(S_LOW_BlushingMermaid_BasementEntraceIllusion_543ad91c-25c7-4036-b117-8822e89f54f2);
DB_QuestDef_State(LOW_BasiliskGate_State_KnowsVanraIsMissing_8c800e14-8dba-4685-a95e-81a719da60eb, "LOW_SaveHaggedChild", "TalkedWithLora");
DB_QuestDef_State(LOW_HagSurvivors_State_FindMissingKidMotherAccepted_5c647e06-a54a-1211-577a-441d07b267d4, "LOW_SaveHaggedChild", "MayrinaAskedToFindLora");
DB_QuestDef_State(LOW_BlushingMermaid_State_BosunToldAboutCaptain_4ec7115d-93d3-40df-a87c-5683f647a49e, "LOW_SaveHaggedChild", "TalkedWithBosun");
DB_QuestDef_State(LOW_BlushingMermaid_State_TookTimeKillLoraOffer_5e674785-2178-4b53-94b6-a09e4dfe32ca, "LOW_SaveHaggedChild", "TalkedHag_NoLoraKillDecision");
DB_QuestDef_State(LOW_BlushingMermaid_State_PlayersReadHagInformantsNote_23cc4563-f336-4f9e-a83c-35fe8b8f8308, "LOW_SaveHaggedChild", "ReadHagsInformantNote");
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_EnteredHagCellar_NoHagReveal_42a4b333-0d02-4397-b232-9d35aa1ccccd, "LOW_SaveHaggedChild", "EnteredHagBasement", 0, LOW_BlushingMermaid_State_MayrinaToldHagStoleKid_147e85e3-6a90-4a98-b721-ca726bd98c61);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_EnteredHagCellar_NoHagReveal_42a4b333-0d02-4397-b232-9d35aa1ccccd, "LOW_SaveHaggedChild", "EnteredHagBasement_CuredMayrina", 1, LOW_BlushingMermaid_State_MayrinaToldHagStoleKid_147e85e3-6a90-4a98-b721-ca726bd98c61);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_AgreedToBringHeadToHag_c0a98ec4-171f-46c1-9a67-80140da3703e, "LOW_SaveHaggedChild", "AcceptedKillLora_FirstOffer", 0, LOW_BlushingMermaid_State_TookTimeKillLoraOffer_5e674785-2178-4b53-94b6-a09e4dfe32ca);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_AgreedToBringHeadToHag_c0a98ec4-171f-46c1-9a67-80140da3703e, "LOW_SaveHaggedChild", "AcceptedKillLora_AfterFirstOffer", 1, LOW_BlushingMermaid_State_TookTimeKillLoraOffer_5e674785-2178-4b53-94b6-a09e4dfe32ca);
DB_QuestDef_State(LOW_BlushingMermaid_State_MissingKidsMother_Dead_357a9292-30cb-4625-aefd-7f27d89c9511, "LOW_SaveHaggedChild", "KilledLora");
DB_QuestDef_State(LOW_BasiliskGate_State_KnockedOutLoraDisappeared_eade1142-3a15-4bb0-a940-0317c7d24aa6, "LOW_SaveHaggedChild", "KnockedOutLora_DisappearedOnLongRest");
DB_QuestDef_State(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, "LOW_SaveHaggedChild", "DealWithHag");
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_HagRetreatedToCellar_0f973681-c559-4b66-9caf-d42809059369, "LOW_SaveHaggedChild", "HagCellarRetreat", 0, LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_HagBossFightStarted_20001901-b4cb-48a3-900d-50838d67de61, "LOW_SaveHaggedChild", "HagBossFightStarted_BrokeDeal", 1, LOW_BlushingMermaid_State_MadeDealWithHag_5d727ce8-a931-4a70-9c84-413565825b0c);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_HagBossFightStarted_20001901-b4cb-48a3-900d-50838d67de61, "LOW_SaveHaggedChild", "HagBossFightStarted", 0, LOW_BlushingMermaid_State_HagQuestGrenade_BookRead_6c36ea74-ea4e-4974-b9cd-dd49ca00265f);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_HagBossFightStarted_20001901-b4cb-48a3-900d-50838d67de61, "LOW_SaveHaggedChild", "HagBossFightStarted_KnowsGrenadeRecipe", 1, LOW_BlushingMermaid_State_HagQuestGrenade_BookRead_6c36ea74-ea4e-4974-b9cd-dd49ca00265f);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_VanraOutOfHag_80a69cad-828a-4d92-9bc3-9acf206f9739, "LOW_SaveHaggedChild", "VanraSavedWithQuestGrenade", 0, LOW_BlushingMermaid_State_HagCutOpen_d1772eba-c22b-4235-a492-eb39e0926237);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_VanraOutOfHag_80a69cad-828a-4d92-9bc3-9acf206f9739, "LOW_SaveHaggedChild", "VanraCarvedOut", 1, LOW_BlushingMermaid_State_HagCutOpen_d1772eba-c22b-4235-a492-eb39e0926237);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_Event_VanraWentToMom_895cda4f-6348-45c0-ba2e-bac1a7a1a0b2, "LOW_SaveHaggedChild", "VanraReturnedHome_NoLora", 1, LOW_BlushingMermaid_State_MissingKidsMother_PermaDefeated_b77d4de2-9c85-447c-94d3-776bac904880);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_Event_VanraWentToMom_895cda4f-6348-45c0-ba2e-bac1a7a1a0b2, "LOW_SaveHaggedChild", "VanraReturnedHome_LoraPermaHostile", 1, LOW_BlushingMermaid_State_MissingKidsMother_PermaHostile_8b29049d-1cc3-4d94-a147-b4cb1068237f);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_Event_VanraWentToMom_895cda4f-6348-45c0-ba2e-bac1a7a1a0b2, "LOW_SaveHaggedChild", "VanraReturnedHome_LoraNeverAsked", 0, LOW_BasiliskGate_State_KnowsVanraIsMissing_8c800e14-8dba-4685-a95e-81a719da60eb);
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_Event_VanraWentToMom_895cda4f-6348-45c0-ba2e-bac1a7a1a0b2, "LOW_SaveHaggedChild", "VanraReturnedHome_LoraHome", 0, LOW_BlushingMermaid_State_MissingKidsMother_PermaHostile_8b29049d-1cc3-4d94-a147-b4cb1068237f);
DB_QuestDef_State(LOW_BlushingMermaid_State_RewardFromLoraReceived_28060f87-7cba-4cbe-9dcd-24654fd6bdbb, "LOW_SaveHaggedChild", "LoraGaveReward");
DB_QuestDef_PermaDefeatedState("LOW_SaveHaggedChild", "VanraPermaDefeated", S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c);
DB_CombatReact_AD_OnNextTurn(S_LOW_BlushingMermaid_DisguisedRedcap_01_efa9ccb1-4ba2-4467-82ef-b8ed63b867a4, LOW_BlushingMermaid_AD_Combat_Redcaps_000_8474fd31-eab1-1d04-0ec0-753830c07fbb);
DB_CombatReact_AD_OnNextTurn(S_LOW_BlushingMermaid_DisguisedRedcap_04_9f218fa2-418d-46ee-b38d-1708f25314ec, LOW_BlushingMermaid_AD_Combat_Redcaps_001_3f946954-8f7a-5075-ab9e-5f632ebf19d4);
DB_CombatReact_AD_OnNextTurn(S_LOW_BlushingMermaid_DisguisedRedcap_05_357299a8-b8c2-4b99-92f8-761fd697c435, LOW_BlushingMermaid_AD_Combat_Redcaps_002_ebaa219f-5f2a-fb64-8a9e-d59bae188227);
DB_CombatReact_AD_OnNextTurn(S_LOW_BlushingMermaid_DisguisedRedcap_06_8a9a0273-3a3b-47ee-b362-5b83903458fb, LOW_BlushingMermaid_AD_Combat_Redcaps_003_e17e2c39-e12e-d20a-be02-3d5e9a12a2fa);
DB_CombatReact_AD_OnCast(S_LOW_BlushingMermaid_DisguisedRedcap_02_ba363354-3341-41e9-ae92-c3fe8a07a9ea, LOW_BlushingMermaid_AD_Combat_Redcaps_Multiattack_cc504a67-82e7-bdd0-e753-09d8a9768b5e, "Target_LOW_BlushingMermaid_Redcap_MultiAttack");
DB_CombatReact_AD_AppliedStatus(S_LOW_BlushingMermaid_DisguisedRedcap_03_76784911-9f0d-48f6-8e0d-b609345b2be2, LOW_BlushingMermaid_AD_Combat_Redcaps_Bloodlust_ec35f545-9ae2-5a64-b215-76ba5b9d1393, "LOW_REDCAP_BLOODLUST");

KBSECTION
IF
DB_LOW_Ethel(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_CharacterCorpseDialog(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, HAG_Hag_Dead_ce5651fe-84a8-598c-a98c-abd136055663);
SetCanTrade(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0);
SetCombatGroupID(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagBossFight");
PROC_SpotPlayers_StopSpotting(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "HAG_Hag");
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_NoLowAttitudeDialog(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_LOW_LevelTeleportHagResurrecting(1);
DB_SceneManager(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_DisguisedHag_Scene");
DB_Dialogs(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, LOW_BlushingMermaid_DisguisedHag_1632da0a-d0d7-4905-1c99-75c88102f102);
DB_PreventPermaDefeated(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
TeleportTo(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, S_LOW_BlushingMermaid_QuenoraTeleportSpot_2244ed9b-e942-49f2-85aa-465f6defaef2, "");
PROC_SetOnStage(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1);
Resurrect(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", -1, 0);
SetHitpointsPercentage(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 100);
SetImmortal(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1);
SetFlag(LOW_BlushingMermaid_State_HagInBaldursGate_68d1731c-7a20-4692-a093-5aa39b69d211);
PROC_LOW_SetOnStage_Redcaps(1);
PROC_Poof(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c);
PROC_SetRelationToPlayers(GLO_Hag_313edae9-c797-2c65-9f7c-47e1f4e3221e, 50);
PROC_SetRelationToPlayers(GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0, 0);
PROC_LOW_SetShroomDifficulty();
PROC_SetCustomTradeTreasure(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_Hag");

IF
DB_LOW_Quenora(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
DB_HAG_MaskedVictims(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, S_BlushingMermaid_QuenoraGrizly_SummonPoint_22b859c4-fecd-4a09-a581-43a378d6be86, 700, LOW_BlushingMermaid_AD_QuenoraGrizly_Resist_6313b4b6-7332-c76c-e42f-ceb6248d509d);
DB_Dialogs(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, LOW_BlushingMermaid_QuenoraGrizly_Masked_2720cc15-7f8b-af63-7ed8-adea66cfd931);
TeleportTo(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, S_LOW_BlushingMermaid_QuenoraCellarTeleportSpot_aa0d6690-3ce1-4636-8be0-ea0180d134e1);
SetFaction(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0);
SetTag(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, AI_USESPELL_A_33aa698c-aea0-43e2-bd16-582aa718fd3e);
RemoveStatus(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, "ANIM_OVERRIDE_BM_HANGOVER_01");
PROC_LOW_BlushingMermaid_OwnershipTriggerSertup(S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9);

IF
DB_LOW_Quenora(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
DB_Dialogs(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, LOW_BlushingMermaid_QuenoraGrizly_4f9eea9b-d3e9-6eaf-5d26-8fef98f93105);
Resurrect(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
TeleportTo(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, S_LOW_BlushingMermaid_QuenoraTeleportSpot_2244ed9b-e942-49f2-85aa-465f6defaef2);
Unequip(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, S_LOW_BlushingMermaid_QuenorasHagMask_6eb1036e-017e-4cc2-8f65-1cc0cda601ad);
SetFaction(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, ACT3_LOW_BlushingMermaid_Civilians_c0d4b9de-5884-41c1-aab8-1fbce6991129);
ToInventory(S_LOW_BlushingMermaid_CellarDoor_Key_b67244b6-d831-41da-8b95-c085238e876b, S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
ClearTag(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, ACT3_LOW_HAG_9b91e9ae-0205-476d-a381-17dca1b2cdc7);
ApplyStatus(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, "ANIM_OVERRIDE_BM_HANGOVER_01", -1);
PROC_LOW_SetOnStage_Redcaps(0);
PROC_LOW_BlushingMermaid_OwnershipTriggerSertup(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);

IF
DB_HAG_Hagmasks(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
AND NOT
GetDirectInventoryOwner(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

IF
DB_HAG_Hagmasks(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 1);

IF
DB_HAG_MaskedVictims(_Var1, _, _, _, _Var1)
AND NOT
DB_LOW_Quenora(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

IF
DB_HAG_MaskedVictims(_Var1, _, _, _, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_MaskedVictims_HagMask(_Var1, _Var5, _Var6, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 1);
TemplateAddTo(_Var6, _Var1, 1);
ApplyStatus(_Var1, "HAG_MASK_NPC", -1);
Equip(_Var1, _Var5);
SetCombatGroupID(_Var1, "LOW_MaskedVictims");

IF
FlagSet(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(LOW_BlushingMermaid_State_MadeDealWithHag_5d727ce8-a931-4a70-9c84-413565825b0c);
PROC_SetRelationToPlayers(GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0, 50);

IF
FlagSet(LOW_BlushingMermaid_State_HagSummonedMaskedVictims_9f668b40-cd80-48ea-bca7-ac4c046163f4, _, _, _, _)
AND
DB_HAG_MaskedVictims(_Var3, _, _Var5, _, _)
THEN
PROC_ForceStopDialog(_Var3);
ObjectTimerLaunch(_Var3, "LOW_HagSummonedMaskedVictims_Timer", _Var5);

IF
ObjectTimerFinished((CHARACTER)_Var1, "LOW_HagSummonedMaskedVictims_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAG_MaskedVictims(_Var1, _Var2, _, _, _Var1)
THEN
PlayEffect(_Var1, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f, "", 1);
PlayEffect(_Var2, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f, "", 1);
TeleportTo(_Var1, _Var2);
SetCombatGroupID(_Var1, "LOW_HagBossFight");
SetFaction(_Var1, GLO_Hag_313edae9-c797-2c65-9f7c-47e1f4e3221e);

PROC
PROC_LOW_MaskedVictimsNeutral()
AND
DB_HAG_MaskedVictims(_Var1, _Var2, _, _, _Var1)
THEN
SetFaction(_Var1, GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0);

PROC
PROC_LOW_MaskedVictimsNeutral()
THEN
PROC_SetRelationToPlayers(GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0, 50);
PROC_SetRelationMutual(GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0, GLO_Hag_313edae9-c797-2c65-9f7c-47e1f4e3221e, 50);

PROC
PROC_LOW_SetOnStage_Redcaps((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_DisguisedRedcaps(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var2, _Var1);

IF
DB_LOW_DisguisedRedcaps(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, _Var2, -1, 0);

IF
RelationChanged(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, 1, (CHARACTER)_Var1)
AND
DB_LOW_DisguisedRedcaps(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, _Var2);
PROC_RemoveAllDialogEntriesForSpeaker(_Var1);

IF
RelationChanged(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, 1, _)
THEN
SetFlag(LOW_BlushingMermaid_State_DisguisedRedcapsDroppedDisguise_da4c2802-faa5-4e60-a591-f52c2622e6f9);
PROC_SetRelationMutual(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, 0);
PROC_SetRelationMutual(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, GLO_FlamingFists_Reinforcements_a2a56601-616b-4d85-b571-cf34fc5801a8, 0);

IF
FlagSet(LOW_BlushingMermaid_State_DisguisedRedcapsDroppedDisguise_da4c2802-faa5-4e60-a591-f52c2622e6f9, _, _, _, _)
AND
DB_LOW_DisguisedRedcapsPlayersToAttack(_Var3, _, _, _, _)
AND
DB_LOW_DisguisedRedcaps(_Var4, _, _, _, _)
THEN
PROC_EnterCombat(_Var3, _Var4);

PROC
PROC_GLO_DefeatCounter_AllPermaDefeated("LOW_BlushingMermaid_RedcapsPermaDefeated", _, _, _, _)
THEN
SetFlag(LOW_BlushingMermaid_State_DisguisedRedcaps_PermaDefeated_032aeb06-5eff-4459-8b1d-4ad796c15a8b);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_DisguisedRedcapsDroppedDisguise_da4c2802-faa5-4e60-a591-f52c2622e6f9, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_DisguisedRedcaps_PermaDefeated_032aeb06-5eff-4459-8b1d-4ad796c15a8b, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HadLongRestAfterPermaDefeatingRedcaps_7ebdacc6-5aa5-486b-88ab-0d09829bd1e5, _, _, _, _)
THEN
SetFlag(LOW_BlushingMermaid_State_HadLongRestAfterPermaDefeatingRedcaps_7ebdacc6-5aa5-486b-88ab-0d09829bd1e5);

PROC
PROC_SceneInterrupted((CHARACTER)_Var1, (CHARACTER)_Var2, "LOW_DisguisedHag_Scene", "Attacked", (CHARACTER)_Var1)
AND
DB_LOW_DisguisedRedcaps(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_DisguisedRedcapAttacked_HagDropsDisguise", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, 0);
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE");
SetFlag(LOW_BlushingMermaid_State_DisguisedRedcapAttacked_097435c5-0a18-4062-8932-61ef459aa5ff);

IF
FlagSet(LOW_BlushingMermaid_State_DisguisedRedcapsDroppedDisguise_da4c2802-faa5-4e60-a591-f52c2622e6f9, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_NotifyWhenReadyToMoveOn(S_LOW_BlushingMermaid_Patron_02_01f6482f-3afc-496e-9d9a-cb078a2dd5b1, "LOW_BlushingMermaidPatronRunAway_Notify");
PROC_NotifyWhenReadyToMoveOn(S_LOW_BlushingMermaid_Patron_08_40dcda0b-7891-414f-8aeb-f742d842207d, "LOW_BlushingMermaidPatronRunAway_Notify");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_BlushingMermaidPatronRunAway_Notify", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 1, "");

PROC
PROC_LOW_BlushingMermaid_OwnershipTriggerSertup((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 == S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232
THEN
PROC_LOW_BlushingMermaid_OwnershipTriggerCleanup();
DB_ItemOwnerShipTriggers("CTY_Main_A", S_LOW_BlushingMermaid_OwnershipTrigger_308b4eb6-9778-4065-aa04-478a0d26821d, S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
DB_ItemOwnerShipTriggersFallback(S_LOW_BlushingMermaid_OwnershipTrigger_308b4eb6-9778-4065-aa04-478a0d26821d, S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9);

PROC
PROC_LOW_BlushingMermaid_OwnershipTriggerSertup((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 == S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9
THEN
PROC_LOW_BlushingMermaid_OwnershipTriggerCleanup();
DB_ItemOwnerShipTriggers("CTY_Main_A", S_LOW_BlushingMermaid_OwnershipTrigger_308b4eb6-9778-4065-aa04-478a0d26821d, S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9);

PROC
PROC_LOW_BlushingMermaid_OwnershipTriggerCleanup()
AND
DB_ItemOwnerShipTriggersFallback(S_LOW_BlushingMermaid_OwnershipTrigger_308b4eb6-9778-4065-aa04-478a0d26821d, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_ItemOwnerShipTriggersFallback(S_LOW_BlushingMermaid_OwnershipTrigger_308b4eb6-9778-4065-aa04-478a0d26821d, _Var1);

PROC
PROC_LOW_BlushingMermaid_OwnershipTriggerCleanup()
THEN
TriggerClearItemsOwner(S_LOW_BlushingMermaid_OwnershipTrigger_308b4eb6-9778-4065-aa04-478a0d26821d);

IF
DB_ItemOwnerShipTriggers("CTY_Main_A", S_LOW_BlushingMermaid_OwnershipTrigger_308b4eb6-9778-4065-aa04-478a0d26821d, _, _, _)
THEN
ClearOwnership(DOOR_Double_Slim_City_House_C_Frameless_Top_A_005_f81ceacf-0db3-8ae1-1a41-baad6a885d8c);
ClearOwnership(S_LOW_BlushingMermaid_CellarDoor_Upstairs_25633b00-cb37-43a6-97cc-707c1f9f4b83);
ClearOwnership(DOOR_Double_Medium_City_House_I_000_e10392f4-924b-8870-1be9-cff275c5dafe);
ClearOwnership(DOOR_Double_Slim_City_House_C_Frameless_Top_A_402aa068-924c-4830-9085-5fa6be51ea3d);
ClearOwnership(DOOR_Double_Slim_City_House_C_Frameless_Top_A_8e2798d2-6983-46a5-b314-4c4726fd26ef);
ClearOwnership(DOOR_Double_Slim_City_House_C_Frameless_Top_A_135eb65d-f28e-4b17-b906-d5962cf4155c);
ClearOwnership(S_LOW_BlushingMermaid_CellarDoor_Upstairs_2_3d43d839-e612-468a-8c9b-c186febce1cf);

IF
DB_LOW_Ethel(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SpotPlayers(_Var1, "LOW_EthelDrinkSuggestion_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(_Var1, "LOW_EthelDrinkSuggestion_Spotting");

PROC
PROC_SpotPlayers_Spotted(_, "LOW_EthelDrinkSuggestion_Spotting", (CHARACTER)_Var2, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRevealed_aa751f69-f448-1436-c243-eb9f06a060ca, _, _, _, _)
AND
DB_GlobalFlag(LOW_BasiliskGate_State_KnowsVanraIsMissing_8c800e14-8dba-4685-a95e-81a719da60eb, _, _, _, _)
THEN
PROC_TryStartAD(LOW_BlushingMermaid_AD_Greeting_AuntieEthel_eb80a1f4-680b-350b-1a70-20b15c4b0628, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
PROC_SpotPlayers_StopSpotting(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_EthelDrinkSuggestion_Spotting");

PROC
PROC_SpotPlayers_Spotted(_, "LOW_BosunGannetAD_Spotting", (GUIDSTRING)_Var2, _, _)
AND
QRY_OnlyOnce("LOW_BosunGannetAD_Spotting", _, _, _, _)
THEN
PROC_TryStartAD(LOW_BlushingMermaid_AD_Greeting_BosunGannet_b817e48e-6d09-c0a9-314c-2d43ed2f62b2, S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9);

IF
StatusApplied(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", _, _, (GUIDSTRING)_)
THEN
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "ANIM_OVERRIDE_BM_HANGOVER_01", -1);
RealtimeObjectTimerLaunch(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_SetHagDisguisedTitle_Timer", 1);

IF
ObjectTimerFinished(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_SetHagDisguisedTitle_Timer", _, _, _)
THEN
ObjectSetTitle(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_BlushingMermaid_EmptyHagTitle");

IF
StatusRemoved(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", _, _, (GUIDSTRING)_)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "ANIM_OVERRIDE_BM_HANGOVER_01");
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_PREGNANT", -1);
Transform(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, Hag_Green_Pregnant_5c1b2180-1225-43a6-91ff-f176f2cdd741, DisguiseKeepName_c7c3381e-b901-416e-a0c4-bc745e1ff54a);
PROC_SpotPlayers_StopSpotting(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_EthelDrinkSuggestion_Spotting");
PROC_SceneOver("LOW_DisguisedHag_Scene");
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_HagRevealed_aa751f69-f448-1436-c243-eb9f06a060ca);
ObjectSetTitle(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "HAG_HagTitle");
NOT DB_PartyProgress_Trigger(S_LOW_BlushingMermaid_HaggyCellar_Trigger_47b776be-f7c3-4104-b1e4-7ff53c8eea0a, LOW_BlushingMermaid_State_EnteredHagCellar_NoHagReveal_42a4b333-0d02-4397-b232-9d35aa1ccccd);

IF
StatusRemoved(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", _, _, _)
AND
GetHitpoints(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, _, _, _)
AND
_Var3 > 0
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _, _, _, _)
AND NOT
QRY_LOW_HagTransformed_StartDialogCustom()
THEN
PROC_LOW_HagRetreatsToOrlop();

IF
StatusRemoved(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", _, _, _)
AND
GetHitpoints(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, _, _, _)
AND
_Var3 <= 0
THEN
DB_LOW_HagKilledWhileDisguised(1);

QRY
QRY_CRIME_BlockRegisterCrime(_, _, _, _, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _, _)
AND
DB_LOW_HagKilledWhileDisguised(1, _, _, _, _)
THEN
DB_Noop(1);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_Event_HagTransformsInDialog_5fa54251-1a34-4218-aa5b-f0ca9cda9c82, _, _, _, _)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE");

PROC
PROC_SceneInterrupted((CHARACTER)_Var1, (CHARACTER)_Var2, "LOW_DisguisedHag_Scene", "Attacked", (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE");

QRY
QRY_LOW_HagTransformed_StartDialogCustom()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, 1, 0, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_LOW_BlushingMermaid_Pub_Trigger_dc4d50f8-5bee-4117-9722-ac02e7ab113f, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var1, 0, 0, 0, 1, _Var1, _Var1, _Var1)
THEN
DB_AddCharactersInTriggerToDialog(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, S_LOW_BlushingMermaid_Pub_Trigger_dc4d50f8-5bee-4117-9722-ac02e7ab113f, 1, 1, 1);

QRY
QRY_ShouldNotAddCharacterInTriggerToDialog((CHARACTER)_Var1, LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, S_LOW_BlushingMermaid_Pub_Trigger_dc4d50f8-5bee-4117-9722-ac02e7ab113f, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_DialogName(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, _Var3, _Var1, _Var1, _Var1)
THEN
DB_HiddenPlayer_TransformedHagDialog(_Var1, _Var3);

IF
DialogEnded(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, _, _, _, _)
AND
DB_HiddenPlayer_TransformedHagDialog(_Var2, _Var3, _, _, _)
THEN
NOT DB_HiddenPlayer_TransformedHagDialog(_Var2, _Var3);

IF
DB_HiddenPlayer_TransformedHagDialog(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_LOW_BlushingMermaid_Pub_Trigger_dc4d50f8-5bee-4117-9722-ac02e7ab113f, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddListeningActor(_Var2, _Var1);

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_BlushingMermaid_DisguisedHag_1632da0a-d0d7-4905-1c99-75c88102f102, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_DialogAddSpeakingActorAt(_Var1, S_LOW_BlushingMermaid_QuenoraGrizly_HagVoiceDummy_5790158e-f3bc-47f4-9fc9-38767daeeceb, 3);

IF
TemplateUseFinished((CHARACTER)_Var1, (ITEMROOT)_Var2, _, 1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_HagInformantsNote_Templates(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_BlushingMermaid_HagInformantsNoteRead(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_BlushingMermaid_HagInformantsNoteRead(1);
SetFlag(LOW_BlushingMermaid_State_PlayersReadHagInformantsNote_23cc4563-f336-4f9e-a83c-35fe8b8f8308);

IF
FlagSet(LOW_BlushingMermaid_Event_HagGivesGold_41db7122-db70-4520-a4c8-a708671bcab9, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DialogMoneyTransfer(1, LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, _Var3, _Var1, _Var1)
THEN
AddGold(_Var1, _Var3);

IF
DB_LOW_GoldRewardForKillingLora(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_HagDialogsWithGold(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DialogMoneyTransfer(1, _Var2, _Var1);

IF
FlagSet(LOW_BlushingMermaid_State_DoubledLoraKillBounty_211f67fe-e957-44b9-969e-f25fb312a97b, _, _, _, _)
AND
DB_LOW_HagDialogsWithGold(_Var3, _, _, _, _)
AND
DB_DialogMoneyTransfer(1, _Var3, _Var4, _, _)
THEN
NOT DB_DialogMoneyTransfer(1, _Var3, _Var4);

IF
FlagSet(LOW_BlushingMermaid_State_DoubledLoraKillBounty_211f67fe-e957-44b9-969e-f25fb312a97b, _, _, _, _)
AND
DB_LOW_GoldRewardForKillingLora(_Var3, _, _, _, _)
AND
IntegerProduct(_Var3, 2, _Var4, _, _)
AND
DB_LOW_HagDialogsWithGold(_Var5, _, _, _, _)
THEN
DB_DialogMoneyTransfer(1, _Var5, _Var4);

IF
DialogEnded(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _, _, _, _)
THEN
PROC_LOW_HagRetreatsToOrlop();

IF
DialogEnded(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_LOW_DisguisedRedcapsAggro()
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
THEN
DB_LOW_DisguisedRedcapsPlayersToAttack(_Var2);

IF
DialogEnded(LOW_BlushingMermaid_VomitsOutVanra_Hag_10f3400d-85f0-d324-5057-c0b6bdc6366c, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _, _, _, _)
THEN
PROC_LOW_HagRetreatsToOrlop();

IF
FlagSet(LOW_BlushingMermaid_Event_HagVomitsVanraWithoutDialog_43fe7708-b061-44de-84fd-40574c7379aa, _, _, _, _)
AND
GetPosition(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, _Var4, _Var5, _)
THEN
DB_LOW_VanraSpawnPosition(_Var3, _Var4, _Var5);
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8);
PROC_LOW_HagRetreatsToOrlop();

PROC
PROC_LOW_HagRetreatsToOrlop()
AND
GetHitpoints(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 > 0
AND
QRY_OnlyOnce("LOW_BlushingMermaid_HagRetreatsToOrlop", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Poof(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f);
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE");
TeleportTo(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, S_LOW_BlushingMermaid_HagCellarTeleportSpot_78b85f90-81ba-4509-a7d5-b30b836f212c, "LOW_HagTeleportedToCellar", 1, 1, 1, 1, 1);

PROC
PROC_LOW_HagRetreatsToOrlop()
AND
GetHitpoints(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 <= 0
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_DefeatCounter(_Var2, "LOW_HagResurrectionShrooms_PermaDefeated", _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HagShroomResurrectedHagKilledBeforeRetreat(_, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_BlushingMermaid_HagRetreatsToOrlop", _Var1, _Var1, _Var1, _Var1)
THEN
DB_HagShroomResurrectedHagKilledBeforeRetreat(_Var2);

IF
StatusApplied(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_RESURRECTING", _, _, _)
AND
DB_HagShroomResurrectedHagKilledBeforeRetreat(_Var3, _, _, _, _)
THEN
UseSpell(_Var3, "Target_LOW_HagShroom_Resurrect", S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

PROC
PROC_LOW_DisguisedRecaps_HostileAfterHagRetreat()
AND
QRY_LOW_DisguisedRedcapsAggro()
THEN
PROC_SetRelationToPlayers(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, 0);

PROC
PROC_LOW_DisguisedRecaps_HostileAfterHagRetreat()
AND NOT
QRY_LOW_DisguisedRedcapsAggro()
AND
DB_LOW_DisguisedRedcaps(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_SceneManager(_Var1, "LOW_DisguisedRedcapsPostHagReveal_Scene");

PROC
PROC_SceneInterrupted((CHARACTER)_Var1, (CHARACTER)_Var2, "LOW_DisguisedRedcapsPostHagReveal_Scene", "Attacked", (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, 0);

QRY
QRY_LOW_DisguisedRedcapsAggro()
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_PromisedNotToBotherHag_475ec6fe-6c79-394a-eb93-7b83ec3926e9, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _, _, _, _)
THEN
DB_NOOP(1);

IF
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_LOW_DisguisedRedcapsPlayersToAttack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
DB_LOW_DisguisedRedcaps(_Var3, _, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_StoreHagRetreatCombatID_OnlyOnce", _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagRetreatCombatID(_Var2);

IF
SwitchedCombat(_, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, _, _)
AND
DB_LOW_HagRetreatCombatID(_Var2, _, _, _, _)
THEN
NOT DB_LOW_HagRetreatCombatID(_Var2);
DB_LOW_HagRetreatCombatID(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_HagRetreatCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_HagRetreatCombatID(_Var1);
PROC_LOW_HagCellarRetreatPAD();

PROC
PROC_LOW_HagCellarRetreatPAD()
AND
DB_LOW_DisguisedRedcapsPlayersToAttack(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_HagCellarRetreatPAD_Started(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_BlushingMermaid_PAD_PostHagCellarRetreat_f647274d-4de4-9d78-0e19-df524997d4da, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagCellarRetreatPAD_Started(1);

PROC
PROC_LOW_HagCellarRetreatPAD()
AND
DB_LOW_DisguisedRedcapsPlayersToAttack(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_DisguisedRedcapsPlayersToAttack(_Var1);

PROC
PROC_LOW_HagCellarRetreatPAD()
AND
DB_LOW_HagCellarRetreatPAD_Started(1, _, _, _, _)
THEN
NOT DB_LOW_HagCellarRetreatPAD_Started(1);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_HagTeleportedToCellar", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_Foop(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f);
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_HagRetreatedToCellar_0f973681-c559-4b66-9caf-d42809059369);
SetIsBoss(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1);
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_MAGICRESISTANCE", -1);
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
PROC_LOW_DisguisedRecaps_HostileAfterHagRetreat();

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_HagTeleportedToCellar", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_BlushingMermaid_State_HagMasksControlWearers_17fe9c38-dcb6-45f4-912d-bb0d11553d91);
ApplyStatus(_Var1, "INVISIBLE", -1);
RemoveHarmfulStatuses(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
SetHitpointsPercentage(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 100);
DB_SceneManager(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_PreHagCellarCombat_Scene");
DB_SpotPlayers(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarDialog_Spotting", LOW_BlushingMermaid_Event_Hag_StartSpotting_893b414f-6e8d-4831-b6ff-253472cf7ef5, NULL_00000000-0000-0000-0000-000000000000);
PROC_LOW_SetupHagCellarCombatSpotting();
DB_SpotPlayers_SpotTrigger(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting", S_LOW_BlushingMermaid_HagCellarCombatTrigger_28528ff2-3b0d-4142-8a03-be90610e17a6);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_HagTeleportedToCellar", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_BlushingMermaid_State_HagMasksControlWearers_17fe9c38-dcb6-45f4-912d-bb0d11553d91);
PROC_LOW_SetupHagCellarCombatSpotting();

PROC
PROC_LOW_SetupHagCellarCombatSpotting()
THEN
DB_SpotPlayers_Continuous(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting");
DB_SpotPlayers_IncludeWildshapedPlayers(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting");
DB_SpotPlayers_IncludeFollowers(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting");
DB_SpotPlayers_IncludeSummons(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting");
DB_SpotPlayers_IgnoreCombat(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting");
DB_SpotPlayers_SpotterIgnoreCantTalk(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting");
DB_SpotPlayers(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_HagTeleportedToCellar", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Dialogs(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, LOW_BlushingMermaid_Hag_AfterDeal_7bcded43-4347-a00a-f2e7-63ca14eefc9f);
DB_SceneManager(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_PreHagCellarCombat_Scene");

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_HagTeleportedToCellar", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagShroomDefeated_4ae0b765-b770-45fa-8a3d-5486411ee245, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, S_LOW_BlushingMermaid_CellarTrigger_2c889517-8252-49f0-a55c-ead662b8cb3f, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var2, 0, 0, 0, 1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "INVISIBLE");
DB_AddCharactersInTriggerToDialog(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, S_LOW_BlushingMermaid_CellarTrigger_2c889517-8252-49f0-a55c-ead662b8cb3f, 1, 1, 1, 1);

IF
DialogEnded(LOW_BlushingMermaid_TransformedHag_e68f85b7-6266-426e-3aca-c8460b75b307, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagShroomDefeated_4ae0b765-b770-45fa-8a3d-5486411ee245, _, _, _, _)
THEN
PROC_LOW_HagCellarBossFightStarted();

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "LOW_HagCellarDialog_Spotting", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_StartDialog(LOW_BlushingMermaid_PreCellarCombat_Hag_3bd2c6d8-5638-4518-5c23-b057f70c0ede, _Var1, _Var2, _Var1, _Var1)
THEN
SetFlag(LOW_BlushingMermaid_Event_Hag_StartSpotting_893b414f-6e8d-4831-b6ff-253472cf7ef5);

IF
DialogStarted(LOW_BlushingMermaid_PreCellarCombat_Hag_3bd2c6d8-5638-4518-5c23-b057f70c0ede, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "INVISIBLE");

IF
DialogEnded(LOW_BlushingMermaid_PreCellarCombat_Hag_3bd2c6d8-5638-4518-5c23-b057f70c0ede, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_LOW_HagCellarBossFightStarted();

PROC
PROC_SpotPlayers_Spotted(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarCombat_Spotting", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagShroomDefeated_4ae0b765-b770-45fa-8a3d-5486411ee245, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
PROC_LOW_HagCellarBossFightStarted();

PROC
PROC_SpotPlayers_Spotted(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCellarDialog_Spotting", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagShroomDefeated_4ae0b765-b770-45fa-8a3d-5486411ee245, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_LOW_BlushingMermaid_HagCellarCombatTrigger_28528ff2-3b0d-4142-8a03-be90610e17a6, _Var1, _Var1, _Var1)
THEN
PROC_LOW_HagCellarBossFightStarted();

PROC
PROC_SceneInterrupted((CHARACTER)_Var1, (CHARACTER)_Var2, "LOW_PreHagCellarCombat_Scene", "Attacked", (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_HagCellarBossFightStarted();

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_State_PlayerBrokeDealWithHag_1e69b66d-9f46-4df5-aeb4-56382f8b1001, _, _, _, _)
THEN
PROC_LOW_HagCellarBossFightStarted();

PROC
PROC_LOW_HagCellarBossFightStarted()
AND
QRY_OnlyOnce("LOW_HagCellarBossFightStarted_OnlyOnce", _, _, _, _)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "INVISIBLE");
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_HagBossFightStarted_20001901-b4cb-48a3-900d-50838d67de61);
PROC_GlobalClearFlagAndCache(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5);
PROC_SetRelationToPlayers(GLO_Hag_313edae9-c797-2c65-9f7c-47e1f4e3221e, 0);
PROC_SpotPlayers_StopSpotting("LOW_HagCellarDialog_Spotting");
PROC_SpotPlayers_StopSpotting("LOW_HagCellarCombat_Spotting");
PROC_SceneOver("LOW_PreHagCellarCombat_Scene");

IF
DB_Is_InCombat(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagBossFightStarted_20001901-b4cb-48a3-900d-50838d67de61, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_TrackHagBossFightCombat_OnlyOnce", _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagBossFightCombat(_Var1);

IF
SwitchedCombat(_, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, _, _)
AND
DB_LOW_HagBossFightCombat(_Var2, _, _, _, _)
THEN
NOT DB_LOW_HagBossFightCombat(_Var2);
DB_LOW_HagBossFightCombat(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_HagBossFightCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_HagBossFightCombat(_Var1);

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_HagBossFightCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_StartedHagCombatPAD(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_BlushingMermaid_PAD_HagCombatStart_1641b1de-e377-f3ba-beb5-f0a7bfa05d5b, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_StartedHagCombatPAD(1);

IF
RelationChanged(GLO_Hag_313edae9-c797-2c65-9f7c-47e1f4e3221e, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, 1, _)
THEN
PROC_SetRelationToPlayers(GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0, 0);
PROC_SetRelationToPlayers(ACT3_LOW_BlushingMermaid_DisguisedRedcaps_febcc72f-64ee-4e59-92a1-5a135af81ad5, 0);

IF
FlagSet(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
NOT DB_PreventPermaDefeated(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
Dying(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c);
PROC_TryStartAD(LOW_BlushingMermaid_AD_Hag_TrulyDying_ed8b5f42-d6b5-fd49-9e16-de6cc1773fa3, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
TemplateAddTo(MAG_OfFeywildSparks_Ring_a4813d7b-2ff0-488b-8152-a27cb75e8d8e, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1);

IF
Dying(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
THEN
NOT DB_LOW_LevelTeleportHagResurrecting(1);
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_RESURRECTING", -1);

IF
DB_KnockedOut(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
THEN
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_AWAKENING", -1);

IF
FlagSet(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
AND
DB_LOW_ShroomSupportSpells(_Var3, _, _, _, _)
AND
HasActiveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, 1, _, _)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, NULL_00000000-0000-0000-0000-000000000000);

IF
StatusRemoved(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_RESURRECTING", _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
AND
GetHitpoints(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, _, _, _)
AND
_Var3 <= 0
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c);
TemplateAddTo(MAG_OfFeywildSparks_Ring_a4813d7b-2ff0-488b-8152-a27cb75e8d8e, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1);

IF
TurnStarted((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_DefeatCounter(_Var1, "LOW_HagResurrectionShrooms_PermaDefeated", _Var1, _Var1, _Var1)
AND
DB_LOW_ShroomSupportSpells(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
HasActiveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var2, 1, _Var1, _Var1)
THEN
UseSpell(_Var1, _Var3, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
CastedSpell(_, "Target_LOW_HagShroom_Resurrect", _, _, _)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_RESURRECTING");
PROC_Poof(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f);
TeleportTo(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, S_LOW_BlushingMermaid_HagResurrectionCircle_3f00a318-4728-443f-a987-d1dfcad588e6, "LOW_HagResurrectionTeleport");

IF
CastedSpell(_, "Target_LOW_HagShroom_Awaken", _, _, _)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_AWAKENING");
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "KNOCKED_OUT");
PROC_LOW_HagShroomsHeal();

IF
EntityEvent(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagResurrectionTeleport", _, _, _)
THEN
Resurrect(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
Resurrected(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND NOT
DB_LOW_LevelTeleportHagResurrecting(1, _, _, _, _)
AND NOT
DB_LOW_HagShroomsDefeated(_, _, _, _, _)
THEN
PROC_LOW_HagResurrectedFoop();

IF
Resurrected(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND NOT
DB_LOW_LevelTeleportHagResurrecting(1, _, _, _, _)
THEN
PROC_LOW_HagShroomsHeal();
PROC_LOW_HagResurrectedFoop();

IF
Resurrected(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HagShroomResurrectedHagKilledBeforeRetreat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_HagShroomResurrectedHagKilledBeforeRetreat(_Var1);
SetEntityEvent(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagTeleportedToCellar");

PROC
PROC_LOW_HagShroomsHeal()
AND
SysCount("DB_LOW_HagShroomsDefeated", 1, _Var1, _Var1, _Var1)
AND
DB_LOW_DefeatedShroomsToResurrectionHP(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetHitpointsPercentage(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var2);

PROC
PROC_LOW_HagResurrectedFoop()
THEN
PROC_Foop(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f);
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_MAGICRESISTANCE", -1);
SetTag(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, IGNORE_COMBAT_LATE_JOIN_PENALTY_6d60bed7-10cc-4b52-8fb7-baa75181cd49);
PROC_TryStartAD(LOW_BlushingMermaid_AD_Hag_Resurrection_f096d95c-cbea-0eec-68e8-7596378a3d99, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearFlag(LOW_BlushingMermaid_State_HagMasksControlWearers_17fe9c38-dcb6-45f4-912d-bb0d11553d91);
ClearFlag(LOW_BlushingMermaid_State_HagInBaldursGate_68d1731c-7a20-4692-a093-5aa39b69d211);
PROC_LOW_MaskedVictimsNeutral();
PROC_LOW_VanraSavedDialog();

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND
DB_LOW_DisguisedRedcaps(_Var3, _, _, _, _)
AND NOT
DB_PermaDefeated(_Var3, _, _, _, _)
THEN
Die(_Var3, 0, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1, 0, 0);
SetFlag(LOW_BlushingMermaid_State_DisguisedRedcapsDroppedDisguise_da4c2802-faa5-4e60-a591-f52c2622e6f9);

IF
EnteredChasm(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _, _, _, _, _, _)
AND
IsImmortal(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1, _, _, _)
THEN
SetImmortal(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0);

IF
EnteredCombat(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagCombatWithShrooms(_Var1);

IF
FlagSet(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
AND
DB_LOW_HagCombatWithShrooms(_Var3, _, _, _, _)
THEN
NOT DB_LOW_HagCombatWithShrooms(_Var3);

IF
SwitchedCombat(_, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, _, _)
AND
DB_LOW_HagCombatWithShrooms(_Var2, _, _, _, _)
THEN
NOT DB_LOW_HagCombatWithShrooms(_Var2);
DB_LOW_HagCombatWithShrooms(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_HagCombatWithShrooms(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_ShroomSupportSpells(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
HasActiveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var2, 1, _Var1, _Var1)
AND
DB_GLO_DefeatCounter(_Var4, "LOW_HagResurrectionShrooms_PermaDefeated", _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_ShroomCastsSupportSpellOnCombatEnd(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_ShroomCastsSupportSpellOnCombatEnd(1);
UseSpell(_Var4, _Var3, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
CastedSpell(_, (STRING)_Var2, _, _, _)
AND
DB_LOW_ShroomSupportSpells(_, _Var2, _, _, _)
AND
DB_LOW_ShroomCastsSupportSpellOnCombatEnd(1, _, _, _, _)
THEN
NOT DB_LOW_ShroomCastsSupportSpellOnCombatEnd(1);

PROC
PROC_LOW_SetShroomDifficulty()
AND
CheckRulesetModifierString(cac2d8bd-c197-4a84-9df1-f86f54ad4521, "HARD", 1, _, _)
AND
DB_GLO_DefeatCounter(_Var1, "LOW_HagResurrectionShrooms_PermaDefeated", _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "HAG_MUSHROOM_HARDCORE", -1, 0, NULL_00000000-0000-0000-0000-000000000000);

IF
RulesetModifierChangedString(cac2d8bd-c197-4a84-9df1-f86f54ad4521, _, (STRING)_Var2, _, _)
AND
_Var2 == "HARD"
AND
DB_GLO_DefeatCounter(_Var3, "LOW_HagResurrectionShrooms_PermaDefeated", _, _, _)
AND
HasActiveStatus(_Var3, "HAG_MUSHROOM_HARDCORE", 0, _, _)
THEN
ApplyStatus(_Var3, "HAG_MUSHROOM_HARDCORE", -1, 0, NULL_00000000-0000-0000-0000-000000000000);

IF
RulesetModifierChangedString(cac2d8bd-c197-4a84-9df1-f86f54ad4521, _, (STRING)_Var2, _, _)
AND
_Var2 != "HARD"
AND
DB_GLO_DefeatCounter(_Var3, "LOW_HagResurrectionShrooms_PermaDefeated", _, _, _)
AND
HasActiveStatus(_Var3, "HAG_MUSHROOM_HARDCORE", 1, _, _)
THEN
RemoveStatus(_Var3, "HAG_MUSHROOM_HARDCORE", NULL_00000000-0000-0000-0000-000000000000);

IF
DB_GLO_DefeatCounter(_Var1, "LOW_HagResurrectionShrooms_PermaDefeated", _Var1, _Var1, _Var1)
AND
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagShroomsDefeated(_Var1);

IF
DB_LOW_HagShroomsDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
SysCount("DB_LOW_HagShroomsDefeated", 1, _Var2, _Var1, _Var1)
AND
DB_LOW_DefeatedShroomsToCombatPhase(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
DB_LOW_CurrentHagFightState(_Var3);
SetFlag(_Var3);

IF
DB_LOW_CurrentHagFightState(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_CurrentHagFightState(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
THEN
NOT DB_LOW_CurrentHagFightState(_Var2);

IF
DB_LOW_HagShroomsDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRetreatedToCellar_0f973681-c559-4b66-9caf-d42809059369, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_BlushingMermaid_AD_Hag_MushroomKilled_db5097fd-3b3a-87e1-e8de-9df1f55246f2, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
DB_LOW_HagShroomsDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagShroomDefeated_4ae0b765-b770-45fa-8a3d-5486411ee245, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_HagShroomDefeated_4ae0b765-b770-45fa-8a3d-5486411ee245);

IF
DB_LOW_HagShroomsDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRetreatedToCellar_0f973681-c559-4b66-9caf-d42809059369, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_HagRetreatsDueToShroomDefeated_OnlyOnce", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_ShroomDestroyedBeforeHagRetreat();

PROC
PROC_LOW_ShroomDestroyedBeforeHagRetreat()
AND NOT
DB_DialogNPCs(_, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _)
THEN
PROC_LOW_HagRetreatsToOrlop();

PROC
PROC_LOW_ShroomDestroyedBeforeHagRetreat()
AND
DB_DialogNPCs(_Var1, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _Var1, _Var1)
AND
DB_DialogName(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_HagDialogsPreventingReteatWhenShroomDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagDialogInterruptedByShroomDefeated(_Var1);
PROC_ForceStopDialog(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
DialogEnded((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_HagDialogInterruptedByShroomDefeated(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_HagDialogInterruptedByShroomDefeated(_Var2);
PROC_LOW_HagRetreatsToOrlop();

IF
UsingSpellOnTarget((GUIDSTRING)_Var1, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "Throw_Throw", _, _, (INTEGER)_Var4, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_LOW_ThrowAtHag_ThrowId(_Var4);

IF
CastSpellFailed((GUIDSTRING)_Var1, "Throw_Throw", _, _, (INTEGER)_Var4)
AND
DB_LOW_ThrowAtHag_ThrowId(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_ThrowAtHag_ThrowId(_Var4);

IF
OnThrown((GUIDSTRING)_Var1, _, _, (INTEGER)_Var4, _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_ThrowAtHag_ThrowId(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
GetTemplate(_Var1, LOW_RegenerationPrevention_Grenade_df5f8cbf-42c5-4c0d-a0ec-ce5046474d8e, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagQuestGrenade_ThrowId(_Var4);

IF
AttackedBy(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, (GUIDSTRING)_Var2, _, _, _, (INTEGER)_Var6, _, _, _)
AND
DB_LOW_HagQuestGrenade_ThrowId(_Var6, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35);
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "STINKING_CLOUD", 18, 1, _Var2);

IF
FlagSet(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRevealed_aa751f69-f448-1436-c243-eb9f06a060ca, _, _, _, _)
THEN
DB_LOW_GreandeThrownAtDisguisedHag(1);

IF
FlagSet(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _, _, _, _)
AND NOT
DB_DialogNPCs(_, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _)
THEN
PROC_LOW_HagVomitsKid_GrenadeThrown();

IF
FlagSet(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _, _, _, _)
AND
DB_DialogNPCs(_Var3, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _)
THEN
PROC_ForceStopDialog(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
DB_DialogInstInterruptedByVomiting(_Var3);

IF
DialogEnded(_, (INTEGER)_Var2, _, _, _)
AND
DB_DialogInstInterruptedByVomiting(_Var2, _, _, _, _)
THEN
NOT DB_DialogInstInterruptedByVomiting(_Var2);
PROC_LOW_HagVomitsKid_GrenadeThrown();

PROC
PROC_LOW_HagVomitsKid_GrenadeThrown()
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_VanraIsDead_085595a2-d5d8-4379-ba50-5d92dbbbaa17, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8, _, _, _, _)
AND NOT
DB_LOW_GreandeThrownAtDisguisedHag(1, _, _, _, _)
AND NOT
QRY_LOW_StartDialogCustom_HagVomitsVanra_AddCharactersInTrigger(LOW_BlushingMermaid_VomitsOutVanra_Hag_10f3400d-85f0-d324-5057-c0b6bdc6366c, _, _, _, _)
THEN
SetFlag(LOW_BlushingMermaid_Event_HagVomitsVanraWithoutDialog_43fe7708-b061-44de-84fd-40574c7379aa);

IF
StatusRemoved(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_QuestGrenadeThrownAtHag_f2466d9f-3eca-4820-b1b2-3aa82719af35, _, _, _, _)
AND NOT
QRY_LOW_StartDialogCustom_HagVomitsVanra_AddCharactersInTrigger(LOW_BlushingMermaid_VomitsOutVanra_Hag_10f3400d-85f0-d324-5057-c0b6bdc6366c, _, _, _, _)
THEN
SetFlag(LOW_BlushingMermaid_Event_HagVomitsVanraWithoutDialog_43fe7708-b061-44de-84fd-40574c7379aa);

QRY
QRY_LOW_StartDialogCustom_HagVomitsVanra_AddCharactersInTrigger((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_InRegion(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var2, _Var1, _Var1, _Var1)
AND
DB_LOW_HagVomitTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(_Var1, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
DB_AddCharactersInTriggerToDialog(_Var1, _Var2, 1, 1, 1, 1);

IF
HitpointsChanged(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND
GetHitpoints(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var2, _, _, _)
AND
_Var2 <= 0
AND
QRY_OnlyOnce("LOW_HagVomitsOutDeadVanra", _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8, _, _, _, _)
AND NOT
QRY_LOW_StartDialogCustom_HagVomitsVanra_AddCharactersInTrigger(LOW_BlushingMermaid_HagVomitsOutDeadVanra_e3067621-8c76-c65e-8026-5dfaecc9d1de, _, _, _, _)
THEN
PROC_LOW_HagKilled_SpawnDeadVanra();

IF
DialogEnded(LOW_BlushingMermaid_HagVomitsOutDeadVanra_e3067621-8c76-c65e-8026-5dfaecc9d1de, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_HagVomitedOutDeadVanra_0e5faddc-1d86-400e-876a-6d7407a5ec27);
PROC_LOW_HagKilled_SpawnDeadVanra();

PROC
PROC_LOW_HagKilled_SpawnDeadVanra()
AND
GetPosition(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var1, _Var2, _Var3, _Var1)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_PREGNANT");
RemoveTransforms(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
SetImmortal(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0);
Die(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0, 1);
Die(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, 0, 1);
DB_LOW_HagVomitedDeadVanra(_Var1, _Var2, _Var3);
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_CantCarveOutVanra_860c8e13-f2e6-4939-ace9-56cac5ae3626);

IF
Died(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, (REAL)_Var1, (REAL)_Var1, (REAL)_Var1, (REAL)_Var1)
AND
DB_LOW_HagVomitedDeadVanra(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
TeleportToPosition(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, _Var1, _Var2, _Var3, "LOW_VanraDeadTeleport", 0);

IF
EntityEvent(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, "LOW_VanraDeadTeleport", _, _, _)
THEN
PROC_Foop(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, VFX_Script_LOW_HAG_BlushingMermaid_Vomit_01_44647e59-07b5-9678-6989-a08aa59c4ba2);
CreatePuddle(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, "SurfaceBlood", 10, 15, 10, 20, 1);

PROC
PROC_LOW_HagKilled_SpawnDeadVanra()
AND
DB_LOW_HagKilledWhileDisguised(1, _, _, _, _)
THEN
NOT DB_LOW_HagKilledWhileDisguised(1);
PROC_LOW_HagRetreatsToOrlop();

IF
DB_KnockedOut(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND
DB_DontRemoveDialogsOnKnockedOut(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
THEN
QuestUpdate("LOW_AvengeHagSurvivors", "HagKnockedOut");
DB_Dialogs(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3);

PROC
PROC_KnockedOut_Ended(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

IF
StatusApplied(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "KNOCKED_OUT", (CHARACTER)_Var1, _, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_CantCarveOutVanra_860c8e13-f2e6-4939-ace9-56cac5ae3626, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var3, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var1, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
DB_LOW_SavingVanraDialogStartedOnKnockOut(1);
DB_AddCharactersInTriggerToDialog(LOW_BlushingMermaid_SavingVanra_9876ad52-05a5-2c96-ad9f-90372661b2d3, _Var3, 1, 1, 1, 1);

IF
StatusApplied(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "KNOCKED_OUT", _, _, _)
AND NOT
DB_LOW_SavingVanraDialogStartedOnKnockOut(1, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_CantCarveOutVanra_860c8e13-f2e6-4939-ace9-56cac5ae3626, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND
DB_Sees(_Var3, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _)
AND NOT
DB_LOW_KnockedOutHag_CarveOutVanraPAD(1, _, _, _, _)
AND
QRY_StartDialog(LOW_BlushingMermaid_PAD_CutOutKid_bbaea0da-cb52-ddd8-d2cd-d7e0f36f1575, _Var3, _, _, _)
THEN
DB_LOW_KnockedOutHag_CarveOutVanraPAD(1);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_State_HagCutOpen_d1772eba-c22b-4235-a492-eb39e0926237, _, _, _, _)
THEN
Die(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0, 1);

IF
DialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_VanraSavedDialogs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8);

IF
FlagSet(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8, _, _, _, _)
AND NOT
DB_LOW_VanraSpawnPosition(_, _, _, _, _)
AND
GetPosition(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var6, _Var7, _Var8, _)
THEN
DB_LOW_VanraSpawnPosition(_Var6, _Var7, _Var8);

IF
DB_LOW_VanraSpawnPosition(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8, _Var1, _Var1, _Var1, _Var1)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_PREGNANT");
RemoveTransforms(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
SetImmortal(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0);
TeleportToPosition(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, _Var1, _Var2, _Var3, "LOW_VanraSavedTeleport", 0);
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_CantCarveOutVanra_860c8e13-f2e6-4939-ace9-56cac5ae3626);

IF
EntityEvent(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, "LOW_VanraSavedTeleport", _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_VanraOutOfHag_80a69cad-828a-4d92-9bc3-9acf206f9739);
PROC_RemoveAllDialogEntriesForSpeaker(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c);
DB_Children(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c);
DB_Dialogs(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, LOW_BlushingMermaid_VanraSaved_63754baa-d2dd-93fe-697c-dc9106b22291);
PROC_Foop(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, VFX_Script_LOW_HAG_BlushingMermaid_Vomit_01_44647e59-07b5-9678-6989-a08aa59c4ba2);

IF
WentOnStage(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, 1, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_VanraOutOfHag_80a69cad-828a-4d92-9bc3-9acf206f9739, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRetreatedToCellar_0f973681-c559-4b66-9caf-d42809059369, _, _, _, _)
AND NOT
QRY_LOW_VanraSavedInDialog()
THEN
PROC_LOW_VanraRunsAwayAfterVomitInCellar();

QRY
QRY_LOW_VanraSavedInDialog()
AND
DB_DialogNPCs(_Var1, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _Var1, _Var1)
AND
DB_DialogName(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_VanraSavedDialogs(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_LOW_VanraSavedInDialog(_Var1);

IF
DialogEnded(_, (INTEGER)_Var2, _, _, _)
AND
DB_QRYRTN_LOW_VanraSavedInDialog(_Var2, _, _, _, _)
THEN
NOT DB_QRYRTN_LOW_VanraSavedInDialog(_Var2);
PROC_LOW_VanraRunsAwayAfterVomitInCellar();

PROC
PROC_LOW_VanraRunsAwayAfterVomitInCellar()
AND
QRY_OnlyOnce("LOW_VanraRunsAwayAfterVomitInCellar_OnlyOnce", _, _, _, _)
THEN
PROC_TryStartAD(LOW_BlushingMermaid_AD_VanraSaved_79153be5-ce8d-00b7-791e-cb76eee21741, S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c);
PROC_CharacterMoveTo(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, S_LOW_BlushingMermaid_VanraSavedSpot_5a68ace7-69e6-4eba-8b6e-cb4497734384, "Run", "");

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_Event_VanraWentToMom_895cda4f-6348-45c0-ba2e-bac1a7a1a0b2, _, _, _, _)
THEN
PROC_DisappearOutOfSight(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, "Run", 0, "LOW_BlushingMermaid_VanraRunsAway");

IF
FlagSet(LOW_BlushingMermaid_State_CantCarveOutVanra_860c8e13-f2e6-4939-ace9-56cac5ae3626, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
NOT DB_DontRemoveDialogsOnKnockedOut(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);

PROC
PROC_LOW_VanraSavedDialog()
AND
DB_GlobalFlag(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, _, _, _, _)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, 1, 0, _Var1, _Var1)
AND
DB_InRegion(_Var1, S_LOW_BlushingMermaid_VanraDialogTrigger_56469603-08e9-45cd-8412-da70896834e3, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialogCustom(LOW_BlushingMermaid_VanraSaved_63754baa-d2dd-93fe-697c-dc9106b22291, S_LOW_BlushingMermaid_Vanra_bfeac6a6-678e-46da-b873-cf7e4c7a1e4c, _Var1, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND NOT
DB_PermaDefeated(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, _, _, _, _)
THEN
SetCombatGroupID(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, "");
SetFaction(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, ACT3_LOW_BlushingMermaid_Civilians_c0d4b9de-5884-41c1-aab8-1fbce6991129);
DB_NoLowAttitudeDialog(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
Unequip(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, S_LOW_BlushingMermaid_QuenorasHagMask_6eb1036e-017e-4cc2-8f65-1cc0cda601ad);
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_QuenoraIsSaved_2d5e3ae7-12b3-4dae-94c6-ec9acfceb61e);
PROC_RemoveAllDialogEntriesForSpeaker(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
DB_Dialogs(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, LOW_BlushingMermaid_Saved_QuenoraGrizly_ca2b1e05-b311-41ff-74f5-64a115742816);

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND NOT
DB_PermaDefeated(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
THEN
AddAttitudeTowardsPlayer(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, _Var3, 50);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_QuenoraIsSaved_2d5e3ae7-12b3-4dae-94c6-ec9acfceb61e, _, _, _, _)
AND
QRY_OnlyOnce("LOW_SavedQuenoraReturnsInPub_OnlyOnce", _, _, _, _)
THEN
TeleportTo(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, S_LOW_BlushingMermaid_QuenoraTeleportSpot_2244ed9b-e942-49f2-85aa-465f6defaef2);
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_State_SavedQuenoraBackInPub_ac5b3faf-1d38-4521-a1db-c81c70aead36);
PROC_RemoveAllDialogEntriesForSpeaker(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232);
DB_Dialogs(S_LOW_BlushingMermaid_QuenoraGrizly_9d475536-34f0-4a6f-9191-3a635b81a232, LOW_BlushingMermaid_QuenoraGrizly_4f9eea9b-d3e9-6eaf-5d26-8fef98f93105);

IF
FlagSet(LOW_BlushingMermaid_State_BosunGannetThanked_c3a3ab9e-d39c-26ff-10e7-be24a2bee92e, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
THEN
AddAttitudeTowardsPlayer(S_LOW_BlushingMermaid_BosunGannet_d6f07cae-779b-4f10-b87c-c8117bfa1fe9, _Var3, 50);

IF
DB_LOW_BlushingMermaidBasementEntranceIllusuion(S_LOW_BlushingMermaid_BasementEntraceIllusion_543ad91c-25c7-4036-b117-8822e89f54f2, _, _, _, _)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
THEN
DB_KnowledgeCheckTrigger("LOW_BlushingMermaid_BasementEntranceIllusion_Investigation", S_LOW_BlushingMermaid_BasementEntraceIllusion_Trigger_3856c014-2ab7-4d1e-99d3-f25237bff950, "Investigation", Act3_Medium_77cee1c4-384a-4217-b670-67db3c7add57);
PROC_SetOnStage(S_LOW_BlushingMermaid_BasementEntrace_NoHagWall_1e20d3ee-e3e6-46fb-af14-e6a8a4e66373, 0);
PROC_SetOnStage(S_LOW_BlushingMermaid_BasementEntraceIllusion_543ad91c-25c7-4036-b117-8822e89f54f2, 1);

IF
DB_LOW_BlushingMermaidBasementEntranceIllusuion(S_LOW_BlushingMermaid_BasementEntraceIllusion_543ad91c-25c7-4036-b117-8822e89f54f2, _, _, _, _)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
THEN
NOT DB_KnowledgeCheckTrigger("LOW_BlushingMermaid_BasementEntranceIllusion_Investigation", S_LOW_BlushingMermaid_BasementEntraceIllusion_Trigger_3856c014-2ab7-4d1e-99d3-f25237bff950, "Investigation", Act3_Medium_77cee1c4-384a-4217-b670-67db3c7add57);
PROC_SetOnStage(S_LOW_BlushingMermaid_BasementEntrace_NoHagWall_1e20d3ee-e3e6-46fb-af14-e6a8a4e66373, 1);
PROC_SetOnStage(S_LOW_BlushingMermaid_BasementEntraceIllusion_543ad91c-25c7-4036-b117-8822e89f54f2, 0);

PROC
PROC_GLO_KnowledgeCheckSuccess((CHARACTER)_Var1, "LOW_BlushingMermaid_BasementEntranceIllusion_Investigation", _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(GLO_PerceptionSuccess_48825dbe-a320-7c4c-fe3e-372b717d5bc9, _Var1);
ApplyStatus(S_LOW_BlushingMermaid_BasementEntraceIllusion_543ad91c-25c7-4036-b117-8822e89f54f2, "HAG_MASK_ILLUSION", -1);

IF
UseStarted(_, S_LOW_BlushingMermaid_BasementExitSecretDoor_Lever_1f1c1092-47a1-42f6-a04e-ef4b1b2bc60f, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
SetCanInteract(S_LOW_BlushingMermaid_BasementExitSecretDoor_Lever_1f1c1092-47a1-42f6-a04e-ef4b1b2bc60f, 0);
Open(S_LOW_BlushingMermaid_BasementExitSecretDoor_d4532c40-dc9d-4fe7-a956-f54655453133);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_BlushingMermaid_Patron_01_4e7b519f-3e47-45d7-b2d1-20001a522bfe, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_BlushingMermaid_Patron_09_da46cc19-8972-478a-b063-7f7a5f61ae93, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_BlushingMermaid_Patron_01_2f2a704c-f887-4285-b4d1-21950ab01e89, S_LOW_BlushingMermaid_Patron_01_4e7b519f-3e47-45d7-b2d1-20001a522bfe, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_BlushingMermaid_Patron_09_da46cc19-8972-478a-b063-7f7a5f61ae93, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_BlushingMermaid_Patron_01_4e7b519f-3e47-45d7-b2d1-20001a522bfe, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_BlushingMermaid_Patron_09_e135b723-9b0a-3c62-85c3-1cba9824f86d, S_LOW_BlushingMermaid_Patron_09_da46cc19-8972-478a-b063-7f7a5f61ae93, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_BlushingMermaid_Patron_12_b5c8b44e-c660-4a97-bbaf-8a0853a4c6c8, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_BlushingMermaid_Patron_13_0cd108a4-a496-4e90-8ee7-d09fe6bc0e47, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_BlushingMermaid_Patron_12_3cd5b4a4-a841-10b4-4fc9-45a6a6e8e2f2, S_LOW_BlushingMermaid_Patron_12_b5c8b44e-c660-4a97-bbaf-8a0853a4c6c8, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_LOW_BlushingMermaid_Patron_13_0cd108a4-a496-4e90-8ee7-d09fe6bc0e47, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_SpeakerIsAvailableAndInDialogRange(S_LOW_BlushingMermaid_Patron_12_b5c8b44e-c660-4a97-bbaf-8a0853a4c6c8, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(LOW_BlushingMermaid_Patron_13_42e6c49e-d583-42b1-1dcc-501617c15fef, S_LOW_BlushingMermaid_Patron_13_0cd108a4-a496-4e90-8ee7-d09fe6bc0e47, _Var1);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_BlushingMermaid_State_Patron_12_Left_27009b2b-39b4-4e4a-bdd8-fa518d6cfef7, _, _, _, _)
THEN
PROC_DisappearOutOfSight(S_LOW_BlushingMermaid_Patron_12_b5c8b44e-c660-4a97-bbaf-8a0853a4c6c8, "Run", 0, "");

IF
FlagSet(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, _, _, _, _)
AND
DB_QuestIsOpened("LOW_SaveHaggedChild", _, _, _, _)
AND
DB_QuestDef_State_ConditionalFlag(LOW_BlushingMermaid_State_AgreedToBringHeadToHag_c0a98ec4-171f-46c1-9a67-80140da3703e, "LOW_SaveHaggedChild", _Var3, _, _)
AND
QRY_QuestUpdateIsUnlockedForAny("LOW_SaveHaggedChild", _Var3, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRevealed_aa751f69-f448-1436-c243-eb9f06a060ca, _, _, _, _)
THEN
QuestUpdate("LOW_SaveHaggedChild", "EnteredEND_UnfinishedKillLora");

IF
FlagSet(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, _, _, _, _)
AND
DB_QuestIsOpened("LOW_SaveHaggedChild", _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _, _, _, _)
THEN
QuestUpdate("LOW_SaveHaggedChild", "EnteredEND_MadeHagDeal");

IF
FlagSet(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, _, _, _, _)
AND
DB_QuestIsOpened("LOW_SaveHaggedChild", _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _, _, _, _)
THEN
QuestUpdate("LOW_SaveHaggedChild", "EnteredEND_NoHagDeal");

IF
Resurrected(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, _, _, _)
AND
DB_LOW_LevelTeleportHagResurrecting(1, _, _, _, _)
THEN
NOT DB_LOW_LevelTeleportHagResurrecting(1);
ApplyStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", -1, 0);

IF
StatusApplied(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HAG_DISGUISE", _, _, _)
AND
HasActiveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "HAG_DISGUISE", 1, _, _)
THEN
RemoveStatus(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "HAG_DISGUISE");

IF
FlagSet(HAG_Hag_Event_HagEyed_2ac94597-a234-92c1-f777-aeeda4715594, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ApplyStatus(_Var1, "HAG_HAGEYED", -1, 1, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);
SetTag(_Var1, CANTLOSEEYE_b5de40c5-edec-43a7-a918-1d85c13232de);
SetTag(_Var1, HAGEYED_c1f7de2b-7cc5-41bc-a723-011172bbc4ba);

IF
DB_GlobalFlag(LOW_BlushingMermaid_Debug_HagCombat_4a25fd3c-2284-48aa-8805-52cb3883ea5d, _, _, _, _)
THEN
ClearFlag(LOW_BlushingMermaid_Debug_HagCombat_4a25fd3c-2284-48aa-8805-52cb3883ea5d);
SetFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720);
RealtimeObjectTimerLaunch(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCombatDebugTimer", 100);

IF
ObjectTimerFinished(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagCombatDebugTimer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_HagRetreatsToOrlop();
SetFlag(Debug_Teleport_LOW_BlushingMermaid_Basement_175bb4c2-23ad-4643-a46c-e92ce7af6198, _Var1);

IF
TextEvent("LOW_TestTitle", (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
GetTextEventParamString(1, _Var1, _Var1, _Var1, _Var1)
THEN
ObjectSetTitle(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _Var1);

IF
DB_LOW_Ethel(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0);

IF
StatusApplied((CHARACTER)_Var1, "HAG_MASK_HAGDEAD", (GUIDSTRING)_Var2, (INTEGER)_Var3, (CHARACTER)_Var1)
AND
DB_HAG_MaskedVictims(_Var1, _, _, _, _Var1)
THEN
RemoveStatus(_Var1, "HAG_MASK_HAGDEAD");

IF
RelationChanged(GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0, Hero_a1542c81-6895-929e-4522-10ce218bb360, 50, 1, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
THEN
PROC_SetRelationToPlayers(GLO_HagMaskedVictims_208ebac7-6954-4087-802f-6145cce161c0, 0);

IF
FlagSet(LOW_BlushingMermaid_Debug_HagTrullyDead_VanraAlive_55f0df47-4274-4b30-abfc-c7d9a05e0a6b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_DebugTrullyKillHagSetup();

IF
FlagSet(LOW_BlushingMermaid_Debug_HagTrullyDead_VanraDead_c7349d11-37c9-4f06-b4a7-926e30bb7763, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_LOW_DebugTrullyKillHagSetup();

PROC
PROC_LOW_DebugTrullyKillHagSetup()
THEN
DB_LOW_DebugTrullyKillHag(1);
SetFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720);
RealtimeObjectTimerLaunch(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagTrullyDeadDebugTimer", 500);

IF
ObjectTimerFinished(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagTrullyDeadDebugTimer", _, _, _)
THEN
PROC_LOW_HagRetreatsToOrlop();

IF
EntityEvent(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, "LOW_HagTeleportedToCellar", _, _, _)
AND
DB_LOW_DebugTrullyKillHag(1, _, _, _, _)
THEN
PROC_LOW_DebugKillHagShrooms();

PROC
PROC_LOW_DebugKillHagShrooms()
AND
DB_GLO_DefeatCounter(_Var1, "LOW_HagResurrectionShrooms_PermaDefeated", _Var1, _Var1, _Var1)
THEN
Die(_Var1);
SetFlag(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33);

IF
FlagSet(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_Debug_HagTrullyDead_VanraAlive_55f0df47-4274-4b30-abfc-c7d9a05e0a6b, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_BlushingMermaid_Event_TeleportVanraToHag_161c3a43-f4ba-4aa5-aabe-d68a68b011c8);

IF
EntityEvent(_, "LOW_VanraSavedTeleport", _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_Debug_HagTrullyDead_VanraAlive_55f0df47-4274-4b30-abfc-c7d9a05e0a6b, _, _, _, _)
THEN
Die(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0, 1);

IF
FlagSet(LOW_BlushingMermaid_State_AllHagShroomsDefeated_20d9c78c-6f9d-4de8-8ee1-cdc13206ae33, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_Debug_HagTrullyDead_VanraDead_c7349d11-37c9-4f06-b4a7-926e30bb7763, _, _, _, _)
THEN
PROC_LOW_HagKilled_SpawnDeadVanra();

IF
EnteredLevel(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, _, "CTY_Main_A", _, _)
AND
CanJoinCombat(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 0, _, _, _)
THEN
SetCanJoinCombat(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1);
PROC_CharacterEnableAllCrimes(S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3b"
