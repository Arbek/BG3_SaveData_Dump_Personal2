Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_GLO_CharacterCorpseDialog(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, HAV_Isobel_Dead_20dadd7f-e5cb-1e5d-f3d7-fe021892ea01);
DB_DeadEvent(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, HAV_Isobel_State_IsDead_af8b23d8-d04d-4e42-8a56-be909226e706);
DB_PreventKnockedOutPermaDefeated(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom");
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", 1000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Capture", 2000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_FollowUp_Protection", 3000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_PostFollowUpProtection", 4000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_FollowUp_Capture", 6000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_DefeatedInHaven", 7000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_AtMoonrise", 8000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_KethericShowdown", 9000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Trials", 10000);
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_Init");
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_Init", 0);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_SpyReady", 1000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_Confrontation", 4000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_SideWithIsobel", 5000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_SideWithSpy", 6000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "CombatEnd_Protected", 7000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "Tasked_PersuadingIsobel", 8000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "Tasked_IsobelPersuaded", 9000);
DB_State_Flags(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "Tasked_IsobelPersuaded", HAV_TakingIsobel_State_IsobelIsPreparingToGoToMT_610216db-cc3a-4d7e-867d-a3f66943aaaa);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "Tasked_PlayerCombat", 10000);
DB_State_Priority(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "Capture_Finished", 12000);
DB_State_Flags(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", HAV_TakingIsobel_State_Brief_InRoom_09b77182-7096-46d4-a099-73e50a2b46e6);
DB_State_Flags(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_NightsongReunion", HAV_Isobel_State_InNightsongReunion_30321075-74e9-4f08-8c31-3f5f85feabee);
DB_State_Flags(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_FollowUp_Capture", MOO_Isobel_State_AtMoonrise_a95b7f8f-1454-433f-a496-71c9306683ce);
DB_State_Flags(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_AtMoonrise", MOO_Isobel_State_AtMoonrise_a95b7f8f-1454-433f-a496-71c9306683ce);
DB_State_Flags(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_KethericShowdown", MOO_Isobel_State_AtMoonrise_a95b7f8f-1454-433f-a496-71c9306683ce);
SetHasDialog(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 1);
TriggerRegisterForCharacter(S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
TriggerRegisterForCharacter(S_HAV_IsobelPrayerBox_db9e0476-91a4-46bb-82d7-c67a1dbe9b93, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_GLO_Cinematic_PositionedDialog(HAV_TakingIsobel_JaheiraCallToArm_115de2ed-8330-d5f0-2c34-c32a673a5d1b, "HAV_CallToArm");
DB_GLO_Cinematic_PositionFlags("HAV_CallToArm", S_HAV_LakeShoreBox_76a66863-e8ae-45b5-83b8-428561b186de, HAV_TakingIsobel_Event_CallToArmAtLake_3ea0548b-cb0b-4e7e-a2f3-80d45ee90d45);
DB_IgnoreMutingStatussesDialog(HAV_TakingIsobel_JaheiraCallToArm_115de2ed-8330-d5f0-2c34-c32a673a5d1b);
DB_AddCharactersInTriggerToDialog(HAV_TakingIsobel_JaheiraCallToArm_115de2ed-8330-d5f0-2c34-c32a673a5d1b, S_HAV_Haven_SUB_6ac001f4-9c56-4a1b-963d-a509e158ffab, 1, 1);
DB_HAV_TakingIsobel_IsobelGuards(S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, S_HAV_IsobelGuardPoint_a0ff52f4-53b9-48dd-ad67-4326a65bd939);
DB_HAV_TakingIsobel_IsobelGuards(S_HAV_HarperGuard_002_34a9bfd8-1ca2-4a1c-b72e-2bf1cfc046a4, S_HAV_IsobelGuardPoint2_4bd40020-5d87-4e0f-b551-ddbfb1f369f7);
DB_HAV_TakingIsobel_FlyingGhouls(S_HAV_FlyingGhoul_000_62dd0ebd-8325-4b76-ba41-99fbee98149a);
DB_HAV_TakingIsobel_FlyingGhouls(S_HAV_FlyingGhoul_001_48026cfd-acc4-42dd-a9e3-583cac5f7a34);
DB_HAV_TakingIsobel_FlyingGhouls(S_HAV_FlyingGhoul_002_c43490d5-4d8c-4986-8b1e-6bcf4325cb0d);
DB_HAV_TakingIsobel_FlyingGhouls(S_HAV_FlyingGhoul_003_317ba5c6-eda5-4e7a-a288-443c25fd2525);
DB_HAV_TakingIsobel_FlyingGhouls(S_HAV_FlyingGhoul_004_e63f73e4-2ea1-45cc-b54e-56355b700a9d);
DB_HAV_TakingIsobel_FlyingGhouls(S_HAV_FlyingGhoul_005_db61112a-dbc9-4f0e-9e6f-332a09f3b35a);
DB_DialogBlockAttackButton(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985);
DB_DialogBlockTradeButton(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985);
DB_DialogBlockAttackButton(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5);
DB_DialogBlockTradeButton(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5);
SetOnStage(S_HAV_TaxiGhoul_3ebef8c7-2733-42aa-9757-84fdeadbe652, 0);
SetFlag(HAV_TakingIsobel_State_SpyIsAvailable_96dd328c-15f7-45ab-bc41-a13aa38ac2a3);
DB_Inclusion_Object(S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, HAV_HarperGuard_001_Inclusion_Start_97e01964-a56e-5f96-db72-91bc65a67b5f, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_NPCDialog(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f);
DB_SpotPlayers(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse", S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f);
PROC_SpotPlayers_StopSpotting(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse");
PROC_TriggerRegisterForPlayers(S_HAV_SpyPlayerInBox_edb52dcc-651b-46c5-afd0-e6f3de7beba2);
DB_HAV_TakingIsobel_Abductees(S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925, S_HAV_TakingIsobel_InnAttackBox_NPCs_6efdcf8d-83c8-4c78-98e2-3c09a1b6dcf7);
DB_HAV_TakingIsobel_Abductees(S_HAV_FlamingFist_005_0e691c0a-562b-43bb-8554-cde1194decd5, S_HAV_Haven_SUB_6ac001f4-9c56-4a1b-963d-a509e158ffab);
DB_HAV_TakingIsobel_Abductees(S_HAV_FlamingFist_003_128c0f54-fea0-49df-89ca-c2ca8d996a31, S_HAV_Haven_SUB_6ac001f4-9c56-4a1b-963d-a509e158ffab);
DB_HAV_TakingIsobel_Abductees(S_HAV_FlamingFist_004_eb083eb6-066c-4693-8fb8-575bc4c71373, S_HAV_Haven_SUB_6ac001f4-9c56-4a1b-963d-a509e158ffab);
DB_HAV_TakingIsobel_Abductees(S_HAV_FlamingFist_006_9629c27e-8e50-4258-8bda-6639af768ba6, S_HAV_Haven_SUB_6ac001f4-9c56-4a1b-963d-a509e158ffab);
DB_HAV_TakingIsobel_Abductees(S_HAV_FlamingFist_002_39ace2b4-699d-468c-a664-8a06492d997a, S_HAV_Haven_SUB_6ac001f4-9c56-4a1b-963d-a509e158ffab);
DB_Inclusion_CombatInclusionDialog(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985);

KBSECTION
IF
TextEvent("sendjaheiratoisobel", _, _, _, _)
THEN
PROC_HAV_TakingIsobel_FollowUpCleanup();

IF
TextEvent("spycapture", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Debug_HAV_KidnapIsobel(_Var1, 0);

IF
TextEvent("nightsongtohav", _, _, _, _)
THEN
PROC_State_Progress(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_CaptureReady");
PROC_State_Progress(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_LakeToRoomTransition");
SetFlag(HAV_EnteringHaven_State_GainedAccess_07c776da-353a-9050-e9be-c42d51a99412);
PROC_HAV_EnteringHaven_Admitted();
TeleportTo(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, S_HAV_NightsongFollowup_NightsongPos_Room_fec9a316-3db9-4918-a3c2-6d00b8f29ce9);
TeleportTo(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelPrayerPoint_ad61fb61-370f-4b1b-a40e-85ba0f1f1a8f);
PROC_State_Progress(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, "SHA_Nightsong", "SHA_State_Nightsong_AtInn");
PROC_State_Progress(S_HAV_Haven_SUB_6ac001f4-9c56-4a1b-963d-a509e158ffab, "HAV_NightsongFollowup_Reunite", "HAV_State_NightsongFollowup_Reunite_Done");
SetOnStage(S_GLO_Nightsong_6c55edb0-901b-4ba4-b9e8-3475a8392d9b, 1);

PROC
PROC_Debug_HAV_KidnapIsobel((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_HAV_EnteringHaven_Admitted();
PROC_GlobalSetFlagAndCache(HAV_EnteringHaven_State_WasVouchedFor_49b15dc5-9283-0937-4d7e-e66f3d8d5a11);
PROC_GlobalSetFlagAndCache(HAV_EnteringHaven_State_FlamingSpyVouch_f3850740-f19b-44c0-a018-00fa00e87b31);
TeleportTo(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_SpyInPoint_546e38ea-db44-4b12-bbb7-d486dca08124);
PROC_State_Progress(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_DefaultBehaviour");
PROC_GlobalSetFlagAndCache(HAV_EnteringHaven_State_GainedAccess_07c776da-353a-9050-e9be-c42d51a99412);
TeleportTo(_Var1, S_HAV_TakingIsobel_PlayerRoomPoint_69c575a0-b9d2-4d78-b3d6-6ce89b9ed48a);

PROC
PROC_Debug_HAV_KidnapIsobel((GUIDSTRING)_Var1, 0, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFaction(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, Act2_HAV_FlamingSpy_Hostile_caa2c8a9-67d2-479b-91ad-f460e66cfd9b);

PROC
PROC_Debug_HAV_KidnapIsobel((GUIDSTRING)_Var1, 1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFaction(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, Act2_HAV_FlamingSpy_Ally_e3da5c3f-056c-4391-83c9-7a78b0703856);

PROC
PROC_StateSet_PermaDefeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _, _, _, _)
AND
HasActiveStatus(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_ISOBEL_MOONRITUAL", 1, _, _)
THEN
SetFlag(HAV_TakingIsobel_Event_IsobelToRoom_d1f2df3a-ba92-5599-0b19-b0d9da9c0f5c, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_HAV_TakingIsobel_CheckForMarcusInRoom();

IF
DialogStarted(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, _, _, _, _)
AND
HasActiveStatus(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_ISOBEL_MOONRITUAL", 1, _, _)
THEN
PROC_HAV_Isobel_FinishRitual();

IF
FlagSet(HAV_TakingIsobel_Event_IsobelToRoom_d1f2df3a-ba92-5599-0b19-b0d9da9c0f5c, NULL_00000000-0000-0000-0000-000000000000, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 != 0
AND
DB_DialogPlayers(_Var2, _Var3, 1, _Var1, _Var1)
AND
IsMovementBlocked(_Var3, 0, _Var1, _Var1, _Var1)
THEN
CharacterMoveTo(_Var3, S_HAV_TakingIsobel_PlayerRoomPoint_69c575a0-b9d2-4d78-b3d6-6ce89b9ed48a, "Stroll", "");

IF
FlagSet(HAV_TakingIsobel_Event_IsobelToRoom_d1f2df3a-ba92-5599-0b19-b0d9da9c0f5c, NULL_00000000-0000-0000-0000-000000000000, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 != 0
AND
IsMovementBlocked(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 0, _Var1, _Var1, _Var1)
THEN
CharacterMoveTo(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_TakingIsobel_IsobelRoomPoint_fec9a316-3db9-4918-a3c2-6d00b8f29ce9, "Stroll", "");

IF
DialogEnded(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
PurgeOsirisQueue(_Var2, 1);
PurgeOsirisQueue(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 1);

IF
FlagSet(MOO_FirstFloor_DukeDouble_Quest_Accepted_10d8d681-e2a3-c472-e7d9-08718f2eaea2, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND NOT
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_ReadyForCheckpoint", _, _)
THEN
PROC_State_Progress(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_LeavingCheckpoint");

IF
EntityEvent(_, "HAV_FlamingSpy_GotToRoof", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_State_Progress(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_CaptureReady");

PROC
PROC_State_Changed(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_CaptureReady", _, _)
THEN
PROC_HAV_TakingIsobel_SetSpyOnStage(0);
TeleportTo(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_SpyTransfoVBBox_d3e2f7f5-3ae0-4269-aa4e-cac02e15f207);
PROC_ForceStopDialog(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6);
PROC_State_Progress(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_SpyReady");

IF
DB_HAV_TakingIsobel_FlyingGhouls(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
VoiceBarkEnded(HAV_TakingIsobel_VB_SpyTransformationClue_c0c6519e-477a-c5d4-de8b-30077def7b72, _, _, _, _)
AND NOT
DB_CantTalk(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, _, _, _)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, 1, _, _)
THEN
PROC_TryStartAD(HAV_TakingIsobel_AD_ReactingToRoofNoise_353e1ef0-2546-4ca1-7bef-e3101483d54a, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);

PROC
PROC_HAV_TakingIsobel_TrySendingGuardToIsobel()
AND
DB_HAV_TakingIsobel_IsobelGuards(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, _Var2, "Run", "");
SetFlag(HAV_TakingIsobel_Event_HarperGuardIsobel_7316cac0-c33c-4bb7-94b4-62c7eb10de86);

QRY
QRY_Inclusion_SpeakerIsAvailableForInclusion(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _, S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, _, _)
AND
QRY_SpeakerIsAvailable(S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, 1, _, _, _)
AND
IsInTrigger(S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, 1, _, _)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, 1, _, _)
THEN
DB_NOOP(1);

QRY
QRY_Inclusion_SpeakerIsAvailableForInclusion(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _, S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, _, _)
AND
QRY_SpeakerIsAvailable(S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, 1, _, _, _)
AND
IsInTrigger(S_HAV_HarperGuard_001_8082f1d4-8942-492e-8d26-1e1ed6bd881f, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, 1, _, _)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelPrayerBox_db9e0476-91a4-46bb-82d7-c67a1dbe9b93, 1, _, _)
THEN
DB_NOOP(1);

IF
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _, _, _, _)
AND
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
PROC_RemoveNPCADs(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
DB_Dialogs(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, NULL_00000000-0000-0000-0000-000000000000, HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_DefaultBehaviour", _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAV_TakingIsobel_State_IsobelInRoom_cff275db-2618-fac2-581e-051aca727131, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
IsInTrigger(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, 1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_CharacterIsHidden(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND NOT
QRY_State_IsBeforeState(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_IsobelRoomEntrance", _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, 1, _Var1, _Var1)
AND NOT
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_FlamingSpy_18b84cde-f3e1-5119-4ce3-3ba3dd0354c5, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND NOT
QRY_State_IsBeforeState(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_IsobelRoomEntrance", _Var1, _Var1)
AND NOT
DB_CantTalk(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1)
AND NOT
DB_SelectedDialog(HAV_TakingIsobel_FlamingSpy_18b84cde-f3e1-5119-4ce3-3ba3dd0354c5, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_AD_SpyWaiting_48c75193-2a89-1066-bbff-7de456bb5c56, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_IsobelRoomEntrance", _, _)
THEN
DB_SelectedDialog(HAV_Marcus_DismissesHalsin_dcfcdb8f-aabc-bd64-8874-bbebc7b75b3c, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAV_TakingIsobel_Event_SpyDefeatedInRoomOnArrival_3409e8d7-7352-491c-9d93-e15b4f2bfce6, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, 1, _Var1, _Var1)
AND
IsInTrigger(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, 1, _Var1, _Var1)
THEN
SetFlag(HAV_TakingIsobel_Event_SpyIsDefeatedInRoom_719e4639-839b-4975-9301-75c4f3189c48, NULL_00000000-0000-0000-0000-000000000000, 0);
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, NULL_00000000-0000-0000-0000-000000000000, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, NULL_00000000-0000-0000-0000-000000000000, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND
QRY_State_IsBeforeState(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_DefaultBehaviour", _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_AD_BeforeFlamingSpy_30f5dd95-edc2-04e7-52be-9a2bcc22e7a7, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_CaptureReady", _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
QRY_SpeakerIsAvailable(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_CaptureReady", _Var1, _Var1)
AND NOT
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, NULL_00000000-0000-0000-0000-000000000000, _Var1);

QRY
QRY_SpeakerIsAvailable(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _, _, _, _)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_CaptureReady", _, _)
AND NOT
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_DefaultBehaviour", _Var1, _Var1)
AND NOT
DB_CantTalk(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_CharacterIsHidden(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, _Var1, _Var1, _Var1, _Var1)
AND
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", _Var1, _Var1)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_DefaultBehaviour", _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND NOT
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, NULL_00000000-0000-0000-0000-000000000000, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _)
AND
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", _, _)
THEN
DB_SelectedDialog(HAV_Isobel_DismissesHalsin_64a46176-d87f-8f97-3e4c-f6ca77942b85, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
DB_GlobalFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(HAV_Isobel_4a5bc7ea-4009-0de3-4ab7-da5bd379979e, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, NULL_00000000-0000-0000-0000-000000000000, _Var1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_HAV_IsobelBalconyDoor_33b6ec88-e2ed-4074-af35-76aaaf66f113, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_IsobelRoomEntrance", _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
DB_InRegion(_Var1, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, _Var1, _Var1, _Var1)
AND
IsClosed(S_HAV_IsobelBalconyDoor_33b6ec88-e2ed-4074-af35-76aaaf66f113, 1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(HAV_TakingIsobel_FlamingSpy_18b84cde-f3e1-5119-4ce3-3ba3dd0354c5, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, S_HAV_IsobelBalconyDoor_33b6ec88-e2ed-4074-af35-76aaaf66f113, 1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_HAV_IsobelBalconyDoor_33b6ec88-e2ed-4074-af35-76aaaf66f113, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_DefaultBehaviour", _Var1, _Var1)
AND
DB_State_Current(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_IsobelToRoom_d1f2df3a-ba92-5599-0b19-b0d9da9c0f5c, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelPrayerBox_db9e0476-91a4-46bb-82d7-c67a1dbe9b93, 1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323
AND
DB_InRegion(_Var1, S_HAV_IsobelRoom_SUB_4310edec-0ce2-4ac0-adbd-c02d60b92c3d, _Var1, _Var1, _Var1)
AND
IsClosed(S_HAV_IsobelBalconyDoor_33b6ec88-e2ed-4074-af35-76aaaf66f113, 1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, S_HAV_IsobelBalconyDoor_33b6ec88-e2ed-4074-af35-76aaaf66f113, 1);

IF
EnteredTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(HAV_TakingIsobel_State_IsobelInRoom_cff275db-2618-fac2-581e-051aca727131);

IF
LeftTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(HAV_TakingIsobel_State_IsobelInRoom_cff275db-2618-fac2-581e-051aca727131);

IF
EnteredTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, _, _, _)
THEN
SetHasDialog(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 1);

IF
LeftTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, _, _, _)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelPrayerBox_db9e0476-91a4-46bb-82d7-c67a1dbe9b93, 0, _, _)
THEN
SetHasDialog(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 0);

IF
EnteredTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelPrayerBox_db9e0476-91a4-46bb-82d7-c67a1dbe9b93, _, _, _)
THEN
SetHasDialog(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 1);

IF
LeftTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelPrayerBox_db9e0476-91a4-46bb-82d7-c67a1dbe9b93, _, _, _)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, 0, _, _)
THEN
SetHasDialog(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 0);

PROC
PROC_DialogFlagSetup(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, _, _, _, _)
AND NOT
QRY_HAV_TakingIsobel_IsInPrayer()
THEN
ClearFlag(HAV_TakingIsobel_State_IsobelInPrayer_15a12857-854c-931a-94fe-ae3edf47edcd, NULL_00000000-0000-0000-0000-000000000000, 0);

QRY
QRY_HAV_TakingIsobel_IsInPrayer()
AND NOT
DB_GlobalFlag(HAV_TakingIsobel_Event_IsobelToRoom_d1f2df3a-ba92-5599-0b19-b0d9da9c0f5c, _, _, _, _)
AND
IsInTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_IsobelPrayerBox_db9e0476-91a4-46bb-82d7-c67a1dbe9b93, 1, _, _)
THEN
SetFlag(HAV_TakingIsobel_State_IsobelInPrayer_15a12857-854c-931a-94fe-ae3edf47edcd, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_HAV_TakingIsobel_CheckForMarcusInRoom()
AND
IsInTrigger(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_IsobelRoomFollowUpBox_Room_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, 1, _, _)
AND
DB_PermaDefeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _, _, _, _)
AND NOT
DB_GlobalFlag(HAV_EnteringHaven_State_FlamingSpyRevealed_89e1eb87-a718-8dc2-026d-f4db8321b686, _, _, _, _)
THEN
SetFlag(HAV_TakingIsobel_Event_SpyDefeatedInRoomOnArrival_3409e8d7-7352-491c-9d93-e15b4f2bfce6, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
TriggerRegisterForCharacter(S_HAV_DefeatedSpyReactionBox_91ff47ef-4c54-486f-b440-530373587845, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
TeleportTo(S_HAV_DefeatedSpyReactionBox_91ff47ef-4c54-486f-b440-530373587845, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6);

IF
EnteredTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_DefeatedSpyReactionBox_91ff47ef-4c54-486f-b440-530373587845, _, _, _)
AND
IsInTrigger(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_IsobelRoomFollowUpBox_Room_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f, 1, _, _)
AND
IsInTrigger(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_DefeatedSpyReactionBox_91ff47ef-4c54-486f-b440-530373587845, 1, _, _)
THEN
TriggerUnregisterForCharacter(S_HAV_DefeatedSpyReactionBox_91ff47ef-4c54-486f-b440-530373587845, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
PROC_TryStartAD(HAV_Isobel_AD_AtSpyCorpse_18f57fc3-844a-f19b-b13c-3276b195416e, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
PROC_SpotPlayers_RestartSpotting(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse");

PROC
PROC_SpotPlayers_Spotted(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialog(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1)
THEN
SetFlag(HAV_TakingIsobel_Event_SpyIsDefeatedInRoom_719e4639-839b-4975-9301-75c4f3189c48, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_DialogFlagSetup(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, (GUIDSTRING)_Var2, (GUIDSTRING)_)
THEN
PROC_SpotPlayers_StopSpotting(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse");

IF
FlagSet(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, NULL_00000000-0000-0000-0000-000000000000, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogName(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
DB_HAV_SpyCapture_PrioPlayer(_Var2);

IF
DB_HAV_TakingIsobel_Abductees(_Var1, _, _Var1, _Var1, _Var1)
THEN
DB_Inclusion_NPCDialog(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _Var1);
DB_Inclusion_Object(_Var1, HAV_TakingIsobel_Event_IncludeAbductees_c733d143-c4f5-da26-7019-3acbf48c4f55, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_StartDialog_AddExtraSpeakers(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogRequestCache_SpeakerList_Speakers(_Var2, _Var1, _Var3, 1, _Var1)
AND
QRY_OnlyOnce_Reset("HAV_TakingIsobel_IncludeAbductee1", _Var1, _Var1, _Var1, _Var1)
AND
DB_HAV_TakingIsobel_Abductees(_Var4, _, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("HAV_TakingIsobel_IncludeAbductee1", _Var1, _Var1, _Var1, _Var1)
AND
_Var4 != S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925
AND NOT
DB_ObjectInclusion(_, _Var4, _Var1, _Var1, _Var1)
AND
QRY_Inclusion_SpeakerIsAvailableForInclusion(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _Var1, _Var4, _Var3, _Var1)
THEN
DB_OnlyOnce("HAV_TakingIsobel_IncludeAbductee1");
PROC_DialogAddSpeakingActorAt(_Var1, _Var4, 9);
DB_ObjectInclusion(_Var1, _Var4);
DB_ObjectIsDialogSoftLocked(_Var1, _Var4);

PROC
PROC_StartDialog_AddExtraSpeakers(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogRequestCache_SpeakerList_Speakers(_Var2, _Var1, _Var3, 1, _Var1)
AND
QRY_OnlyOnce_Reset("HAV_TakingIsobel_IncludeAbductee2", _Var1, _Var1, _Var1, _Var1)
AND
DB_HAV_TakingIsobel_Abductees(_Var4, _, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("HAV_TakingIsobel_IncludeAbductee2", _Var1, _Var1, _Var1, _Var1)
AND
_Var4 != S_DEN_ThiefHideoutLeader_c8ab1ca6-96bb-467e-91c9-af87bc4d3925
AND
_Var4 != S_HAV_FlamingFist_005_0e691c0a-562b-43bb-8554-cde1194decd5
AND NOT
DB_ObjectInclusion(_, _Var4, _Var1, _Var1, _Var1)
AND
QRY_Inclusion_SpeakerIsAvailableForInclusion(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _Var1, _Var4, _Var3, _Var1)
THEN
DB_OnlyOnce("HAV_TakingIsobel_IncludeAbductee2");
PROC_DialogAddSpeakingActorAt(_Var1, _Var4, 10);
DB_ObjectInclusion(_Var1, _Var4);
DB_ObjectIsDialogSoftLocked(_Var1, _Var4);

PROC
PROC_StartDialog_AddExtraSpeakers(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
DB_HAV_TakingIsobel_GhoulsDialogue(_Var1);
PROC_DialogAddSpeakingActorAt(_Var1, S_HAV_FlyingGhoul_000_62dd0ebd-8325-4b76-ba41-99fbee98149a, 6);
PROC_DialogAddSpeakingActorAt(_Var1, S_HAV_FlyingGhoul_001_48026cfd-acc4-42dd-a9e3-583cac5f7a34, 7);
PROC_DialogAddSpeakingActorAt(_Var1, S_HAV_FlyingGhoul_002_c43490d5-4d8c-4986-8b1e-6bcf4325cb0d, 8);

QRY
QRY_SpeakerIsAvailable((CHARACTER)_Var1, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAV_TakingIsobel_FlyingGhouls(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_HAV_TakingIsobel_GhoulsDialogue(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
DialogStarted(_, (INTEGER)_Var2, _, _, _)
AND
DB_HAV_TakingIsobel_GhoulsDialogue(_Var2, _, _, _, _)
THEN
NOT DB_HAV_TakingIsobel_GhoulsDialogue(_Var2);

IF
DialogRequestFailed(_, (INTEGER)_Var2, _, _, _)
AND
DB_HAV_TakingIsobel_GhoulsDialogue(_Var2, _, _, _, _)
THEN
NOT DB_HAV_TakingIsobel_GhoulsDialogue(_Var2);

IF
DialogEnded(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
GetFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
THEN
PROC_HAV_TakingIsobel_TryStartCapture(_Var1);

IF
DialogEnded(HAV_Isobel_4a5bc7ea-4009-0de3-4ab7-da5bd379979e, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_HAV_TakingIsobel_TryStartCapture(0);

PROC
PROC_HAV_FlamingSpy_CaptureFailedToStart((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_HAV_TakingIsobel_ClearFadeFor(_Var1);

PROC
PROC_HAV_FlamingSpy_CaptureFailedToStart(_, _, _, _, _)
AND
DB_State_Current(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, "HAV_FlamingSpy", "Spy_CaptureReady", _, _)
THEN
PROC_State_Progress(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_FollowUp_Protection");
GoalCompleted;

PROC
PROC_HAV_FlamingSpy_CaptureFailedToStart(_, _, _, _, _)
AND
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _, _, _, _)
THEN
PROC_State_Progress(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_FollowUp_Protection");
GoalCompleted;

PROC
PROC_HAV_TakingIsobel_ClearFadeFor((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
THEN
PROC_ClearScreenFadeTimeline(_Var2, 0.5);

PROC
PROC_HAV_TakingIsobel_TryStartCapture((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
QRY_HAV_TakingIsobel_FlamingSpyOutOfPosition(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_HAV_TakingIsobel_StartWithPrio()
AND NOT
QRY_HAV_TakingIsobel_StartWithAny(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_HAV_FlamingSpy_CaptureFailedToStart(_Var1);

QRY
QRY_HAV_TakingIsobel_StartWithPrio()
AND
DB_HAV_SpyCapture_PrioPlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_HAV_TakingIsobel_StartSpyCapture(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_HAV_TakingIsobel_StartWithAny((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, S_HAV_SpyPlayerInBox_edb52dcc-651b-46c5-afd0-e6f3de7beba2, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantMove(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_State_IsBeforeState(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_TakingIsobel_Capture", "SpyCombat_Confrontation", _Var1, _Var1)
AND
QRY_HAV_TakingIsobel_StartSpyCapture(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_HAV_TakingIsobel_ClearFadeFor(_Var1);

QRY
QRY_HAV_TakingIsobel_FlamingSpyOutOfPosition((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
IsInTrigger(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, S_HAV_SpyPlayerInBox_edb52dcc-651b-46c5-afd0-e6f3de7beba2, 0, _Var1, _Var1)
AND
IsOnStage(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, 1, _Var1, _Var1, _Var1)
THEN
PROC_HAV_FlamingSpy_CaptureFailedToStart(_Var1);

QRY
QRY_HAV_TakingIsobel_StartSpyCapture((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_StartDialogCustom(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, 0, 0, 0, 0, _Var1, _Var1)
THEN
PROC_State_IfCurrentProgress(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", "HAV_Isobel_State_Capture");
GoalCompleted;

IF
DialogEnded(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, _, _, _, _)
AND
GetFlag(HAV_TakingIsobel_Event_ContinueFromBriefInRoom_a8a061d3-2661-1910-788b-b0ba4d37d4a3, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
AND
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _, _, _, _)
THEN
PROC_State_IfCurrentProgress(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", "HAV_Isobel_State_FollowUp_Protection");

IF
DB_GlobalFlag(HAV_TakingIsobel_State_SidedWithSpy_5eb745b2-5043-2f36-4d3a-ee3f09ed7a82, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogName(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogSpeakers(_Var1, _Var2, _, _Var1, _Var1)
AND
DB_HAV_TakingIsobel_IsobelGuards(_Var2, _, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(Act2_HAV_Haven_e52bfc8c-7826-470d-a9f5-f6fae80dde82, 0);
SetFlag(HAV_General_State_IsHostileToPlayers_3cd1e3a7-6a9a-6558-a9f2-8db69824869b, NULL_00000000-0000-0000-0000-000000000000, 0);
NOT DB_HAV_TakingIsobel_JaheiraCallsToArm(1);

QRY
QRY_SpeakerIsAvailableForDialogSlot(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, 2, (INTEGER)_Var1, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211)
AND NOT
DB_Defeated(S_HAV_FlamingSpy_acb1dd9e-952b-4281-8e30-ec6f671493a6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_DialogFlagSetup(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, (GUIDSTRING)_Var2, (GUIDSTRING)_)
THEN
PROC_State_IfCurrentProgress(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_Isobel", "HAV_Isobel_State_Brief_InRoom", "HAV_Isobel_State_Capture");

QRY
QRY_SpeakerIsInDialogRange((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_HAV_TakingIsobel_Abductees(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_DialogRequestCache_SpeakerList_Players(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _, _Var2, _, _Var1)
AND
IsInTrigger(_Var1, _Var3, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_SpeakerIsInDialogRange((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HAV_TakingIsobel_Abductees(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_DialogRequestCache_SpeakerList_NPCs(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, _, _Var2, _, _Var1)
AND
IsInTrigger(_Var1, _Var3, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_StateSet_Defeated(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, _, _, _, _)
THEN
GoalCompleted;

PROC
PROC_SCE_SetupDebrief()
THEN
RemoveStatus(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_ISOBEL_MOONRITUAL", NULL_00000000-0000-0000-0000-000000000000);
GoalCompleted;

IF
FlagSet(HAV_TakingIsobel_Event_FastTransform_00abbf3d-060d-4b7c-a6ee-23cbfd5928fe, _, (INTEGER)_Var2, _, _)
AND NOT
DB_DialogName(HAV_TakingIsobel_BriefInRoom_22c23201-13a8-916c-932c-a7976bb1f5a5, _Var2, _, _, _)
THEN
SetFlag(HAV_TakingIsobel_Event_IsobelToRoom_d1f2df3a-ba92-5599-0b19-b0d9da9c0f5c, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
TextEvent("SCE_SetupNightsong_MoveToCamp", _, _, _, _)
THEN
GoalCompleted;

IF
DB_GlobalFlag(MOO_Assault_State_InProgress_0f3a8f5d-7402-4220-bebb-d4b21d3db08d, _, _, _, _)
THEN
RemoveStatus(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_ISOBEL_MOONRITUAL", NULL_00000000-0000-0000-0000-000000000000);
GoalCompleted;

IF
DialogStarted(HAV_TakingIsobel_SpyCapture_1b698557-76c0-1166-6415-91fadb358985, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
GoalCompleted;
PROC_HAV_TakingIsobel_SpyCaptureStarted(_Var1);


EXITSECTION
TriggerUnregisterForCharacter(S_HAV_DefeatedSpyReactionBox_91ff47ef-4c54-486f-b440-530373587845, S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
PROC_RemoveNPCADs(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211);
PROC_SpotPlayers_StopSpotting(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse");
NOT DB_SpotPlayers(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_SpotPlayers_SpotTrigger(S_GLO_Isobel_263bfbfc-6160-46f4-a9e1-1089cdb5c211, "HAV_MarcusCorpse", S_HAV_IsobelRoomFollowUpBox_1ddc9945-3187-4eee-a2f3-8e2c06e5c06f);
ENDEXITSECTION

ParentTargetEdge "Act2"
