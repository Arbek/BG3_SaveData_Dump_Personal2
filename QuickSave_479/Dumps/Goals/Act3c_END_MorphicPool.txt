Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialog_AddAllNearbyPlayersAtStart(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52);
DB_DropMutingStatussesDialog(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52);
DB_AddCharactersInTriggerToDialog(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52, S_END_MorphicPoolArrivalDialogBox_98e163e7-fc61-431a-8ad4-1e2ab698e064, 1, 1, 1);
PROC_TriggerRegisterForPlayers(S_END_MorphicPoolArrivalDialogBox_98e163e7-fc61-431a-8ad4-1e2ab698e064);
PROC_TriggerRegisterForPlayers(S_END_MorphicPartyBanterBox_7cf1a87e-5888-403c-9403-faaf8a4b9591);
SetOnStage(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 1);
DB_CrimeType_CustomWarning(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "Assault", END_MorphicPool_GortashAttacked_a67caad0-8543-7981-a1ef-08a001c0da6c);
DB_PermaDefeatedEvent(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769);
DB_END_General_EmperorADs(END_MorphicPool_EmperorAD_Arrival_08aee88a-f3e8-e953-60bf-bd3315b5599f);
DB_OneShotPlayerTrigger(S_END_NearNetherbrainPoolBox_49aa0cac-17aa-476d-8844-db78966ff698);
DB_GLO_CharacterCorpseDialog(S_END_DeadSmuggler_a50663a2-2bdf-4465-81ef-84958d498e91, END_MorphicPool_SWD_DeadSmuggler_5f00d5a3-7e20-edd6-11c9-ac255d3f2c27);
DB_HasItemEvent(S_END_DeadSmugglerSiblingToken_d95b9ad2-d8d3-4cd5-9ed4-818845836ccb, END_MorphicPool_State_HasDeadSmugglerToken_104abece-95d5-4d04-b2d0-f6f741718ce5);
DB_END_MorphicPool_LastDeadSmugglerTokenHolder(NULL_00000000-0000-0000-0000-000000000000);
DB_END_MorphicPool_BrainquakeTriggers(S_END_MindMeldADBox_001_f681ba90-79a5-4014-8495-59ec61266fb0, S_END_MorphicBrainQuakePoint_001_ccf3653c-9405-466a-98c9-6e71f8f26990, 1000, 1);
DB_END_MorphicPool_BrainquakeTriggers(S_END_MindMeldADBox_002_35cf71f4-12c8-43f1-b798-dd86d9ab43a0, S_END_MorphicBrainQuakePoint_002_d480e334-8da0-48e9-8638-2c28fa3ddbaf, 1000, 1);
DB_END_MorphicPool_BrainquakeTriggers(S_END_MindMeldADBox_003_a8b0d939-8604-4fcd-ad4a-f8f06cc3c5fd, S_END_MorphicBrainQuakePoint_003_79f45084-7b92-42bf-97e4-8bc850eebc4a, 1000, 1);
DB_END_MorphicPool_BrainquakeTriggers(S_END_MorphicBrainQuakeBox_001_2e4a8e36-056a-439b-b082-dc6604e7a414, S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, 500, 0.5);
DB_END_MorphicPool_BrainquakeTriggers(S_END_MorphicBrainQuakeBox_002_637bdaf6-e090-44cc-840a-d1c9a0b8b803, S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, 300, 0.5);
DB_END_MorphicPool_BrainQuakeStunTime(3);
DB_OneShotPlayerTrigger(S_END_MorphicBrainQuakeBox_001_2e4a8e36-056a-439b-b082-dc6604e7a414);
DB_OneShotPlayerTrigger(S_END_MorphicBrainQuakeBox_002_637bdaf6-e090-44cc-840a-d1c9a0b8b803);
DB_END_MorphicPool_MindMeldADTriggers(S_END_MindMeldADBox_001_f681ba90-79a5-4014-8495-59ec61266fb0);
DB_END_MorphicPool_MindMeldADTriggers(S_END_MindMeldADBox_002_35cf71f4-12c8-43f1-b798-dd86d9ab43a0);
DB_END_MorphicPool_MindMeldADTriggers(S_END_MindMeldADBox_003_a8b0d939-8604-4fcd-ad4a-f8f06cc3c5fd);
DB_OneShotPlayerTrigger(S_END_MindMeldADBox_001_f681ba90-79a5-4014-8495-59ec61266fb0);
DB_OneShotPlayerTrigger(S_END_MindMeldADBox_002_35cf71f4-12c8-43f1-b798-dd86d9ab43a0);
DB_OneShotPlayerTrigger(S_END_MindMeldADBox_003_a8b0d939-8604-4fcd-ad4a-f8f06cc3c5fd);
DB_END_MorphicPool_MindMeldTarget(NULL_00000000-0000-0000-0000-000000000000);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_001_51d9a5c5-5f12-4dfe-9fdf-a67cafb828c3, END_MorphicPool_AD_RadpidMindMeld_001_701dda11-0747-d5a1-dfa5-7b8e461f20fc);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_002_249ab374-3062-4779-8d33-e778c265951b, END_MorphicPool_AD_RadpidMindMeld_002_2d4adeba-2077-f261-ea1e-8e4034b4c086);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_003_656204d5-b5e4-48ac-b905-8c73b27ccae4, END_MorphicPool_AD_RadpidMindMeld_003_3d67e6e8-a497-ee85-953d-e40de5b61744);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_004_c6245802-72a4-483b-ba86-51f06aad0647, END_MorphicPool_AD_RadpidMindMeld_004_d27fc9c0-29eb-2649-83e8-c9b692654917);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_005_f5d143e6-abf4-41a4-b4fc-6e0cc4000856, END_MorphicPool_AD_RadpidMindMeld_005_e60f00ec-1f14-b811-87a5-76fc80c2d468);
DB_END_MorphicPool_RapidMindMeldADHelper(S_END_RapidMindMeldHelper_006_ffc5bec1-be4d-4f4b-88b6-02c6c6800b6d, END_MorphicPool_AD_RadpidMindMeld_006_4938202c-4606-87a3-12ff-1bc318516375);
DB_END_MorphicPool_AvailableRapidMindMeldADHelper(NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, 0);
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(-1);
PROC_TriggerRegisterForPlayers(S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);
DB_END_MorphicPool_ActiveRapidMindMeldAD(NULL_00000000-0000-0000-0000-000000000000);
DB_END_MorphicPool_ActiveRapidMindMeldStartTime(5000);
PROC_END_MorphicPool_SetMaxRapidMindMeldDistance();
PROC_TriggerRegisterForPlayers(S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b);
TriggerRegisterForCharacter(S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_001_2bd27e80-128d-426d-a1a7-11ace1b256fe);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_002_73d0452d-87ce-406c-b2d1-24c858b81ff9);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_003_bfbaf4ad-3d83-428b-a8cc-2b77311ff82d);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_004_72be384d-5c2e-41b5-a5be-9c59abca4cfd);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_005_408442a3-9347-4aba-b303-177be901b6b5);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_006_eceb1daf-5786-4bbd-bc40-b0931e7448fc);
DB_END_MorphicPool_ScurryIntDev(S_END_ScurryIntDev_007_aa5963eb-801d-4ef8-aef6-becd4886f0e8);
DB_AmbushTrigger(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, S_END_DetectIntDevAmbushSphere_3a8a657f-3b12-4b1b-ae9b-026d2c05571a, Act3_Hard_6298329e-255c-4826-9209-e911873b64e7);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_001_6ca2a617-1d3e-47eb-ab0a-40e5e098f4dc);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_002_8851683e-3f1b-48c1-bc3d-b33800d89903);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_003_fb213097-bd03-4629-9176-15b7e9274f19);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_004_a6b8d7f0-65af-4e1f-8944-2b84d51a3664);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_005_6d5abddd-f46d-4013-8e0d-c9d75c9c4dfc);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_006_7ed487b7-5447-4589-a49e-eb58c3695d02);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_007_28f653b3-7947-4f92-be55-e4b3a7790e54);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_008_e20f908c-b1dc-40da-aa39-8e620a049053);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_009_fd043ae0-25ce-4a49-86d2-4a190e56f56e);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_010_289c0d51-f179-41e0-bffa-5982b32345e2);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_011_dba0b561-3d99-4648-a4ff-d951dc250500);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDevAmbusher_012_4141b977-0634-4f88-bae0-501c62f5a10b);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDetonatorAmbusher_001_95f3dc04-2a03-49a9-979a-db3568e9c18e);
DB_END_MorphicPool_IntDevAmbusher(S_END_IntDetonatorAmbusher_002_7dc37f86-6fcc-4f6c-9c4c-ad15e95ab774);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDetonatorAmbusher_Wave2_001_4c50a0a8-3434-4345-a183-0d24461dcaef);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDetonatorAmbusher_Wave2_002_df0f2f33-c053-4bf8-9e50-be470c93edbb);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDetonatorAmbusher_Wave2_003_4149b2ca-0262-4f70-8167-3cdab602ead7);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDetonatorAmbusher_Wave2_004_bd194cf7-8e32-45e8-99dd-90c2d75d4627);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_001_98c94496-e48e-469d-bc29-b8e770c8768d);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_002_4b2e32e4-d40e-49a7-8c2f-c2524228efcb);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_003_70cd97b5-074a-41df-98bf-a14de3c226d7);
DB_END_MorphicPool_IntDevAmbusher_SecondWave(S_END_IntDevAmbusher_Wave2_004_a7dd9352-8a7a-4932-8b2e-612ff66e58a2);
PROC_TriggerRegisterForPlayers(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007);
DB_GLO_DefeatCounter_AllDefeatedGlobalFlag("END_MorphicPool_IntDevAmbusherDefeat", END_MorphicPool_State_IntDevAmbushersDefeated_1eba2903-19c1-4d39-beb6-7ba2769eaa74);
DB_AddCharactersInTriggerToDialog(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, S_END_MorphicPool_SUB_5a646d13-e9bb-42f0-84e6-1f8fad2bef81, 1, 1, 1, 1);
SetOnStage(S_END_FakeNetherbrain_000_4a97b2f5-5633-4988-8036-a73866e28834, 0);
PROC_TriggerRegisterForPlayers(S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06);
DB_DialogStarted_IgnoreStopConditions(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf);
DB_DropMutingStatussesDialog(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf);
DB_DialogBlockTradeButton(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf);
SetOnStage(S_END_ToHighHallVines_11f19d26-e595-46c0-9de8-a34cbcc1ff82, 0);
PROC_END_MorphicPool_Setup();
SetOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 0);

KBSECTION
IF
TextEvent("end_brainref", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
IsOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_DEBUG_MorphicPool_ToggleBrainRef(_Var1);

PROC
PROC_END_DEBUG_MorphicPool_ToggleBrainRef(0, _, _, _, _)
THEN
SetOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 1);
SetForceUpdate(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 1);

PROC
PROC_END_DEBUG_MorphicPool_ToggleBrainRef(1, _, _, _, _)
THEN
SetOnStage(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 0);
SetForceUpdate(S_DEBUG_NetherbrainSizeRef_83a835fc-7f0e-4b85-9d98-7bbe8481f448, 0);

IF
TextEvent("end_readyboat", _, _, _, _)
THEN
SetFlag(END_MorphicPool_State_UnlockedAccess_b65fedb8-ed89-4ccf-b20f-3338474bda18);

IF
TextEvent("end_gotomorphicpool", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(Debug_Teleport_END_MorphicPool_89dceaa3-e98a-44b6-909c-9bf651208477, _Var1);

IF
TextEvent("end_gotobrainarena", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(Debug_Teleport_END_NetherbrainArena_d8d292a5-18df-4e8b-a8b0-d6c59e875897, _Var1);

IF
TextEvent("end_emperorbrainarena", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(END_IllithidOptions_State_SafePassage_b97872a1-59cc-40cd-8963-e06be614adc0);
SetFlag(END_EmperorPrelude_State_GaveStones_18e3be1a-c1c0-437e-ad0a-a1426d8830f4);
PROC_TeleportPartiesTo(S_END_ToMorphicPoolPoint_d1e450c1-1b10-49d1-8faa-29761e032059, "END_MorphicPool_Arrived");

IF
TextEvent("end_tomorphicambush", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TeleportPartiesTo(S_END_DEBUG_AmbushPoint_7612ac88-4737-4b65-8d98-a23187fd4cce, "");

IF
TextEvent("end_tomorphicnetherbrain", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TeleportPartiesTo(S_END_DEBUG_NetherbrainPoint_29627d76-0ab0-4622-a64f-fbc7a58c2df3, "");

IF
TextEvent("end_testbrainad", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Var1);
PROC_TryStartAD(END_MorphicPool_AD_Netherbrain_83cc2429-e2e7-88bc-a1e9-3db36832dc4a, S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);

IF
TextEvent("end_morphicpoolarrival", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialogCustom(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52, S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, _Var1, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Dialog Failed");

IF
TextEvent("end_morphicpoolquake", _, _, _, _)
THEN
PROC_LoopEffect(VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, S_END_MorphicBrainQuakePoint_003_79f45084-7b92-42bf-97e4-8bc850eebc4a, "Debug", "END_Main", "");

IF
TextEvent("end_morphicpoolquakestop", _, _, _, _)
AND
DB_LoopEffect(_, _Var2, _, _, VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, _, _, _, _, _)
THEN
PROC_StopLoopEffect(_Var2);

IF
TextEvent("end_bringthegortash", _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(WYR_KillDirectorGortash_State_AgreedToMeetInUndercity_1375d542-cf0a-49fd-927b-5c6bbce13ce4);
PROC_END_MorphicPool_SetupGortash();

IF
FlagSet(Debug_END_MorphicPool_GortashPact_1f85c5c2-fa36-4443-b457-58df642f72fb, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_END_MorphicPool_SetupGortash();

IF
LevelLoaded("END_Main", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_ToMorphicPool_BoatUser(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52, S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, _Var1, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
NOT DB_END_ToMorphicPool_BoatUser(_Var1);
PROC_NotifyWhenReadyToMoveOn(_Var1, "END_MorphicPool_ArrivalEmperorAD");

PROC
PROC_StartDialog_AddExtraSpeakers(END_MorphicPool_Arrival_2beffc77-9608-ca0c-894c-4e70d0cc6e52, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
SetLevelStartingDialog(_Var1, 1);

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "END_MorphicPool_ArrivalEmperorAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_EmperorAD(_Var1, END_MorphicPool_EmperorAD_Arrival_08aee88a-f3e8-e953-60bf-bd3315b5599f);
DB_AutoSaveTrigger(S_END_MorphicPoolAutoSave_9dd078a6-4654-4954-9623-f7329693a303);

PROC
PROC_END_MorphicPool_Setup()
THEN
CreateSurface(S_END_DeadSmugglerSibling_f5499fbc-61ed-4c7c-93e8-63bec48b75c5, "SurfaceFire", 2, 3);
SetFlag(END_General_State_CurrentlyInMorphicPool_06208edf-4c61-44a2-932b-b158d9ddd2f0);

PROC
PROC_END_MorphicPool_Setup()
AND
DB_END_MorphicPool_IntDevAmbusher(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_END_MorphicPool_Setup()
AND
DB_END_MorphicPool_ScurryIntDev(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SpotPlayers(_Var1, "END_MorphicPool_ScurryIntDevSpotter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_Setup()
AND NOT
DB_GlobalFlag(GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769, _, _, _, _)
AND
DB_GlobalFlag(WYR_KillDirectorGortash_State_AgreedToMeetInUndercity_1375d542-cf0a-49fd-927b-5c6bbce13ce4, _, _, _, _)
THEN
PROC_END_MorphicPool_SetupGortash();

PROC
PROC_END_MorphicPool_SetupGortash()
THEN
SetFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67);
PROC_RemoveDialog(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
TemplateAddTo(GRN_Bomb_A_278271f9-3fbc-4cf7-a5dc-b36527f521b2, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 2, 0);
TemplateAddTo(CONS_Potion_Healing_A_Supreme_7d78f227-e8d4-486d-8121-25cf0bee751d, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 1, 0);
TemplateRemoveFrom(PUZ_Trap_Gortash_PhaseOptimizer_f36d0687-46e4-4899-930e-8f635e50948e, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 4);
Equip(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_END_ExtraTorch_002_59051ea8-0342-44ce-a14b-08ffa7c77476, 1, 0, 1);
TeleportTo(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_END_MorphicGortashPoint_6bf2ed03-4bc6-4383-b17a-1b8fc71c8082);
DB_Dialogs(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, END_MorphicPool_Gortash_0fba9e82-9eb1-c5dd-1150-54dec5a192c2);
SetFaction(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, ACT3_END_Gortash_0fa1d8b6-b035-43e4-bb4d-15bf1404ed58);
DB_SpotPlayers(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashSpottedPlayer", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_SetupGortash()
AND
TemplateIsInInventory(MAG_Gortash_Gloves_f7d87a7a-e5aa-4bc9-ba51-4e2df3e0bae0, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 0, _, _)
THEN
DB_END_MorphicPool_AddingGortashGloves(1);
TemplateAddTo(MAG_Gortash_Gloves_f7d87a7a-e5aa-4bc9-ba51-4e2df3e0bae0, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 1, 0);

IF
TemplateAddedTo(MAG_Gortash_Gloves_f7d87a7a-e5aa-4bc9-ba51-4e2df3e0bae0, (ITEM)_Var1, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _, (ITEM)_Var1)
AND
DB_END_MorphicPool_AddingGortashGloves(1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_AddingGortashGloves(1);
Equip(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _Var1, 1, 0, 0);
SetCanBePickpocketed(_Var1, 0);
SetIsTradable(_Var1, 0);
SetIsDroppedOnDeath(_Var1, 1);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "END_MorphicPool_ScurryIntDevSpotter", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_ScurryIntDev(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_END_ScurryToPoint_0f9e4c10-1f03-4d16-9a75-d62d5d9e5167, "Sprint", "END_ScurryIntDevRunTo");
NOT DB_END_MorphicPool_ScurryIntDev(_Var1);

IF
AttackedBy((CHARACTER)_Var1, _, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_ScurryIntDev(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_END_ScurryToPoint_0f9e4c10-1f03-4d16-9a75-d62d5d9e5167, "Sprint", "END_ScurryIntDevRunTo");
NOT DB_END_MorphicPool_ScurryIntDev(_Var1);

IF
EntityEvent((CHARACTER)_Var1, "END_ScurryIntDevRunTo", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_DisappearOutOfSightTo(_Var1, S_END_ScurryDisappearPoint_defb2a9b-ab7c-426f-bcf3-83048cf2bdfe, "Run", 1, "END_ScurryIntDevLeft");

PROC
PROC_LaunchAmbush(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, _, _, _, _)
AND
DB_END_MorphicPool_ScurryIntDev(_Var2, _, _, _, _)
THEN
PROC_DisappearOutOfSight(_Var2, "Run", 1, "END_ScurryIntDevLeft");
NOT DB_END_MorphicPool_ScurryIntDev(_Var2);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_BrainquakeTriggers(_Var2, _Var3, _Var4, _Var5, _Var1)
AND
DB_END_MorphicPool_BrainQuakeStunTime(_Var6, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_BrainquakeTriggers(_Var2, _Var3, _Var4, _Var5);
NOT DB_END_MorphicPool_BrainQuakeStunTime(_Var6);
DB_END_MorphicPool_BrainQuakeStunTime(_Var5);
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun(_Var4);
PROC_END_MorphicPool_StartBrainquakeShakeAndVFX(_Var1, _Var3, 5000);

PROC
PROC_END_MorphicPool_StartBrainquakeShakeAndVFX((CHARACTER)_Var1, (TRIGGER)_Var2, (INTEGER)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_LoopEffect(VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, _Var2, "END_MorphicPool_Brainquake", "END_Main", "", 1.5);
PROC_ShakeCameraForTime(_Var1, _Var3, VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, 1);
RealtimeObjectTimerLaunch(_Var2, "END_MorphicPool_BrainquakeTimer", _Var3);

PROC
PROC_END_MorphicPool_StartBrainquakeShakeAndVFX(_, (TRIGGER)_Var2, (INTEGER)_Var3, _, _)
AND
_Var2 != S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c
THEN
PROC_LoopEffect(VFX_Script_Brainquake_01_07202ba2-fe9c-fc79-46e3-cc421fafc0e8, S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, "END_MorphicPool_Brainquake", "END_Main", "", 1);
RealtimeObjectTimerLaunch(S_END_MorphicBrainQuakeNetherbrainPoint_7a42268f-9406-4846-b475-ad4b723c5d1c, "END_MorphicPool_BrainquakeTimer", _Var3);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "END_MorphicPool_BrainquakeTimer", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_StopLoopEffect(_Var1, "END_MorphicPool_Brainquake");
PROC_END_MorphicPool_RemoveNetherbrainSlow();

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun(_Var2, _Var1);

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _Var1);

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_END_MorphicPool_IntDevAmbusher(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var2, 1, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun(_Var2, _Var1);

PROC
PROC_END_MorphicPool_ReadyBrainquakeSlowAndStun((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var2, 1, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun(_Var2, _Var1);

PROC
PROC_END_MorphicPool_ApplyBrainquakeSlowAndStun((CHARACTER)_Var1, (INTEGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
Random(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
IntegerToReal(_Var2, _Var4, _Var1, _Var1, _Var1)
AND
RealProduct(_Var4, 1.5, _Var5, _Var1, _Var1)
AND
RealToInteger(_Var5, _Var6, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var3, _Var6, _Var7, _Var1, _Var1)
AND NOT
DB_END_MorphicPool_BrainquakeTarget(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_MorphicPool_BrainquakeTarget(_Var1);
RealtimeObjectTimerLaunch(_Var1, "END_MorphicPool_NetherSlow_Timer", _Var3);
RealtimeObjectTimerLaunch(_Var1, "END_MorphicPool_NetherStun_Timer", _Var7);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "END_MorphicPool_NetherSlow_Timer", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_END_MorphicPool_BrainquakeSlowTimerFinished(_Var1);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "END_MorphicPool_NetherSlow_Timer", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
HasActiveStatus(_Var1, "END_NETHERBRAIN_SLOW", 0, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "END_NETHERBRAIN_SLOW", -1, 1);

IF
ObjectTimerFinished((CHARACTER)_Var1, "END_MorphicPool_NetherStun_Timer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_END_MorphicPool_BrainquakeStunTimerFinished(_Var1);
RequestPassiveRoll(_Var1, S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, "SavingThrow", "Constitution", Act3_Hard_6298329e-255c-4826-9209-e911873b64e7, 0, "END_MorphicPool_MindStun");

IF
DB_END_MorphicPool_BrainquakeTarget(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_MorphicPool_BrainquakeSlowTimerFinished(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_MorphicPool_BrainquakeStunTimerFinished(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_BrainquakeTarget(_Var1);
NOT DB_END_MorphicPool_BrainquakeSlowTimerFinished(_Var1);
NOT DB_END_MorphicPool_BrainquakeStunTimerFinished(_Var1);

IF
RollResult("END_MorphicPool_MindStun", (CHARACTER)_Var1, _, 0, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_BrainQuakeStunTime(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "STUNNED", _Var5, 1);
DB_END_MorphicPool_StunnedCharacter(_Var1);

IF
StatusRemoved((CHARACTER)_Var1, "STUNNED", _, _, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_StunnedCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_MorphicPool_BrainquakeStunnedVB", _Var1, _Var1, _Var1, _Var1)
THEN
RealtimeObjectTimerLaunch(_Var1, "END_MorphicPool_StunnedVBTimer", 7000);

IF
ObjectTimerFinished((CHARACTER)_Var1, "END_MorphicPool_StunnedVBTimer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
StartVoiceBark(END_MorphicPool_VB_BrainquakeStunned_a1a16144-5b18-0d05-8c46-257f6fae01c5, _Var1);

IF
DB_OnlyOnce("END_MorphicPool_BrainquakeStunnedVB", _Var1, _Var1, _Var1, _Var1)
AND
DB_END_MorphicPool_StunnedCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_StunnedCharacter(_Var1);

PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_InRegion(_Var1, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "END_NETHERBRAIN_SLOW", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND NOT
DB_InRegion(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, _, _, _)
AND
HasActiveStatus(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_NETHERBRAIN_SLOW", 1, _, _)
THEN
RemoveStatus(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND
DB_END_MorphicPool_IntDevAmbusher(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "END_NETHERBRAIN_SLOW", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_RemoveNetherbrainSlow()
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "END_NETHERBRAIN_SLOW", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_BrainquakeTriggers(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(_Var1);
NOT DB_END_MorphicPool_BrainquakeTriggers(_Var1, _Var2, _Var3, _Var4);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
THEN
PROC_ForceStopDialog(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);
PROC_TriggerUnregisterForPlayers(S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);
PROC_TriggerUnregisterForPlayers(S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06);
PROC_TriggerUnregisterForPlayers(S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_MindMeldADTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(_Var1);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_RapidMindMeldADHelper(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_MindMeldADTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_MindMeldADTriggers(_Var2);
PROC_END_MorphicPool_TryMindMeldAD(_Var1);

PROC
PROC_END_MorphicPool_TryMindMeldAD((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_MindMeldTarget(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != _Var1
THEN
NOT DB_END_MorphicPool_MindMeldTarget(_Var2);
DB_END_MorphicPool_MindMeldTarget(_Var1);

PROC
PROC_END_MorphicPool_TryMindMeldAD((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_MindMeldTarget(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);
TeleportTo(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Var1);
PROC_TryStartAD(END_MorphicPool_AD_Netherbrain_83cc2429-e2e7-88bc-a1e9-3db36832dc4a, S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);

IF
DB_GlobalFlag(END_MorphicPool_Event_MoveBrainADHelper_23e6f31f-7c0a-4f66-968f-16b28e6a44dd, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_MorphicPool_MindMeldTarget(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(END_MorphicPool_Event_MoveBrainADHelper_23e6f31f-7c0a-4f66-968f-16b28e6a44dd);
PROC_END_MorphicPool_TeleportADHelper(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Var1);

PROC
PROC_END_MorphicPool_SetMaxRapidMindMeldDistance()
AND
GetDistanceTo(S_END_RapidMindMeldDistancePoint_002_4a5f8b52-7f8a-40b9-858d-dd1680e6f4f5, S_END_RapidMindMeldDistancePoint_001_192407cf-59ac-485c-9730-1f89472393f3, _Var1, _Var1, _Var1)
THEN
DB_END_MorphicPool_RapidMindMeldMaxDistance(_Var1);

IF
DB_InRegion(_Var1, S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_RapidMindMeldADCleanup();
PROC_END_MorphicPool_TryRapidMindMeldAD(_Var1, S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);

PROC
PROC_END_MorphicPool_RapidMindMeldADCleanup()
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Var1, _Var2, _Var3);

PROC
PROC_END_MorphicPool_RapidMindMeldADCleanup()
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Var1);

PROC
PROC_END_MorphicPool_RapidMindMeldADCleanup()
THEN
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(-1);

PROC
PROC_END_MorphicPool_TryRapidMindMeldAD((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_RapidMindMeldADHelper(_Var3, _Var4, _Var1, _Var1, _Var1)
AND NOT
DB_END_MorphicPool_ActiveRapidMindMeldAD(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var5, 1, _Var6, _Var1, _Var1)
THEN
DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Var3, _Var4, _Var6);
NOT DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Var5);
DB_END_MorphicPool_AvailableRapidMindMeldADHelperCount(_Var6);

PROC
PROC_END_MorphicPool_TryRapidMindMeldAD((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_InRegion(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
SysCount("DB_END_MorphicPool_AvailableRapidMindMeldADHelper", 3, _Var3, _Var1, _Var1)
AND
Random(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
DB_END_MorphicPool_AvailableRapidMindMeldADHelper(_Var5, _Var6, _Var4, _Var1, _Var1)
THEN
DB_END_MorphicPool_ActiveRapidMindMeldAD(_Var6);
PROC_END_MorphicPool_TeleportADHelper(_Var5, _Var1);
PROC_ForceStopDialog(_Var5);
PROC_TryStartAD(_Var6, _Var5);
PROC_END_MorphicPool_RapidMindMeldADTimerStart(_Var1);

PROC
PROC_END_MorphicPool_TeleportADHelper(_, _, _, _, _)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Var3, _, _, _, _)
THEN
NOT DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Var3);

PROC
PROC_END_MorphicPool_TeleportADHelper(_, _, _, _, _)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Var3, _, _, _, _)
THEN
NOT DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Var3);

PROC
PROC_END_MorphicPool_TeleportADHelper((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
Random(100, _Var3, _Var1, _Var1, _Var1)
AND
Random(100, _Var4, _Var1, _Var1, _Var1)
AND
Random(100, _Var5, _Var1, _Var1, _Var1)
AND
IntegerToReal(_Var3, _Var6, _Var1, _Var1, _Var1)
AND
IntegerToReal(_Var4, _Var7, _Var1, _Var1, _Var1)
AND
IntegerToReal(_Var5, _Var8, _Var1, _Var1, _Var1)
AND
RealDivide(_Var6, 100, _Var9, _Var1, _Var1)
AND
RealDivide(_Var7, 100, _Var10, _Var1, _Var1)
AND
RealDivide(_Var8, 100, _Var11, _Var1, _Var1)
AND
Random(4, _Var12, _Var1, _Var1, _Var1)
AND
QRY_END_RapidMindMeld_DetermineRandomOffset(_Var12, _Var9, _Var10, 2, 1)
AND
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_Var13, _Var14, _Var1, _Var1, _Var1)
AND
RealProduct(_Var11, 1, _Var15, _Var1, _Var1)
AND
RealSum(_Var15, -0.5, _Var16, _Var1, _Var1)
AND
GetPosition(_Var2, _Var17, _Var18, _Var19, _Var1)
AND
RealSum(_Var17, _Var13, _Var20, _Var1, _Var1)
AND
RealSum(_Var19, _Var14, _Var21, _Var1, _Var1)
AND
RealSum(_Var18, _Var16, _Var22, _Var1, _Var1)
THEN
TeleportToPosition(_Var1, _Var20, _Var22, _Var21, "", 0, 0, 0, 0, 0);
NOT DB_QRYRTN_END_RapidMindMeld_RandomOffset(_Var13, _Var14);

QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(0, (REAL)_Var1, (REAL)_Var2, (REAL)_Var3, (REAL)_Var4)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_Var1, _Var3, _Var4, 1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Var6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_Var5, _Var6);

QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(1, (REAL)_Var1, (REAL)_Var2, (REAL)_Var3, (REAL)_Var4)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_Var1, _Var3, _Var4, -1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Var6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_Var5, _Var6);

QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(2, (REAL)_Var1, (REAL)_Var2, (REAL)_Var3, (REAL)_Var4)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_Var1, _Var3, _Var4, _Var1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_Var2, _Var3, _Var4, 1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Var6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_Var5, _Var6);

QRY
QRY_END_RapidMindMeld_DetermineRandomOffset(3, (REAL)_Var1, (REAL)_Var2, (REAL)_Var3, (REAL)_Var4)
AND
QRY_END_RapidMindMeld_CalcWithoutOffset(_Var1, _Var3, _Var4, _Var1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_RapidMindMeld_CalcWithOffset(_Var2, _Var3, _Var4, -1, _Var1)
AND
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Var6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_QRYRTN_END_RapidMindMeld_RandomOffset(_Var5, _Var6);

QRY
QRY_END_RapidMindMeld_CalcWithOffset((REAL)_Var1, (REAL)_Var2, (REAL)_Var3, (REAL)_Var4, (REAL)_Var1)
AND
RealProduct(_Var1, _Var3, _Var5, _Var1, _Var1)
AND
RealSum(_Var5, _Var2, _Var6, _Var1, _Var1)
AND
RealProduct(_Var6, _Var4, _Var7, _Var1, _Var1)
THEN
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithOffset(_Var7);

QRY
QRY_END_RapidMindMeld_CalcWithoutOffset((REAL)_Var1, (REAL)_Var2, (REAL)_Var3, (REAL)_Var1, (REAL)_Var1)
AND
RealSum(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
RealSubtract(_Var1, 0.5, _Var5, _Var1, _Var1)
AND
RealProduct(_Var5, 2, _Var6, _Var1, _Var1)
AND
RealProduct(_Var6, _Var4, _Var7, _Var1, _Var1)
THEN
DB_QRY_RTN_END_RapidMindMeld_CalculatedWithoutOffset(_Var7);

PROC
PROC_END_MorphicPool_RapidMindMeldADTimerStart((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_END_BrainBattle_RapidMindMeld(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_MorphicPool_GetTimeDifference(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
ObjectTimerLaunch(_Var1, "END_MorphicPool_RapidMindMeldAD", _Var2, 1);
NOT DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(_Var2);

PROC
PROC_END_MorphicPool_RapidMindMeldADTimerStart((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_BrainBattle_RapidMindMeld(1, _Var1, _Var1, _Var1, _Var1)
THEN
RealtimeObjectTimerLaunch(_Var1, "END_MorphicPool_RapidMindMeldAD", 770);

IF
ObjectTimerFinished((CHARACTER)_Var1, "END_MorphicPool_RapidMindMeldAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_END_BrainBattle_RapidMindMeld(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_RapidMindMeldADCleanup();
PROC_END_MorphicPool_TryRapidMindMeldAD(_Var1, S_END_RapidMindMeldPoly_2223d5b1-2f8b-428e-97ee-0f1ee903377a);

QRY
QRY_END_MorphicPool_GetTimeDifference((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetDistanceTo(_Var1, S_END_RapidMindMeldDistancePoint_001_192407cf-59ac-485c-9730-1f89472393f3, _Var2, _Var1, _Var1)
AND
DB_END_MorphicPool_RapidMindMeldMaxDistance(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
RealDivide(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
DB_END_MorphicPool_ActiveRapidMindMeldStartTime(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
IntegerToReal(_Var5, _Var6, _Var1, _Var1, _Var1)
AND
RealProduct(_Var4, _Var6, _Var7, _Var1, _Var1)
AND
RealToInteger(_Var7, _Var8, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_SetAdjustedTime(_Var8);

PROC
PROC_END_MorphicPool_SetAdjustedTime((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 > 770
THEN
DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(_Var1);

PROC
PROC_END_MorphicPool_SetAdjustedTime((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
_Var1 <= 770
THEN
DB_QRYRTN_END_MorphicPool_ActiveRapidMindMeldTimeAdjusted(770);

IF
AutomatedDialogEnded((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_END_MorphicPool_ActiveRapidMindMeldAD(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_MorphicPool_ActiveRapidMindMeldAD(_Var1);

IF
EnteredTrigger((CHARACTER)_Var1, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_MorphicPool_PsionicSuppressVB", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(END_MorphicPool_VB_PsionicSupression_8fb3d8ea-8874-5fb7-7c56-8202c111d5c4, _Var1);

IF
DB_InRegion(_Var1, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "END_NETHERBRAIN_SLOW", 0, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "END_NETHERBRAIN_SLOW", -1, 1);

IF
LeftTrigger((CHARACTER)_Var1, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
RemoveStatus(_Var1, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_StateSet_Defeated((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
HasActiveStatus(_Var1, "END_NETHERBRAIN_SLOW", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

IF
DB_END_MorphicPool_IntDevAmbusher(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "END_MorphicPool_IntDevAmbusherDefeat");
DB_AmbushTrigger_Ambusher_Appear(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, _Var1, _Var1, 1, UTIL_Spawn_01_510ff37e-0618-40e4-8ce0-236e3dc9c291, "");

PROC
PROC_LaunchAmbush(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_END_MorphicPool_AmbushInitiator(_Var1);
PROC_END_MorphicPool_NetherbrainAmbushAD(END_MorphicPool_AD_NetherbrainIntDevAmbushStart_7af65a87-81be-cc25-80e4-c401b261dfa1);

PROC
PROC_END_MorphicPool_NetherbrainAmbushAD((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_END_MorphicPool_AmbushInitiator(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);
TeleportTo(S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35, _Var2);
PROC_TryStartAD(_Var1, S_END_NetherbrainVoiceHelper_a80db77c-90a6-4baf-a394-383c30bdcb35);

IF
WentOnStage((CHARACTER)_Var1, 1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_IntDevAmbusher(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "END_MorphicPool_IntDevAmbushStartWave2Counter");
SetCombatGroupAndEnterCombat(_Var1, "END_MorphicPool_IntDevAmbusherGroup", _Var2);

IF
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_DefeatCounter(_Var1, "END_MorphicPool_IntDevAmbusherDefeat");
PROC_SetOnStage(_Var1, 0);

PROC
PROC_GLO_DefeatCounter_Notify("END_MorphicPool_IntDevAmbushStartWave2Counter", _, _, 8, _)
AND
QRY_OnlyOnce("END_MorphicPool_IntDevAmbushWave2Counter_OnlyOnce", _, _, _, _)
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_Var3, _, _, _, _)
AND
GetPosition(_Var3, _Var4, _Var5, _Var6, _)
THEN
AppearAtPosition(_Var3, _Var4, _Var5, _Var6, 1, UTIL_Spawn_01_510ff37e-0618-40e4-8ce0-236e3dc9c291, "");
PROC_END_MorphicPool_NetherbrainAmbushAD(END_MorphicPool_AD_NetherbrainIntDevAmbushMid_0fb7733e-dc35-65af-9cf0-da320feedd77);

PROC
PROC_GLO_DefeatCounter_AllDefeated("END_MorphicPool_IntDevAmbusherDefeat", _, _, _, _)
THEN
PROC_END_MorphicPool_AmbushEnded();

PROC
PROC_END_MorphicPool_AmbushEnded()
AND NOT
DB_GlobalFlag(END_MorphicPool_State_ExplosiveIntDevArcanaPassed_ec1b5cb4-59ad-4c95-90ff-7e091da4ecc4, _, _, _, _)
THEN
DB_OneShotPartyTrigger(S_END_FoughtExplosiveIntDevADSphere_22c1b787-a6a3-43a0-bc2c-d500c335e450);

PROC
PROC_END_MorphicPool_AmbushEnded()
AND
DB_END_MorphicPool_AmbushInitiator(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GetClosestAvailableCharacterTo(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var2, _Var1, _, 1, _Var1)
THEN
NOT DB_END_MorphicPool_AmbushInitiator(_Var1);
PROC_NotifyWhenReadyToMoveOn(_Var2, "END_MorphicPool_EmperorADObservation");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "END_MorphicPool_EmperorADObservation", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_EmperorAD(_Var1, END_MorphicPool_EmperorAD_Observations_4dcfb95a-727e-bd78-8b05-d3fbff68aa7b);

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_IntDevAmbusher(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 0, "");

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
AND
DB_END_MorphicPool_IntDevAmbusher_SecondWave(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 0, "");

PROC
PROC_END_MorphicPool_PostConfrontationCleanUp()
THEN
PROC_CancelAmbush(S_END_StartIntDevAmbushSphere_b0565acb-a246-4bdc-9544-111bc84f3007);

IF
FlagSet(END_MorphicPool_State_HasDeadSmugglerToken_104abece-95d5-4d04-b2d0-f6f741718ce5, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
_Var3 != _Var1
THEN
NOT DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Var3);
DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Var1);

IF
AddedTo(S_END_DeadSmugglerSiblingToken_d95b9ad2-d8d3-4cd5-9ed4-818845836ccb, S_END_DeadSmugglerSibling_f5499fbc-61ed-4c7c-93e8-63bec48b75c5, _, _, _)
AND
DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Var2, _, _, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND
DB_GlobalFlag(END_MorphicPool_Knows_DeadSmugglerSibling_f04df54e-7938-4f58-a9e0-7a90ada764d3, _, _, _, _)
AND
QRY_OnlyOnce("END_MorphicPool_DeadSmugglerToken", _, _, _, _)
THEN
StartVoiceBark(END_MorphicPool_VB_DeadSmugglerResolve_63526504-c1e0-6be0-ef50-2338b37b27de, _Var2);
NOT DB_END_MorphicPool_LastDeadSmugglerTokenHolder(_Var2);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Var1, S_END_FoughtExplosiveIntDevADSphere_22c1b787-a6a3-43a0-bc2c-d500c335e450, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(END_MorphicPool_VB_ExplosiveIntDev_ddf687f5-2ded-a0ad-a80d-389926184027, _Var1);

IF
DB_InRegion(_Var1, S_END_MorphicPartyBanterBox_7cf1a87e-5888-403c-9403-faaf8a4b9591, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_END_MorphicPool_BrainquakeTarget(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_MorphicPool_PartyBanterOnce", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(END_MorphicPool_VB_PartyBanter_4f81d15e-5bf2-f22b-fe51-a0e7a73d5dee, _Var1);

IF
EnteredTrigger((CHARACTER)_Var1, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_MorphicPool_EnteredSlowVBOnce", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(END_MorphicPool_VB_MorphicBanter_af1c219b-7a44-3898-8353-e22e9e9903b7, _Var1);

IF
RelationChanged(ACT3_END_Gortash_0fa1d8b6-b035-43e4-bb4d-15bf1404ed58, Hero_a1542c81-6895-929e-4522-10ce218bb360, 0, 0, _)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f, _, _, _, _)
THEN
SetFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2);
SetFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f);

PROC
PROC_StateSet_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _, _, _, _)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f, _, _, _, _)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_GortashHeadPop_a596f4f1-fcce-416c-bf0e-31037a1f4fb0, _, _, _, _)
THEN
SetFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2);
SetFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f);

IF
AddedTo(S_WYR_CrownController_Gortash_383be300-d328-4152-86df-4927482d1fd7, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2);

PROC
PROC_SpotPlayers_Spotted(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashSpottedPlayer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(END_MorphicPool_State_SpottedPlayer_cd1494d6-6bcd-422a-a347-6caa927e52d1);
PROC_TryStartAD(END_MorphicPool_AD_GortashCallout_cbb0a688-43f3-23d2-8142-7b3bbcba4140, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

IF
DB_InRegion(_Var1, S_END_NearingSlowBox_dd56773d-3541-4ede-b853-ecde2707962b, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_GortashBetrayed_d5c1ac33-f72a-4b52-992c-430ae7f8adf2, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(END_MorphicPool_Event_GortashMove_7f2b9da1-250e-4bc1-b773-0468cb509fe6);

IF
FlagSet(END_MorphicPool_Event_GortashMove_7f2b9da1-250e-4bc1-b773-0468cb509fe6, _, _, _, _)
AND NOT
DB_GlobalFlag(END_MorphicPool_HasMet_Gortash_1538bf6c-960d-4eff-932c-b0ef81c57379, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(END_MorphicPool_Event_GortashIgnored_6dda4ed2-77ac-0748-fc2a-4a88950a8a9f);
PROC_TryStartAD(END_MorphicPool_AD_GortashCallout_cbb0a688-43f3-23d2-8142-7b3bbcba4140, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

IF
DB_GlobalFlag(END_MorphicPool_Event_GortashMove_7f2b9da1-250e-4bc1-b773-0468cb509fe6, _, _, _, _)
AND
QRY_OnlyOnce("END_MorphicPool_GortashMoveTo", _, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashSpottedPlayer");
PROC_NotifyWhenReadyToMoveOn(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashReadyMove");

PROC
PROC_ReadyToMoveOn(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, "END_MorphicPool_GortashReadyMove", _, _, _)
THEN
PROC_RemoveDialog(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

QRY
QRY_CRIME_KeepingAnEyeOut_Block(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_CurrentLevel("END_Main", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_END_MorphicPool_TeleportToAstralPrism()
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67, _, _, _, _)
AND
DB_PermaDefeated(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, _, _, _, _)
THEN
TeleportTo(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, S_END_DeadGortashAstralPoint_0945cc01-26b5-4c22-b923-0cb6f8361a9f);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Var1, S_END_NearNetherbrainPoolBox_49aa0cac-17aa-476d-8844-db78966ff698, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetFlag(END_MorphicPool_State_NearNetherbrainPool_35f89ccc-2a9a-4663-b24a-a68bf764376c);

IF
FlagSet(END_MorphicPool_Knows_Netherbrain_c982a948-cbe7-4bdf-9410-490cca5dd83b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetStoryDisplayName(S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, "END_NetherbrainName");

IF
FlagSet(END_MorphicPool_Event_ConfrontationStarted_5f683240-a9ab-449d-9847-a3ed0dc9a23f, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_END_MorphicPool_PostConfrontationCleanUp();

IF
DB_InRegion(_Var1, S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_MorphicPool_StonesNotReady", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(END_MorphicPool_VB_MissingStone_1760c0b0-ff94-740c-09cc-6d93e353c7ed, _Var1);

IF
DB_InRegion(_Var1, S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_MorphicPool_State_StonesNotReady_d5c1ac33-f72a-4b52-992c-430ae7f8adf2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_MorphicPool_ConfrontationStart", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_MorphicPool_ConfrontationReadyAllPlayers();
SetFlag(END_MorphicPool_Knows_Netherbrain_c982a948-cbe7-4bdf-9410-490cca5dd83b);
PROC_END_MorphicPool_TryStartConfrontationDialog(_Var1);

PROC
PROC_END_MorphicPool_ConfrontationReadyAllPlayers()
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_ForceStopDialog(_Var1);

PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_General_MainDialogAnchor(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_MorphicPool_StartConfrontationDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GetClosestAvailableCharacterTo(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var2, _, _, _, _Var1)
AND NOT
DB_END_MorphicPool_ConfrontationStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_MorphicPool_StartConfrontationDialog(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_END_MorphicPool_ConfrontationStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_MorphicPool_StartConfrontationDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_END_MorphicPool_GetNearestAvailablePlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_END_MorphicPool_NearestPlayer(_Var2, _Var3, _Var1, _Var1, _Var1)
AND NOT
DB_END_MorphicPool_ConfrontationStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_MorphicPool_StartConfrontationDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

PROC
PROC_END_MorphicPool_TryStartConfrontationDialog(_, _, _, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND NOT
DB_END_MorphicPool_ConfrontationStarted(1, _, _, _, _)
AND
QRY_END_MorphicPool_StartConfrontationDialog(_Var2, _, _, _, _)
THEN
DB_END_MorphicPool_ConfrontationStarted(1);

QRY
QRY_END_MorphicPool_GetNearestAvailablePlayer((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk_IgnoreStatusesCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(_Var2, _Var1, _Var3, _Var1, _Var1)
THEN
DB_QRYRTN_END_MorphicPool_NearestPlayer(_Var2, _Var3);

IF
DB_QRYRTN_END_MorphicPool_NearestPlayer(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_END_MorphicPool_NearestPlayer(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
_Var3 != _Var1
AND
_Var4 >= _Var2
THEN
NOT DB_QRYRTN_END_MorphicPool_NearestPlayer(_Var3, _Var4);

PROC
PROC_END_MorphicPool_TryStartConfrontationDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_END_MorphicPool_ConfrontationStarted(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_MorphicPool_ConfrontationSpeaker(_Var1);
SetFlag(END_MorphicPool_Event_GortashHeadPop_a596f4f1-fcce-416c-bf0e-31037a1f4fb0);
PROC_END_MorphicPool_PostConfrontationCleanUp();
PROC_END_MorphicPool_TeleportToAstralPrism();

PROC
PROC_StartDialog_AddExtraSpeakers(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogPlayers(_Var1, _Var2, _, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, _Var2);

QRY
QRY_END_MorphicPool_StartConfrontationDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_StartDialogCustom(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, _Var1, S_END_MindBattleHelper_be50f7cd-c14a-4131-82d3-29337f3a4759, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 0, 0, 0, 0, _Var1)
THEN
DB_END_MorphicPool_ConfrontationSpeaker(_Var1);

PROC
PROC_StartDialog_AddExtraSpeakers(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_MorphicPool_Event_AttackedGortash_d3c03c7a-d153-4d4e-bc90-6f7b3bb9af1f, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_MorphicPool_State_GortashInMorphicPool_800f11d8-acc2-479d-90bb-2e05f22dfe67, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DialogDeath(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);
PROC_DialogAddSpeakingActor(_Var1, S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac);

IF
FlagSet(END_MorphicPool_Event_GortashHeadPop_a596f4f1-fcce-416c-bf0e-31037a1f4fb0, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
Die(S_GLO_Gortash_b878a854-f790-4999-95c4-3f20f00f65ac, 0, S_GLO_Netherbrain_3858e896-d7dd-4699-b37d-d3919ff15ba7, 0, 1, 0);

IF
DialogEnded(END_MorphicPool_NetherbrainConfrontation_ce5161a9-9580-379a-6e1f-476a4ca688cf, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_END_MorphicPool_TeleportToAstralPrism();

PROC
PROC_END_MorphicPool_TeleportToAstralPrism()
AND NOT
QRY_GLO_ThrallOfTheAbsolute_InProgress()
THEN
PROC_TeleportPartiesTo(S_END_ToAstralPlanePoint_66edc6ed-1584-47ac-983c-c6119ea7ddd4, "END_IllithidOptions_PlayersArrived");


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3c"
