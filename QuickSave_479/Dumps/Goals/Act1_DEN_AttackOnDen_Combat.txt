Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_DEN_AttackOnDen_WavePriority(S_GOB_RaiderBold_1c9fd1dd-12bc-4b81-acb8-9eef54174c55, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Sapper_001_392146c2-0849-4250-b907-e4fb9a13ddcf, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Spider_001_16614e7b-b200-45f3-83fb-dded3641861f, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Ogre_001_04695229-6f1d-433c-8e74-88e21e720e9a, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_RaiderHefty_fcbb04a8-f4e6-4065-901c-1a4a708ccd54, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_RaiderHardy_6687f78f-5d6a-40d4-8cfd-2b972dacde3c, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Bugbear_001_5673d584-cce4-4688-bc50-c0da7eb252ec, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Spider_002_de05b62e-6306-46e1-9f2f-2ac6554d0316, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_RaiderStupid_5d049dbe-ff35-45be-88f9-5f999dc0ffe4, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_RaiderCunning_abdd3748-0834-46f3-8214-18dd4dca9d40, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Sapper_003_4264ba13-c816-405c-bc55-9f91dcfd9793, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_RaiderChieftain_5bac0842-c1d4-4358-a85c-24ab745d0280, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Sapper_004_1b6dba51-be8b-47ac-a73b-94c29e56bbad, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Melee_001_ebe03162-0d2d-4d9c-a5b2-aff64610479b, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_GoblinLush_d738c9a4-a031-4dd9-912f-93cda8d8d8b7, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Ranged_001_12c5dc1a-f738-48bb-8b11-88a7899ec199, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_AttackOnDen_Bugbear_002_e6af67ed-d549-4165-817c-78cb489f3020, "");
DB_DEN_AttackOnDen_WavePriority(S_GOB_WarchiefBrave_6601b8f7-1a92-46bb-b409-6fcef7406a39, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_WavePriority(S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41, "DEN_AttackOnDen_Minion");
DB_DEN_AttackOnDen_Waves(1, 7, GOB_DrowCommander_AD_AttackOnDen_Wave1_66105ace-44ff-19db-5be2-49ee3e2e599e, "");
DB_DEN_AttackOnDen_Waves(2, 7, GOB_DrowCommander_AD_AttackOnDen_Wave2_5f83c558-a0da-9bbd-dfa9-ff6322a98c02, "3c709a75-76de-45f8-4ada-b68763f3e7f0");
DB_DEN_AttackOnDen_Waves(3, 10, GOB_DrowCommander_AD_AttackOnDen_Wave3_82107442-5058-7a93-6d71-9ccd5e4706c0, "");
DB_DEN_AttackOnDen_Waves(4, 10, GOB_DrowCommander_AD_AttackOnDen_Wave4_d908e79d-a28c-b6a8-3e4f-583c52167384, "");
DB_DEN_AttackOnDen_CurrentWave(0);
DB_DEN_AttackOnDen_AddToNextWave(NULL_00000000-0000-0000-0000-000000000000, 0);
DB_DEN_AttackOnDen_Spiders(S_GOB_AttackOnDen_Spider_001_16614e7b-b200-45f3-83fb-dded3641861f);
DB_DEN_AttackOnDen_Spiders(S_GOB_AttackOnDen_Spider_002_de05b62e-6306-46e1-9f2f-2ac6554d0316);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Sapper_001_392146c2-0849-4250-b907-e4fb9a13ddcf);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Sapper_003_4264ba13-c816-405c-bc55-9f91dcfd9793);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Sapper_004_1b6dba51-be8b-47ac-a73b-94c29e56bbad);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Melee_001_ebe03162-0d2d-4d9c-a5b2-aff64610479b);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Ranged_001_12c5dc1a-f738-48bb-8b11-88a7899ec199);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Spider_001_16614e7b-b200-45f3-83fb-dded3641861f);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Spider_002_de05b62e-6306-46e1-9f2f-2ac6554d0316);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Ogre_001_04695229-6f1d-433c-8e74-88e21e720e9a);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Bugbear_001_5673d584-cce4-4688-bc50-c0da7eb252ec);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_Bugbear_002_e6af67ed-d549-4165-817c-78cb489f3020);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_BarrelGoblin_001_b27869ef-88e2-4f99-93f9-c1e8773dcf4a);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_BarrelGoblin_002_7687218e-90a7-4694-bf69-e9f516ed030e);
DB_DEN_AttackOnDen_ExtraCharacters(S_GOB_AttackOnDen_BarrelGoblin_003_23e26dde-3e25-4f94-a50d-0cd8c6bf4b64);
DB_DEN_AttackOnDen_ExtraCharactersRemove(S_GOB_AttackOnDen_Spider_001_16614e7b-b200-45f3-83fb-dded3641861f);
DB_DEN_AttackOnDen_ExtraCharactersRemove(S_GOB_AttackOnDen_Spider_002_de05b62e-6306-46e1-9f2f-2ac6554d0316);
DB_DEN_AttackOnDen_ExtraCharactersRemove(S_GOB_AttackOnDen_Ogre_001_04695229-6f1d-433c-8e74-88e21e720e9a);
DB_DEN_AttackOnDen_ExtraCharactersRemove(S_GOB_AttackOnDen_Bugbear_001_5673d584-cce4-4688-bc50-c0da7eb252ec);
DB_DEN_AttackOnDen_ExtraCharactersRemove(S_GOB_AttackOnDen_Bugbear_002_e6af67ed-d549-4165-817c-78cb489f3020);
DB_DEN_AttackOnDen_OgreThrowHelpers(S_DEN_AttackOnDen_OgreThrowHelper_000_8a50dcf9-b868-43ee-a2e8-be7f32699ba1);
DB_DEN_AttackOnDen_OgreThrowHelpers(S_DEN_AttackOnDen_OgreThrowHelper_001_2eaade89-0234-41a0-97a8-b825779eae27);
DB_DEN_AttackOnDen_OgreThrowHelpers(S_DEN_AttackOnDen_OgreThrowHelper_002_f267a023-2c2c-4c73-ba1d-6ddd036639ec);
DB_DEN_AttackOnDen_OgreThrowHelpers(S_DEN_AttackOnDen_OgreThrowHelper_003_ef92fd96-8046-471f-97f8-3f7cd07b6e67);
DB_DEN_AttackOnDen_OgreThrowHelpers(S_DEN_AttackOnDen_OgreThrowHelper_004_6dad1c1b-cc9e-43f0-baad-71515dc5390b);
DB_DEN_AttackOnDen_OgreThrowHelpers(S_DEN_AttackOnDen_OgreThrowHelper_005_696cab71-07e7-49b2-8da6-e7a9f08cf2c8);
DB_DEN_AttackOnDen_OgreThrowHelpers(S_DEN_AttackOnDen_OgreThrowHelper_006_5d55cad1-a1b1-4849-9f14-1c53adc44b60);
DB_DEN_AttackOnDen_Ogres(S_GOB_AttackOnDen_Ogre_001_04695229-6f1d-433c-8e74-88e21e720e9a);
DB_DEN_AttackOnDen_GoblinBarrels(S_DEN_AttackOnDen_GoblinBarrel_001_b8625f40-04f3-45e1-9efe-fed845487ac8, S_GOB_AttackOnDen_BarrelGoblin_001_b27869ef-88e2-4f99-93f9-c1e8773dcf4a);
DB_DEN_AttackOnDen_GoblinBarrels(S_DEN_AttackOnDen_GoblinBarrel_002_5f4a2691-5466-461c-bc33-06c41fdaae37, S_GOB_AttackOnDen_BarrelGoblin_002_7687218e-90a7-4694-bf69-e9f516ed030e);
DB_DEN_AttackOnDen_GoblinBarrels(S_DEN_AttackOnDen_GoblinBarrel_003_2f3c6448-676e-4037-98b7-e297446912c8, S_GOB_AttackOnDen_BarrelGoblin_003_23e26dde-3e25-4f94-a50d-0cd8c6bf4b64);
DB_DEN_AttackOnDen_GoblinBarrelists(S_GOB_AttackOnDen_BarrelGoblin_001_b27869ef-88e2-4f99-93f9-c1e8773dcf4a);
DB_DEN_AttackOnDen_GoblinBarrelists(S_GOB_AttackOnDen_BarrelGoblin_002_7687218e-90a7-4694-bf69-e9f516ed030e);
DB_DEN_AttackOnDen_GoblinBarrelists(S_GOB_AttackOnDen_BarrelGoblin_003_23e26dde-3e25-4f94-a50d-0cd8c6bf4b64);
DB_DEN_AttackOnDen_GoblinBarrels_ActiveCharacters(S_DEN_AttackOnDen_GoblinBarrel_004_cf223a48-7164-43c0-91c2-b39c19937f3b, S_GOB_WarchiefGrumpy_126e39d1-7c38-453c-888b-4cddce7f3e41);
DB_DEN_AttackOnDen_GoblinBarrels_ActiveCharacters(S_DEN_AttackOnDen_GoblinBarrel_005_1a6cc81d-58a1-4724-94eb-0af6c7194600, S_GOB_GoblinLush_d738c9a4-a031-4dd9-912f-93cda8d8d8b7);
PROC_DEN_AttackOnDen_Combat_Init();

KBSECTION
PROC
PROC_DEN_AttackOnDen_Combat_Init()
AND
DB_DEN_AttackOnDen_ExtraCharacters(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

PROC
PROC_StateSet_PermaDefeated((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_AttackOnDen_WavePriority(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_WaveParticipants(_Var1, _, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_WavePriority(_Var1, _Var2);

IF
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
DB_DEN_AttackOnDen_GoblinBarrels_ActiveCharacters(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var2);

PROC
PROC_DEN_AttackOnDen_Combat_Init()
AND
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_GoblinBarrels_ActiveCharacters(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
SetOnStage(_Var2, 0);

PROC
PROC_DEN_AttackOnDen_Combat_Init()
AND
DB_DEN_AttackOnDen_Ogres(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_OgreThrowHelpers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
AiAddInterestingItem(_Var1, _Var2);
SetOnStage(_Var2, 0);

PROC
PROC_DEN_AttackOnDen_CombatSetup()
AND
DB_DEN_AttackOnDen_OgreThrowHelpers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_StartCombat()
AND
DB_DEN_AttackOnDen_GoblinBarrels_ActiveCharacters(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_GoblinBarrels_ActiveCharacters(_Var1, _Var2);
SetOnStage(_Var2, 0);

PROC
PROC_DEN_AttackOnDen_StartCombat()
AND
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
SetOnStage(_Var1, 1);

IF
OnThrown((ITEM)_Var1, _, (CHARACTER)_Var3, _, _, _, _, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_DEN_AttackOnDen_Ogres(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _, _Var1, _Var1, _Var1)
THEN
RealtimeObjectTimerLaunch(_Var1, "DEN_AttackOnDen_GoblinBarrel_DestroyDelay", 250);

IF
ObjectTimerFinished((ITEM)_Var1, "DEN_AttackOnDen_GoblinBarrel_DestroyDelay", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetHitpoints(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
ApplyDamage(_Var1, _Var3, "Bludgeoning", _Var2);
Die(_Var1, 0, _Var2, 0, 0);

IF
DestroyingBy((ITEM)_Var1, _, _, _, (ITEM)_Var1)
AND
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var5, _Var1, _Var1, _Var1)
AND
_Var5 != NULL_00000000-0000-0000-0000-000000000000
AND
GetPosition(_Var1, _Var6, _Var7, _Var8, _Var1)
THEN
AppearAtPosition(_Var5, _Var6, _Var7, _Var8, 1, NULL_00000000-0000-0000-0000-000000000000, "DEN_AttackOnDen_GoblinBarrels_JoinCombat");
NOT DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var5);

IF
EntityEvent((CHARACTER)_Var1, "DEN_AttackOnDen_GoblinBarrels_JoinCombat", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetCanJoinCombat(_Var1, 1);
SetFaction(_Var1, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5);
SetCombatGroupID(_Var1, "DEN_AttackOnDen_GateCombat");
PROC_DEN_AttackOnDen_BarrelTryLeave(_Var1);

PROC
PROC_DEN_AttackOnDen_BarrelTryLeave((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_GoblinBarrelists(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_DefeatCounter_CountMet("DEN_AttackOnDen_RaiderCombat", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_DEN_GoblinAppearDirection_2d5a4623-399f-4b23-b7cc-2cd5f2635fc0, "Sprint", "DEN_AttackOnDen_RaiderDisappear");

PROC
PROC_DEN_AttackOnDen_BarrelTryLeave((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_GoblinBarrelists(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_DefeatCounter_CountMet("DEN_AttackOnDen_GateCombat", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_DEN_GoblinAppearDirection_2d5a4623-399f-4b23-b7cc-2cd5f2635fc0, "Sprint", "DEN_AttackOnDen_RaiderDisappear");

PROC
PROC_DEN_AttackOnDen_EndOfCombat("DEN_AttackOnDen_GateCombat", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_DEN_AttackOnDen_GoblinBarrels(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetHitpoints(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
_Var3 > 0
THEN
ApplyDamage(_Var1, _Var3, "Bludgeoning", _Var2);

PROC
PROC_DEN_AttackOnDen_RaidersGoInsideDen()
THEN
GoalCompleted;

PROC
PROC_StateSet_Defeated((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_Ogres(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_Ogres(_Var1);
PROC_DEN_AttackOnDen_CheckOgresAreDefeated();

PROC
PROC_DEN_AttackOnDen_CheckOgresAreDefeated()
AND NOT
DB_DEN_AttackOnDen_Ogres(_, _, _, _, _)
AND
DB_DEN_AttackOnDen_GoblinBarrels(_Var2, _Var3, _, _, _)
AND
GetHitpoints(_Var2, _Var4, _, _, _)
THEN
ApplyDamage(_Var2, _Var4, "Bludgeoning", _Var3);

PROC
PROC_DEN_AttackOnDen_CombatSetup()
AND
DB_DEN_AttackOnDen_WavePriority(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_WaveParticipants(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_GoblinBarrels(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 0);
RequestSetSwarmGroup(_Var1, _Var2);

IF
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 0, _Var1, _Var1, _Var1)
THEN
SetCanJoinCombat(_Var1, 0);
SetFaction(_Var1, ACT1_DEN_AttackRaiders_Standby_aca56eff-f292-1b69-8f22-ec96197b8d25);

IF
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1, _Var1, _Var1, _Var1)
THEN
SetCanJoinCombat(_Var1, 1);
SetFaction(_Var1, ACT1_DEN_AttackRaiders_Fighters_bfdc773b-6521-4fd1-3784-3d1404f1b2f5);
SetCombatGroupID(_Var1, "DEN_AttackOnDen_GateCombat");

IF
AttackedBy((CHARACTER)_Var1, (CHARACTER)_Var2, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 0, _Var1, _Var1, _Var1)
AND
IsEnemy(_Var1, _Var2, 1, _Var1, _Var1)
THEN
NOT DB_DEN_AttackOnDen_WaveParticipants(_Var1, 0);
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_CombatSetup()
THEN
TriggerSetAtmosphere(ATM_WLD_RangerCamp_G_Forest_LT_WLD_RangerCamp_9e8067fa-2c43-bf05-58e3-9fb308541417, "4c6be3e8-345c-8729-2c44-d2f57ce095cf");

PROC
PROC_DEN_AttackOnDen_VictoryInvitation()
THEN
TriggerResetAtmosphere(ATM_WLD_RangerCamp_G_Forest_LT_WLD_RangerCamp_9e8067fa-2c43-bf05-58e3-9fb308541417);

IF
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_Spiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_GateInUse(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsClosed(_Var2, 1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var1, _Var2, "GOB_SetAiTarget_DenGate");

IF
DualEntityEvent((CHARACTER)_Var1, (ITEM)_Var2, "GOB_SetAiTarget_DenGate", (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
AiAddInterestingItem(_Var1, _Var2);

IF
DualEntityEvent((CHARACTER)_Var1, (ITEM)_Var2, "GOB_ClearAiTarget_DenGate", (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
AiRemoveInterestingItem(_Var1, _Var2);

IF
Opened((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_WaveParticipants(_Var2, 1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_Spiders(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var2, _Var1, "GOB_ClearAiTarget_DenGate");

IF
Closed((ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_WaveParticipants(_Var2, 1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_Spiders(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetDualEntityEvent(_Var2, _Var1, "GOB_SetAiTarget_DenGate");

IF
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_Spiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetBaseArchetype(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 == "goblin_mage"
THEN
SetAiHint(_Var1, ACT1_DEN_AI_HINT_RAMPARTS_34ebba96-404b-42f9-9726-ac4063f37161);

IF
DB_DEN_AttackOnDen_Spiders(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetAiHint(_Var1, ACT1_DEN_AI_HINT_RAMPARTS_34ebba96-404b-42f9-9726-ac4063f37161);

IF
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_Spiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetBaseArchetype(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 == "goblin_melee"
THEN
RequestSetBaseArchetype(_Var1, "melee_ignoresurfacedamage");
SetAiHint(_Var1, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_DEN_AttackOnDen_Spiders(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetBaseArchetype(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 == "goblin_ranged"
THEN
RequestSetBaseArchetype(_Var1, "ranged_ignoresurfacedamage");
SetAiHint(_Var1, NULL_00000000-0000-0000-0000-000000000000);

IF
EnteredCombat(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND NOT
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_GateCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_TryAddNewWave();

IF
TurnStarted(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND NOT
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_GateCombat", _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
THEN
PROC_DEN_AttackOnDen_TryAddNewWave();

PROC
PROC_DEN_AttackOnDen_TryAddNewWave()
AND
DB_DEN_AttackOnDen_CurrentWave(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var1, 1, _Var2, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_Waves(_Var2, _Var3, _, _, _Var1)
THEN
NOT DB_DEN_AttackOnDen_CurrentWave(_Var1);
DB_DEN_AttackOnDen_CurrentWave(_Var2);
PROC_DEN_AttackOnDen_AddToNextWave(_Var3);

PROC
PROC_DEN_AttackOnDen_TryAddNewWave()
AND
DB_DEN_AttackOnDen_CurrentWave(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_Waves(_Var1, _, _, _Var4, _Var1)
AND
_Var4 != ""
THEN
TriggerSetAtmosphere(ATM_WLD_RangerCamp_G_Forest_LT_WLD_RangerCamp_9e8067fa-2c43-bf05-58e3-9fb308541417, _Var4);

PROC
PROC_DEN_AttackOnDen_AddToNextWave(_, _, _, _, _)
AND
DB_DEN_AttackOnDen_AddToNextWave(_Var2, _Var3, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_AddToNextWave(_Var2, _Var3);

PROC
PROC_DEN_AttackOnDen_AddToNextWave((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
SysCount("DB_DEN_AttackOnDen_WavePriority", 1, _Var2, _Var1, _Var1)
AND
_Var2 < 6
THEN
PROC_DEN_AttackOnDen_AllForcesJoinAttack();

PROC
PROC_DEN_AttackOnDen_AddToNextWave((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DEN_AttackOnDen_WavePriority(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
SysCount("DB_DEN_AttackOnDen_AddToNextWave", 2, _Var4, _Var1, _Var1)
AND
_Var4 < _Var1
THEN
PROC_DEN_AttackOnDen_JoinAttack(_Var2, _Var3, _Var4);

PROC
PROC_DEN_AttackOnDen_JoinAttack((CHARACTER)_Var1, (STRING)_Var2, (INTEGER)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_DEN_AttackOnDen_AddToNextWave(_Var1, _Var3);
NOT DB_DEN_AttackOnDen_WavePriority(_Var1, _Var2);
NOT DB_DEN_AttackOnDen_WaveParticipants(_Var1, 0);
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1);

PROC
PROC_DEN_AttackOnDen_AllForcesJoinAttack()
AND
QRY_OnlyOnce("DEN_AttackOnDen_AllForcesJoinAttack", _, _, _, _)
AND
DB_DEN_AttackOnDen_WavePriority(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_JoinAttack(_Var1, _Var2, 0);

PROC
PROC_StateSet_Defeated(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND NOT
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_RaiderCombat", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_AllForcesJoinAttack();

IF
Dying(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
AND NOT
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersInDen_5e839d5f-3e25-4b56-b758-81d25c9cbd33, _, _, _, _)
AND NOT
DB_DEN_AttackOnDen_DefeatCounterComplete("DEN_AttackOnDen_RaiderCombat", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_AllForcesJoinAttack();

IF
DestroyedBy((ITEM)_Var1, _, _, _, (ITEM)_Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DEN_AttackOnDen_AllForcesJoinAttack();

IF
DB_InRegion(_Var1, S_DEN_RaidersAggroArea_c4bc8b06-6b65-49a0-9e8a-89233c70a3a9, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_HiddenCharacters(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(S_DEN_RaidersAggroArea_c4bc8b06-6b65-49a0-9e8a-89233c70a3a9);
PROC_DEN_AttackOnDen_AllForcesJoinAttack();

IF
TextEvent("DEN_AttackOnDen_AllForcesJoinAttack", _, _, _, _)
THEN
PROC_DEN_AttackOnDen_AllForcesJoinAttack();

IF
DB_DEN_AttackOnDen_WaveParticipants(_Var1, 1, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(S_DEN_AttackOnDen_RaiderAiHintClear_d67da57d-9c81-4330-bbd1-0ca195d838ac, _Var1);

IF
EnteredTrigger((CHARACTER)_Var1, S_DEN_AttackOnDen_RaiderAiHintClear_d67da57d-9c81-4330-bbd1-0ca195d838ac, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetAiHint(_Var1, NULL_00000000-0000-0000-0000-000000000000);

IF
CastedSpell((CHARACTER)_Var1, "Shout_GOB_DetonateSelf", _, _, _)
AND
_Var1 != NULL_00000000-0000-0000-0000-000000000000
AND
IsCharacter(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetPosition(_Var1, _Var5, _Var6, _Var7, _Var1)
THEN
Die(_Var1, 0, _Var1, 1, 0);

PROC
PROC_DEN_AttackOnDen_StartCombat()
AND NOT
DB_DEN_AttackOnDen_SiegeIsActive(1, _, _, _, _)
THEN
DB_DEN_AttackOnDen_SiegeIsActive(1);
SetTag(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, AI_BLOCKWEAPONACTIONS_53c3304c-032d-4c49-86df-00b3b03a6b13);
SetStayInAiHints(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 1);
SetAiHint(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, AI_HINT_UNIQUE_1902723d-dd16-4e7a-87d6-7b07f63add79);

IF
DB_DEN_AttackOnDen_CurrentWave(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_DEN_AttackOnDen_Waves(_Var1, _, _Var3, _, _Var1)
THEN
SetFlag(_Var3, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);

IF
TurnStarted(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _, _)
AND
DB_DEN_AttackOnDen_SiegeIsActive(1, _, _, _, _)
THEN
PROC_TryStartAD(GOB_DrowCommander_AD_AttackOnDen_ee0c9dcb-8da8-6329-5a9d-737d864c4f8f, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

IF
TurnStarted(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _, _, _, _)
AND
DB_State_Current(S_DEN_RangerDen_SUB_50062397-bf9c-4765-9cbc-e40b5148f211, "DEN", "DEN_State_AttackOnDen", _, _)
AND
DB_OnlyOnce("DEN_AttackOnDen_DrowChargesGates", _, _, _, _)
AND
QRY_OnlyOnce("DEN_AttackOnDen_DrowChargesAD", _, _, _, _)
THEN
PROC_TryStartAD(GOB_DrowCommander_AD_AttackOnDen_ee0c9dcb-8da8-6329-5a9d-737d864c4f8f, S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b);

PROC
PROC_DEN_AttackOnDen_AllForcesJoinAttack()
THEN
NOT DB_DEN_AttackOnDen_SiegeIsActive(1);
ClearTag(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, AI_BLOCKWEAPONACTIONS_53c3304c-032d-4c49-86df-00b3b03a6b13);
SetAiHint(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, NULL_00000000-0000-0000-0000-000000000000);
SetStayInAiHints(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, 0);

PROC
PROC_DEN_AttackOnDen_AllForcesJoinAttack()
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsClosed(_Var1, 1, _Var1, _Var1, _Var1)
THEN
AiAddInterestingItem(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1);

IF
Opened((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
AiRemoveInterestingItem(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1);

IF
Closed((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DEN_GateInUse(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
AiAddInterestingItem(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, _Var1);

PROC
PROC_DEN_AttackOnDen_SetupNPC((GUIDSTRING)_Var1, "Gate", _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 != S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d
AND
_Var1 != S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a
THEN
DB_DEN_AttackOnDen_GateDefenderSwarmGroup(_Var1);
RequestSetSwarmGroup(_Var1, "DEN_AttackOnDen_GateDefenders");

PROC
PROC_DEN_AttackOnDen_EndOfCombat(_, _, _, _, _)
AND
DB_DEN_AttackOnDen_GateDefenderSwarmGroup(_Var2, _, _, _, _)
THEN
NOT DB_DEN_AttackOnDen_GateDefenderSwarmGroup(_Var2);
RequestSetSwarmGroup(_Var2, "");


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
