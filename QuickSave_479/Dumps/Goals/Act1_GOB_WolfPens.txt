Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_Dialogs(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, GOB_WolfPens_Parent_003_f1f511b0-f7fb-f726-0b94-4038fc67982f);
DB_Dialogs(S_GOB_WolfPens_Kid_001_dff4432a-85b4-4d5c-95b5-6d1179dbabf4, GOB_WolfPens_Kid_001_63d481d8-85f2-3c53-c137-9ddb31056a4f);
DB_Dialogs(S_GOB_WolfPens_Kid_002_fc3116bd-4ed0-4246-a7db-64b3a0fd48d1, GOB_WolfPens_Kid_002_3fdfa3ff-8262-aafa-248a-2f5d64f3f063);
DB_Dialogs(S_GOB_WolfPens_Beastmaster_001_20383707-2661-4d72-bcba-3aa4b2cbb35b, GOB_WolfPens_Beastmaster001_9d672460-8ea6-e7e4-25e9-dc16c343a2bd);
DB_Dialogs(S_GOB_WolfPens_Beastmaster_002_1fadb35a-6996-4a6a-bd0d-e695b53a3a14, GOB_WolfPens_Beastmaster002_d0cc40d6-eb66-38ea-1e78-7083e83ef2d0);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_HalsinsBear_AfterCombat_InCage_0a228bf7-fb12-c89b-4a31-b96505d9d783);
DB_GOB_WolfPens_LeversAndCages(S_GOB_WolfPens_LeverForCage001_611d4226-459f-46a9-be08-697553271bd4, S_GOB_WolfPens_CageDoor_001_d29ec2f5-46c0-41cc-8fee-a259338f33ad);
DB_GOB_WolfPens_LeversAndCages(S_GOB_WolfPens_LeverForCage002_1022a47d-cfc3-4c40-91a8-5c8568b50639, S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e);
DB_GLO_DefeatCounter(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, "GOB_WolfPens_DefeatCounter");
DB_GLO_DefeatCounter(S_GOB_WolfPens_Beastmaster_001_20383707-2661-4d72-bcba-3aa4b2cbb35b, "GOB_WolfPens_DefeatCounter");
DB_GLO_DefeatCounter(S_GOB_WolfPens_Beastmaster_002_1fadb35a-6996-4a6a-bd0d-e695b53a3a14, "GOB_WolfPens_DefeatCounter");
DB_GLO_DefeatCounter(S_GOB_WolfPens_Worg_001_47ed5f19-5289-485a-a031-95f7f32ce5c8, "GOB_WolfPens_DefeatCounter");
DB_GLO_DefeatCounter(S_GOB_WolfPens_Worg_002_f3dbcf5d-c3f5-46bc-8401-782f731a3de8, "GOB_WolfPens_DefeatCounter");
DB_GLO_DefeatCounter(S_GOB_PrisonGuard_000_96f411f3-5849-4608-b6fa-b7fb6ffaa7d6, "GOB_WolfPens_DefeatCounter");
DB_GOB_WolfPens_Beastmasters(S_GOB_WolfPens_Beastmaster_001_20383707-2661-4d72-bcba-3aa4b2cbb35b);
DB_GOB_WolfPens_Beastmasters(S_GOB_WolfPens_Beastmaster_002_1fadb35a-6996-4a6a-bd0d-e695b53a3a14);
DB_GOB_WolfPens_Reinforcement(S_GOB_RaiderArrogant_43d953fa-575e-452c-b220-939e6bdcc36b, S_GOB_WolfPens_ReinforcementPosition_001_080fafa8-22b6-45a6-8635-9188f9939114, S_GOB_ReinforcementDestination_01_c761439f-14e1-4175-ade7-186c3e002ff8);
DB_GOB_WolfPens_Reinforcement(S_GOB_RaiderCunning_abdd3748-0834-46f3-8214-18dd4dca9d40, S_GOB_WolfPens_ReinforcementPosition_002_333d2ac3-9172-429f-85d8-16f745c71a16, S_GOB_ReinforcementDestination_02_c49eaa8e-bcef-4794-becd-0fc992cd1fad);
DB_GOB_WolfPens_Reinforcement(S_GOB_RaiderStupid_5d049dbe-ff35-45be-88f9-5f999dc0ffe4, S_GOB_WolfPens_ReinforcementPosition_003_85abeba8-2d34-4b88-bfff-6c24ad85c11e, S_GOB_ReinforcementDestination_03_3cec1bbc-1032-4a4b-aee6-42fafd5b68c0);
DB_GOB_WolfPens_Kids(S_GOB_WolfPens_Kid_001_dff4432a-85b4-4d5c-95b5-6d1179dbabf4, GOB_WolfPens_AD_Warning_11362a16-9d94-6bee-bbd2-a35bac9e4b05);
DB_GOB_WolfPens_Kids(S_GOB_WolfPens_Kid_002_fc3116bd-4ed0-4246-a7db-64b3a0fd48d1, GOB_WolfPens_AD_Warning_002_5f3c4ec9-f0cd-27a1-2d9f-7c545487ee46);
DB_ItemOwnerShipTriggers("WLD_Main_A", S_GOB_WolfPens_OwnershipTrigger_f1e91f3a-7c64-4d5f-82bf-9cc709f6d642, S_GOB_WolfPens_Beastmaster_001_20383707-2661-4d72-bcba-3aa4b2cbb35b);
DB_ItemOwnerShipClearItem("WLD_Main_A", S_GOB_WolfPens_Exit_67d8b37a-4e5e-4548-b35c-785b7f504038);
DB_AutoSaveTrigger(S_GOB_WolfPens_Autosave_d6427f0e-d33e-4551-9d5e-fae100eb1981);
TriggerRegisterForItems(S_GOB_WolfPens_SplatteringTrigger_80390dec-caa3-4e6b-b2bc-632525d95dee);
TriggerRegisterForCharacter(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_CustomDialogRange(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 14);
DB_GOB_WolfPens_Prisoner_BeforeCombatDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_GroupDialogWithBear_2f6674c3-e4a8-7715-4ce5-d44261ad7c10);
DB_GOB_WolfPens_Prisoner_AfterCombatDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_HalsinsBear_AfterCombat_InCage_0a228bf7-fb12-c89b-4a31-b96505d9d783);
DB_GOB_WolfPens_Prisoner_AfterCombatDialog_OutsideCage(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
DB_GOB_WolfPens_Prisoner_AfterReleaseDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_AfterRelease_Bear_74de2e20-e083-50ab-81e3-92c06906d170);
DB_GOB_WolfPens_Prisoner_SceneInterruptionCombatFlags(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_State_BearEnraged_9b6a106b-6431-42b9-8ac1-48ba2a79e46b);
PROC_TriggerRegisterForPlayers(S_GOB_WolfPens_MainDialogTrigger_fdbf663a-8d8c-4037-9e1f-128a1f1f6d3b);
DB_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_DoorAttackedInCinematic_f69d26a9-48e8-4b82-8f21-59ecf0ee5b90, GOB_WolfPens_GroupDialogWithBear_2f6674c3-e4a8-7715-4ce5-d44261ad7c10);
DB_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_DoorAttackedInCinematic_f69d26a9-48e8-4b82-8f21-59ecf0ee5b90, GOB_WolfPens_CombatCutscene_Bear_97680fca-99e9-2fa7-5282-48e386e03423);
DB_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_PersuadedToReleasePrisoner_e49112a6-09e1-4a0a-95cc-0e6c8097b2be, GOB_WolfPens_GroupDialogWithBear_2f6674c3-e4a8-7715-4ce5-d44261ad7c10);
DB_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_HalsinLeftParty_c67822f6-a2f4-4d22-94c2-0824f2ac3f62, GOB_WolfPens_Halsin_Following_4c8c0646-03ab-6449-15be-a8a32a31da49);
DB_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_HalsinLeftParty_c67822f6-a2f4-4d22-94c2-0824f2ac3f62, GOB_WolfPens_Halsin_Following_Elf_26317dd0-f609-1b72-27d0-602d4b3e1013);
DB_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_HalsinLeavesGoblinCamp_a247e755-d8a0-4938-d122-d8ad9f48a674, GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
DB_FlagReactionAfterDialog(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
DB_DropMutingStatussesDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
DB_Dialogs_DialogBlockRestoreMutingStatuses(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_AddCharactersInTriggerToDialog(GOB_WolfPens_GroupDialogWithBear_2f6674c3-e4a8-7715-4ce5-d44261ad7c10, S_GOB_WolfPens_MainDialogTrigger_fdbf663a-8d8c-4037-9e1f-128a1f1f6d3b, 1, 0, 1);
DB_AddCharactersInTriggerToDialog(GOB_WolfPens_CombatCutscene_Bear_97680fca-99e9-2fa7-5282-48e386e03423, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, 1, 0, 1);
DB_GOB_WolfPens_Prisoner_CombatCutscenes(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_CombatCutscene_Bear_97680fca-99e9-2fa7-5282-48e386e03423);
DB_PermaDefeatedEvent(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, GOB_WolfPens_State_GoblinParentIsDead_5e4df0db-91cd-461e-b80e-a647afa36dec);
DB_GOB_WolfPens_Worgs(S_GOB_WolfPens_Worg_001_47ed5f19-5289-485a-a031-95f7f32ce5c8);
DB_GOB_WolfPens_Worgs(S_GOB_WolfPens_Worg_002_f3dbcf5d-c3f5-46bc-8401-782f731a3de8);
DB_SceneTriggerManager("GOB_WolfPens", S_GOB_WolfPens_MainDialogTrigger_fdbf663a-8d8c-4037-9e1f-128a1f1f6d3b, 0);
DB_SceneManager(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, "GOB_WolfPens");
DB_SceneManager(S_GOB_WolfPens_Kid_001_dff4432a-85b4-4d5c-95b5-6d1179dbabf4, "GOB_WolfPens");
DB_SceneManager(S_GOB_WolfPens_Kid_002_fc3116bd-4ed0-4246-a7db-64b3a0fd48d1, "GOB_WolfPens");
DB_PermaDefeatedEvent(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GLO_Halsin_State_PermaDefeated_86bc3df1-08b4-fbc4-b542-6241bcd03df1);
DB_GLO_CompoundFlag(GLO_Halsin_State_PermaDefeated_86bc3df1-08b4-fbc4-b542-6241bcd03df1, GOB_WolfPens_State_PrisonerPermaDefeated_a1bd5b3f-c4fe-4fac-b3b6-52367e97b545);
DB_OnlyOnce("GOB_WolfPens_DontReplaceBear");
PROC_GOB_WolfPens_Init();
DB_GOB_WolfPens_ExitPoints(S_GOB_ThroneRoom_Door_Exit_7cfeb44e-e17e-44ea-b42e-b2a4a4fca58c);
DB_GOB_WolfPens_ExitPoints(S_GOB_GoblinPriest_SecludedRoomDoor_685bbe73-b643-4096-aa70-a06875598218);
DB_GOB_WolfPens_ExitPoints(S_GOB_GoblinPriest_SecludedRoom_DoorFromSpiders_b7393877-e52a-4eee-b922-ee4308210e3f);
DB_GOB_WolfPens_ExitPoints(S_GOB_GoblinThrone_SecretEntrance_LadderFrom_1e4c968c-370c-4c8d-a074-ab227d85b28d);
DB_GOB_WolfPens_GoblinTempleTriggers(S_GOB_ThroneRoom_SUB_bb81678b-641c-43fc-bd41-53295d59be03);
DB_GOB_WolfPens_GoblinTempleTriggers(S_GOB_PriestDungeon_SUB_d693268c-84c9-44c2-ac7d-11ebc5524764);
DB_GOB_WolfPens_GoblinTempleTriggers(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6);
DB_GOB_WolfPens_Corpses(S_GOB_WolfPens_Worg_001_47ed5f19-5289-485a-a031-95f7f32ce5c8, S_GOB_WolfPens_Corpses_Worg_001_387ff778-5012-46a7-a229-5cbb937e36b3);
DB_GOB_WolfPens_Corpses(S_GOB_WolfPens_Worg_002_f3dbcf5d-c3f5-46bc-8401-782f731a3de8, S_GOB_WolfPens_Corpses_Worg_002_86a5ff1f-ba88-47c5-91b3-8b9ce0af2242);
DB_GOB_WolfPens_Corpses(S_GOB_WolfPens_Beastmaster_001_20383707-2661-4d72-bcba-3aa4b2cbb35b, S_GOB_WolfPens_Corpses_Beastmaster_001_387ff778-5012-46a7-a229-5cbb937e36b3);
DB_GOB_WolfPens_Corpses(S_GOB_WolfPens_Beastmaster_002_1fadb35a-6996-4a6a-bd0d-e695b53a3a14, S_GOB_WolfPens_Corpses_Beastmaster_002_aac24980-638e-4feb-8b2e-5eaeeddda387);
DB_CorpseLooting_ClearRedOutlineOnFactionGroupTagged("WLD_Main_A", "Act1_GOB_WolfPens", ACT1_GOB_WolfPens_7adb52e1-1e4d-5312-3b0e-eb262d0a72e0, PERMA_DEFEATED_OR_OFFSTAGE_b9e63705-637a-4d3b-87ef-a49324cf703f);
DB_FactionTagging_FactionTagged("WLD_Main_A", ACT1_GOB_WolfPens_Backup_805a2548-8ff2-464e-d975-b34e703f7825, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727);
DB_IgnoreMutingStatussesDialog(GOB_WolfPens_CombatCutscene_Bear_97680fca-99e9-2fa7-5282-48e386e03423);

KBSECTION
PROC
PROC_GLO_DefeatCounter_AllDefeated("GOB_WolfPens_DefeatCounter", _, _, _, _)
THEN
SetFlag(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_GOB_WolfPens_Kids(_Var1, _, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(S_GOB_WolfPens_KidsEscapeArea_684454aa-3632-442b-a48d-e0bca0d553bc, _Var1);

IF
DB_GOB_WolfPens_Worgs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SpotPlayers(_Var1, "GOB_WolfPens_Worgs", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger(_Var1, "GOB_WolfPens_Worgs", S_GOB_WolfPens_Cage_001_9aea6349-9a8f-453d-ad86-fee65a820bdf);
TriggerRegisterForCharacter(S_GOB_WolfPens_Cage_001_9aea6349-9a8f-453d-ad86-fee65a820bdf, _Var1);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "GOB_WolfPens_Worgs", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_SetRelationToPlayers(ACT1_GOB_WolfPens_7adb52e1-1e4d-5312-3b0e-eb262d0a72e0, 0);

IF
FlagSet(GOB_WolfPens_Event_SidedWithGoblins_8887d64d-f76a-4410-b5a5-9f33f0362a64, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_GOB_WolfPens_Worg_001_47ed5f19-5289-485a-a031-95f7f32ce5c8, "GOB_WolfPens_Worgs");
PROC_SpotPlayers_StopSpotting(S_GOB_WolfPens_Worg_002_f3dbcf5d-c3f5-46bc-8401-782f731a3de8, "GOB_WolfPens_Worgs");

IF
Opened(S_GOB_WolfPens_CageDoor_001_d29ec2f5-46c0-41cc-8fee-a259338f33ad, _, _, _, _)
AND NOT
DB_GlobalFlag(GOB_WolfPens_Event_SidedWithGoblins_8887d64d-f76a-4410-b5a5-9f33f0362a64, _, _, _, _)
AND NOT
DB_GlobalFlag(GOB_WolfPens_State_CombatInProgress_7253c9e4-4d4d-4cc1-a8b3-ba36b2e2c6ec, _, _, _, _)
THEN
PROC_SetRelationToPlayers(ACT1_GOB_WolfPens_Worgs_2df5ac7c-486f-ad96-dabb-31cf3b26dc89, 0);

IF
DualEntityEvent((CHARACTER)_Var1, (ITEM)_Var2, "GOB_WolfPens_OpenCage", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_LeversAndCages(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
IsDestroyed(_Var3, 0, _Var1, _Var1, _Var1)
THEN
Unlock(_Var3);
Open(_Var3);

IF
DualEntityEvent((CHARACTER)_Var1, (ITEM)_Var2, "GOB_WolfPens_CloseCage", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_LeversAndCages(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
IsDestroyed(_Var3, 0, _Var1, _Var1, _Var1)
THEN
Close(_Var3);
Lock(_Var3, "GOB_WolfPens");

PROC
PROC_GOB_WolfPens_Init()
AND
QRY_OnlyOnce("GOB_WolfPens_Init", _, _, _, _)
THEN
PROC_GOB_WolfPens_Imprison(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
PROC_GLO_Halsin_ApplyWildshape();
SetTag(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, BLOCK_RESURRECTION_22a75dbb-1588-407e-b559-5aa4e6d4e6a6);
ApplyStatus(S_GOB_WolfPens_MeatPlaceholder_0c8ee3ad-4f89-49df-9ae6-1309482072ee, "INVULNERABLE_NOT_SHOWN", -1);
SetOnStage(S_GOB_WolfPens_MeatPlaceholder_0c8ee3ad-4f89-49df-9ae6-1309482072ee, 0);
PROC_CharacterDisableCrime(S_GOB_WolfPens_Worg_001_47ed5f19-5289-485a-a031-95f7f32ce5c8, "UseForbiddenItem");
PROC_CharacterDisableCrime(S_GOB_WolfPens_Worg_002_f3dbcf5d-c3f5-46bc-8401-782f731a3de8, "UseForbiddenItem");

IF
DB_GLO_DefeatCounter(_Var1, "GOB_WolfPens_DefeatCounter", _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(S_GOB_WolfPens_DoorDamageTrigger_35e21ace-d889-4239-a8bc-e1b12ea33b80, _Var1);

PROC
PROC_GOB_WolfPens_Imprison((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_SelfHealing_Disable(_Var1);
DB_GOB_WolfPens_Prisoner(_Var1);
PROC_CharacterDisableAllCrimes(_Var1, 1);
SetCanTrade(_Var1, 0);
PROC_SetCanFight(_Var1, 0);
SetCanJoinCombat(_Var1, 0);
SetTag(_Var1, IGNORE_DANGEROUS_SURFACES_bbf62461-4af4-4631-807a-eb0bd988d9a6);
DB_NoLowAttitudeDialog(_Var1);
TriggerRegisterForCharacter(S_GOB_WolfPens_Cage_002_59104718-66ff-418a-b7ac-46696a1e2fc3, _Var1);
DB_SceneManager(_Var1, "GOB_WolfPens");
DB_SceneNoHostileContinuousDisturbance("GOB_WolfPens");
DB_PermaDefeatedEvent(_Var1, GOB_WolfPens_State_PrisonerPermaDefeated_a1bd5b3f-c4fe-4fac-b3b6-52367e97b545);

PROC
PROC_GOB_WolfPens_Release((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
NOT DB_GOB_WolfPens_Prisoner(_Var1);
PROC_GOB_WolfPens_RestorePrisonerParams(_Var1);
TriggerUnregisterForCharacter(S_GOB_WolfPens_Cage_002_59104718-66ff-418a-b7ac-46696a1e2fc3, _Var1);
NOT DB_PermaDefeatedEvent(_Var1, GOB_WolfPens_State_PrisonerPermaDefeated_a1bd5b3f-c4fe-4fac-b3b6-52367e97b545);
PROC_SpotPlayers_StopSpotting(_Var1, "GOB_WolfPens");

PROC
PROC_GOB_WolfPens_RestorePrisonerParams((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_SetCanFight(_Var1, 1);
SetCanJoinCombat(_Var1, 1);
NOT DB_NoLowAttitudeDialog(_Var1);
PROC_CharacterEnableAllCrimes(_Var1);
ClearTag(_Var1, IGNORE_DANGEROUS_SURFACES_bbf62461-4af4-4631-807a-eb0bd988d9a6);
TriggerUnregisterForCharacter(S_GOB_WolfPens_Cage_002_59104718-66ff-418a-b7ac-46696a1e2fc3, _Var1);
NOT DB_SceneManager(_Var1, "GOB_WolfPens");
NOT DB_SpotPlayers(_Var1, "GOB_WolfPens", NULL_00000000-0000-0000-0000-000000000000, GOB_WolfPens_Event_StopSpottingForMainDialog_33fceac3-40d9-4c55-b09c-2d7f17aab059);
PROC_SpotPlayers_ClearSpotTrigger(_Var1, "GOB_WolfPens");

IF
DB_SceneManager(_Var1, "GOB_WolfPens", _Var1, _Var1, _Var1)
THEN
DB_SpotPlayers(_Var1, "GOB_WolfPens", NULL_00000000-0000-0000-0000-000000000000, GOB_WolfPens_Event_StopSpottingForMainDialog_33fceac3-40d9-4c55-b09c-2d7f17aab059);
DB_SpotPlayers_SpotTrigger(_Var1, "GOB_WolfPens", S_GOB_WolfPens_AutoStartDialogTrigger_756da918-0270-4e27-b74c-3bfcf863bf1f);
DB_SpotPlayers_SpotTrigger(_Var1, "GOB_WolfPens", S_GOB_WolfPens_Cage_002_59104718-66ff-418a-b7ac-46696a1e2fc3);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, (CHARACTER)_Var2, "GOB_WolfPens", "Attacked", (GUIDSTRING)_Var1)
THEN
PROC_GOB_WolfPens_SceneInterrupted(_Var1, _Var2);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, (CHARACTER)_Var2, "GOB_WolfPens", "Died", (GUIDSTRING)_Var1)
AND
QRY_GOB_WolfPens_GoblinDiedInCinematic(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_SceneInterrupted((CHARACTER)_Var1, (CHARACTER)_Var2, "GOB_WolfPens", "Died", (CHARACTER)_Var1)
AND NOT
QRY_GOB_WolfPens_GoblinDiedInCinematic(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_SceneInterrupted(_Var1, _Var2);

QRY
QRY_GOB_WolfPens_GoblinDiedInCinematic((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 == S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0
AND
GetFlag(GOB_WolfPens_Event_DoorAttackedInCinematic_f69d26a9-48e8-4b82-8f21-59ecf0ee5b90, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, (CHARACTER)_Var2, "GOB_WolfPens", "EnteredCombat", (GUIDSTRING)_Var1)
THEN
PROC_GOB_WolfPens_SceneInterrupted(_Var1, _Var2);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, (CHARACTER)_Var2, "GOB_WolfPens", "DestroyedItem", (GUIDSTRING)_Var1)
AND
_Var1 == GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e
THEN
PROC_GOB_WolfPens_SceneInterrupted(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, _Var2);

PROC
PROC_GOB_WolfPens_SceneInterrupted((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_SceneOver("GOB_WolfPens");
PROC_GOB_WolfPens_StopMainSpotting();
PROC_GOB_WolfPens_SceneInterrupted_StartFight();
PROC_GOB_WolfPens_ForceCombat(_Var1, _Var2);
PROC_GOB_WolfPens_SceneInterrupted_ForceStopDialog(_Var1);

PROC
PROC_GOB_WolfPens_ForceCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_DefeatCounter(_Var3, "GOB_WolfPens_DefeatCounter", _Var1, _Var1, _Var1)
AND
_Var3 != _Var1
AND NOT
DB_Defeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_EnterCombat(_Var3, _Var2);
PROC_EnterCombat(_Var3, _Var4);

PROC
PROC_GOB_WolfPens_SceneInterrupted_ForceStopDialog((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
PROC_ForceStopDialog(_Var1);

PROC
PROC_GOB_WolfPens_SceneInterrupted_StartFight()
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetCanFight(_Var1, 1);
SetCanJoinCombat(_Var1, 1);

PROC
PROC_GOB_WolfPens_SceneInterrupted_StartFight()
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner_SceneInterruptionCombatFlags(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_WolfPens_Event_SidedWithPrisoner_0c160e6c-0a72-4093-9e8c-3094962ef57a, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(_Var2, NULL_00000000-0000-0000-0000-000000000000);
PROC_GOB_WolfPens_StartFight();

IF
DialogStarted((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner_BeforeCombatDialog(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_StopMainSpotting();

IF
DialogEnded((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner_BeforeCombatDialog(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_WolfPens_Event_PersuadedToReleasePrisoner_e49112a6-09e1-4a0a-95cc-0e6c8097b2be, NULL_00000000-0000-0000-0000-000000000000, 0, _Var1, _Var1)
THEN
PROC_SceneOver("GOB_WolfPens");

PROC
PROC_GOB_WolfPens_StopMainSpotting()
THEN
DB_GOB_WolfPens_MainSpottingStopped(1);

PROC
PROC_GOB_WolfPens_StopMainSpotting()
THEN
PROC_SpotPlayers_StopSpotting(S_GOB_WolfPens_Kid_001_dff4432a-85b4-4d5c-95b5-6d1179dbabf4, "GOB_WolfPens");
PROC_SpotPlayers_StopSpotting(S_GOB_WolfPens_Kid_002_fc3116bd-4ed0-4246-a7db-64b3a0fd48d1, "GOB_WolfPens");
PROC_SpotPlayers_StopSpotting(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, "GOB_WolfPens");

PROC
PROC_GOB_WolfPens_StopMainSpotting()
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting(_Var1, "GOB_WolfPens");

PROC
PROC_SpotPlayers_Spotted((GUIDSTRING)_Var1, "GOB_WolfPens", (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GOB_WolfPens_MainSpottingStopped(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_StartGroupDialogWithPrisoner(_Var2, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_InternPlayerSpot_Spotting(_Var1, "GOB_WolfPens", _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_StartGroupDialogWithPrisoner(_Var2, _Var1);

PROC
PROC_GOB_WolfPens_StartGroupDialogWithPrisoner((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner_BeforeCombatDialog(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
DB_Dialogs(_Var2, _Var5, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var4, S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, S_GOB_WolfPens_Kid_001_dff4432a-85b4-4d5c-95b5-6d1179dbabf4, S_GOB_WolfPens_Kid_002_fc3116bd-4ed0-4246-a7db-64b3a0fd48d1, _Var3, _Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_DialogShouldIgnoreMutingStatusses(GOB_WolfPens_GroupDialogWithBear_2f6674c3-e4a8-7715-4ce5-d44261ad7c10, _, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _)
AND
DB_QRYRTN_DialogShouldIgnoreMutingStatusses(0, _, _, _, _)
THEN
NOT DB_QRYRTN_DialogShouldIgnoreMutingStatusses(0);
DB_QRYRTN_DialogShouldIgnoreMutingStatusses(1);

IF
DialogEnded((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner_BeforeCombatDialog(_, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(GOB_WolfPens_State_MainDialogEnded_5dd5553d-8a15-583c-40e8-911d960a18d0);

PROC
PROC_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_PersuadedToReleasePrisoner_e49112a6-09e1-4a0a-95cc-0e6c8097b2be, _, _, _, _)
THEN
PROC_GOB_WolfPens_PersuasionResult();

PROC
PROC_GOB_WolfPens_PersuasionResult()
THEN
Use(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, S_GOB_WolfPens_LeverForCage002_1022a47d-cfc3-4c40-91a8-5c8568b50639, "GOB_WolfPens_LeverUsed");

IF
FlagSet(GOB_WolfPens_Event_DoorAttackedInCinematic_f69d26a9-48e8-4b82-8f21-59ecf0ee5b90, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
SetOnStage(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, 0);

IF
FlagSet(GOB_WolfPens_Event_DoorAttackedInCinematic_f69d26a9-48e8-4b82-8f21-59ecf0ee5b90, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND
IsInTrigger(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, S_GOB_WolfPens_DoorDamageTrigger_35e21ace-d889-4239-a8bc-e1b12ea33b80, 1, _, _)
AND
IsDead(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, 0, _, _, _)
THEN
DB_DialogDeath(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0);
Die(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);
CreateSurface(S_GOB_WolfPens_SplatteringTrigger_80390dec-caa3-4e6b-b2bc-632525d95dee, "SurfaceBlood", 1, -1);

IF
AttackedBy(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, (CHARACTER)_Var1, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PlaySound(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, "SE_GOB_PrisonDoor_Smashed_By_Halsin_Bear_01");
TimerLaunch("GOB_WolfPens_MoveDoor", 400);

IF
TimerFinished("GOB_WolfPens_MoveDoor", _, _, _, _)
THEN
ItemMoveTo(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, S_GOB_WolfPens_DoorEndPosition_c4452482-6976-453e-9f97-08d2ffe9b686, 15, 10, 0);

IF
ItemEnteredTrigger(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, S_GOB_WolfPens_SplatteringTrigger_80390dec-caa3-4e6b-b2bc-632525d95dee, _, _, _)
AND
IsInTrigger(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, S_GOB_WolfPens_DoorDamageTrigger_35e21ace-d889-4239-a8bc-e1b12ea33b80, 1, _, _)
AND
IsDead(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, 0, _, _, _)
THEN
Die(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);
CreateSurface(S_GOB_WolfPens_SplatteringTrigger_80390dec-caa3-4e6b-b2bc-632525d95dee, "SurfaceBlood", 1, -1);

IF
ItemEnteredTrigger(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, S_GOB_WolfPens_SplatteringTrigger_80390dec-caa3-4e6b-b2bc-632525d95dee, _, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND
IsInTrigger(_Var2, S_GOB_WolfPens_DoorDamageTrigger_35e21ace-d889-4239-a8bc-e1b12ea33b80, 1, _, _)
AND NOT
DB_GlobalFlag(GOB_WolfPens_Event_DoorAttackedInCinematic_f69d26a9-48e8-4b82-8f21-59ecf0ee5b90, _, _, _, _)
AND
Random(10, _Var3, _, _, _)
AND
IntegerProduct(_Var3, 3, _Var4, _, _)
THEN
ApplyDamage(_Var2, _Var4, "Bludgeoning", S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e);

IF
ItemEnteredTrigger(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, S_GOB_WolfPens_SplatteringTrigger_80390dec-caa3-4e6b-b2bc-632525d95dee, _, _, _)
AND
DB_GLO_DefeatCounter(_Var2, "GOB_WolfPens_DefeatCounter", _, _, _)
AND
_Var2 != S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0
AND
IsInTrigger(_Var2, S_GOB_WolfPens_DoorDamageTrigger_35e21ace-d889-4239-a8bc-e1b12ea33b80, 1, _, _)
AND
Random(10, _Var3, _, _, _)
AND
IntegerProduct(_Var3, 3, _Var4, _, _)
THEN
ApplyDamage(_Var2, _Var4, "Bludgeoning", S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e);

IF
EnteredTrigger(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, S_GOB_WolfPens_DoorDamageTrigger_35e21ace-d889-4239-a8bc-e1b12ea33b80, _, _, _)
THEN
SetFlag(GOB_WolfPens_State_GoblinParentIsInPositionForCinematic_5b59e7e5-1a82-4add-860d-6a512961b4b3, NULL_00000000-0000-0000-0000-000000000000);

IF
LeftTrigger(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, S_GOB_WolfPens_DoorDamageTrigger_35e21ace-d889-4239-a8bc-e1b12ea33b80, _, _, _)
THEN
ClearFlag(GOB_WolfPens_State_GoblinParentIsInPositionForCinematic_5b59e7e5-1a82-4add-860d-6a512961b4b3, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_PermaDefeated(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, _, _, _, _)
THEN
ClearFlag(GOB_WolfPens_State_GoblinParentIsInPositionForCinematic_5b59e7e5-1a82-4add-860d-6a512961b4b3);

IF
ItemEnteredTrigger(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, S_GOB_WolfPens_SplatteringTrigger_80390dec-caa3-4e6b-b2bc-632525d95dee, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetOnStage(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, 0);

IF
WentOnStage(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, 0, _, _, _)
THEN
Die(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

IF
LeftTrigger((GUIDSTRING)_Var1, S_GOB_WolfPens_Cage_002_59104718-66ff-418a-b7ac-46696a1e2fc3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ObjectTimerLaunch(_Var1, "GOB_WolfPens_PrisonerLeftCage", 1000);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "GOB_WolfPens_PrisonerLeftCage", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFlag(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, _Var1);

IF
FlagSet(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner_AfterCombatDialog(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner_AfterCombatDialog_OutsideCage(_Var1, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_StopMainSpotting();
PROC_SceneOver("GOB_WolfPens");
NOT DB_GOB_WolfPens_Prisoner_AfterCombatDialog(_Var1, _Var3);
DB_GOB_WolfPens_Prisoner_AfterCombatDialog(_Var1, _Var4);
PROC_RemoveAllDialogEntriesForSpeaker(_Var1);
DB_Dialogs(_Var1, _Var4);
PROC_GOB_WolfPens_RestorePrisonerParams(_Var1);
PROC_GOB_WolfPens_CheckPrepareForAfterCombatDialog(_Var1);

PROC
PROC_GOB_WolfPens_CheckPrepareForAfterCombatDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_PrepareForAfterCombatDialog(_Var1);

IF
FlagSet(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, (GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GlobalFlag(GOB_WolfPens_State_BearEnraged_9b6a106b-6431-42b9-8ac1-48ba2a79e46b, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(GOB_WolfPens_State_BearEnraged_9b6a106b-6431-42b9-8ac1-48ba2a79e46b, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_WolfPens_Event_PersuadedToReleasePrisoner_e49112a6-09e1-4a0a-95cc-0e6c8097b2be, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(GOB_WolfPens_State_MainDialogEnded_5dd5553d-8a15-583c-40e8-911d960a18d0, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_StartFight();

IF
FlagSet(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_WolfPens_Event_PersuadedToReleasePrisoner_e49112a6-09e1-4a0a-95cc-0e6c8097b2be, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(GOB_WolfPens_State_MainDialogEnded_5dd5553d-8a15-583c-40e8-911d960a18d0, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_WolfPens_Event_SidedWithPrisoner_0c160e6c-0a72-4093-9e8c-3094962ef57a);
PROC_GOB_WolfPens_StartFight();

IF
FlagSet(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(GOB_WolfPens_Event_PersuadedToReleasePrisoner_e49112a6-09e1-4a0a-95cc-0e6c8097b2be, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_TryStartAfterReleaseDialog();

PROC
PROC_GOB_WolfPens_TryStartAfterReleaseDialog()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_WolfPens_State_PersuadedToReleasePrisoner_5dd13aaf-6906-4aad-b4d5-0c187bc172b4, _Var1, 1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner_AfterReleaseDialog(_Var2, _Var3, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(_Var3, _Var2, S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, _Var1, _Var1)
THEN
SetFlag(GOB_WolfPens_Event_SidedWithPrisoner_0c160e6c-0a72-4093-9e8c-3094962ef57a, NULL_00000000-0000-0000-0000-000000000000);
PROC_SceneOver("GOB_WolfPens");
PROC_GOB_WolfPens_StartFight();

QRY
QRY_DialogShouldIgnoreMutingStatusses(GOB_WolfPens_AfterRelease_Bear_74de2e20-e083-50ab-81e3-92c06906d170, _, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _)
AND NOT
DB_Is_EngineBlock_Talk(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
THEN
NOT DB_QRYRTN_DialogShouldIgnoreMutingStatusses(0);
DB_QRYRTN_DialogShouldIgnoreMutingStatusses(1);

IF
DialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GOB_WolfPens_Prisoner_AfterReleaseDialog(_, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SceneOver("GOB_WolfPens");
PROC_GOB_WolfPens_StartFight();

PROC
PROC_GOB_WolfPens_StartFight()
THEN
PROC_GOB_WolfPens_UpdateWolfPensToPrisonerRelation();
PROC_GOB_WolfPens_UpdateWolfPensToPlayerRelation();
PROC_GOB_WolfPens_UpdatePrisonerToPlayerRelation();

PROC
PROC_GOB_WolfPens_UpdateWolfPensToPrisonerRelation()
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFaction(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationMutual(_Var2, ACT1_GOB_WolfPens_7adb52e1-1e4d-5312-3b0e-eb262d0a72e0, 0);

PROC
PROC_GOB_WolfPens_UpdateWolfPensToPlayerRelation()
AND
GetFlag(GOB_WolfPens_Event_SidedWithGoblins_8887d64d-f76a-4410-b5a5-9f33f0362a64, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
PROC_SetRelationToPlayers(ACT1_GOB_WolfPens_7adb52e1-1e4d-5312-3b0e-eb262d0a72e0, 100);

PROC
PROC_GOB_WolfPens_UpdateWolfPensToPlayerRelation()
AND
GetFlag(GOB_WolfPens_Event_SidedWithPrisoner_0c160e6c-0a72-4093-9e8c-3094962ef57a, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
THEN
PROC_SetRelationToPlayers(ACT1_GOB_WolfPens_7adb52e1-1e4d-5312-3b0e-eb262d0a72e0, 0);

PROC
PROC_GOB_WolfPens_UpdatePrisonerToPlayerRelation()
AND
GetFlag(GOB_WolfPens_Event_SidedWithPrisoner_0c160e6c-0a72-4093-9e8c-3094962ef57a, NULL_00000000-0000-0000-0000-000000000000, 1, _, _)
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFaction(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(_Var2, 100);

PROC
PROC_GOB_WolfPens_UpdatePrisonerToPlayerRelation()
AND
GetFlag(GOB_WolfPens_Event_SidedWithPrisoner_0c160e6c-0a72-4093-9e8c-3094962ef57a, NULL_00000000-0000-0000-0000-000000000000, 0, _, _)
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, 1, _Var1, _Var1)
AND
GetFaction(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(_Var2, 0);

IF
CombatStarted((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_DefeatCounter(_Var2, "GOB_WolfPens_DefeatCounter", _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_WolfPens_CombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_WolfPens_CombatID(_Var1);
SetFlag(GOB_WolfPens_State_CombatInProgress_7253c9e4-4d4d-4cc1-a8b3-ba36b2e2c6ec, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(GOB_WolfPens_Event_StopSpottingForMainDialog_33fceac3-40d9-4c55-b09c-2d7f17aab059, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_GlobalFlag(GOB_DrowCommander_Event_RaidersSortie_26816b01-2d64-b50c-3bf6-bffd7dc5f0b9, _, _, _, _)
THEN
DB_GOB_WolfPens_ReinforcementBlocked(1);

IF
EnteredTrigger((CHARACTER)_Var1, S_GOB_WolfPens_KidsEscapeArea_684454aa-3632-442b-a48d-e0bca0d553bc, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Kids(_Var1, _, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var1, 1, _Var1, _Var1, _Var1)
THEN
SetCanJoinCombat(_Var1, 0);
LeaveCombat(_Var1);
PROC_CharacterMoveTo(_Var1, S_GOB_WolfPens_EntranceTrigger_8e107d0e-cb7d-44d7-b92a-19a5f2f9974a, "Run", "GOB_WolfPens_Event_WarnAdults");

IF
EntityEvent((CHARACTER)_Var1, "GOB_WolfPens_Event_WarnAdults", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Kids(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_OnlyOnce("GOB_WolfPens_WarningReinforcement", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 1, "");

IF
EntityEvent((CHARACTER)_Var1, "GOB_WolfPens_Event_WarnAdults", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Kids(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("GOB_WolfPens_WarningReinforcement", _Var1, _Var1, _Var1, _Var1)
THEN
LookFromTrigger(_Var1, S_GOB_WolfPens_EntranceTrigger_8e107d0e-cb7d-44d7-b92a-19a5f2f9974a, 0);
PROC_TryStartAD(_Var2, _Var1);

IF
AutomatedDialogEnded((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GOB_WolfPens_Kids(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var3, "Run", 1, "");
PROC_GOB_WolfPens_SendReinforcement();

IF
DB_Was_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_CombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsCharacter(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "ClearPeaceReturn", 1);

IF
DB_Was_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_CombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsCharacter(_Var1, 1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Beastmasters(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GOB_WolfPens_CommentedOnPrisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "GOB_WolfPens_CommentOnPrisonersBody");
DB_GOB_WolfPens_CommentedOnPrisoner(_Var1);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_CombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(GLO_Halsin_State_PermaDefeated_86bc3df1-08b4-fbc4-b542-6241bcd03df1, _Var1, _Var1, _Var1, _Var1)
AND
GetClosestAlivePlayer(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 < 20
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(GOB_WolfPens_HalsinDiedBearform_ec786e87-df01-1b5f-99cf-aab0ff9f3f72, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_CombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_AfterCombat_PrepareAfterCombatDialog();
PROC_GOB_WolfPens_AfterCombat_ClearCombatDB(_Var1);

PROC
PROC_GOB_WolfPens_AfterCombat_ClearCombatDB((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(GOB_WolfPens_State_CombatInProgress_7253c9e4-4d4d-4cc1-a8b3-ba36b2e2c6ec, NULL_00000000-0000-0000-0000-000000000000);
ClearFlag(GOB_WolfPens_Event_StopSpottingForMainDialog_33fceac3-40d9-4c55-b09c-2d7f17aab059, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_GOB_WolfPens_CombatID(_Var1);

PROC
PROC_GOB_WolfPens_AfterCombat_PrepareAfterCombatDialog()
AND
DB_GlobalFlag(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6, _, _, _, _)
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_PrepareForAfterCombatDialog(_Var1);

IF
FlagSet(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6, _, _, _, _)
AND NOT
DB_GOB_WolfPens_CombatID(_, _, _, _, _)
AND
DB_GOB_WolfPens_Prisoner(_Var4, _, _, _, _)
THEN
PROC_GOB_WolfPens_PrepareForAfterCombatDialog(_Var4);

PROC
PROC_GOB_WolfPens_PrepareForAfterCombatDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
THEN
PROC_CharacterDisableAllCrimes(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
PROC_CharacterEnableCrime(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "Assault");

PROC
PROC_GOB_WolfPens_PrepareForAfterCombatDialog((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
QRY_GOB_WolfPens_Imprisoned()
AND
IsInTrigger(_Var1, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, 1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("GOB_WolfPens_PrepareForAfterCombatDialog", _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("GOB_WolfPens_PrepareForAfterCombatDialog");
PROC_CharacterRegisterCrime(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "GOB_WolfPens_EscapedPrisoner", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_GLO_Halsin_RemoveWildshape();
SetFlag(GLO_Halsin_Knows_IsFound_a0d83476-e2d0-4972-a76b-b23c39078cd7, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GLO_Halsin_WildshapeRemoved()
AND
DB_OnlyOnce("GOB_WolfPens_PrepareForAfterCombatDialog", _, _, _, _)
AND
IsInTrigger(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, 1, _, _)
AND
QRY_TriggerEvents_AnyPlayerInTrigger(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
AND NOT
DB_Is_InCombat(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
AND
QRY_OnlyOnce("GOB_WolfPens_RestoreHpAfterFight", _, _, _, _)
THEN
UseSpell(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "Target_GOB_WolfPens_HalsinCureWounds", S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, NULL_00000000-0000-0000-0000-000000000000);

IF
CastedSpell(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "Target_GOB_WolfPens_HalsinCureWounds", _, _, _)
THEN
PROC_SelfHealing_Enable(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_SpotPlayers_IncludeWildshapedPlayers(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "GOB_WolfPens_Prisoner");
DB_SpotPlayers(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "GOB_WolfPens_Prisoner", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

IF
CastSpellFailed(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "Target_GOB_WolfPens_HalsinCureWounds", _, _, _)
THEN
PROC_SelfHealing_Enable(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_SpotPlayers_IncludeWildshapedPlayers(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "GOB_WolfPens_Prisoner");
DB_SpotPlayers(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "GOB_WolfPens_Prisoner", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted((GUIDSTRING)_Var1, "GOB_WolfPens_Prisoner", (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_GLO_SelectFavouredSpeaker_SingleTag(_Var2, _Var1, AVATAR_306b9b05-1057-4770-aa17-01af21acd650, 1, _Var1)
AND
DB_QRYRTN_GLO_SelectFavouredSpeaker(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner_AfterCombatDialog(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(_Var4, _Var1, _Var3, _Var1, _Var1)
THEN
RemoveHarmfulStatuses(_Var1);
RemoveSurfaceLayer(_Var1, "Ground", 2);
RemoveSurfaceLayer(_Var1, "Cloud", 2);
RemoveStatus(_Var1, "BLEEDING");
RemoveStatus(_Var1, "BURNING");
RemoveHarmfulStatuses(_Var3);
RemoveSurfaceLayer(_Var3, "Ground", 2);
RemoveSurfaceLayer(_Var3, "Cloud", 2);
RemoveStatus(_Var3, "BLEEDING");
RemoveStatus(_Var3, "BURNING");

IF
DialogStarted((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner_AfterCombatDialog(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting(_Var3, "GOB_WolfPens_Prisoner");

IF
LeftTrigger((GUIDSTRING)_Var1, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GOB_WolfPens_Prisoner(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_WolfPens_Prisoner(_Var1);

IF
DialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_Dialogs(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Reinforcement(_Var3, _, _, _Var1, _Var1)
AND
QRY_OnlyOnce("GOB_WolfPens_TalkedToReinforcement", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
AutomatedDialogStarted(GOB_WoflPens_AD_BackupGroup_c5356a97-4bc1-a3a1-b72a-ab091f2a35f0, _, _, _, _)
AND
QRY_TriggerEvents_AnyPlayerInTrigger(S_GOB_WolfPens_BackupArea_4b78357e-a01c-4fca-aae4-47bc6c7ff6ab, _, _, _, _)
AND
QRY_OnlyOnce("GOB_WolfPens_ListenedToReinforcement", _, _, _, _)
THEN
DB_NOOP(1);

IF
DB_OnlyOnce("GOB_WolfPens_TalkedToReinforcement", _, _, _, _)
AND
DB_OnlyOnce("GOB_WolfPens_ListenedToReinforcement", _, _, _, _)
THEN
SetFlag(GOB_WolfPens_State_ReinforcementIntroduced_88e9d8d1-c9ca-4e28-905a-ed3c5f8d2573, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GOB_WolfPens_SendReinforcement()
AND NOT
DB_GOB_WolfPens_ReinforcementBlocked(1, _, _, _, _)
AND
DB_GOB_WolfPens_Reinforcement(_Var1, _, _Var3, _Var1, _Var1)
AND NOT
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetCombatGroupID(_Var1, _Var4, _Var1, _Var1, _Var1)
AND
GetFaction(_Var1, _Var5, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _Var1);
SetFlag(GOB_BattleStations_State_BlockRunnerFlag_db41660e-85c9-4fab-aff2-79c61b73f8c5, _Var1);
PROC_ForceStopDialog(_Var1);
SetCombatGroupID(_Var1, "");
DB_GOB_WolfPens_ReinforcementParams(_Var1, _Var4, _Var5);
SetEntityEvent(_Var1, "GOB_WolfPens_Alarmed");
PROC_CharacterMoveTo(_Var1, _Var3, "Run", "GOB_WolfPens_ArrivedToWolfPens");
PROC_GOB_WolfPens_RemoveFromRaiders(_Var1);
DB_CorpseLooting_ClearRedOutlineOnFactionGroupTagged("WLD_Main_A", "Act1_GOB_WolfPens", _Var5, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727);
NOT DB_FactionTagging_FactionTagged("WLD_Main_A", _Var5, PERMA_DEFEATED_867f3a1e-1e4b-48c2-869e-343415231727);

IF
EntityEvent((GUIDSTRING)_Var1, "GOB_WolfPens_ArrivedToWolfPens", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetCombatGroupID(_Var1, "8b08fc36-919a-4dc1-a510-06667bd906d0");

PROC
PROC_GOB_WolfPens_RemoveFromRaiders((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_DrowCommander_RaidersInGoblinCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GOB_DrowCommander_RaidersInGoblinCamp(_Var1);

PROC
PROC_GOB_WolfPens_RemoveFromRaiders((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_DrowCommander_Raiders(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
NOT DB_GOB_DrowCommander_Raiders(_Var1, _Var2, _Var3, _Var4);

IF
EnteredTrigger((CHARACTER)_Var1, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_ReinforcementParams(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
QRY_TriggerEvents_AnyPlayerInTrigger(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _Var1, _Var1, _Var1, _Var1)
THEN
RealtimeObjectTimerLaunch(_Var1, "GOB_WolfPens_UpdateReinforcementFaction", 1000);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "GOB_WolfPens_UpdateReinforcementFaction", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
THEN
SetFaction(_Var1, ACT1_GOB_WolfPens_7adb52e1-1e4d-5312-3b0e-eb262d0a72e0);

IF
LeftTrigger((CHARACTER)_Var1, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_ReinforcementParams(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
TriggerUnregisterForCharacter(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _Var1);
SetCombatGroupID(_Var1, _Var2);
PROC_GOB_WolfPens_CheckRestoreReinforcementFaction(_Var1, _Var3);
NOT DB_GOB_WolfPens_ReinforcementParams(_Var1, _Var2, _Var3);
ClearFlag(GOB_BattleStations_State_BlockRunnerFlag_db41660e-85c9-4fab-aff2-79c61b73f8c5, _Var1);

PROC
PROC_GOB_WolfPens_CheckRestoreReinforcementFaction((CHARACTER)_Var1, (FACTION)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GOB_WolfPens_DoNotRestoreFaction(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFaction(_Var1, _Var2);

IF
EnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Reinforcement(_Var1, _, _, _Var1, _Var1)
AND
DB_GOB_WolfPens_CombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_WolfPens_DoNotRestoreFaction(_Var1);
PROC_ClearStoryMove(_Var1);

IF
EntityEvent((CHARACTER)_Var1, "GOB_WolfPens_SendReinforcementBack", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Reinforcement(_Var1, _Var2, _, _Var1, _Var1)
AND NOT
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, _Var2, "Walk", "GOB_WolfPens_Event_ReinforcementReturned");

IF
EntityEvent((CHARACTER)_Var1, "GOB_WolfPens_Event_ReinforcementReturned", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Reinforcement(_Var1, _Var2, _, _Var1, _Var1)
THEN
LookFromTrigger(_Var1, _Var2, 0);

IF
EntityEvent((CHARACTER)_Var1, "GOB_WolfPens_StartCombatCutscene", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("GOB_WolfPens_CombatCutsceneStarted", _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_CombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_Prisoner_CombatCutscenes(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
GetClosestAlivePlayer(_Var1, _Var4, _, _Var1, _Var1)
AND NOT
QRY_StartDialogCustom(_Var3, _Var1, S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0, _Var4, 0, 0, 0, 0, _Var1, _Var1)
THEN
SetFlag(GOB_WolfPens_State_CombatCutsceneHappened_54a81a88-e628-4820-a84f-b0a5603e459d, NULL_00000000-0000-0000-0000-000000000000);

IF
DialogStarted((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GOB_WolfPens_Prisoner_CombatCutscenes(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("GOB_WolfPens_CombatCutsceneStarted");

IF
TextEvent("debug_testre1", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Reinforcement(_Var1, _Var2, _, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, _Var2, "Run", "");

IF
TextEvent("debug_testre2", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Reinforcement(_Var1, _Var2, _, _Var1, _Var1)
THEN
SetEntityEvent(_Var1, "GOB_WolfPens_CommentOnPrisonersBody");

IF
TextEvent("testlever", _, _, _, _)
THEN
PROC_GOB_WolfPens_PersuasionResult();

IF
TextEvent("send_reinf", _, _, _, _)
THEN
PROC_GOB_WolfPens_SendReinforcement();

IF
TextEvent("freehalsin", _, _, _, _)
THEN
DB_OnlyOnce("GOB_WolfPens_RestoreHpAfterFight");
PROC_GOB_WolfPens_HalsinForceBreakout();
TimerLaunch("GOB_WolfPens_FreeHalsinTeleport", 1000);

IF
TimerFinished("GOB_WolfPens_FreeHalsinTeleport", _, _, _, _)
THEN
PROC_TeleportPartiesTo(S_GOB_WolfPens_AutoStartDialogTrigger_756da918-0270-4e27-b74c-3bfcf863bf1f, "");

IF
TextEvent("wp_doorsmash", _, _, _, _)
THEN
Attack(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, 1);

PROC
PROC_GOB_WolfPens_ClearWolfPens()
AND
DB_GLO_DefeatCounter(_Var1, "GOB_WolfPens_DefeatCounter", _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

PROC
PROC_GOB_WolfPens_ClearWolfPens()
AND
DB_GOB_WolfPens_Kids(_Var1, _, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);

PROC
PROC_GOB_WolfPens_ClearWolfPens()
AND
DB_GOB_WolfPens_Corpses(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var1, _Var2);

PROC
PROC_GOB_WolfPens_ClearWolfPens()
THEN
DB_OneShotPlayerTrigger(S_GOB_WolfPens_Corpses_VB_1ea96bd4-1810-41b4-a9fa-66208559da82);

PROC
PROC_OneShotTriggerEntered((CHARACTER)_Var1, S_GOB_WolfPens_Corpses_VB_1ea96bd4-1810-41b4-a9fa-66208559da82, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
StartVoiceBark(GOB_WolfPens_VB_Massacre_9688b41f-4ed2-f8b6-b36c-c24bec9dd8e5, _Var1);

PROC
PROC_GOB_WolfPens_DestroyDoors()
THEN
Die(S_GOB_WolfPens_CageDoor_001_d29ec2f5-46c0-41cc-8fee-a259338f33ad, 0, NULL_00000000-0000-0000-0000-000000000000, 1, 1);
SetOnStage(S_GOB_WolfPens_CageDoor_002_19b032a0-e027-4524-96f9-1c0cd48d726e, 0);

PROC
PROC_GOB_WolfPens_TeleportHalsin()
THEN
TeleportTo(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_GOB_WolfPens_WaitingArea_3e29895c-5b0d-4b98-80be-a0e5fe324690, "");

IF
DB_PermaDefeated(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1, _Var1, _Var1, _Var1)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var1, 1, _Var1, _Var1)
THEN
RemovePartyFollower(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1);
ClearFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var1);

PROC
PROC_FlagReactionAfterDialog((GUIDSTRING)_Var1, GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GOB_WolfPens_ApplyWildShape(1);
AddPartyFollower(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1);

IF
CharacterJoinedParty(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
AND
DB_GOB_WolfPens_ApplyWildShape(1, _, _, _, _)
THEN
NOT DB_GOB_WolfPens_ApplyWildShape(1);
PROC_GLO_Halsin_ApplyWildshape();
PROC_GOB_WolfPens_GiveBearDialogue();

PROC
PROC_FlagReactionAfterDialog((CHARACTER)_Var1, GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_WolfPens_State_HalsinHelpedToKillLeaders_f40ff780-3bad-7826-ef4b-06c9a29cb700, NULL_00000000-0000-0000-0000-000000000000);
DB_IgnoreMutingStatussesDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
PROC_GOB_WolfPens_StartHalsinDialog(_Var1);

PROC
PROC_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_HalsinLeftParty_c67822f6-a2f4-4d22-94c2-0824f2ac3f62, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var1, 1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_Halsin_RemoveFromParty(_Var1);

IF
FlagSet(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(GOB_WolfPens_Event_HalsinLeftParty_c67822f6-a2f4-4d22-94c2-0824f2ac3f62, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(GOB_WolfPens_State_HalsinIsInParty_7d95447a-3fd3-4ac9-851f-b817106d54ef, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagCleared(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ClearFlag(GOB_WolfPens_State_HalsinIsInParty_7d95447a-3fd3-4ac9-851f-b817106d54ef, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(GOB_DrowCommander_Event_RaidersSortie_26816b01-2d64-b50c-3bf6-bffd7dc5f0b9, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var2, _, _, _)
AND
GetFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var2, 1, _, _)
THEN
PROC_GOB_WolfPens_Halsin_RemoveFromParty(_Var2);
DB_IgnoreMutingStatussesDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
PROC_GOB_WolfPens_StartHalsinDialog(_Var2);

PROC
PROC_GOB_WolfPens_StartHalsinDialog((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_StartDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var2, _, _, _)
AND
GetFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var2, 1, _, _)
AND NOT
DB_Is_InCombat(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
THEN
PROC_GOB_WolfPens_Halsin_RemoveFromParty(_Var2);
DB_IgnoreMutingStatussesDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
SetFlag(GOB_WolfPens_State_HalsinHelpedToKillLeaders_f40ff780-3bad-7826-ef4b-06c9a29cb700, NULL_00000000-0000-0000-0000-000000000000);
PROC_GOB_WolfPens_StartHalsinDialog(_Var2);

IF
FlagSet(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var2, _, _, _)
AND
DB_Is_InCombat(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var3, _, _, _)
THEN
DB_GOB_WolfPens_LeadersKilledInCombat(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var2, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var2, 1, _Var1, _Var1)
AND
DB_GOB_WolfPens_LeadersKilledInCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_Halsin_RemoveFromParty(_Var2);
SetFlag(GOB_WolfPens_State_HalsinHelpedToKillLeaders_f40ff780-3bad-7826-ef4b-06c9a29cb700, NULL_00000000-0000-0000-0000-000000000000);
DB_IgnoreMutingStatussesDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
PROC_GOB_WolfPens_StartHalsinDialog(_Var2);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_ExitPoints(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var3, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var3, 1, _Var1, _Var1)
AND
QRY_GOB_WolfPens_HalsinNeedsToStopPlayer(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, _Var2, 0);
PROC_GOB_WolfPens_RemoveHalsinFromPartyAndStopPlayer(_Var3);

QRY
QRY_REALLY_BlockFastTravel((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
CharacterGetOwner(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var2, _Var1, _Var1, _Var1)
AND
GetFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var2, 1, _Var1, _Var1)
AND
QRY_GOB_WolfPens_HalsinNeedsToStopPlayer(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_RemoveHalsinFromPartyAndStopPlayer(_Var2);

PROC
PROC_GOB_WolfPens_RemoveHalsinFromPartyAndStopPlayer((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SetFlag(GOB_WolfPens_Event_HalsinStoppedPlayer_87fc04cc-9152-47d8-a35d-5504e942c4a5, NULL_00000000-0000-0000-0000-000000000000);
DB_IgnoreMutingStatussesDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);
PROC_GOB_WolfPens_Halsin_RemoveFromParty(_Var1);
PROC_GOB_WolfPens_Halsin_StartDialogAfterStoppingPlayer(_Var1);

QRY
QRY_GOB_WolfPens_HalsinNeedsToStopPlayer(NULL_00000000-0000-0000-0000-000000000000, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_NOOP(1);

QRY
QRY_GOB_WolfPens_HalsinNeedsToStopPlayer((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 == _Var2
THEN
DB_NOOP(1);

QRY
QRY_GOB_WolfPens_HalsinNeedsToStopPlayer((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 != _Var2
AND
IsInPartyWith(_Var2, _Var1, 1, _Var1, _Var1)
AND
InSamePartyGroup(_Var2, _Var1, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_GOB_WolfPens_Halsin_StartDialogAfterStoppingPlayer((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_StartDialog(GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_GOB_WolfPens_Halsin_RemoveFromParty((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
RemovePartyFollower(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var1);
ClearFlag(GOB_WolfPens_State_HalsinIsFollowing_b6cb47ab-d002-0985-b378-d78f3c4ccd59, _Var1);
PROC_GLO_Halsin_RemoveWildshape();
PROC_GOB_WolfPens_GiveHumanDialogue();

IF
StatusRemoved(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, (STRING)_Var1, _, _, (STRING)_Var1)
AND
DB_GLO_Halsin_WildshapeSpells(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
IsPartyFollower(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1, _Var1, _Var1, _Var1)
AND
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_Halsin_Following_4c8c0646-03ab-6449-15be-a8a32a31da49, _Var1, _Var1, _Var1)
THEN
PROC_RemoveDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_Halsin_Following_Elf_26317dd0-f609-1b72-27d0-602d4b3e1013);

IF
StatusApplied(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, (STRING)_Var1, _, _, (STRING)_Var1)
AND
DB_GLO_Halsin_WildshapeSpells(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
IsPartyFollower(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1, _Var1, _Var1, _Var1)
AND
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_Halsin_Following_Elf_26317dd0-f609-1b72-27d0-602d4b3e1013, _Var1, _Var1, _Var1)
THEN
PROC_RemoveDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_Halsin_Following_4c8c0646-03ab-6449-15be-a8a32a31da49);

PROC
PROC_GOB_WolfPens_GiveHumanDialogue()
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_HalsinsBear_AfterCombat_00675ad1-8413-8548-7a91-77405b2860be);

PROC
PROC_GOB_WolfPens_GiveBearDialogue()
THEN
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
DB_Dialogs(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, GOB_WolfPens_Halsin_Following_4c8c0646-03ab-6449-15be-a8a32a31da49);

QRY
QRY_DialogShouldIgnoreMutingStatusses(GOB_WolfPens_Halsin_Following_4c8c0646-03ab-6449-15be-a8a32a31da49, _, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _)
AND NOT
DB_Is_EngineBlock_Talk(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, _, _, _)
THEN
NOT DB_QRYRTN_DialogShouldIgnoreMutingStatusses(0);
DB_QRYRTN_DialogShouldIgnoreMutingStatusses(1);

PROC
PROC_GlobalFlagReactionAfterDialog(GOB_WolfPens_Event_HalsinLeavesGoblinCamp_a247e755-d8a0-4938-d122-d8ad9f48a674, _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceLeaving();

IF
FlagSet(GLO_Halsin_State_PermaDefeated_86bc3df1-08b4-fbc4-b542-6241bcd03df1, NULL_00000000-0000-0000-0000-000000000000, _, _, _)
AND NOT
DB_GlobalFlag(GLO_Halsin_State_Returned_5af86099-47f9-ba69-199a-fe91292a41bd, _, _, _, _)
THEN
SetFlag(GLO_Halsin_State_DeadInGOB_268f1aa0-1ba9-43d4-bfba-6c507b8e88ab, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
AND
QRY_GOB_WolfPens_Imprisoned()
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceBreakoutAndLeaving();

IF
LeftTrigger((CHARACTER)_Var1, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_WolfPens_Imprisoned()
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GOB_WolfPens_HalsinForceBreakoutAndLeaving();

IF
DB_GlobalFlag(DEN_AttackOnDen_State_RaidersAtDen_29f372ac-f9f1-4d54-bc9e-7eb493fa09d8, _, _, _, _)
AND NOT
QRY_GOB_WolfPens_Imprisoned()
AND NOT
QRY_TriggerEvents_AnyPlayerInTrigger(S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceLeaving();

IF
LeftTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_GoblinTempleTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_GOB_WolfPens_Imprisoned()
AND
DB_GlobalFlag(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, _Var1, _Var1, _Var1, _Var1)
THEN
TimerLaunch("GOB_WolfPens_MoveHalsin", 1000);

IF
LeftTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_GoblinTempleTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GOB_WolfPens_Imprisoned()
AND
DB_GlobalFlag(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, _Var1, _Var1, _Var1, _Var1)
THEN
TimerLaunch("GOB_WolfPens_BreakMoveHalsin", 1000);

IF
FlagSet(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, _, _, _, _)
AND NOT
QRY_GOB_AnyPlayerInGoblinTemple()
AND
QRY_GOB_WolfPens_Imprisoned()
THEN
PROC_GOB_WolfPens_HalsinForceBreakoutAndLeaving();

IF
TimerFinished("GOB_WolfPens_BreakMoveHalsin", _, _, _, _)
AND NOT
QRY_GOB_AnyPlayerInGoblinTemple()
AND NOT
QRY_GOB_WolfPens_AnyPlayerOutsidePlayerCamp()
THEN
DB_GOB_WolfPens_CheckBreakOutAfterLongRest(1);

IF
TimerFinished("GOB_WolfPens_BreakMoveHalsin", _, _, _, _)
AND NOT
QRY_GOB_AnyPlayerInGoblinTemple()
AND
QRY_GOB_WolfPens_AnyPlayerOutsidePlayerCamp()
AND
QRY_OnlyOnce("GOB_WolfPens_MoveHalsin", _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceBreakoutAndLeaving();

QRY
QRY_GOB_WolfPens_AnyPlayerOutsidePlayerCamp()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_InCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_CAMP_LastPlayerLeftCamp()
AND
DB_GOB_WolfPens_CheckBreakOutAfterLongRest(1, _, _, _, _)
AND NOT
QRY_GOB_AnyPlayerInGoblinTemple()
AND
QRY_OnlyOnce("GOB_WolfPens_MoveHalsin", _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceBreakoutAndLeaving();

PROC
PROC_CAMP_LastPlayerLeftCamp()
AND
DB_GOB_WolfPens_CheckBreakOutAfterLongRest(1, _, _, _, _)
AND
QRY_GOB_AnyPlayerInGoblinTemple()
THEN
NOT DB_GOB_WolfPens_CheckBreakOutAfterLongRest(1);

IF
TimerFinished("GOB_WolfPens_MoveHalsin", _, _, _, _)
AND NOT
QRY_GOB_AnyPlayerInGoblinTemple()
AND
QRY_OnlyOnce("GOB_WolfPens_MoveHalsin", _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceLeaving();

QRY
QRY_GOB_AnyPlayerInGoblinTemple()
AND
DB_GOB_WolfPens_GoblinTempleTriggers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_TriggerEvents_AnyPlayerInTrigger(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_GOB_WolfPens_Imprisoned()
AND
GetFlag(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 0, _, _)
THEN
DB_NOOP(1);

PROC
PROC_GOB_WolfPens_HalsinForceBreakout()
THEN
DB_GOB_WolfPens_HalsinLeftOnHisOwn(1);
PROC_GlobalSetFlagAndCache(GOB_WolfPens_State_Swept_fc032064-28cf-17cb-51bb-14ae6d8a85b6);
PROC_GOB_WolfPens_ClearWolfPens();
PROC_GOB_WolfPens_DestroyDoors();
PROC_GOB_WolfPens_TeleportHalsin();
PROC_GLO_Halsin_RemoveWildshape();
SetFlag(GOB_WolfPens_State_PrisonerLeftCage_4cd17a8b-7605-47c7-a13c-93821e68f177, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);

IF
DialogActorLeft((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _, (DIALOGRESOURCE)_Var1)
AND NOT
DB_AutomatedDialog(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GOB_WolfPens_HalsinLeftOnHisOwn(1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(S_GOB_WolfPens_State_MetHalsinAfterPrisonBreak_3eceba95-a942-463a-9ad5-c19bdf1899c4, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_GOB_WolfPens_HalsinLeftOnHisOwn(1);

PROC
PROC_GOB_WolfPens_HalsinForceLeaving()
AND NOT
DB_GlobalFlag(GOB_WolfPens_State_HalsinIsAggravated_12fa854c-00e0-4e33-87d0-a650a93b5769, _, _, _, _)
AND
QRY_OnlyOnce("GOB_WolfPens_HalsinForceLeaving", _, _, _, _)
THEN
PROC_ForceStopDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323);
CharacterStopCrime(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "GOB_WolfPens_EscapedPrisoner", NULL_00000000-0000-0000-0000-000000000000);
SetCanJoinCombat(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 0);
SetFlag(GOB_WolfPens_Event_SidedWithPrisoner_0c160e6c-0a72-4093-9e8c-3094962ef57a, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "WILDSHAPE_RAT", 18, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
StatusApplied(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "WILDSHAPE_RAT", _, _, (GUIDSTRING)_)
THEN
PROC_DisappearOutOfSight(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "Run", 1, "GLO_Halsin_LeftGoblinCamp");

PROC
PROC_GOB_WolfPens_HalsinForceBreakoutAndLeaving()
AND
QRY_OnlyOnce("GOB_WolfPens_HalsinForceBreakoutAndLeaving", _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceBreakout();
TimerLaunch("GOB_WolfPens_RemoveHalsin", 500);

IF
TimerFinished("GOB_WolfPens_RemoveHalsin", _, _, _, _)
THEN
PROC_GOB_WolfPens_HalsinForceLeaving();

IF
FleeFromCombat(_, (GUIDSTRING)_Var2, _, _, _)
AND
DB_GlobalFlag(GOB_State_LeadersAreDead_a1c5b01f-4b7f-47ab-82b0-d24d9c6d8bc6, _, _, _, _)
AND
DB_Is_InCombat(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, _Var2, _, _, _)
AND
IsPartyFollower(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1, _, _, _)
THEN
DB_GLO_Halsin_ReadyForDen(1);

IF
FlagSet(GOB_WolfPens_State_BearEnraged_9b6a106b-6431-42b9-8ac1-48ba2a79e46b, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
SetHasDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 0);

IF
FlagCleared(GOB_WolfPens_State_BearEnraged_9b6a106b-6431-42b9-8ac1-48ba2a79e46b, NULL_00000000-0000-0000-0000-000000000000, _, (INTEGER)_, (INTEGER)_)
THEN
SetHasDialog(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, 1);

IF
AddedTo(S_GOB_WolfPens_MeatPlaceholder_0c8ee3ad-4f89-49df-9ae6-1309482072ee, (CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_WolfPens_State_MeatStolen_f36cdfde-171b-4010-bc92-8f9a0d6ae361, NULL_00000000-0000-0000-0000-000000000000);

IF
DestroyedBy(S_GOB_WolfPens_MeatPlaceholder_0c8ee3ad-4f89-49df-9ae6-1309482072ee, _, _, _, (CHARACTER)_)
THEN
SetFlag(GOB_WolfPens_State_MeatStolen_f36cdfde-171b-4010-bc92-8f9a0d6ae361, NULL_00000000-0000-0000-0000-000000000000);

IF
MovedBy(S_GOB_WolfPens_MeatPlaceholder_0c8ee3ad-4f89-49df-9ae6-1309482072ee, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GOB_WolfPens_State_MeatStolen_f36cdfde-171b-4010-bc92-8f9a0d6ae361, NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_CRIME_BlockRegisterCrime(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "DangerousMonsterReactionFallback_Beast", _, _, _)
AND
DB_InRegion(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_CRIME_BlockRegisterCrime(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, "DangerousMonsterReaction_Beast", _, _, _)
AND
DB_InRegion(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, _, _, _)
THEN
DB_NOOP(1);

IF
FlagSet(GOB_WolfPens_Event_ThrewRock_9af39233-b6e9-4279-b3ca-d68163b240bc, _, _, _, _)
AND
DB_GOB_WolfPens_Beastmasters(_Var3, _, _, _, _)
THEN
PROC_MakeSurprised(_Var3);

IF
FlagSet(GOB_WolfPens_Event_ThrewRock_9af39233-b6e9-4279-b3ca-d68163b240bc, _, _, _, _)
AND
DB_GOB_WolfPens_Kids(_Var3, _, _, _, _)
THEN
PROC_MakeSurprised(_Var3);

IF
FlagSet(GOB_WolfPens_Event_ThrewRock_9af39233-b6e9-4279-b3ca-d68163b240bc, _, _, _, _)
AND
DB_GOB_WolfPens_Worgs(_Var3, _, _, _, _)
THEN
PROC_MakeSurprised(_Var3);

IF
FlagSet(GOB_WolfPens_Event_ThrewRock_9af39233-b6e9-4279-b3ca-d68163b240bc, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_MakeSurprised(S_GOB_WolfPens_Parent_6e4dd891-7bfe-4656-a9a0-ecf0916fd8f0);
PROC_MakeSurprised(S_GOB_PrisonGuard_000_96f411f3-5849-4608-b6fa-b7fb6ffaa7d6);

IF
FlagSet(GOB_WolfPens_Event_ThrewRock_9af39233-b6e9-4279-b3ca-d68163b240bc, _, _, _, _)
AND
DB_PartyMembers(_Var3, _, _, _, _)
AND
IsInTrigger(_Var3, S_GOB_WolfPens_SUB_a9a4a7c2-87c6-4031-9859-7eddb0528ff6, 1, _, _)
THEN
PROC_MakeSurprised(_Var3);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GOB_WolfPens_Worgs(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_InRegion(_Var1, S_GOB_WolfPens_Cage_001_9aea6349-9a8f-453d-ad86-fee65a820bdf, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(GEB_GOB_WolfPens_AD_WorgOutsideCage_e457f25b-5e1f-0f3d-73f1-4130f3215d5e, _Var1, _Var2);

PROC
PROC_LevelLoadedOnce("BGO_Main_A", _, _, _, _)
THEN
GoalCompleted;


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1"
