Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_PLA_FlamingFistSpeakerCounter(0);
DB_PLA_FlamingFist(1, S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, DIALOGRESOURCEGUID_PLA_FlamingFist1_AD_Occupied_aae77d89-b404-8eed-9022-c611cd24c433, DIALOGRESOURCEGUID_PLA_FlamingFist1_7028bb67-6893-14d1-a909-fab5e6a395a0);
DB_PLA_FlamingFist(2, S_PLA_FlamingFist2_48b99fd9-f34e-4c11-a1a6-435ea6ef1c80, DIALOGRESOURCEGUID_PLA_FlamingFist2_AD_Occupied_059df3cb-832f-ab79-2454-f88d6e227281, DIALOGRESOURCEGUID_PLA_FlamingFist2_e4ad40e4-ad0c-6fca-4238-c74af932b821);
DB_PLA_FlamingFist(3, S_PLA_FlamingFist3_4bae156f-e1a1-4190-b6fa-84dac624c913, DIALOGRESOURCEGUID_PLA_FlamingFist3_AD_Occupied_23e719c5-bdbe-d989-5c8a-65e61d88f3e3, DIALOGRESOURCEGUID_PLA_FlamingFist3_4acebf78-f9fa-f701-bc10-0dc6b00ae55f);
DB_PLA_FlamingFist(4, S_PLA_FlamingFist4_5791727f-ace8-4b04-973a-cdf1f02f4984, DIALOGRESOURCEGUID_PLA_FlamingFist4_AD_Occupied_79749e87-f05c-8cc6-f86c-751cb73736aa, DIALOGRESOURCEGUID_PLA_FlamingFist4_01133c28-0dec-cd60-8000-218c127a6ab9);
TriggerRegisterForCharacter(S_PLA_DesireTrappedRoom_3063bdd1-3c92-4c46-9804-15098cfe54ad, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
DB_PermaDefeatedEvent(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, GLO_Florrick_State_Dead_c190fb1f-4c27-4948-87f0-29dc5a9b5b55);
DB_GLO_DefeatCounter_Target("PLA_FlamingFists", 1);
TriggerRegisterForCharacter(TRIGGERGUID_S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
TriggerRegisterForCharacter(S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911);
TriggerRegisterForCharacter(S_PLA_DesireFreedTrigger2_6ecb7b16-2371-40de-b948-1f18d227d9d6, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
SetHasDialog(GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, 1);
DB_GLO_ADManager_AD("PLA_FlamingFists", PLA_FlamingFist1_AD_Working_90427c48-02a3-df89-3fe8-e6dae85ebd19, PLA_FlamingFists_State_BlockAD_FlamingFist1_6fecbb70-4914-459c-8181-94833ca61673);
DB_GLO_ADManager_AD("PLA_FlamingFists", PLA_FlamingFist2_AD_Working_c6105fad-8948-e113-fdca-83630e4fd0ee, PLA_FlamingFists_State_BlockAD_FlamingFist2_126c1e38-8329-4a29-a17a-e192ecfef29a);
DB_GLO_ADManager_AD("PLA_FlamingFists", PLA_FlamingFist3_AD_Working_c537fe58-0eac-c865-d6b3-6d371b1d33d7, PLA_FlamingFists_State_BlockAD_FlamingFist3_b2c22470-46ca-4a49-a9c3-bf14eb61e1d6);
DB_GLO_ADManager_AD("PLA_FlamingFists", PLA_FlamingFist4_AD_Working_44aaf960-5253-cc28-e324-807bfede46af, PLA_FlamingFists_State_BlockAD_FlamingFist4_7cdeb0c0-3f9e-4381-870f-69d19cde316f);
DB_GLO_ADManager_AD("PLA_FlamingFists", PLA_FlamingFist6_AD_FlamingFist5_079b9beb-46f5-b788-92b3-9b36be717f15, PLA_FlamingFists_State_BlockAD_FlamingFist6_c8374fa2-8e20-4a99-8c9c-379e66b307f1);
DB_GLO_ADManager_AD("PLA_FlamingFists", PLA_FlamingFist7_AD_b0ac3d38-87e8-0682-0a39-5e1cfb84ec7a, PLA_FlamingFists_State_BlockAD_FlamingFist7_f0ab6cbe-358c-4dba-9e75-f74c8f8a7909);
DB_GLO_ADManager_Category("PLA_FlamingFists", PLA_FlamingFists_State_BlockAD_b40a237c-de00-4d22-9434-b6e8957dcbd8, 3000, 3000);
DB_HasItemEvent(S_PLA_TavernInvestigation_DesireDoorKey_c8feace1-e292-4fb9-bb98-2bae35020fc5, PLA_Desire_State_HasDesireKey_694a4db1-1e02-858c-05d1-881adc9d0076);
PROC_DefineSingleOriginMoment(PLA_FlamingFists_2ec42843-e88d-1453-0e4d-19496d99214e, WYLL_facf82dc-a6e1-4720-a0bd-6efde960dc5f, PLA_FlamingFists_OM_Wyll_AOM_OOM_bd65b9b4-c263-2ab3-cec6-9af89e470e55, PLA_FlamingFists_OM_Wyll_COM_aa2656a6-ca46-1c28-766a-0615fceac215, PLA_FlamingFists_OM_Wyll_AOM_OOM_bd65b9b4-c263-2ab3-cec6-9af89e470e55);
DB_PLA_FlamingFistsDialogues(PLA_FlamingFists_2ec42843-e88d-1453-0e4d-19496d99214e);
DB_PLA_FlamingFistsDialogues(PLA_FlamingFists_OM_Wyll_AOM_OOM_bd65b9b4-c263-2ab3-cec6-9af89e470e55);
DB_PLA_FlamingFistsDialogues(PLA_FlamingFists_OM_Wyll_COM_aa2656a6-ca46-1c28-766a-0615fceac215);
DB_PLA_FlamingFistsDismissedFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af);
DB_PLA_FlamingFistsDismissedFlag(PLA_FlamingFists_State_Dismissed_dd58c8da-5800-4344-a535-5e78d05401d0);
DB_PLA_LeavingFlamingFistOutside(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
DB_PLA_LeavingFlamingFistOutside(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441);
PROC_SetCorpseOwner(S_PLA_FlamingFist6_0ba41cd1-e1f6-4f17-8e92-10ebef850268, S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae);
PROC_TriggerRegisterForPlayers(S_PLA_Tavern_BuildingTrigger_16c5d3bb-422a-4bd8-a6a7-665d32d7303b);
PROC_TriggerRegisterForPlayers(S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728);
PROC_TriggerRegisterForPlayers(S_PLA_DesireSideBuilding_b7f015ba-8712-4e08-953f-6177cc8b2830);
DB_PLA_FlamingFists_DisableCrimes(S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae);
DB_PLA_FlamingFists_DisableCrimes(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441);
DB_PLA_FlamingFists_DisableCrimes(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a);
DB_PLA_FlamingFists_DisableCrimes(S_PLA_StuckHalfElf_5fcc3167-5a0c-41e7-b44c-d629d34370cb);
PROC_TriggerRegisterForPlayers(S_PLA_StuckHalfElf_TavernBox_fc69dced-9f44-4760-9378-8598b4a9e859);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_000_c9775c80-ce1b-4a76-9b2a-336ffaad6a0d, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_001_3f291ad3-a117-48b7-8bca-f4a01494fd82, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_002_267db4b3-c437-45ce-bc8c-e2d6a8fb17a7, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_003_862cfd84-9a66-42c5-b06b-b296feddda29, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_004_2503f4e0-a90f-479f-9935-076ffbc5c9a3, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_005_9aefb3d2-56cb-40ea-a7ff-270527f8357c, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_006_a37487ed-3719-4b90-bd48-55b1debe11ba, 3, 40, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_007_ed3b71a2-f7ee-4f27-803d-5b35c26f3b4e, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_008_f79f8fc2-0bdc-4b95-93e5-8fe166db8f60, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_009_270d6cd3-8c8f-4aa5-b0b7-f1fbb05f55ca, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_010_1bebbd51-78d4-4bdd-b017-ff97b4f37f7c, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_011_ee7f7237-dd78-4cd4-8799-b85e794e7d57, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_012_64e9c2c6-3047-4453-bf37-caccc3e489f8, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_FirePuddle(S_PLA_TavernInvestigation_FirePuddle_013_98efd078-b27b-4d76-be63-a74071972624, 3, 70, 4, 7, 2, 0);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_000_59cb1667-4134-42b9-8fb9-951e99625b46);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_001_118b67fa-3d55-46f4-bdf5-92775e880a63);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_002_bbb87b3d-f003-4495-ab1a-462209eb26b5);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_003_f66d1256-dcd2-425d-a5e7-12b6245653ab);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_004_93f0838c-341c-4b72-ba95-657a50a8ef74);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_005_3910b21e-8c7e-4bee-871d-d5c79091aa70);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_006_631b5f2f-bb10-4710-8f50-4bbca1fb49f1);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_007_40e6aee4-c561-46c2-9931-838ffd9b4891);
DB_PLA_TavernInvestigation_PersistentFlame(S_PLA_PersistentFlame_008_8de18d6c-928e-4d65-bfa2-f608ed119a3f);
SetHitpointsPercentage(S_PLA_TavernInvestigation_DesireDoor2_e6b2f9ca-a59b-4842-8c1b-1b6499b884f7, 78);
SetHitpointsPercentage(S_PLA_TavernInvestigation_RoomDoor2_f4ad4ed3-5906-47a4-b874-20c7c96780d0, 50);
SetHitpointsPercentage(S_PLA_TavernInvestigation_RoomDoor3_9fff6aeb-8bd1-43bd-b215-ef218729e0b1, 65);
SetHitpointsPercentage(S_PLA_TavernInvestigation_BrokenDoor1_ca3d67a8-b632-4f5d-b5b1-77b036ba3122, 30);
DB_GLO_CharacterCorpseDialog(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441, PLA_FlamingFist7_Dead_5c8566ef-be51-1a9d-e9ad-75563ce8a173);
DB_SpotPlayers(S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae, "PLA_FlamingFists_CheckDrow", PLA_FlamingFists_Event_RestartCheckDrow_72fafb77-fb70-47da-8598-6bbd0d71f578, PLA_FlamingFists_Event_PersuadedDrow_f4938c3e-9353-44e8-9088-b8163d3222c8);
DB_CustomDialogRange(S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae, 25);
DB_HostileToPlayerGroupCancelFlag(PLA_FlamingFists_State_PersuadedDrow_d8bc1e0a-6e88-4890-ac53-6bc2457cfa6a, ACT1_PLA_FlamingFists_b4e6e166-ea5f-50ef-6365-84c889f28238);
DB_SeenDeadNPCGlobalFlag(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, GLO_Knows_DesireDead_97850586-ce48-47ef-ab47-7402b1b15c82);
DB_AutoSaveTrigger(S_PartyBanterTrigger_PLA_TollhouseCleared_683e29e2-5840-41d1-8fd2-626f92852f53);
DB_PartyDialogSuppressionZone(S_PLA_TG_InTavern_3d3f482f-8e20-4f33-b927-5cdb96971390);

KBSECTION
IF
DB_PLA_FlamingFist(_Var1, _Var2, _, _, _Var1)
THEN
SetHasDialog(_Var2, 1);
TriggerRegisterForCharacter(TRIGGERGUID_S_PLA_DesireSpotFF_4e4a06d4-0926-4440-94a9-bd320ccd00bc, _Var2);
DB_PLA_FlamingFists_DisableCrimes(_Var2);

IF
DB_PLA_FlamingFists_DisableCrimes(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterDisableCrime(_Var1, "VandaliseNoOwner");

IF
DB_PLA_FlamingFists_DisableCrimes(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_CRIME_ShapeshiftDisturbance(_, _Var3, _Var4, "DangerousBeast", _Var1)
THEN
PROC_CharacterDisableCrime(_Var1, _Var3);
PROC_CharacterDisableCrime(_Var1, _Var4);

IF
DB_PLA_FlamingFist(_Var1, _Var2, _, _, _Var1)
AND NOT
DB_CantTalk(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_FlamingFistAvailable(_Var1, NULL_00000000-0000-0000-0000-000000000000);
DB_PLA_FlamingFistAvailable(_Var1, _Var2);

IF
DB_PLA_FlamingFist(_Var1, _Var2, _, _, _Var1)
AND
DB_CantTalk(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_FlamingFistAvailable(_Var1, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_PLA_FlamingFistAvailable(_Var1, _Var2);

IF
DB_PLA_FlamingFistAvailable(_Var1, NULL_00000000-0000-0000-0000-000000000000, _Var1, _Var1, _Var1)
THEN
PROC_PLA_RemoveFlamingFistSpeaker();

IF
DB_PLA_FlamingFistAvailable(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
THEN
PROC_PLA_AddFlamingFistSpeaker();

PROC
PROC_PLA_AddFlamingFistSpeaker()
AND
DB_PLA_FlamingFistSpeakerCounter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSum(_Var1, 1, _Var2, _Var1, _Var1)
THEN
NOT DB_PLA_FlamingFistSpeakerCounter(_Var1);
DB_PLA_FlamingFistSpeakerCounter(_Var2);

PROC
PROC_PLA_RemoveFlamingFistSpeaker()
AND
DB_PLA_FlamingFistSpeakerCounter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSubtract(_Var1, 1, _Var2, _Var1, _Var1)
THEN
NOT DB_PLA_FlamingFistSpeakerCounter(_Var1);
DB_PLA_FlamingFistSpeakerCounter(_Var2);

IF
DB_PLA_FlamingFistAvailable(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var2, TRIGGERGUID_S_PLA_DesireSpotFF_4e4a06d4-0926-4440-94a9-bd320ccd00bc, _Var1, _Var1, _Var1)
THEN
DB_PLA_FlamingFistAvailableForDesire(_Var1, _Var2);
NOT DB_PLA_FlamingFistAvailableForDesire(_Var1, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_PLA_FlamingFistAvailable(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 != NULL_00000000-0000-0000-0000-000000000000
AND NOT
DB_InRegion(_Var2, TRIGGERGUID_S_PLA_DesireSpotFF_4e4a06d4-0926-4440-94a9-bd320ccd00bc, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_FlamingFistAvailableForDesire(_Var1, _Var2);
DB_PLA_FlamingFistAvailableForDesire(_Var1, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_InRegion(_Var1, TRIGGERGUID_S_PLA_DesireSpotFF_4e4a06d4-0926-4440-94a9-bd320ccd00bc, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFist(_Var2, _Var1, _, _, _Var1)
AND NOT
DB_PLA_FlamingFistAvailable(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_PLA_FlamingFistAvailableForDesire(_Var2, _Var1);
DB_PLA_FlamingFistAvailableForDesire(_Var2, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_StartDialog_AddExtraSpeakers((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_FlamingFistsDialogues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(_, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var2, _Var4);

IF
DB_PLA_FlamingFist(_, _Var2, _, _, _)
THEN
DB_GLO_DefeatCounter(_Var2, "PLA_FlamingFists");

PROC
PROC_GLO_DefeatCounter_AllDefeated("PLA_FlamingFists", _, _, _, _)
THEN
SetFlag(PLA_FlamingFists_State_DefeatCounter_e4c4ad77-ddc0-4802-9374-7971f0c1fd82, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_GLO_DefeatCounter_AllNoLongerDefeated("PLA_FlamingFists", _, _, _, _)
THEN
ClearFlag(PLA_FlamingFists_State_DefeatCounter_e4c4ad77-ddc0-4802-9374-7971f0c1fd82, NULL_00000000-0000-0000-0000-000000000000, 0);

QRY
QRY_SelectCustomDialog_AfterGenerics((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_FlamingFist(_, _Var1, _, _, _Var1)
AND NOT
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PLA_FlamingFists_OutsideDialog(_Var1, _Var2);

PROC
PROC_PLA_FlamingFists_OutsideDialog((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_FlamingFist(_, _Var1, _Var4, _, _Var1)
AND NOT
QRY_PLA_FlamingFist_FourFlamingFistsDialogue(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(_Var4, _Var1);

QRY
QRY_PLA_FlamingFist_FourFlamingFistsDialogue((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_FlamingFistAvailable(1, S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, S_PLA_FlamingFists_BeforeObstruction_ce0ee4d4-20d6-437e-a422-eec4ecd753f5, 1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailable(2, _Var2, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailable(3, _Var3, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailable(4, _Var4, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(DIALOGRESOURCEGUID_PLA_FlamingFists_2ec42843-e88d-1453-0e4d-19496d99214e, S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, _Var2, _Var3, _Var4, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PLA_FlamingFistAvailableForDesire(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFist(_, _Var1, _Var5, _, _Var1)
AND
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailable(_Var1, 1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(_Var5, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFist(_, _Var1, _Var5, _, _Var1)
AND
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, TRIGGERGUID_S_PLA_DesireSpotFF_4e4a06d4-0926-4440-94a9-bd320ccd00bc, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(1, _Var7, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(2, _Var8, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(3, _Var9, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(4, _Var10, _Var1, _Var1, _Var1)
AND
QRY_GLO_SelectFavouredSpeaker_SingleTag(_Var2, GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, AVATAR_306b9b05-1057-4770-aa17-01af21acd650, 0, _Var1)
AND
DB_QRYRTN_GLO_SelectFavouredSpeaker(_Var11, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(DIALOGRESOURCEGUID_PLA_Desire_8fbcdeb4-056d-168f-8c91-cc3af7acc4a4, GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var7, _Var8, _Var9, _Var10, _Var11, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(_Var5, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFist(_, _Var1, _, _Var6, _Var1)
AND
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, TRIGGERGUID_S_PLA_DesireSpotFF_4e4a06d4-0926-4440-94a9-bd320ccd00bc, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(_Var6, _Var1, _Var2);

IF
UseStarted((CHARACTER)_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInTrigger(_Var1, S_PLA_TavernInvestigation_Obstruction_SimpleClear_67e53b6e-fec3-4ba3-acd0-3395ac26821e, 1, _Var1, _Var1)
THEN
Die(S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9);

IF
UseStarted((CHARACTER)_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInTrigger(_Var1, S_PLA_TavernInvestigation_Obstruction_SimpleClear_67e53b6e-fec3-4ba3-acd0-3395ac26821e, 0, _Var1, _Var1)
AND
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_TavernInvestigation_State_TriedOnce_578df9b5-0b25-d7cc-0180-e29d765a63a4, _Var1, 0, _Var1, _Var1)
AND
IsPartyMember(_Var1, 1, 1, _Var1, _Var1)
THEN
RequestActiveRoll(_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, "Athletics", DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539, "PLA_TavernInvestigation_RollSuccess");

IF
UseStarted((CHARACTER)_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInTrigger(_Var1, S_PLA_TavernInvestigation_Obstruction_SimpleClear_67e53b6e-fec3-4ba3-acd0-3395ac26821e, 0, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_PLA_FlamingFistsDialogue(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_QRYRTN_StartDialog_FailReason(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_PLA_AddToFlamingFists(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_TavernInvestigation_State_TriedOnce_578df9b5-0b25-d7cc-0180-e29d765a63a4, _Var1, 0, _Var1, _Var1)
AND
IsPartyMember(_Var1, 1, 1, _Var1, _Var1)
THEN
PROC_TrySkillCheck(_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, "Athletics", DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539, "PLA_TavernInvestigation_RollSuccess");

IF
UseStarted((CHARACTER)_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsInTrigger(_Var1, S_PLA_TavernInvestigation_Obstruction_SimpleClear_67e53b6e-fec3-4ba3-acd0-3395ac26821e, 1, _Var1, _Var1)
AND
IsPartyMember(_Var1, 1, 1, _Var1, _Var1)
THEN
SetFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, NULL_00000000-0000-0000-0000-000000000000, 0);

QRY
QRY_PLA_FlamingFistsDialogue((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_FlamingFistsDismissedDialog(_, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, S_PLA_FlamingFists_BeforeObstruction_ce0ee4d4-20d6-437e-a422-eec4ecd753f5, 1, _Var1, _Var1)
AND
QRY_SelectAndStartDialog(S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_PLA_AddToFlamingFists((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DialogName(DIALOGRESOURCEGUID_PLA_FlamingFists_2ec42843-e88d-1453-0e4d-19496d99214e, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddListeningActor(_Var2, _Var1);

QRY
QRY_PLA_AddToFlamingFists((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DialogName(PLA_FlamingFists_OM_Wyll_COM_aa2656a6-ca46-1c28-766a-0615fceac215, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddListeningActor(_Var2, _Var1);

QRY
QRY_PLA_AddToFlamingFists((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_DialogName(PLA_FlamingFists_OM_Wyll_AOM_OOM_bd65b9b4-c263-2ab3-cec6-9af89e470e55, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddListeningActor(_Var2, _Var1);

PROC
PROC_RollResult("PLA_TavernInvestigation_RollSuccess", (CHARACTER)_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, 1, (CHARACTER)_Var1)
THEN
SetFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_RollResult("PLA_TavernInvestigation_RollSuccess", (CHARACTER)_Var1, S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, 0, (CHARACTER)_Var1)
THEN
SetFlag(PLA_TavernInvestigation_State_TriedOnce_578df9b5-0b25-d7cc-0180-e29d765a63a4, _Var1, 0);

IF
FlagSet(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
Die(S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9);

IF
DestroyingBy(S_PLA_TavernInvestigation_Obstruction_649559a6-2430-412f-983b-7a136f7be9c9, _, _, _, (CHARACTER)_)
THEN
SetFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DialogEnded(DIALOGRESOURCEGUID_PLA_FlamingFists_2ec42843-e88d-1453-0e4d-19496d99214e, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
AND
GetFlag(PLA_TavernInvestigation_State_TriedOnce_578df9b5-0b25-d7cc-0180-e29d765a63a4, _Var2, 1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var2, "PLA_TavernInvestigation_VB_OtherWay", _Var1, _Var1, _Var1)
THEN
StartVoiceBark(PLA_TavernInvestigation_VB_OtherWay_f862aa1b-5c3d-730b-69e3-e0891378f042, _Var2);

QRY
QRY_SelectCustomDialog_AfterGenerics(GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_PLA_DesireFreed()
AND
DB_PLA_FlamingFistAvailableForDesire(1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(2, _Var3, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(3, _Var4, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(4, _Var5, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(PLA_Desire_8fbcdeb4-056d-168f-8c91-cc3af7acc4a4, GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var2, _Var3, _Var4, _Var5, _Var1);

QRY
QRY_SelectCustomDialog_AfterGenerics(GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_PLA_DesireFreed()
THEN
DB_SelectedDialog(PLA_Desire_8fbcdeb4-056d-168f-8c91-cc3af7acc4a4, GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var1);

PROC
PROC_SpotPlayers_Spotted(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_PLA_DesireFreed()
AND
QRY_StartDialog(PLA_Desire_FirstThanks_7bf20efb-e74b-2e8e-c15a-f5620115b254, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("PLA_Desire_FirstThanks");

PROC
PROC_SpotPlayers_Spotted(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_PLA_DesireFreed()
AND
DB_PLA_FlamingFistAvailableForDesire(1, _Var2, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(2, _Var3, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(3, _Var4, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFistAvailableForDesire(4, _Var5, _Var1, _Var1, _Var1)
AND
QRY_GLO_SelectFavouredSpeaker_SingleTag(_Var1, GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, AVATAR_306b9b05-1057-4770-aa17-01af21acd650, 0, _Var1)
AND
DB_QRYRTN_GLO_SelectFavouredSpeaker(_Var6, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(DIALOGRESOURCEGUID_PLA_Desire_8fbcdeb4-056d-168f-8c91-cc3af7acc4a4, GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var2, _Var3, _Var4, _Var5, _Var6, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_DialogFlagSetup(DIALOGRESOURCEGUID_PLA_Desire_8fbcdeb4-056d-168f-8c91-cc3af7acc4a4, _, _, _, _, _, _, _, _, _)
AND
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire");

QRY
QRY_PLA_DesireFreed()
AND
DB_GlobalFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, _, _, _, _)
THEN
DB_NOOP(1);

IF
DialogEnded(DIALOGRESOURCEGUID_PLA_Desire_8fbcdeb4-056d-168f-8c91-cc3af7acc4a4, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af, _, _, _, _)
AND
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _, _, _, _)
THEN
PROC_SpotPlayers_RestartSpotting(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire");

IF
DialogEnded(DIALOGRESOURCEGUID_PLA_Desire_8fbcdeb4-056d-168f-8c91-cc3af7acc4a4, _, _, _, _)
AND
DB_GlobalFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
PROC_CharacterMoveTo(GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_Tavern_DisappearPoint_7f357e5d-fd79-432c-9585-588396e0e9d1, "Walk", "PLA_Tavern_ReadyForDisappear");
TriggerUnregisterForCharacter(TRIGGERGUID_S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
TriggerUnregisterForCharacter(S_PLA_DesireFreedTrigger2_6ecb7b16-2371-40de-b948-1f18d227d9d6, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);

IF
FlagSet((GUIDSTRING)_Var1, _, (INTEGER)_Var3, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_PLA_FlamingFistsDismissedFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PLA_FlamingFistsDismissedDialog(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_PLA_FlamingFistsDismissedDialog(_Var3);

IF
DB_PLA_FlamingFistsDismissedDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogName(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFist(_, _Var4, _, _, _Var1)
AND NOT
DB_CantMove(_Var4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogNPCs(_, _Var4, _, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var4, _, _Var1, _Var1, _Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Var4);
PROC_CharacterMoveTo(_Var4, S_PLA_Tavern_DisappearPoint_7f357e5d-fd79-432c-9585-588396e0e9d1, "Walk", "PLA_Tavern_ReadyForDisappear");

IF
DB_GlobalFlag(PLA_FlamingFists_State_Dismissed_dd58c8da-5800-4344-a535-5e78d05401d0, _, _, _, _)
AND
DB_PLA_FlamingFist(_, _Var2, _, _, _)
AND NOT
DB_CantMove(_Var2, _, _, _, _)
AND NOT
DB_DialogNPCs(_, _Var2, _, _, _)
AND NOT
DB_Is_InCombat(_Var2, _, _, _, _)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Var2);
PROC_CharacterMoveTo(_Var2, S_PLA_Tavern_DisappearPoint_7f357e5d-fd79-432c-9585-588396e0e9d1, "Walk", "PLA_Tavern_ReadyForDisappear");

IF
DB_PLA_FlamingFistsDismissedDialog(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogName(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_PLA_LeavingFlamingFistOutside(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantMove(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_DialogNPCs(_, _Var3, _, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var3, _, _Var1, _Var1, _Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Var3);
PROC_CharacterMoveTo(_Var3, S_PLA_Tavern_DisappearPoint_7f357e5d-fd79-432c-9585-588396e0e9d1, "Walk", "PLA_Tavern_ReadyForDisappear");

IF
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _, _, _, _)
AND
DB_Defeated(S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, _, _, _, _)
AND NOT
DB_PLA_FlamingFistsDismissedDialog(_, _, _, _, _)
THEN
SetFlag(PLA_FlamingFists_State_Dismissed_dd58c8da-5800-4344-a535-5e78d05401d0, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_InRegion(CHARACTERGUID_S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _, _, _, _)
AND NOT
DB_CantTalk_IgnoreCombat(S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, _, _, _, _)
AND NOT
DB_CantTalk_IgnoreCombat(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _, _, _, _)
AND NOT
DB_Defeated(S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, _, _, _, _)
AND NOT
DB_Defeated(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_TavernInvestigation_State_InstructionGiven_cacad2cd-873d-4661-aed8-94cd366d72f6, _, _, _, _)
AND
DB_InRegion(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireTrappedRoom_3063bdd1-3c92-4c46-9804-15098cfe54ad, _, _, _)
AND
Exists(S_PLA_Tavern_Support3_52471f6d-8514-4168-96da-0f09b7a3b36f, 1, _, _, _)
AND
IsDestroyed(S_PLA_Tavern_Support3_52471f6d-8514-4168-96da-0f09b7a3b36f, 0, _, _, _)
AND
Exists(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 1, _, _, _)
AND
IsDestroyed(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 0, _, _, _)
AND
IsLocked(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 1, _, _, _)
AND
QRY_StartDialog(DIALOGRESOURCEGUID_PLA_FlamingFist1_AD_FlamingFist1ComeIn_4e30fe12-f782-6813-e093-7fcddde35ff7, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911, _, _)
THEN
PROC_GlobalSetFlagAndCache(PLA_TavernInvestigation_State_InstructionGiven_cacad2cd-873d-4661-aed8-94cd366d72f6);
TriggerUnregisterForCharacter(S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, CHARACTERGUID_S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911);

IF
DB_PermaDefeated(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var1, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFist(_, _Var1, _, _, _Var1)
AND NOT
DB_GlobalFlag(PLA_FlamingFists_State_Dismissed_dd58c8da-5800-4344-a535-5e78d05401d0, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("PLA_FlamingFists_ReactToDeadDesire", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(PLA_Flamingfists_AD_FoundDeadDesire_bd32b055-5b44-5fe6-4d10-93b95251e52a, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_FlamingFists_State_Dismissed_dd58c8da-5800-4344-a535-5e78d05401d0);

IF
DB_PermaDefeated(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var1, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var1, _Var1, _Var1)
AND
DB_PLA_FlamingFist(_, _Var1, _, _, _Var1)
AND NOT
DB_GlobalFlag(PLA_FlamingFists_State_Dismissed_dd58c8da-5800-4344-a535-5e78d05401d0, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("PLA_FlamingFists_ReactToDeadDesire", _Var1, _Var1, _Var1, _Var1)
AND
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(PLA_FlamingFists_State_Dismissed_dd58c8da-5800-4344-a535-5e78d05401d0);

PROC
PROC_DialogFlagSetup(PLA_Flamingfists_AD_FoundDeadDesire_bd32b055-5b44-5fe6-4d10-93b95251e52a, _, (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_OnlyOnce("PLA_FlamingFists_ReactToDeadDesire");

PROC
PROC_PLA_TryBurnDownTavern()
AND
QRY_OnlyOnce("PLA_TryBurnDownTavern", _, _, _, _)
THEN
PROC_PLA_BurnDownTavern();

PROC
PROC_PLA_BurnDownTavern()
AND NOT
QRY_PLA_Desire_Freed()
THEN
Die(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, 0, 1);

PROC
PROC_PLA_BurnDownTavern()
AND
QRY_PLA_Desire_Freed()
THEN
SetOnStage(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, 0);

PROC
PROC_PLA_BurnDownTavern()
THEN
PROC_TriggerUnregisterForParty(S_PLA_TavernInvestigation_BurnDownTrigger_Inner_df11a25c-e374-499b-9993-47c44b9b84b0);
SetFlag(PLA_TavernInvestigation_State_BurntDown_ad34c392-4499-402c-ae51-8c3d40985f8b, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_PLA_TavernInvestigation_DousePersistentFlames();
SetOnStage(S_PLA_StuckHalfElf_HazardFire01_1e1efef8-e728-48fb-97ee-09c714e3b7ec, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire02_14e9c573-bade-4b3d-97cf-578d76ba61ec, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire03_f4a5b9b0-b19c-45cc-ae97-5b32723d98bd, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire04_c191f4ee-1830-41bc-8b1e-4d04cd44e341, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire05_27aff04a-b6e6-4983-9f19-af7fe3f8118f, 0);
SetOnStage(S_PLA_StuckHalfElf_HazardFire06_0c076fe6-b588-4304-a6e4-5c33d81e840b, 0);

PROC
PROC_PLA_TavernInvestigation_DousePersistentFlames()
AND
DB_PLA_TavernInvestigation_PersistentFlame(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
CreateSurface(_Var1, "SurfaceAsh", 4, 0);
CreatePuddle(_Var1, "SurfaceAsh", 6, 8, 2, 4, 1);
SetOnStage(_Var1, 0);

PROC
PROC_PLA_BurnDownTavern()
AND NOT
DB_GlobalFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af, _, _, _, _)
THEN
SetFlag(PLA_FlamingFists_Knows_DesireDead_e84b2694-9377-e8c1-eaf1-970df68b2049, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_BurnDownTavern()
AND
DB_PLA_TavernFloors(_Var1, _, _Var1, _Var1, _Var1)
AND
Exists(_Var1, 1, _Var1, _Var1, _Var1)
AND
IsDestroyed(_Var1, 0, _Var1, _Var1, _Var1)
THEN
Die(_Var1, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 1);

PROC
PROC_PLA_BurnDownTavern()
AND NOT
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, _, _, _, _)
THEN
SetOnStage(ITEMGUID_S_PLA_TavernInvestigation_ObstructionBoard_649559a6-2430-412f-983b-7a136f7be9c9, 0);

PROC
PROC_PLA_BurnDownTavern()
AND
IsInTrigger(S_PLA_TavernInvestigation_DukesRiches_003cce23-b6ac-4442-a968-cd3430cb150c, S_PLA_TavernInvestigation_DukeRoom_dd5b0510-6067-490f-8bb8-392a1a430a59, 1, _, _)
THEN
Die(S_PLA_TavernInvestigation_DukesRiches_003cce23-b6ac-4442-a968-cd3430cb150c, 0, NULL_00000000-0000-0000-0000-000000000000, 0, 1);

PROC
PROC_PLA_BurnDownTavern()
AND NOT
DB_Dead(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, _, _, _, _)
AND
IsInTrigger(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, S_PLA_TavernInvestigation_BurnDownTrigger_Inner_df11a25c-e374-499b-9993-47c44b9b84b0, 1, _, _)
THEN
TeleportTo(S_PLA_FlamingFist8_c7dbb25b-69c0-4fb7-b4ba-f398b3e0e30a, S_PLA_FlamingFist8Home_25d8f28d-fbf5-4971-bde0-b25cbdebeed1, "", 0, 0, 0);

PROC
PROC_PLA_BurnDownTavern()
AND NOT
DB_Dead(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441, _, _, _, _)
AND
IsInTrigger(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441, S_PLA_TavernInvestigation_BurnDownTrigger_Inner_df11a25c-e374-499b-9993-47c44b9b84b0, 1, _, _)
THEN
TeleportTo(S_PLA_FlamingFist7_c28e5d52-8674-49a2-a60a-6e5ed47f4441, S_PLA_FlamingFist7_WanderTrigger_78adc24c-5334-408e-90e4-b3f40ef0d3f6, "", 0, 0, 0);

PROC
PROC_PLA_BurnDownTavern()
AND
QRY_PLA_Desire_Freed()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_PLA_Desire_TalkedToDesire(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_GrandDukeRescue", "LeftRegionAct1");

PROC
PROC_PLA_BurnDownTavern()
AND NOT
QRY_PLA_Desire_Freed()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate(_Var1, "PLA_GrandDukeRescue", "Counsellor_DidntRescue");

QRY
QRY_PLA_Desire_TalkedToDesire((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_GrandDukeRescue", "Counsellor_AcceptedHelp_NoLocation", 1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_PLA_Desire_TalkedToDesire((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_GrandDukeRescue", "Counsellor_AcceptedHelp_Moonrise", 1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_PLA_Desire_TalkedToDesire((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QuestUpdateIsUnlocked(_Var1, "PLA_GrandDukeRescue", "Counsellor_RefusedHelp", 1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsDestroyed(S_PLA_Tavern_Support3_52471f6d-8514-4168-96da-0f09b7a3b36f, 0, _Var1, _Var1, _Var1)
AND
IsDestroyed(S_PLA_TavernInvestigation_DesireDoor2_e6b2f9ca-a59b-4842-8c1b-1b6499b884f7, 0, _Var1, _Var1, _Var1)
AND
IsLocked(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireTrappedRoom_3063bdd1-3c92-4c46-9804-15098cfe54ad, 1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_PLA_DesireTrappedRoom_3063bdd1-3c92-4c46-9804-15098cfe54ad, 0, _Var1, _Var1)
AND
QRY_StartDialog(PLA_TavernInvestigation_DesireDoor_b74d5928-f524-cc8f-f55f-4a665fd7aeac, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 0);

IF
DialogEnded(PLA_TavernInvestigation_DesireDoor_b74d5928-f524-cc8f-f55f-4a665fd7aeac, _, _, _, _)
AND
DB_GlobalFlag(PLA_Desire_Quest_OpenDoor_233986ed-f17a-f9a2-4ca5-918ce0488f3d, _, _, _, _)
AND NOT
DB_Destroyed(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, _, _, _, _)
AND
IsClosed(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 1, _, _, _)
THEN
PROC_ItemUnlockAndOpen(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307);

IF
DialogEnded(PLA_TavernInvestigation_DesireDoor_b74d5928-f524-cc8f-f55f-4a665fd7aeac, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(PLA_Desire_Quest_BreakDoor_6e4af16c-bd4e-ae09-3c67-82c3da549fda, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Destroyed(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, _Var1, _Var1, _Var1, _Var1)
AND
IsClosed(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var2, 1, _Var1, _Var1)
THEN
Die(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, 0, _Var2, 0, 1, 25);

IF
Unlocked(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, _, _, (CHARACTER)_, (CHARACTER)_)
THEN
Open(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307);

IF
Opened(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, _, _, _, _)
THEN
PROC_TryStopDialogFor(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
SetFlag(PLA_TavernInvestigation_State_DesireFreed_6cbc6d66-e45a-4b98-a9df-59dfad97d1f0, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
LeftTrigger(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireTrappedRoom_3063bdd1-3c92-4c46-9804-15098cfe54ad, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_Quest_OpenDoor_233986ed-f17a-f9a2-4ca5-918ce0488f3d, _, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_Quest_BreakDoor_6e4af16c-bd4e-ae09-3c67-82c3da549fda, _, _, _, _)
AND NOT
DB_OnlyOnce("PLA_Desire_FirstThanks", _, _, _, _)
THEN
DB_SpotPlayers(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_CustomRadius(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire", 11);

IF
Opened(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, _, _, _, _)
AND
DB_DialogName(PLA_TavernInvestigation_DesireDoor_b74d5928-f524-cc8f-f55f-4a665fd7aeac, _, _, _, _)
THEN
ClearFlag(PLA_Desire_Quest_OpenDoor_233986ed-f17a-f9a2-4ca5-918ce0488f3d, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag(PLA_Desire_Quest_BreakDoor_6e4af16c-bd4e-ae09-3c67-82c3da549fda, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_ForceStopDialog(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);

IF
DestroyingBy(S_PLA_TavernInvestigation_DesireDoor_4f19d4a7-b9b0-4a6f-a9ce-b2442ad8a307, _, _, _, _)
AND
DB_DialogName(PLA_TavernInvestigation_DesireDoor_b74d5928-f524-cc8f-f55f-4a665fd7aeac, _, _, _, _)
THEN
ClearFlag(PLA_Desire_Quest_OpenDoor_233986ed-f17a-f9a2-4ca5-918ce0488f3d, NULL_00000000-0000-0000-0000-000000000000, 0);
ClearFlag(PLA_Desire_Quest_BreakDoor_6e4af16c-bd4e-ae09-3c67-82c3da549fda, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_ForceStopDialog(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);

IF
DB_InRegion(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, TRIGGERGUID_S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, _, _, _)
AND
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _, _, _, _)
THEN
SetFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
DB_InRegion(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, TRIGGERGUID_S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, _, _, _)
AND
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _, _, _, _)
AND NOT
QRY_PLA_DesireFreed()
AND NOT
DB_OnlyOnce("PLA_Desire_FirstThanks", _, _, _, _)
THEN
PROC_SpotPlayers_RestartSpotting(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire");

IF
DB_InRegion(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireFreedTrigger2_6ecb7b16-2371-40de-b948-1f18d227d9d6, _, _, _)
THEN
SetFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, NULL_00000000-0000-0000-0000-000000000000, 0);
DB_SpotPlayers(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_CustomRadius(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire", 11);
PROC_SpotPlayers_RestartSpotting(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire");

IF
LeftTrigger(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, TRIGGERGUID_S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, _, _, _)
AND NOT
DB_InRegion(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireFreedTrigger2_6ecb7b16-2371-40de-b948-1f18d227d9d6, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire");

IF
LeftTrigger(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireFreedTrigger2_6ecb7b16-2371-40de-b948-1f18d227d9d6, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af, _, _, _, _)
THEN
ClearFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
LeftTrigger(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, TRIGGERGUID_S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, _, _, _)
AND NOT
DB_GlobalFlag(PLA_Desire_Knows_StelmaneTaken_215e6f0d-d0b3-3d5c-0b0a-7cad1ef3b2af, _, _, _, _)
THEN
ClearFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
LeftTrigger(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireFreedTrigger2_6ecb7b16-2371-40de-b948-1f18d227d9d6, _, _, _)
AND NOT
DB_InRegion(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, "PLA_Desire");

IF
DestroyedBy(S_PLA_Floor3_e8d5e5f9-90c6-423d-8d1c-73fbf3d08985, _, _, _, _)
AND
IsInTrigger(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, S_PLA_DesireTrappedRoom_3063bdd1-3c92-4c46-9804-15098cfe54ad, 1, _, _)
THEN
PROC_TryStartAD(PLA_Desire_AD_FloorCollapse_96f20c7d-d1ab-aae5-2f5a-6df05bd25afe, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);

QRY
QRY_PLA_Desire_Freed()
AND
DB_GlobalFlag(PLA_Desire_State_Freed_1c015349-190c-d49f-1d93-227886976509, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_PLA_Desire_Freed()
AND
DB_GlobalFlag(PLA_Desire_State_Freed2_46dbc8ef-61fa-42c4-bc89-4a8f53d53e5b, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog((DIALOGRESOURCE)_Var1, _, (GUIDSTRING)_Var3, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_PLA_FlamingFistsDialogues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(PLA_TavernInvestigation_Quest_WallCollapsed_391d017d-cbfb-768a-086d-ea404313eab4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog((DIALOGRESOURCE)_Var1, _, (GUIDSTRING)_Var3, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_PLA_FlamingFistsDialogues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_TavernInvestigation_State_TriedOnce_578df9b5-0b25-d7cc-0180-e29d765a63a4, _Var3, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_OriginMoment_PreventRelaunchDialog((DIALOGRESOURCE)_Var1, _, (GUIDSTRING)_Var3, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_PLA_FlamingFistsDialogues(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(PLA_TavernInvestigation_State_TriedOnce_578df9b5-0b25-d7cc-0180-e29d765a63a4, S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EntityEvent((GUIDSTRING)_Var1, "PLA_TavernInvestigation_FireCameraShake", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_PLA_TavernInvestigation_BlockCameraShake(1, _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
AND
GetPosition(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
GetClosestPlayerToPosition(_Var2, _Var3, _Var4, _Var5, _Var6)
AND
_Var6 < 10
AND
Random(500, _Var7, _Var1, _Var1, _Var1)
AND
IntegerSum(100, _Var7, _Var8, _Var1, _Var1)
THEN
DB_PLA_TavernInvestigation_BlockCameraShake(1);
ObjectTimerLaunch(_Var1, "PLA_TavernInvestigation_BlockCameraShake", 10000);
PROC_CameraShakeAroundObject(_Var1, _Var8, 10);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "PLA_TavernInvestigation_BlockCameraShake", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
NOT DB_PLA_TavernInvestigation_BlockCameraShake(1);

IF
DB_PLA_TavernInvestigation_FirePuddle(_Var1, _Var2, _Var3, _Var4, _Var5, _Var6, _Var7, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForParty(_Var1);

IF
EnteredTrigger(_, (GUIDSTRING)_Var2, _, _, _)
AND
DB_PLA_TavernInvestigation_FirePuddle(_Var2, _Var3, _Var4, _Var5, _Var6, _Var7, 0, _, _, _)
AND
GetDistanceTo(S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9, _Var2, _Var8, _, _)
AND
_Var8 > 10
THEN
NOT DB_PLA_TavernInvestigation_FirePuddle(_Var2, _Var3, _Var4, _Var5, _Var6, _Var7, 0);
DB_PLA_TavernInvestigation_FirePuddle(_Var2, _Var3, _Var4, _Var5, _Var6, _Var7, 1);
CreatePuddle(_Var2, "SurfaceFire", _Var3, _Var4, _Var5, _Var6, _Var7);
PROC_TriggerUnregisterForParty(_Var2);

PROC
PROC_PLA_BurnDownTavern()
AND
DB_PLA_TavernInvestigation_FirePuddle(_Var1, _, _, _, _, _, 0, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForParty(_Var1);

PROC
PROC_PLA_BurnDownTavern()
AND
DB_PLA_TavernInvestigation_FirePuddle(_Var1, _, _, _, _, _, _, _Var1, _Var1, _Var1)
THEN
CreateSurface(_Var1, "SurfaceAsh", 10, 0);

IF
EnteredTrigger((GUIDSTRING)_Var1, S_PLA_Tavern_BuildingTrigger_16c5d3bb-422a-4bd8-a6a7-665d32d7303b, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
QuestUpdate(_Var1, "PLA_GrandDukeRescue", "EnteredInn");

IF
EnteredTrigger((CHARACTER)_Var1, S_PLA_DesireSideBuilding_b7f015ba-8712-4e08-953f-6177cc8b2830, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
QuestUpdate(_Var1, "PLA_GrandDukeRescue", "EnteredInn");

IF
EnteredTrigger((GUIDSTRING)_Var1, S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
QuestUpdate(_Var1, "PLA_GrandDukeRescue", "FoundStuckHalfElf");

IF
DB_PLA_FlamingFist(_, _Var2, _, _, _)
THEN
DB_SpotPlayers(_Var2, "PLA_FlamingFists_CheckDrow", PLA_FlamingFists_Event_RestartCheckDrow_72fafb77-fb70-47da-8598-6bbd0d71f578, PLA_FlamingFists_Event_PersuadedDrow_f4938c3e-9353-44e8-9088-b8163d3222c8);

IF
DB_PLA_LeavingFlamingFistOutside(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SpotPlayers(_Var1, "PLA_FlamingFists_CheckDrow", PLA_FlamingFists_Event_RestartCheckDrow_72fafb77-fb70-47da-8598-6bbd0d71f578, PLA_FlamingFists_Event_PersuadedDrow_f4938c3e-9353-44e8-9088-b8163d3222c8);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "PLA_FlamingFists_CheckDrow", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_ForceStopDialog(S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae);

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "PLA_FlamingFists_CheckDrow", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_PLA_TavernInvestigation_StartDrowAttack(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_HostileToPlayerGroup(ACT1_PLA_FlamingFists_b4e6e166-ea5f-50ef-6365-84c889f28238, _Var2);
PROC_EnterCombat(_Var1, _Var2);

QRY
QRY_PLA_TavernInvestigation_StartDrowAttack((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var1, S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae, _Var1, _Var1, _Var1)
AND
QRY_SelectAndStartDialog(S_PLA_FlamingFist5_c49b27b2-bd55-4c3f-a09a-7d787ab547ae, _Var1, _Var1, _Var1, _Var1)
AND
DB_SpotPlayers(_Var2, "PLA_FlamingFists_CheckDrow", _, _, _Var1)
THEN
PROC_SpotPlayers_StopSpotting(_Var2, "PLA_FlamingFists_CheckDrow");

IF
DB_SpotPlayers(_Var1, "PLA_FlamingFists_CheckDrow", _, _, _Var1)
THEN
DB_SpotPlayers_SpotterIgnoreCantTalk(_Var1, "PLA_FlamingFists_CheckDrow");
DB_SpotPlayers_HasTag(_Var1, "PLA_FlamingFists_CheckDrow", LOLTHDROWELF_ef9c5b74-56a8-48cc-b0b9-169ee16bf026, 1);

IF
LeftCombat((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(PLA_FlamingFists_State_PersuadedDrow_d8bc1e0a-6e88-4890-ac53-6bc2457cfa6a, _Var1, _Var1, _Var1, _Var1)
AND
DB_SpotPlayers(_Var1, "PLA_FlamingFists_CheckDrow", _, _, _Var1)
THEN
SetFlag(PLA_FlamingFists_Event_RestartCheckDrow_72fafb77-fb70-47da-8598-6bbd0d71f578, NULL_00000000-0000-0000-0000-000000000000, 0);

IF
FlagSet(PLA_FlamingFists_State_PersuadedDrow_d8bc1e0a-6e88-4890-ac53-6bc2457cfa6a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(PLA_FlamingFists_Event_PersuadedDrow_f4938c3e-9353-44e8-9088-b8163d3222c8, NULL_00000000-0000-0000-0000-000000000000, 0);

PROC
PROC_PLA_BurnDownTavern()
THEN
GoalCompleted;

IF
TextEvent("PLA_Tavern_BurnDown", _, _, _, _)
THEN
PROC_PLA_BurnDownTavern();


EXITSECTION
TriggerUnregisterForCharacter(S_PLA_DesireTrappedRoom_3063bdd1-3c92-4c46-9804-15098cfe54ad, S_GLO_Desire_8b9fa503-7205-4ddd-bdfa-bfaa781d9ea9);
TriggerUnregisterForCharacter(S_PLA_DesireFreedTrigger_851f5f1e-8472-4fca-9da0-603620973c30, S_PLA_FlamingFist1_646a4195-4091-4dc9-81e1-cff2604f3911);
PROC_TriggerUnregisterForPlayers(S_PLA_Tavern_BuildingTrigger_16c5d3bb-422a-4bd8-a6a7-665d32d7303b);
PROC_TriggerUnregisterForPlayers(S_PLA_StuckHalfElf_Room1Box_98660638-e875-49d4-a0b0-95d39ae56728);
PROC_TriggerUnregisterForPlayers(S_PLA_DesireSideBuilding_b7f015ba-8712-4e08-953f-6177cc8b2830);
ENDEXITSECTION

ParentTargetEdge "Act1"
