Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_AmbushTrigger(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_GremishkaAmbushSpotTrigger_20cf9507-f891-410f-93b2-28bd7e8716f4, DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka1_0a90fe66-f684-4916-b832-9bba88478aa5, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka2_d8114c31-4b0b-4870-9266-9fcde9814192, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka3_fd68f117-da9f-47ae-bcc6-c4a6dd268c45, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka4_d29fb179-6b15-4abf-bd0a-a3b0d4c7cd0c, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka5_6527f138-e78b-40b9-9c6e-1a7f987c6f2a, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka6_e16183ca-940f-4264-93f3-06e9df16f68e, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka7_6162d586-c42c-4b38-9202-e320c47aad19, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka8_3a4d4e1d-552e-40be-b625-dab9e6b46927, 1);
DB_Ambushtrigger_Ambusher(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, S_CRE_Gremishka9_958f84d7-2f70-421e-be8d-3c1ade96f10d, 1);
PROC_TriggerRegisterForPlayers(S_CRE_GremishkaLurezone_02f8d8ca-b24c-476e-a5fa-ddb02c0cf7a8);
DB_Gremishkas(S_CRE_Gremishka1_0a90fe66-f684-4916-b832-9bba88478aa5);
DB_Gremishkas(S_CRE_Gremishka2_d8114c31-4b0b-4870-9266-9fcde9814192);
DB_Gremishkas(S_CRE_Gremishka3_fd68f117-da9f-47ae-bcc6-c4a6dd268c45);
DB_Gremishkas(S_CRE_Gremishka4_d29fb179-6b15-4abf-bd0a-a3b0d4c7cd0c);
DB_Gremishkas(S_CRE_Gremishka5_6527f138-e78b-40b9-9c6e-1a7f987c6f2a);
DB_Gremishkas(S_CRE_Gremishka6_e16183ca-940f-4264-93f3-06e9df16f68e);
DB_Gremishkas(S_CRE_Gremishka7_6162d586-c42c-4b38-9202-e320c47aad19);
DB_Gremishkas(S_CRE_Gremishka8_3a4d4e1d-552e-40be-b625-dab9e6b46927);
DB_Gremishkas(S_CRE_Gremishka9_958f84d7-2f70-421e-be8d-3c1ade96f10d);
DB_CRE_BooksBehindBars(S_CRE_Abbot3_Book_84091a7d-f436-4ec3-abec-72a1e319cf48, FUR_GEN_Prison_Cage_Dog_A_Door_570b1a09-ed2a-4ac4-adaa-28f8799ecfa9, S_CRE_LibraryLocker2_b16b0411-7aea-4f43-8ace-68a5f6da8e5d);
DB_CRE_BooksBehindBars(S_CRE_Book_HistoryOfBlood_03_96b8058a-8288-4d76-b934-2cf863337609, FUR_GEN_Prison_Cage_Dog_A_Door_e4e0b9f0-af59-4b5a-8629-64ba0d86fcac, S_CRE_LibraryLocker3_2f616adf-92e8-4a94-b4f3-2fe31cd58512);
DB_CRE_BooksBehindBars(S_CRE_Book_HistoryOfBlood_01_b34edc88-4680-4291-a214-1785fd3eec70, FUR_GEN_Prison_Cage_Dog_A_Door_002_3fe3ced1-044f-43c4-b00e-05d0d69abcba, S_CRE_Entrance_BookStorage_01_6fa4e433-7cd3-49bd-8cee-27a73ab2e56d);
DB_CRE_BooksBehindBars(S_CRE_Book_HistoryOfBlood_02_671f9f91-dd5d-456f-8fdd-5e5b410a5e70, FUR_GEN_Prison_Cage_Dog_A_Door_001_59c2cd14-da1b-483b-ab17-365dc09dec7b, S_CRE_Entrance_BookStorage_02_3a5100c0-4eea-4d94-9a9b-1fd800baf18f);
TriggerRegisterForItems(S_CRE_LibraryLocker2_b16b0411-7aea-4f43-8ace-68a5f6da8e5d);
TriggerRegisterForItems(S_CRE_LibraryLocker3_2f616adf-92e8-4a94-b4f3-2fe31cd58512);

KBSECTION
IF
DB_InRegion(_Var1, S_CRE_GremishkaLurezone_02f8d8ca-b24c-476e-a5fa-ddb02c0cf7a8, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OncePerUserAndNearbyPlayers(_Var1, "CRE_LibraryGremishkaCry", _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(CRE_Library_AD_GremishkaCry_34aed394-e972-2902-0549-ff35249f0a38, S_CRE_InvisibleGremishkaCrySource_9fa36d11-570e-49fa-ad2a-4b7579da83ad);
DB_CRE_GremishkaCry_Listener(_Var1);

IF
AutomatedDialogEnded(CRE_Library_AD_GremishkaCry_34aed394-e972-2902-0549-ff35249f0a38, _, _, _, _)
AND
DB_CRE_GremishkaCry_Listener(_Var2, _, _, _, _)
THEN
StartVoiceBark(CRE_Library_VB_GremiskaCryReaction_ebd3a356-fd0a-3aac-aa18-194410c0299d, _Var2);

PROC
PROC_RevealAmbush(S_CRE_GremishkaAmbushSpotTrigger_20cf9507-f891-410f-93b2-28bd7e8716f4, _, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
PROC_CancelAmbush(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a);

PROC
PROC_LaunchAmbush(S_CRE_GremishkaAmbushTrigger_99df15d5-bce2-4421-8bcd-ee0f8610ab9a, _, _, _, _)
AND
DB_Gremishkas(_Var2, _, _, _, _)
THEN
PlayAnimation(_Var2, CUST_Spawn_Nest_01_f6a0dda5-7adf-4a59-bd26-9fad9d04defa, "");

IF
EnteredCombat((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Gremishkas(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("CRE_GremishkaCombatIDSaved", _Var1, _Var1, _Var1, _Var1)
THEN
DB_CRE_LibraryGremishkaFight(_Var2);

IF
SwitchedCombat(_, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, _, _)
AND
DB_CRE_LibraryGremishkaFight(_Var2, _, _, _, _)
THEN
NOT DB_CRE_LibraryGremishkaFight(_Var2);
DB_CRE_LibraryGremishkaFight(_Var3);

IF
TurnStarted((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_CRE_LibraryGremishkaFight(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_KnowledgeCheck(_Var1, "CRE_Library_GremishkaRecognitionCheck", S_CRE_Gremishka1_0a90fe66-f684-4916-b832-9bba88478aa5, "Arcana", DC_Legacy_15_bddbb9b8-a242-4c3e-a2eb-3fd274c0c539);

PROC
PROC_GLO_KnowledgeCheckSuccess((GUIDSTRING)_Var1, "CRE_Library_GremishkaRecognitionCheck", _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_OnlyOnce("CRE_GremishkaRecognition_VBPlayed", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(CRE_Library_PAD_GremishkaRecognition_8b99c86d-c7b5-3ed7-070f-acd6e4ce504b, _Var1);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_CRE_BooksBehindBars(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
IsInTrigger(_Var2, _Var4, 1, _Var1, _Var1)
AND
IsClosed(_Var3, 1, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, _Var2, 0);
ShowError(_Var1, "CannotReach");

PROC
PROC_BlockMoveOfItem((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_CRE_BooksBehindBars(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
IsInTrigger(_Var2, _Var4, 1, _Var1, _Var1)
AND
IsClosed(_Var3, 1, _Var1, _Var1, _Var1)
THEN
DB_CustomMoveItemResponse(_Var1, _Var2, 0);
ShowError(_Var1, "CannotReach");

PROC
PROC_BlockPickupOfItem((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_CRE_BooksBehindBars(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
IsInTrigger(_Var2, _Var4, 1, _Var1, _Var1)
AND
IsClosed(_Var3, 1, _Var1, _Var1, _Var1)
THEN
DB_CustomPickupItemResponse(_Var1, _Var2, 0);
ShowError(_Var1, "CannotReach");

IF
StatusRemoved((CHARACTER)_Var1, "GREMISHKA_UNSTABLE", _, _, (CHARACTER)_Var1)
THEN
SetEntityEventReal(_Var1, "GLO_CombatWait", 3);

IF
StatusApplied((CHARACTER)_Var1, "GREMISHKA_MAGICALLERGY_PANTHER", _, _, (CHARACTER)_Var1)
THEN
RequestSetSwarmGroup(_Var1, "");

IF
CastSpell((GUIDSTRING)_Var1, "Shout_MagicAllergy_GremishkaSpawn", _, _, _)
THEN
SetOnStage(_Var1, 0);

IF
StatusApplied((GUIDSTRING)_Var1, "GREMISHKA_UNSTABLE", _, _, (GUIDSTRING)_Var1)
AND
DB_Players(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var5, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var4, _Var5, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("CRE_Monastery_ReactedToGremishkaAllergy", _Var1, _Var1, _Var1, _Var1)
THEN
StartVoiceBark(CRE_Library_VB_GremiskaAllergyComment_a3b71e95-c724-caa5-eae4-5d161908114b, _Var4);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act1b"
