Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_GlobalFlagReactionAfterDialog(GLO_Jergal_Event_JergalGoesToCamp_aab18775-d628-42ea-914b-e72b45ee9509, CHA_Crypt_Jergal_732520d9-a5aa-b761-84ad-429d599559a5);
SetFlag(GLO_Jergal_State_CanResurrect_736d598a-ab47-4a25-b9e0-d5499b19fef3, NULL_00000000-0000-0000-0000-000000000000);
PROC_SetInvulnerable(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 1);
PROC_CharacterDisableAllCrimes(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 1);
DB_GLO_Jergal_HasMetFlags(CHA_Jergal_HasMet_70b87ded-1ef6-a42e-dda5-2e0659fc5cec);
DB_GLO_Jergal_HasMetFlags(SCE_Jergal_HasMet_10c004a4-8408-66be-3e56-8e5ddb297af3);
DB_GLO_Jergal_HasMetFlags(CAMP_Jergal_HasMet_fdba7b59-851a-3edb-fe0f-d6045c5f8dd3);
DB_GLO_Jergal_ResurrectionDialogues(CAMP_Jergal_7f4acd9b-15c0-81fe-9409-623634ec3ed3, 200);
DB_GLO_Jergal_ResurrectionDiscount(0);
DB_GLO_Jergal_ResurrectionStringVariableAndFlags("CAMP_Jergal_PlayerToResurrect_1_c85cdca4-6579-776d-206d-6967e4999281", CAMP_Jergal_State_PlayerDead_1_CanBeResurrected_ce41c909-e150-47c2-b506-32715f1b5180, CAMP_Jergal_State_PlayerDead_1_f7c984fb-04b3-426b-b500-4c3f9e68e33c, CAMP_Jergal_Event_ResurrectPlayer_1_1aa10cc1-4399-4321-8196-8cb5e1c1a0db, CAMP_Jergal_State_CanDismiss_Player1_96587543-6ced-41cf-b74e-6204d189915b, CAMP_Jergal_Event_DismissDeadPlayer1_e3686b79-fdf4-4f85-a11d-5afc0bd9fd1d);
DB_GLO_Jergal_ResurrectionStringVariableAndFlags("CAMP_Jergal_PlayerToResurrect_2_b1161c91-1bde-6a1c-297e-ee0bfc1a57c4", CAMP_Jergal_State_PlayerDead_2_CanBeResurrected_cc359a91-c4db-4733-a78a-2895945b120a, CAMP_Jergal_State_PlayerDead_2_76f91e89-8e6d-4b83-8b0d-9b3742a726fd, CAMP_Jergal_Event_ResurrectPlayer_2_6ab66361-6787-4160-9346-4290336dbfd3, CAMP_Jergal_State_CanDismiss_Player2_45879163-6c0f-45ca-96a4-795b961e3d69, CAMP_Jergal_Event_DismissDeadPlayer2_2bc4634a-e422-4cf1-9af1-38e5dc84985a);
DB_GLO_Jergal_ResurrectionStringVariableAndFlags("CAMP_Jergal_PlayerToResurrect_3_56966d5e-534d-4930-264e-050a2345db3d", CAMP_Jergal_State_PlayerDead_3_CanBeResurrected_4b50f4fd-59a3-4805-9dda-8ddf8c678e72, CAMP_Jergal_State_PlayerDead_3_4b707fd4-318e-43b2-8ffe-29f0dac02a72, CAMP_Jergal_Event_ResurrectPlayer_3_a36160e6-98ec-4477-bd2c-dffc9d96b7c2, CAMP_Jergal_State_CanDismiss_Player3_532098ee-6d78-495f-b1ce-8df081116e6d, CAMP_Jergal_Event_DismissDeadPlayer3_8a8911f2-ef56-43f9-a6ba-3021ed616988);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, CAMP_Jergal_State_CanResurrectAstarion_1e23fcb6-90a5-42be-8365-b27a5df03bfb, CAMP_Jergal_State_WillResurrectAstarion_ebc60261-98d7-40c8-aec8-3cf2d5a2110a);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_Gale_ad9af97d-75da-406a-ae13-7071c563f604, CAMP_Jergal_State_CanResurrectGale_d9a0568f-c0b1-43ff-844c-ad140f248b5e, CAMP_Jergal_State_WillResurrectGale_4fe9fd56-5c86-4a0d-9b5b-3471686f9ba2);
DB_GLO_Jergal_CompanionResurrectionFlags(S_GLO_Halsin_7628bc0e-52b8-42a7-856a-13a6fd413323, CAMP_Jergal_State_CanResurrectHalsin_41814487-c967-43c9-a001-a3f6615de23d, CAMP_Jergal_State_WillResurrectHalsin_3895bab4-3d4b-4a89-bc11-9d3a832fe029);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_Jaheira_91b6b200-7d00-4d62-8dc9-99e8339dfa1a, CAMP_Jergal_State_CanResurrectJaheira_2f84e5b8-b2ae-410b-8931-dc78f3511882, CAMP_Jergal_State_WillResurrectJaheira_c28fd02c-06a4-48b6-ad9a-a218711992c7);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c, CAMP_Jergal_State_CanResurrectKarlach_e0f009cb-6e6d-4f4f-b097-fa418ce7b430, CAMP_Jergal_State_WillResurrectKarlach_b5b85189-fe48-4a16-99fe-e76149c62432);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, CAMP_Jergal_State_CanResurrectLaezel_5a629c4e-911e-48c2-90ab-f94983a5da75, CAMP_Jergal_State_WillResurrectLaezel_62822cd8-3ecc-48f2-b9c9-04e00329fde4);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_Minsc_0de603c5-42e2-4811-9dad-f652de080eba, CAMP_Jergal_State_CanResurrectMinsc_f18139b2-0e0d-4fb4-b766-dd52808adc4d, CAMP_Jergal_State_WillResurrectMinsc_410287d3-f29b-4b7b-8f8f-0309f566f39a);
DB_GLO_Jergal_CompanionResurrectionFlags(S_GOB_DrowCommander_25721313-0c15-4935-8176-9f134385451b, CAMP_Jergal_State_CanResurrectMinthara_00f8006f-70d7-478d-8d3e-0f10ea9fb758, CAMP_Jergal_State_WillResurrectMinthara_d0d36d66-e2e5-417c-aa72-f62020f8c8d0);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, CAMP_Jergal_State_CanResurrectShadowheart_99d4fea1-9522-4eaa-a791-77213b1745ab, CAMP_Jergal_State_WillResurrectShadowheart_382bd554-7e94-4f22-a76d-cb43e430e94e);
DB_GLO_Jergal_CompanionResurrectionFlags(S_Player_Wyll_c774d764-4a17-48dc-b470-32ace9ce447d, CAMP_Jergal_State_CanResurrectWyll_ea496c74-0060-47ab-836e-8173388d48f6, CAMP_Jergal_State_WillResurrectWyll_f186ab7b-5468-4220-b7d0-9ce9c0722807);
DB_GLO_Jergal_HirelingResurrectionFlags("CAMP_Jergal_HirelingToResurrect_1_fa2171f8-8d13-5557-8df8-a7d8dd053dd9", CAMP_Jergal_State_CanResurrect_Hireling1_508a35fd-7026-49f6-bf2b-f70c3f70718d, CAMP_Jergal_State_WillResurrect_Hireling1_0c19f5fc-9b85-4208-bce4-43a48274cf84);
DB_GLO_Jergal_HirelingResurrectionFlags("CAMP_Jergal_HirelingToResurrect_2_d2808a7c-b7db-96a3-1c5f-e050b22a592b", CAMP_Jergal_State_CanResurrect_Hireling2_233ba52e-8ff6-4316-9db3-2492f21d1dcd, CAMP_Jergal_State_WillResurrect_Hireling2_bccda46b-6a29-46e0-9c6c-14affc26df6b);
DB_GLO_Jergal_HirelingResurrectionFlags("CAMP_Jergal_HirelingToResurrect_3_ba49d24f-75ee-10b0-57e1-b5fb5ee977bb", CAMP_Jergal_State_CanResurrect_Hireling3_b77e8111-b02f-4aa5-8b95-1fe2cd4b33c4, CAMP_Jergal_State_WillResurrect_Hireling3_a42958bf-5b9f-4bc1-8d11-f5cff3ece56d);
DB_OriginCampFlags(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, JERGAL_22380f91-e71d-45d9-b4b4-99ff13645af0, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_ORI_OriginCampData(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "WLDMAIN", S_CAMP_JergalDayPos_1a7f4258-1a12-4c0f-b05c-53571ecf3ec0);
DB_ORI_OriginCampData(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "WLDCAVGRN", S_CAMP_WLDCAVGRN_Priest_6b516945-9ce0-4874-bec1-8cc64b8334a9);
DB_ORI_OriginCampData(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "WLDCAVSND", S_CAMP_WLDCAVSND_Priest_138a6fa8-4654-47fd-b1ea-4b3cae21c4c5);
DB_ORI_OriginCampData(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "WLDDUNABB", S_CAMP_WLDDUNABB_Priest_1efcf77c-eafd-4895-9026-36a14aae6e1d);
DB_ORI_OriginCampData(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "WLDDUNSHA", S_CAMP_WLDDUNSHA_Priest_8dad37c7-c5aa-4095-9d18-32c19da604f7);
DB_ORI_OriginCampData(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "WLDUND", S_CAMP_WLDUND_Priest_e09ddb5c-dcc4-4494-86b3-392f1666a1b8);
DB_ORI_OriginCampData(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "WLDBAS", S_CAMP_WLDBAS_Priest_a9e6929b-fc6d-4484-bd46-c347f4709617);
DB_GLO_Jergal_ForceToCampInLevel("CRE_Main_A");
DB_GLO_Jergal_ForceToCampInLevel("SCL_Main_A");
DB_GLO_Jergal_ForceToCampInLevel("BGO_Main_A");
DB_GLO_Jergal_ForceToCampInLevel("INT_Main_A");
DB_GLO_Jergal_ForceToCampInLevel("CTY_Main_A");

KBSECTION
IF
TextEvent("CAMP_JergalToCamp", _, _, _, _)
THEN
PROC_GLO_Jergal_MoveToCamp();
PROC_GLO_Jergal_Appear();

IF
TextEvent("fullcamp", _, _, _, _)
THEN
PROC_GLO_Jergal_MoveToCamp();
PROC_GLO_Jergal_Appear();

IF
TextEvent("JergalRes", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Var1);
PROC_GLO_Jergal_SetDeadPlayers();
DB_Debug_InJergalRes(1);
PROC_GLO_Jergal_PrepareAllPlayersResurrection();
NOT DB_Debug_InJergalRes(1);
PROC_GLO_Jergal_ResurrectPlayers();

QRY
QRY_GLO_Jergal_BlockResurrection((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Debug_InJergalRes(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Noop(1);

IF
EntityEvent(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "DebugTeleportedToCamp", _, _, _)
THEN
PROC_GLO_Jergal_MoveToCamp();
PROC_GLO_Jergal_Appear();

IF
EnteredChasm(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, _, _, _, _, (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GLO_Jergal_MoveToCamp();
PROC_GLO_Jergal_Appear();
PROC_TeleportSmoke(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);

IF
DB_CurrentLevel("WLD_Main_A", _, _, _, _)
THEN
PROC_TriggerRegisterForPlayers(S_GOB_JergalAppear_BackupZone_13961b54-9126-4dea-abe0-175e66afba66);

IF
DB_GlobalFlag(GLO_Jergal_State_JergalAtCamp_1d7473f8-8651-4077-935e-ecafd78c945a, _, _, _, _)
THEN
DB_GLO_JergalCameToCamp(1);

IF
EnteredTrigger((CHARACTER)_Var1, S_GOB_JergalAppear_BackupZone_13961b54-9126-4dea-abe0-175e66afba66, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GLO_JergalCameToCamp(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TriggerUnregisterForPlayers(S_GOB_JergalAppear_BackupZone_13961b54-9126-4dea-abe0-175e66afba66);
PROC_GLO_Jergal_MoveToCamp();
PROC_GLO_Jergal_Appear();

IF
RelationChanged(GLO_Jergal_bc9d422f-04a9-4338-93e5-1da13fda1407, Hero_a1542c81-6895-929e-4522-10ce218bb360, _, _, (INTEGER)_)
THEN
PROC_SetRelationToPlayers(GLO_Jergal_bc9d422f-04a9-4338-93e5-1da13fda1407, 50);

QRY
QRY_DialogAttackRequested_CustomResponse(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, (CHARACTER)_, (CHARACTER)_, (CHARACTER)_)
THEN
SetFlag(CHA_Jergal_Event_AttemptedAttack_c2fc2844-dfe7-4eb2-6ab6-301eea35fe4e, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
PROC_TryStopDialogFor(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);

QRY
QRY_DialogAttackRequested_CustomResponse(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, _, _, _)
AND
DB_GLO_Jergal_PlayAttackADAfterDialog(_Var2, _, _, _, _)
THEN
NOT DB_GLO_Jergal_PlayAttackADAfterDialog(_Var2);

QRY
QRY_DialogAttackRequested_CustomResponse(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, _, _, _)
AND
DB_DialogNPCs(_Var2, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, _, _)
AND NOT
DB_GLO_Jergal_BlockAttackedADDuringResurrection(1, _, _, _, _)
THEN
DB_GLO_Jergal_PlayAttackADAfterDialog(_Var2);

IF
DialogEnded(_, (INTEGER)_Var2, _, _, _)
AND
DB_GLO_Jergal_PlayAttackADAfterDialog(_Var2, _, _, _, _)
THEN
NOT DB_GLO_Jergal_PlayAttackADAfterDialog(_Var2);
PROC_TryStartAD(GLO_Jergal_AD_AttackFromDialog_851c058a-3223-3930-05aa-8558a0e36b04, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);

PROC
PROC_GLO_Jergal_RemoveAttackedFlagTimer((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
ObjectTimerCancel(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "GLO_Jergal_RemovedAttackedTag");
ObjectTimerLaunch(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "GLO_Jergal_RemovedAttackedTag", _Var1);

IF
ObjectTimerFinished(_, "GLO_Jergal_RemovedAttackedTag", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearFlag(CHA_Jergal_Event_AttemptedAttack_c2fc2844-dfe7-4eb2-6ab6-301eea35fe4e, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);

PROC
PROC_GLO_Jergal_SetDialog((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND NOT
QRY_GLO_Jergal_BlockSettingDialog()
THEN
PROC_RemoveDialog(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
DB_Dialogs(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Var1);

QRY
QRY_GLO_Jergal_BlockSettingDialog()
AND
0 == 1
THEN
DB_NOOP(1);

PROC
PROC_GlobalFlagReactionAfterDialog(GLO_Jergal_Event_JergalGoesToCamp_aab18775-d628-42ea-914b-e72b45ee9509, _, _, _, _)
THEN
PROC_DisappearOutOfSight(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "Walk", 0, "GLO_Jergal_GoesToCamp");

IF
EntityEvent((GUIDSTRING)_Var1, "GLO_Jergal_GoesToCamp", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_InCamp(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_MoveToCamp();
PROC_ORI_SetupCamp(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 0);

PROC
PROC_GLO_Jergal_MoveToCamp()
THEN
DB_CHA_Crypt_JergalLeftTomb(1);
PROC_Poof(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
PROC_DismissToCamp(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
DB_PartOfTheTeam(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
ClearFlag(GLO_Jergal_State_OutOfTomb_55294438-06e2-467c-9873-757f74d20645, NULL_00000000-0000-0000-0000-000000000000);
ClearFlag(GLO_Jergal_Event_JergalGoesToCamp_aab18775-d628-42ea-914b-e72b45ee9509, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(GLO_Jergal_State_JergalAtCamp_1d7473f8-8651-4077-935e-ecafd78c945a, NULL_00000000-0000-0000-0000-000000000000);

IF
EntityEvent(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "Origin_RestoreDialog", _, _, _)
THEN
PROC_Foop(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
SetTag(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, TRADER_91d5ebc6-91ea-44db-8a51-216860d69b5b);
PROC_GLO_Jergal_SetDialog(CAMP_Jergal_7f4acd9b-15c0-81fe-9409-623634ec3ed3);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(GLO_Jergal_State_JergalAtCamp_1d7473f8-8651-4077-935e-ecafd78c945a, _, _, _, _)
AND NOT
DB_OnlyOnce("GLO_Jergal_WaitForOneNight", _, _, _, _)
THEN
DB_OnlyOnce("GLO_Jergal_WaitForOneNight");
DB_OnlyOnce("GLO_Jergal_AppearAfterChasmDeath");
PROC_GLO_Jergal_Appear();

PROC
PROC_GLO_Jergal_Appear()
THEN
SetFlag(GLO_Jergal_State_JergalVisibleAtCamp_617fe345-b808-4e68-b970-14039e21bdcd, NULL_00000000-0000-0000-0000-000000000000);
SetOnStage(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 1);
SetVisible(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 1);
SetDetached(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 0);

PROC
PROC_GLO_Jergal_Disappear()
THEN
ClearFlag(GLO_Jergal_State_JergalVisibleAtCamp_617fe345-b808-4e68-b970-14039e21bdcd, NULL_00000000-0000-0000-0000-000000000000);
SetOnStage(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 0);
SetVisible(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 0);
SetDetached(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 1);

IF
DB_CurrentLevel(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_ForceToCampInLevel(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_ActiveCamp(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_InCamp(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_MoveToCamp();
PROC_GLO_Jergal_Appear();

IF
DB_InCamp(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_ForceToCampInLevel(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_Jergal_ForceToCampInLevel(_Var1);

IF
AttackedBy(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, (GUIDSTRING)_Var1, (GUIDSTRING)_Var2, _, _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_GetCharacterOwnerIfItemSummon(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_GetCharacterOwnerIfItemSummon(_Var7, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var7, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("GLO_Jergal_ReactsToAttack", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(GLO_Jergal_AD_AttackedByPlayer_7686b4ed-307e-6843-e9b8-2c4343bd071c, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
TimerLaunch("GLO_Jergal_BlockAD", 6000);

IF
TimerFinished("GLO_Jergal_BlockAD", _, _, _, _)
THEN
NOT DB_OnlyOnce("GLO_Jergal_ReactsToAttack");

PROC
PROC_LongRest()
AND NOT
DB_InCamp(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, _, _, _)
AND
DB_GlobalFlag(GLO_Jergal_State_JergalVisibleAtCamp_617fe345-b808-4e68-b970-14039e21bdcd, _, _, _, _)
THEN
PROC_DismissToCamp(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);
DB_PartOfTheTeam(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805);

IF
FlagCleared(CAMP_GLO_State_InCamp_161b7223-039d-4ebe-986f-1dcd9a66733f, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, (INTEGER)_, (INTEGER)_)
THEN
ClearFlag(GLO_Jergal_State_JergalVisibleAtCamp_617fe345-b808-4e68-b970-14039e21bdcd, NULL_00000000-0000-0000-0000-000000000000);
ClearFlag(GLO_Jergal_State_JergalAtCamp_1d7473f8-8651-4077-935e-ecafd78c945a, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(CAMP_Jergal_AskedAboutServices_0c357de7-be76-702d-36bc-e582ba10e4d8, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(CAMP_Jergal_State_ResurrectionServicesUnlocked_d115836f-1a9a-4361-841c-abc3f1c41021, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_GLO_Jergal_ResurrectionDialogues(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_SetResurrectionPrice(_Var2, _Var1);
DB_DialogMoneyTransfer(2, _Var1, 0);
DB_GlobalFlagReactionAfterDialog(CAMP_Jergal_Event_ResurrectPlayer_1_1aa10cc1-4399-4321-8196-8cb5e1c1a0db, _Var1);
DB_GlobalFlagReactionAfterDialog(CAMP_Jergal_Event_ResurrectPlayer_2_6ab66361-6787-4160-9346-4290336dbfd3, _Var1);
DB_GlobalFlagReactionAfterDialog(CAMP_Jergal_Event_ResurrectPlayer_3_a36160e6-98ec-4477-bd2c-dffc9d96b7c2, _Var1);
DB_GlobalFlagReactionAfterDialog(CAMP_Jergal_Event_ResurrectAllDead_bcae756b-bd2a-47d0-8ab8-95c5e43cba03, _Var1);

IF
DB_GLO_Jergal_CompanionResurrectionFlags(_, _, _Var3, _, _)
AND
DB_GLO_Jergal_ResurrectionDialogues(_Var4, _, _, _, _)
THEN
DB_GlobalFlagReactionAfterDialog(_Var3, _Var4);
DB_GlobalFlagReactionAfterDialog(_Var3, _Var4);

IF
DB_GLO_Jergal_HirelingResurrectionFlags(_, _, _Var3, _, _)
AND
DB_GLO_Jergal_ResurrectionDialogues(_Var4, _, _, _, _)
THEN
DB_GlobalFlagReactionAfterDialog(_Var3, _Var4);
DB_GlobalFlagReactionAfterDialog(_Var3, _Var4);

IF
DialogStarted((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Jergal_ResurrectionDialogues(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var2, _Var4, 1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_SaveReturnPosition(_Var4);

IF
DialogStarted((GUIDSTRING)_Var1, (INTEGER)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Jergal_ResurrectionDialogues(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var2, _Var4, 1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_SetPlayerResurrectingOthers(_Var4);

PROC
PROC_GLO_Jergal_SetPlayerResurrectingOthers((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Jergal_ResurrectedBy(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_Jergal_ResurrectedBy(_Var2);

PROC
PROC_GLO_Jergal_SetPlayerResurrectingOthers((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_Jergal_ResurrectedBy(_Var1);

PROC
PROC_GLO_Jergal_SetPlayerResurrectingOthers((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GLO_Jergal_ResurrectedBy(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetReservedUserID(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_Avatars(_Var4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GLO_Jergal_ResurrectedBy(_, _Var1, _Var1, _Var1, _Var1)
AND
GetReservedUserID(_Var4, _Var6, _Var1, _Var1, _Var1)
AND
_Var3 == _Var6
THEN
DB_GLO_Jergal_ResurrectedBy(_Var4);

PROC
PROC_GLO_Jergal_SetPlayerResurrectingOthers((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GLO_Jergal_ResurrectedBy(_, _Var1, _Var1, _Var1, _Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_GLO_Jergal_ResurrectedBy(_Var1);

PROC
PROC_GLO_Jergal_SaveReturnPosition((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Jergal_ReturnPosition(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
NOT DB_GLO_Jergal_ReturnPosition(_Var1, _Var2, _Var3, _Var4);

PROC
PROC_GLO_Jergal_SaveReturnPosition((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LeaveCamp_ReturnPos(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
DB_GLO_Jergal_ReturnPosition(_Var1, _Var2, _Var3, _Var4);

PROC
PROC_GLO_Jergal_SetResurrectionPrice((INTEGER)_Var1, (DIALOGRESOURCE)_Var2, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_DialogMoneyTransfer(1, _Var2, _Var3, _Var1, _Var1)
THEN
NOT DB_DialogMoneyTransfer(1, _Var2, _Var3);

PROC
PROC_GLO_Jergal_SetResurrectionPrice((INTEGER)_Var1, (DIALOGRESOURCE)_Var2, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
DB_DialogMoneyTransfer(1, _Var2, _Var1);

PROC
PROC_DialogFlagSetup((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Jergal_ResurrectionDialogues(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_SetDeadPlayers();
PROC_GLO_Jergal_SetDialogVariables(_Var1);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_GLO_Jergal_ResurrectionStringVariableAndFlags(_, _Var2, _Var3, _Var4, _Var5, _Var6, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(_Var2);
PROC_GlobalClearFlagAndCache(_Var3);
PROC_GlobalClearFlagAndCache(_Var4);
PROC_GlobalClearFlagAndCache(_Var5);
PROC_GlobalClearFlagAndCache(_Var6);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
THEN
PROC_GlobalClearFlagAndCache(CAMP_Jergal_State_PartyMemberDead_9e29c6e8-d087-4235-9930-43e104277e29);
PROC_GlobalClearFlagAndCache(CAMP_Jergal_State_CanResurrectCompanion_d7c06056-eadd-4d9d-96c7-72fe63fa6498);
PROC_GlobalClearFlagAndCache(CAMP_Jergal_State_MoreThanOnePCDead_a4df19dd-d25b-4ee7-8a4c-2cd408f1bea2);
PROC_GlobalClearFlagAndCache(CAMP_Jergal_Event_ResurrectAllDead_bcae756b-bd2a-47d0-8ab8-95c5e43cba03);
PROC_GlobalClearFlagAndCache(CAMP_Jergal_State_CanDismissAPlayer_2bc77ddd-2f03-45f1-b710-19062535227c);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_GLO_Jergal_CompanionResurrectionFlags(_, _Var2, _Var3, _, _)
THEN
PROC_GlobalClearFlagAndCache(_Var2);
PROC_GlobalClearFlagAndCache(_Var3);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_GLO_Jergal_HirelingResurrectionFlags(_, _Var2, _Var3, _, _)
THEN
PROC_GlobalClearFlagAndCache(_Var2);
PROC_GlobalClearFlagAndCache(_Var3);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_GLO_Jergal_DeadPlayers(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
NOT DB_GLO_Jergal_DeadPlayers(_Var1, _Var2, _Var3, _Var4);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var1, _Var2);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CAMP_Jergal_PlayersToResurrect(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_GLO_Jergal_BlockResurrection(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_ResurrectionStringVariableAndFlags(_Var2, _Var3, _Var4, _Var5, _, _Var7, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GLO_Jergal_DeadPlayers(_Var1, _, _, _, _Var1)
AND NOT
DB_GLO_Jergal_DeadPlayers(_, _Var2, _, _, _Var1)
THEN
DB_GLO_Jergal_DeadPlayers(_Var1, _Var2, _Var5, _Var7);
SetFlag(_Var4, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(_Var3, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(CAMP_Jergal_State_PartyMemberDead_9e29c6e8-d087-4235-9930-43e104277e29, NULL_00000000-0000-0000-0000-000000000000);

IF
DB_GLO_Jergal_DeadPlayers(_Var1, _Var2, _, _, _Var1)
AND
DB_GLO_Jergal_ResurrectionStringVariableAndFlags(_Var2, _, _, _, _Var8, _, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(_Var8, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(CAMP_Jergal_State_CanDismissAPlayer_2bc77ddd-2f03-45f1-b710-19062535227c, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_Origins(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartOfTheTeam(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CAMP_Jergal_PlayersToResurrect(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_GLO_Jergal_BlockResurrection(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_CompanionResurrectionFlags(_Var1, _Var2, _, _Var1, _Var1)
THEN
SetFlag(_Var2, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(CAMP_Jergal_State_CanResurrectCompanion_d7c06056-eadd-4d9d-96c7-72fe63fa6498, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GLO_Jergal_SetDeadPlayers()
AND
DB_Hirelings_CampPos(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_PartOfTheTeam(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CAMP_Jergal_PlayersToResurrect(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_GLO_Jergal_BlockResurrection(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags(_Var3, _Var4, _, _Var1, _Var1)
AND NOT
DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var3, _, _Var1, _Var1, _Var1)
THEN
SetFlag(_Var4, NULL_00000000-0000-0000-0000-000000000000);
SetFlag(CAMP_Jergal_State_CanResurrectCompanion_d7c06056-eadd-4d9d-96c7-72fe63fa6498, NULL_00000000-0000-0000-0000-000000000000);
DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var3, _Var1);

PROC
PROC_GLO_Jergal_SetDialogVariables((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
QRY_OnlyOnce_Reset("GLO_Jergal_ApplyDiscount", _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_DeadPlayers(_, _, _, _, _Var1)
AND
QRY_OnlyOnce("GLO_Jergal_ApplyDiscount", _Var1, _Var1, _Var1, _Var1)
AND
SysCount("DB_GLO_Jergal_DeadPlayers", 4, _Var6, _Var1, _Var1)
AND
_Var6 > 1
AND
DB_DialogMoneyTransfer(1, _Var1, _Var7, _Var1, _Var1)
AND
IntegerProduct(_Var6, _Var7, _Var8, _Var1, _Var1)
AND
DB_GLO_Jergal_ResurrectionDiscount(_Var9, _Var1, _Var1, _Var1, _Var1)
AND
IntegerSubtract(100, _Var9, _Var10, _Var1, _Var1)
AND
IntegerProduct(_Var10, _Var8, _Var11, _Var1, _Var1)
AND
IntegerDivide(_Var11, 100, _Var12, _Var1, _Var1)
AND
DB_DialogMoneyTransfer(2, _Var1, _Var13, _Var1, _Var1)
THEN
NOT DB_DialogMoneyTransfer(2, _Var1, _Var13);
SetFlag(CAMP_Jergal_State_MoreThanOnePCDead_a4df19dd-d25b-4ee7-8a4c-2cd408f1bea2, NULL_00000000-0000-0000-0000-000000000000);
DB_DialogMoneyTransfer(2, _Var1, _Var12);

PROC
PROC_GLO_Jergal_SetDialogVariables((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_DialogName(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_SetDialogGoldCheckAmount(_Var1, _Var2);

PROC
PROC_GLO_Jergal_SetDialogVariables((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GLO_Jergal_DeadPlayers(_Var2, _Var3, _, _, _Var1)
AND
GetDisplayName(_Var2, _Var6, _Var1, _Var1, _Var1)
THEN
DialogSetVariableTranslatedString(_Var1, _Var3, _Var6);

PROC
PROC_GLO_Jergal_SetDialogVariables((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
GetDisplayName(_Var3, _Var4, _Var1, _Var1, _Var1)
THEN
DialogSetVariableTranslatedString(_Var1, _Var2, _Var4);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_DeadPlayers(_, _, _Var1, _, _Var1)
THEN
PROC_GLO_Jergal_PreparePlayerResurrection(_Var1);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_CompanionResurrectionFlags(_, _, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_PreparePlayerResurrection(_Var1);

PROC
PROC_GlobalFlagReactionAfterDialog((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags(_, _, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_PreparePlayerResurrection(_Var1);

PROC
PROC_GLO_Jergal_PreparePlayerResurrection((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
THEN
DB_GLO_Jergal_BlockAttackedADDuringResurrection(1);
PROC_GLO_Jergal_PreparePlayerResurrection_Internal(_Var1);

PROC
PROC_GLO_Jergal_PreparePlayerResurrection((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND NOT
QRY_StartDialog(CAMP_Jergal_AD_PlayerResurrection_820a252c-013f-4531-7292-777db8e0c2fd, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_ResurrectPlayers();

PROC
PROC_GlobalFlagReactionAfterDialog(CAMP_Jergal_Event_ResurrectAllDead_bcae756b-bd2a-47d0-8ab8-95c5e43cba03, _, _, _, _)
THEN
DB_GLO_Jergal_BlockAttackedADDuringResurrection(1);
PROC_GLO_Jergal_PrepareAllPlayersResurrection();

PROC
PROC_GLO_Jergal_PrepareAllPlayersResurrection()
AND
DB_GLO_Jergal_DeadPlayers(_, _, _Var3, _, _)
THEN
PROC_GLO_Jergal_PreparePlayerResurrection_Internal(_Var3);

PROC
PROC_GLO_Jergal_PrepareAllPlayersResurrection()
AND NOT
QRY_StartDialog(CAMP_Jergal_AD_PlayerResurrection_820a252c-013f-4531-7292-777db8e0c2fd, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, _, _, _)
THEN
PROC_GLO_Jergal_ResurrectPlayers();

PROC
PROC_GLO_Jergal_PreparePlayerResurrection_Internal((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_DeadPlayers(_Var2, _, _Var1, _, _Var1)
THEN
PROC_GLO_Jergal_WillResurrect(_Var2);

PROC
PROC_GLO_Jergal_PreparePlayerResurrection_Internal((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags(_Var2, _, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var2, _Var4, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_WillResurrect(_Var4);

PROC
PROC_GLO_Jergal_PreparePlayerResurrection_Internal((FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_CompanionResurrectionFlags(_Var2, _, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_WillResurrect(_Var2);

PROC
PROC_GLO_Jergal_WillResurrect((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_CAMP_Jergal_PlayersToResurrect(_Var1);
DB_Camp_BlockCamperPosAdjustment(_Var1);

IF
AutomatedDialogStarted(CAMP_Jergal_AD_PlayerResurrection_820a252c-013f-4531-7292-777db8e0c2fd, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetHasDialog(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 0);

IF
FlagSet(GLO_Jergal_Event_ResurrectDeadPlayers_a4d65ce6-df15-6ce8-3aa4-ce7ba678b86a, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GLO_Jergal_ResurrectPlayers();

IF
AutomatedDialogEnded(CAMP_Jergal_AD_PlayerResurrection_820a252c-013f-4531-7292-777db8e0c2fd, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetHasDialog(S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, 1);

PROC
PROC_GLO_Jergal_ResurrectPlayers()
AND
DB_CAMP_Jergal_PlayersToResurrect(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GLO_Jergal_BlockResurrection(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_CAMP_Jergal_PlayersToResurrect(_Var1);

PROC
PROC_GLO_Jergal_ResurrectPlayers()
THEN
ClearFlag(GLO_Jergal_Event_ResurrectDeadPlayers_a4d65ce6-df15-6ce8-3aa4-ce7ba678b86a, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_GLO_Jergal_BlockAttackedADDuringResurrection(1);
PROC_GLO_Jergal_ResurrectPlayers_Recursive();

PROC
PROC_GLO_Jergal_ResurrectPlayers_Recursive()
AND
QRY_OnlyOnce_Reset("GLO_Jergal_ResurrectPlayer", _, _, _, _)
AND
DB_CAMP_Jergal_PlayersToResurrect(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("GLO_Jergal_ResurrectPlayer", _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_CAMP_Jergal_PlayersToResurrect(_Var1);
PROC_GLO_Jergal_ResurrectPlayer(_Var1);

PROC
PROC_GLO_Jergal_ResurrectPlayer((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_CAMP_Jergal_PlayersToResurrect(_, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_ResurrectPlayers_Recursive();

PROC
PROC_GLO_Jergal_ResurrectPlayer((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Dead(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_Teleport(_Var1, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "GLO_Jergal_ResurrectPlayer");

IF
EntityEvent((CHARACTER)_Var1, "GLO_Jergal_ResurrectPlayer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
Resurrect(_Var1);
RealtimeObjectTimerLaunch(_Var1, "GLO_Jergal_OverrideReturnPos", 100);
PROC_GLO_Jergal_ResurrectPlayers_Recursive();

IF
EntityEvent((CHARACTER)_Var1, "GLO_Jergal_ResurrectPlayer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Jergal_ResurrectedBy(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(GEN_MaxPlayerCountReached_823b5064-8aa4-c0b7-1b8c-657b46987ccd, NULL_00000000-0000-0000-0000-000000000000, 0, _Var1, _Var1)
THEN
PROC_GLO_Jergal_Recruit(_Var1, _Var2);

PROC
PROC_GLO_Jergal_Recruit((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Hirelings_Hired(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Hirelings_TakeFromCamp(_Var1, _Var2);

PROC
PROC_GLO_Jergal_Recruit((CHARACTER)_Var1, (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Origins(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_PartyMembers_Add(_Var1, _Var2);

IF
ObjectTimerFinished((CHARACTER)_Var1, "GLO_Jergal_OverrideReturnPos", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Camp_BlockCamperPosAdjustment(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_Camp_BlockCamperPosAdjustment(_Var1);

IF
ObjectTimerFinished((CHARACTER)_Var1, "GLO_Jergal_OverrideReturnPos", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LeaveCamp_ReturnPos(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
DB_GLO_Jergal_ReturnPosition(_Var5, _Var6, _Var7, _Var8, _Var1)
THEN
NOT DB_LeaveCamp_ReturnPos(_Var1, _Var2, _Var3, _Var4);
NOT DB_GLO_Jergal_ReturnPosition(_Var1, _Var6, _Var7, _Var8);
DB_LeaveCamp_ReturnPos(_Var1, _Var6, _Var7, _Var8);

QRY
QRY_GLO_Jergal_BlockResurrection((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsTagged(_Var1, BLOCK_RESURRECTION_22a75dbb-1588-407e-b559-5aa4e6d4e6a6, 1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet((FLAG)_Var1, _, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_CompanionResurrectionFlags(_, _Var5, _Var1, _Var1, _Var1)
THEN
ClearFlag(_Var5, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet((FLAG)_Var1, _, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags(_, _Var5, _Var1, _Var1, _Var1)
THEN
ClearFlag(_Var5, NULL_00000000-0000-0000-0000-000000000000);

IF
Resurrected((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_CAMP_Jergal_PlayersToResurrect(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_CancelResurrection(_Var1);

PROC
PROC_GLO_Jergal_CancelResurrection((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
NOT DB_CAMP_Jergal_PlayersToResurrect(_Var1);

PROC
PROC_GLO_Jergal_CancelResurrection((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Jergal_DeadPlayers(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
NOT DB_GLO_Jergal_DeadPlayers(_Var1, _Var2, _Var3, _Var4);

PROC
PROC_GLO_Jergal_CancelResurrection((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Jergal_CompanionResurrectionFlags(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
ClearFlag(_Var2, NULL_00000000-0000-0000-0000-000000000000);
ClearFlag(_Var3, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GLO_Jergal_CancelResurrection((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GLO_Jergal_HirelingResurrectionFlags(_Var2, _Var3, _Var4, _Var1, _Var1)
THEN
NOT DB_GLO_Jergal_HirelingResurrectionFlags_Dead(_Var2, _Var1);
ClearFlag(_Var3, NULL_00000000-0000-0000-0000-000000000000);
ClearFlag(_Var4, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet((FLAG)_Var1, _, _, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_GLO_Jergal_DeadPlayers(_Var4, _, _, _Var1, _Var1)
AND NOT
DB_Avatars(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_DismissCharacter(_Var4);

PROC
PROC_GLO_Jergal_DismissCharacter((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Hirelings_Hired(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_Camp_GetCamperPos(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_Camp_GetCamperPos(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_Teleport(_Var1, _Var2, "GLO_Jergal_CompanionDismissed");

PROC
PROC_GLO_Jergal_DismissCharacter((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Hirelings_Hired(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_Camp_GetCamperPos_Custom(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_Camp_GetCamperPos(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_Teleport(_Var1, _Var2, "GLO_Jergal_CompanionDismissed");

IF
EntityEvent((CHARACTER)_Var1, "GLO_Jergal_CompanionDismissed", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Hirelings_Hired(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Hirelings_SendToCampForStorage(_Var1);
PROC_GLO_Jergal_SetDeadPlayers();

IF
EntityEvent((CHARACTER)_Var1, "GLO_Jergal_CompanionDismissed", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Origins(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_PartyMembers_Remove(_Var1, 1);
PROC_GLO_Jergal_SetDeadPlayers();

IF
EntityEvent(_, "GLO_Jergal_CompanionDismissed", _, _, _)
AND
DB_GLO_Jergal_ResurrectionDialogues(_Var2, _, _, _, _)
AND
DB_DialogName(_Var2, _, _, _, _)
THEN
PROC_GLO_Jergal_SetDialogVariables(_Var2);

IF
FlagSet((GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_GLO_Jergal_HasMetFlags(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GLO_Jergal_HasMet_c8c4ec60-7a6a-4ab6-a6f8-3e6b75df1bc6, NULL_00000000-0000-0000-0000-000000000000);

IF
FlagSet(CAMP_Jergal_HasMet_fdba7b59-851a-3edb-fe0f-d6045c5f8dd3, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(CAMP_Jergal_HasMet_AtCamp_838852f9-c395-43d0-b90e-20c15cfd8b14, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GLO_Jergal_Teleport((CHARACTER)_Var1, (GUIDSTRING)_Var2, (STRING)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GLO_Jergal_TeleportTo(_Var1, _, _, _Var1, _Var1)
THEN
DB_GLO_Jergal_TeleportTo(_Var1, _Var2, _Var3);
ApplyStatus(_Var1, "GLO_JERGAL_RESURRECTION_START_VFX", 1, 1);
RealtimeObjectTimerLaunch(_Var1, "GLO_Jergal_TeleportReady", 800);

IF
ObjectTimerFinished((CHARACTER)_Var1, "GLO_Jergal_TeleportReady", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Jergal_TeleportTo(_Var1, _Var2, _Var3, _Var1, _Var1)
AND NOT
QRY_GLO_Jergal_TrySafeTeleportTo(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "GLO_JERGAL_RESURRECTION_START_VFX");
TeleportTo(_Var1, _Var2, _Var3, 0, 0, 1);

QRY
QRY_GLO_Jergal_TrySafeTeleportTo((CHARACTER)_Var1, (GUIDSTRING)_Var2, (STRING)_Var3, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GLO_Jergal_GetNearRandomPosition(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_GLO_Jergal_GetNearRandomPosition(_Var4, _Var5, _Var6, _Var1, _Var1)
THEN
TeleportToPosition(_Var1, _Var4, _Var5, _Var6, _Var3, 0, 0, 1);

QRY
QRY_GLO_Jergal_GetNearRandomPosition((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_QRYRTN_GLO_Jergal_GetNearRandomPosition(_Var3, _Var4, _Var5, _Var1, _Var1)
THEN
NOT DB_QRYRTN_GLO_Jergal_GetNearRandomPosition(_Var3, _Var4, _Var5);

QRY
QRY_GLO_Jergal_GetNearRandomPosition((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetPosition(_Var2, _Var3, _Var4, _Var5, _Var1)
AND
FindValidPosition(_Var3, _Var4, _Var5, 5, _Var1, 1, _Var6, _Var7, _Var8, _Var1)
THEN
DB_QRYRTN_GLO_Jergal_GetNearRandomPosition(_Var6, _Var7, _Var8);

IF
EntityEvent((CHARACTER)_Var1, (STRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GLO_Jergal_TeleportTo(_Var1, _Var3, _Var2, _Var1, _Var1)
THEN
NOT DB_GLO_Jergal_TeleportTo(_Var1, _Var3, _Var2);
ApplyStatus(_Var1, "GLO_JERGAL_RESURRECTION_END_VFX", 6, 1);
RealtimeObjectTimerLaunch(_Var1, "GLO_Jergal_StopTeleportVFX", 4250);

IF
ObjectTimerFinished((GUIDSTRING)_Var1, "GLO_Jergal_StopTeleportVFX", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
RemoveStatus(_Var1, "GLO_JERGAL_RESURRECTION_END_VFX");

IF
TextEvent("Jergal_TestTeleport", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GLO_Jergal_Teleport(_Var1, S_GLO_JergalAvatar_0133f2ad-e121-4590-b5f0-a79413919805, "Jergal_TestTeleport");


EXITSECTION
PROC_TriggerUnregisterForPlayers(S_GOB_JergalAppear_BackupZone_13961b54-9126-4dea-abe0-175e66afba66);
ENDEXITSECTION

ParentTargetEdge "ModWrapper_Gustav"
