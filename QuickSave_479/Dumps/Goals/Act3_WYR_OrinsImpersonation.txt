Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_WYR_OrinsImpersonation_WorldImpersonationTotal(2);
DB_WYR_OrinsImpersonation_WorldImpersonationList("Journalist", WYR_OrinsImpersonation_CanImpersonate_Journalist_b57ac526-9ab2-413b-bba1-99e3a09f530a, 30, S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42);
DB_WYR_OrinsImpersonation_WorldImpersonationList("Smith", WYR_OrinsImpersonation_CanImpersonate_Smith_4d5fc872-029e-4766-8034-2d68d7369f11, 40, S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);
DB_WYR_OrinsImpersonation_WorldImpersonationList("FlamingFist", WYR_OrinsImpersonation_CanImpersonate_FlamingFist_27422427-a983-409c-8b09-b1873f39d91b, 20, S_GLO_RefugeeCamp_FlamingFist_001_2e90c37b-78ca-4df5-9fdc-3a680e3fafc1);
DB_WYR_OrinsImpersonation_WorldImpersonationList("DyingAttacker", WYR_OrinsImpersonation_CanImpersonate_DyingAttacker_9fe49101-16bb-412e-8bbc-da6aeb33ba26, 10, S_GLO_SmugglersCave_DyingAttacker_b9ff6ee5-b7d1-4bed-af3b-eb6c39dcd169);
DB_WYR_OrinsImpersonation_WorldImpersonationList("Dryad", WYR_OrinsImpersonation_CanImpersonate_Dryad_4ea59eec-5124-4146-94ce-221e94ef2e1d, 50, S_WYR_Circus_LoveDryad_a8bce35d-17ee-46e3-8d56-1d0d29c4a01e);
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs("Journalist", WYR_OrinsImpersonation_OrinJournalist_9d68c24d-8d5e-06b8-b1eb-8458451e077a);
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs("Smith", WYR_OrinsImpersonation_SmithOrin_1ac3d821-7909-422b-46b3-d09975215f63);
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs("FlamingFist", WYR_OrinsImpersonation_OrinFlamingFist_cdca26dd-5b9d-93e6-f760-eb5b47062d2e);
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs("DyingAttacker", WYR_OrinsImpersonation_OrinDyingAttacker_939f417e-0f96-4dee-aa06-4c2d735e8fc0);
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs("Dryad", WYR_Circus_LoveDryad_d0c00951-4d09-d1a6-2ab3-6c6ba1932a25);
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos("Journalist", S_WYR_OrinsImpersonation_Journalist_PosTrigger_c5b9f53d-1b21-4636-978b-7525e01ff784);
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos("Smith", S_WYR_OrinsImpersonation_Smith_PosTrigger_a423e0b9-a35d-41e0-966c-e7a9c311bd81);
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos("FlamingFist", S_WYR_OrinsImpersonation_FlamingFist_PosTrigger_06aaec7a-fd57-403a-8b80-a6d100781bc2);
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos("DyingAttacker", S_WYR_OrinsImpersonation_DyingAttacker_PosTrigger_60bac7c3-a574-4336-9384-1281aacdef1c);
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos("Dryad", S_WYR_Circus_LoveDryadPos_fd253957-a697-4d64-a170-e9648c961036);
DB_WYR_OrinsImpersonation_WorldImpersonationDeathFlag("Journalist", WYR_OrinsImpersonation_State_Impersonated_Journalist_d71fcc28-0315-4825-bf3f-a563abbd25ed);
DB_WYR_OrinsImpersonation_WorldImpersonationDeathFlag("Smith", WYR_OrinsImpersonation_State_Impersonated_Smith_97b39a81-b28b-4228-b59d-18db921aef0a);
DB_WYR_OrinsImpersonation_WorldImpersonationDeathFlag("FlamingFist", WYR_OrinsImpersonation_State_Impersonated_FlamingFist_3c85edc1-106c-418b-a86d-afb025c0a50e);
DB_WYR_OrinsImpersonation_WorldImpersonationDeathFlag("DyingAttacker", WYR_OrinsImpersonation_State_Impersonated_DyingAttacker_4a410be2-27f3-45a3-8b2f-bdbf568930f6);
DB_WYR_OrinsImpersonation_WorldImpersonationDeathFlag("Dryad", WYR_OrinsImpersonation_State_Impersonated_Dryad_9c8a1a80-e51c-4bba-b028-f43dabc4bddc);
DB_WYR_OrinsImpersonation_WorldImpersonationHasMetFlag("Journalist", WYR_OrinsImpersonation_Hasmet_Journalist_1460a3c7-eb48-8a45-10c0-75d4842f969e);
DB_WYR_OrinsImpersonation_WorldImpersonationHasMetFlag("Smith", WYR_OrinsImpersonation_HasMet_OrinAsSmith_da78ec0a-5593-ad2b-ca15-5091efa95600);
DB_WYR_OrinsImpersonation_WorldImpersonationHasMetFlag("FlamingFist", NULL_00000000-0000-0000-0000-000000000000);
DB_WYR_OrinsImpersonation_WorldImpersonationHasMetFlag("DyingAttacker", WYR_SmugglersCave_DyingAttacker_Hasmet_f4931b5a-2694-709a-c6ab-2f5b83a0f0c4);
DB_WYR_OrinsImpersonation_WorldImpersonationHasMetFlag("Dryad", WYR_OrinsImpersonation_HasMet_OrinAsDryad_9d16c43f-4c34-fd74-a753-8f6936212e49);
DB_WYR_OrinsImpersonation_ApproachTriggers("Journalist", S_WYR_OrinsImpersonation_Journalist_ApproachTrigger_0d395694-7fa1-4cd9-a745-341fef8d5821);
DB_WYR_OrinsImpersonation_ApproachTriggers("Smith", S_WYR_OrinsImpersonation_Smith_ApproachTrigger_e220c2ce-abf4-4e32-99b0-f8fe23143104);
DB_WYR_OrinsImpersonation_ApproachTriggers("FlamingFist", S_WYR_OrinsImpersonation_FlamingFist_ApproachTrigger_a864c98a-07da-48a7-82ea-684d461ea5bc);
DB_WYR_OrinsImpersonation_ApproachTriggers("DyingAttacker", S_WYR_OrinsImpersonation_DyingAttacker_ApproachTrigger_b8f48597-6490-4775-a213-7c8522ab3d6e);
DB_WYR_OrinsImpersonation_ApproachTriggers("Dryad", S_WYR_OrinsImpersonation_Dryad_ApproachTrigger_d12f03c8-3dd1-40d9-96c5-fc6a662096a6);
DB_WYR_OrinsImpersonation_PostOrinDeathPos("Journalist", S_WYR_OrinsImpersonation_JournalistTemple_PostOrin_PosTrigger_204687ec-5630-41d9-856b-e8f1255e6e2f);
DB_WYR_OrinsImpersonation_PostOrinDeathPos("Smith", S_GLO_OrinsImpersonation_SmithTemple_PostOrin_PosTrigger_e54fb528-85ef-49f6-aef9-d74b401e058a);
DB_WYR_OrinsImpersonation_PostOrinDeathPos("FlamingFist", S_WYR_OrinsImpersonation_FlamingFistTemple_PostOrin_PosTrigger_b7269e30-1537-4284-86f6-a982291f73bc);
DB_WYR_OrinsImpersonation_PostOrinDeathPos("DyingAttacker", S_WYR_OrinsImpersonation_DyingAttackerTemple_PostOrin_PosTrigger_07dea2a6-bfe5-425f-b60d-99487099c9c8);
DB_WYR_OrinsImpersonation_PostOrinDeathPos("Dryad", S_WYR_OrinsImpersonation_Dryad_PostOrin_PosTrigger_3e58c5d3-5693-4874-8ecc-4767e4d73a5d);
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation("");
NOT DB_WYR_OrinsImpersonation_OrinCurrentImpersonation("");
DB_PermaDefeatedEvent(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, WYR_OrinsImpersonation_State_Smith_PermaDefeated_9d67753b-cd72-402a-85eb-fdb59dcdd198);
DB_GlobalFlagReactionAfterDialog(WYR_OrinsImpersonation_State_Smith_PeacefulResolution_b541bec5-fefb-480e-9891-313398dd32ff, WYR_OrinsImpersonation_Smith_1e493c0e-c863-e14f-c46b-d3e539af3445);
PROC_WYR_OrinsImpersonation_InitWorldImpersonations();
PROC_WYR_OrinsImpersonation_InitOrin();

KBSECTION
IF
LevelLoaded("BGO_Main_A", _, _, _, _)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_State_WorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9, _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_KillDirectorGortash_Knows_CampCompromised_62f279b8-9f36-4f4a-92d3-edc16cb4d760, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_SetupOrin();

IF
LevelLoaded("BGO_Main_A", _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_OrinsImpersonation_State_WorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9, _, _, _, _)
AND NOT
DB_GlobalFlag(GLO_Orin_State_PermaDefeated_c716e4d9-e6ed-445c-a710-ee4d91c67298, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_RemoveAllApproachTrigger();
PROC_WYR_OrinsImpersonation_ResetAllImpersonations();

IF
LevelLoaded("BGO_Main_A", _, _, _, _)
AND NOT
DB_GlobalFlag(WYR_OrinsImpersonation_State_WorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9, _, _, _, _)
AND
DB_GlobalFlag(GLO_Orin_State_PermaDefeated_c716e4d9-e6ed-445c-a710-ee4d91c67298, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_RemoveAllApproachTrigger();
PROC_WYR_OrinsImpersonation_ResetAllImpersonations();

PROC
PROC_LevelUnloading("BGO_Main_A", _, _, _, _)
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation("Dryad", _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_CircusClosed_ResetDryad();
RemoveTransforms(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

IF
DB_GlobalFlag(WYR_KillDirectorGortash_Knows_CampCompromised_62f279b8-9f36-4f4a-92d3-edc16cb4d760, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_State_WorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9);
PROC_WYR_OrinsImpersonation_DisableAllImpersonations();
PROC_WYR_OrinsImpersonation_OrinTeleportOut();

IF
DB_GlobalFlag(GLO_Gortash_State_PermaDefeated_74dd56ff-7e00-42a6-a0f3-0d122f364769, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_State_WorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9);
PROC_WYR_OrinsImpersonation_DisableAllImpersonations();
PROC_WYR_OrinsImpersonation_OrinTeleportOut();

PROC
PROC_WYR_OrinsImpersonation_InitWorldImpersonations()
AND
DB_WYR_OrinsImpersonation_WorldImpersonationTotal(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DeclareCounter("CurImpersonationsLeft");
PROC_IncreaseCounter("CurImpersonationsLeft", _Var1);
PROC_WYR_OrinsImpersonation_InitApproachTriggers();

PROC
PROC_WYR_OrinsImpersonation_InitWorldImpersonations()
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList(_Var1, _Var2, _, _, _Var1)
THEN
PROC_GlobalSetFlagAndCache(_Var2);
PROC_WYR_OrinsImpersonation_ResetImpersonated(_Var1);

PROC
PROC_WYR_OrinsImpersonation_InitApproachTriggers()
AND
DB_WYR_OrinsImpersonation_ApproachTriggers(_, _Var2, _, _, _)
THEN
PROC_TriggerRegisterForPlayers(_Var2);

IF
EnteredTrigger((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_ApproachTriggers(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var4, _, _, _, _Var1)
AND
_Var3 != _Var4
AND NOT
DB_CantTalk(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_WYR_OrinsImpersonation_NoOtherPlayersNearActiveImpersonation(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_SetNextImpersonation(_Var3);

QRY
QRY_WYR_OrinsImpersonation_NoOtherPlayersNearActiveImpersonation((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_WYR_OrinsImpersonation_ApproachTriggers(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var3, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_WYR_OrinsImpersonation_RemoveApproachTrigger((STRING)_Var1, (TRIGGER)_Var2, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
THEN
PROC_TriggerUnregisterForPlayers(_Var2);
NOT DB_WYR_OrinsImpersonation_ApproachTriggers(_Var1, _Var2);

PROC
PROC_WYR_OrinsImpersonation_RemoveAllApproachTrigger()
AND
DB_WYR_OrinsImpersonation_ApproachTriggers(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_RemoveApproachTrigger(_Var1, _Var2);

PROC
PROC_WYR_OrinsImpersonation_GetNextImpersonation()
AND
DB_GlobalCounter("CurImpersonationsLeft", _Var1, _Var1, _Var1, _Var1)
AND
_Var1 > 0
AND
QRY_WYR_OrinsImpersonation_GetBestImpersonation()
THEN
PROC_WYR_OrinsImpersonation_SetupNextImpersonation();

PROC
PROC_WYR_OrinsImpersonation_GetNextImpersonation()
AND
DB_GlobalCounter("CurImpersonationsLeft", _Var1, _Var1, _Var1, _Var1)
AND
_Var1 == 0
THEN
PROC_WYR_OrinsImpersonation_DisableAllImpersonations();

QRY
QRY_WYR_OrinsImpersonation_GetBestImpersonation()
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList(_Var1, _Var2, _Var3, _Var4, _Var1)
AND NOT
DB_WYR_OrinsImpersonation_ChosenImpersonation(_, _, _, _, _Var1)
AND
QRY_WYR_OrinsImmpersonation_CheckValidImpersonation(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var2, _Var3, _Var4);

QRY
QRY_WYR_OrinsImmpersonation_CheckValidImpersonation((STRING)_Var1, (GUIDSTRING)_Var2, (INTEGER)_Var3, (GUIDSTRING)_Var4, (STRING)_Var1)
AND
QRY_WYR_OrinsImmpersonation_CheckBasicReq(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_WYR_OrinsImmpersonation_CheckBasicReq((STRING)_Var1, (GUIDSTRING)_Var2, (INTEGER)_Var3, (GUIDSTRING)_Var4, (STRING)_Var1)
AND
DB_GlobalFlag(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_WYR_OrinsImpersonation_EndCurImpersonation()
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
DB_WYR_OrinsImpersonation_ApproachTriggers(_Var1, _Var5, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_FinaliseImpersonatedPostOrin(_Var1);
PROC_GlobalClearFlagAndCache(_Var2);
PROC_DecreaseCounter("CurImpersonationsLeft");
PROC_WYR_OrinsImpersonation_ClearDB_ChosenImpersonation();
PROC_WYR_OrinsImpersonation_RemoveApproachTrigger(_Var1, _Var5);

PROC
PROC_WYR_OrinsImpersonation_ResetCurImpersonation((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
PROC_WYR_OrinsImpersonation_ResetImpersonated(_Var1);

PROC
PROC_WYR_OrinsImpersonation_ResetAllImpersonations()
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList(_Var1, _, _, _, _Var1)
THEN
PROC_WYR_OrinsImpersonation_ResetImpersonated(_Var1);

PROC
PROC_WYR_OrinsImpersonation_ResetImpersonated((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList(_Var1, _Var2, _, _Var4, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos(_Var1, _Var5, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var4, _Var5, "", 0, 0, 0, 0, 0);
SetVisible(_Var4, 1);

PROC
PROC_WYR_OrinsImpersonation_ResetImpersonated("Smith", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList("Smith", _Var1, _, _Var3, _Var1)
AND NOT
DB_PermaDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_DialogBlockTradeButton(WYR_OrinsImpersonation_Smith_1e493c0e-c863-e14f-c46b-d3e539af3445);
DB_PreventKnockedOutPermaDefeated(_Var3);
DB_Dialogs(_Var3, WYR_OrinsImpersonation_Smith_1e493c0e-c863-e14f-c46b-d3e539af3445);
DB_WYR_OrinsImpersonation_Smith_IsReset(1);
PROC_WYR_OrinsImpersonation_KnockedOut_Remove(_Var3);

PROC
PROC_WYR_OrinsImpersonation_ResetImpersonated("Journalist", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList("Journalist", _Var1, _, _Var3, _Var1)
AND NOT
DB_PermaDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Dialogs(_Var3, WYR_OrinsImpersonation_Journalist_97599f1b-cd1a-ae55-dc42-43dd2766e031);
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Setup(_Var3);

PROC
PROC_WYR_OrinsImpersonation_ResetImpersonated("DyingAttacker", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList("DyingAttacker", _Var1, _, _Var3, _Var1)
AND NOT
DB_PermaDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(WYR_SmugglersCave_AD_DyingAttacker_3d085140-6c05-d317-851c-265eb03395f9, _Var3);
PROC_WYR_OrinsImpersonation_Remove_DyingEffect();

PROC
PROC_WYR_OrinsImpersonation_ResetImpersonated("FlamingFist", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList("FlamingFist", _Var1, _, _Var3, _Var1)
AND NOT
DB_PermaDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_Remove_FlamingFistFaction();
NOT DB_SceneAllowAllDisturbances("GEN_OrinsAbduction_Scene");
PROC_GEN_OrinsAbduction_Orin_RemoveAllItems();

PROC
PROC_WYR_OrinsImpersonation_FlamingFist_ResetAndDisable()
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation("FlamingFist", _Var1, _, _, _Var1)
AND
DB_WYR_OrinsImpersonation_ApproachTriggers("FlamingFist", _Var4, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_ResetImpersonated("FlamingFist");
PROC_GlobalClearFlagAndCache(_Var1);
PROC_WYR_OrinsImpersonation_RemoveApproachTrigger("FlamingFist", _Var4);
PROC_WYR_OrinsImpersonation_ClearDB_ChosenImpersonation();
PROC_Purge_CancelMovement(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_WYR_OrinsImpersonation_GetNextImpersonation();
PROC_WYR_OrinsImpersonation_OrinTeleportOut();

PROC
PROC_WYR_OrinsImpersonation_SetNextImpersonation((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var2, _Var3, _Var4, _Var5, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList(_Var1, _Var6, _Var7, _Var8, _Var1)
AND
_Var1 != _Var2
THEN
PROC_WYR_OrinsImpersonation_ResetCurImpersonation(_Var2);
PROC_WYR_OrinsImpersonation_ClearDB_ChosenImpersonation();
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var6, _Var7, _Var8);
PROC_WYR_OrinsImpersonation_SetupNextImpersonation();

PROC
PROC_WYR_OrinsImpersonation_SetupNextImpersonation()
AND
DB_GlobalCounter("CurImpersonationsLeft", _Var1, _Var1, _Var1, _Var1)
AND
_Var1 > 0
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var2, _Var3, _Var4, _Var5, _Var1)
THEN
PROC_WYR_OrinsImpersonation_OrinImpersonates(_Var2);

PROC
PROC_WYR_OrinsImpersonation_SetupNextImpersonation()
AND
DB_GlobalCounter("CurImpersonationsLeft", _Var1, _Var1, _Var1, _Var1)
AND
_Var1 == 0
THEN
PROC_WYR_OrinsImpersonation_DisableAllImpersonations();

PROC
PROC_WYR_OrinsImpersonation_DisableAllImpersonations()
THEN
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_State_InWorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9);
DB_GlobalCounter("CurImpersonationsLeft", 0);
PROC_WYR_OrinsImpersonation_RemoveAllApproachTrigger();

PROC
PROC_WYR_OrinsImpersonation_DisableAllImpersonations()
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _, _, _, _Var1)
THEN
PROC_WYR_OrinsImpersonation_ResetCurImpersonation(_Var1);
PROC_WYR_OrinsImpersonation_ClearDB_ChosenImpersonation();

PROC
PROC_WYR_OrinsImpersonation_EndImpersonationByAttack()
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationHasMetFlag(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_EndImpersonation(_Var1);
PROC_GlobalSetFlagAndCache(WYR_OrinsImpersonation_State_MetOrinOnce_5f82392a-6e8f-4c9b-a927-b9d77ee263ec);
PROC_GlobalSetFlagAndCache(_Var2);

PROC
PROC_WYR_OrinsImpersonation_FinaliseImpersonatedPostOrin((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
_Var1 != "Smith"
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _, _, _Var4, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationDeathFlag(_Var1, _Var5, _Var1, _Var1, _Var1)
THEN
SetVisible(_Var4, 1);
Die(_Var4, 0, 1);
PROC_GlobalSetFlagAndCache(_Var5);
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Stop(_Var4);
PROC_WYR_OrinsImpersonation_Remove_FlamingFistFaction();

PROC
PROC_WYR_OrinsImpersonation_FinaliseImpersonatedPostOrin("Smith", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationDeathFlag("Smith", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(_Var1);

PROC
PROC_LongRest()
AND
DB_GlobalFlag(WYR_OrinsImpersonation_State_Impersonated_Smith_97b39a81-b28b-4228-b59d-18db921aef0a, _, _, _, _)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList("Smith", _, _, _Var3, _)
AND NOT
DB_WYR_OrinsImpersonation_Smith_KilledByPlayer(_, _, _, _, _)
AND NOT
DB_PermaDefeated(_Var3, _, _, _, _)
AND
DB_WYR_OrinsImpersonation_PostOrinDeathPos("Smith", _Var5, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_Smith_PlaceOrinNote(_Var3);
PROC_WYR_OrinsImpersonation_Smith_PostOrinPAD_Enable();
PROC_WYR_OrinsImpersonation_SmithSpottingStopped();
TeleportTo(_Var3, _Var5, "", 0, 0, 0, 0, 0);
SetVisible(_Var3, 1);
Die(_Var3, 0, 1);

PROC
PROC_WYR_OrinsImpersonation_Smith_PlaceOrinNote((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
CreateSurface(_Var1, "SurfaceBlood", 1, -1);
TeleportTo(S_WYR_OrinsMessages_GyldroKilled_af28bfa4-374f-44d3-a1de-5c3bd9c2872e, _Var1, "", 0, 0, 0, 0, 0);

PROC
PROC_WYR_OrinsImpersonation_Smith_PostOrinPAD_Enable()
AND
DB_GlobalFlag(WYR_OrinsImpersonation_HasMet_Smith_1d8e504b-242b-4226-90fb-3a2c55a29f18, _, _, _, _)
THEN
PROC_TriggerRegisterForPlayers(S_WYR_OrinsImpersonation_PAD_Smith_BloodSpot_c33ec4ed-7efa-41c0-999a-69c41a0a0dec);

IF
EnteredTrigger((CHARACTER)_Var1, S_WYR_OrinsImpersonation_PAD_Smith_BloodSpot_c33ec4ed-7efa-41c0-999a-69c41a0a0dec, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("WYR_OrinsImpersonation_PAD_SmithDead", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(WYR_OrinsImpersonation_Knows_SmithGone_676658e5-4349-4d6e-b69a-796bd9d009b2);
PROC_TryStartAD(WYR_OrinsImpersonation_PAD_Smith_BloodSpot_49bb6d40-2ad1-4ce2-f89b-61ba69bc7234, _Var1);
PROC_TriggerUnregisterForPlayers(S_WYR_OrinsImpersonation_PAD_Smith_BloodSpot_c33ec4ed-7efa-41c0-999a-69c41a0a0dec);

IF
KilledBy(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, (CHARACTER)_Var1, _, (INTEGER)_Var3, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_WYR_OrinsImpersonation_Smith_KilledByPlayer(1);
PROC_GlobalSetFlagAndCache(WYR_OrinsImpersonation_Knows_SmithGone_676658e5-4349-4d6e-b69a-796bd9d009b2);

PROC
PROC_WYR_OrinsImpersonation_SetupImpersonated((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
_Var1 != "Smith"
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList(_Var1, _, _, _Var4, _Var1)
AND
DB_WYR_OrinsImpersonation_PostOrinDeathPos(_Var1, _Var5, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(_Var4, _Var5, "", 0, 0, 0, 0, 0);

PROC
PROC_WYR_OrinsImpersonation_SetupImpersonated("Smith", _, _, _, _)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList("Smith", _, _, _Var3, _)
AND NOT
DB_PermaDefeated(_Var3, _, _, _, _)
THEN
TeleportTo(_Var3, S_WYR_OrinsImpersonation_Smith_PostOrin_PosTrigger_00341b5c-bff4-4a69-9764-d809beb995a8, "", 0, 0, 0, 0, 0);
PROC_WYR_OrinsImpersonation_KnockedOut_Apply(_Var3);
SetVisible(_Var3, 0);

PROC
PROC_WYR_OrinsImpersonation_SetupImpersonated("DyingAttacker", _, _, _, _)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationList("DyingAttacker", _, _, _Var3, _)
AND NOT
DB_PermaDefeated(_Var3, _, _, _, _)
THEN
PROC_ForceStopDialog(_Var3);
PROC_RemoveAllDialogEntriesForSpeaker(_Var3);

PROC
PROC_WYR_OrinsImpersonation_KnockedOut_Apply((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_IgnoreMutingStatussesDialog(WYR_OrinsImpersonation_AD_SmithAwakens_56b37a8b-c3ff-76bc-3451-99f312dd4a0e);
ApplyStatus(_Var1, "WYR_ORINSIMPERSONATION_KNOCKEDOUT", -1);
PROC_SetHasDialogIfChar(_Var1, 1);
SetDetached(_Var1, 1);

PROC
PROC_WYR_OrinsImpersonation_KnockedOut_Remove((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
RemoveStatus(_Var1, "WYR_ORINSIMPERSONATION_KNOCKEDOUT");
NOT DB_IgnoreMutingStatussesDialog(WYR_OrinsImpersonation_AD_SmithAwakens_56b37a8b-c3ff-76bc-3451-99f312dd4a0e);
NOT DB_WYR_OrinsImpersonation_Behavior_Anvil_StopLoop(_Var1);
SetDetached(_Var1, 0);

IF
StatusRemoved(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, "WYR_ORINSIMPERSONATION_KNOCKEDOUT", _, _, _)
AND
DB_WYR_OrinsImpersonation_Smith_IsReset(1, _, _, _, _)
THEN
NOT DB_WYR_OrinsImpersonation_Smith_IsReset(1);
PROC_WYR_OrinsImpersonation_StandAndDrink_StartWorldBehavior(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

PROC
PROC_WYR_OrinsImpersonation_SmithAwakens()
AND NOT
DB_PermaDefeated(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _, _, _, _)
THEN
SetVisible(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, 1);
PROC_WYR_OrinsImpersonation_KnockedOut_Remove(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);
PROC_TryStartAD(WYR_OrinsImpersonation_AD_SmithAwakens_56b37a8b-c3ff-76bc-3451-99f312dd4a0e, S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);
TimerLaunch("WYR_OrinsImpersonation_Smith_Awakened", 1000);

IF
TimerFinished("WYR_OrinsImpersonation_Smith_Awakened", _, _, _, _)
THEN
PROC_CharacterMoveTo(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, S_WYR_OrinsImpersonation_Smith_PosTrigger_a423e0b9-a35d-41e0-966c-e7a9c311bd81, "Run", "WYR_OrinsImpersonation_SmithPos");

IF
AutomatedDialogEnded(WYR_OrinsImpersonation_AD_SmithAwakens_56b37a8b-c3ff-76bc-3451-99f312dd4a0e, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_SmithSpottingStarted();

PROC
PROC_WYR_OrinsImpersonation_SmithSpottingStarted()
AND NOT
DB_PermaDefeated(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _, _, _, _)
THEN
DB_WYR_OrinsImpersonation_SmithSpotting(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

PROC
PROC_WYR_OrinsImpersonation_SmithSpottingStopped()
THEN
PROC_SpotPlayers_StopSpotting(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, "WYR_OrinsImpersonation_SmithSpotting");
NOT DB_WYR_OrinsImpersonation_SmithSpotting(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

IF
DB_WYR_OrinsImpersonation_SmithSpotting(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SpotPlayers(_Var1, "WYR_OrinsImpersonation_SmithSpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_SpotPlayers_Spotted(_, "WYR_OrinsImpersonation_SmithSpotting", (GUIDSTRING)_Var2, (CHARACTER)_, (CHARACTER)_)
THEN
PROC_WYR_OrinsImpersonation_Smith_DecideWhoToAccuse(_Var2);
NOT DB_WYR_OrinsImpersonation_SmithSpotting(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

PROC
PROC_WYR_OrinsImpersonation_Smith_DecideWhoToAccuse((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_WYR_OrinsImpersonation_CharacterOrinSmithSpokeTo(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_Smith_StartDialog(_Var2);

PROC
PROC_WYR_OrinsImpersonation_Smith_DecideWhoToAccuse((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_WYR_OrinsImpersonation_Smith_AccuseDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_CharacterOrinSmithSpokeTo(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Sees(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _Var2, _Var1, _Var1, _Var1)
AND
QRY_GetClosestAvailableCharacterTo(_Var1, 1, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var3, _Var1, _Var4, 1, _Var1)
AND
_Var4 < 10
THEN
PROC_WYR_OrinsImpersonation_Smith_StartDialog(_Var3);

PROC
PROC_WYR_OrinsImpersonation_Smith_DecideWhoToAccuse((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_WYR_OrinsImpersonation_Smith_AccuseDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_Smith_StartDialog(_Var1);

PROC
PROC_WYR_OrinsImpersonation_Smith_StartDialog((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_StartDialog(WYR_OrinsImpersonation_Smith_1e493c0e-c863-e14f-c46b-d3e539af3445, S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _Var1, _Var1, _Var1)
THEN
DB_WYR_OrinsImpersonation_Smith_AccuseDialogStarted(1);

IF
DialogEnded(WYR_OrinsImpersonation_Smith_1e493c0e-c863-e14f-c46b-d3e539af3445, _, _, _, _)
AND NOT
DB_Is_InCombat(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_StandAndDrink_StartWorldBehavior(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

PROC
PROC_WYR_OrinsImpersonation_InitOrin()
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _, _, _, _)
THEN
SetVisible(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 1);

PROC
PROC_WYR_OrinsImpersonation_SetupOrin()
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _, _, _, _)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_State_InWorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_GetNextImpersonation();

PROC
PROC_WYR_OrinsImpersonation_OrinImpersonatesCommon((DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
THEN
SetVisible(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 1);
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
DB_PreventPermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_WYR_OrinsImpersonation_ClearDB_OrinCurrentImpersonation();
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_Event_TransformToOrin_a8f5b171-d755-4a32-b293-6996543f51fb);
SetImmortal(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 1);
DB_DialogBlockAttackButton(_Var1);
DB_SceneManager(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "GEN_OrinsAbduction_Scene");
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Stop(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_WYR_OrinsImpersonation_Anvil_ForceStopWorldBehavior(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

PROC
PROC_WYR_OrinsImpersonation_OrinImpersonates((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
_Var1 != "Dryad"
AND
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs(_Var1, _Var5, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos(_Var1, _Var6, _Var1, _Var1, _Var1)
AND
DB_GEN_OrinsAbduction_OrinTransformRule_Common(_Var7, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var4, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_SetupImpersonated(_Var1);
PROC_WYR_OrinsImpersonation_OrinImpersonatesCommon(_Var5);
DB_Dialogs(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, _Var5);
TeleportTo(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var6, "GEN_OrinsAbduction_OrinTeleported", 0, 0, 0, 0, 0);
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation(_Var1);
DB_GEN_OrinsAbduction_IsTransformed(1);
Transform(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var4, _Var7);

PROC
PROC_WYR_OrinsImpersonation_OrinImpersonates("DyingAttacker", _, _, _, _)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_CanImpersonate_DyingAttacker_9fe49101-16bb-412e-8bbc-da6aeb33ba26, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_SmugglersCave_DyingAttacker_b9ff6ee5-b7d1-4bed-af3b-eb6c39dcd169, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_Apply_DyingEffect();

PROC
PROC_WYR_OrinsImpersonation_OrinImpersonates("Dryad", (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1, (FLAG)_Var1)
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation("Dryad", _Var1, _Var2, _Var3, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs("Dryad", _Var4, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationHomePos("Dryad", _Var5, _Var1, _Var1, _Var1)
AND
DB_GEN_OrinsAbduction_OrinTransformRule_Common(_Var6, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_SetupImpersonated("Dryad");
PROC_WYR_OrinsImpersonation_OrinImpersonatesCommon(_Var4);
TeleportTo(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var5, "", 0, 0, 0, 0, 0);
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation("Dryad");
DB_GEN_OrinsAbduction_IsTransformed(1);
Transform(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var3, _Var6);

PROC
PROC_WYR_OrinsImpersonation_OrinImpersonates("FlamingFist", _, _, _, _)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_CanImpersonate_FlamingFist_27422427-a983-409c-8b09-b1873f39d91b, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_RefugeeCamp_FlamingFist_001_2e90c37b-78ca-4df5-9fdc-3a680e3fafc1, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_Apply_FlamingFistFaction();
DB_SceneAllowAllDisturbances("GEN_OrinsAbduction_Scene");
CopyCharacterEquipment(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, S_GLO_RefugeeCamp_FlamingFist_001_2e90c37b-78ca-4df5-9fdc-3a680e3fafc1);

PROC
PROC_WYR_OrinsImpersonation_OrinImpersonates("Journalist", _, _, _, _)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_CanImpersonate_Journalist_b57ac526-9ab2-413b-bba1-99e3a09f530a, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Setup(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Stop(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42);

PROC
PROC_WYR_OrinsImpersonation_OrinImpersonates("Smith", _, _, _, _)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_CanImpersonate_Smith_4d5fc872-029e-4766-8034-2d68d7369f11, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _, _, _, _)
THEN
DB_WYR_OrinsImpersonation_Behavior_Anvil_StopLoop(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);
NOT DB_WYR_OrinsImpersonation_Behavior_Anvil_StopLoop(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_WYR_OrinsImpersonation_Anvil_StartWorldBehavior(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Setup((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_SpotPlayers(_Var1, "WYR_OrinsImpersonation_OrinJournalistSpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var1)
THEN
PROC_SpotPlayers_RestartSpotting(_Var1, "WYR_OrinsImpersonation_OrinJournalistSpotting");
DB_SpotPlayers_SpotTrigger(_Var1, "WYR_OrinsImpersonation_OrinJournalistSpotting", S_WYR_OrinsImpersonation_Journalist_SpottingArea_41ccc43e-d13d-434b-a28d-ee59fc1c48e3);
DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var1);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Setup((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_SpotPlayers(_Var1, "WYR_OrinsImpersonation_OrinJournalistSpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var1)
THEN
DB_SpotPlayers(_Var1, "WYR_OrinsImpersonation_OrinJournalistSpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger(_Var1, "WYR_OrinsImpersonation_OrinJournalistSpotting", S_WYR_OrinsImpersonation_Journalist_SpottingArea_41ccc43e-d13d-434b-a28d-ee59fc1c48e3);
DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var1);

PROC
PROC_SpotPlayers_Spotted((GUIDSTRING)_Var1, "WYR_OrinsImpersonation_OrinJournalistSpotting", (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_OrinJournalist_PlayAnimationAD(_Var1, _Var2);
PROC_WYR_OrinsImpersonation_OrinJournalist_LoopTimer_Start(_Var1, _Var2);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Stop((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting("WYR_OrinsImpersonation_OrinJournalistSpotting");
NOT DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var1);
PROC_WYR_OrinsImpersonation_OrinJournalist_LoopTimer_Stop(_Var1);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_LoopTimer_Start((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
TimerLaunch("WYR_OrinsImpersonation_OrinJournalistTimer", 5000);
DB_WYR_OrinsImpersonation_OrinJournalist_LoopTimer(_Var1);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_LoopTimer_Stop((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
NOT DB_WYR_OrinsImpersonation_OrinJournalist_LoopTimer(_Var1);
TimerCancel("WYR_OrinsImpersonation_OrinJournalistTimer");

IF
TimerFinished("WYR_OrinsImpersonation_OrinJournalistTimer", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_WYR_OrinsImpersonation_OrinJournalist_LoopTimer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Sees(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_OrinJournalist_PlayAnimationAD(_Var1, _Var2);
PROC_WYR_OrinsImpersonation_OrinJournalist_LoopTimer_Start(_Var1, _Var2);

IF
TimerFinished("WYR_OrinsImpersonation_OrinJournalistTimer", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_WYR_OrinsImpersonation_OrinJournalist_LoopTimer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Sees(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_OrinJournalist_LoopTimer_Stop(_Var1);
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Setup(_Var1);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_PlayAnimationAD(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(WYR_OrinsImpersonation_Hasmet_Journalist_1460a3c7-eb48-8a45-10c0-75d4842f969e, _Var1, 0, _Var1, _Var1)
THEN
SteerTo(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42, _Var1, 0);
PlayAnimation(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42, CUST_Waving_01_8d682545-f220-4db9-b170-71b1c22c6f2f, "WYR_OrinsImpersonation_OrinJournalist_Waving");
PROC_TryStartAD(WYR_OrinsImpersonation_AD_Journalist_dd8ddce2-5bd8-5186-42f1-10ae29dd807e, S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_PlayAnimationAD(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetFlag(WYR_OrinsImpersonation_Hasmet_Journalist_1460a3c7-eb48-8a45-10c0-75d4842f969e, _Var1, 1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_OrinJournalist_LoopTimer_Stop(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42);

PROC
PROC_WYR_OrinsImpersonation_OrinJournalist_PlayAnimationAD(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
SteerTo(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, 0);
PlayAnimation(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, CUST_Waving_01_8d682545-f220-4db9-b170-71b1c22c6f2f, "WYR_OrinsImpersonation_OrinJournalist_Waving");
PROC_TryStartAD(WYR_OrinsImpersonation_AD_Journalist_dd8ddce2-5bd8-5186-42f1-10ae29dd807e, S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

QRY
QRY_SelectCustomDialog_AfterGenerics(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation("Dryad", _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_CanImpersonate_Dryad_4ea59eec-5124-4146-94ce-221e94ef2e1d, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SelectedDialog(WYR_Circus_LoveDryad_d0c00951-4d09-d1a6-2ab3-6c6ba1932a25, S_WYR_Circus_LoveDryad_a8bce35d-17ee-46e3-8d56-1d0d29c4a01e, _Var1);

PROC
PROC_StartDialog_AddExtraSpeakers(WYR_Circus_LoveDryad_d0c00951-4d09-d1a6-2ab3-6c6ba1932a25, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_State_InWorldImpersonationsEnabled_4f3afc61-a52f-44ec-8308-3f81a17854d9, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation("Dryad", _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_CanImpersonate_Dryad_4ea59eec-5124-4146-94ce-221e94ef2e1d, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActorAt(_Var1, S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 13);

PROC
PROC_WYR_OrinsImpersonation_Anvil_StartWorldBehavior((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_WYR_OrinsImpersonation_Behavior_Anvil_StopLoop(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
StartBehaviorDialog_Internal(BHVR_WRLD_DEN_WeaponSmith_Anvil_76b162f7-e424-4ac7-e028-4241b7ff1599, 1, _Var1, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, S_BHVR_WRLD_WYR_OrinsImpersonation_Anvil_SceneTrigger_001_2f93f84c-2fd9-4580-b1fc-087d2a04bc98, _Var4, _Var5, _Var1, _Var1)
THEN
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var1, _Var5);

PROC
PROC_WYR_OrinsImpersonation_Anvil_ForceStopWorldBehavior((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var1, _Var2);
PROC_StopDialogIfStarted(_Var1, BHVR_WRLD_DEN_WeaponSmith_Anvil_76b162f7-e424-4ac7-e028-4241b7ff1599, _Var2);
DB_WYR_OrinsImpersonation_Behavior_Anvil_StopLoop(_Var1);

PROC
PROC_WYR_OrinsImpersonation_Anvil_GracefulStopWorldBehavior((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var1, _Var2);
DialogRequestBehaviorGracefulStop(_Var2, 0);
DB_WYR_OrinsImpersonation_Behavior_Anvil_StopLoop(_Var1);

IF
AutomatedDialogStarted(BHVR_WRLD_DEN_WeaponSmith_Anvil_76b162f7-e424-4ac7-e028-4241b7ff1599, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
AutomatedDialogEnded(BHVR_WRLD_DEN_WeaponSmith_Anvil_76b162f7-e424-4ac7-e028-4241b7ff1599, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var2, _Var1);
PROC_WYR_OrinsImpersonation_Anvil_StartWorldBehavior(_Var2);

IF
AutomatedDialogRequestFailed(BHVR_WRLD_DEN_WeaponSmith_Anvil_76b162f7-e424-4ac7-e028-4241b7ff1599, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var2, _Var1);

IF
DialogStarted(WYR_OrinsImpersonation_SmithOrin_1ac3d821-7909-422b-46b3-d09975215f63, _, _, _, _)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(_Var2, _Var3, _, _, _)
THEN
DB_WYR_OrinsImpersonation_Behavior_Anvil_StopLoop(_Var2);

PROC
PROC_WYR_OrinsImpersonation_StandAndDrink_StartWorldBehavior((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_WYR_OrinsImpersonation_Behavior_StandAndDrink(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
AND
StartBehaviorDialog_Internal(BHVR_WRLD_GLO_StandAndDrink_a4065598-1ea2-8866-d23f-f765b5008273, 1, _Var1, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var4, _Var5, _Var1, _Var1)
THEN
DB_WYR_OrinsImpersonation_Behavior_StandAndDrink(_Var1, _Var5);

IF
AutomatedDialogEnded(BHVR_WRLD_GLO_StandAndDrink_a4065598-1ea2-8866-d23f-f765b5008273, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_StandAndDrink(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_OrinsImpersonation_Behavior_StandAndDrink(_Var2, _Var1);
PROC_WYR_OrinsImpersonation_Smith_UseAnvil();

PROC
PROC_WYR_OrinsImpersonation_Smith_UseAnvil()
AND NOT
DB_WYR_OrinsImpersonation_Behavior_WaitForAnvilUse(1, _, _, _, _)
THEN
DB_WYR_OrinsImpersonation_Behavior_WaitForAnvilUse(1);
TimerLaunch("WYR_OrinsImpersonation_Smith_UseAnvil_Timer", 2000);

IF
TimerFinished("WYR_OrinsImpersonation_Smith_UseAnvil_Timer", _, _, _, _)
AND
DB_WYR_OrinsImpersonation_Behavior_WaitForAnvilUse(1, _, _, _, _)
THEN
NOT DB_WYR_OrinsImpersonation_Behavior_WaitForAnvilUse(1);
PROC_WYR_OrinsImpersonation_Anvil_StartWorldBehavior(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

IF
DB_GlobalFlag(WYR_OrinsImpersonation_Event_TransformToOrin_a8f5b171-d755-4a32-b293-6996543f51fb, _, _, _, _)
THEN
PROC_GEN_OrinsAbduction_OrinTransformsBack();

IF
DB_GlobalFlag(WYR_OrinsImpersonation_Event_TransformToOrin_a8f5b171-d755-4a32-b293-6996543f51fb, _, _, _, _)
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation("DyingAttacker", _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_Remove_DyingEffect();

PROC
PROC_WYR_OrinsImpersonation_EndImpersonation(_, (STRING)_, (STRING)_, (STRING)_, (STRING)_)
THEN
PROC_SceneOver("GEN_OrinsAbduction_Scene");
PROC_RemoveAllDialogEntriesForSpeaker(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_WYR_OrinsImpersonation_PostImpersonation_TryStartPAD();
PROC_WYR_OrinsImpersonation_EndCurImpersonation();
PROC_WYR_OrinsImpersonation_OrinTeleportOut();
PROC_WYR_OrinsImpersonation_GetNextImpersonation();
SetEntityEvent(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "ClearCrimeReturn", 1);

PROC
PROC_WYR_OrinsImpersonation_EndImpersonation("Smith", _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_SmithAwakens();

PROC
PROC_WYR_OrinsImpersonation_PostImpersonation_TryStartPAD()
AND
GetClosestPlayer(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, _, _Var1, _Var1)
AND NOT
DB_WYR_OrinsImpersonation_PostImpersonation_Started(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_WYR_OrinsImpersonation_PostImpersonation_Started(1);
TimerLaunch("WYR_OrinsImpersonation_PAD_PostImpersonation", 1000);
DB_WYR_OrinsImpersonation_ClosetPlayerToOrinBeforeTeleport(_Var1);

IF
TimerFinished("WYR_OrinsImpersonation_PAD_PostImpersonation", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_WYR_OrinsImpersonation_ClosetPlayerToOrinBeforeTeleport(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(WYR_OrinsImpersonation_PAD_PostImpersonation_a5358359-4a97-594d-d5be-19aee288d815, _Var1);
NOT DB_WYR_OrinsImpersonation_ClosetPlayerToOrinBeforeTeleport(_Var1);

IF
AutomatedDialogEnded(WYR_OrinsImpersonation_PAD_PostImpersonation_a5358359-4a97-594d-d5be-19aee288d815, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
NOT DB_WYR_OrinsImpersonation_PostImpersonation_Started(1);

IF
DialogEnded((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_WorldImpersonationDialogs(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(WYR_OrinsImpersonation_Event_TransformToOrin_a8f5b171-d755-4a32-b293-6996543f51fb, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GEN_OrinsAbduction_OrinAttacker(_, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_WYR_OrinsImpersonation_EndImpersonation(_Var3);

IF
DialogEnded(WYR_OrinsImpersonation_SmithOrin_1ac3d821-7909-422b-46b3-d09975215f63, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_WYR_OrinsImpersonation_CharacterOrinSmithSpokeTo(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var3, 1, _Var1, _Var1)
THEN
DB_WYR_OrinsImpersonation_CharacterOrinSmithSpokeTo(_Var3);

PROC
PROC_WYR_OrinsImpersonation_OrinTeleportOut()
THEN
PROC_GEN_OrinsAbduction_PlayEffect_Teleport();
SetHitpointsPercentage(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 100);
NOT DB_PreventPermaDefeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
SetImmortal(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 0);
PROC_WYR_OrinsImpersonation_OrinJournalist_Spotting_Stop(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);
PROC_GEN_OrinsAbduction_ClearDB_OrinAttacker();

PROC
PROC_WYR_OrinsImpersonation_OrinTeleportOut()
AND
DB_GlobalCounter("CurImpersonationsLeft", _Var1, _Var1, _Var1, _Var1)
AND
_Var1 == 0
THEN
TeleportTo(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, S_WYR_OrinsImpersonation_Orin_Home_PosTrigger_bc069bd8-bd09-4581-b6bb-d7bb88f73ed2, "", 0, 0, 0, 0, 0);

IF
DB_GlobalFlag(WYR_Circus_State_Gone_151fd307-4cb8-44ba-8998-40e1d748b707, _, _, _, _)
THEN
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_Dryad_4ea59eec-5124-4146-94ce-221e94ef2e1d);
PROC_WYR_OrinsImpersonation_RemoveApproachTrigger("Dryad", S_WYR_OrinsImpersonation_Dryad_ApproachTrigger_d12f03c8-3dd1-40d9-96c5-fc6a662096a6);
PROC_WYR_OrinsImpersonation_CircusClosed_ResetDryad();

PROC
PROC_WYR_OrinsImpersonation_CircusClosed_ResetDryad()
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation("Dryad", _, _, _, _)
THEN
PROC_WYR_OrinsImpersonation_ResetCurImpersonation("Dryad");
PROC_WYR_OrinsImpersonation_ClearDB_ChosenImpersonation();
TeleportTo(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, S_WYR_OrinsImpersonation_Orin_Home_PosTrigger_bc069bd8-bd09-4581-b6bb-d7bb88f73ed2, "", 0, 0, 0, 0, 0);
SetEntityEvent(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "ClearCrimeReturn", 1);

PROC
PROC_WYR_OrinsImpersonation_Apply_DyingEffect()
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation("DyingAttacker", _, _, _, _)
THEN
PROC_SetHitpointsPercentage_BlockSelfHealing(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 1);
ApplyStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_ORINSIMPERSONATION_IMPALED_DYING", -1, 1);
ApplyStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_SMUGGLER_DYING", -1, 1);
DB_IgnoreMutingStatussesDialog(WYR_SmugglersCave_AD_DyingAttacker_3d085140-6c05-d317-851c-265eb03395f9);
PROC_TryStartAD(WYR_SmugglersCave_AD_DyingAttacker_3d085140-6c05-d317-851c-265eb03395f9, S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

PROC
PROC_WYR_OrinsImpersonation_Remove_DyingEffect()
AND
HasActiveStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_ORINSIMPERSONATION_IMPALED_DYING", 1, _, _)
THEN
SetHitpointsPercentage(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, 100);
RemoveStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_SMUGGLER_DYING");
RemoveStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_ORINSIMPERSONATION_IMPALED_DYING");
NOT DB_IgnoreMutingStatussesDialog(WYR_SmugglersCave_AD_DyingAttacker_3d085140-6c05-d317-851c-265eb03395f9);

PROC
PROC_WYR_OrinsImpersonation_Apply_FlamingFistFaction()
THEN
DB_NOOP(1);
ApplyStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_ORINSIMPERSONATION_ORIN_FLAMINGFIST_FACTION", -1, 1);

PROC
PROC_WYR_OrinsImpersonation_Remove_FlamingFistFaction()
AND
HasActiveStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_ORINSIMPERSONATION_ORIN_FLAMINGFIST_FACTION", 1, _, _)
THEN
RemoveStatus(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, "WYR_ORINSIMPERSONATION_ORIN_FLAMINGFIST_FACTION");

PROC
PROC_GlobalFlagReactionAfterDialog(WYR_OrinsImpersonation_State_Smith_PeacefulResolution_b541bec5-fefb-480e-9891-313398dd32ff, _, _, _, _)
THEN
PROC_PeacefulResolve(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

IF
DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
THEN
NOT DB_WYR_OrinsImpersonation_OrinJournalist_Spotting(_Var2);

PROC
PROC_WYR_OrinsImpersonation_ClearDB_OrinCurrentImpersonation()
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_WYR_OrinsImpersonation_OrinCurrentImpersonation(_Var1);

PROC
PROC_WYR_OrinsImpersonation_ClearDB_ChosenImpersonation()
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var2, _Var3, _Var4, _Var1)
THEN
NOT DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var2, _Var3, _Var4);

IF
TextEvent("OICheckTargetDB", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Check Target DB");
PROC_WYR_OrinsImpersonation_Check_OrinCurrentImpersonation();

PROC
PROC_WYR_OrinsImpersonation_Check_OrinCurrentImpersonation()
AND
DB_WYR_OrinsImpersonation_OrinCurrentImpersonation(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
Concatenate("OrinCurrentImpersonation: ", _Var1, _Var2, _Var1, _Var1)
AND
GetHostCharacter(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var3, _Var2);

IF
TextEvent("OICheckDefeatedDB", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Check Defeated DB");
PROC_WYR_OrinsImpersonation_CheckDefeatedDB();

PROC
PROC_WYR_OrinsImpersonation_CheckDefeatedDB()
AND
DB_Defeated(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _, _, _, _)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Orin was in DefeateDB");

IF
TextEvent("OICheckCampDB", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Check Camp DB");
PROC_WYR_OrinsImpersonation_CheckCampDB();

PROC
PROC_WYR_OrinsImpersonation_CheckCampDB()
AND
DB_InCamp(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GUIDToString(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetHostCharacter(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var3, _Var2);

IF
TextEvent("OICheckImpCounter", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OICheckImpCounter");
PROC_Debug_WYR_OrinsImpersonation_CheckImpCounter();

PROC
PROC_Debug_WYR_OrinsImpersonation_CheckImpCounter()
AND
DB_GlobalCounter("CurImpersonationsLeft", _Var1, _Var1, _Var1, _Var1)
AND
IntegerToString(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
Concatenate("Remaining Impersonations: ", _Var2, _Var3, _Var1, _Var1)
AND
GetHostCharacter(_Var4, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var4, _Var3);

IF
TextEvent("OICheckCurImpersonation", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OICheckCurImpersonation");
PROC_Debug_WYR_OrinsImpersonation_CheckCurImpersonation();

PROC
PROC_Debug_WYR_OrinsImpersonation_CheckCurImpersonation()
AND
DB_WYR_OrinsImpersonation_ChosenImpersonation(_Var1, _Var2, _Var3, _Var4, _Var1)
AND
GetHostCharacter(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var5, _Var1);

IF
TextEvent("OIForceNextImpersonation", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIForceNextImpersonation");
PROC_WYR_OrinsImpersonation_EndCurImpersonation();
PROC_WYR_OrinsImpersonation_GetNextImpersonation();
PROC_Debug_WYR_OrinsImpersonation_CheckCurImpersonation();

IF
TextEvent("OIForceImpersonateSmith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIForceImpersonateSmith");
PROC_WYR_OrinsImpersonation_SetNextImpersonation("Smith");

IF
TextEvent("OIForceImpersonateJournalist", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIForceImpersonateJournalist");
PROC_WYR_OrinsImpersonation_SetNextImpersonation("Journalist");

IF
TextEvent("OIForceImpersonateFlamingFist", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIForceImpersonateFlamingFist");
PROC_WYR_OrinsImpersonation_SetNextImpersonation("FlamingFist");

IF
TextEvent("OIForceImpersonateDyingAttacker", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIForceImpersonateDyingAttacker");
PROC_WYR_OrinsImpersonation_SetNextImpersonation("DyingAttacker");

IF
TextEvent("OIForceImpersonateDryad", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIForceImpersonateDryad");
PROC_WYR_OrinsImpersonation_SetNextImpersonation("Dryad");

IF
TextEvent("OIGivePlayerRing", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIGivePlayerRing");
ToInventory(S_GLO_Orin_TeleportRing_b9ed80b2-cedd-4008-a0d9-7ccf016a7bbf, _Var1);

IF
TextEvent("OISetMaxImpersonation", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OISetMaxImpersonation");
PROC_DeclareCounter("CurImpersonationsLeft");
PROC_IncreaseCounter("CurImpersonationsLeft", 5);
PROC_Debug_WYR_OrinsImpersonation_CheckImpCounter();

IF
TextEvent("OIDisableImpersonations", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIDisableImpersonations");
PROC_WYR_OrinsImpersonation_DisableAllImpersonations();
PROC_WYR_OrinsImpersonation_OrinTeleportOut();

IF
TextEvent("OISetSeenGnomes", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OISetSeenGnomes");
PROC_GlobalSetFlagAndCache(WYR_Ironhand_State_PlayerSawGnomes_d2378ff6-22b2-4f31-aa4e-947408de5cdc);

IF
TextEvent("OITeleportToSmith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OITeleportToSmith");
TeleportToPosition(_Var1, -8.895544, 49.03027, -53.9687);

IF
TextEvent("OIJournalistWrite", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIJournalistWrite");
PlayAnimation(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, CUST_Writing_01_98fe16cb-1bbe-4046-bede-5d2336962b63, "WYR_OrinsImpersonation_OrinJournalist_Waving");

IF
TextEvent("OIJournalistOrinWave", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIJournalistOrinWave");
PlayAnimation(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, CUST_Waving_01_8d682545-f220-4db9-b170-71b1c22c6f2f, "WYR_OrinsImpersonation_OrinJournalist_Waving");

IF
TextEvent("OIJournalistOrinAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIJournalistOrinAD");
PROC_TryStartAD(WYR_OrinsImpersonation_AD_Journalist_dd8ddce2-5bd8-5186-42f1-10ae29dd807e, S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

IF
TextEvent("OIJournalistWave", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIJournalistWave");
PlayAnimation(S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42, CUST_Waving_01_8d682545-f220-4db9-b170-71b1c22c6f2f, "WYR_OrinsImpersonation_OrinJournalist_Waving");

IF
TextEvent("OIJournalistAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIJournalistAD");
PROC_TryStartAD(WYR_OrinsImpersonation_AD_Journalist_dd8ddce2-5bd8-5186-42f1-10ae29dd807e, S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42);

IF
TextEvent("OIAddDialogSmith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIAddDialogSmith");
DB_Dialogs(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, WYR_OrinsImpersonation_Smith_1e493c0e-c863-e14f-c46b-d3e539af3445);

IF
TextEvent("OIStartSmith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartSmith");
PROC_Debug_WYR_OrinsImpersonation_Start_Smith();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_Smith()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_OrinsImpersonation_SmithOrin_1ac3d821-7909-422b-46b3-d09975215f63, S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIStartJournalist", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartJournalist");
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_Journalist_b57ac526-9ab2-413b-bba1-99e3a09f530a);
PROC_Debug_WYR_OrinsImpersonation_Start_Journalist();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_Journalist()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_OrinsImpersonation_Journalist_97599f1b-cd1a-ae55-dc42-43dd2766e031, S_GLO_OrinsImpersonation_Journalist_5b8fb80d-a374-4872-9a7b-ee5e4e25ed42, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIStartJournalistOrin", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartJournalistOrin");
PROC_GlobalSetFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_Journalist_b57ac526-9ab2-413b-bba1-99e3a09f530a);
PROC_Debug_WYR_OrinsImpersonation_Start_JournalistOrin();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_JournalistOrin()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_OrinsImpersonation_OrinJournalist_9d68c24d-8d5e-06b8-b1eb-8458451e077a, S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIStartFlamingFist", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartFlamingFist");
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_FlamingFist_27422427-a983-409c-8b09-b1873f39d91b);
PROC_Debug_WYR_OrinsImpersonation_Start_FlamingFist();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_FlamingFist()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_RefugeeCamp_FlamingFist_001_f21754e7-489b-4b50-899e-c98d3649e1df, S_GLO_RefugeeCamp_FlamingFist_001_2e90c37b-78ca-4df5-9fdc-3a680e3fafc1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIStartFlamingFistOrin", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartFlamingFistOrin");
PROC_GlobalSetFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_FlamingFist_27422427-a983-409c-8b09-b1873f39d91b);
PROC_Debug_WYR_OrinsImpersonation_Start_FlamingFistOrin();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_FlamingFistOrin()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_OrinsImpersonation_OrinFlamingFist_cdca26dd-5b9d-93e6-f760-eb5b47062d2e, S_GLO_RefugeeCamp_FlamingFist_001_2e90c37b-78ca-4df5-9fdc-3a680e3fafc1, S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIStartDyingAttacker", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartDyingAttacker");
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_DyingAttacker_9fe49101-16bb-412e-8bbc-da6aeb33ba26);
PROC_Debug_WYR_OrinsImpersonation_Start_DyingAttacker();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_DyingAttacker()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_RefugeeCamp_FlamingFist_001_f21754e7-489b-4b50-899e-c98d3649e1df, S_GLO_RefugeeCamp_FlamingFist_001_2e90c37b-78ca-4df5-9fdc-3a680e3fafc1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIStartDyingAttackerOrin", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartDyingAttackerOrin");
PROC_GlobalSetFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_DyingAttacker_9fe49101-16bb-412e-8bbc-da6aeb33ba26);
PROC_Debug_WYR_OrinsImpersonation_Start_DyingAttackerOrin();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_DyingAttackerOrin()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_OrinsImpersonation_OrinDyingAttacker_939f417e-0f96-4dee-aa06-4c2d735e8fc0, S_GLO_SmugglersCave_DyingAttacker_b9ff6ee5-b7d1-4bed-af3b-eb6c39dcd169, S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIApplyDyingStatus", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Apply Dying Status");
PROC_WYR_OrinsImpersonation_Apply_DyingEffect();

IF
TextEvent("OIRemoveDyingStatus", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Remove Dying Status");
PROC_WYR_OrinsImpersonation_Remove_DyingEffect();

IF
TextEvent("OIRemoveTransform", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "Remove Transform");
RemoveTransforms(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

IF
TextEvent("OIStartDryad", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartDryad");
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_CanImpersonate_Dryad_4ea59eec-5124-4146-94ce-221e94ef2e1d);
PROC_Debug_WYR_OrinsImpersonation_Start_Dryad();

PROC
PROC_Debug_WYR_OrinsImpersonation_Start_Dryad()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(WYR_Circus_LoveDryad_d0c00951-4d09-d1a6-2ab3-6c6ba1932a25, S_WYR_Circus_LoveDryad_a8bce35d-17ee-46e3-8d56-1d0d29c4a01e, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("OIStartDryadAD", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIStartDryadAD");
PROC_TryStartAD(WYR_Circus_AD_LoveDryad_0a121d28-d4e8-07bb-6a70-404c247e5d48, S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

IF
TextEvent("OIMetOrinOnce", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIMetOrinOnce");
PROC_GlobalSetFlagAndCache(WYR_OrinsImpersonation_State_MetOrinOnce_5f82392a-6e8f-4c9b-a927-b9d77ee263ec);

IF
TextEvent("OIMetOrinOnceReset", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIMetOrinOnceReset");
PROC_GlobalClearFlagAndCache(WYR_OrinsImpersonation_State_MetOrinOnce_5f82392a-6e8f-4c9b-a927-b9d77ee263ec);

IF
TextEvent("OIResetAndDisableFlamingFist", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIResetAndDisableFlamingFist");
PROC_WYR_OrinsImpersonation_FlamingFist_ResetAndDisable();

IF
TextEvent("OIMoveSmith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIMoveSmith");
PROC_CharacterMoveTo(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, S_WYR_OrinsImpersonation_Smith_PosTrigger_a423e0b9-a35d-41e0-966c-e7a9c311bd81, "Run", "WYR_OrinsImpersonation_SmithPos");

IF
TextEvent("OISmithStatusApply", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OISmithStatusApply");
PROC_WYR_OrinsImpersonation_KnockedOut_Apply(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

IF
TextEvent("OISmithStatusRemove", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OISmithStatusRemove");
PROC_WYR_OrinsImpersonation_KnockedOut_Remove(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

IF
TextEvent("OIWRLDBHVR_Drink_Smith_Start", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
StartBehaviorDialog_Internal(BHVR_WRLD_GLO_StandAndDrink_a4065598-1ea2-8866-d23f-f765b5008273, 1, S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var2, _Var3, _Var1, _Var1)
THEN
DebugText(_Var1, "OIWRLDBHVR_Drink_Smith_Start");

IF
TextEvent("OIWRLDBHVR_Anvil_Orin", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIWRLDBHVR_Anvil_Orin");
PROC_WYR_OrinsImpersonation_Anvil_StartWorldBehavior(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

IF
TextEvent("OIWRLDBHVR_Anvil_Smith", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OIWRLDBHVR_Anvil_Smith");
PROC_WYR_OrinsImpersonation_Anvil_StartWorldBehavior(S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef);

IF
TextEvent("OIWRLDBHVR_Anvil_Orin_GracefulStop", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, _Var1, _Var1, _Var1)
AND
GetHostCharacter(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var2, "OIWRLDBHVR_Anvil_Orin_GracefulStop");
DialogRequestBehaviorGracefulStop(_Var1, 0);

IF
TextEvent("OIWRLDBHVR_Anvil_Orin_ForceStop", (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_WYR_OrinsImpersonation_Behavior_Anvil(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101, _Var1, _Var1, _Var1, _Var1)
AND
GetHostCharacter(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var2, "OIWRLDBHVR_Anvil_Orin_ForceStop");
PROC_WYR_OrinsImpersonation_Anvil_ForceStopWorldBehavior(S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

IF
TextEvent("OISmithAD_Start", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OISmithAD_Start");
PROC_TryStartAD(WYR_OrinsImpersonation_AD_Smith_f2c23c85-62aa-c695-0f7f-019e0dbf8c0a, S_GLO_Orin_bf24e0ec-a3a6-4905-bd2d-45dc8edf8101);

IF
TextEvent("OISitOnGround", (SHAPESHIFTRULE)_Var1, (SHAPESHIFTRULE)_Var1, (SHAPESHIFTRULE)_Var1, (SHAPESHIFTRULE)_Var1)
AND
DB_GEN_OrinsAbduction_OrinTransformRule_Common(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetHostCharacter(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var2, "OISitOnGround");
TeleportTo(S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, _Var2, "", 0, 0, 0, 0, 0);
Transform(S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, S_GLO_OrinsImpersonation_Smith_2ac966aa-3372-419a-902a-8330925830ef, _Var1);
SitOnGround(S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662);

IF
TextEvent("OISitOnGroundStop", (SHAPESHIFTRULE)_Var1, (SHAPESHIFTRULE)_Var1, (SHAPESHIFTRULE)_Var1, (SHAPESHIFTRULE)_Var1)
AND
DB_GEN_OrinsAbduction_OrinTransformRule_Common(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetHostCharacter(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var2, "OISitOnGroundStop");
EndRepose(S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662);

IF
TextEvent("OIWRLDBHVR_SitOnGround_Start", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
StartBehaviorDialog_Internal(BHVR_WRLD_GLO_SitGroundDrink_HUM_M_6213924c-ba91-280d-be95-22a8e6a4b42f, 1, S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000, _Var2, _Var3, _Var1, _Var1)
THEN
DebugText(_Var1, "OIWRLDBHVR_SitOnGround_Start");

IF
TextEvent("OISitOnGround_Drink_Start", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(_Var1, "OISitOnGround_Drink_Start");
PlayAnimation(S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662, CUST_SittingGroundDrinking_01_Loop_717f3d36-b7dc-4cbc-b390-9fa5be580caa, "WYR_OrinsImpersonation_Debug_EndOfCustDrink");

IF
EntityEvent(_, "WYR_OrinsImpersonation_Debug_EndOfCustDrink", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SitOnGround(S_WYR_OrinsImpersonation_OrinDummy_10bcedcb-ea08-4af7-9946-297e4088e662);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3"
