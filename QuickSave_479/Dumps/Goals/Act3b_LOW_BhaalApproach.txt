Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_AmbushTrigger(S_LOW_Undercity_BhaalCultists_ChasmEntrance_AmbushTrigger_ad0013f4-a4cc-48b3-bb83-89c419b35bbf, S_LOW_Undercity_BhaalCultists_ChasmEntrance_AmbushPerceptionTrigger_14cdd695-2767-4a9c-bdd3-8d292c857c6e, Act3_Challenging_7bf230a0-b68a-4c79-a785-79b498d6c36b);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_ChasmEntrance_AmbushTrigger_ad0013f4-a4cc-48b3-bb83-89c419b35bbf, S_LOW_UndercityChasmEntrance_Cultist_000_295deabe-d83c-4b5b-8ea2-016fa719b547, 1);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_ChasmEntrance_AmbushTrigger_ad0013f4-a4cc-48b3-bb83-89c419b35bbf, S_LOW_UndercityChasmEntrance_Cultist_001_4a7e35c3-27b3-4b58-9ef4-6330b907c2a1, 1);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_ChasmEntrance_AmbushTrigger_ad0013f4-a4cc-48b3-bb83-89c419b35bbf, S_LOW_UndercityChasmEntrance_Cultist_002_b1426ca0-e120-4e26-a0d6-d03625e4b5c8, 1);
DB_AmbushTrigger(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, S_LOW_Undercity_BhaalCultists_Patrol1_AmbushPerceptionTrigger_1caac616-6808-4a19-84af-8f6d87485841, Act3_Challenging_7bf230a0-b68a-4c79-a785-79b498d6c36b);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, S_LOW_UndercityPatrol1_Cultist_000_0d291d3e-bf25-49ab-a15e-ed7a8b115a13, 1);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, S_LOW_UndercityPatrol1_Cultist_001_470999a2-58be-49cd-a50e-415b6e5a15fb, 1);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, S_LOW_UndercityPatrol1_Cultist_002_507919b5-2090-4a13-bcca-56e5a5f1c64b, 1);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, S_LOW_UndercityPatrol1_Cultist_003_da80e468-cadb-49da-934c-903ba912b7cf, 1);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, S_LOW_UndercityPatrol1_Cultist_Strangler_29ba6894-5a2b-4f81-b756-c5ebdafbbb74, 1);
DB_AmbushTrigger(S_LOW_Undercity_BhaalCultists_Patrol2_AmbushTrigger_5c2b12e7-69e5-4ce8-a264-6d1804f7b588, S_LOW_Undercity_BhaalCultists_Patrol2_AmbushPerceptionTrigger_ffbc2daf-b667-4d75-938d-e0074d63e02b, Act3_Challenging_7bf230a0-b68a-4c79-a785-79b498d6c36b);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_Patrol2_AmbushTrigger_5c2b12e7-69e5-4ce8-a264-6d1804f7b588, S_LOW_UndercityPatrol2_Cultist_001_ff5760cf-edab-482a-91bc-73e4e811eb57, 1);
DB_AmbushTrigger_Ambusher(S_LOW_Undercity_BhaalCultists_Patrol2_AmbushTrigger_5c2b12e7-69e5-4ce8-a264-6d1804f7b588, S_LOW_UndercityPatrol2_Cultist_002_0e27e169-ee1e-4e56-93ba-3b86feafd252, 1);
DB_AmbushTrigger(S_LOW_RangedCultistAmbushTrigger_2aba7da4-9fc6-4f82-b6d8-34f3eb151505, S_LOW_RangedCultistAmbushPerceptionTrigger_3fd0481f-f2c4-40f5-b7f7-20fe72892aff, Act3_Challenging_7bf230a0-b68a-4c79-a785-79b498d6c36b);
DB_AmbushTrigger_Ambusher(S_LOW_CultistAmbushTrigger_2aba7da4-9fc6-4f82-b6d8-34f3eb151505, S_LOW_RangedCultistAmbusher001_94ad0109-2c78-43f8-b7dd-0d056b742a23, 1);
DB_AmbushTrigger_Ambusher(S_LOW_CultistAmbushTrigger_2aba7da4-9fc6-4f82-b6d8-34f3eb151505, S_LOW_RangedCultistAmbusher002_61d478ae-72e6-44de-8bb1-0272c83fb85e, 1);
DB_AmbushTrigger_Ambusher(S_LOW_CultistAmbushTrigger_2aba7da4-9fc6-4f82-b6d8-34f3eb151505, S_LOW_RangedCultistAmbusher003_8d058eb7-2b2c-4504-9656-ec014b7b9872, 1);
DB_AmbushTrigger(S_LOW_GroundCultistAmbushTrigger_a7bd5032-39eb-4e76-a60d-fbe49435ad75, S_LOW_GroundCultistAmbushPerceptionTrigger_708ef65e-eee8-4bb1-8a43-34a7219cbd4d, Act3_Challenging_7bf230a0-b68a-4c79-a785-79b498d6c36b);
DB_AmbushTrigger_Ambusher(S_LOW_GroundCultistAmbushTrigger_a7bd5032-39eb-4e76-a60d-fbe49435ad75, S_LOW_GroundCultistAmbusher001_d81275b5-bff3-4799-8118-e7aa5df575b1, 1);
DB_AmbushTrigger_Ambusher(S_LOW_GroundCultistAmbushTrigger_a7bd5032-39eb-4e76-a60d-fbe49435ad75, S_LOW_GroundCultistAmbusher002_369cfca3-d282-4e73-ba40-670fb62f5fc5, 1);
DB_AmbushTrigger_Ambusher(S_LOW_GroundCultistAmbushTrigger_a7bd5032-39eb-4e76-a60d-fbe49435ad75, S_LOW_GroundCultistAmbusher003_7446d348-4741-42b4-a43b-1cbbfacacb6e, 1);
DB_AmbushTrigger_Ambusher(S_LOW_GroundCultistAmbushTrigger_a7bd5032-39eb-4e76-a60d-fbe49435ad75, S_LOW_GroundCultistAmbusher004_b6fcf8fd-fd3f-4cb5-a25e-d520762c56fc, 1);
DB_LOW_UndercityRuins_AmbushGroupTarget(S_LOW_GroundCultistAmbushTrigger_a7bd5032-39eb-4e76-a60d-fbe49435ad75, S_LOW_GroundCultistAmbusher001_d81275b5-bff3-4799-8118-e7aa5df575b1);
DB_LOW_UndercityRuins_AmbushGroupTarget(S_LOW_CultistAmbushTrigger_2aba7da4-9fc6-4f82-b6d8-34f3eb151505, S_LOW_RangedCultistAmbusher001_94ad0109-2c78-43f8-b7dd-0d056b742a23);
DB_LOW_UndercityRuins_AmbushGroupTarget(S_LOW_Undercity_BhaalCultists_Patrol2_AmbushTrigger_5c2b12e7-69e5-4ce8-a264-6d1804f7b588, S_LOW_UndercityPatrol2_Cultist_001_ff5760cf-edab-482a-91bc-73e4e811eb57);
DB_LOW_UndercityRuins_AmbushGroupTarget(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, S_LOW_UndercityPatrol1_Cultist_000_0d291d3e-bf25-49ab-a15e-ed7a8b115a13);
DB_LOW_UndercityRuins_AmbushGroupTarget(S_LOW_Undercity_BhaalCultists_ChasmEntrance_AmbushTrigger_ad0013f4-a4cc-48b3-bb83-89c419b35bbf, S_LOW_UndercityChasmEntrance_Cultist_000_295deabe-d83c-4b5b-8ea2-016fa719b547);
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityChasmEntrance_Cultist_000_295deabe-d83c-4b5b-8ea2-016fa719b547, "Entrance");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityChasmEntrance_Cultist_001_4a7e35c3-27b3-4b58-9ef4-6330b907c2a1, "Entrance");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityChasmEntrance_Cultist_002_b1426ca0-e120-4e26-a0d6-d03625e4b5c8, "Entrance");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityPatrol1_Cultist_000_0d291d3e-bf25-49ab-a15e-ed7a8b115a13, "Patrol1");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityPatrol1_Cultist_001_470999a2-58be-49cd-a50e-415b6e5a15fb, "Patrol1");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityPatrol1_Cultist_002_507919b5-2090-4a13-bcca-56e5a5f1c64b, "Patrol1");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityPatrol1_Cultist_003_da80e468-cadb-49da-934c-903ba912b7cf, "Patrol1");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityPatrol1_Cultist_Strangler_29ba6894-5a2b-4f81-b756-c5ebdafbbb74, "Strangler");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityPatrol2_Cultist_001_ff5760cf-edab-482a-91bc-73e4e811eb57, "Patrol2");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_UndercityPatrol2_Cultist_002_0e27e169-ee1e-4e56-93ba-3b86feafd252, "Patrol2");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_RangedCultistAmbusher001_94ad0109-2c78-43f8-b7dd-0d056b742a23, "Ranged");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_RangedCultistAmbusher002_61d478ae-72e6-44de-8bb1-0272c83fb85e, "Ranged");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_RangedCultistAmbusher003_8d058eb7-2b2c-4504-9656-ec014b7b9872, "Ranged");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_GroundCultistAmbusher001_d81275b5-bff3-4799-8118-e7aa5df575b1, "Ground");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_GroundCultistAmbusher002_369cfca3-d282-4e73-ba40-670fb62f5fc5, "Ground");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_GroundCultistAmbusher003_7446d348-4741-42b4-a43b-1cbbfacacb6e, "Ground");
DB_LOW_UndercityRuins_CultistAmbushCombatants(S_LOW_GroundCultistAmbusher004_b6fcf8fd-fd3f-4cb5-a25e-d520762c56fc, "Ground");
DB_LOW_UndercityRuins_AmbushTypes(S_LOW_GroundCultistAmbushTrigger_72f164aa-7848-47fb-b09d-6a4b93ed4080, "Ground");
DB_LOW_UndercityRuins_AmbushTypes(S_LOW_GroundCultistAmbushTrigger_72f164aa-7848-47fb-b09d-6a4b93ed4080, "Ground");
DB_LOW_UndercityRuins_AmbushTypes(S_LOW_RangedCultistAmbushTrigger_2aba7da4-9fc6-4f82-b6d8-34f3eb151505, "Ranged");
DB_LOW_UndercityRuins_AmbushTriggers(S_LOW_Undercity_BhaalCultists_ChasmEntrance_AmbushTrigger_ad0013f4-a4cc-48b3-bb83-89c419b35bbf, "Entrance", 30);
DB_LOW_UndercityRuins_AmbushTriggers(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, "Patrol1", 25);
DB_LOW_UndercityRuins_AmbushTriggers(S_LOW_Undercity_BhaalCultists_Patrol2_AmbushTrigger_5c2b12e7-69e5-4ce8-a264-6d1804f7b588, "Patrol2", 30);
DB_LOW_UndercityRuins_AmbushTriggers(S_LOW_CultistAmbushTrigger_2aba7da4-9fc6-4f82-b6d8-34f3eb151505, "Ranged", 20);
DB_LOW_UndercityRuins_AmbushTriggers(S_LOW_GroundCultistAmbushTrigger_a7bd5032-39eb-4e76-a60d-fbe49435ad75, "Ground", 20);
DB_LOW_UndercityRuins_AmbushTriggers(S_LOW_Undercity_BhaalCultists_Patrol1_AmbushTrigger_9301bb99-35b8-4dd3-8a90-ec769e40e1cb, "Strangler", 20);
DB_SpotPlayers(Humans_Male_Cultist_Bhaal_DeathsHead_000_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_IncludeSummons(Humans_Male_Cultist_Bhaal_DeathsHead_000_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");
DB_SpotPlayers_TargetIgnoreCantTalk(Humans_Male_Cultist_Bhaal_DeathsHead_000_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");
DB_SpotPlayers_IncludeWildshapedPlayers(Humans_Male_Cultist_Bhaal_DeathsHead_000_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");
DB_SpotPlayers_IncludeFollowers(Humans_Male_Cultist_Bhaal_DeathsHead_000_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");
DB_SpotPlayers_IgnoreCombat(Humans_Male_Cultist_Bhaal_DeathsHead_000_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");
PROC_TriggerRegisterForParty(S_LOW_Undercity_BhaalCultists_SniperTrigger_df116af6-46b0-46f2-b7e5-aae00aa22f6f);
PROC_TriggerRegisterForParty(S_LOW_Undercity_BhaalCultists_SniperProximityTrigger_77031f02-4e6b-458f-bbb0-1f5006a8e28d);
PROC_TriggerRegisterForParty(S_LOW_Undercity_BhaalCultists_ChasmEntrace_RejoinCombatTrigger_716433cf-874e-429e-9a64-9d65ff3adcfa);
PROC_TriggerRegisterForPlayers(S_LOW_BhaalVoiceStunRange_2ec6dcf0-4f65-436d-8cf4-5c676a48921e);
PROC_TriggerRegisterForPlayers(S_LOW_BhaalApproachPrepRoom_4871c302-99a8-4401-8392-63200dbb71b1);
DB_LOW_UndercityRuins_MeleeAmbushers(S_LOW_UndercityPatrol1_Cultist_Strangler_29ba6894-5a2b-4f81-b756-c5ebdafbbb74);
DB_LOW_UndercityRuins_MeleeAmbushers(S_LOW_GroundCultistAmbusher004_b6fcf8fd-fd3f-4cb5-a25e-d520762c56fc);
DB_LOW_UndercityRuins_MeleeAmbushers(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);
DB_LOW_UndercityRuins_MeleeAmbushers(S_LOW_GroundCultistAmbusher001_d81275b5-bff3-4799-8118-e7aa5df575b1);
DB_LOW_UndercityRuins_MeleeAmbushers(S_LOW_GroundCultistAmbusher002_369cfca3-d282-4e73-ba40-670fb62f5fc5);
DB_LOW_UndercityRuins_MeleeAmbushers(S_LOW_GroundCultistAmbusher003_7446d348-4741-42b4-a43b-1cbbfacacb6e);
DB_UndercityRuins_SafetyTrigger(S_LOW_BhaalVoiceStunRange_2ec6dcf0-4f65-436d-8cf4-5c676a48921e);
DB_UndercityRuins_SafetyTrigger(S_LOW_BhaalApproachPrepRoom_4871c302-99a8-4401-8392-63200dbb71b1);
PROC_TriggerRegisterForParty(S_LOW_Undercity_BhaalCultists_DropCombatTrigger_00_3cff792b-c147-41e6-b48d-5f8ce314403f);
PROC_TriggerRegisterForParty(S_LOW_Undercity_BhaalCultists_DropCombatTrigger_01_5e7cee3f-f1b6-4dfd-bab8-c1695ce2732b);
DB_UndercityRuins_DropCombatTrigger(S_LOW_Undercity_BhaalCultists_DropCombatTrigger_00_3cff792b-c147-41e6-b48d-5f8ce314403f);
DB_UndercityRuins_DropCombatTrigger(S_LOW_Undercity_BhaalCultists_DropCombatTrigger_01_5e7cee3f-f1b6-4dfd-bab8-c1695ce2732b);
DB_OneShot_VoiceBarkTrigger(S_LOW_BhaalTemple_OneShotVB_ScaryStairs_Trigger_ac4fb1a0-1deb-40f2-b091-8969af8cb8a8, LOW_BhaalTemple_VB_ScaryStairs_b33ff4dd-4da9-0953-e072-c40ae589b543);
DB_OneShot_VoiceBarkTrigger(S_LOW_BhaalTemple_OneShotVB_ScaryViconia_Trigger_285f2ea5-2c14-44c9-a957-1f53e7d3d457, LOW_BhaalTemple_VB_ScaryViconia_692b2d09-0acf-41a5-805c-9948ba039342);
DB_UndercityRuins_HangingBodies(S_LOW_UndercityRuins_HangingCorpse001_b52d358a-f3de-4898-918b-4477908f62b3);
DB_UndercityRuins_HangingBodies(S_LOW_UndercityRuins_HangingCorpse002_0e4b527f-4aa9-4fee-859d-51d7ae13ad12);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel008_d8dfa504-e30c-4717-9af6-471c5bc8fc72);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel010_acf9ad51-68b1-4695-9ce6-d506c4de7670);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel004_a8792d5f-2814-4588-abc8-069fc916d313);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel006_f226da83-e229-4b94-8e76-7d0b674b963c);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel002_714ffa7b-81f3-4637-b5e3-7a5a560135de);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel007_d345b213-e393-46f2-ade1-8084e8b0345b);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel005_6e24ff8f-875f-40c0-a43b-c7b7f2e52368);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel009_dbe51b4f-c46c-4ded-a9d2-6bb4e0a92f22);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel003_0fca4b4d-775d-46ff-97cc-539f07ecae0d);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_BhaalTemple_Lieutenant_d23da937-a6aa-4b91-8631-57314792fd9e);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_CultistSentinel001_2aa53835-a143-4435-9794-1ec6a949eed8);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_BhaalTemple_Doppelganger_002_22d5547f-d8e5-4ee6-b017-db937520bdd4);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_BhaalTemple_Doppelganger_001_7ba6f82f-2132-4139-9b99-4f4a1b305edf);
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(S_LOW_BhaalTemple_Doppelganger_000_5ff9ea60-f48b-4880-a06f-35cacc680e66);
DB_UndercityRuins_BhaalBraziers(S_LOW_BhaalApproach_BhaalBrazier_000_6b4b6460-74b0-4e78-8a8b-71531b0c0756, 1);
DB_UndercityRuins_BhaalBraziers(S_LOW_BhaalApproach_BhaalBrazier_001_e6d6c7fb-350a-4c5f-8e18-8b421044961a, 2);
DB_UndercityRuins_BhaalBraziers(S_LOW_BhaalApproach_BhaalBrazier_002_d735753d-3b32-480f-956f-530c58dff5c0, 3);
DB_UndercityRuins_BhaalBraziers(S_LOW_BhaalApproach_BhaalBrazier_003_6b45e9da-a69e-4118-a8ac-b921a13db36a, 4);
DB_UndercityRuins_BhaalBraziers(S_LOW_BhaalApproach_BhaalBrazier_004_45fcae73-6b0a-4a84-a979-187457aed370, 5);
DB_UndercityRuins_BhaalBraziers(S_LOW_BhaalApproach_BhaalBrazier_005_f095b186-6d57-4eae-9fbe-ecd9e7a15c67, 6);
DB_UndercityRuins_BhaalBraziers(S_LOW_BhaalApproach_BhaalBrazier_006_437c547d-cff1-45ce-bb65-b41761c9c2f1, 7);
DB_UndercityRuins_BhaalStatues(S_LOW_BhaalApproach_WhisperingStatue_000_e8ed6e9b-1bf8-4218-a5e0-8a1215d7e5da, 1);
DB_UndercityRuins_BhaalStatues(S_LOW_BhaalApproach_WhisperingStatue_001_7117bda8-2088-449f-a682-113757483063, 2);
DB_UndercityRuins_BhaalStatues(S_LOW_BhaalApproach_WhisperingStatue_002_17471548-b386-4098-bbdd-853c7d8d09ef, 3);
DB_UndercityRuins_BhaalStatues(S_LOW_BhaalApproach_WhisperingStatue_003_0bc86ee9-cae5-426c-9287-c96ccc43df45, 4);
DB_UndercityRuins_BhaalStatues(S_LOW_BhaalApproach_WhisperingStatue_004_aa0a8ffc-4ab3-4aae-8216-6d61f1619fdc, 5);
DB_UndercityRuins_BhaalStatues(S_LOW_BhaalApproach_WhisperingStatue_005_9887f2c2-c10d-4e7f-ad02-424f68ff5352, 6);
DB_UndercityRuins_BhaalStatues(S_LOW_BhaalApproach_WhisperingStatue_006_a8d1f95d-8058-42cf-b74b-172b4f6309c3, 7);
DB_UndercityRuins_BhaalHorrorTriggers(S_LOW_BhaalApproach_TriggerBox_000_f41d28f4-91b5-4e59-b72a-5aaf671880a4, 1);
DB_UndercityRuins_BhaalHorrorTriggers(S_LOW_BhaalApproach_TriggerBox_001_3c619322-8828-4095-a4c0-90c4714938bc, 2);
DB_UndercityRuins_BhaalHorrorTriggers(S_LOW_BhaalApproach_TriggerBox_002_09875c80-b606-4b99-bbf0-54a9e8a5bed8, 3);
DB_UndercityRuins_BhaalHorrorTriggers(S_LOW_BhaalApproach_TriggerBox_003_95af46b8-0d4c-4856-ab4e-d2c687c0093c, 4);
DB_UndercityRuins_BhaalHorrorTriggers(S_LOW_BhaalApproach_TriggerBox_004_0c49d2ed-3baf-4e61-837d-31e4d519adae, 5);
DB_UndercityRuins_BhaalHorrorTriggers(S_LOW_BhaalApproach_TriggerBox_005_99051adc-e886-41a4-9d82-63af1cb8fda3, 6);
DB_UndercityRuins_BhaalHorrorTriggers(S_LOW_BhaalApproach_TriggerBox_006_1f0a7254-2521-4558-be97-55f3740bbd84, 7);
DB_UndercityRuins_BhaalStatuesNormal(1);
ApplyStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "AMBUSHING", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "INVISIBLE", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
DB_CombatReact_AD_OnNextTurn(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, LOW_UndercityRuins_AD_Farslayer_e4ade190-0136-a72f-92bb-fed93ecc6301);

KBSECTION
IF
TextEvent("AmbushersLeave", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var1, 1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_Poof(_Var1);

IF
TextEvent("AmbushersComeBack", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_PermaDefeated(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, _Var1, _Var1, _Var1, _Var1)
AND
IsOnStage(_Var1, 0, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 1);

IF
EnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_UndercityRuins_AmbushGroupTarget(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_BhaalApproach_SniperJoining", _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, 0, _Var1, _Var1, _Var1)
THEN
PROC_LOW_BhaalApproach_SniperSetup(_Var3);

IF
EnteredCombat(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
HasActiveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "AMBUSHING", 1, _Var1, _Var1)
THEN
RemoveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "AMBUSHING");

IF
EnteredCombat(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
HasActiveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "INVISIBLE", 1, _Var1, _Var1)
THEN
RemoveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "INVISIBLE");

PROC
PROC_LOW_BhaalApproach_SniperSetup((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_LOW_UndercityRuins_AmbushGroupTarget(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetCombatGroupID(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
CombatGetGuidFor(_Var2, _Var4, _Var1, _Var1, _Var1)
AND
CombatGetInvolvedPartyMember(_Var4, 1, _Var5, _Var1, _Var1)
THEN
RemoveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "AMBUSHING");
RemoveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "INVISIBLE");
SetCombatGroupAndEnterCombat(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, _Var3, _Var2);

IF
DB_UndercityRuins_HideCultistsInCaseWeNeedThem(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
DB_UndercityRuins_BhaalBraziers(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
DB_UndercityRuins_BhaalHorrorTriggers(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_TriggerRegisterForPlayers(_Var1);

IF
UseFinished((CHARACTER)_Var1, S_LOW_BhaalApproach_StatueWhisperChanger_76209767-fc2c-468d-b2be-cfec11a5b1d3, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_UndercityRuins_BhaalStatuesNormal(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_UndercityRuins_StatuesChanging", _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(S_LOW_BhaalApproach_StatueWhisperChanger_76209767-fc2c-468d-b2be-cfec11a5b1d3, "Changing Statue Lines - Whispers Only");
PROC_LOW_BhaalApproach_StatueChanger("LOW_BhaalApproach_AlternateStatuesOff");

IF
UseFinished((CHARACTER)_Var1, S_LOW_BhaalApproach_StatueWhisperChanger_76209767-fc2c-468d-b2be-cfec11a5b1d3, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UndercityRuins_BhaalStatuesNormal(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_UndercityRuins_StatuesChanging", _Var1, _Var1, _Var1, _Var1)
THEN
DebugText(S_LOW_BhaalApproach_StatueWhisperChanger_76209767-fc2c-468d-b2be-cfec11a5b1d3, "Changing Statue Lines - Lines Then Whispers");
PROC_LOW_BhaalApproach_StatueChanger("LOW_BhaalApproach_AlternateStatuesOn");

IF
UseFinished((CHARACTER)_Var1, S_LOW_BhaalApproach_StatueWhisperChanger_76209767-fc2c-468d-b2be-cfec11a5b1d3, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce_Reset("LOW_UndercityRuins_StatuesChanging", _Var1, _Var1, _Var1, _Var1)
THEN
DB_Noop(1);

PROC
PROC_LOW_BhaalApproach_StatueChanger("LOW_BhaalApproach_AlternateStatuesOn", _, _, _, _)
THEN
NOT DB_UndercityRuins_BhaalStatuesNormal(1);

PROC
PROC_LOW_BhaalApproach_StatueChanger("LOW_BhaalApproach_AlternateStatuesOff", _, _, _, _)
THEN
DB_UndercityRuins_BhaalStatuesNormal(1);

IF
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_UndercityRuins_SafetyTrigger(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerRegisterForCharacter(_Var3, _Var1);

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_UndercityRuins_DropCombatTrigger(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_UndercityRuins_AmbushTriggers(_, _Var4, _Var5, _Var1, _Var1)
AND NOT
QRY_LOW_UndercityRuins_AreAmbushersInDropCombatDistance(_Var4, _Var5, _Var1, _Var1, _Var1)
THEN
PROC_UndercityRuins_AmbushersDropCombat(_Var4);

QRY
QRY_LOW_UndercityRuins_AreAmbushersInDropCombatDistance((STRING)_Var1, (INTEGER)_Var2, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_PartyMembers(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var4, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(_Var4, _Var3, _Var5, _Var1, _Var1)
AND
_Var5 < _Var2
THEN
DebugText(_Var3, _Var1);
DB_NOOP(1);

PROC
PROC_UndercityRuins_AmbushersDropCombat((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var2, 1, _Var1, _Var1, _Var1)
THEN
LeaveCombat(_Var2);

IF
KilledBy((CHARACTER)_Var1, _, _, _, (CHARACTER)_Var1)
AND
DB_LOW_UndercityRuins_MeleeAmbushers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_UndercityRuins_AmbushTriggers(_, _Var6, _Var7, _Var1, _Var1)
AND NOT
QRY_LOW_UndercityRuins_AreAmbushersInDropCombatDistance(_Var6, _Var7, _Var1, _Var1, _Var1)
THEN
PROC_UndercityRuins_AmbushersDropCombat(_Var6);

PROC
PROC_LaunchAmbush((TRIGGER)_Var1, (CHARACTER)_Var2, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_LOW_UndercityRuins_AmbushTypes(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var4, _Var3, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
EnterCombat(_Var4, _Var2);

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_Undercity_BhaalCultists_ChasmEntrace_RejoinCombatTrigger_716433cf-874e-429e-9a64-9d65ff3adcfa, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var3, _, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var5, "Entrance", _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var5, _Var2, _Var1, _Var1, _Var1)
THEN
EnterCombat(_Var5, _Var1);

IF
EnteredCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_UndercityRuins_AmbushGroupTarget(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_BhaalApproach_SniperJoining", _Var1, _Var1, _Var1, _Var1)
AND
IsInCombat(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, 0, _Var1, _Var1, _Var1)
THEN
PROC_LOW_BhaalApproach_SniperSetup(_Var3);

PROC
PROC_LOW_BhaalApproach_SniperSetup((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_LOW_UndercityRuins_AmbushGroupTarget(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
GetCombatGroupID(_Var2, _Var3, _Var1, _Var1, _Var1)
AND
CombatGetGuidFor(_Var2, _Var4, _Var1, _Var1, _Var1)
AND
CombatGetInvolvedPartyMember(_Var4, 1, _Var5, _Var1, _Var1)
THEN
RemoveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "AMBUSHING");
RemoveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "INVISIBLE");
SetCombatGroupAndEnterCombat(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, _Var3, _Var2);

IF
CastedSpell((GUIDSTRING)_Var1, "Shout_LOW_BhaalCultist_PowerWordKill_Ritual_Start", _, _, _)
THEN
PROC_LOW_UndercityRuins_UpdateSnipingStatus();
PROC_LOW_UndercityRuins_AddEntrancedStatusToAmbushers();
PROC_LOW_UndercityRuins_BlockExitDoor();

IF
StatusApplied((GUIDSTRING)_Var1, "LOW_BHAALCULTIST_SNIPING_TECHNICAL", _, _, (GUIDSTRING)_Var1)
THEN
PROC_LOW_UndercityRuins_UpdateSnipingStatus();

PROC
PROC_LOW_UndercityRuins_UpdateSnipingStatus()
AND
HasActiveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_SNIPING_AIMING", 1, _, _)
AND
GetStatusCurrentLifetime(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_SNIPING_AIMING", _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var2, LOW_Undercity_BhaalCultists_SniperTrigger_df116af6-46b0-46f2-b7e5-aae00aa22f6f, 1, _Var1, _Var1)
AND
HasActiveStatus(_Var2, "LOW_BHAALCULTIST_SNIPING_TARGET", 0, _Var1, _Var1)
THEN
ApplyStatus(_Var2, "LOW_BHAALCULTIST_SNIPING_TARGET", _Var1, 0, S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);

PROC
PROC_LOW_UndercityRuins_AddEntrancedStatusToAmbushers()
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "LOW_BHAALCULTIST_ENTRANCEDAMBUSHER", 0, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "LOW_BHAALCULTIST_ENTRANCEDAMBUSHER", -1, 0, S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);

PROC
PROC_LOW_UndercityRuins_BlockExitDoor()
AND
HasActiveStatus(DOOR_GEN_Metal_Single_A_000_9f0792eb-b139-4aff-b741-f195f5a97786, "LOW_BHAALCULTIST_BLOCKEDDOOR", 0, _, _)
THEN
ApplyStatus(DOOR_GEN_Metal_Single_A_000_9f0792eb-b139-4aff-b741-f195f5a97786, "LOW_BHAALCULTIST_BLOCKEDDOOR", 600, 0, S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);

IF
StatusRemoved((CHARACTER)_Var1, "LOW_BHAALCULTIST_SNIPING_AIMING", _, _, (CHARACTER)_Var1)
AND
QRY_LOW_UndercityRuins_PartyMemberIsInRitualSight()
THEN
UseSpell(_Var1, "Shout_LOW_BhaalCultist_PowerWordKill_Ritual", _Var1);

QRY
QRY_LOW_UndercityRuins_PartyMemberIsInRitualSight()
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "LOW_BHAALCULTIST_SNIPING_TARGET_TECHNICAL", 1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
EnteredTrigger((CHARACTER)_Var1, LOW_Undercity_BhaalCultists_SniperTrigger_df116af6-46b0-46f2-b7e5-aae00aa22f6f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
HasActiveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_SNIPING_AIMING", 1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "LOW_BHAALCULTIST_SNIPING_TARGET", 0, _Var1, _Var1)
AND
GetStatusCurrentLifetime(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_SNIPING_AIMING", _Var2, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "LOW_BHAALCULTIST_SNIPING_TARGET", _Var2, 0, S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);

IF
LeftTrigger((CHARACTER)_Var1, LOW_Undercity_BhaalCultists_SniperTrigger_df116af6-46b0-46f2-b7e5-aae00aa22f6f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
HasActiveStatus(_Var1, "LOW_BHAALCULTIST_SNIPING_TARGET", 1, _Var1, _Var1)
THEN
RemoveStatus(_Var1, "LOW_BHAALCULTIST_SNIPING_TARGET");

IF
EnteredTrigger((CHARACTER)_Var1, S_LOW_Undercity_BhaalCultists_SniperProximityTrigger_77031f02-4e6b-458f-bbb0-1f5006a8e28d, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
CanSee(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, _Var1, 1, _Var1, _Var1)
AND
HasActiveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_PLAYERINRANGE", 0, _Var1, _Var1)
THEN
ApplyStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_PLAYERINRANGE", -1, 0, S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);
PROC_SpotPlayers_StopSpotting(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");

IF
TurnStarted(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, _, _, _, _)
AND
HasActiveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_PLAYERINRANGE", 0, _, _)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsInTrigger(_Var1, S_LOW_Undercity_BhaalCultists_SniperTPPoint_c42223ce-9556-4de1-857b-8009ce94051d, 1, _Var1, _Var1)
AND
CanSee(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, _Var1, 1, _Var1, _Var1)
THEN
ApplyStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_PLAYERINRANGE", -1, 0, S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);
PROC_SpotPlayers_StopSpotting(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");

IF
AttackedBy(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, (GUIDSTRING)_Var1, (CHARACTER)_Var2, _, _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
HasActiveStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_PLAYERINRANGE", 0, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_BHAALCULTIST_PLAYERINRANGE", -1, 0, S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093);
PROC_SpotPlayers_StopSpotting(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, "LOW_UndercityRuins_SniperSpotting");

IF
CastSpell((CHARACTER)_Var1, "Shout_LOW_BhaalCultist_Teleport", _, _, _)
THEN
TeleportTo(_Var1, S_LOW_Undercity_BhaalCultists_SniperTPPoint_c42223ce-9556-4de1-857b-8009ce94051d);

IF
DB_GlobalFlag(GLO_Orin_State_PermaDefeated_c716e4d9-e6ed-445c-a710-ee4d91c67298, _, _, _, _)
THEN
PROC_LOW_UndercityRuins_TryToOffstage();

PROC
PROC_LOW_UndercityRuins_TryToOffstage()
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var1, 0, _Var1, _Var1, _Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "LOW_UndercityRuins_CultistReadyToLeave");

PROC
PROC_LOW_UndercityRuins_TryToOffstage()
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _, _Var1, _Var1, _Var1)
AND
IsInCombat(_Var1, 1, _Var1, _Var1, _Var1)
THEN
DB_LOW_BhaalApproach_CleanupCultistsAfterCombat(_Var1);

IF
DB_LOW_BhaalApproach_CleanupCultistsAfterCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "LOW_UndercityRuins_CultistReadyToLeave");

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_UndercityRuins_CultistReadyToLeave", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_Poof(_Var1);

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "LOW_UndercityRuins_CultistReadyToLeave", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_BhaalApproach_CleanupCultistsAfterCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Poof(_Var1);

IF
EntityEvent((GUIDSTRING)_Var1, "LOW_UndercityRuins_CultistLeft", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_BhaalApproach_CleanupCultistsAfterCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_BhaalApproach_CleanupCultistsAfterCombat(_Var1);

PROC
PROC_ReadyToMoveOn_Failed((CHARACTER)_Var1, "LOW_UndercityRuins_CultistReadyToLeave", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetOnStage(_Var1, 0);

IF
AttackedBy((GUIDSTRING)_Var1, _, _, _, _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_UndercityRuins_HangingBodies(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
CreateSurface(S_LOW_UndercityRuins_BloodTrigger_2275e72c-8e2e-4df3-b918-562ffe541ec0, "SurfaceBlood", 2, -1, _Var1);

IF
StatusApplied(S_LOW_UndercityRuins_BloodlessSkull_9aac2241-492c-4a6b-9b22-89a523089512, "INSURFACE", _, _, _)
AND
GetSurfaceGroundAt(S_LOW_UndercityRuins_BloodTrigger_2275e72c-8e2e-4df3-b918-562ffe541ec0, "SurfaceBlood", _, _, _)
THEN
PROC_PlayPerceptionRevealEffect(S_LOW_UndercityRuins_BloodlessSkull_9aac2241-492c-4a6b-9b22-89a523089512, "LOW_UndercityRuins_SkullBloodied");
TimerLaunch("LOW_UndercityRuins_BloodTimer", 3000);

IF
TimerFinished("LOW_UndercityRuins_BloodTimer", _, _, _, _)
AND
GetSurfaceGroundAt(S_LOW_UndercityRuins_BloodTrigger_2275e72c-8e2e-4df3-b918-562ffe541ec0, "SurfaceBlood", _, _, _)
THEN
RemoveSurfaceLayer(S_LOW_UndercityRuins_BloodTrigger_2275e72c-8e2e-4df3-b918-562ffe541ec0, "Ground", 3);
Transform(S_LOW_UndercityRuins_BloodiedSkull_beda28ca-e571-47ed-ab53-7e646d92c337, DEC_Dungeon_Skeleton_Skull_A_Bloody_A_568d8985-9dde-4338-ad40-58e515af7d4b, POLYMORPH_a0ddddc8-255f-4014-9f63-d7608eb1c2a0);
PROC_LOW_UndercityRuins_BhaalDoorOpens();

PROC
PROC_LOW_UndercityRuins_BhaalDoorOpens()
THEN
Unlock(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f);
Open(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f);

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_UndercityRuins_BhaalHorrorTriggers(_Var2, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_UndercityRuins_ActivateBraziers(_Var3);
PROC_UndercityRuins_ActivateStatues(_Var3);
NOT DB_UndercityRuins_BhaalHorrorTriggers(_Var2, _Var3);

PROC
PROC_UndercityRuins_ActivateBraziers((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_UndercityRuins_BhaalBraziers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_Foop(_Var2);
NOT DB_UndercityRuins_BhaalBraziers(_Var2, _Var1);

PROC
PROC_UndercityRuins_ActivateStatues((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_UndercityRuins_BhaalStatues(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_UndercityRuins_BhaalStatuesNormal(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_UndercityRuins_AD_WhisperingStatueBhaalChant_3f3c93a1-8d29-d873-5e67-2ba59e0b6a57, _Var2);
NOT DB_UndercityRuins_BhaalStatues(_Var2, _Var1);

PROC
PROC_UndercityRuins_ActivateStatues((INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_UndercityRuins_BhaalStatues(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_UndercityRuins_BhaalStatuesNormal(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_UndercityRuins_StatueADChecker(_Var2);
NOT DB_UndercityRuins_BhaalStatues(_Var2, _Var1);

PROC
PROC_LOW_UndercityRuins_StatueADChecker((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(LOW_UndercityRuins_Event_HeardStatue5_ae72345c-6311-4ced-8f3a-78a2cd8ade43, _Var1, 0, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_UndercityRuins_AD_WhisperingStatueBhaalChant_3f3c93a1-8d29-d873-5e67-2ba59e0b6a57, _Var1);

PROC
PROC_LOW_UndercityRuins_StatueADChecker((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(LOW_UndercityRuins_Event_HeardStatue5_ae72345c-6311-4ced-8f3a-78a2cd8ade43, _Var1, 1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_UndercityRuins_AD_WhisperingStatue_52e23b43-abd2-9905-4a1e-02fc60f8ec7b, _Var1);

IF
DualEntityEvent((CHARACTER)_Var1, S_LOW_UndercityRuins_BhaalBloodDoorBackup_c77fa54e-9c2c-4a50-9956-9b2eecb44dd2, "S_LOW_UndercityRuins_MoveBloodDoor", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsClosed(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f, 0, _Var1, _Var1, _Var1)
AND
IsClosing(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f, 0, _Var1, _Var1, _Var1)
THEN
Close(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f);

IF
DualEntityEvent((CHARACTER)_Var1, S_LOW_UndercityRuins_BhaalBloodDoorBackup_c77fa54e-9c2c-4a50-9956-9b2eecb44dd2, "S_LOW_UndercityRuins_MoveBloodDoor", (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
IsOpened(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f, 0, _Var1, _Var1, _Var1)
AND
IsOpening(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f, 0, _Var1, _Var1, _Var1)
THEN
Open(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f);

PROC
PROC_BlockUseOfItem((CHARACTER)_Var1, S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
IsLocked(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f, 1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_UndercityRuins_TalkingSkull_e3d3e639-01e6-330e-8b4b-c51ffec6e917, S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f, _Var1, _Var1, _Var1)
THEN
DB_CustomUseItemResponse(_Var1, S_LOW_KurwinCasket_a78b1000-38bf-49a9-9597-3311709deb55, 0);

IF
DB_GlobalFlag(LOW_UndercityRuins_State_BloodDoorOpened_dc7425db-e119-46d5-99ed-4285d2fa0e3f, _, _, _, _)
THEN
Open(S_LOW_UndercityRuins_BhaalBloodDoor_577c1fbe-d641-461a-b00e-784d5d24d27f);

IF
Died(S_LOW_UndercityRuins_Cultist_Sniper_876c18d6-fcf3-4934-abc1-c0939872c093, _, _, _, _)
THEN
PROC_LOW_UndercityRuins_TidyCombat();
PROC_LOW_UndercityRuins_TidyTriggers();

PROC
PROC_LOW_UndercityRuins_TidyCombat()
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
DB_LOW_UndercityRuins_AmbusherOffstageNextTurn(_Var1);

IF
TurnStarted((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_UndercityRuins_AmbusherOffstageNextTurn(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantMove(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetEntityEventReal(_Var1, "GLO_CombatWait", 5);
PROC_LOW_UndercityRuins_AmbusherOffstage(_Var1);

PROC
PROC_LOW_UndercityRuins_AmbusherOffstage((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
QRY_TemporarilyMuted(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_UndercityRuins_FirstAmbusherLeaving", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_UndercityRuins_AD_CombatOver_097c61e4-264e-a03f-05ab-bd28d344a511, _Var1);

PROC
PROC_LOW_UndercityRuins_AmbusherOffstage((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
RealtimeObjectTimerLaunch(_Var1, "LOW_UndercityRuins_AmbusherLeaving", 1500);
SetWeaponUnsheathed(_Var1, 0, 0);

IF
ObjectTimerFinished((CHARACTER)_Var1, "LOW_UndercityRuins_AmbusherLeaving", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_Poof(_Var1);

PROC
PROC_LOW_UndercityRuins_TidyCombat()
AND
DB_LOW_UndercityRuins_CultistAmbushCombatants(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_Poof(_Var1);

PROC
PROC_LOW_UndercityRuins_TidyTriggers()
AND
DB_LOW_UndercityRuins_AmbushTriggers(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
PROC_CancelAmbush(_Var1);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3b"
