Version 1
SubGoalCombiner SGC_AND

INITSECTION
PROC_SetOnStage(S_Graveyard_MayrinaHusbandTombstone_8f7478bb-9913-4f4f-bd92-8592d35f7caf, 0);
PROC_SetOnStage(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, 0);
PROC_SetOnStage(S_LOW_HagSurvivors_MayrinasNote_95c84ab5-1eed-4c0f-950a-89b8862d229c, 0);
DB_Dialogs(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, LOW_HagSurvivors_Kleidunn_b808f141-5299-a1da-2544-060f9a7a7e4a);
DB_Dialogs(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, LOW_HagSurvivors_Adrielle_b86566c4-3420-8842-a29e-19c0b72300dd);
DB_Dialogs(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, LOW_HagSurvivors_HagSpy_46f2decb-c31e-06ec-4c8c-3487f9a56a03);
DB_LOW_HagSurvivors(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0);
DB_LOW_HagSurvivors(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6);
DB_LOW_HagSurvivors(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f);
ApplyStatus(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HAGSPY_DISGUISE", -1);
DB_PermaDefeatedEvent(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c);
DB_GlobalFlagReactionAfterDialog(LOW_HagSurvivors_Event_HagSpy_DropDisguise_c60c37b3-852c-431c-8f82-0285551cdfd6, LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2);
DB_GlobalFlagReactionAfterDialog(LOW_HagSurvivors_Event_HagSpy_DropDisguise_c60c37b3-852c-431c-8f82-0285551cdfd6, LOW_HagSurvivors_HagSpy_46f2decb-c31e-06ec-4c8c-3487f9a56a03);
PROC_SetRelationMutual(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, ACT3_LOW_HagSurvivors_HagSpy_a18d972a-d3be-43fe-b13f-1f280b3f48aa, 100);
DB_GLO_DefeatCounter(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, "LOW_HagSurvivors_PermaDefeated");
DB_GLO_DefeatCounter(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, "LOW_HagSurvivors_PermaDefeated");
DB_GLO_DefeatCounter_AllPermaDefeatedGlobalFlag("LOW_HagSurvivors_PermaDefeated", LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233);
DB_GLO_DefeatCounter_IgnoreWaitForCombatEnd("LOW_HagSurvivors_PermaDefeated");
DB_LOW_HagSurvivors_Factions(ACT3_LOW_HagSurvivors_HagSpy_a18d972a-d3be-43fe-b13f-1f280b3f48aa);
DB_LOW_HagSurvivors_Factions(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54);
DB_LOW_ActI_HagSurvivors(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, S_LOW_HagSurvivors_SurrogateMotherSpot_6fc81c53-b113-4d70-b864-aa5e3aaec46d, LOW_HagSurvivors_SurrogateMother_SheepForm_0f9bbd49-0a64-e33f-3149-015a0a9f31e8);
DB_LOW_ActI_HagSurvivors(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, S_LOW_HagSurvivors_HydrangeaSpot_8309f144-86d3-485a-be57-3dc4d623c78d, LOW_HagSurvivors_MaskedVictim1_9174eeda-dcfd-cdbc-c650-1bee3a363d30);
DB_Inclusion_Object(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, LOW_HagSurvivors_Hag_MaskedVictim1_StartInclusion_ac29f6c1-9e02-441e-89e3-1f619af3f456, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_Object(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, LOW_HagSurvivors_Hagspawn_SurrogateMother_StartInclusion_7407cc4b-4cce-4f5d-8f55-73eeac89add1, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9, S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8, S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);
DB_GlobalFlagReactionAfterDialog(LOW_HagSurvivors_State_SurvivorsFightAlongsideHagSpy_d8d6dcb0-836d-4c68-b28f-6357db9956fe, LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9);
DB_DoNotRemoveKnockedOutCharacterOnLongRest(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);
DB_SpotPlayers(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_SurvivorsFirstMeeting_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, "LOW_SurvivorsFirstMeeting_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, "LOW_SurvivorsFirstMeeting_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_LOW_SurvivorsFirstMeeting_SceneInterrupts("Attacked");
DB_LOW_SurvivorsFirstMeeting_SceneInterrupts("EneteredCombat");
DB_LOW_JatloInstaDied_MandatorySpeakers(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6);
DB_LOW_JatloInstaDied_MandatorySpeakers(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0);
DB_DropMutingStatussesDialog(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9);
DB_DropMutingStatussesDialog(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8);
DB_DropMutingStatussesDialog(LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2);
DB_LOW_VoodooDollTeleportSpots(S_LOW_HagSurvivors_VoodooDollTeleportSpot_01_a67bd5d1-cc51-4ff1-ae9f-83b00b472097);
DB_LOW_VoodooDollTeleportSpots(S_LOW_HagSurvivors_VoodooDollTeleportSpot_02_9cd2b3ed-c109-4f69-9587-d1f112efefd4);
DB_LOW_VoodooDollTeleportSpots(S_LOW_HagSurvivors_VoodooDollTeleportSpot_03_9cce486d-3616-438d-83a0-2500be9c6f55);
DB_LOW_VoodooDollTeleportSpots(S_LOW_HagSurvivors_VoodooDollTeleportSpot_04_c535f6c0-fe53-4eb6-9edd-30aa296f7424);
DB_LOW_VoodooDollTeleportSpots(S_LOW_HagSurvivors_VoodooDollTeleportSpot_05_9e1d1a11-5a68-4ddd-9384-8eb307b1a696);
DB_LOW_VoodooDollTeleportSpots(S_LOW_HagSurvivors_VoodooDollTeleportSpot_06_111244b4-288a-4ed2-94d4-7df3d01bffc4);
DB_LOW_CurentVoodooDollTeleportSpot(S_LOW_HagSurvivors_VoodooDollTeleportSpot_01_a67bd5d1-cc51-4ff1-ae9f-83b00b472097);
PROC_LOW_SetVoodooDollPotentialDestinations();
PROC_LOW_VoodooDollToDefaultSpot();
DB_Inclusion_Object(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, LOW_HagSurvivors_Adrielle_StartInclusion_0054a6ab-cf77-4ba1-8081-3cd917fe1a18, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_Object(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, LOW_HagSurvivors_Kleidunn_StartInclusion_69d2ac07-3df8-4586-8285-ccdcb3783362, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_AD_DropsDisguise_HagSpy_61774322-1c4c-6bae-1da4-1c0533a969fb, S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_AD_DropsDisguise_HagSpy_61774322-1c4c-6bae-1da4-1c0533a969fb, S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_AD_DropsDisguise_HagSpy_61774322-1c4c-6bae-1da4-1c0533a969fb, S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2, S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2, S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2, S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8, S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8, S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_AD_SurvivorsSeeHagSpyInstaDie_c74861c8-d01a-7faf-92a5-b0326b9b0d15, S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_AD_SurvivorsSeeHagSpyInstaDie_c74861c8-d01a-7faf-92a5-b0326b9b0d15, S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);
DB_Inclusion_CombatInclusionDialog(LOW_HagSurvivors_AD_DropsDisguise_HagSpy_61774322-1c4c-6bae-1da4-1c0533a969fb);
DB_PermaDefeatedEvent(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, LOW_HagSurvivors_State_Adrielle_PermaDefeated_2904c062-d139-4fc5-9031-3826c19f0645);
DB_PermaDefeatedEvent(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, LOW_HagSurvivors_State_Kleidunn_PermaDefeated_e0548f7a-eb4a-4a03-8470-6b9a82a5e56c);
DB_PermaDefeatedEvent(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, LOW_HagSurvivors_State_Hag_MaskedVictim1_PermaDefeated_9d57d5e3-9cf8-49e5-b70f-662450a1aeb0);
DB_PermaDefeatedEvent(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, LOW_HagSurvivors_State_SurrogateMother_PermaDefeated_4391ae06-20bf-4e37-bbca-63519c550d0c);
DB_LOW_HagSurvivors_Bandits(S_LOW_HagSurvivors_Bandit_Fighter_01_4e3bb260-3d2e-48b0-86cf-c2693592915b);
DB_LOW_HagSurvivors_Bandits(S_LOW_HagSurvivors_Bandit_Bard_01_ede83d7d-ba00-4064-aa8c-0bab713b3518);
DB_LOW_HagSurvivors_Bandits(S_LOW_HagSurvivors_Bandit_Wizard_01_e17a32d6-78e5-4c33-b718-c548c058aac4);
DB_LOW_HagSurvivors_Bandits(S_LOW_HagSurvivors_Bandit_Warlock_01_1802e84d-f136-43c6-9c41-2c934ae56fa3);
DB_LOW_HagSurvivors_Bandits(S_LOW_HagSurvivors_Bandit_Barbarian_01_9b19aa71-7d43-4f63-9aee-dd9a5e09fede);
DB_LOW_HagSurvivors_Bandits(S_LOW_HagSurvivors_Bandit_Paladin_01_2eda24ed-9fca-4020-b514-4e041a1247f8);
DB_CombatReact_AD_OnEntered(S_LOW_HagSurvivors_Bandit_Fighter_01_4e3bb260-3d2e-48b0-86cf-c2693592915b, LOW_HagSurvivors_AD_Bandits_CombatStart_69c639db-e37e-0d46-c78a-c8177b6270e4);
DB_Inclusion_Object(S_LOW_HagSurvivors_Bandit_Bard_01_ede83d7d-ba00-4064-aa8c-0bab713b3518, LOW_HagSurvivors_Bandit_Bard_01_StartInclusion_cca5528b-d770-45b5-8b20-6627d108dc29, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_Object(S_LOW_HagSurvivors_Bandit_Wizard_01_e17a32d6-78e5-4c33-b718-c548c058aac4, LOW_HagSurvivors_Bandit_Wizard_01_StartInclusion_c541f43e-a557-4ab8-b1ae-75691164f87b, NULL_00000000-0000-0000-0000-000000000000);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_AD_Bandits_CombatStart_69c639db-e37e-0d46-c78a-c8177b6270e4, S_LOW_HagSurvivors_Bandit_Bard_01_ede83d7d-ba00-4064-aa8c-0bab713b3518);
DB_Inclusion_NPCDialog(LOW_HagSurvivors_AD_Bandits_CombatStart_69c639db-e37e-0d46-c78a-c8177b6270e4, S_LOW_HagSurvivors_Bandit_Wizard_01_e17a32d6-78e5-4c33-b718-c548c058aac4);
DB_Inclusion_CombatInclusionDialog(LOW_HagSurvivors_AD_Bandits_CombatStart_69c639db-e37e-0d46-c78a-c8177b6270e4);
DB_LOW_HagSurvivorsQuestBookChest(S_LOW_HagSurvivors_HagLoreBookChest_fd0fe386-dbcd-41dc-a6fb-40def976190e);
DB_QuestDef_ChainedState("LOW_SaveHaggedChild", "HagCellarRetreat", "LOW_AvengeHagSurvivors", "HagCellarRetreat");
DB_QuestDef_ChainedState("LOW_SaveHaggedChild", "DealWithHag", "LOW_AvengeHagSurvivors", "DealWithHag");
DB_QuestDef_ChainedState("LOW_SaveHaggedChild", "HagBossFightStarted_BrokeDeal", "LOW_AvengeHagSurvivors", "HagBossFightStarted_BrokeDeal");
DB_QuestDef_ChainedState("LOW_SaveHaggedChild", "HagBossFightStarted", "LOW_AvengeHagSurvivors", "HagBossFightStarted");
DB_QuestDef_State(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, "LOW_AvengeHagSurvivors", "HagPermaDefeated");
DB_QuestDef_State(LOW_HagSurvivors_State_PlayersKilledMayrina_75ea3027-8e3c-489b-a497-31889a83975a, "LOW_AvengeHagSurvivors", "MayrinaKilledByPlayer");
DB_QuestDef_State(LOW_HagSurvivors_State_KillHagQuestCompleted_300469ac-2022-4b4b-85f1-b611ba4abfee, "LOW_AvengeHagSurvivors", "ToldSurvivorsHagTrulyDead");
DB_QuestDef_State(LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233, "LOW_AvengeHagSurvivors", "AllSurvivorsPermaDefeated");
DB_QuestDef_ChainedState("LOW_SaveHaggedChild", "EnteredEND_MadeHagDeal", "LOW_AvengeHagSurvivors", "EnteredEND_MadeHagDeal");
DB_QuestDef_State(LOW_HagSurvivors_Knows_MayrinaHexed_37f1da5e-0550-2f73-f8a8-229a8d896999, "LOW_BreakHagHex", "KnowsMayrinaIsCursed");
DB_QuestDef_State(LOW_HagSurvivors_Knows_SurvivorsHauntedByDoll_ef0e7ffe-3bf9-483d-8caf-5aa845bfef59, "LOW_BreakHagHex", "KnowsAboutVoodooDoll_NoMayrina");
DB_QuestDef_State(LOW_HagSurvivors_State_SurvivorsFightAlongsideHagSpy_d8d6dcb0-836d-4c68-b28f-6357db9956fe, "LOW_BreakHagHex", "SurvivorsFightAlongsideJatlo");
DB_QuestDef_State_ConditionalFlag(LOW_HagSurvivors_SurrogateMother_MentionedDoll_c9485e65-b01e-d8b1-9392-02aaffe8693c, "LOW_BreakHagHex", "KnowsDollCausedCurse_Sheep", 0, LOW_HagSurvivors_State_ReadMayrinasNote_3c9a4e69-a315-4a37-a677-fc9a59070714);
DB_QuestDef_State_ConditionalFlag(LOW_HagSurvivors_State_ReadMayrinasNote_3c9a4e69-a315-4a37-a677-fc9a59070714, "LOW_BreakHagHex", "KnowsDollCausedCurse_Note", 0, LOW_HagSurvivors_SurrogateMother_MentionedDoll_c9485e65-b01e-d8b1-9392-02aaffe8693c);
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("ReadOldGarlowPointerNote");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("ReadHagsInformantNote");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("ReadHagsInformantNote_HagRevealed");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("KnowsMayrinaIsCursed");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("KnowsDollCausedCurse_Note");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("KnowsDollCausedCurse_Sheep");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("KnowsAboutVoodooDoll_NoMayrina");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("CuredMayrina");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("CuredMayrina_BeforeMeetingSurvivors");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("DestroyedVoodooDoll");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("ReadHagSpyNote");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("SurvivorsFightAlongsideJatlo");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("JatloDroppedDisguise_BrokeHex");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("JatloDroppedDisguise_NoHexBroken");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("JatloDroppedDisguise_SurvivorsPermaDefeated");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("HagSpyPermaDefeated_NoMayrina");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("HagSpyPermaDefeated_BeforeDollDestroyed");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("HagSpyPermaDefeated_AfterMayrinaCured");
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates("HagSpyPermaDefeated_BeforeMayrinaCured");
DB_LOW_HagSurvivors_Crabs(S_LOW_HagSurvivors_Crab_01_cc2810df-3213-4e65-8efa-1de4517bb792);
DB_LOW_HagSurvivors_Crabs(S_LOW_HagSurvivors_Crab_02_6509cc72-4648-44ec-a0c2-598a2b85b3e0);
DB_LOW_HagSurvivors_Crabs(S_LOW_HagSurvivors_Crab_03_709956be-ab4c-422d-ba68-6ca45d652df8);
DB_LOW_HagSurvivors_Crabs(S_LOW_HagSurvivors_Crab_04_cded4e77-ffde-4e7e-9e14-10761b46205b);
DB_LOW_HagSurvivors_Crabs(S_LOW_HagSurvivors_Crab_05_61c4494e-dea4-499c-a387-c1ee47cb9fc3);
DB_LOW_HagSurvivors_Crabs(S_LOW_HagSurvivors_Crab_06_99b9a9d3-8d33-409f-a640-a3f7418497a7);
DB_LOW_HagMaskEquipped_HagSurvivorReaction(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, LOW_HagSurvivors_AD_Kleidunn_SawHagMaskEquipped_11230c7b-514e-b0bc-c7ef-29ad18049af1);
DB_LOW_HagMaskEquipped_HagSurvivorReaction(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, LOW_HagSurvivors_AD_Adrielle_SawHagMaskEquipped_9bf45b11-d7f4-41e0-a914-621151ea8752);
DB_LOW_HagMaskEquipped_HagSurvivorReaction(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, LOW_HagSurvivors_AD_MaskedVictim1_SawHagMaskEquipped_1f675505-02de-190c-e4c1-ef22c101ec53);
DB_LOW_HagMaskEquipped_HagSurvivorReaction(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, LOW_HagSurvivors_AD_Mayrina_SawHagMaskEquipped_8e44cd73-b335-2f26-9d9d-a6ae05e13899);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_KleidunnJournal_000_3a92c2b1-691b-404a-87bf-2b559da29597);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_SurvivorsEviction_001_585f1bc8-3564-4f56-b157-472c79c969c9);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_RelocationNote_000_c4820ac1-2e68-40c3-bba5-10f23d2e467d);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_000_bba24bb4-4f74-47c4-a913-74f5bac6573b);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_001_e6430e6b-efcc-43d6-a9f9-e7c0fcf28ed1);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_002_11de612c-b017-4460-8b27-6992ed7d75fc);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_003_75d4ad4d-56c7-463a-80bb-5b6bba72f068);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_004_dc71fe33-7a4c-45d9-a794-ebb25800123d);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_005_186cb0d0-4b05-4e11-b1d3-d3bf7e07954a);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_007_88f83e23-be35-48eb-9f80-31c34d9a3a26);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_008_06ae2c8f-3ec3-46d4-b60e-b688658c1a17);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_009_8b7be4f6-e060-4a29-9dcf-69284cab8e42);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_010_356771fb-0f58-4175-b1cb-79a233d6f599);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_011_27d0dab1-bd7c-43b8-85f4-cd6f5d09c120);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_012_f3009ee9-d731-4304-9272-4a5b33224096);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_013_a19c1d24-836c-4c66-9084-9096d7366311);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_014_4b4698ce-e370-4a64-bd89-429bfa504711);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_015_992e91f0-fa67-4611-a3c0-8240ef63c55d);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_016_c2502437-95a4-4673-ad96-1e7f5367e20c);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_017_be1c8942-0b91-43fa-8c2f-84eb053d4b27);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_MayrinaContactLetter_000_d7f96c98-1b5b-407a-948d-0253d951caf4);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_AdrielleJournalMayrinaLeader_000_65a2aacb-639d-44e6-95a9-46f53a678a5e);
DB_LOW_HagSurvivorsPresent_Readables(BOOK_LOW_AuntieEthelsRevenge_AdrielleJournalNoMayrina_000_eb73d969-cb4d-4510-8010-4d05fa9f696c);
DB_LOW_HagInformantsNote_Templates(BOOK_LOW_BlushingMermaid_HagsInformantNote_785e14ea-78ad-4583-9268-a5e64354b481);
DB_LOW_HagInformantsNote_Templates(BOOK_LOW_BlushingMermaid_HagsInformantNote_NoMayrina_974a42f2-00a9-4753-ac67-e5053d06b69b);
DB_LOW_HagSpysNote_Templates(BOOK_LOW_HagSurvivors_HagSpysNote_97bfb610-9aa5-4183-bf60-972ad955b45a);
DB_LOW_HagSpysNote_Templates(BOOK_LOW_HagSurvivors_HagSpysNote_NoMayrina_658b0b6e-f60d-434c-8690-c2ea2b313f45);
PROC_LOW_SetupHagRelatedReadables();

KBSECTION
IF
DB_LOW_HagSurvivors(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

IF
DB_LOW_HagSurvivors(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterDisableCrime(_Var1, "VandaliseNoOwner");
PROC_SetOnStage(_Var1, 1);

IF
DB_LOW_HagSurvivors_Bandits(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 1);
DB_GLO_DefeatCounter(_Var1, "LOW_HagSurvivors_SquatterBandits");

IF
DB_LOW_HagSurvivors_Bandits(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

IF
DB_LOW_ActI_HagSurvivors(_Var1, _Var2, _Var3, _Var1, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_RemoveAllDialogEntriesForSpeaker(_Var1);
TeleportTo(_Var1, _Var2);
PROC_SetOnStage(_Var1, 1);
SetFaction(_Var1, ACT3_LOW_HagSurvivors_Victims_8fe0bd59-dabe-4cd8-92b7-b90855867c54);
SetCombatGroupID(_Var1, "c0882bbe-fb8c-f874-e1e2-dd5c9421f6a0");
DB_Dialogs(_Var1, _Var3);
DB_LOW_HagSurvivors(_Var1);
DB_GLO_DefeatCounter(_Var1, "LOW_HagSurvivors_PermaDefeated");
DB_NoLowAttitudeDialog(_Var1);
PROC_LOW_SurrogateMotherSetup(_Var1);
PROC_LOW_MaskedVictimSetup(_Var1);

PROC
PROC_LOW_SurrogateMotherSetup(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
THEN
DB_QuestDef_PermaDefeatedState("LOW_BreakHagHex", "MayrinaPermaDefeated", S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);
PROC_SetOnStage(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, 1);
PROC_SetOnStage(S_LOW_HagSurvivors_MayrinasNote_95c84ab5-1eed-4c0f-950a-89b8862d229c, 1);
SetFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_CharacterFullRestore(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);
BlockNewCrimeReactions(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, 1);
SetTag(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, AI_IGNORED_TARGET_ff6d7d1f-094f-432e-a117-fdc3a0ab7ac1);
PROC_LOW_UndeadHusbandSetup();
PROC_SceneOver("HAG_Hagspawn_ResurrectionScene");

PROC
PROC_LOW_SurrogateMotherSetup(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
AND
HasActiveStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE", 0, _, _)
THEN
ApplyStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE", -1);

PROC
PROC_LOW_UndeadHusbandSetup()
AND
DB_GlobalFlag(HAG_Hagspawn_Event_KillHusband_e7b38a2a-a730-420f-bf18-2b44b40fe640, _, _, _, _)
AND NOT
DB_Defeated(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(HAG_Hagspawn_Event_WifeHusbandLeave_c85ecfa6-472a-4200-fa39-1bb40b1338be);

PROC
PROC_LOW_UndeadHusbandSetup()
AND
DB_GlobalFlag(HAG_Hagspawn_Event_WifeHusbandLeave_c85ecfa6-472a-4200-fa39-1bb40b1338be, _, _, _, _)
THEN
PROC_CharacterFullRestore(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);
TeleportTo(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, S_LOW_HagSurvivors_UndeadHusband_d7d4a89f-04d9-4159-a59a-dcd216b8384f);
PROC_SetOnStage(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, 1);
SetFaction(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, ACT3_LOW_HagSurvivors_Victims_8fe0bd59-dabe-4cd8-92b7-b90855867c54);
PROC_GlobalSetFlagAndCache(LOW_HagSurvivors_State_UndeadHusbandArrivedWithMayrina_c55490ca-a1ca-456c-bdad-2ae148db02c4);
DB_LOW_HagSurvivors(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);
DB_Dialogs(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, LOW_HagSurvivors_UndeadHusband_015571b8-a869-77fa-374d-c173fb9df480);
DB_NoLowAttitudeDialog(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);
NOT DB_PreventPermaDefeated(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);
DB_PermaDefeatedEvent(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, LOW_HagSurvivors_State_Connor_PermaDefeated_98eb28de-726e-451c-990a-7314e7a1e20b);

PROC
PROC_LOW_UndeadHusbandSetup()
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_UndeadHusbandArrivedWithMayrina_c55490ca-a1ca-456c-bdad-2ae148db02c4, _, _, _, _)
THEN
PROC_SetOnStage(S_Graveyard_MayrinaHusbandTombstone_8f7478bb-9913-4f4f-bd92-8592d35f7caf, 1);

PROC
PROC_LOW_MaskedVictimSetup(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, _, _, _, _)
THEN
TemplateAddTo(BOOK_LOW_AuntieEthelsRevenge_MaskVengeanceLetter_cf61d6e0-a559-4c0a-a740-a2eb15f1ade9, CONT_GEN_Mailbox_C_019_2ebacd72-0215-44d1-b683-028b5ae87a2d, 1);
SetStoryDisplayName(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, "LOW_HagSurvivors_MaskOfRegret_DisplayName");
PROC_CharacterFullRestore(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);
DB_SpotPlayers(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, "LOW_SurvivorsFirstMeeting_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_HAG_MaskedVictims(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, S_HAG_MaskedVictim01_Moveto_13bb41c4-9425-4e71-a6f6-2bedd98bd0dc, 100, HAG_Hag_MaskedVictim1_AD_Resist_e238cfcb-0b01-bce9-237e-79e526ac8932);

PROC
PROC_LOW_MaskedVictimSetup(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_HAG_MaskedVictims(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, _Var1, _Var2, _Var3, _Var1)
THEN
NOT DB_HAG_MaskedVictims(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, _Var1, _Var2, _Var3);

IF
FlagSet(LOW_HagSurvivors_State_Adrielle_PermaDefeated_2904c062-d139-4fc5-9031-3826c19f0645, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(LOW_HagSurvivors_State_SurvivorsHadCasualty_b79f04e8-6406-139a-c7e7-d149c4471b50);

IF
FlagSet(LOW_HagSurvivors_State_Kleidunn_PermaDefeated_e0548f7a-eb4a-4a03-8470-6b9a82a5e56c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(LOW_HagSurvivors_State_SurvivorsHadCasualty_b79f04e8-6406-139a-c7e7-d149c4471b50);

IF
FlagSet(LOW_HagSurvivors_State_Hag_MaskedVictim1_PermaDefeated_9d57d5e3-9cf8-49e5-b70f-662450a1aeb0, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(LOW_HagSurvivors_State_SurvivorsHadCasualty_b79f04e8-6406-139a-c7e7-d149c4471b50);

IF
FlagSet(LOW_HagSurvivors_State_SurrogateMother_PermaDefeated_4391ae06-20bf-4e37-bbca-63519c550d0c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(LOW_HagSurvivors_State_SurvivorsHadCasualty_b79f04e8-6406-139a-c7e7-d149c4471b50);

IF
KilledBy(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, (GUIDSTRING)_Var1, _, _, (GUIDSTRING)_Var1)
AND
QRY_LOW_IsPartyMemberOrVoodooDoll(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_HagSurvivors_PlayersKilledMayrina(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagSurvivors_PlayersKilledMayrina(1);
PROC_GlobalSetFlagAndCache(LOW_HagSurvivors_State_PlayersKilledMayrina_75ea3027-8e3c-489b-a497-31889a83975a);
PROC_SetRelationToPlayers(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, 0);

QRY
QRY_LOW_IsPartyMemberOrVoodooDoll((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_LOW_IsPartyMemberOrVoodooDoll((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
_Var1 == S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a
THEN
DB_NOOP(1);

IF
DB_SpotPlayers(_Var1, "LOW_SurvivorsFirstMeeting_Spotting", _, _, _Var1)
THEN
DB_SpotPlayers_Continuous(_Var1, "LOW_SurvivorsFirstMeeting_Spotting");
DB_SpotPlayers_SpotTrigger(_Var1, "LOW_SurvivorsFirstMeeting_Spotting", S_LOW_HagSurvivors_FristMeetingTrigger_af5affb6-c628-48c0-8a3e-35f41f672f7e);
DB_SpotPlayers_IncludeWildshapedPlayers(_Var1, "LOW_SurvivorsFirstMeeting_Spotting");
PROC_SceneDialogOnly("LOW_SurvivorsFirstMeeting_Scene", _Var1, S_LOW_HagSurvivors_FristMeetingTrigger_af5affb6-c628-48c0-8a3e-35f41f672f7e);

PROC
PROC_SceneInterrupted((GUIDSTRING)_Var1, _, "LOW_SurvivorsFirstMeeting_Scene", (STRING)_Var3, (GUIDSTRING)_Var1)
AND
DB_LOW_SurvivorsFirstMeeting_SceneInterrupts(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsFirstMeeting_Spotting");
PROC_LOW_HagSurvivors_HagSpy_PermaHostility();

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "LOW_SurvivorsFirstMeeting_Spotting", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_SurvivorAvailableForIntroDialog(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _Var2, _Var1, _Var1, _Var1)
AND
QRY_SurvivorAvailableForIntroDialog(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, _Var2, _Var1, _Var1, _Var1)
AND
QRY_SurvivorAvailableForIntroDialog(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, _Var2, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9, S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, S_LOW_HagSurvivors_VoodooDoll_Helper_b5f3e046-fe13-458e-9bb7-c428b1eeec6f, _Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_SurvivorAvailableForIntroDialog((GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
QRY_SpeakerIsAvailable(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(_Var1, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 <= 100
THEN
DB_NOOP(1);

IF
DialogStarted(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(LOW_HagSurvivors_State_MetSurvivors_e60750e6-26bc-4b80-a782-32dcc7d1e397);
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsFirstMeeting_Spotting");

IF
DialogEnded(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
PROC_Foop(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a);

IF
DialogEnded(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_SurvivorsFightAlongsideHagSpy_d8d6dcb0-836d-4c68-b28f-6357db9956fe, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_SurvivorsTrustPlayers_648c69b6-a5e3-438b-ac0a-441bbb80f38d, _, _, _, _)
THEN
PROC_LOW_HagSurvivors_HagSpy_PermaHostility();

IF
DialogEnded(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurvivorsTrustPlayers_648c69b6-a5e3-438b-ac0a-441bbb80f38d, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
SetFlag(LOW_HagSurvivors_Knows_MayrinaHexed_37f1da5e-0550-2f73-f8a8-229a8d896999);

IF
DialogEnded(LOW_HagSurvivors_FirstMeeting_Adrielle_Kleidunn_Jatlo_7b610a39-dc3f-67f4-9301-94ba052ee9e9, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurvivorsTrustPlayers_648c69b6-a5e3-438b-ac0a-441bbb80f38d, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
SetFlag(LOW_HagSurvivors_Knows_SurvivorsHauntedByDoll_ef0e7ffe-3bf9-483d-8caf-5aa845bfef59);

IF
FlagSet(LOW_HagSurvivors_State_HagSpyAggroed_74eca7c7-e83b-4f07-ac32-beac7cd5eff7, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsFirstMeeting_Spotting");

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SceneOver("LOW_SurvivorsFirstMeeting_Scene");

PROC
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsFirstMeeting_Spotting", _, _, _, _)
AND
QRY_OnlyOnce("LOW_SurvivorsFirstMeeting_StopSpotting_OnlyOnce", _, _, _, _)
THEN
PROC_SceneOver("LOW_SurvivorsFirstMeeting_Scene");
SetFlag(LOW_HagSurvivors_State_MetSurvivors_e60750e6-26bc-4b80-a782-32dcc7d1e397);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_HagSurvivors_State_SurvivorsFightAlongsideHagSpy_d8d6dcb0-836d-4c68-b28f-6357db9956fe, _, _, _, _)
THEN
PROC_LOW_HagSurvivors_HagSpy_PermaHostility();

PROC
PROC_LOW_HagSurvivors_HagSpy_PermaHostility()
THEN
PROC_SetRelationToPlayers(ACT3_LOW_HagSurvivors_HagSpy_a18d972a-d3be-43fe-b13f-1f280b3f48aa, 0);
PROC_SetRelationToPlayers(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, 0);

PROC
PROC_LOW_HagSurvivors_HagSpy_PermaHostility()
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_SurvivorsFightAlongsideHagSpy_d8d6dcb0-836d-4c68-b28f-6357db9956fe, _, _, _, _)
THEN
SetFlag(LOW_HagSurvivors_State_SurvivorsFightAlongsideHagSpy_d8d6dcb0-836d-4c68-b28f-6357db9956fe);

IF
StatusRemoved(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, "LOW_HAG_VOODOODOLL", _, _, (GUIDSTRING)_)
THEN
Die(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a);

IF
DestroyedBy(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _, _, _, (CHARACTER)_)
THEN
PROC_GlobalSetFlagAndCache(LOW_HagSurvivors_State_DollDestroyed_e99c5e75-57c4-4a7a-be5c-0ce8e3724e60);

IF
DestroyedBy(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
RemoveStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE");

IF
DestroyedBy(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
PROC_LOW_HagSpyAggro();

IF
FlagSet(LOW_HagSurvivors_State_DollDestroyed_e99c5e75-57c4-4a7a-be5c-0ce8e3724e60, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "DestroyedVoodooDoll");

PROC
PROC_BlockMoveOfItem((CHARACTER)_Var1, S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_CustomMoveItemResponse(_Var1, S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, 0);
PROC_LOW_TeleportVoodooDoll();
PROC_TryStartAD(LOW_HagSurvivors_PAD_VoodooDoll_e3737d34-d135-6099-2492-92d9eae1d70b, _Var1);

PROC
PROC_BlockPickupOfItem((CHARACTER)_Var1, S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_CustomPickupItemResponse(_Var1, S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, 0);
PROC_LOW_TeleportVoodooDoll();
PROC_TryStartAD(LOW_HagSurvivors_PAD_VoodooDoll_e3737d34-d135-6099-2492-92d9eae1d70b, _Var1);

IF
AttackedBy(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, (GUIDSTRING)_Var1, _, _, _, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetHitpoints(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _Var7, _Var1, _Var1, _Var1)
AND
_Var7 > 0
THEN
PROC_TryStartAD(LOW_HagSurvivors_PAD_VoodooDoll_e3737d34-d135-6099-2492-92d9eae1d70b, _Var1);

IF
HitpointsChanged(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _, _, _, _)
AND
GetHitpoints(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _Var2, _, _, _)
AND
_Var2 > 0
THEN
PROC_LOW_TeleportVoodooDoll();

PROC
PROC_LOW_TeleportVoodooDoll()
AND
QRY_LOW_GetRandomVoodooDollDestination()
AND
DB_LOW_RandomVoodooDollDestination(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_HagSurvivors_AD_VoodooDoll_07d163fe-f3b7-a7bc-13ad-3968bcdb982c, S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a);
PROC_Poof(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f);
TeleportTo(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _Var1, "LOW_VoodooDollTeleport");
NOT DB_LOW_RandomVoodooDollDestination(_Var1);
SysClear("DB_LOW_VoodooDollPotentialDestinations", 1);
PROC_LOW_SetVoodooDollPotentialDestinations();

IF
EntityEvent(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, "LOW_VoodooDollTeleport", _, _, _)
THEN
PROC_Foop(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, VFX_Script_Hag_Poof_01_a5ac4b11-0c02-a7a6-5c41-a95cf56c847f);

QRY
QRY_LOW_GetRandomVoodooDollDestination()
AND
QRY_GetRandom("DB_LOW_VoodooDollPotentialDestinations", 1, "DB_LOW_RandomVoodooDollDestination", _, _)
AND
DB_LOW_RandomVoodooDollDestination(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_VoodooDollPotentialDestinations(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_CurentVoodooDollTeleportSpot(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
GUIDToString(_Var1, _Var3, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_CurentVoodooDollTeleportSpot(_Var2);
DB_LOW_CurentVoodooDollTeleportSpot(_Var1);
DebugBreak(_Var3);

PROC
PROC_LOW_SetVoodooDollPotentialDestinations()
AND
DB_LOW_VoodooDollTeleportSpots(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_CurentVoodooDollTeleportSpot(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_VoodooDollPotentialDestinations(_Var1);

PROC
PROC_LOW_VoodooDollToDefaultSpot()
AND
DB_LOW_CurentVoodooDollTeleportSpot(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TeleportTo(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _Var1);

PROC
PROC_LOW_HagSpyAggro()
AND
QRY_OnlyOnce("LOW_HagSpyAggro_OnlyOnce", _, _, _, _)
THEN
PROC_LOW_HagSpyAggro_Internal();

PROC
PROC_LOW_HagSpyAggro_Internal()
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_PlayersKilledMayrina_75ea3027-8e3c-489b-a497-31889a83975a, _, _, _, _)
THEN
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsFirstMeeting_Spotting");
DB_SpotPlayers(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HagSpyCurseLifted_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_IncludeWildshapedPlayers(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HagSpyCurseLifted_Spotting");
DB_Dialogs(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2);
DB_SceneManager(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HagSpyChallengesPlayersOnAggro_Scene");

PROC
PROC_SceneInterrupted(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, (CHARACTER)_Var1, "LOW_HagSpyChallengesPlayersOnAggro_Scene", "Attacked", (CHARACTER)_Var1)
THEN
PROC_LOW_HagSpyDropsDisguise();
PROC_SceneOver("LOW_HagSpyChallengesPlayersOnAggro_Scene");

PROC
PROC_LOW_HagSpyAggro_Internal()
AND
DB_PartyMembers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _Var2, _Var1, _Var1, _Var1)
AND
QRY_LOW_ShouldSurvivorsDropTempHostility()
THEN
DB_LOW_DropTemporaryHostility_HagSurvivors(1);
PROC_LOW_HagSpyDropsDisguise();

QRY
QRY_LOW_ShouldSurvivorsDropTempHostility()
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_LOW_ShouldSurvivorsDropTempHostility()
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_LOW_HagSpyAggro_Internal()
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
AND
DB_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_PlayersKilledMayrina_75ea3027-8e3c-489b-a497-31889a83975a, _, _, _, _)
THEN
DB_LOW_DropTemporaryHostility_HagSurvivors(1);
PROC_LOW_HagSpyDropsDisguise();

PROC
PROC_LOW_HagSpyAggro_Internal()
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
AND
DB_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_PlayersKilledMayrina_75ea3027-8e3c-489b-a497-31889a83975a, _, _, _, _)
THEN
PROC_LOW_HagSpyDropsDisguise();

PROC
PROC_SpotPlayers_Spotted(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HagSpyCurseLifted_Spotting", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_StartDialogCustom(LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _Var1, 0, 0, 1, 1, _Var1, _Var1, _Var1)
THEN
PROC_LOW_HagSpyDropsDisguise();

IF
DialogStarted(LOW_HagSurvivors_HagSpy_Aggroed_41621532-a3a0-8d9a-de88-729d5cdc18a2, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_ClearStoryMove(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f);

PROC
PROC_GlobalFlagReactionAfterDialog(LOW_HagSurvivors_Event_HagSpy_DropDisguise_c60c37b3-852c-431c-8f82-0285551cdfd6, _, _, _, _)
THEN
PROC_LOW_HagSpyDropsDisguise();

IF
HitpointsChanged(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, (REAL)_Var1, (REAL)_Var1, (REAL)_Var1, (REAL)_Var1)
AND
HasActiveStatus(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HAGSPY_DISGUISE", 1, _Var1, _Var1)
AND
_Var1 < 90
THEN
PROC_LOW_HagSpyDropsDisguise();

PROC
PROC_LOW_HagSpyDropsDisguise()
AND
QRY_OnlyOnce("LOW_HagSpyDropsDisguise_OnlyOnce", _, _, _, _)
THEN
PROC_ForceStopDialog(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f);
PROC_SceneOver("LOW_HagSpyChallengesPlayersOnAggro_Scene");
PROC_SetRelationMutual(ACT3_LOW_HagSurvivors_HagSpy_a18d972a-d3be-43fe-b13f-1f280b3f48aa, Act3_LOW_FlamingFistGuards_86d2eaf4-1da3-4dbe-94c0-7cf3b240f428, 0);
PROC_SetRelationMutual(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, ACT3_LOW_HagSurvivors_HagSpy_a18d972a-d3be-43fe-b13f-1f280b3f48aa, 0);
PROC_SetRelationToPlayers(ACT3_LOW_HagSurvivors_HagSpy_a18d972a-d3be-43fe-b13f-1f280b3f48aa, 0);
PROC_LOW_HagSurvivors_SurvivorsRelationsOnDroppedDisguise();
RemoveStatus(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HAGSPY_DISGUISE");

PROC
PROC_LOW_HagSpyDropsDisguise()
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(LOW_HagSurvivors_State_HagSpyAggroed_74eca7c7-e83b-4f07-ac32-beac7cd5eff7);

PROC
PROC_LOW_HagSurvivors_SurvivorsRelationsOnDroppedDisguise()
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_PlayersKilledMayrina_75ea3027-8e3c-489b-a497-31889a83975a, _, _, _, _)
THEN
PROC_SetRelationToPlayers(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, 100);

IF
StatusRemoved(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HAGSPY_DISGUISE", _, _, (GUIDSTRING)_)
THEN
PROC_TryStartAD(LOW_HagSurvivors_AD_DropsDisguise_HagSpy_61774322-1c4c-6bae-1da4-1c0533a969fb, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f);

IF
TemplateUseFinished((CHARACTER)_Var1, (ITEMROOT)_Var2, _, 1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_HagSpysNote_Templates(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_HagSpysNoteRead(1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagSpysNoteRead(1);
SetFlag(LOW_HagSurvivors_State_PlayersReadHagSpysNote_958013bc-d97a-43b9-903a-69587055eea7);

IF
FlagSet(LOW_HagSurvivors_State_PlayersReadHagSpysNote_958013bc-d97a-43b9-903a-69587055eea7, _, _, _, _)
AND NOT
DB_PermaDefeated(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_HagSpyAggroed_74eca7c7-e83b-4f07-ac32-beac7cd5eff7, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "ReadHagSpyNote");

IF
DB_LOW_HagSurvivors_Crabs(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

IF
CastedSpell(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "TARGET_LOW_HagSurvivors_Summon", _, _, _)
AND
DB_LOW_HagSurvivors_Crabs(_Var4, _, _, _, _)
THEN
PROC_Foop(_Var4);

IF
DB_GlobalFlag(LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233, _, _, _, _)
AND
HasActiveStatus(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HAGSPY_DISGUISE", 1, _, _)
THEN
PROC_LOW_HagSpyDropsDisguise();

PROC
PROC_StateSet_PermaDefeated(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7, _, _, _, _)
AND
DB_Is_InCombat(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
THEN
PROC_TryStartAD(LOW_HagSurvivors_AD_Combat_SurrogateMother_JatloDied_4bb45075-83f7-1297-9cec-289191e49224, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);

IF
RelationChanged((FACTION)_Var1, (FACTION)_Var2, 0, 0, (FACTION)_Var1)
AND
DB_LOW_HagSurvivors_Factions(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_DropTemporaryHostility_HagSurvivors(1, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "LOW_HAGSPY_DISGUISE", 1, _Var1, _Var1)
THEN
DB_LOW_DropTemporaryHostility_HagSurvivors(1);

IF
RelationChanged(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100, 1, _)
AND
DB_LOW_DropTemporaryHostility_HagSurvivors(1, _, _, _, _)
AND
DB_Is_InCombat(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_HagSpyDroppedDisguise_CombatId(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagSpyDroppedDisguise_CombatId(_Var1);

IF
RelationChanged(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, Hero_a1542c81-6895-929e-4522-10ce218bb360, 100, 1, _)
AND
DB_LOW_DropTemporaryHostility_HagSurvivors(1, _, _, _, _)
AND
DB_LOW_HagSurvivors(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NoLowAttitudeDialog(_Var1);
LeaveCombat(_Var1);

IF
LeftCombat((CHARACTER)_Var1, (GUIDSTRING)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_DropTemporaryHostility_HagSurvivors(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_HagSpyDroppedDisguise_CombatId(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_HagSurvivors(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_PartyMembersInHagSpyCombat(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
EnterCombat(_Var1, _Var3);

IF
DB_LOW_HagSpyDroppedDisguise_CombatId(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PartyMembers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_PartyMembersInHagSpyCombat(_Var2);

IF
FlagSet(LOW_HagSurvivors_Knows_MayrinaHexed_37f1da5e-0550-2f73-f8a8-229a8d896999, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetStoryDisplayName(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HagSurvivors_MayrinaSheepForm_DisplayName");

IF
StatusRemoved(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE", _, _, _)
AND
GetHitpoints(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var3, _, _, _)
AND
_Var3 > 0
THEN
PROC_GlobalSetFlagAndCache(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7);
PROC_RemoveAllDialogEntriesForSpeaker(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);
DB_Dialogs(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, LOW_HagSurvivors_SurrogateMother_Cured_f776ecd3-8e2a-2c91-645c-5a91e0f5d646);
PROC_TryStartAD(LOW_HagSurvivors_AD_Cured_SurrogateMother_5bf34b46-2548-a31a-0d2f-13c223eb0698, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);
BlockNewCrimeReactions(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, 0);
PROC_LOW_HagSpyReactsToMayrinaLosingCurseStatus();

IF
StatusRemoved(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE", _, _, _)
AND
GetHitpoints(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var3, _, _, _)
AND
_Var3 <= 0
THEN
PROC_LOW_HagSpyReactsToMayrinaLosingCurseStatus();

PROC
PROC_LOW_HagSpyReactsToMayrinaLosingCurseStatus()
THEN
PROC_ForceStopDialog(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f);
PROC_CharacterMoveTo(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "Run", "");
PROC_LOW_HagSpyAggro();

IF
GameBookInterfaceClosed(S_LOW_HagSurvivors_MayrinasNote_95c84ab5-1eed-4c0f-950a-89b8862d229c, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_HagSurvivors_State_ReadMayrinasNote_3c9a4e69-a315-4a37-a677-fc9a59070714);

IF
FlagSet(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_MetSurvivors_e60750e6-26bc-4b80-a782-32dcc7d1e397, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "CuredMayrina");

IF
FlagSet(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_MetSurvivors_e60750e6-26bc-4b80-a782-32dcc7d1e397, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "CuredMayrina_BeforeMeetingSurvivors");

IF
StatusRemoved(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE", _, _, _)
AND NOT
DB_Defeated(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _, _, _, _)
THEN
Die(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a);

IF
DB_Sees(_Var1, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_SawMayrinaAsSheep_09ea45ca-113f-4b96-ad36-d349f3cc4b28, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE", 1, _Var1, _Var1)
THEN
SetFlag(LOW_HagSurvivors_State_SawMayrinaAsSheep_09ea45ca-113f-4b96-ad36-d349f3cc4b28);

IF
AttackedBy(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, (GUIDSTRING)_Var1, _, (STRING)_Var3, (INTEGER)_Var4, _, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_Dead(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var1, _Var1, _Var1, _Var1)
AND
_Var4 >= 1
THEN
ApplyDamage(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, 1, _Var3, S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a);
PROC_TryStartAD(LOW_HagSurvivors_AD_SheepMayrina_VoodooDamaged_be0e71d5-1300-21a3-b8f4-6734ad125d3e, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);

IF
StatusApplied(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, (STRING)_Var1, (GUIDSTRING)_Var2, (INTEGER)_Var3, (STRING)_Var1)
AND
_Var1 != "LOW_HAG_VOODOODOLL"
AND NOT
DB_Dead(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var1, _Var1, _Var1, _Var1)
THEN
ApplyStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var1, 6, 1, S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a);

PROC
PROC_StateSet_PermaDefeated(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _, _, _, _)
AND NOT
DB_Is_InCombat(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
THEN
ClearTag(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, AI_IGNORED_TARGET_ff6d7d1f-094f-432e-a117-fdc3a0ab7ac1);

PROC
PROC_StateSet_PermaDefeated(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Is_InCombat(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagSpyPermaDefeatedCombat(_Var1);

PROC
PROC_StateSet_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_HagSpyPermaDefeatedCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_HagSpyPermaDefeatedCombat(_Var1);

IF
SwitchedCombat(_, (GUIDSTRING)_Var2, (GUIDSTRING)_Var3, _, _)
AND
DB_LOW_HagSpyPermaDefeatedCombat(_Var2, _, _, _, _)
THEN
NOT DB_LOW_HagSpyPermaDefeatedCombat(_Var2);
DB_LOW_HagSpyPermaDefeatedCombat(_Var3);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_HagSpyPermaDefeatedCombat(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearTag(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, AI_IGNORED_TARGET_ff6d7d1f-094f-432e-a117-fdc3a0ab7ac1);
NOT DB_LOW_HagSpyPermaDefeatedCombat(_Var1);

IF
DB_Sees(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var1, _Var1, _Var1, _Var1)
AND
HasActiveStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_HAGVICTIM_SHEEPCURSE", 0, _Var1, _Var1)
AND
GetTemplate(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
_Var2 == QUEST_HAG_HusbandZombie_f1876ebc-8a68-410a-885f-21f991a5df09
THEN
PROC_TryStartAD(LOW_HagSurvivors_AD_SurrogateMother_SeesHusbandAsSummon_38c109c4-edcc-dd42-33f1-4c4bd8dffcfd, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_HagSurvivors_SurrogateMother_Cured_f776ecd3-8e2a-2c91-645c-5a91e0f5d646, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_UndeadHusbandArrivedWithMayrina_c55490ca-a1ca-456c-bdad-2ae148db02c4, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddSpeakingActor(_Var1, S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND NOT
DB_PermaDefeated(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _, _, _, _)
THEN
PROC_ForceStopDialog(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f);
Die(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, 0, S_HAG_Hag_c457d064-83fb-4ec6-b74d-1f30dfafd12d, 1, 0, 0);

IF
Died(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND
QRY_StartDialog(LOW_HagSurvivors_AD_HagKilled_HagSpy_ef9ff76b-5283-1a3f-11ee-338fd97fb9e3, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _, _, _)
THEN
DB_NOOP(1);

IF
Died(S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
THEN
PROC_LOW_HagSpyDropsDisguise();
PROC_LOW_SetupJatloInstaDiedSpotting();
PROC_TryStartAD(LOW_HagSurvivors_AD_SurvivorsSeeHagSpyInstaDie_c74861c8-d01a-7faf-92a5-b0326b9b0d15, S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6);

PROC
PROC_LOW_SetupJatloInstaDiedSpotting()
AND
DB_LOW_HagSurvivors(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_SpotPlayers(_Var1, "LOW_SurvivorsJatloInstaDied_Spotting", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_Continuous(_Var1, "LOW_SurvivorsJatloInstaDied_Spotting");
DB_SpotPlayers_IncludeWildshapedPlayers(_Var1, "LOW_SurvivorsJatloInstaDied_Spotting");

IF
DB_SpotPlayers(_Var1, "LOW_SurvivorsJatloInstaDied_Spotting", _, _, _Var1)
AND
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_JatloInstaDied_MandatorySpeakers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsJatloInstaDied_Spotting");

IF
DB_SpotPlayers(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "LOW_SurvivorsJatloInstaDied_Spotting", _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
AND NOT
DB_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
AND NOT
DB_CantMove(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
THEN
PROC_CharacterMoveTo(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, "Run", "LOW_MayrinaMovedToHagSpysCorpse");

PROC
PROC_SpotPlayers_Spotted((CHARACTER)_Var1, "LOW_SurvivorsJatloInstaDied_Spotting", (CHARACTER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_SurvivorAvailableForIntroDialog(S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, _Var2, _Var1, _Var1, _Var1)
AND
QRY_SurvivorAvailableForIntroDialog(S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, _Var2, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8, S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6, S_LOW_HagSurvivors_Kleidunn_54acca8b-2dab-4132-883e-6948bd11b8f0, _Var2, _Var1)
THEN
DB_NOOP(1);

IF
DialogStarted(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsJatloInstaDied_Spotting");

IF
FlagSet(LOW_HagSurvivors_State_KillHagQuestCompleted_300469ac-2022-4b4b-85f1-b611ba4abfee, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SpotPlayers_StopSpotting("LOW_SurvivorsJatloInstaDied_Spotting");

IF
DB_LOW_HagSurvivorsQuestBookChest(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(S_LOW_HagSurvivors_HagLoreBookChest_fd0fe386-dbcd-41dc-a6fb-40def976190e, 1);
SetOwner(S_LOW_HagSurvivors_HagLoreBookChest_fd0fe386-dbcd-41dc-a6fb-40def976190e, S_LOW_HagSurvivors_Adrielle_aa38af5c-9c75-4b2e-89e3-0cc1b995dbd6);

IF
DB_LOW_HagSurvivorsQuestBookChest(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(S_LOW_HagSurvivors_HagLoreBookChest_fd0fe386-dbcd-41dc-a6fb-40def976190e, 0);

IF
FlagSet(LOW_HagSurvivors_Knows_HagLoreBook_0e63b348-e6f3-626e-75b4-ef9a6c9b18d6, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearOwnership(S_LOW_HagSurvivors_HagLoreBookChest_fd0fe386-dbcd-41dc-a6fb-40def976190e);

IF
FlagSet(LOW_HagSurvivors_Knows_HagLoreBook_0e63b348-e6f3-626e-75b4-ef9a6c9b18d6, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
AND
QRY_OnlyOnce("LOW_ShowHagSurvivorsStashMarker_OnlyOnce", _, _, _, _)
THEN
PROC_ShowMarker(_Var3, "LOW_HagSurvivorsStashSafe");

IF
UseStarted((CHARACTER)_Var1, S_LOW_HagSurvivors_HagLoreBookChest_fd0fe386-dbcd-41dc-a6fb-40def976190e, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_ActivePlayerMarker(_Var2, "LOW_HagSurvivorsStashSafe", _Var1, _Var1, _Var1)
THEN
PROC_HideMarker(_Var2, "LOW_HagSurvivorsStashSafe");

IF
GameBookInterfaceClosed(S_LOW_HagQuestGrenade_Book_4a9b62b6-33f1-4ebf-8c83-eac79b1d7fd8, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_HagQuestGrenade_BookReadFlagSet_OnlyOnce", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_BlushingMermaid_State_HagQuestGrenade_BookRead_6c36ea74-ea4e-4974-b9cd-dd49ca00265f);

IF
FlagSet(LOW_BlushingMermaid_State_HagQuestGrenade_BookRead_6c36ea74-ea4e-4974-b9cd-dd49ca00265f, _, _, _, _)
AND
QRY_QuestUpdateIsUnlockedForAny("LOW_SaveHaggedChild", "HagBossFightStarted", _, _, _)
THEN
QuestUpdate("LOW_SaveHaggedChild", "FoundQuestGreandeRecipe");

IF
Saw((CHARACTER)_Var1, (CHARACTER)_Var2, 0, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_HagMaskEquipped_HagSurvivorReaction(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
GetEquippedItem(_Var2, "Helmet", _Var4, _Var1, _Var1)
AND
DB_HAG_Hagmasks(_Var4, _Var5, _Var1, _Var1, _Var1)
AND
GetRelation(Act3_LOW_HagSurvivors_8fe0bd59-dabe-4cd8-92b7-b90855867c54, Hero_a1542c81-6895-929e-4522-10ce218bb360, _Var6, _Var1, _Var1)
AND
_Var6 != 0
AND NOT
DB_LOW_HagSurvivorsWornMaskADPlayed(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(_Var3, _Var1);
LookAtEntity(_Var1, _Var2, 3);

IF
AutomatedDialogStarted((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_HagMaskEquipped_HagSurvivorReaction(_, _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_HagSurvivorsWornMaskADPlayed(1);

IF
AutomatedDialogEnded((DIALOGRESOURCE)_Var1, _, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_HagMaskEquipped_HagSurvivorReaction(_, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_HagSurvivorsWornMaskADPlayed(1);

IF
FlagSet(LOW_HagSurvivors_State_KillHagAccepted_cbf43b08-e2a4-f9e1-9d8f-94f1936b2ba0, _, (INTEGER)_Var2, _, _)
AND
DB_DialogNPCs(_Var2, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_ToldMayrinaCantHelpKillHag_7402e627-305e-4d83-938f-79c05c419220, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "TalkedToSavedMayrina_NotToldAboutStash");

IF
FlagSet(LOW_HagSurvivors_State_KillHagAccepted_cbf43b08-e2a4-f9e1-9d8f-94f1936b2ba0, _, (INTEGER)_Var2, _, _)
AND NOT
DB_DialogNPCs(_Var2, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "SurvivorsToldAboutStash");

IF
FlagSet(LOW_HagSurvivors_State_KillHagAccepted_cbf43b08-e2a4-f9e1-9d8f-94f1936b2ba0, _, (INTEGER)_Var2, _, _)
AND
DB_DialogNPCs(_Var2, S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _)
THEN
QuestUpdate("LOW_AvengeHagSurvivors", "QuestStarted_AskedByMayrina");

IF
FlagSet(LOW_HagSurvivors_State_KillHagAccepted_cbf43b08-e2a4-f9e1-9d8f-94f1936b2ba0, _, (INTEGER)_Var2, _, _)
AND NOT
QRY_QuestUpdateIsUnlockedForAny("LOW_AvengeHagSurvivors", "QuestStarted_AskedByMayrina", _, _, _)
THEN
QuestUpdate("LOW_AvengeHagSurvivors", "QuestStarted_AskedBySurvivor");

IF
TemplateUseFinished((CHARACTER)_Var1, LOW_HagResurrectionPrevention_Book_661da3b2-a943-4c2c-9913-269b9503763d, _, 1, (CHARACTER)_Var1)
AND
QRY_OnlyOnce("LOW_HagResurrectionPrevention_BookRead_OnlyOnce", _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_BlushingMermaid_State_HagResurrectionPrevention_BookRead_a9b2bf68-a71f-41b2-a317-a8778306aa6a);

IF
FlagSet(LOW_BlushingMermaid_State_HagResurrectionPrevention_BookRead_a9b2bf68-a71f-41b2-a317-a8778306aa6a, _, _, _, _)
AND
QRY_QuestUpdateIsUnlockedForAny("LOW_AvengeHagSurvivors", "HagBossFightStarted", _, _, _)
THEN
QuestUpdate("LOW_AvengeHagSurvivors", "ReadShroomsBook");

IF
FlagSet(LOW_BlushingMermaid_State_HagResurrectionPrevention_BookRead_a9b2bf68-a71f-41b2-a317-a8778306aa6a, _, _, _, _)
AND NOT
QRY_QuestUpdateIsUnlockedForAny("LOW_AvengeHagSurvivors", "HagBossFightStarted", _, _, _)
THEN
NOT DB_QuestDef_ChainedState("LOW_SaveHaggedChild", "HagBossFightStarted", "LOW_AvengeHagSurvivors", "HagBossFightStarted");
DB_QuestDef_State(LOW_BlushingMermaid_State_HagBossFightStarted_20001901-b4cb-48a3-900d-50838d67de61, "LOW_AvengeHagSurvivors", "HagBossFightStarted_ReadShroomsBook");

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_LOW_HagSurvivorsDialogs_PostHagTrulyDead(LOW_HagSurvivors_DisguisedJatloInstaDied_99b8ec9b-eb83-92b5-0a84-f1b4e1dcbed8);
DB_LOW_HagSurvivorsDialogs_PostHagTrulyDead(LOW_HagSurvivors_Kleidunn_b808f141-5299-a1da-2544-060f9a7a7e4a);
DB_LOW_HagSurvivorsDialogs_PostHagTrulyDead(LOW_HagSurvivors_Adrielle_b86566c4-3420-8842-a29e-19c0b72300dd);
DB_LOW_HagSurvivorsDialogs_PostHagTrulyDead(LOW_HagSurvivors_MaskedVictim1_9174eeda-dcfd-cdbc-c650-1bee3a363d30);
DB_LOW_HagSurvivorsDialogs_PostHagTrulyDead(LOW_HagSurvivors_SurrogateMother_Cured_f776ecd3-8e2a-2c91-645c-5a91e0f5d646);

IF
DialogStarted((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_HagSurvivorsDialogs_PostHagTrulyDead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_LOW_MayrinaIsPermaDefeated_Or_NotPresent()
THEN
PROC_LOW_AvengeHagSurvivors_QuestUpdate_NeverGotBreakHexQuest("TrulyKilledHag_NeverGotBreakHexQuest");

IF
DialogStarted((DIALOGRESOURCE)_Var1, (INTEGER)_Var2, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1, (DIALOGRESOURCE)_Var1)
AND
DB_LOW_HagSurvivorsDialogs_PostHagTrulyDead(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_LOW_MayrinaIsPermaDefeated_Or_NotPresent()
THEN
PROC_LOW_AvengeHagSurvivors_QuestUpdate_NeverGotBreakHexQuest("TrulyKilledHag_NeverGotBreakHexQuest_MayrinaPresent");

PROC
PROC_LOW_AvengeHagSurvivors_QuestUpdate_NeverGotBreakHexQuest((STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1, (STRING)_Var1)
AND NOT
DB_QuestIsOpened("LOW_AvengeHagSurvivors", _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_QuestIsAccepted("LOW_BreakHagHex", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_QuestUpdateIsUnlockedForAny("LOW_AvengeHagSurvivors", _Var1, _Var1, _Var1, _Var1)
THEN
QuestUpdate("LOW_AvengeHagSurvivors", _Var1);
PROC_LOW_AvengeHagSurvivors_CompletionSetup_NeverGotBreakHexQuest();

QRY
QRY_LOW_MayrinaIsPermaDefeated_Or_NotPresent()
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_LOW_MayrinaIsPermaDefeated_Or_NotPresent()
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMother_PermaDefeated_4391ae06-20bf-4e37-bbca-63519c550d0c, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_LOW_AvengeHagSurvivors_CompletionSetup_NeverGotBreakHexQuest()
THEN
NOT DB_QuestDef_State(LOW_HagSurvivors_State_KillHagQuestCompleted_300469ac-2022-4b4b-85f1-b611ba4abfee, "LOW_AvengeHagSurvivors", "ToldSurvivorsHagTrulyDead");
DB_QuestDef_State(LOW_HagSurvivors_State_KillHagQuestCompleted_300469ac-2022-4b4b-85f1-b611ba4abfee, "LOW_AvengeHagSurvivors", "TrulyKilledHag_NeverGotBreakHexQuest_TalkedToSurvivors");

IF
FlagSet(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, _, _, _, _)
AND
DB_QuestIsOpened("LOW_AvengeHagSurvivors", _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _, _, _, _)
AND
QRY_QuestUpdateIsUnlockedForAny("LOW_AvengeHagSurvivors", "HagPermaDefeated", _, _, _)
THEN
QuestUpdate("LOW_AvengeHagSurvivors", "EnteredEND_NoReportHagTrulyDead");

IF
FlagSet(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, _, _, _, _)
AND
DB_QuestIsOpened("LOW_AvengeHagSurvivors", _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsAllyInEND_3bb65bd3-a72f-4a43-a497-10b1501cd6a5, _, _, _, _)
AND NOT
QRY_QuestUpdateIsUnlockedForAny("LOW_AvengeHagSurvivors", "HagPermaDefeated", _, _, _)
THEN
QuestUpdate("LOW_AvengeHagSurvivors", "EnteredEND_NoHagTrulyDead");

IF
FlagSet(LOW_BlushingMermaid_State_PlayersReadHagInformantsNote_23cc4563-f336-4f9e-a83c-35fe8b8f8308, _, _, _, _)
AND NOT
DB_QuestIsAccepted("LOW_BreakHagHex", _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRevealed_aa751f69-f448-1436-c243-eb9f06a060ca, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "ReadHagsInformantNote");

IF
FlagSet(LOW_BlushingMermaid_State_PlayersReadHagInformantsNote_23cc4563-f336-4f9e-a83c-35fe8b8f8308, _, _, _, _)
AND NOT
DB_QuestIsAccepted("LOW_BreakHagHex", _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_HagRevealed_aa751f69-f448-1436-c243-eb9f06a060ca, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "ReadHagsInformantNote_HagRevealed");

IF
TemplateUseFinished((CHARACTER)_Var1, BOOK_LOW_AuntieEthelsRevenge_HagSurvivorsPoster_80162ccc-b7d6-437f-b727-53478594694f, _, 1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_PlayersReadHagSurvivorsPoster(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_QuestIsAccepted("LOW_BreakHagHex", _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_PlayersReadHagSurvivorsPoster(1);
QuestUpdate("LOW_BreakHagHex", "ReadHagSurvivorsPoster");

IF
TemplateUseFinished((CHARACTER)_Var1, BOOK_LOW_AuntieEthelsRevenge_SurvivorsEviction_13dd4822-68e1-4ccf-a0dd-4f83e986518c, _, 1, (CHARACTER)_Var1)
THEN
QuestUpdate("LOW_BreakHagHex", "ReadSurvivorsEvictionNotice");

IF
TemplateUseFinished((CHARACTER)_Var1, BOOK_LOW_AuntieEthelsRevenge_RelocationNote_15dd6e1a-df7a-4cf8-b189-6cfb580fd42b, _, 1, (CHARACTER)_Var1)
THEN
QuestUpdate("LOW_BreakHagHex", "ReadOldGarlowPointerNote");

IF
FlagSet(LOW_HagSurvivors_State_HagSpyAggroed_74eca7c7-e83b-4f07-ac32-beac7cd5eff7, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_DollDestroyed_e99c5e75-57c4-4a7a-be5c-0ce8e3724e60, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "JatloDroppedDisguise_NoHexBroken");

IF
FlagSet(LOW_HagSurvivors_State_HagSpyAggroed_74eca7c7-e83b-4f07-ac32-beac7cd5eff7, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_DollDestroyed_e99c5e75-57c4-4a7a-be5c-0ce8e3724e60, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "JatloDroppedDisguise_BrokeHex");

IF
FlagSet(LOW_HagSurvivors_State_HagSpyAggroed_74eca7c7-e83b-4f07-ac32-beac7cd5eff7, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "JatloDroppedDisguise_SurvivorsPermaDefeated");

IF
FlagSet(LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "HagSpyPermaDefeated_SurvivorsPermaDefeated");

IF
FlagSet(LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_DollDestroyed_e99c5e75-57c4-4a7a-be5c-0ce8e3724e60, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "HagSpyPermaDefeated_NoMayrina");

IF
FlagSet(LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_DollDestroyed_e99c5e75-57c4-4a7a-be5c-0ce8e3724e60, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "HagSpyPermaDefeated_BeforeDollDestroyed");

IF
FlagSet(LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "HagSpyPermaDefeated_BeforeMayrinaCured");

IF
FlagSet(LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c, _, _, _, _)
AND
DB_GlobalFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND
DB_GlobalFlag(LOW_HagSurvivors_State_SurrogateMotherCured_f76de6bd-5212-4fd5-beeb-5b05a41f55b7, _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "HagSpyPermaDefeated_AfterMayrinaCured");

IF
FlagSet(LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c, _, _, _, _)
AND NOT
DB_GlobalFlag(LOW_HagSurvivors_State_AllSurvivorsPermaDefeated_a400a1bf-add8-48c3-8b45-096e2b9fb233, _, _, _, _)
AND
DB_Players(_Var3, _, _, _, _)
THEN
DB_QuestDef_ChainedState("LOW_AvengeHagSurvivors", "AllSurvivorsPermaDefeated", "LOW_BreakHagHex", "AllSurvivorsPermaDefeated");

IF
FlagSet(LOW_HagSurvivors_State_HagSpy_PermaDefeated_e62f1c84-d463-4c2e-ba55-aa6e558ec43c, _, _, _, _)
AND NOT
DB_Destroyed(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a, _, _, _, _)
THEN
Die(S_LOW_HagSurvivors_VoodooDoll_5b0a0081-d158-4c19-8796-5628cc03672a);

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND
DB_QuestIsOpened("LOW_BreakHagHex", _, _, _, _)
AND NOT
QRY_LOW_PlayersKnowOldGarlows()
AND NOT
DB_LOW_PlayersTrulyKilledHagWithoutKnowingSurvivorsHideout(1, _, _, _, _)
THEN
DB_LOW_PlayersTrulyKilledHagWithoutKnowingSurvivorsHideout(1);
QuestUpdate("LOW_BreakHagHex", "HagPermaDefeated_CheckSurvivors_BarrenCoop");

QRY
QRY_LOW_PlayersKnowOldGarlows()
AND
DB_LOW_HagSurvivorsHideoutKnowledge_QuestUpdates(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_QuestUpdateIsUnlockedForAny("LOW_BreakHagHex", _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND
DB_QuestIsOpened("LOW_BreakHagHex", _, _, _, _)
AND NOT
DB_LOW_PlayersTrulyKilledHagWithoutKnowingSurvivorsHideout(1, _, _, _, _)
AND NOT
QRY_QuestUpdateIsUnlockedForAny("LOW_BreakHagHex", "JatloDroppedDisguise_SurvivorsPermaDefeated", _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "HagPermaDefeated_CheckSurvivors");

IF
FlagSet(LOW_BlushingMermaid_State_HagIsTrulyDead_c7c3e64d-dcfc-431b-a224-535a0c4a8e9c, _, _, _, _)
AND
DB_QuestIsOpened("LOW_BreakHagHex", _, _, _, _)
THEN
NOT DB_QuestDef_State(LOW_HagSurvivors_State_KillHagQuestCompleted_300469ac-2022-4b4b-85f1-b611ba4abfee, "LOW_AvengeHagSurvivors", "ToldSurvivorsHagTrulyDead");
DB_QuestDef_State(LOW_HagSurvivors_State_KillHagQuestCompleted_300469ac-2022-4b4b-85f1-b611ba4abfee, "LOW_BreakHagHex", "HagPermaDefeated_MetSurvivors");

IF
FlagSet(END_General_State_Started_a0fd5f91-e4b3-4d01-84d3-9ff484139e99, _, _, _, _)
AND
DB_QuestIsOpened("LOW_BreakHagHex", _, _, _, _)
THEN
QuestUpdate("LOW_BreakHagHex", "EnteredEND_QuestActive");

PROC
PROC_LOW_SetupHagRelatedReadables()
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
AND
DB_LOW_HagSurvivorsPresent_Readables(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

PROC
PROC_LOW_SetupHagRelatedReadables()
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
AND
DB_LOW_HagSurvivorsPresent_Readables(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 1);

PROC
PROC_LOW_SetupHagRelatedReadables()
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
THEN
TemplateAddTo(BOOK_LOW_AuntieEthelsRevenge_JatloLetter_eee34c26-063b-4011-9b8a-2efaba12da04, CONT_GEN_Mailbox_C_019_2ebacd72-0215-44d1-b683-028b5ae87a2d, 1);
TemplateAddTo(BOOK_LOW_AuntieEthelsRevenge_ResearchDraft_dd09726a-14d7-48b4-a215-0a33083f34fe, CONT_GEN_Chest_Common_B_Small_A_005_12eaa52e-6d32-49ac-a853-759b01c3c0d4, 1);
TemplateRemoveFrom(BOOK_LOW_HagSurvivors_AdrielleNoHagNotes_438862c5-5984-4e62-8ac1-3e0b0bdf8ea0, CONT_GEN_Chest_Common_B_Small_A_005_12eaa52e-6d32-49ac-a853-759b01c3c0d4, 1);

PROC
PROC_LOW_SetupHagRelatedReadables()
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
AND NOT
DB_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
THEN
TemplateAddTo(BOOK_LOW_HagSurvivors_HagSpysNote_97bfb610-9aa5-4183-bf60-972ad955b45a, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, 1);
TemplateAddTo(BOOK_LOW_BlushingMermaid_HagsInformantNote_785e14ea-78ad-4583-9268-a5e64354b481, S_LOW_BlushingMermaid_CaptainsTable_22fa5c73-4d3b-48da-9f61-a8dbf8ac6c27, 1);
TemplateRemoveFrom(BOOK_LOW_HagSurvivors_HagSpysNote_NoMayrina_658b0b6e-f60d-434c-8690-c2ea2b313f45, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, 1);
TemplateRemoveFrom(BOOK_LOW_BlushingMermaid_HagsInformantNote_NoMayrina_974a42f2-00a9-4753-ac67-e5053d06b69b, S_LOW_BlushingMermaid_CaptainsTable_22fa5c73-4d3b-48da-9f61-a8dbf8ac6c27, 1);
PROC_SetOnStage(BOOK_LOW_AuntieEthelsRevenge_AdrielleJournalMayrinaLeader_000_65a2aacb-639d-44e6-95a9-46f53a678a5e, 1);
PROC_SetOnStage(BOOK_LOW_AuntieEthelsRevenge_MayrinaContactLetter_000_d7f96c98-1b5b-407a-948d-0253d951caf4, 1);
PROC_SetOnStage(BOOK_LOW_AuntieEthelsRevenge_AdrielleJournalNoMayrina_000_eb73d969-cb4d-4510-8010-4d05fa9f696c, 0);

PROC
PROC_LOW_SetupHagRelatedReadables()
AND
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
AND
DB_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, _, _, _, _)
THEN
TemplateAddTo(BOOK_LOW_HagSurvivors_HagSpysNote_NoMayrina_658b0b6e-f60d-434c-8690-c2ea2b313f45, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, 1);
TemplateAddTo(BOOK_LOW_BlushingMermaid_HagsInformantNote_NoMayrina_974a42f2-00a9-4753-ac67-e5053d06b69b, S_LOW_BlushingMermaid_CaptainsTable_22fa5c73-4d3b-48da-9f61-a8dbf8ac6c27, 1);
TemplateRemoveFrom(BOOK_LOW_HagSurvivors_HagSpysNote_97bfb610-9aa5-4183-bf60-972ad955b45a, S_LOW_HagSurvivors_HagSpy_0cb0a73b-1f97-4481-b320-b8fff88cfe0f, 1);
TemplateRemoveFrom(BOOK_LOW_BlushingMermaid_HagsInformantNote_785e14ea-78ad-4583-9268-a5e64354b481, S_LOW_BlushingMermaid_CaptainsTable_22fa5c73-4d3b-48da-9f61-a8dbf8ac6c27, 1);
PROC_SetOnStage(BOOK_LOW_AuntieEthelsRevenge_AdrielleJournalMayrinaLeader_000_65a2aacb-639d-44e6-95a9-46f53a678a5e, 0);
PROC_SetOnStage(BOOK_LOW_AuntieEthelsRevenge_MayrinaContactLetter_000_d7f96c98-1b5b-407a-948d-0253d951caf4, 0);
PROC_SetOnStage(BOOK_LOW_AuntieEthelsRevenge_AdrielleJournalNoMayrina_000_eb73d969-cb4d-4510-8010-4d05fa9f696c, 1);

PROC
PROC_LOW_SetupHagRelatedReadables()
AND NOT
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
THEN
TemplateAddTo(BOOK_LOW_HagSurvivors_AdrielleNoHagNotes_438862c5-5984-4e62-8ac1-3e0b0bdf8ea0, CONT_GEN_Chest_Common_B_Small_A_005_12eaa52e-6d32-49ac-a853-759b01c3c0d4, 1);
TemplateRemoveFrom(BOOK_LOW_AuntieEthelsRevenge_JatloLetter_eee34c26-063b-4011-9b8a-2efaba12da04, CONT_GEN_Mailbox_C_019_2ebacd72-0215-44d1-b683-028b5ae87a2d, 1);
TemplateRemoveFrom(BOOK_LOW_AuntieEthelsRevenge_ResearchDraft_dd09726a-14d7-48b4-a215-0a33083f34fe, CONT_GEN_Chest_Common_B_Small_A_005_12eaa52e-6d32-49ac-a853-759b01c3c0d4, 1);

IF
FlagCleared(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, NULL_00000000-0000-0000-0000-000000000000, 0, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_ActI_HagSurvivors(_Var1, _Var2, _Var3, _Var1, _Var1)
THEN
PROC_SetOnStage(_Var1, 0);

IF
FlagSet(HAG_Hagspawn_Event_WifeHusbandLeave_c85ecfa6-472a-4200-fa39-1bb40b1338be, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetFlag(HAG_HagSpawn_Event_ResurrectedHusbandWithWand_939cfa41-11e0-4825-a1eb-b2ac5d26f0b8, NULL_00000000-0000-0000-0000-000000000000, 0);
PROC_LOW_UndeadHusbandSetup();
RealtimeObjectTimerLaunch(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, "LOW_SetupUndeadHusband_Timer", 1000);

IF
ObjectTimerFinished(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, "LOW_SetupUndeadHusband_Timer", _, _, _)
THEN
DB_LOW_UndeadHusbandSetupResurrected(1);
Resurrect(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);

IF
Resurrected(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, _, _, _, _)
AND
DB_LOW_UndeadHusbandSetupResurrected(1, _, _, _, _)
THEN
NOT DB_LOW_UndeadHusbandSetupResurrected(1);
NOT DB_PermaDefeated(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5);
DB_Dialogs(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, LOW_HagSurvivors_UndeadHusband_015571b8-a869-77fa-374d-c173fb9df480);

IF
FlagCleared(HAG_Hagspawn_Event_WifeHusbandLeave_c85ecfa6-472a-4200-fa39-1bb40b1338be, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_SetOnStage(S_HAG_Hagspawn_HusbandJake_133bf997-7c0d-4c64-88c9-9b9cd439dbb5, 0);

IF
FlagSet(LOW_HagSurvivors_Debug_MayrinaDiedInActI_331b726e-28cc-447f-8bec-6f3d9c8fc796, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearFlag(LOW_HagSurvivors_Debug_MayrinaDiedInActI_331b726e-28cc-447f-8bec-6f3d9c8fc796);
ClearFlag(HAG_Hagspawn_Event_WifeHusbandLeave_c85ecfa6-472a-4200-fa39-1bb40b1338be);
ClearFlag(LOW_BlushingMermaid_State_MayrinaIsInBG_670c57b7-f0f1-41f1-b9d6-ff192153c0b3);
ApplyStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "SILENCED", -1);
PROC_SetOnStage(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, 0);
DB_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);

IF
FlagSet(LOW_HagSurvivors_Debug_MayrinaSurvivedInActI_f6b10617-4258-41da-9545-a1ce89af71b8, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearFlag(LOW_HagSurvivors_Debug_MayrinaSurvivedInActI_f6b10617-4258-41da-9545-a1ce89af71b8);
RemoveStatus(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, "SILENCED");
NOT DB_PermaDefeated(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd);
NOT DB_LOW_ActI_HagSurvivors(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, S_LOW_HagSurvivors_SurrogateMotherSpot_6fc81c53-b113-4d70-b864-aa5e3aaec46d, LOW_HagSurvivors_SurrogateMother_Cured_f776ecd3-8e2a-2c91-645c-5a91e0f5d646);
DB_LOW_ActI_HagSurvivors(S_HAG_Hagspawn_SurrogateMother_08c970d7-3138-45e8-8965-68eadf4b07cd, S_LOW_HagSurvivors_SurrogateMotherSpot_6fc81c53-b113-4d70-b864-aa5e3aaec46d, LOW_HagSurvivors_SurrogateMother_Cured_f776ecd3-8e2a-2c91-645c-5a91e0f5d646);

IF
FlagSet(LOW_HagSurvivors_Debug_MaskOfRegetDiedInActI_d99e98ad-5d6d-4735-aa4b-c7743c260271, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
ClearFlag(LOW_HagSurvivors_Debug_MaskOfRegetDiedInActI_d99e98ad-5d6d-4735-aa4b-c7743c260271);
ApplyStatus(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, "SILENCED", -1);
PROC_SetOnStage(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, 0);
DB_PermaDefeated(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);

IF
FlagSet(LOW_HagSurvivors_Debug_MaskOfRegretSurvivedInActI_3e331ba3-0ccf-4b78-b809-daa24be9f80e, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
RemoveStatus(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, "SILENCED");
ClearFlag(LOW_HagSurvivors_Debug_MaskOfRegretSurvivedInActI_3e331ba3-0ccf-4b78-b809-daa24be9f80e);
NOT DB_PermaDefeated(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8);
NOT DB_LOW_ActI_HagSurvivors(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, S_LOW_HagSurvivors_HydrangeaSpot_8309f144-86d3-485a-be57-3dc4d623c78d, LOW_HagSurvivors_MaskedVictim1_9174eeda-dcfd-cdbc-c650-1bee3a363d30);
DB_LOW_ActI_HagSurvivors(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, S_LOW_HagSurvivors_HydrangeaSpot_8309f144-86d3-485a-be57-3dc4d623c78d, LOW_HagSurvivors_MaskedVictim1_9174eeda-dcfd-cdbc-c650-1bee3a363d30);

IF
FlagSet(LOW_HagSurvivors_Debug_QuestGrenade_decc423e-1dfb-4185-84ba-ec75602a2fd0, _, _, _, _)
AND
GetHostCharacter(_Var3, _, _, _, _)
THEN
ClearFlag(LOW_HagSurvivors_Debug_QuestGrenade_decc423e-1dfb-4185-84ba-ec75602a2fd0);
TemplateAddTo(LOW_RegenerationPrevention_Grenade_df5f8cbf-42c5-4c0d-a0ec-ce5046474d8e, _Var3, 1, 1);

IF
DB_SpotPlayers(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, "HAG_HagLair_MaskedVictim01", _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(S_HAG_Hag_MaskedVictim1_d2832662-4a12-4565-bfe2-094b93ae8af8, "HAG_HagLair_MaskedVictim01");

IF
DB_GlobalFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720, _, _, _, _)
THEN
PROC_LOW_SetupHagRelatedReadables();

PROC
PROC_GLO_DefeatCounter_AllPermaDefeated("LOW_HagSurvivors_SquatterBandits", _, _, _, _)
THEN
QuestUpdate("HIDDEN_CTY_Boosters", "LOW_HagSurvivors_DefeatSquatterBandits");

IF
TextEvent("LOW_HagSurvivor_Setup", _, _, _, _)
THEN
SetFlag(HAG_Hag_State_HagDefeated_7a1acad0-589f-ae02-f712-f0d24080d720);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3b"
