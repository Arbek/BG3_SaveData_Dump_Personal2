Version 1
SubGoalCombiner SGC_AND

INITSECTION
DB_LOW_Gondians(S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5);
DB_LOW_Gondians(S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc);
DB_LOW_Gondians(S_LOW_GondianWorker03_b28f2395-a5d4-4a4a-afcd-cddf9949a089);
DB_LOW_Gondians(S_LOW_GondianWorker04_6cc09c40-6b09-4e92-ad36-4e5ad72f7c43);
DB_LOW_Gondians(S_LOW_GondianWorker05_e86d2e9b-f55b-4eaf-9ba6-0245d17b6d1c);
DB_LOW_Gondians(S_LOW_GondianWorker06_53a85a70-979b-480a-afb1-ec8d9239e0f8);
DB_LOW_Gondians(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d);
DB_LOW_Gondians(S_LOW_GondianWorker09_2fb2c297-3c00-4b98-8412-41aea0087db5);
DB_LOW_Gondians(S_LOW_GondianWorker10_ffc8a25f-6ceb-4081-8e07-eca2205989c5);
DB_LOW_Gondians(S_LOW_GondianWoker_15_1eb9d68b-2d0d-4b62-ba8f-0d8b01f08b53);
DB_LOW_WorkroomGondians(S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5);
DB_LOW_WorkroomGondians(S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc);
DB_LOW_WorkroomGondians(S_LOW_GondianWorker03_b28f2395-a5d4-4a4a-afcd-cddf9949a089);
DB_PermaDefeatedEvent(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, LOW_SteelWatchFoundry_State_FundangoPermadefeated_8fbcef5a-d738-4a7a-be04-58e6ae551b9b);
DB_LOW_SteelWatchFoundry_LooseCollars(S_LOW_LooseCollar01_f35cdd25-5b06-4bff-a67d-56288cc18dbd);
DB_LOW_SteelWatchFoundry_LooseCollars(S_LOW_LooseCollar02_f3a5bf13-a91b-4c8e-a05a-1b7dd5624ca9);
DB_LOW_SteelWatchFoundry_LooseCollars(S_LOW_LooseCollar03_de4e5f21-7dd7-4d84-a01d-250c3e8a040e);
DB_LOW_Baneites(S_LOW_BaneiteOfficer01_db345b42-35f7-4a31-b5f4-1c4b86ebd25c);
DB_LOW_Baneites(S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418);
DB_LOW_Baneites(S_LOW_BaneiteOfficer03_71dbaf54-1274-4671-ae51-c7e512f02835);
DB_LOW_Baneites(S_LOW_BaneiteOfficer06_0ce716ac-f6fa-4b7d-8fda-456b0e74f90f);
DB_LOW_Baneites(S_LOW_BaneiteOfficer07_2dc326b9-73f4-40a6-af7f-54955e3b1ebd);
DB_LOW_Baneites(S_LOW_BaneiteOfficer08_015d02bd-0c8e-41c8-a6da-df92d71084d2);
DB_LOW_Baneites(S_LOW_BaneiteOfficer09_0c5259f6-3c86-4e84-b61e-42e9f31691ce);
DB_LOW_Baneites(S_LOW_BaneiteOfficer10_a2db5bf9-03a9-408e-971f-fc63741308bb);
DB_LOW_Baneites(S_LOW_BaneiteOfficer14_750a35b3-b0c5-4007-ae1a-4446c95a56ae);
DB_LOW_Baneites(S_LOW_BaneiteOfficer15_0b5a37de-60f3-403c-b5e8-b74afd50fa3d);
DB_LOW_Baneites(S_LOW_BaneiteOfficer16_38d84851-00b5-400c-81eb-7767a861e8e0);
DB_LOW_Baneites(S_LOW_BaneiteOfficer17_f6614259-eec4-4c38-b87b-cf5c806be6fd);
DB_LOW_Baneites(S_LOW_BaneiteOfficer18_f4a8f9e0-564c-41ed-8598-4c350b88f0e8);
DB_LOW_Baneites(S_LOW_BaneiteOfficer19_f5a48aa9-d67a-4fcd-9fe8-15e933314ca1);
DB_LOW_Baneites(S_LOW_BaneiteOfficer20_4b2f8018-f988-4dfd-bb59-962dc90070f3);
DB_LOW_Baneites(S_LOW_BaneiteOfficer21_9a64e678-c5aa-43ed-8765-33882e9f1ab9);
DB_LOW_Baneites(S_LOW_BaneiteOfficer_PostIRN01_36c0bb47-a8cc-4381-882b-a2ded38d0b5c);
DB_LOW_Baneites(S_LOW_BaneiteOfficer_PostIRN02_2cc225cf-794a-450a-bbb7-4b3400cb3c74);
DB_LOW_Baneites(S_LOW_LabRoomWatcher01_d48bb47b-7e55-45ab-ac19-708bd91e6eb4);
DB_LOW_Baneites(S_LOW_LabRoomWatcher02_c3117337-b9cb-455d-aaf2-15d69143acc8);
DB_LOW_Baneites(S_LOW_SteelWatcher_Prototype_51db791d-4378-448a-86ba-3e3ae2748db6);
DB_LOW_Baneites(S_LOW_SteelWatcher022_aca59fad-db3a-4d25-bfee-edbabff9da6a);
DB_LOW_Baneites(S_LOW_SteelWatcher023_a0594019-b0ed-46f8-a813-8be9379f0e8e);
DB_LOW_Baneites(S_LOW_SteelWatcherRanged_1c01c751-7ede-403e-a510-98cccc524e79);
DB_LOW_Baneites(S_LOW_SteelWatcher024_e1e3845f-89d4-41f3-a338-ec6a5b64b2b2);
DB_LOW_Baneites(S_LOW_SteelWatcher025_2c6cb9af-4d56-49c5-8324-17529bbfed6c);
DB_LOW_Baneites(S_LOW_SteelWatcher026_92c1d2f1-f1df-4a88-b599-7c0db7390ef9);
PROC_LOW_BaneitesEquipSwitches();
DB_GLO_CharacterCorpseDialog(S_LOW_BaniteOfficer01_db345b42-35f7-4a31-b5f4-1c4b86ebd25c, LOW_SteelWatchFoundry_SWD_BaniteOfficer01_af1bf298-1dac-d6d9-da70-5146f89efcfe);
DB_Dialogs(S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5, LOW_SteelWatchFoundry_GondianWorker01_3eb60328-1912-be93-811f-7827a1bc753c);
DB_Dialogs(S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc, LOW_SteelWatchFoundry_GondianWorker02_aa3e5839-4ec3-3680-538b-afdba7d0abf4);
DB_Dialogs(S_LOW_GondianWorker03_b28f2395-a5d4-4a4a-afcd-cddf9949a089, LOW_SteelWatchFoundry_GondianWorker03_ba8a62e5-5e44-c65a-f04c-1c5b9c8ee082);
DB_Dialogs(S_LOW_ScryScreen02_1d221b28-9a9b-482a-9ef0-4e65a0e60bc7, LOW_SteelWatchFoundry_ScryScreen2_2eb678aa-bcf0-cd3a-eebf-034623a496f4);
DB_Dialogs(S_LOW_GondianWorker08_3607ec31-f939-41aa-a7d2-e32f8c46979d, LOW_SteelWatchFoundry_GondianWorker08_Leader_9d7d9cf1-437a-bba8-b087-456483f85edc);
DB_HasItemEvent(S_WYR_Ironhand_RunepowderBomb_8b926cb4-9dd3-4bbf-8b76-9d628270cf1f, LOW_SteelWatchFoundry_State_HasBomb_8a262fbb-6d98-48cc-bebf-d52773eb38f7);
DB_GLO_CharacterCorpseDialog(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, LOW_SteelWatchFoundry_Dead_GondianWorker08_Leader_ce7d7d08-ac8a-33d9-e5be-8adbc7842478);
DB_ItemDialog_NarratorAD(S_LOW_LabLevelWarning_a4b80405-1411-4412-9de7-eb66adee13c7, LOW_SteelWatchFoundry_AD_LabLevelWarningPlaque_2dd97823-17d0-5004-99c3-5077c75d759a);
PROC_CharacterDisableCrime(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, "Steal");
PROC_TriggerRegisterForPlayers(S_LOW_FoundryGroundFloor_1a994e3a-d80d-478d-a452-b9100fdec719);
TriggerRegisterForCharacter(S_LOW_ZannerTurnsBackTrigger_17c2f52c-6c3c-4d9d-af1c-3afaede821d2, S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d);
PROC_SetOnStage(S_LOW_SteelWatchFoundry_Bomb_Placeholder_a02e5ea2-5843-432b-b55f-4a87e6378fef, 0);
PROC_TriggerRegisterForPlayers(S_LOW_WorkroomEncounterCineStartArea_a785fb75-de3e-4162-a679-1d6b8920dd65);
PROC_TriggerRegisterForPlayers(S_LOW_DeadMansSwitchThreatCineStartArea_9a2e2fde-2084-492e-9fd9-1485eb10a9da);
DB_GiveItemToEvent(S_LOW_DeadMansSwitch02_0dbbc23e-a6c1-4ebb-8f8b-495306813e1b, LOW_SteelWatchFoundry_Event_HandOverKillSwitch_a34ee3af-0338-434a-8fff-2a564f2bb204);
DB_SpotPlayers(S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5, "LOW_SteelWatchFoundry_WorkroomEncounter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc, "LOW_SteelWatchFoundry_WorkroomEncounter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_LOW_BaneiteOfficer17_f6614259-eec4-4c38-b87b-cf5c806be6fd, "LOW_SteelWatchFoundry_WorkroomEncounter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418, "LOW_SteelWatchFoundry_WorkroomEncounter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers(S_LOW_BaneiteOfficer03_71dbaf54-1274-4671-ae51-c7e512f02835, "LOW_SteelWatchFoundry_WorkroomEncounter", NULL_00000000-0000-0000-0000-000000000000, NULL_00000000-0000-0000-0000-000000000000);
DB_SpotPlayers_SpotTrigger(S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5, "LOW_SteelWatchFoundry_WorkroomEncounter", S_LOW_WorkroomEncounterCineStartArea_a785fb75-de3e-4162-a679-1d6b8920dd65);
DB_SpotPlayers_SpotTrigger(S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc, "LOW_SteelWatchFoundry_WorkroomEncounter", S_LOW_WorkroomEncounterCineStartArea_a785fb75-de3e-4162-a679-1d6b8920dd65);
DB_SpotPlayers_SpotTrigger(S_LOW_BaneiteOfficer17_f6614259-eec4-4c38-b87b-cf5c806be6fd, "LOW_SteelWatchFoundry_WorkroomEncounter", S_LOW_WorkroomEncounterCineStartArea_a785fb75-de3e-4162-a679-1d6b8920dd65);
DB_SpotPlayers_SpotTrigger(S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418, "LOW_SteelWatchFoundry_WorkroomEncounter", S_LOW_WorkroomEncounterCineStartArea_a785fb75-de3e-4162-a679-1d6b8920dd65);
DB_SpotPlayers_SpotTrigger(S_LOW_BaneiteOfficer03_71dbaf54-1274-4671-ae51-c7e512f02835, "LOW_SteelWatchFoundry_WorkroomEncounter", S_LOW_WorkroomEncounterCineStartArea_a785fb75-de3e-4162-a679-1d6b8920dd65);
DB_SceneManager(S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5, "LOW_SteelWatchFoundry_WorkroomEncounter");
DB_SceneManager(S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc, "LOW_SteelWatchFoundry_WorkroomEncounter");
DB_SceneManager(S_LOW_BaneiteOfficer17_f6614259-eec4-4c38-b87b-cf5c806be6fd, "LOW_SteelWatchFoundry_WorkroomEncounter");
DB_SceneManager(S_LOW_BaneiteOfficer03_71dbaf54-1274-4671-ae51-c7e512f02835, "LOW_SteelWatchFoundry_WorkroomEncounter");
DB_SceneManager(S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418, "LOW_SteelWatchFoundry_WorkroomEncounter");
DB_SceneTriggerManager("LOW_SteelWatchFoundry_WorkroomEncounter", S_LOW_WorkroomEncounterCineStartArea_a785fb75-de3e-4162-a679-1d6b8920dd65);
DB_SceneAllowAllDisturbances("LOW_SteelWatchFoundry_WorkroomEncounter");
DB_GlobalFlagReactionAfterDialog(LOW_SteelWatchFoundry_State_AllowedInWorkroom_5f50c96b-735a-4f02-8d77-bccc5030ba64, LOW_SteelWatchFoundry_WorkroomEncounter_36887f00-101d-96d8-0901-3bdfa90cd7c9);
PROC_SetOnStage(S_LOW_ElevatorToInstallRoom_a637edb4-a14c-47f8-a4b8-e900ea1af5a2, 0);
DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Down");
PROC_TriggerRegisterForParty(S_LOW_WorkroomElevatorZone_152eaa67-924a-4b25-bfff-5584fae9e576);
PROC_TriggerRegisterForParty(S_LOW_LabElevatorZone_79f50483-4256-4603-b948-1c80edf0029c);
PROC_TriggerRegisterForParty(S_LOW_WorkroomElevator_Jumpzone_aaef3a0e-9030-455d-bbe6-c954648dbb2d);
DB_LOW_SteelWatchFoundry_WorkroomBaneites(S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418);
DB_LOW_SteelWatchFoundry_WorkroomBaneites(S_LOW_BaneiteOfficer17_f6614259-eec4-4c38-b87b-cf5c806be6fd);
DB_LOW_SteelWatchFoundry_WorkroomBaneites(S_LOW_BaneiteOfficer03_71dbaf54-1274-4671-ae51-c7e512f02835);
DB_LOW_SteelWatchFoundry_SmallElevator_Stations(S_LOW_CargoElevator_Down_60392413-d364-4d4b-80c2-eb5ba4e3fb2f, S_LOW_CargoDoor_OutsideLever_f6f8ebcc-6249-4278-8874-e5bc2de105e6, "Down");
DB_LOW_SteelWatchFoundry_SmallElevator_Stations(S_LOW_CargoElevator_Up_80ea40a9-111a-4d45-9c7a-d4f2d4ef8208, S_LOW_CargoDoor_InsideLever_422413f8-37c0-40c5-b1fb-1e86f5c003ea, "Up");
DB_LOW_SteelWatchFoundry_SmallElevator_State("Down");
DB_LOW_SteelWatchFoundry_SmallElevator_Levers(S_LOW_CargoDoor_OutsideLever_f6f8ebcc-6249-4278-8874-e5bc2de105e6);
DB_LOW_SteelWatchFoundry_SmallElevator_Levers(S_LOW_CargoDoor_InsideLever_422413f8-37c0-40c5-b1fb-1e86f5c003ea);
DB_LOW_SteelWatchFoundry_SmallElevator_Levers(S_LOW_CargoDoor_ElevatorLever_507b9737-25af-4600-aabb-8fc4fb3103af);
DB_TrespassTrigger(S_LOW_OutsideTresspassArea01_d27f4e54-fb0b-44ac-922b-ceda691557a4, S_LOW_OutsideTressPassArea01_OutTrigger_6a7f78d7-08f6-4d74-85da-037fcba57c1d, "LOW_SteelWatchFoundry_Trespass");
DB_TrespassTrigger(S_LOW_OutsideTresspassArea02_d688cf2a-ba9b-46b2-8205-c01218527729, S_LOW_OutsideTressPassArea02_OutTrigger_c18b2c84-3b93-4eab-8d72-fd40bb0fc11f, "LOW_SteelWatchFoundry_Trespass");
DB_TrespassTrigger(S_LOW_OutsideTresspassArea03_3d06883b-c7d2-492a-af68-50b2e4897095, NULL_00000000-0000-0000-0000-000000000000, "LOW_SteelWatchFoundry_Trespass_Aggressive");
DB_PartyProgress_Trigger(S_LOW_SteelWatchFoundry_OuterArea_c54e1a1a-935f-41a6-9bbe-ed2326e79012, WYR_KillDirectorGortash_State_LocatedFoundry_b9a0e503-1a39-4a69-817c-0a360cbba210);
DB_TopicalGreeting(TG_LOW_SteelWatchFoudnry_e3f0e162-243a-49b2-bd5f-a750d170fab0);
DB_SteelWatchFoundry_SUBTRiggers(S_LOW_SteelWatchFoundry_GroundFloor_SUB_aad054dd-9b0e-4054-b411-bcc96a382bd8);
DB_SteelWatchFoundry_SUBTRiggers(S_LOW_SteelWatchFoundry_LabFloor_SUB_65a2f1d8-f8f9-41ae-b9b6-e561b6069af9);
DB_SteelWatchFoundry_SUBTRiggers(S_LOW_SteelWatchFoundry_ControlFloor_SUB_a77da59a-8e16-4d7c-8194-3ebaa89b6342);
DB_DialogBlockAttackButton(LOW_SteelWatchFoundry_Confrontation_AfterIRN_00ab0c07-17d9-a5b1-a900-9857bf839428);
DB_DialogBlockAttackButton(LOW_SteelWatchFoundry_DeadMansSwitchThreat_47d40827-597b-d211-395a-75429620f340);
DB_DialogBlockAttackButton(LOW_SteelWatchFoundry_WorkroomEncounter_36887f00-101d-96d8-0901-3bdfa90cd7c9);
DB_LOW_SteelWatchFoundry_AntechamberBaneties(S_LOW_BaneiteOfficer16_38d84851-00b5-400c-81eb-7767a861e8e0);
DB_LOW_SteelWatchFoundry_AntechamberBaneties(S_LOW_BaneiteOfficer01_db345b42-35f7-4a31-b5f4-1c4b86ebd25c);
DB_LOW_SteelWatchFoundry_OutsideWatchers(S_LOW_SteelWatcher025_2c6cb9af-4d56-49c5-8324-17529bbfed6c);
DB_LOW_SteelWatchFoundry_OutsideWatchers(S_LOW_SteelWatcher024_e1e3845f-89d4-41f3-a338-ec6a5b64b2b2);
DB_LOW_SteelWatchFoundry_OutsideWatchers(S_LOW_SteelWatcher026_92c1d2f1-f1df-4a88-b599-7c0db7390ef9);

KBSECTION
IF
TextEvent("LOW_Foundry_GiveCrossbowComponents", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_LOW_HarpoonCrossBowDiagram_433ff42d-9e81-47e9-a8ac-f0687d386507, _Var1, 1, 0, 1);
ToInventory(S_LOW_TargetingModule_c5af38b4-d96d-4c81-bf5f-aeea46e0d97e, _Var1, 1, 0, 1);
ToInventory(S_LOW_WatcherArm_cfc7a2cd-d5e7-4d54-8a2b-3a5ccb5949d2, _Var1, 1, 0, 1);

PROC
PROC_LOW_BaneitesEquipSwitches()
AND
DB_LOW_Baneites(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetItemByTemplateInInventory(QUEST_LOW_DeadMansSwitch_Shield_10d9e4a8-8019-47a9-88e3-dac74f7b8ae5, _Var1, _Var2, _Var1, _Var1)
AND
IsEquipped(_Var2, 0, _Var1, _Var1, _Var1)
THEN
Equip(_Var1, _Var2);

IF
DB_InRegion(_Var1, S_LOW_FoundryGroundFloor_1a994e3a-d80d-478d-a452-b9100fdec719, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
GetFlag(LOW_SteelWatchFoundry_State_FoundryVisited_5c929efe-ffe2-4eeb-8853-da29735b53ab, NULL_00000000-0000-0000-0000-000000000000, 1, _Var1, _Var1)
THEN
SetFlag(LOW_SteelWatchFoundry_State_FoundryVisited_5c929efe-ffe2-4eeb-8853-da29735b53ab);

IF
DB_GlobalFlag(LOW_SteelWatchFoundry_State_FundangoFollower_a3021d6d-9cc1-3545-54f3-53a35d44d89b, _Var1, _Var1, _Var1, _Var1)
AND
DB_DialogNPCs(_Var1, S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, _, _Var1, _Var1)
AND
DB_DialogPlayers(_Var1, _Var3, _, _Var1, _Var1)
THEN
AddPartyFollower(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, _Var3);
DB_LOW_SteelWatchFoundry_FundangoFollowerOf(_Var3);

IF
FlagCleared(LOW_SteelWatchFoundry_State_FundangoFollower_a3021d6d-9cc1-3545-54f3-53a35d44d89b, _, _, _, _)
AND
DB_LOW_SteelWatchFoundry_FundangoFollowerOf(_Var3, _, _, _, _)
THEN
RemovePartyFollower(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, _Var3);
NOT DB_LOW_SteelWatchFoundry_FundangoFollowerOf(_Var3);

IF
DB_PermaDefeated(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, _, _, _, _)
AND
DB_GlobalFlag(LOW_SteelWatchFoundry_State_FundangoFollower_a3021d6d-9cc1-3545-54f3-53a35d44d89b, _, _, _, _)
THEN
ClearFlag(LOW_SteelWatchFoundry_State_FundangoFollower_a3021d6d-9cc1-3545-54f3-53a35d44d89b);
ClearFlag(LOW_SteelWatchFoundry_State_ToobinWaitingToBeFollower_aba323fc-5ade-ebfc-a4e2-38947e78191c);

IF
DB_InRegion(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, S_LOW_ZannerTurnsBackTrigger_17c2f52c-6c3c-4d9d-af1c-3afaede821d2, _Var1, _Var1, _Var1)
AND
DB_LOW_SteelWatchFoundry_FundangoFollowerOf(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(LOW_SteelWatchFoundry_State_FundangoFollower_a3021d6d-9cc1-3545-54f3-53a35d44d89b);
SetFlag(LOW_SteelWatchFoundry_State_ToobinWaitingToBeFollower_aba323fc-5ade-ebfc-a4e2-38947e78191c);
PROC_LOW_SteelWatchFoundry_FundangoReturn();

QRY
QRY_CharInAnyFoundryTrigger((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SteelWatchFoundry_RoomTriggers(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_InRegion(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

PROC
PROC_WaypointTeleported((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SteelWatchFoundry_FundangoFollowerOf(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ClearFlag(LOW_SteelWatchFoundry_State_FundangoFollower_a3021d6d-9cc1-3545-54f3-53a35d44d89b);

PROC
PROC_LOW_SteelWatchFoundry_FundangoReturn()
AND NOT
QRY_CharInAnyFoundryTrigger(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, _, _, _, _)
THEN
PROC_CharacterMoveTo(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, S_LOW_FundangoSecurityOfficeLocation_7dba56b3-101e-4ac0-9a4a-5b11cda2cfa6, "Run", "");

IF
UseStarted((CHARACTER)_Var1, S_LOW_SecOfficeDesk_d54a335e-4fb1-4f7a-ac71-e21f0771587b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(IRN_IronThrone_State_RavengardPresent_2e102a34-500a-4cd2-ba93-51d1a8b96496, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_CensusDataSet", _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_LOW_IronThroneCensusData_NoRavengard_bebeba70-e34c-4547-a451-7249fee0f78e, S_LOW_SecOfficeDesk_d54a335e-4fb1-4f7a-ac71-e21f0771587b, 1, 0, 1);
ToInventory(S_LOW_IronThroneCensusData_b726be30-3fc6-4c6f-be47-bc65faf522bf, LOW_SteelWatchFoundry_AsylumChest_34e06174-ee14-40fe-9367-d63303ae86ee, 1, 0, 1);

IF
UseStarted((CHARACTER)_Var1, S_LOW_SecOfficeDesk_d54a335e-4fb1-4f7a-ac71-e21f0771587b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(IRN_IronThrone_State_RavengardPresent_2e102a34-500a-4cd2-ba93-51d1a8b96496, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_CensusDataSet", _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_LOW_IronThroneCensusData_b726be30-3fc6-4c6f-be47-bc65faf522bf, S_LOW_SecOfficeDesk_d54a335e-4fb1-4f7a-ac71-e21f0771587b, 1, 0, 1);
ToInventory(S_LOW_IronThroneCensusData_NoRavengard_bebeba70-e34c-4547-a451-7249fee0f78e, LOW_SteelWatchFoundry_AsylumChest_34e06174-ee14-40fe-9367-d63303ae86ee, 1, 0, 1);

IF
DB_LOW_Gondians(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_LOW_GondianWoker_15_1eb9d68b-2d0d-4b62-ba8f-0d8b01f08b53
THEN
DB_GLO_DefeatCounter(_Var1, "LOW_SteelWatchFoundry_Gondians");

PROC
PROC_GLO_DefeatCounter_AllDefeated("LOW_SteelWatchFoundry_Gondians", _, _, _, _)
THEN
SetFlag(LOW_SteelWatchFoundry_Status_AllGondiansDead_5d620b89-5101-402b-8424-8135c2f800d5);

PROC
PROC_GLO_DefeatCounter_Notify("LOW_SteelWatchFoundry_Gondians", (INTEGER)_Var1, (INTEGER)_Var2, (INTEGER)_Var3, (INTEGER)_Var1)
AND
IntegerSum(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
_Var4 != 0
AND
IntegerDivide(_Var1, 2, _Var5, _Var1, _Var1)
AND
_Var4 >= _Var5
AND NOT
DB_GlobalFlag(LOW_SteelWatchFoundry_State_MajorityGondiansDead_74e0d621-1910-4661-821b-b0ca522b3abe, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GlobalSetFlagAndCache(LOW_SteelWatchFoundry_State_MajorityGondiansDead_74e0d621-1910-4661-821b-b0ca522b3abe);

PROC
PROC_GLO_DefeatCounter_Notify("LOW_SteelWatchFoundry_Gondians", (INTEGER)_Var1, (INTEGER)_Var2, (INTEGER)_Var3, (INTEGER)_Var1)
AND
IntegerSum(_Var2, _Var3, _Var4, _Var1, _Var1)
AND
_Var4 != 0
AND
IntegerSubtract(_Var1, 1, _Var5, _Var1, _Var1)
AND
_Var4 >= _Var5
AND NOT
DB_Defeated(LOW_SteelWatchFoundry_GondianWorker08_Leader_9d7d9cf1-437a-bba8-b087-456483f85edc, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SteelWatchFoundry_State_AllGondiansButZannerDead_42485927-6585-fdfe-1433-3efbca97dc20);

PROC
PROC_GLO_DefeatCounter_Notify("LOW_SteelWatchFoundry_Gondians", (INTEGER)_Var1, (INTEGER)_Var2, (INTEGER)_Var3, (INTEGER)_Var1)
AND
_Var3 >= 1
AND
QRY_OnlyOnce("LOW_SteelWatchFoudnry_AnyGondiansDead_Registered", _Var1, _Var1, _Var1, _Var1)
THEN
DB_LOW_SteelWatchFoundry_AnyGondiansDied(1);

IF
DB_LOW_Gondians(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d
THEN
DB_LOW_SteelWatchFoundry_Collared(_Var1);

IF
TemplateEquipped(QUEST_LOW_SteelWatchFoundry_ExplodingCollar_47af23c3-7eb0-4a49-a4a4-f2ee5ab521c0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_LOW_SteelWatchFoundry_Collared(_Var1);

IF
TemplateUnequipped(QUEST_LOW_SteelWatchFoundry_ExplodingCollar_47af23c3-7eb0-4a49-a4a4-f2ee5ab521c0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
NOT DB_LOW_SteelWatchFoundry_Collared(_Var1);

IF
TemplateAddedTo(QUEST_LOW_SteelWatchFoundry_ExplodingCollar_47af23c3-7eb0-4a49-a4a4-f2ee5ab521c0, (ITEM)_Var1, (GUIDSTRING)_Var2, _, (ITEM)_Var1)
THEN
NOT DB_LOW_SteelWatchFoundry_LooseCollars(_Var1);
DB_LOW_SteelWatchFoundry_Carrier(_Var2);

IF
TemplateRemovedFrom(QUEST_LOW_SteelWatchFoundry_ExplodingCollar_47af23c3-7eb0-4a49-a4a4-f2ee5ab521c0, (ITEM)_Var1, (GUIDSTRING)_Var2, (ITEM)_Var1, (ITEM)_Var1)
THEN
DB_LOW_SteelWatchFoundry_LooseCollars(_Var1);
NOT DB_LOW_SteelWatchFoundry_Carrier(_Var2);

PROC
PROC_CharacterRegisterCrimeHandleIgnoresAfter((INTEGER)_Var1, _, _, _, (CHARACTER)_Var5)
AND
DB_LOW_Baneites(_Var5, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_Gondians(_Var6, _Var1, _Var1, _Var1, _Var1)
THEN
CrimeIgnoreCrime(_Var1, _Var6);

QRY
QRY_CorpseLooting_BlockMakeOwned((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_Baneites(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_Noop(1);

IF
DB_LOW_Gondians(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterDisableCrime(_Var1, "Trespassing");

IF
DB_InRegion(_Var1, S_LOW_DeadMansSwitchThreatCineStartArea_9a2e2fde-2084-492e-9fd9-1485eb10a9da, _Var1, _Var1, _Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("LOW_SteelWatchFoundry_DeadMansSwitchIntroduced", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog(LOW_SteelWatchFoundry_DeadMansSwitchThreat_47d40827-597b-d211-395a-75429620f340, S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5, S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc, S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418, S_LOW_BaneiteOfficer17_f6614259-eec4-4c38-b87b-cf5c806be6fd, _Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("LOW_SteelWatchFoundry_DeadMansSwitchIntroduced");
DB_LOW_SteelWatchFoundry_DeadManSwitchThreat_MainWatchingPlayer(_Var1);

PROC
PROC_StartDialog_AddExtraSpeakers(LOW_SteelWatchFoundry_DeadMansSwitchThreat_47d40827-597b-d211-395a-75429620f340, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_DialogAddSpeakingActorAt(_Var1, S_LOW_DeadMansSwitch02_0dbbc23e-a6c1-4ebb-8f8b-495306813e1b, 6);
PROC_DialogAddSpeakingActorAt(_Var1, S_LOW_BaneiteOfficer03_71dbaf54-1274-4671-ae51-c7e512f02835, 7);

IF
DialogStarted(LOW_SteelWatchFoundry_DeadMansSwitchThreat_47d40827-597b-d211-395a-75429620f340, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_LOW_SteelWatchFoundry_DeadManSwitchThreat_MainWatchingPlayer(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_SpeakerIsAvailableAndInDialogRange(_Var3, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddListeningActor(_Var1, _Var3);

IF
EnteredCombat((GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_LOW_WorkroomGondians(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(LOW_SteelWatchFoundry_State_WorkroomEncounterCombatEnd_1fe13fc8-90d8-44b7-61bb-2b8e0e24d70c);

PROC
PROC_SpotPlayers_Spotted(_, "LOW_SteelWatchFoundry_WorkroomEncounter", (CHARACTER)_Var2, _, _)
AND
DB_Players(_Var2, _, _, _, _)
AND NOT
DB_Defeated(S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418, _, _, _, _)
AND NOT
DB_OnlyOnce("LOW_SteelWatchFoundry_WorkroomEncounterPlayed", _, _, _, _)
AND
QRY_StartDialog(LOW_SteelWatchFoundry_WorkroomEncounter_36887f00-101d-96d8-0901-3bdfa90cd7c9, S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5, S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418, _Var2, _)
THEN
DB_OnlyOnce("LOW_SteelWatchFoundry_WorkroomEncounterPlayed");

IF
DialogStarted(LOW_SteelWatchFoundry_WorkroomEncounter_36887f00-101d-96d8-0901-3bdfa90cd7c9, _, _, _, _)
AND
DB_SpotPlayers(_Var2, "LOW_SteelWatchFoundry_WorkroomEncounter", _, _, _)
THEN
PROC_SpotPlayers_StopSpotting(_Var2, "LOW_SteelWatchFoundry_WorkroomEncounter");

IF
AttackedBy((CHARACTER)_Var1, (GUIDSTRING)_Var2, _, _, _, _, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SteelWatchFoundry_WorkroomBaneites(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Is_InCombat(_Var1, _, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SteelWatchFoundry_Banites_Workroom_1d8980ed-53a1-40ad-b0a5-346b5d3dc3d6, 0);
PROC_SetRelationToPlayers(ACT3_LOW_SteelWatchFoudnry_Banites_WorkroomWatchers_974319ca-0a71-4119-870d-3c1d27cae295, 0);

IF
EnteredCombat((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SteelWatchFoundry_WorkroomBaneites(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(LOW_SteelWatchFoundry_State_WorkroomGondiansPersuaded_b0a6f7b9-c045-4ba4-9799-45dabd422e02, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(IRN_IronThrone_State_Visited_5b3fb5a7-61e8-44a9-a0a1-b6b45b59a23c, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SteelWatchFoundry_Gondians_Workroom_e87e44b4-5646-4c3f-a3a8-d1b33adf68f9, 0);

IF
EnteredCombat((CHARACTER)_Var1, _, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_LOW_SteelWatchFoundry_WorkroomBaneites(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(LOW_SteelWatchFoundry_State_WorkroomGondiansPersuaded_b0a6f7b9-c045-4ba4-9799-45dabd422e02, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SteelWatchFoundry_Gondians_Workroom_e87e44b4-5646-4c3f-a3a8-d1b33adf68f9, 100);

IF
DialogEnded(LOW_SteelWatchFoundry_DeadMansSwitchThreat_47d40827-597b-d211-395a-75429620f340, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(LOW_SteelWatchFoundry_State_WitnessedKillSwitchThreat_785ddb91-187e-488e-93a3-c416c568b79d);

IF
EnteredCombat(S_LOW_DeadMansSwitch02_0dbbc23e-a6c1-4ebb-8f8b-495306813e1b, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(LOW_SteelWatchFoundry_State_ReturnedFromIronThrone_16f58dd6-71c1-41e8-b053-b32991ac8fa1, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_WorkroomGondians(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
SetRelation(ACT3_LOW_SteelWatchFoundry_Gondians_Workroom_e87e44b4-5646-4c3f-a3a8-d1b33adf68f9, ACT3_LOW_SteelWatchFoundry_Banites_Workroom_1d8980ed-53a1-40ad-b0a5-346b5d3dc3d6, 0);
PROC_SetRelationToPlayers(ACT3_LOW_SteelWatchFoundry_Gondians_Workroom_e87e44b4-5646-4c3f-a3a8-d1b33adf68f9, 50);

IF
EnteredCombat(S_LOW_DeadMansSwitch02_0dbbc23e-a6c1-4ebb-8f8b-495306813e1b, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_Players(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_WorkroomGondians(_Var3, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("LOW_SteelWatchFoundry_KillSwitchCombatInterruptDialog_Played", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(LOW_SteelWatchFoundry_SwitchWarningCombatInterrupt_edd391fd-29d6-ba45-4f5e-21de808023ca, S_LOW_DeadMansSwitch02_0dbbc23e-a6c1-4ebb-8f8b-495306813e1b, _Var3, _Var2, 0, 0, 0, 0, _Var1, _Var1)
THEN
DB_LOW_SteelWatchFoundry_KillSwitchCombatInterruptDialog_Player(_Var2);

IF
DialogStarted(LOW_SteelWatchFoundry_SwitchWarningCombatInterrupt_edd391fd-29d6-ba45-4f5e-21de808023ca, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
DB_Is_InCombat(S_LOW_DeadMansSwitch02_0dbbc23e-a6c1-4ebb-8f8b-495306813e1b, _Var2, _Var1, _Var1, _Var1)
AND
DB_Players(_Var3, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var3, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_LOW_SteelWatchFoundry_KillSwitchCombatInterruptDialog_Player(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DialogAddListeningActor(_Var1, _Var3);

IF
DialogStarted(LOW_SteelWatchFoundry_WorkroomEncounter_36887f00-101d-96d8-0901-3bdfa90cd7c9, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_SceneOver("LOW_SteelWatchFoundry_WorkroomEncounter");

IF
DialogStarted(LOW_SteelWatchFoundry_SwitchWarningCombatInterrupt_edd391fd-29d6-ba45-4f5e-21de808023ca, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
SetFlag(LOW_SteelWatchFoundry_State_AlternateWorkBehaviour_1cbf2ff3-53d9-48bb-b634-5d9c259b8056, S_LOW_GondianWorker01_92010ea3-cd5e-4896-97fc-1f1e7942fcf5);
SetFlag(LOW_SteelWatchFoundry_State_AlternateWorkBehaviour_1cbf2ff3-53d9-48bb-b634-5d9c259b8056, S_LOW_GondianWorker02_a13a0681-de86-45f2-922c-85cb1fad1cfc);
SetFlag(LOW_SteelWatchFoundry_State_AlternateWorkBehaviour_1cbf2ff3-53d9-48bb-b634-5d9c259b8056, S_LOW_GondianWorker03_b28f2395-a5d4-4a4a-afcd-cddf9949a089);

IF
DB_GlobalFlag(LOW_SteelWatchFoundry_State_AllowedInWorkroom_5f50c96b-735a-4f02-8d77-bccc5030ba64, _, _, _, _)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SteelWatchFoudnry_Banites_WorkroomWatchers_974319ca-0a71-4119-870d-3c1d27cae295, 50);
DB_Dialogs(S_LOW_BaneiteOfficer02_de084b09-99c6-426e-9159-f692d180d418, LOW_SteelWatchFoundry_BaneiteOfficer02_9d419d0e-3c42-2e9c-56e0-1cb3132c9f40);
DB_Dialogs(S_LOW_BaneiteOfficer17_f6614259-eec4-4c38-b87b-cf5c806be6fd, LOW_SteelWatchFoundry_BaneiteOfficer17_61115931-eacd-962e-1f63-b4aa57538d30);
DB_Dialogs(S_LOW_BaneiteOfficer03_71dbaf54-1274-4671-ae51-c7e512f02835, LOW_SteelWatchFoundry_BaneiteOfficer03_9d92a2ea-d253-f712-1edd-5994bc41590f);
PROC_SteelWatchFoundry_AntechamberBaneitesLeave();
PROC_SteelWatchFoundry_OutsideWatchersLeave();

PROC
PROC_SteelWatchFoundry_AntechamberBaneitesLeave()
AND
DB_LOW_SteelWatchFoundry_AntechamberBaneties(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 0, "");

PROC
PROC_SteelWatchFoundry_OutsideWatchersLeave()
AND
DB_LOW_SteelWatchFoundry_OutsideWatchers(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Defeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_DisappearOutOfSight(_Var1, "Run", 0, "");

PROC
PROC_SceneInterrupted(_, _, "LOW_SteelWatchFoundry_WorkroomEncounter", (STRING)_Var3, _)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _, _, _, _)
THEN
PROC_SetRelationToPlayers(ACT3_LOW_SteelWatchFoundry_Banites_Workroom_1d8980ed-53a1-40ad-b0a5-346b5d3dc3d6, 0);

PROC
PROC_SceneOver("LOW_SteelWatchFoundry_WorkroomEncounter", _, _, _, _)
THEN
SetFlag(LOW_SteelWatchFoundry_State_LowaWorking_2194447d-7b32-44c3-a760-2afcb95e26de);

IF
UseStarted(_, S_LOW_LabElevator_Lever_8bdb7ff9-32e1-4628-a39c-f976328267dc, _, _, _)
AND
DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Down", _, _, _, _)
THEN
PROC_LOW_SteelWatchFoundry_WorkroomElevatorUp();

IF
UseStarted(_, S_LOW_WorkRoomElevator_Lever_ed121edc-6bad-4be9-8fd6-badce076f1e3, _, _, _)
AND
DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Up", _, _, _, _)
THEN
PROC_LOW_SteelWatchFoundry_WorkroomElevatorDown();

IF
UseStarted(_, S_LOW_ElevatorLever_9bffd091-34f5-4f86-9530-3c3eff20a13a, _, _, _)
AND
DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Down", _, _, _, _)
THEN
PROC_LOW_SteelWatchFoundry_WorkroomElevatorUp();

IF
UseStarted(_, S_LOW_ElevatorCallToLabLever_bc092633-8245-4df6-9031-d7e3eaadee1f, _, _, _)
AND
DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Up", _, _, _, _)
THEN
PROC_LOW_SteelWatchFoundry_WorkroomElevatorDown();

PROC
PROC_LOW_SteelWatchFoundry_WorkroomElevatorUp()
AND
DB_InRegion(_Var1, S_LOW_LabElevatorZone_79f50483-4256-4603-b948-1c80edf0029c, _Var1, _Var1, _Var1)
THEN
DB_LOW_SteelWatchFoundry_ElevatorTravellingCharacters(_Var1);

PROC
PROC_LOW_SteelWatchFoundry_WorkroomElevatorUp()
THEN
LoadLevelTemplate(S_LOW_ElevatorWorkroomInstance_567ef4ea-15f9-4bbd-885b-799ced777dd1);
DB_LOW_SteelWatchFoundry_ElevatorTemplateToUnload(S_LOW_ElevatorLabInstance_cde6a60b-bf4c-4f64-ba22-3b4c112d5770);

PROC
PROC_LOW_SteelWatchFoundry_WorkroomElevatorDown()
AND
DB_InRegion(_Var1, S_LOW_WorkroomElevatorZone_152eaa67-924a-4b25-bfff-5584fae9e576, _Var1, _Var1, _Var1)
THEN
DB_LOW_SteelWatchFoundry_ElevatorTravellingCharacters(_Var1);

PROC
PROC_LOW_SteelWatchFoundry_WorkroomElevatorDown()
THEN
LoadLevelTemplate(S_LOW_ElevatorLabInstance_cde6a60b-bf4c-4f64-ba22-3b4c112d5770);
DB_LOW_SteelWatchFoundry_ElevatorTemplateToUnload(S_LOW_ElevatorWorkroomInstance_567ef4ea-15f9-4bbd-885b-799ced777dd1);

PROC
PROC_LOW_SteelWatchFoundry_Elevator_TeleportCharactersTo((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND NOT
DB_LOW_SteelWatchFoundry_ElevatorTravellingCharacters(_, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_SteelWatchFoundry_ElevatorTemplateToUnload(_Var3, _Var1, _Var1, _Var1, _Var1)
THEN
UnloadLevelTemplate(_Var3);
NOT DB_LOW_SteelWatchFoundry_ElevatorTemplateToUnload(_Var3);

PROC
PROC_LOW_SteelWatchFoundry_Elevator_TeleportCharactersTo((TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
AND
DB_LOW_SteelWatchFoundry_ElevatorTravellingCharacters(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_LOW_SteelWatchFoundry_ElevatorTravellingCharacters(_Var2);
TeleportTo(_Var2, _Var1, "LOW_SteelWatchFoundry_BigElevator_Teleported", 1, 1, 1, 1, 1);

IF
EntityEvent(_, "LOW_SteelWatchFoundry_BigElevator_Teleported", _, _, _)
AND NOT
DB_LOW_SteelWatchFoundry_ElevatorTravellingCharacters(_, _, _, _, _)
AND
DB_LOW_SteelWatchFoundry_ElevatorTemplateToUnload(_Var3, _, _, _, _)
THEN
UnloadLevelTemplate(_Var3);
NOT DB_LOW_SteelWatchFoundry_ElevatorTemplateToUnload(_Var3);

IF
UseFinished(_, BLD_Foundry_Elevator_A_Cage_A_000_ff5b397e-c5ac-4b0f-9bd7-b2416dc53f2d, 1, (CHARACTER)_, (CHARACTER)_)
THEN
PROC_LOW_SteelWatchFoundry_WorkroomElevatorUp();

IF
UseFinished(_, BLD_Foundry_Elevator_A_Cage_A_000_ff5b397e-c5ac-4b0f-9bd7-b2416dc53f2d, 1, (CHARACTER)_, (CHARACTER)_)
THEN
PROC_LOW_SteelWatchFoundry_WorkroomElevatorDown();

PROC
PROC_LOW_SteelWatchFoundry_WorkroomElevatorUp()
AND
GetPosition(S_LOW_LabElevator_TopPos_295b07f4-84f6-4e15-9ee5-e7e8682f1d92, _Var1, _Var2, _Var3, _Var1)
THEN
NOT DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Down");
PlatformMoveTo(S_LOW_ElevatorLabInstance_cde6a60b-bf4c-4f64-ba22-3b4c112d5770, _Var1, _Var2, _Var3, 3, "LOW_SteelWatchFoundry_ElevatorMoved_Lab_UP", 1);

IF
PlatformMovementFinished(S_LOW_ElevatorLabInstance_cde6a60b-bf4c-4f64-ba22-3b4c112d5770, "LOW_SteelWatchFoundry_ElevatorMoved_Lab_UP", (REAL)_Var1, (REAL)_Var1, (REAL)_Var1)
AND
GetPosition(S_LOW_WorkroomElevatorUpPosition_9b1cc22f-92cc-4817-a45b-70d969193bda, _Var1, _Var2, _Var3, _Var1)
THEN
PROC_LOW_SteelWatchFoundry_Elevator_TeleportCharactersTo(S_LOW_WorkroomElevator_DownPos_81001eed-8e17-414a-814e-eaf043cb0841);
PlatformMoveTo(S_LOW_ElevatorWorkroomInstance_567ef4ea-15f9-4bbd-885b-799ced777dd1, _Var1, _Var2, _Var3, 3, "LOW_SteelWatchFoundry_ElevatorMoved_Workroom_UP", 1);

IF
PlatformMovementFinished(S_LOW_ElevatorWorkroomInstance_567ef4ea-15f9-4bbd-885b-799ced777dd1, "LOW_SteelWatchFoundry_ElevatorMoved_Workroom_UP", _, _, _)
THEN
DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Up");
PROC_TriggerUnregisterForParty(S_LOW_WorkroomElevatorZone_152eaa67-924a-4b25-bfff-5584fae9e576);
RealtimeObjectTimerLaunch(S_LOW_WorkroomElevatorZone_152eaa67-924a-4b25-bfff-5584fae9e576, "LOW_SteelWatchFoundry_ReRegisterElevatorTrigger", 200);

IF
ObjectTimerFinished((TRIGGER)_Var1, "LOW_SteelWatchFoundry_ReRegisterElevatorTrigger", (TRIGGER)_Var1, (TRIGGER)_Var1, (TRIGGER)_Var1)
THEN
PROC_TriggerRegisterForParty(_Var1);

IF
PlatformMovementFinished(S_LOW_ElevatorWorkroomInstance_567ef4ea-15f9-4bbd-885b-799ced777dd1, "LOW_SteelWatchFoundry_ElevatorMoved_Workroom_UP", _, _, _)
AND
QRY_OnlyOnce("LOW_SteelWatchFoundry_WorkroomElevator_FirsttimeUp", _, _, _, _)
THEN
Open(S_LOW_ElevatorGate_41ee393f-0463-47e6-8751-e5073fbb9b75);

PROC
PROC_LOW_SteelWatchFoundry_WorkroomElevatorDown()
AND
GetPosition(S_LOW_WorkroomElevator_DownPos_81001eed-8e17-414a-814e-eaf043cb0841, _Var1, _Var2, _Var3, _Var1)
THEN
NOT DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Up");
PlatformMoveTo(S_LOW_ElevatorWorkroomInstance_567ef4ea-15f9-4bbd-885b-799ced777dd1, _Var1, _Var2, _Var3, 3, "LOW_SteelWatchFoundry_ElevatorMoved_WorkRoom_Down", 1);

IF
PlatformMovementFinished(S_LOW_ElevatorWorkroomInstance_567ef4ea-15f9-4bbd-885b-799ced777dd1, "LOW_SteelWatchFoundry_ElevatorMoved_WorkRoom_Down", (REAL)_Var1, (REAL)_Var1, (REAL)_Var1)
AND
GetPosition(S_LOW_LabElevator_BottomPos_954d268e-8f20-4f32-9851-350771a3b4b1, _Var1, _Var2, _Var3, _Var1)
THEN
PROC_LOW_SteelWatchFoundry_Elevator_TeleportCharactersTo(S_LOW_LabElevator_TopPos_295b07f4-84f6-4e15-9ee5-e7e8682f1d92);
PlatformMoveTo(S_LOW_ElevatorLabInstance_cde6a60b-bf4c-4f64-ba22-3b4c112d5770, _Var1, _Var2, _Var3, 3, "LOW_SteelWatchFoundry_ElevatorMoved_Lab_Down", 1);

IF
PlatformMovementFinished(S_LOW_ElevatorLabInstance_cde6a60b-bf4c-4f64-ba22-3b4c112d5770, "LOW_SteelWatchFoundry_ElevatorMoved_Lab_Down", _, _, _)
THEN
DB_LOW_SteelWatchFoundry_WorkroomElevatorState("Down");
PROC_TriggerUnregisterForParty(S_LOW_LabElevatorZone_79f50483-4256-4603-b948-1c80edf0029c);
RealtimeObjectTimerLaunch(S_LOW_LabElevatorZone_79f50483-4256-4603-b948-1c80edf0029c, "LOW_SteelWatchFoundry_ReRegisterElevatorTrigger", 200);

IF
UseStarted(_, (ITEM)_Var2, _, _, _)
AND
DB_LOW_SteelWatchFoundry_SmallElevator_Levers(_Var2, _, _, _, _)
AND NOT
DB_LOW_SteelWatchFoundry_SmallCargoElevator_Moving(1, _, _, _, _)
AND
DB_LOW_SteelWatchFoundry_SmallElevator_State("Down", _, _, _, _)
THEN
PROC_LOW_SteelWatchFoundry_SmallCargoElevator_MoveUp();

IF
UseStarted(_, (ITEM)_Var2, _, _, _)
AND
DB_LOW_SteelWatchFoundry_SmallElevator_Levers(_Var2, _, _, _, _)
AND NOT
DB_LOW_SteelWatchFoundry_SmallCargoElevator_Moving(1, _, _, _, _)
AND
DB_LOW_SteelWatchFoundry_SmallElevator_State("Up", _, _, _, _)
THEN
PROC_LOW_SteelWatchFoundry_SmallCargoElevator_MoveDown();

PROC
PROC_LOW_SteelWatchFoundry_SmallCargoElevator_MoveUp()
AND
DB_LOW_SteelWatchFoundry_SmallElevator_Stations(_Var1, _, "Up", _Var1, _Var1)
AND
GetPosition(_Var1, _Var3, _Var4, _Var5, _Var1)
THEN
PlatformMoveTo(LT_PLT_BGH_SteelWatchFoundry_CartElevator_a1294b2d-94fa-4cea-96dc-a6eeb5a4aed6, _Var3, _Var4, _Var5, 1, "LOW_SteelWatchFoundy_ElevatorUp", 1);
NOT DB_LOW_SteelWatchFoundry_SmallElevator_State("Down");
DB_LOW_SteelWatchFoundry_SmallCargoElevator_Moving(1);

IF
PlatformMovementFinished(_, "LOW_SteelWatchFoundy_ElevatorUp", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_LOW_SteelWatchFoundry_SmallElevator_State("Up");
NOT DB_LOW_SteelWatchFoundry_SmallCargoElevator_Moving(1);
Open(S_LOW_CargoDoor_3e11bdba-dd79-442d-9c6d-ce2059cb1307);

PROC
PROC_LOW_SteelWatchFoundry_SmallCargoElevator_MoveDown()
AND
DB_LOW_SteelWatchFoundry_SmallElevator_Stations(_Var1, _, "Down", _Var1, _Var1)
AND
GetPosition(_Var1, _Var3, _Var4, _Var5, _Var1)
THEN
PlatformMoveTo(LT_PLT_BGH_SteelWatchFoundry_CartElevator_a1294b2d-94fa-4cea-96dc-a6eeb5a4aed6, _Var3, _Var4, _Var5, 1, "LOW_SteelWatchFoundy_ElevatorDown", 1);
NOT DB_LOW_SteelWatchFoundry_SmallElevator_State("Up");
DB_LOW_SteelWatchFoundry_SmallCargoElevator_Moving(1);

IF
PlatformMovementFinished(_, "LOW_SteelWatchFoundy_ElevatorDown", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
DB_LOW_SteelWatchFoundry_SmallElevator_State("Down");
NOT DB_LOW_SteelWatchFoundry_SmallCargoElevator_Moving(1);

IF
TurnStarted(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, _, _, _, _)
AND
QRY_OnlyOnce_Reset("LOW_SteelWatchFoundry_FundangoEncouragement", _, _, _, _)
AND
DB_GlobalFlag(LOW_SteelWatchFoundry_State_FundangoFollower_a3021d6d-9cc1-3545-54f3-53a35d44d89b, _, _, _, _)
AND
DB_Is_InCombat(S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d, _Var1, _Var1, _Var1, _Var1)
AND
DB_Is_InCombat(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_LOW_Gondians(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var2 != S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d
AND
QRY_OnlyOnce("LOW_SteelWatchFoundry_FundangoEncouragement", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TryStartAD(LOW_SteelWatchFoundry_AD_GondianLeaderEncouragement_95b76a29-f938-3288-b042-61a888cb97d1, S_LOW_GondianWorker08_Leader_3607ec31-f939-41aa-a7d2-e32f8c46979d);

IF
DB_SteelWatchFoundry_SUBTRiggers(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_TopicalGreetingEndCondition_LeaveTrigger(TG_LOW_SteelWatchFoudnry_e3f0e162-243a-49b2-bd5f-a750d170fab0, _Var1);

IF
EnteredTrigger((CHARACTER)_Var1, (TRIGGER)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_SteelWatchFoundry_SUBTRiggers(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_TopicalGreeting_UnlockTopic(TG_LOW_SteelWatchFoundry_e3f0e162-243a-49b2-bd5f-a750d170fab0);


EXITSECTION
ENDEXITSECTION

ParentTargetEdge "Act3b"
