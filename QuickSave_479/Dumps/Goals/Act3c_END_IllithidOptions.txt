Version 1
SubGoalCombiner SGC_AND

INITSECTION
TeleportToPosition(S_EmperorRevealed_GlobeOfDomination_Small_8950891c-ad3a-434c-a463-615b5ab90ea7, -1919, 0, 2687);
SetOnStage(S_EmperorRevealed_GlobeOfDomination_Small_8950891c-ad3a-434c-a463-615b5ab90ea7, 0);
TeleportToPosition(S_END_OrbBoundHelper_002_d825c26a-6004-4dcb-acbc-1de1fa678762, 50.194, -25.149, 3241.005);
TeleportToPosition(S_END_OrbBoundHelper_005_c3ea9213-82f4-4b51-8f97-8528bf9d751e, 50.351, -25.065, 3239.638);
TeleportToPosition(S_END_OrbBoundHelper_006_e2c0aeac-b48f-4108-bff3-bfa5be31654c, 50.307, -25.234, 3241.988);
TeleportToPosition(S_END_OrbBoundHelper_008_13317d06-bd74-43eb-9f18-0ca72ca06353, 51.752, -25.149, 3239.204);
DB_END_IllithiOptions_GlobalNPC(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
DB_END_IllithiOptions_GlobalNPC(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
DB_END_IllithiOptions_GlobalNPC(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);
DB_AutoSaveTrigger(S_END_AstralPlaneAutoSave_084d3ab1-ecf9-4da0-963c-cb630a8a8c2d);
DB_AutoSaveTrigger(S_END_SkullAutoSaveBox_36d8afba-d4cd-4a2a-8118-44383b801875);
DB_PermaDefeatedEvent(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, END_IllithidOptions_State_EmperorPermaDefeated_784fecdf-4d89-4e03-9cea-8fa45e1b2897);
DB_AddCharactersInTriggerToDialog(END_IllithidOptions_EmperorProposal_6769199a-452f-5a13-9178-55a899cccf59, S_END_AstralArrivalDialogBox_0101ab36-a4fa-4f52-866a-443d3608f436, 1, 1, 1);
DB_DropMutingStatussesDialog(END_IllithidOptions_EmperorProposal_6769199a-452f-5a13-9178-55a899cccf59);
DB_AddCharactersInTriggerToDialog(END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb, S_END_AssimilationAndFreedDialogBox_2d0e6a22-6370-44c3-98e5-ede4a0d18704, 1, 1, 1);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_TadpoleGroupDiscussion_55831e5e-9916-4099-a397-37f5e6967d2e, END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0, END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0, END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_PlayerOpenedExitPortal_fe639a62-2f2f-441e-a2dc-00761cf7cca3, END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_OrpheusPathLaezelConfrontation_8b03c077-037b-49d4-a8d5-0c50643a5b07, END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb);
SetOnStage(S_END_ResolutionExitPortal_Illithid_2a62d420-290b-47e5-a224-71b5cda70f50, 0);
SetOnStage(S_END_ResolutionExitPortal_Orpheus_b86aadd0-1cdd-460b-8c02-63c01a9a612e, 0);
PROC_TriggerRegisterForParty(S_END_AssimilationAndFreedDialogBox_2d0e6a22-6370-44c3-98e5-ede4a0d18704);
DB_END_IllithidOptions_ExitPortals(S_END_ResolutionExitPortal_Illithid_2a62d420-290b-47e5-a224-71b5cda70f50);
DB_END_IllithidOptions_ExitPortals(S_END_ResolutionExitPortal_Orpheus_b86aadd0-1cdd-460b-8c02-63c01a9a612e);
SetCanJoinCombat(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 0);
SetCanJoinCombat(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 1);
PROC_CharacterDisableAllCrimes(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
TriggerRegisterForCharacter(S_END_MorphicPool_SUB_5a646d13-e9bb-42f0-84e6-1f8fad2bef81, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
TriggerRegisterForCharacter(S_END_MorphicPool_SUB_5a646d13-e9bb-42f0-84e6-1f8fad2bef81, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
TriggerRegisterForCharacter(S_END_MorphicPool_SUB_5a646d13-e9bb-42f0-84e6-1f8fad2bef81, S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);
TriggerRegisterForCharacter(S_END_EmperorImmortalArea_80996c6e-72ff-43be-a2f1-53a2f87e929b, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
PROC_TriggerRegisterForPlayers(S_END_AstralArrivalDialogBox_0101ab36-a4fa-4f52-866a-443d3608f436);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_AcceptedRaphaelDeal_c4d409ef-d70e-9934-edf2-d6bd66201c19, END_IllithidOptions_RaphaelLastChance_e8b41315-b35c-5c7a-e3be-e921cd0c8741);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_RejectedRaphael_b2e6764d-828b-b125-3e9a-365d5fd9737b, END_IllithidOptions_RaphaelLastChance_e8b41315-b35c-5c7a-e3be-e921cd0c8741);
SetDetached(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 1);
ApplyStatus(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "INT_ORPHEUS_INFERNALBINDSANIM", -1, 1, NULL_00000000-0000-0000-0000-000000000000);
ApplyStatus(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "INT_INFERNALCHAINS_LEFT", -1, 0, S_END_CrystalShakle_002_75024e98-273c-4967-826c-470ca7ca7879);
ApplyStatus(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "INT_INFERNALCHAINS_RIGHT", -1, 0, S_END_CrystalShakle_001_ce41cb70-e763-460c-a368-61011365e589);
SetDoNotFaceFlag(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 1);
DB_Dialogs(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
DB_END_IllithidOptions_CrystalShackles(S_END_CrystalShakle_001_ce41cb70-e763-460c-a368-61011365e589, "INT_INFERNALCHAINS_RIGHT");
DB_END_IllithidOptions_CrystalShackles(S_END_CrystalShakle_002_75024e98-273c-4967-826c-470ca7ca7879, "INT_INFERNALCHAINS_LEFT");
DB_DialogBlockAttackButton(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_001_039dae0a-8a9c-4ad2-a6c6-432bd8b4799f);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_007_d759dc68-a77e-450a-a8c3-773f4a164527);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_008_13317d06-bd74-43eb-9f18-0ca72ca06353);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_002_d825c26a-6004-4dcb-acbc-1de1fa678762);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_003_4bdb1d7a-884f-4d88-9bd2-0016379b6eb9);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_004_66a7c046-ecc5-4923-81d9-0c696a841e5b);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_005_c3ea9213-82f4-4b51-8f97-8528bf9d751e);
DB_END_IllithidOptions_OrbBounds(S_END_OrbBoundHelper_006_e2c0aeac-b48f-4108-bff3-bfa5be31654c);
DB_END_IllithidOptions_LaezelBetraylCombatID(NULL_00000000-0000-0000-0000-000000000000);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_OrpheusPathLaezelConfrontation_8b03c077-037b-49d4-a8d5-0c50643a5b07, END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_OrpheusPathLaezelBetrayed_2be665c6-da32-4e78-bae2-a83fb1b72368, END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
DB_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_VlaakithPathLaezelBetrayed_9d571d9a-fe2c-41eb-9e2c-2667364f8404, END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
DB_END_IllithidOptions_NegotiatingPlayer(NULL_00000000-0000-0000-0000-000000000000);
PROC_END_IllithidOptions_Setup();

KBSECTION
IF
TextEvent("end_gotoastralprism", _, _, _, _)
THEN
PROC_TeleportPartiesTo(S_DEBUG_TeleportIllithidChoice_Arrival_5e9b5e1d-ceab-44a6-9a2f-ccda5ba22c25, "");

IF
TextEvent("end_gotoassimation", _, _, _, _)
THEN
PROC_TeleportPartiesTo(S_DEBUG_TeleportIllithidChoice_Assimilation_36e1f5a2-fddf-4ad3-9f66-c8e6c68c3192, "");

IF
TextEvent("end_startillithidoptions", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_OnlyOnce("END_IllithidOptions_AstralArrival");
DB_END_MorphicPool_ConfrontationSpeaker(_Var1);
PROC_END_MorphicPool_PostConfrontationCleanUp();
PROC_TeleportPartiesTo(S_END_ToAstralPlanePoint_66edc6ed-1584-47ac-983c-c6119ea7ddd4, "END_IllithidOptions_PlayersArrived");
TeleportTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_AstralEmperorPoint_a9932552-8c39-485b-8e5c-0aa8570824a3, "END_IllithidOptions_EmperorArrived");

IF
TextEvent("end_freeorpheus", _, _, _, _)
THEN
PROC_END_IllithidOptions_FreeOrpheus();

IF
TextEvent("end_toassimilation", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_DEBUG_IllithidOptions_Assimilation(_Var1);

PROC
PROC_END_DEBUG_IllithidOptions_Assimilation((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_END_IllithidOptions_SetEmperorScene();
TeleportTo(_Var1, S_DEBUG_TeleportIllithidChoice_Assimilation_36e1f5a2-fddf-4ad3-9f66-c8e6c68c3192);
PROC_RemoveDialog(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
TeleportTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_EmperorAssimilationPoint_5bad94db-14cd-4aad-bf03-cc8e3e748e7e, "END_IllithidOptions_ArrivedAtAssimilation");

IF
TextEvent("end_assimilation", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
Resurrect(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
Resurrect(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
TeleportTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_EmperorAssimilationPoint_5bad94db-14cd-4aad-bf03-cc8e3e748e7e);
TeleportTo(_Var1, S_DEBUG_TeleportIllithidChoice_Assimilation_36e1f5a2-fddf-4ad3-9f66-c8e6c68c3192);
ClearFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961);

IF
TextEvent("end_assimilation", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog_Fixed(END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _Var1, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1)
THEN
DB_NOOP(1);

IF
TextEvent("end_emperorleaving", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_DEBUG_IllithidOptions_EmperorLeaving(_Var1);

PROC
PROC_END_DEBUG_IllithidOptions_EmperorLeaving((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetFlag(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0);
SetFlag(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb);
SetFlag(END_IllithidOptions_State_ChosenFollowLeader_70668804-535b-4fee-915e-396d1faa3e84, _Var1);
PROC_SceneOver("END_IllithidOptions_EmperorScene");
PROC_RemoveDialog(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
Die(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
TeleportTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_OpenExitPortalPoint_c6d5437e-ca42-4fa9-892f-f33a964c091c, "END_IllithidOptions_OpenExitPortal");

IF
TextEvent("end_orpheusleaving", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_DEBUG_IllithidOptions_OrpheusLeaving(_Var1);

PROC
PROC_END_DEBUG_IllithidOptions_OrpheusLeaving((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
SetFlag(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0);
PROC_SceneOver("END_IllithidOptions_EmperorScene");
PROC_RemoveDialog(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
SetFlag(END_IllithidOptions_State_ChosenFollowLeader_70668804-535b-4fee-915e-396d1faa3e84, _Var1);
TeleportTo(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, S_END_OpenExitPortalPoint_c6d5437e-ca42-4fa9-892f-f33a964c091c, "END_IllithidOptions_OpenExitPortal");

IF
TextEvent("end_arrivehighhall", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_DEBUG_HighHall_Arrive(_Var1);

PROC
PROC_END_DEBUG_HighHall_Arrive((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_END_HighHall_ArrivalUser(_Var1);
PROC_TeleportPartiesTo(S_END_HighHallStartPoint_250b3364-3f6a-48dc-aef9-0c82366f352d, "END_ArrivedInHighHall");
SysCompleteGoal("Act3b_END_IllithidOptions");

IF
TextEvent("end_optionsgd", _, _, _, _)
AND
DB_GroupDiscussion_HasPlayed(END_IllithidOptions_GD_IVB_Undecided_37c12f37-df76-054e-fa2e-eeb6ed62fd15, _, _, _, _)
THEN
NOT DB_GroupDiscussion_HasPlayed(END_IllithidOptions_GD_IVB_Undecided_37c12f37-df76-054e-fa2e-eeb6ed62fd15);

IF
TextEvent("end_optionsgd", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GroupDiscussion_InstantStart(_Var1, END_IllithidOptions_GD_IVB_Undecided_37c12f37-df76-054e-fa2e-eeb6ed62fd15);

IF
TextEvent("end_morphicpoolreturn", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
TriggerUnregisterForPlayers(S_END_NetherbrainConfrontBox_6f265a52-a652-4762-99ba-4c1a9f8b4c06);
PROC_END_MorphicPool_PostConfrontationCleanUp();
SetOnStage(S_END_ToHighHallVines_11f19d26-e595-46c0-9de8-a34cbcc1ff82, 1);
PROC_TeleportPartiesTo(S_END_AstralPrismExitPoint_49f5a0f2-0f98-4a54-a295-c40ea8f768d2, "END_IllithidOptions_LeftAstralPrism");

IF
TextEvent("end_getorphichammer", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_GLO_OrphicHammer_9013ef0d-c6ee-4137-b17a-c1934079e10d, _Var1, 1, 1, 1);
SetFlag(END_IllithidOptions_State_ArrivedWithOrphicHammer_a350e277-55a7-4e03-9c14-db154b6c682e);

IF
TextEvent("end_morphicdestructionon", _, _, _, _)
THEN
LoadLevelTemplate(S_LT_PLT_END_MorphicPoolDestruction_20ca617c-ede6-460c-bd06-bfd6b945e76e);

IF
TextEvent("end_morphicdestructionoff", _, _, _, _)
THEN
UnloadLevelTemplate(S_LT_PLT_END_MorphicPoolDestruction_20ca617c-ede6-460c-bd06-bfd6b945e76e);

IF
TextEvent("end_tadpolechoicevb", _, _, _, _)
AND
DB_GroupDiscussion_HasPlayed(END_IllithidOptions_GD_IVB_TadpoleChoice_b9255477-aea1-edb0-4b17-8518348134ea, _, _, _, _)
THEN
NOT DB_GroupDiscussion_HasPlayed(END_IllithidOptions_GD_IVB_TadpoleChoice_b9255477-aea1-edb0-4b17-8518348134ea);

IF
TextEvent("end_tadpolechoicevb", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_GroupDiscussion_InstantStart(_Var1, END_IllithidOptions_GD_IVB_TadpoleChoice_b9255477-aea1-edb0-4b17-8518348134ea);

IF
TextEvent("end_orpheuspathlaezel", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12
THEN
SetFlag(Debug_AddGith_39ecbda9-cb44-becf-57b9-c3b631a5517b, _Var1);
SetFlag(ORI_State_PartneredWithLaezel_d169a786-6e56-4f0d-a2eb-33c48d8d1160, _Var1);
SetFlag(ORI_Laezel_State_IsOnOrpheusPath_97244ccc-a6b5-403e-9cfe-a3502eb4af56);

IF
TextEvent("end_orpheuspathlaezel", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 == S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12
THEN
SetFlag(ORI_Laezel_State_IsOnOrpheusPath_97244ccc-a6b5-403e-9cfe-a3502eb4af56);
DebugText(_Var1, "Lae'zel is avatar, set Orpheus Path flag");

IF
TextEvent("end_orpheuspathlaezel", _, _, _, _)
AND
GetTextEventParamInteger(1, 1, _, _, _)
AND
GetHostCharacter(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
ToInventory(S_GLO_OrphicHammer_9013ef0d-c6ee-4137-b17a-c1934079e10d, _Var1, 1, 1, 1);
SetFlag(END_IllithidOptions_State_ArrivedWithOrphicHammer_a350e277-55a7-4e03-9c14-db154b6c682e);

PROC
PROC_END_IllithidOptions_Setup()
AND
DB_END_IllithiOptions_GlobalNPC(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_SceneManager(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
PROC_SceneOver(_Var2);

PROC
PROC_END_IllithidOptions_Setup()
THEN
SetFaction(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, ACT3_END_Emperor_9ada321c-7aa0-4390-b725-126d2f53a5a2);
TeleportTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_AstralEmperorPoint_a9932552-8c39-485b-8e5c-0aa8570824a3, "");
PROC_Foop(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
TeleportTo(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, S_INT_OrpheusPos_13dd190c-9097-4c0e-be8e-1d9a743cbe02);
SetFaction(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, ACT3_END_Orpheus_b3c0e12d-1ed5-4c1a-8beb-02d6e625a1de);
TeleportTo(S_END_MiniDominationOrb_61352825-054d-4ac2-b946-09a10d326edb, S_END_MiniOrbPoint_45205144-10f1-43bd-944a-11dff3be6f70, "", 0, 0, 0, 0, 0);
PROC_SetAnubisConfig(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, "END_Emperor");
PROC_SetAnubisConfig(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "END_Orpheus");

IF
EnteredTrigger(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_EmperorImmortalArea_80996c6e-72ff-43be-a2f1-53a2f87e929b, _, _, _)
THEN
SetImmortal(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 1);

IF
LeftTrigger(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_EmperorImmortalArea_80996c6e-72ff-43be-a2f1-53a2f87e929b, _, _, _)
THEN
SetImmortal(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 0);

IF
DB_InRegion(_Var1, S_END_AstralPrism_SUB_adf44e33-ae27-4186-aff7-84d61dbedcae, _Var1, _Var1, _Var1)
AND
_Var1 != S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b
THEN
ApplyStatus(_Var1, "CRE_ASTRALPRISON_GRAVITY", -1, 1, NULL_00000000-0000-0000-0000-000000000000);

IF
LeftTrigger((CHARACTER)_Var1, S_END_AstralPrism_SUB_adf44e33-ae27-4186-aff7-84d61dbedcae, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
_Var1 != S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b
THEN
RemoveStatus(_Var1, "CRE_ASTRALPRISON_GRAVITY", NULL_00000000-0000-0000-0000-000000000000);

IF
EntityEvent((CHARACTER)_Var1, "END_IllithidOptions_PlayersArrived", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
RestoreParty(_Var1);
RemoveHarmfulStatuses(_Var1);
RemoveStatus(_Var1, "END_NETHERBRAIN_SLOW", NULL_00000000-0000-0000-0000-000000000000);

IF
EntityEvent((CHARACTER)_Var1, "END_IllithidOptions_PlayersArrived", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_MorphicPool_ConfrontationSpeaker(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_NetherstoneCasterArrived(_Var1);
NOT DB_END_MorphicPool_ConfrontationSpeaker(_Var1);
SetFlag(END_General_State_CurrentlyInAstralPlane_b3cf6c91-4d1c-4dcf-bc57-262f7d0f02b9);

IF
EntityEvent((GUIDSTRING)_Var1, "END_IllithidOptions_PlayersArrived", (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
GetFlag(GLO_Monitor_State_HasOrphicHammer_29842214-5482-dc25-fc89-02e474d7d96b, _Var1, 1, _Var1, _Var1)
THEN
SetFlag(END_IllithidOptions_State_ArrivedWithOrphicHammer_a350e277-55a7-4e03-9c14-db154b6c682e);
SetFlag(END_IllithidOptions_State_PartyHasOrphicHammer_90e5e1a5-2f6b-4b30-948f-c342d6adced5);

IF
EntityEvent(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, "END_IllithidOptions_EmperorArrived", _, _, _)
THEN
ToInventory(S_END_SupremeTadpole_02a7596f-5dcb-4d2a-93c8-611de53096b5, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 1, 0, 1);

IF
DB_END_IllithidOptions_NetherstoneCasterArrived(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_General_GivePlayerCombinedStonesOnce", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_General_CombineStones(_Var1);

IF
DB_END_IllithidOptions_NetherstoneCasterArrived(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _Var1, _Var1, _Var1, _Var1)
AND
QRY_OnlyOnce("END_IllithidOptions_AstralArrival", _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog(END_IllithidOptions_EmperorProposal_6769199a-452f-5a13-9178-55a899cccf59, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _Var1, _Var1, _Var1)
THEN
NOT DB_END_IllithidOptions_NetherstoneCasterArrived(_Var1);
PROC_END_IllithidOptions_SetEmperorScene();

IF
DialogEnded(END_IllithidOptions_EmperorProposal_6769199a-452f-5a13-9178-55a899cccf59, _, _, _, _)
AND
DB_END_IllithidOptions_NetherstoneCasterArrived(_Var2, _, _, _, _)
THEN
NOT DB_END_IllithidOptions_NetherstoneCasterArrived(_Var2);
PROC_END_IllithidOptions_SetEmperorScene();

IF
DialogEnded(END_IllithidOptions_EmperorProposal_6769199a-452f-5a13-9178-55a899cccf59, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
THEN
PROC_RemoveDialog(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
PROC_CharacterMoveTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_EmperorJumpReadyPoint_70aab428-e505-4ba4-9f1d-3d992827c624, "Walk", "END_IllithidOptions_JumptFromPoint");
SetFlag(END_IllithidOptions_State_EmperorMovingToAssimilation_7575a81a-f7dc-43ee-b066-11b75ebbf769);

IF
EntityEvent(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, "END_IllithidOptions_JumptFromPoint", _, _, _)
AND
QRY_OnlyOnce("END_IllithidOptions_NextFlightPoint", _, _, _, _)
THEN
UseSpell(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, "Projectile_END_Levitate_Emperor", S_END_EmperorJumpToPoint_001_b111d0be-008a-455b-8b38-193100b761f5);

IF
CastedSpell(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, "Projectile_END_Levitate_Emperor", _, _, (INTEGER)_Var3)
AND
DB_GlobalFlag(END_IllithidOptions_State_EmperorMovingToAssimilation_7575a81a-f7dc-43ee-b066-11b75ebbf769, _, _, _, _)
THEN
DB_END_IllithidOptions_EmperorIsTraversing(1);

IF
DB_END_IllithidOptions_EmperorIsTraversing(1, _, _, _, _)
AND NOT
DB_CantAct(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _, _, _, _)
THEN
PROC_CharacterMoveTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, S_END_EmperorAssimilationPoint_5bad94db-14cd-4aad-bf03-cc8e3e748e7e, "Run", "END_IllithidOptions_ArrivedAtAssimilation");

IF
EntityEvent(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, "END_IllithidOptions_ArrivedAtAssimilation", _, _, _)
THEN
ClearFlag(END_IllithidOptions_State_EmperorMovingToAssimilation_7575a81a-f7dc-43ee-b066-11b75ebbf769);
DB_Dialogs(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb);

PROC
PROC_StartDialog_PreDialogStarted(END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb, 1, _, _, _, _, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _, _, _, _)
THEN
PROC_ForceStopDialog(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);

PROC
PROC_StartDialog_AddExtraSpeakers(END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_ReadyOrpheusAsSpeaker(_Var1);

IF
DB_END_IllithidOptions_ReadyOrpheusAsSpeaker(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_IllithidOptions_ReadyOrpheusAsSpeaker(_Var1);
PROC_DialogAddSpeakingActor(_Var1, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);

IF
FlagSet(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
SetDetached(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 0);
SetCharacterLootable(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 1);
DB_DialogDeath(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
DB_GLO_CharacterCorpseDialog(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, END_IllithidOptions_Orpheus_Dead_7e5dfbb4-e9dc-e049-8ff0-6cf524b9e33f);
Die(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);

IF
FlagSet(END_IllithidOptions_State_MiniDominationOrbRemoved_05db0c72-bfc8-45a9-8c29-04d11eaa986b, _, _, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_END_IllithidOptions_ClearOrbBounds();
SetOnStage(S_END_MiniDominationOrb_61352825-054d-4ac2-b946-09a10d326edb, 0);
SetDetached(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 0);

PROC
PROC_END_IllithidOptions_ClearOrbBounds()
AND
DB_END_IllithidOptions_OrbBounds(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
SetOnStage(_Var1, 0);

IF
FlagSet(END_IllithidOptions_State_OrpheusPathLaezelConfrontation_8b03c077-037b-49d4-a8d5-0c50643a5b07, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, 1, _, _)
THEN
PROC_END_IllithidOptions_UpdateNegotiatingPlayer(_Var3);

IF
FlagSet(END_IllithidOptions_Event_VlaakithPathLaezelBetrayed_9d571d9a-fe2c-41eb-9e2c-2667364f8404, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, 1, _, _)
THEN
PROC_END_IllithidOptions_UpdateNegotiatingPlayer(_Var3);

IF
FlagSet(END_IllithidOptions_Event_OrpheusPathLaezelBetrayed_2be665c6-da32-4e78-bae2-a83fb1b72368, _, (INTEGER)_Var2, _, _)
AND
DB_DialogPlayers(_Var2, _Var3, 1, _, _)
THEN
PROC_END_IllithidOptions_UpdateNegotiatingPlayer(_Var3);

PROC
PROC_END_IllithidOptions_UpdateNegotiatingPlayer((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptions_NegotiatingPlayer(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
THEN
NOT DB_END_IllithidOptions_NegotiatingPlayer(_Var2);
DB_END_IllithidOptions_NegotiatingPlayer(_Var1);

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_VlaakithPathLaezelBetrayed_9d571d9a-fe2c-41eb-9e2c-2667364f8404, _, _, _, _)
THEN
PROC_END_IllithidOptions_BetrayedLaezel();

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_OrpheusPathLaezelBetrayed_2be665c6-da32-4e78-bae2-a83fb1b72368, _, _, _, _)
THEN
PROC_END_IllithidOptions_BetrayedLaezel();

IF
DialogEnded(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Laezel_State_IsOnOrpheusPath_97244ccc-a6b5-403e-9cfe-a3502eb4af56, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_TookMomentToChoose_4fc3d679-7bd5-4a2f-9175-4d5c028ed185, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_VlaakithPathLaezelBetrayed_9d571d9a-fe2c-41eb-9e2c-2667364f8404, _, _, _, _)
AND NOT
DB_GlobalFlag(ORI_Laezel_State_VlaakithPathOrpheusAlly_0a57a2d4-f61d-84b2-547a-99afcdd8ba98, _, _, _, _)
THEN
SetFlag(ORI_Laezel_State_VlaakithPathOrpheusAlly_0a57a2d4-f61d-84b2-547a-99afcdd8ba98);

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_OrpheusPathLaezelConfrontation_8b03c077-037b-49d4-a8d5-0c50643a5b07, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_SwayedLaezelForAssimilation_873e4e9d-8042-78d7-8275-666bd92be830, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_SidedWithLaezel_cd242512-90ba-4cd5-9b24-4e745b3a342c, _, _, _, _)
THEN
PROC_END_IllithidOptions_BetrayedLaezel();

PROC
PROC_END_IllithidOptions_BetrayedLaezel()
AND NOT
DB_END_IllithidOptions_LaezelBetrayed(1, _, _, _, _)
AND
DB_END_IllithidOptions_NegotiatingPlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_LaezelBetrayed(1);
PROC_SceneOver("END_IllithidOptions_EmperorScene");
PROC_SceneOver("END_IllithidOptions_OrpheusScene");
PROC_END_IllithidOptions_LaezelTurnsHostile();
PROC_SetRelationToPlayers(Origin_Laezel_bee8449b-d682-93c8-e7da-9e4bad369476, 0);
DB_CombatReact_AD_OnDeath(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, END_General_AD_LaezelBetrayedDeath_e8064996-c2f9-9c53-7540-f6f23dc66c19);

PROC
PROC_END_IllithidOptions_LaezelTurnsHostile()
AND
DB_GlobalFlag(ORI_Laezel_State_IsOnOrpheusPath_97244ccc-a6b5-403e-9cfe-a3502eb4af56, _, _, _, _)
THEN
PROC_Origins_CompanionLeavePermanently(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, "TurnedHostile_MorphicPool_OrpheusPath");

PROC
PROC_END_IllithidOptions_LaezelTurnsHostile()
AND NOT
DB_GlobalFlag(ORI_Laezel_State_IsOnOrpheusPath_97244ccc-a6b5-403e-9cfe-a3502eb4af56, _, _, _, _)
THEN
PROC_Origins_CompanionLeavePermanently(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, "TurnedHostile_MorphicPool_VlaakithPath");

PROC
PROC_GLO_PartyMembers_MakeNPCHook(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _, _, _, _)
AND
DB_END_IllithidOptions_LaezelBetrayed(1, _, _, _, _)
AND
DB_END_IllithidOptions_NegotiatingPlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_EnterCombat(_Var1, S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12);

IF
EnteredCombat(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_END_IllithidOptions_LaezelBetrayed(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptions_LaezelBetraylCombatID(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_IllithidOptions_LaezelBetraylCombatID(_Var2);
DB_END_IllithidOptions_LaezelBetraylCombatID(_Var1);

IF
SwitchedCombat(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, (GUIDSTRING)_Var1, (GUIDSTRING)_Var2, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_END_IllithidOptions_LaezelBetrayed(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptions_LaezelBetraylCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_IllithidOptions_LaezelBetraylCombatID(_Var1);
DB_END_IllithidOptions_LaezelBetraylCombatID(_Var2);

IF
CombatEnded((GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND
DB_END_IllithidOptions_LaezelBetraylCombatID(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PermaDefeated(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptions_LaezelBetrayed(1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_BetrayedLaezelPermaDefeated();

PROC
PROC_END_IllithidOptions_BetrayedLaezelPermaDefeated()
AND NOT
DB_PermaDefeated(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _, _, _, _)
THEN
PROC_END_IllithidOptions_SetEmperorScene();

PROC
PROC_END_IllithidOptions_BetrayedLaezelPermaDefeated()
AND
DB_GlobalFlag(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_OrpheusHostile_779f9ca6-4436-46dc-9e68-cb97e9ea1172, _, _, _, _)
THEN
PROC_END_IllithidOptions_SetOrpheusScene();

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _, _, _, _)
THEN
PROC_END_IllithidOptions_EmperorEscapeToNetherbrain();

PROC
PROC_END_IllithidOptions_EmperorBetrayed((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(END_IllithidOptions_EmperorBetrayal_fdb71668-eb81-26e6-1341-50f351b796f8, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _Var1, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce");

PROC
PROC_END_IllithidOptions_EmperorBetrayed((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_PlayerSummons(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
CharacterGetOwner(_Var1, _Var2, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(END_IllithidOptions_EmperorBetrayal_fdb71668-eb81-26e6-1341-50f351b796f8, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _Var2, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce");

PROC
PROC_END_IllithidOptions_EmperorBetrayed((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_GetClosestAvailableCharacterTo(_Var1, 0, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var2, _, _, _, _Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce", _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialogCustom(END_IllithidOptions_EmperorBetrayal_fdb71668-eb81-26e6-1341-50f351b796f8, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _Var2, 0, 0, 0, 0, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce");

PROC
PROC_END_IllithidOptions_EmperorBetrayed((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce", _Var1, _Var1, _Var1, _Var1)
THEN
DB_OnlyOnce("END_IllithidOptions_EmperorBetrayedOnce");
PROC_END_IllithidOptions_EmperorEscapeToNetherbrain();

IF
DialogEnded(END_IllithidOptions_EmperorBetrayal_fdb71668-eb81-26e6-1341-50f351b796f8, _, (INTEGER)_, (INTEGER)_, (INTEGER)_)
THEN
PROC_END_IllithidOptions_EmperorEscapeToNetherbrain();

PROC
PROC_END_IllithidOptions_EmperorEscapeToNetherbrain()
AND
QRY_OnlyOnce("END_IllithidOptions_EmperorLeftOnce", _, _, _, _)
THEN
NOT DB_AddCharactersInTriggerToDialog(END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb, S_END_AssimilationAndFreedDialogBox_2d0e6a22-6370-44c3-98e5-ede4a0d18704, 1, 1, 1);
PROC_GlobalSetFlagAndCache(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd);
PROC_Poof(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, VFX_Script_Emperor_Teleport_3772280c-c094-0b63-602e-2ad6045ec800);
SetHitpointsPercentage(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 100);
PROC_END_IllithidOptions_CheckEmperorLeftThrallOfTheAbsolute();
PROC_END_IllithidOptions_FallbackPortalCheck();
PROC_END_IllithidOptions_TryRaphaelLastChance();

PROC
PROC_END_IllithidOptions_FallbackPortalCheck()
AND
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _, _, _, _)
AND
QRY_END_IllithidOptions_PlayerCanOpenPortal()
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_PlayerOpenedExitPortal_fe639a62-2f2f-441e-a2dc-00761cf7cca3, _, _, _, _)
THEN
SetFlag(END_IllithidOptions_Event_PlayerOpenedExitPortal_fe639a62-2f2f-441e-a2dc-00761cf7cca3);
PROC_END_IllithidOptions_OpenExitPortal(NULL_00000000-0000-0000-0000-000000000000);

QRY
QRY_END_IllithidOptions_PlayerCanOpenPortal()
AND
DB_GlobalFlag(END_General_State_SupremeTadpoleAvailable_0177c452-90cc-4c29-83b8-4acaa2902b27, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_END_IllithidOptions_PlayerCanOpenPortal()
AND
DB_GlobalFlag(END_General_State_PlayerIsMindFlayer_d138f537-2268-49a6-8dc4-256bd9cf5633, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_END_IllithidOptions_CheckEmperorLeftThrallOfTheAbsolute()
AND
QRY_END_IllithidOptions_EmperorIsRequiredToContinue()
AND
QRY_GLO_ThrallOfTheAbsolute_GetNearestTadpoledPlayer(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _, _, _, _)
AND
DB_QRYRTN_GLO_ThrallOfTheAbsolute_NearestPlayer(_Var1, _, _Var1, _Var1, _Var1)
THEN
SetOnStage(S_END_ResolutionExitPortal_Illithid_2a62d420-290b-47e5-a224-71b5cda70f50, 0);
SetFlag(GLO_ThrallOfTheAbsolute_Event_AstralPrism_4d658c40-92a9-4c2b-9828-acc604789025, _Var1);

QRY
QRY_END_IllithidOptions_EmperorIsRequiredToContinue()
AND
GetFlag(END_IllithidOptions_State_AssimilatorOfOrpheus_56989e8b-cca9-4f3b-aece-26a389e3b6ee, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 1, _, _)
THEN
DB_NOOP(1);

QRY
QRY_END_IllithidOptions_EmperorIsRequiredToContinue()
AND
DB_GlobalFlag(END_IllithidOptions_State_GaveStones_18e3be1a-c1c0-437e-ad0a-a1426d8830f4, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_END_IllithidOptions_SetEmperorScene()
THEN
DB_SceneTriggerManager("END_IllithidOptions_EmperorScene", S_END_AstralPrism_SUB_adf44e33-ae27-4186-aff7-84d61dbedcae);
DB_SceneManager(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, "END_IllithidOptions_EmperorScene");

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "END_IllithidOptions_EmperorScene", (STRING)_Var3, _)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _, _, _, _)
THEN
ReadyCheckCancel("END_ReadyCheck_LeaveAstralPrism");
PROC_SceneOver("END_IllithidOptions_EmperorScene");
PROC_ForceStopDialog(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b);
PROC_END_IllithidOptions_EmperorBetrayed(_Var2);

PROC
PROC_END_IllithidOptions_TryRaphaelLastChance()
AND NOT
QRY_END_IllithidOptions_RaphaelCanAppear()
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _, _, _, _)
AND
GetClosestAlivePlayer(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _, _Var1, _Var1)
AND
QRY_OnlyOnce("END_IllithidOptions_NoRaphaelVBOnce", _Var1, _Var1, _Var1, _Var1)
THEN
PROC_NotifyWhenReadyToMoveOn(_Var1, "END_IllithidOptions_ReadyForRaphaelVB");

PROC
PROC_END_IllithidOptions_TryRaphaelLastChance()
AND
QRY_END_IllithidOptions_RaphaelCanAppear()
AND
GetClosestAlivePlayer(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _, _Var1, _Var1)
THEN
SetFlag(END_IllithidOptions_Event_RaphaelAppeared_9cfb6023-25e5-4ae4-899f-d6142c7f1be0);
DB_SceneManager(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8, "END_IllithidOptions_RaphaelScene");
PROC_NotifyWhenReadyToMoveOn(_Var1, "END_IllithidOptions_ReadyForRaphaelVB");

QRY
QRY_END_IllithidOptions_RaphaelCanAppear()
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_RaphaelAppeared_9cfb6023-25e5-4ae4-899f-d6142c7f1be0, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_ArrivedWithOrphicHammer_a350e277-55a7-4e03-9c14-db154b6c682e, _, _, _, _)
AND NOT
DB_PermaDefeated(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_SupremeTadpoleAvailable_0177c452-90cc-4c29-83b8-4acaa2902b27, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_PlayerIsMindFlayer_d138f537-2268-49a6-8dc4-256bd9cf5633, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_ReadyToMoveOn((CHARACTER)_Var1, "END_IllithidOptions_ReadyForRaphaelVB", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
StartVoiceBark(END_IllithidOptions_VB_OutOfOptions_91349046-4e96-2b6f-2972-f3668adba848, _Var1);

IF
VoiceBarkEnded(END_IllithidOptions_VB_OutOfOptions_91349046-4e96-2b6f-2972-f3668adba848, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_Event_RaphaelAppeared_9cfb6023-25e5-4ae4-899f-d6142c7f1be0, _, _, _, _)
THEN
PROC_END_IllithidOptions_ReadyRaphael();

IF
VoiceBarkFailed(END_IllithidOptions_VB_OutOfOptions_91349046-4e96-2b6f-2972-f3668adba848, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_Event_RaphaelAppeared_9cfb6023-25e5-4ae4-899f-d6142c7f1be0, _, _, _, _)
THEN
PROC_END_IllithidOptions_ReadyRaphael();

PROC
PROC_END_IllithidOptions_ReadyRaphael()
THEN
PROC_RemoveDialog(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);
DB_Dialogs(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8, END_IllithidOptions_RaphaelLastChance_e8b41315-b35c-5c7a-e3be-e921cd0c8741);
TeleportTo(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8, S_END_LastChanceRaphaelPoint_9926cf49-968c-47e0-9d06-9f2e74a2d543, "END_IllithidOptions_RaphaelArrived");

IF
EntityEvent(_, "END_IllithidOptions_RaphaelArrived", (GUIDSTRING)_, (GUIDSTRING)_, (GUIDSTRING)_)
THEN
PROC_GLO_Monitor_Foop();
PROC_TryStartAD(END_IllithidOptions_AD_RaphaelAppears_92f13332-efa3-cfcf-9f7a-59af21f5d4eb, S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);

IF
FlagSet(END_IllithidOptions_Event_SpawnOrphicHammer_2d25bebd-6165-7a13-96b3-fabe32d2a627, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
ToInventory(S_GLO_OrphicHammer_9013ef0d-c6ee-4137-b17a-c1934079e10d, _Var1, 1, 1, 1);

IF
FlagSet(END_IllithidOptions_Event_SpawnOrphicHammer_2d25bebd-6165-7a13-96b3-fabe32d2a627, (GUIDSTRING)_Var1, _, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_PartyHasOrphicHammer_90e5e1a5-2f6b-4b30-948f-c342d6adced5, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(END_IllithidOptions_State_PartyHasOrphicHammer_90e5e1a5-2f6b-4b30-948f-c342d6adced5);

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_AcceptedRaphaelDeal_c4d409ef-d70e-9934-edf2-d6bd66201c19, _, _, _, _)
THEN
PROC_GLO_Monitor_Poof();
PROC_SceneOver("END_IllithidOptions_RaphaelScene");

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_RejectedRaphael_b2e6764d-828b-b125-3e9a-365d5fd9737b, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
GetClosestAlivePlayer(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8, _Var1, _, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_RaphaelExit(_Var1);
PROC_SceneOver("END_IllithidOptions_RaphaelScene");

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "END_IllithidOptions_RaphaelScene", (STRING)_Var3, _)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _, _, _, _)
THEN
PROC_GlobalSetFlagAndCache(END_IllithidOptions_Event_RejectedRaphael_b2e6764d-828b-b125-3e9a-365d5fd9737b);
PROC_END_IllithidOptions_RaphaelExit(_Var2);

PROC
PROC_END_IllithidOptions_RaphaelExit((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_SceneOver("END_IllithidOptions_RaphaelScene");
PROC_ForceStopDialog(S_GLO_Monitor_f65becd6-5cd7-4c88-b85e-6dd06b60f7b8);
PROC_GLO_Monitor_Poof();
PROC_END_IllithidOptions_CheckNoMoreOptionsLeft(_Var1);

IF
UseFinished((CHARACTER)_Var1, S_END_MiniDominationOrb_61352825-054d-4ac2-b946-09a10d326edb, 1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog_Fixed(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
StatusApplied((ITEM)_Var1, "END_ORPHICHAMMER_BREAKSHACKLES", (CHARACTER)_Var2, _, (ITEM)_Var1)
AND
DB_END_IllithidOptions_CrystalShackles(_Var1, _, _Var1, _Var1, _Var1)
THEN
PlayEffect(_Var1, VFX_Status_NAT_Rock_Granite_Boulder_Big_360_H_Crystal_Overlay_01_3760be48-84db-afa2-afe1-f4ba5fd8df17, "", 1);
PROC_END_IllithidOptions_BreakCrystal(_Var2, _Var1);

PROC
PROC_END_IllithidOptions_BreakCrystal((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
DB_END_IllithidOptions_OrphicHammerAttacker(_Var1);
RealtimeObjectTimerLaunch(_Var2, "END_IllithidOptions_BreakCrystalsTimer", 2000);

PROC
PROC_END_IllithidOptions_BreakCrystal((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_EmperorBetrayed(_Var1);

IF
DB_END_IllithidOptions_OrphicHammerAttacker(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptions_OrphicHammerAttacker(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != _Var2
THEN
NOT DB_END_IllithidOptions_OrphicHammerAttacker(_Var2);

IF
ObjectTimerFinished((ITEM)_Var1, "END_IllithidOptions_BreakCrystalsTimer", (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_END_IllithidOptions_CrystalShackles(_Var1, _Var2, _Var1, _Var1, _Var1)
THEN
Die(_Var1);
RemoveStatus(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var2, NULL_00000000-0000-0000-0000-000000000000);
NOT DB_END_IllithidOptions_CrystalShackles(_Var1, _Var2);
PROC_END_IllithidOptions_TryFreeOrpheus();

PROC
PROC_END_IllithidOptions_TryFreeOrpheus()
AND NOT
DB_END_IllithidOptions_CrystalShackles(_, _, _, _, _)
THEN
PROC_END_IllithidOptions_FreeOrpheus();

IF
AttackedBy(S_GLO_OrphicHammer_9013ef0d-c6ee-4137-b17a-c1934079e10d, (GUIDSTRING)_Var1, _, _, _, "InventoryThrow", (INTEGER)_Var5, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1, (GUIDSTRING)_Var1)
THEN
DB_END_IllithidOptions_OrphicHammerThrower(_Var1, _Var5);

IF
DB_END_IllithidOptions_OrphicHammerThrower(_Var1, _Var2, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptions_OrphicHammerThrower(_Var3, _Var4, _Var1, _Var1, _Var1)
AND
_Var2 != _Var4
THEN
NOT DB_END_IllithidOptions_OrphicHammerThrower(_Var3, _Var4);

IF
AttackedBy((ITEM)_Var1, (GUIDSTRING)_Var2, _, _, _, "InventoryThrow", (INTEGER)_Var6, (ITEM)_Var1, (ITEM)_Var1, (ITEM)_Var1)
AND
DB_END_IllithidOptions_CrystalShackles(_Var1, _, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptions_OrphicHammerThrower(_Var2, _Var6, _Var1, _Var1, _Var1)
AND
HasActiveStatus(_Var1, "END_ORPHICHAMMER_BREAKSHACKLES", 0, _Var1, _Var1)
THEN
ApplyStatus(_Var1, "END_ORPHICHAMMER_BREAKSHACKLES", -1, 1, _Var2);

PROC
PROC_END_IllithidOptions_FreeOrpheus()
AND NOT
DB_PermaDefeated(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _, _, _, _)
AND
DB_END_IllithidOptions_OrphicHammerAttacker(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GetClosestAvailableCharacterTo(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 0, _Var1, _Var1, _Var1)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var2, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, _, 1, _Var1)
THEN
PROC_END_IllithidOptions_EmperorBetrayed(_Var2);
NOT DB_END_IllithidOptions_OrphicHammerAttacker(_Var1);
DB_END_IllithidOptions_OrphicHammerAttacker(_Var2);
PROC_END_IllithidOptions_RaphaelExit(_Var2);

PROC
PROC_END_IllithidOptions_FreeOrpheus()
AND NOT
DB_PermaDefeated(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _, _, _, _)
THEN
DB_AddCharactersInTriggerToDialog(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_END_AssimilationAndFreedDialogBox_2d0e6a22-6370-44c3-98e5-ede4a0d18704, 1, 1, 1);
RemoveStatus(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "INT_ORPHEUS_INFERNALBINDSANIM", NULL_00000000-0000-0000-0000-000000000000);
NOT DB_DialogBlockAttackButton(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f);
SetFlag(END_IllithidOptions_State_MiniDominationOrbRemoved_05db0c72-bfc8-45a9-8c29-04d11eaa986b);
SetDoNotFaceFlag(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 0);
SetDetached(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 0);
RemoveStatus(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "INT_ORPHEUS_INFERNALPROTECTION", NULL_00000000-0000-0000-0000-000000000000);
ClearFlag(END_IllithidOptions_Event_TookMomentToChoose_4fc3d679-7bd5-4a2f-9175-4d5c028ed185);
SetCanJoinCombat(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 1);
SetCanFight(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 1);
PROC_CharacterEnableAllCrimes(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
PROC_GlobalSetFlagAndCache(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb);
PROC_END_IllithidOptions_SetOrpheusScene();
PROC_END_IllithidOptions_TryEmperorFreedDialog();

PROC
PROC_END_IllithidOptions_FreeOrpheus()
AND
GetEquippedItem(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "Gloves", _Var1, _Var1, _Var1)
AND
GetEquippedItem(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "Helmet", _Var2, _Var1, _Var1)
THEN
Unequip(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1);
Unequip(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var2);

PROC
PROC_END_IllithidOptions_TryEmperorFreedDialog()
AND
DB_END_IllithidOptions_OrphicHammerAttacker(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog_Fixed(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1);

PROC
PROC_END_IllithidOptions_TryEmperorFreedDialog()
AND
QRY_GetClosestAvailableCharacterTo(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, 0, _, _, _)
AND
DB_ClosestAvailableCharacterTo_PreferAvatar(_Var1, _, _Var3, 1, _Var1)
AND
_Var3 <= 30
AND NOT
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog_Fixed(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1);

PROC
PROC_END_IllithidOptions_TryEmperorFreedDialog()
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var2, _Var1, _Var1)
AND
_Var2 <= 30
AND NOT
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog_Fixed(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1);

PROC
PROC_END_IllithidOptions_TryEmperorFreedDialog()
AND
DB_END_IllithidOptions_OrphicHammerAttacker(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12
AND NOT
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND NOT
QRY_StartDialog_Fixed(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1);

PROC
PROC_END_IllithidOptions_TryEmperorFreedDialog()
AND
DB_Players(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
_Var1 != S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12
AND
DB_CantTalk(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
GetDistanceTo(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var2, _Var1, _Var1)
AND
_Var2 <= 30
AND NOT
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_StartDialog_Fixed(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var1, _Var1, _Var1)
THEN
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1);

PROC
PROC_END_IllithidOptions_TryEmperorFreedDialog()
AND
DB_END_IllithidOptions_OrphicHammerAttacker(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _, _, _, _)
AND NOT
DB_CantTalk(S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _, _, _, _)
AND NOT
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1, _, _, _, _)
AND NOT
QRY_StartDialog_Fixed(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, S_Player_Laezel_58a69333-40bf-8358-1d17-fff240d7fb12, _, _)
THEN
DB_END_IllithidOptions_OrpheusFreedDialogStarted(1);

PROC
PROC_StartDialog_AddExtraSpeakers(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1, (INTEGER)_Var1)
AND
QRY_END_IllithidOptions_OrpheusFreedLocallyAddingAvatarMindFlayerSpeaker()
AND
DB_END_General_PartyMindFlayer(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_IllithidOptions_IsAvatarOrKarlachMindFlayer(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
IsSpeakerReserved(_Var2, 0, _Var1, _Var1, _Var1)
AND
GetDistanceTo(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var2, _Var3, _Var1, _Var1)
AND
_Var3 <= 30
THEN
PROC_DialogAddSpeakingActorAt(_Var1, _Var2, 5);

QRY
QRY_ShouldNotAddCharacterInTriggerToDialog((CHARACTER)_Var1, END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_END_AssimilationAndFreedDialogBox_2d0e6a22-6370-44c3-98e5-ede4a0d18704, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_END_IllithidOptions_IsAvatarOrKarlachMindFlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_IllithidOptions_OrpheusFreedLocallyAddingAvatarMindFlayerSpeaker()
THEN
DB_NOOP(1);

QRY
QRY_END_IllithidOptions_IsAvatarOrKarlachMindFlayer((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_General_PartyMindFlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
DB_NOOP(1);

QRY
QRY_END_IllithidOptions_IsAvatarOrKarlachMindFlayer(S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c, _, _, _, _)
AND
DB_END_General_PartyMindFlayer(S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c, _, _, _, _)
AND NOT
DB_Avatars(S_Player_Karlach_2c76687d-93a2-477b-8b18-8a14b549304c, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_END_IllithidOptions_OrpheusFreedLocallyAddingAvatarMindFlayerSpeaker()
AND
DB_GlobalFlag(END_General_State_PlayerIsMindFlayer_d138f537-2268-49a6-8dc4-256bd9cf5633, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_SceneInterrupted(_, (CHARACTER)_Var2, "END_IllithidOptions_OrpheusScene", (STRING)_Var3, _)
AND
DB_PartyMembers(_Var2, _, _, _, _)
AND
DB_GLO_GenericSceneManager_ViolenceReason(_Var3, _, _, _, _)
AND
GetFaction(_Var2, _Var4, _, _, _)
THEN
SetFlag(EEND_IllithidOptions_State_OrpheusHostile_779f9ca6-4436-46dc-9e68-cb97e9ea1172);
PROC_SceneOver("END_IllithidOptions_OrpheusScene");
PROC_ForceStopDialog(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
SetHostileAndEnterCombat(Hero_a1542c81-6895-929e-4522-10ce218bb360, ACT3_END_Orpheus_b3c0e12d-1ed5-4c1a-8beb-02d6e625a1de, _Var2, S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);
PROC_SetRelationToPlayers(ACT3_END_Orpheus_b3c0e12d-1ed5-4c1a-8beb-02d6e625a1de, 0);

IF
FlagSet(END_IllithidOptions_State_OrpheusHostile_779f9ca6-4436-46dc-9e68-cb97e9ea1172, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0, _, _, _, _)
THEN
ReadyCheckCancel("END_ReadyCheck_LeaveAstralPrism");

IF
KilledBy(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, (CHARACTER)_Var1, _, (INTEGER)_Var3, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_END_General_ExtractBrainCastID(_, _Var3, _Var1, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_OrpheusKilled(_Var1);

IF
KilledBy(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, (GUIDSTRING)_Var1, _, (INTEGER)_Var3, (GUIDSTRING)_Var1)
AND
DB_END_General_ExtractBrainCastID(_Var1, _Var3, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_Event_PlayerOpenedExitPortal_fe639a62-2f2f-441e-a2dc-00761cf7cca3, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(END_IllithidOptions_Event_PlayerOpenedExitPortal_fe639a62-2f2f-441e-a2dc-00761cf7cca3);
PROC_END_IllithidOptions_OpenExitPortal(NULL_00000000-0000-0000-0000-000000000000);

IF
KilledBy(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, (CHARACTER)_Var1, _, (INTEGER)_Var3, (CHARACTER)_Var1)
AND
DB_END_General_ExtractBrainCastID(_Var1, _Var3, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptionsFollower_Follower(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _Var4, _Var5, _Var6, _Var1)
THEN
NOT DB_END_General_ExtractBrainCastID(_Var1, _Var3);
DB_END_General_BrainExtractor(_Var1);
SetFlag(END_IllithidOptions_Event_PlayerOpenedExitPortal_fe639a62-2f2f-441e-a2dc-00761cf7cca3);
DB_END_General_ReadyAssimilationVBReaction(_Var1);
PROC_END_General_BrainExtract(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e);

PROC
PROC_END_IllithidOptions_OrpheusKilled((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_LeftAstralPrism_db4fa8cd-9901-bda6-b5ee-b341075c02ce, _Var1, _Var1, _Var1, _Var1)
THEN
SetFlag(GLO_ThrallOfTheAbsolute_Event_AstralPrism_4d658c40-92a9-4c2b-9828-acc604789025, _Var1);

PROC
PROC_END_IllithidOptions_OrpheusKilled((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_Avatars(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
QRY_GLO_ThrallOfTheAbsolute_GetNearestTadpoledPlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
AND
DB_QRYRTN_GLO_ThrallOfTheAbsolute_NearestPlayer(_Var2, _, _Var1, _Var1, _Var1)
THEN
SetFlag(GLO_ThrallOfTheAbsolute_Event_AstralPrism_4d658c40-92a9-4c2b-9828-acc604789025, _Var2);

PROC
PROC_StateSet_Defeated(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_LeftAstralPrism_db4fa8cd-9901-bda6-b5ee-b341075c02ce, _, _, _, _)
AND NOT
DB_END_General_ExtractBrainCastID(_, _, _, _, _)
AND
QRY_GLO_ThrallOfTheAbsolute_GetNearestTadpoledPlayer(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _, _, _, _)
AND
DB_QRYRTN_GLO_ThrallOfTheAbsolute_NearestPlayer(_Var3, _, _, _, _)
THEN
SetFlag(GLO_ThrallOfTheAbsolute_Event_AstralPrism_4d658c40-92a9-4c2b-9828-acc604789025, _Var3);

PROC
PROC_END_IllithidOptions_SetOrpheusScene()
THEN
DB_SceneTriggerManager("END_IllithidOptions_OrpheusScene", S_END_AstralPrism_SUB_adf44e33-ae27-4186-aff7-84d61dbedcae);
DB_SceneManager(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, "END_IllithidOptions_OrpheusScene");

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_Event_PlayerOpenedExitPortal_fe639a62-2f2f-441e-a2dc-00761cf7cca3, _, _, _, _)
THEN
PROC_END_IllithidOptions_OpenExitPortal(NULL_00000000-0000-0000-0000-000000000000);

PROC
PROC_GlobalFlagReactionAfterDialog(END_IllithidOptions_State_ExitPortalAvailable_b97872a1-59cc-40cd-8963-e06be614adc0, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptionsFollower_Follower(_Var1, _, _, _, _Var1)
AND NOT
DB_PermaDefeated(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_CharacterMoveTo(_Var1, S_END_OpenExitPortalPoint_c6d5437e-ca42-4fa9-892f-f33a964c091c, "Run", "END_IllithidOptions_OpenExitPortal");
NOT DB_AddCharactersInTriggerToDialog(END_IllithidOptions_Assimilation_f909fcc9-a3dc-b91d-e91c-33f0479c55bb, S_END_AssimilationAndFreedDialogBox_2d0e6a22-6370-44c3-98e5-ede4a0d18704, 1, 1, 1);
NOT DB_AddCharactersInTriggerToDialog(END_IllithidOptions_OrpheusFreed_dd0df229-54bf-82cb-9869-a33edb46a57f, S_END_AssimilationAndFreedDialogBox_2d0e6a22-6370-44c3-98e5-ede4a0d18704, 1, 1, 1);

IF
EntityEvent((CHARACTER)_Var1, "END_IllithidOptions_OpenExitPortal", (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
THEN
PROC_END_IllithidOptions_OpenExitPortal(_Var1);

PROC
PROC_END_IllithidOptions_OpenExitPortal(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_OrpheusIsMindFlayer_2b638127-f30a-424e-9d4a-a9f8f100a307, _, _, _, _)
AND NOT
DB_END_IllithidOptions_ExitPortalOpen(1, _, _, _, _)
THEN
DB_END_IllithidOptions_ExitPortalOpen(1);
SetOnStage(S_END_ResolutionExitPortal_Orpheus_b86aadd0-1cdd-460b-8c02-63c01a9a612e, 1);

PROC
PROC_END_IllithidOptions_OpenExitPortal(_, _, _, _, _)
AND NOT
DB_END_IllithidOptions_ExitPortalOpen(1, _, _, _, _)
THEN
DB_END_IllithidOptions_ExitPortalOpen(1);
SetOnStage(S_END_ResolutionExitPortal_Illithid_2a62d420-290b-47e5-a224-71b5cda70f50, 1);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptions_ExitPortals(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_EmperorPrelude_State_GaveStones_18e3be1a-c1c0-437e-ad0a-a1426d8830f4, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptions_ExitPortals(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_IllithidOptions_State_OrpheusHostile_779f9ca6-4436-46dc-9e68-cb97e9ea1172, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_PlayCantUseItemAD(_Var1);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptions_ExitPortals(_Var2, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_IllithidOptions_State_OrpheusHostile_779f9ca6-4436-46dc-9e68-cb97e9ea1172, _Var1, _Var1, _Var1, _Var1)
AND
DB_GlobalFlag(END_IllithidOptions_State_AssimilatedOrpheus_5562cc3f-c168-48c9-87c1-1598a5c58961, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_TryLeaveAstralPrism(_Var1);

IF
UseStarted((CHARACTER)_Var1, (ITEM)_Var2, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptions_ExitPortals(_Var2, _Var1, _Var1, _Var1, _Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_OrpheusHostile_779f9ca6-4436-46dc-9e68-cb97e9ea1172, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_TryLeaveAstralPrism(_Var1);

PROC
PROC_END_IllithidOptions_TryLeaveAstralPrism((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptions_ReadyCheckPlayer(_Var2, _Var1, _Var1, _Var1, _Var1)
THEN
NOT DB_END_IllithidOptions_ReadyCheckPlayer(_Var2);

PROC
PROC_END_IllithidOptions_TryLeaveAstralPrism((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_END_General_CanProceedTowardsFinale()
THEN
DB_END_IllithidOptions_ReadyCheckPlayer(_Var1);
ReadyCheckGlobal("END_ReadyCheck_LeaveAstralPrism", "END_ReadyMessage_LeaveAstralPrism", 1, _Var1);

PROC
PROC_END_IllithidOptions_TryLeaveAstralPrism((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_END_General_CanProceedTowardsFinale()
THEN
PROC_END_General_ThrallOfTheAbsoluteWarning(_Var1);

IF
ReadyCheckPassed("END_ReadyCheck_LeaveAstralPrism", _, _, _, _)
THEN
PROC_SceneOver("END_IllithidOptions_EmperorScene");
PROC_SceneOver("END_IllithidOptions_OrpheusScene");
SetOnStage(S_END_FakeNetherbrain_000_4a97b2f5-5633-4988-8036-a73866e28834, 0);
PROC_GlobalSetFlagAndCache(END_IllithidOptions_State_LeftAstralPrism_db4fa8cd-9901-bda6-b5ee-b341075c02ce);
PROC_END_IllithidOptions_LeaveAstralPrism();

PROC
PROC_END_IllithidOptions_LeaveAstralPrism()
AND
DB_PermaDefeated(S_GLO_Orpheus_47c90728-af68-4cbc-baaa-6497eebd8d7e, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _, _, _, _)
AND
DB_END_IllithidOptions_ReadyCheckPlayer(_Var1, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_TryToStartHighHall(_Var1);

PROC
PROC_END_IllithidOptions_LeaveAstralPrism()
AND
DB_END_IllithidOptionsFollower_Follower(_, _, _, _, _)
AND
QRY_OnlyOnce("END_IllithidOptions_LeavingPrism", _, _, _, _)
THEN
DB_END_IllithidOptions_WaitingForFollowerToJoin(1);
PROC_END_IllithidOptionsFollower_StartFollow();

IF
CharacterJoinedParty((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_END_IllithidOptionsFollower_Follower(_Var1, _, _, _, _Var1)
AND
DB_END_IllithidOptions_WaitingForFollowerToJoin(1, _Var1, _Var1, _Var1, _Var1)
AND
DB_END_IllithidOptions_ReadyCheckPlayer(_Var5, _Var1, _Var1, _Var1, _Var1)
THEN
PROC_END_IllithidOptions_TryToStartHighHall(_Var5);

PROC
PROC_END_IllithidOptions_TryToStartHighHall((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
QRY_END_General_CanProceedTowardsFinale()
THEN
DB_END_HighHall_ArrivalUser(_Var1);
PROC_TeleportPartiesTo(S_END_HighHallStartPoint_250b3364-3f6a-48dc-aef9-0c82366f352d, "END_ArrivedInHighHall");
GoalCompleted;

PROC
PROC_END_IllithidOptions_TryToStartHighHall((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
QRY_END_General_CanProceedTowardsFinale()
THEN
PROC_END_General_ThrallOfTheAbsoluteWarning(_Var1);

PROC
PROC_END_IllithidOptions_CheckNoMoreOptionsLeft((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(END_IllithidOptions_State_ArrivedWithOrphicHammer_a350e277-55a7-4e03-9c14-db154b6c682e, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_IllithidOptions_CheckNoMoreOptionsLeftWithHammer()
THEN
SetFlag(GLO_ThrallOfTheAbsolute_Event_AstralPrism_4d658c40-92a9-4c2b-9828-acc604789025, _Var1);

QRY
QRY_END_IllithidOptions_CheckNoMoreOptionsLeftWithHammer()
AND
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_SupremeTadpoleAvailable_0177c452-90cc-4c29-83b8-4acaa2902b27, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_PartyMemberIsMindFlayer_3c42b03b-c51c-4f06-a5a3-a5ee416d9d8b, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_END_IllithidOptions_CheckNoMoreOptionsLeft((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_ArrivedWithOrphicHammer_a350e277-55a7-4e03-9c14-db154b6c682e, _Var1, _Var1, _Var1, _Var1)
AND
QRY_END_IllithidOptions_CheckNoMoreOptionsLeftWithOutHammer()
THEN
SetFlag(GLO_ThrallOfTheAbsolute_Event_AstralPrism_4d658c40-92a9-4c2b-9828-acc604789025, _Var1);

QRY
QRY_END_IllithidOptions_CheckNoMoreOptionsLeftWithOutHammer()
AND
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_SupremeTadpoleAvailable_0177c452-90cc-4c29-83b8-4acaa2902b27, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_PartyMemberIsMindFlayer_3c42b03b-c51c-4f06-a5a3-a5ee416d9d8b, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_Event_RejectedRaphael_b2e6764d-828b-b125-3e9a-365d5fd9737b, _, _, _, _)
THEN
DB_NOOP(1);

QRY
QRY_END_IllithidOptions_CheckNoMoreOptionsLeftWithOutHammer()
AND
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_SupremeTadpoleAvailable_0177c452-90cc-4c29-83b8-4acaa2902b27, _, _, _, _)
AND NOT
DB_GlobalFlag(END_General_State_PartyMemberIsMindFlayer_3c42b03b-c51c-4f06-a5a3-a5ee416d9d8b, _, _, _, _)
AND
DB_GlobalFlag(END_IllithidOptions_State_AcceptedRaphaelDeal_c4d409ef-d70e-9934-edf2-d6bd66201c19, _, _, _, _)
AND NOT
DB_GlobalFlag(END_IllithidOptions_State_OrpheusIsFree_3b747050-1be0-432e-9de6-e48faa4b74bb, _, _, _, _)
THEN
DB_NOOP(1);

PROC
PROC_END_IllithidOptions_CheckNoMoreOptionsLeft((CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1, (CHARACTER)_Var1)
AND
DB_GlobalFlag(END_IllithidOptions_Event_EmperorBetrayal_411c2575-bfbc-449c-9762-edad4285aafd, _Var1, _Var1, _Var1, _Var1)
AND
GetFlag(END_IllithidOptions_State_AssimilatorOfOrpheus_56989e8b-cca9-4f3b-aece-26a389e3b6ee, S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 1, _Var1, _Var1)
THEN
SetFlag(GLO_ThrallOfTheAbsolute_Event_AstralPrism_4d658c40-92a9-4c2b-9828-acc604789025, _Var1);


EXITSECTION
SetImmortal(S_GLO_Emperor_73d49dc5-8b8b-45dc-a98c-927bb4e3169b, 0);
ENDEXITSECTION

ParentTargetEdge "Act3c"
